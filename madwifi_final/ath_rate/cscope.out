cscope 15 $HOME/madwifi/ath_rate               0000230555
	@amrr/amrr.c

46 #iâdeà
AUTOCONF_INCLUDED


47 
	~<lšux/cÚfig.h
>

49 
	~<lšux/v”siÚ.h
>

50 
	~<lšux/moduË.h
>

51 
	~<lšux/š™.h
>

52 
	~<lšux/skbuff.h
>

53 
	~<lšux/Ãtdeviû.h
>

54 
	~<lšux/¿ndom.h
>

55 
	~<lšux/d–ay.h
>

56 
	~<lšux/ÿche.h
>

57 
	~<lšux/sysùl.h
>

58 
	~<lšux/´oc_fs.h
>

59 
	~<lšux/if_¬p.h
>

61 
	~<asm/uacûss.h
>

63 
	~<Ãt80211/if_medŸ.h
>

64 
	~<Ãt80211/›“80211_v¬.h
>

65 
	~<Ãt80211/›“80211_¿‹.h
>

67 
	~"if_©hv¬.h
"

68 
	~"if_©h_h®.h
"

69 
	~"ah_desc.h
"

71 
	~"am¼.h
"

73 
	#DEBUG
 0

	)

74 
	#DEBUG2
 1

	)

75 
	#AMRR_DEBUG


	)

76 #ifdeà
AMRR_DEBUG


77 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

78 ià(
DEBUG
) \

79 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

80 } 0)

	)

82 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

86 
	gfœ¡_time
 = 
Œue
;

87 
	gam¼_tx_couÁ”
 = 0 ;

88 
	g©h_¿‹š‹rv®
 = 1000;

89 
	g©h_¿‹_max_sucûss_th»shŞd
 = 10;

90 
	g©h_¿‹_mš_sucûss_th»shŞd
 = 1;

92 
©h_¿‹ùl
();

93 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

94 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

95 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

98 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

101 
i
 = 0 ;

102 
›“80211_node
* 
ni
 = &
ª
->
ª_node
;

103 iàĞ
fœ¡_time
 ){

108 
am¼_tx_couÁ”
 = 0 ;

110 
¡©s
[0].
¿‹
 = 1;

111 
¡©s
[1].
¿‹
 = 2;

112 
¡©s
[2].
¿‹
 = 5;

113 
¡©s
[3].
¿‹
 = 6;

114 
¡©s
[4].
¿‹
 = 9;

115 
¡©s
[5].
¿‹
 = 11;

116 
¡©s
[6].
¿‹
 = 12;

117 
¡©s
[7].
¿‹
 = 18;

118 
¡©s
[8].
¿‹
 = 24;

119 
¡©s
[9].
¿‹
 = 36;

120 
¡©s
[10].
¿‹
 = 48;

121 
¡©s
[11].
¿‹
 = 54;

125  
i
 = 0 ; i < 
MAX_NUM_RATE
 ; ++i){

127 
¡©s
[
i
].
couÁ
 = 0 ;

129 
fœ¡_time
 = 
çl£
;

133 ià(
DEBUG2
){

134 
	`´štk
("am¼: " 
MAC_FMT
 " : ",

135 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

136 
	`´štk
(" is‡live!\n");

139 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

142 
	}
}

145 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

147 
	}
}

150 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

151 
shÜtP»ambË
, 
size_t
 
äameL’
,

152 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

154 
am¼_node
 *
amn
 = 
	`ATH_NODE_AMRR
(
ª
);

156 *
rix
 = 
amn
->
amn_tx_rix0
;

157 *
Œy0
 = 
amn
->
amn_tx_Œy0
;

158 ià(
shÜtP»ambË
)

159 *
tx¿‹
 = 
amn
->
amn_tx_¿‹0¥
;

161 *
tx¿‹
 = 
amn
->
amn_tx_¿‹0
;

162 
	}
}

165 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

166 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

168 
am¼_node
 *
amn
 = 
	`ATH_NODE_AMRR
(
ª
);

170 
m¼
->
¿‹1
 = 
amn
->
amn_tx_¿‹1¥
;

171 
m¼
->
»Œ›s1
 = 
amn
->
amn_tx_Œy1
;

172 
m¼
->
¿‹2
 = 
amn
->
amn_tx_¿‹2¥
;

173 
m¼
->
»Œ›s2
 = 
amn
->
amn_tx_Œy2
;

174 
m¼
->
¿‹3
 = 
amn
->
amn_tx_¿‹3¥
;

175 
m¼
->
»Œ›s3
 = 
amn
->
amn_tx_Œy3
;

176 
	}
}

179 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

180 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

182 
am¼_node
 *
amn
 = 
	`ATH_NODE_AMRR
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

186 
›“80211_node
* 
ni
;

187 
¤
 = 
ts
->
ts_shÜŒ‘ry
;

188 
Ì
 = 
ts
->
ts_lÚg»Œy
;

189 
»Œy_couÁ
 = 
¤
 + 
Ì
;

192 
ni
 = &
ª
->
ª_node
;

194 
amn
->
amn_tx_couÁ”
 ++;

196 
¡©s
[
ni
->
ni_tx¿‹
].
couÁ
 ++;

205 
amn
->
amn_tx_Œy0_út
++;

206 ià(
»Œy_couÁ
 == 1) {

207 
amn
->
amn_tx_Œy1_út
++;

208 } ià(
»Œy_couÁ
 == 2) {

209 
amn
->
amn_tx_Œy1_út
++;

210 
amn
->
amn_tx_Œy2_út
++;

211 } ià(
»Œy_couÁ
 == 3) {

212 
amn
->
amn_tx_Œy1_út
++;

213 
amn
->
amn_tx_Œy2_út
++;

214 
amn
->
amn_tx_Œy3_út
++;

215 } ià(
»Œy_couÁ
 > 3) {

216 
amn
->
amn_tx_Œy1_út
++;

217 
amn
->
amn_tx_Œy2_út
++;

218 
amn
->
amn_tx_Œy3_út
++;

219 
amn
->
amn_tx_çu»_út
++;

223 
	}
}

226 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

228 ià(
i¢ew
)

229 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

230 
	}
}

233 
	$node_»£t
 (
am¼_node
 *
amn
)

235 
amn
->
amn_tx_Œy0_út
 = 0;

236 
amn
->
amn_tx_Œy1_út
 = 0;

237 
amn
->
amn_tx_Œy2_út
 = 0;

238 
amn
->
amn_tx_Œy3_út
 = 0;

239 
amn
->
amn_tx_çu»_út
 = 0;

240 
amn
->
amn_sucûss
 = 0;

241 
amn
->
amn_»cov”y
 = 0;

242 
amn
->
amn_sucûss_th»shŞd
 = 
©h_¿‹_mš_sucûss_th»shŞd
;

243 
	}
}

253 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

255 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

256 
am¼_node
 *
amn
 = 
	`ATH_NODE_AMRR
(
ª
);

257 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

258 
u_št8_t
 
rix
;

260 
	`KASSERT
(
¹
 !ğ
NULL
, ("nØ¿‹abË, mod%u", 
sc
->
sc_curmode
));

268 
ni
->
ni_tx¿‹
 = 
¿‹
;

276 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

277 
amn
->
amn_tx_rix0
 =

278 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

279 
amn
->
amn_tx_¿‹0
 = 
¹
->
šfo
[amn->
amn_tx_rix0
].
¿‹Code
;

280 
amn
->
amn_tx_¿‹0¥
 =‡mn->
amn_tx_¿‹0
 |

281 
¹
->
šfo
[
amn
->
amn_tx_rix0
].
shÜtP»ambË
;

282 ià(
sc
->
sc_m¼‘ry
) {

283 
amn
->
amn_tx_Œy0
 = 1;

284 
amn
->
amn_tx_Œy1
 = 1;

285 
amn
->
amn_tx_Œy2
 = 1;

286 
amn
->
amn_tx_Œy3
 = 1;

287 ià(--
¿‹
 >= 0) {

288 
rix
 = 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
]&
IEEE80211_RATE_VAL
];

289 
amn
->
amn_tx_¿‹1
 = 
¹
->
šfo
[
rix
].
¿‹Code
;

290 
amn
->
amn_tx_¿‹1¥
 =‡mn->
amn_tx_¿‹1
 |

291 
¹
->
šfo
[
rix
].
shÜtP»ambË
;

293 
amn
->
amn_tx_¿‹1
 =‡mn->
amn_tx_¿‹1¥
 = 0;

295 ià(--
¿‹
 >= 0) {

296 
rix
 = 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
]&
IEEE80211_RATE_VAL
];

297 
amn
->
amn_tx_¿‹2
 = 
¹
->
šfo
[
rix
].
¿‹Code
;

298 
amn
->
amn_tx_¿‹2¥
 =‡mn->
amn_tx_¿‹2
 |

299 
¹
->
šfo
[
rix
].
shÜtP»ambË
;

301 
amn
->
amn_tx_¿‹2
 =‡mn->
amn_tx_¿‹2¥
 = 0;

303 ià(
¿‹
 > 0) {

305 
amn
->
amn_tx_¿‹3
 = 
¹
->
šfo
[0].
¿‹Code
;

306 
amn
->
amn_tx_¿‹3¥
 =‡mn->
amn_tx_¿‹3
 |

307 
¹
->
šfo
[0].
shÜtP»ambË
;

309 
amn
->
amn_tx_¿‹3
 =‡mn->
amn_tx_¿‹3¥
 = 0;

312 
amn
->
amn_tx_Œy0
 = 
ATH_TXMAXTRY
;

316 
amn
->
amn_tx_Œy1
 = 0;

317 
amn
->
amn_tx_Œy2
 = 0;

318 
amn
->
amn_tx_Œy3
 = 0;

319 
amn
->
amn_tx_¿‹1
 =‡mn->
amn_tx_¿‹1¥
 = 0;

320 
amn
->
amn_tx_¿‹2
 =‡mn->
amn_tx_¿‹2¥
 = 0;

321 
amn
->
amn_tx_¿‹3
 =‡mn->
amn_tx_¿‹3¥
 = 0;

324 
	`node_»£t
(
amn
);

329 
	}
}

335 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

337 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

338 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

339 
¤©e
;

341 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("no„ates"));

342 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

348 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

349 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

355 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

356 
	`KASSERT
(
¤©e
 >= 0, ("bogus„ate set"));

366 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

367 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

368 
	`KASSERT
(
¤©e
 >= 0,

369 ("fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

371 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

372 #undeà
RATE


373 
	}
}

376 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

378 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

379 
	}
}

385 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

387 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

388 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

389 
am¼_soác
 *
asc
 = (am¼_soáø*)
sc
->
sc_rc
;

390 
›“80211_node
 *
ni
;

392 ià(
¡©e
 =ğ
IEEE80211_S_INIT
) {

393 
	`d–_tim”
(&
asc
->
tim”
);

396 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

401 
ni
 = 
v­
->
iv_bss
;

402 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

403 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

405 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

413 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

414 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

416 ià((
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
è&& (
¡©e
 =ğ
IEEE80211_S_RUN
)) {

417 
š‹rv®
;

422 
š‹rv®
 = 
©h_¿‹š‹rv®
;

423 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
)

424 
š‹rv®
 /= 2;

425 
	`mod_tim”
(&
asc
->
tim”
, 
jiff›s
 + ((
HZ
 * 
š‹rv®
) / 1000));

427 
	}
}

433 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

435 
©h_soác
 *
sc
 = 
¬g
;

436 
am¼_node
 *
amn
 = 
	`ATH_NODE_AMRR
(
	`ATH_NODE
 (
ni
));

437 
Şd_¿‹
;

439 
	#is_sucûss
(
amn
è×mn->
amn_tx_Œy1_út
 < (amn->
amn_tx_Œy0_út
 / 10))

	)

440 
	#is_’ough
(
amn
è×mn->
amn_tx_Œy0_út
 > 10)

	)

441 
	#is_çu»
(
amn
è×mn->
amn_tx_Œy1_út
 > (amn->
amn_tx_Œy0_út
 / 3))

	)

442 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

443 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

445 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

447 
	`DPRINTF
 (
sc
, "cnt0: %d cnt1: %d cnt2: %d cnt3: %d --hreshold: %d\n",

448 
amn
->
amn_tx_Œy0_út
,

449 
amn
->
amn_tx_Œy1_út
,

450 
amn
->
amn_tx_Œy2_út
,

451 
amn
->
amn_tx_Œy3_út
,

452 
amn
->
amn_sucûss_th»shŞd
);

453 ià(
	`is_sucûss
(
amn
è&& 
	`is_’ough
(amn)) {

454 
amn
->
amn_sucûss
++;

455 ià(
amn
->
amn_sucûss
 =ğamn->
amn_sucûss_th»shŞd
 &&

456 !
	`is_max_¿‹
(
ni
)) {

457 
amn
->
amn_»cov”y
 = 1;

458 
amn
->
amn_sucûss
 = 0;

459 
ni
->
ni_tx¿‹
++;

460 
	`DPRINTF
(
sc
, "šü—£„©tØ%d\n", 
ni
->
ni_tx¿‹
);

462 
amn
->
amn_»cov”y
 = 0;

463 } ià(
	`is_çu»
(
amn
)) {

464 
amn
->
amn_sucûss
 = 0;

465 ià(!
	`is_mš_¿‹
(
ni
)) {

466 ià(
amn
->
amn_»cov”y
) {

468 
amn
->
amn_sucûss_th»shŞd
 *= 2;

469 
amn
->
amn_sucûss_th»shŞd
 = 
	`mš
(amn->amn_success_threshold,

470 (
u_št
)
©h_¿‹_max_sucûss_th»shŞd
);

471 
	`DPRINTF
(
sc
, "decrease„ate„ecoveryhr: %d\n",

472 
amn
->
amn_sucûss_th»shŞd
);

475 
amn
->
amn_sucûss_th»shŞd
 = 
©h_¿‹_mš_sucûss_th»shŞd
;

476 
	`DPRINTF
(
sc
, "decrease„ate‚ormalhr: %d\n",

477 
amn
->
amn_sucûss_th»shŞd
);

479 
amn
->
amn_»cov”y
 = 0;

480 
ni
->
ni_tx¿‹
--;

482 
amn
->
amn_»cov”y
 = 0;

484 ià(
	`is_’ough
(
amn
è|| 
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
) {

486 
amn
->
amn_tx_Œy0_út
 = 0;

487 
amn
->
amn_tx_Œy1_út
 = 0;

488 
amn
->
amn_tx_Œy2_út
 = 0;

489 
amn
->
amn_tx_Œy3_út
 = 0;

490 
amn
->
amn_tx_çu»_út
 = 0;

492 ià(
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
){

493 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

494 ià(
DEBUG2
){

495 
	`´štk
("am¼: " 
MAC_FMT
 " : ",

496 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

497 
	`´štk
("x_count: %d,x_rate: %dM\n",

498 
amn
->
amn_tx_couÁ”
, 
¡©s
[
ni
->
ni_tx¿‹
].
¿‹
);

501 
	}
}

504 
	$©h_¿‹ùl
(
d©a
)

506 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
d©a
;

507 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
dev
);

508 
am¼_soác
 *
asc
 = (am¼_soáø*)
sc
->
sc_rc
;

509 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

510 
š‹rv®
;

512 ià(
dev
->
æags
 & 
IFF_RUNNING
) {

513 
sc
->
sc_¡©s
.
a¡_¿‹_ÿÎs
++;

515 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

516 
›“80211v­
 *
tmpv­
;

517 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

518 
	`©h_¿‹_ùl
(
sc
, 
tmpv­
->
iv_bss
);

521 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_ùl
, 
sc
);

523 
š‹rv®
 = 
©h_¿‹š‹rv®
;

524 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
)

525 
š‹rv®
 /= 2;

526 
	`mod_tim”
(&
asc
->
tim”
, 
jiff›s
 + ((
HZ
 * 
š‹rv®
) / 1000));

527 
	}
}

529 
©h_¿‹ù¾
 *

530 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

532 
am¼_soác
 *
asc
;

534 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

535 
asc
 = 
	`km®loc
((
am¼_soác
), 
GFP_ATOMIC
);

536 ià(
asc
 =ğ
NULL
) {

537 
	`_MOD_DEC_USE
(
THIS_MODULE
);

538  
NULL
;

540 
asc
->
¬c
.
¬c_¥aû
 = (
am¼_node
);

541 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

542 
	`š™_tim”
(&
asc
->
tim”
);

543 
asc
->
tim”
.
d©a
 = (è
sc
->
sc_dev
;

544 
asc
->
tim”
.
funùiÚ
 = 
©h_¿‹ùl
;

546  &
asc
->
¬c
;

547 
	}
}

550 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

552 
am¼_soác
 *
asc
 = (am¼_soáø*)
¬c
;

554 
	`d–_tim”
(&
asc
->
tim”
);

555 
	`kä“
(
asc
);

556 
	`_MOD_DEC_USE
(
THIS_MODULE
);

557 
	}
}

559 
	gmš¿‹š‹rv®
 = 500;

560 
	gmaxšt
 = 0x7fffffff;

561 
	gmš_th»shŞd
 = 1;

567 
ùl_bË
 
	g©h_¿‹_¡©ic_sysùls
[] = {

568 { .
ùl_Çme
 = 
CTL_AUTO
,

569 .
	g´oúame
 = "interval",

570 .
	gmode
 = 0644,

571 .
	gd©a
 = &
©h_¿‹š‹rv®
,

572 .
	gmaxËn
 = (
©h_¿‹š‹rv®
),

573 .
	gexŒa1
 = &
mš¿‹š‹rv®
,

574 .
	gexŒa2
 = &
maxšt
,

575 .
	g´oc_hªdËr
 = 
´oc_doštvec_mšmax


577 { .
	gùl_Çme
 = 
CTL_AUTO
,

578 .
	g´oúame
 = "max_success_threshold",

579 .
	gmode
 = 0644,

580 .
	gd©a
 = &
©h_¿‹_max_sucûss_th»shŞd
,

581 .
	gmaxËn
 = (
©h_¿‹_max_sucûss_th»shŞd
),

582 .
	gexŒa1
 = &
mš_th»shŞd
,

583 .
	gexŒa2
 = &
maxšt
,

584 .
	g´oc_hªdËr
 = 
´oc_doštvec_mšmax


586 { .
	gùl_Çme
 = 
CTL_AUTO
,

587 .
	g´oúame
 = "min_success_threshold",

588 .
	gmode
 = 0644,

589 .
	gd©a
 = &
©h_¿‹_mš_sucûss_th»shŞd
,

590 .
	gmaxËn
 = (
©h_¿‹_mš_sucûss_th»shŞd
),

591 .
	gexŒa1
 = &
mš_th»shŞd
,

592 .
	gexŒa2
 = &
maxšt
,

593 .
	g´oc_hªdËr
 = 
´oc_doštvec_mšmax


597 
ùl_bË
 
	g©h_¿‹_bË
[] = {

598 { .
ùl_Çme
 = 
CTL_AUTO
,

599 .
	g´oúame
 = "rate_amrr",

600 .
	gmode
 = 0555,

601 .
	gchd
 = 
©h_¿‹_¡©ic_sysùls


604 
ùl_bË
 
	g©h_©h_bË
[] = {

605 { .
ùl_Çme
 = 
DEV_ATH
,

606 .
	g´oúame
 = "ath",

607 .
	gmode
 = 0555,

608 .
	gchd
 = 
©h_¿‹_bË


611 
ùl_bË
 
	g©h_roÙ_bË
[] = {

612 { .
ùl_Çme
 = 
CTL_DEV
,

613 .
	g´oúame
 = "dev",

614 .
	gmode
 = 0555,

615 .
	gchd
 = 
©h_©h_bË


618 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

620 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

621 .
¿‹ùl_id
 = 
IEEE80211_RATE_AMRR
,

622 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

623 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

624 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

625 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

626 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

627 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

628 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

629 .
	g©ch
 = 
©h_¿‹_©ch
,

630 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

633 
	~"»Ëa£.h
"

635 *
	gv”siÚ
 = "0.1 (" 
RELEASE_VERSION
 ")";

636 *
	gdev_šfo
 = "ath_rate_amrr";

639 
MODULE_AUTHOR
("INRIA, Mathieu Lacage");

640 
MODULE_DESCRIPTION
("AMRR Rate control‡lgorithm");

641 #ifdeà
MODULE_VERSION


642 
MODULE_VERSION
(
RELEASE_VERSION
);

644 #ifdeà
MODULE_LICENSE


645 
MODULE_LICENSE
("Dual BSD/GPL");

648 
__š™


649 
	$š™_©h_¿‹_am¼
()

651 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

652 ià(
»t
)

653  
»t
;

655 
©h_sysùl_h—d”
 = 
	`ATH_REGISTER_SYSCTL_TABLE
(
©h_roÙ_bË
);

657 
	}
}

658 
moduË_š™
(
š™_©h_¿‹_am¼
);

660 
__ex™


661 
	$ex™_©h_¿‹_am¼
()

663 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

664 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

665 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

666 
	}
}

667 
moduË_ex™
(
ex™_©h_¿‹_am¼
);

	@amrr/amrr.h

40 
	#MAX_NUM_RATE
 12

	)

42 #iâdeà
_DEV_ATH_RATE_AMRR_H


43 
	#_DEV_ATH_RATE_AMRR_H


	)

46 
	sam¼_soác
 {

47 
©h_¿‹ù¾
 
	m¬c
;

48 
tim”_li¡
 
	mtim”
;

52 
	sam¼_¡©s
{

53 
u_št
 
	m¿‹
;

54 
u_št
 
	mcouÁ
;

57 
am¼_¡©s
 
	g¡©s
[
MAX_NUM_RATE
];

59 
	sam¼_node
 {

62 
u_št
 
	mamn_tx_couÁ”
 ;

64 
u_št
 
	mamn_tx_Œy0_út
;

65 
u_št
 
	mamn_tx_Œy1_út
;

66 
u_št
 
	mamn_tx_Œy2_út
;

67 
u_št
 
	mamn_tx_Œy3_út
;

68 
u_št
 
	mamn_tx_çu»_út
;

70 
u_št
 
	mamn_sucûss_th»shŞd
;

71 
u_št
 
	mamn_sucûss
;

72 
u_št
 
	mamn_»cov”y
;

74 
u_št8_t
 
	mamn_tx_rix0
;

75 
u_št8_t
 
	mamn_tx_¿‹0
;

76 
u_št8_t
 
	mamn_tx_¿‹1
;

77 
u_št8_t
 
	mamn_tx_¿‹2
;

78 
u_št8_t
 
	mamn_tx_¿‹3
;

79 
u_št8_t
 
	mamn_tx_¿‹0¥
;

80 
u_št8_t
 
	mamn_tx_¿‹1¥
;

81 
u_št8_t
 
	mamn_tx_¿‹2¥
;

82 
u_št8_t
 
	mamn_tx_¿‹3¥
;

83 
u_št8_t
 
	mamn_tx_Œy0
;

84 
u_št
 
	mamn_tx_Œy1
;

85 
u_št
 
	mamn_tx_Œy2
;

86 
u_št
 
	mamn_tx_Œy3
;

88 
	#ATH_NODE_AMRR
(
ª
è((
am¼_node
 *)&ª[1])

	)

	@amrr/ath_rate_amrr.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

39 cÚ¡ 
	g__moduË_d•’ds
[]

40 
__©Œibu‹_u£d__


41 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

45 
MODULE_INFO
(
¤cv”siÚ
, "1BAF11D0A59607F15367F0A");

	@minstrel/ath_rate_minstrel.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

46 cÚ¡ 
	g__moduË_d•’ds
[]

47 
__©Œibu‹_u£d__


48 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

52 
MODULE_INFO
(
¤cv”siÚ
, "7BFE4692B109EF26D8A0BC8");

	@minstrel/minstrel.c

90 #iâdeà
AUTOCONF_INCLUDED


91 
	~<lšux/cÚfig.h
>

94 
	~<lšux/v”siÚ.h
>

95 
	~<lšux/moduË.h
>

96 
	~<lšux/š™.h
>

97 
	~<lšux/skbuff.h
>

98 
	~<lšux/Ãtdeviû.h
>

99 
	~<lšux/¿ndom.h
>

100 
	~<lšux/d–ay.h
>

101 
	~<lšux/ÿche.h
>

102 
	~<lšux/sysùl.h
>

103 
	~<lšux/´oc_fs.h
>

104 
	~<lšux/if_¬p.h
>

105 
	~<lšux/Ãt.h
>

106 
	~<lšux/vm®loc.h
>

108 
	~<asm/uacûss.h
>

110 
	~<Ãt80211/if_medŸ.h
>

111 
	~<Ãt80211/›“80211_v¬.h
>

112 
	~<Ãt80211/›“80211_¿‹.h
>

114 
	~"if_©hv¬.h
"

115 
	~"if_©h_h®.h
"

116 
	~"ah_desc.h
"

118 
	~"mš¡»l.h
"

120 
	#MINSTREL_DEBUG


	)

121 #ifdeà
MINSTREL_DEBUG


123 
	mATH_DEBUG_RATE
 = 0x00000010

125 
	#DEBUG
 0

	)

126 
	#DEBUG2
 1

	)

127 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

128 ià(
DEBUG
) \

129 
	`´štk
("%s: " 
_fmt
, 
	`SC_DEV_NAME
(
sc
), 
__VA_ARGS__
); \

130 } 0)

	)

132 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

135 
	#ONE_SECOND
 (1000 * 1000è

	)

137 
	~"»Ëa£.h
"

139 *
	gv”siÚ
 = "1.2 (" 
RELEASE_VERSION
 ")";

141 *
	gdev_šfo
 = "ath_rate_minstrel";

142 
	#STALE_FAILURE_TIMEOUT_MS
 10000

	)

143 
	#ENABLE_MRR
 1

	)

146 
	g©h_tim”_š‹rv®
 = 100;

151 
	g©h_look¬ound_¿‹
 = 10;

152 
	g©h_ewma_Ëv–
 = 75;

153 
	g©h_£gm’t_size
 = 6000;

154 
©h_¿‹_ùl_»£t
(
©h_soác
 *, 
›“80211_node
 *);

159 
©h_¿‹_¡©i¡ics
(*
¬g
, 
›“80211_node
 *
ni
);

160 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

162 #ià(
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,5,52))

163 
MODULE_PARM
(
©h_look¬ound_¿‹
, "i");

164 
MODULE_PARM
(
©h_ewma_Ëv–
, "i");

165 
MODULE_PARM
(
©h_£gm’t_size
, "i");

167 
	~<lšux/moduË·¿m.h
>

168 
moduË_·¿m
(
©h_look¬ound_¿‹
, , 0600);

169 
moduË_·¿m
(
©h_ewma_Ëv–
, , 0600);

170 
moduË_·¿m
(
©h_£gm’t_size
, , 0600);

172 
MODULE_PARM_DESC
(
©h_look¬ound_¿‹
, " % of…ackets sento fill statistics "

174 
MODULE_PARM_DESC
(
©h_ewma_Ëv–
, " scaling % used inƒwma„olloff "

176 
MODULE_PARM_DESC
(
©h_£gm’t_size
, " max duration ofimeo spend inƒither "

180 
__šlše
 

181 
	$¿‹_to_ndx
(
mš¡»l_node
 *
¢
, 
¿‹
)

183 
x
 = 0;

184 
x
 = 0; x < 
¢
->
num_¿‹s
; x++)

185 ià(
¢
->
¿‹s
[
x
].
¿‹
 ==„ate)

186  
x
;

188 
	}
}

192 
	$ÿlc_u£cs_uniÿ¡_·ck‘
(
©h_soác
 *
sc
, 
Ëngth
,

193 
rix
, 
shÜt_»Œ›s
, 
lÚg_»Œ›s
)

195 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

196 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

197 
t_¦Ù
 = 20;

198 
t_difs
 = 50;

199 
t_sifs
 = 10;

200 
x
 = 0, 
‰
 = 0;

201 
cix
 = 
¹
->
šfo
[
rix
].
cÚŒŞR©e
;

202 
¹s
 = 0, 
ùs
 = 0;

203 
cw
 = 
ATH_DEFAULT_CWMIN
;

205 
	`KASSERT
(
¹
 !ğ
NULL
, ("nØ¿‹abË, mod%u", 
sc
->
sc_curmode
));

207 ià(!
¹
->
šfo
[
rix
].
¿‹Kbps
) {

208 
	`´štk
(
KERN_WARNING
 "rix %d (%d) bad„atekbps %d mode %u\n",

209 
rix
, 
¹
->
šfo
[rix].
dÙ11R©e
,

210 
¹
->
šfo
[
rix
].
¿‹Kbps
,

211 
sc
->
sc_curmode
);

218 
¹
->
šfo
[
rix
].
phy
) {

219 
IEEE80211_T_OFDM
:

221 
t_¦Ù
 = 9;

222 
t_sifs
 = 16;

223 
t_difs
 = 28;

226 
IEEE80211_T_TURBO
:

227 
t_¦Ù
 = 9;

228 
t_sifs
 = 8;

229 
t_difs
 = 28;

231 
IEEE80211_T_DS
:

235 
t_¦Ù
 = 20;

236 
t_difs
 = 50;

237 
t_sifs
 = 10;

240 ià((
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
) &&

241 (
¹
->
šfo
[
rix
].
phy
 =ğ
IEEE80211_T_OFDM
)) {

242 ià(
ic
->
ic_´Ùmode
 =ğ
IEEE80211_PROT_RTSCTS
)

243 
¹s
 = 1;

244 ià(
ic
->
ic_´Ùmode
 =ğ
IEEE80211_PROT_CTSONLY
)

245 
ùs
 = 1;

247 
cix
 = 
¹
->
šfo
[
sc
->
sc_´Ùrix
].
cÚŒŞR©e
;

251 ià(
Ëngth
 > 
ic
->
ic_¹¡h»shŞd
)

252 
¹s
 = 1;

255 ià(
¹s
 || 
ùs
) {

256 
ù¤©e
 = 
¹
->
šfo
[
cix
].
¿‹Code
;

257 
ùsdu¿tiÚ
 = 0;

259 ià(!
¹
->
šfo
[
cix
].
¿‹Kbps
) {

261 
	`´štk
(
KERN_WARNING


263 
cix
, 
¹
->
šfo
[cix].
dÙ11R©e
,

264 
¹
->
šfo
[
cix
].
¿‹Kbps
,

265 
sc
->
sc_curmode
);

271 
ù¤©e
 |ğ
¹
->
šfo
[
cix
].
shÜtP»ambË
;

272 ià(
¹s
)

273 
ùsdu¿tiÚ
 +ğ
¹
->
šfo
[
cix
].
¥AckDu¿tiÚ
;

275 
ùsdu¿tiÚ
 +ğ
	`©h_h®_compu‹txtime
(
sc
->
sc_ah
,

276 
¹
, 
Ëngth
, 
rix
, 
AH_TRUE
);

278 ià(
ùs
)

279 
ùsdu¿tiÚ
 +ğ
¹
->
šfo
[
cix
].
¥AckDu¿tiÚ
;

281 
‰
 +ğ(
shÜt_»Œ›s
 + 1è* 
ùsdu¿tiÚ
;

283 
‰
 +ğ
t_difs
;

284 
‰
 +ğ(
lÚg_»Œ›s
 + 1è* (
t_sifs
 + 
¹
->
šfo
[
rix
].
¥AckDu¿tiÚ
);

285 
‰
 +ğ(
lÚg_»Œ›s
 + 1è* 
	`©h_h®_compu‹txtime
(
sc
->
sc_ah
, 
¹
, 
Ëngth
,

286 
rix
, 
AH_TRUE
);

287 
x
 = 0; x <ğ
shÜt_»Œ›s
 + 
lÚg_»Œ›s
; x++) {

288 
cw
 = 
	`MIN
(
ATH_DEFAULT_CWMAX
, (cw + 1) * 2);

289 
‰
 +ğ(
t_¦Ù
 * 
cw
 / 2);

291  
‰
;

292 
	}
}

295 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

297 
›“80211_node
* 
ni
 = &
ª
->
ª_node
;

298 
mš¡»l_node
* 
mn
 = 
	`ATH_NODE_MINSTREL
(
ª
);

300 
mn
->
mn_·ck‘_couÁ
 = 0 ;

303 
	`©h_¿‹_ùl_»£t
(
sc
, &
ª
->
ª_node
);

305 ià(
DEBUG2
)

306 iàĞ
fœ¡_time
 ){

307 
mn
->
Şd_tx¿‹
 = 
ni
->
ni_tx¿‹
;

308 
	`´štk
(
MAC_FMT
 " mš¡»l_š™ : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

309 
fœ¡_time
 = 
çl£
;

311 
	}
}

315 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

317 
	}
}

321 
	$©h_¿‹_node_cİy
(
©h_soác
 *
sc
,

322 
©h_node
 *
d¡
, cÚ¡ ©h_nod*
¤c
)

324 
mš¡»l_node
 *
od¡
 = 
	`ATH_NODE_MINSTREL
(
d¡
);

325 cÚ¡ 
mš¡»l_node
 *
o¤c
 =

326 (cÚ¡ 
mš¡»l_node
 *)&
¤c
[1];

327 
	`memıy
(
od¡
, 
o¤c
, (
mš¡»l_node
));

328 
	}
}

332 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

333 
shÜtP»ambË
, 
size_t
 
äameL’
,

334 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

336 
mš¡»l_node
 *
¢
 = 
	`ATH_NODE_MINSTREL
(
ª
);

337 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

338 
ndx
, 
off£t
;

339 
m¼
;

341 ià(
¢
->
num_¿‹s
 <= 0) {

342 
	`´štk
(
KERN_WARNING
 "%s:‚Ø¿‹ fÜ " 
MAC_FMT
 "?\n",

343 
dev_šfo
,

344 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
));

348 
m¼
 = 
sc
->
sc_m¼‘ry
 &&

349 !(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
) &&

350 
ENABLE_MRR
;

352 ià(
¢
->
¡©ic_¿‹_ndx
 >= 0) {

353 
ndx
 = 
¢
->
¡©ic_¿‹_ndx
;

355 
¢
->
·ck‘_couÁ
++;

356 
¢
->
¿ndom_n
 = (¢->
a
 * sn->¿ndom_nè+ sn->
b
;

357 
off£t
 = 
¢
->
¿ndom_n
 & 0xf;

359 ià((((100 * 
¢
->
§m¶e_couÁ
è/ sn->
·ck‘_couÁ
) <

360 
©h_look¬ound_¿‹
) &&

361 (
off£t
 < 2)) {

362 
¢
->
§m¶e_couÁ
++;

363 
¢
->
is_§m¶šg
 = 1;

364 ià(
¢
->
·ck‘_couÁ
 >= 10000) {

365 
¢
->
§m¶e_couÁ
 = 0;

366 
¢
->
·ck‘_couÁ
 = 0;

376 
ndx
 = 
¢
->
rs_§m¶eTabË
[¢->
rs_§m¶eIndex
]

377 [
¢
->
rs_§m¶eCŞumn
];

379 
¢
->
rs_§m¶eIndex
++;

380 ià(
¢
->
rs_§m¶eIndex
 > (¢->
num_¿‹s
 - 2)) {

381 
¢
->
rs_§m¶eIndex
 = 0;

383 
¢
->
rs_§m¶eCŞumn
++;

384 ià(
¢
->
rs_§m¶eCŞumn
 >ğ
MINSTREL_COLUMNS
)

385 
¢
->
rs_§m¶eCŞumn
 = 0;

387 
¢
->
rs_§m¶e_¿‹
 = 
ndx
;

388 
¢
->
rs_§m¶e_¿‹_¦ow”
 =

389 (
¢
->
³rãù_tx_time
[
ndx
] >

390 
¢
->
³rãù_tx_time
[¢->
max__¿‹
]);

391 ià(
¢
->
rs_§m¶e_¿‹_¦ow”
)

392 
ndx
 = 
¢
->
max__¿‹
;

394 
ndx
 = 
¢
->
max__¿‹
;

397 ià((
¢
->
¡©ic_¿‹_ndx
 !ğ-1è|| !
m¼
)

398 *
Œy0
 = 
ATH_TXMAXTRY
;

400 *
Œy0
 = 
¢
->
»Œy_adju¡ed_couÁ
[
ndx
];

402 
	`KASSERT
((
ndx
 < 
¢
->
num_¿‹s
),

403 ("%s: bad‚dx (%d/%dèfÜ " 
MAC_FMT
 "?",

404 
dev_šfo
, 
ndx
, 
¢
->
num_¿‹s
,

405 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
)));

407 *
rix
 = 
¢
->
¿‹s
[
ndx
].rix;

408 ià(
shÜtP»ambË
)

409 *
tx¿‹
 = 
¢
->
¿‹s
[
ndx
].
shÜtP»ambËR©eCode
;

411 *
tx¿‹
 = 
¢
->
¿‹s
[
ndx
].
¿‹Code
;

412 
	}
}

416 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

417 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

419 
mš¡»l_node
 *
¢
 = 
	`ATH_NODE_MINSTREL
(
ª
);

421 
rc1
, 
rc2
, 
rc3
;

423 ià(
¢
->
num_¿‹s
 <= 0) {

424 
	`DPRINTF
(
sc
, "%s:‚Ø¿‹ fÜ " 
MAC_FMT
 "\n",

425 
dev_šfo
,

426 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
));

427 
	`mem£t
(
m¼
, 0, (
›“80211_m¼
));

431 ià(
¢
->
is_§m¶šg
) {

432 
¢
->
is_§m¶šg
 = 0;

433 ià(
¢
->
rs_§m¶e_¿‹_¦ow”
)

434 
rc1
 = 
¢
->
rs_§m¶e_¿‹
;

436 
rc1
 = 
¢
->
max__¿‹
;

438 
rc1
 = 
¢
->
max__¿‹2
;

441 
rc2
 = 
¢
->
max_´ob_¿‹
;

442 
rc3
 = 0;

444 
	`KASSERT
((
rc1
 >ğ0è&& (rc1 < 
¢
->
num_¿‹s
),

445 ("%s: bad„c1 (%d/%dèfÜ " 
MAC_FMT
 "?",

446 
dev_šfo
, 
rc1
, 
¢
->
num_¿‹s
,

447 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
)));

449 
	`KASSERT
((
rc2
 >ğ0è&& (rc2 < 
¢
->
num_¿‹s
),

450 ("%s: bad„c2 (%d/%dèfÜ " 
MAC_FMT
 "?",

451 
dev_šfo
, 
rc2
, 
¢
->
num_¿‹s
,

452 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
)));

454 
	`KASSERT
((
rc3
 >ğ0è&& (rc3 < 
¢
->
num_¿‹s
),

455 ("%s: bad„c3 (%d/%dèfÜ " 
MAC_FMT
 "?",

456 
dev_šfo
, 
rc3
, 
¢
->
num_¿‹s
,

457 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
)));

459 ià(
shÜtP»ambË
) {

460 
m¼
->
¿‹1
 = 
¢
->
¿‹s
[
rc1
].
shÜtP»ambËR©eCode
;

461 
m¼
->
¿‹2
 = 
¢
->
¿‹s
[
rc2
].
shÜtP»ambËR©eCode
;

462 
m¼
->
¿‹3
 = 
¢
->
¿‹s
[
rc3
].
shÜtP»ambËR©eCode
;

464 
m¼
->
¿‹1
 = 
¢
->
¿‹s
[
rc1
].
¿‹Code
;

465 
m¼
->
¿‹2
 = 
¢
->
¿‹s
[
rc2
].
¿‹Code
;

466 
m¼
->
¿‹3
 = 
¢
->
¿‹s
[
rc3
].
¿‹Code
;

469 
m¼
->
»Œ›s1
 = 
¢
->
»Œy_adju¡ed_couÁ
[
rc1
];

470 
m¼
->
»Œ›s2
 = 
¢
->
»Œy_adju¡ed_couÁ
[
rc2
];

471 
m¼
->
»Œ›s3
 = 
¢
->
»Œy_adju¡ed_couÁ
[
rc3
];

472 
	}
}

475 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

476 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

478 
mš¡»l_node
 *
¢
 = 
	`ATH_NODE_MINSTREL
(
ª
);

479 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

480 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

481 cÚ¡ 
©h_desc
 *
ds
 = &
bf
->
bf_desc
[0];

482 
›“80211_node
* 
ni
 = &
ª
->
ª_node
;

483 
fš®_¿‹
 = 0;

484 
Œ›s
 = 0;

485 
m¼
;

486 
fš®_ndx
;

487 
¿‹0
, 
Œ›s0
, 
ndx0
;

488 
¿‹1
, 
Œ›s1
, 
ndx1
;

489 
¿‹2
, 
Œ›s2
, 
ndx2
;

490 
¿‹3
, 
Œ›s3
, 
ndx3
;

495 
fš®_¿‹
 = 
sc
->
sc_hwm­
[
ts
->
ts_¿‹
 & ~
HAL_TXSTAT_ALTRATE
].
›“¿‹
;

496 
fš®_ndx
 = 
	`¿‹_to_ndx
(
¢
, 
fš®_¿‹
);

497 ià(
fš®_ndx
 >ğ
¢
->
num_¿‹s
) {

498 
	`DPRINTF
(
sc
, "%s: fš®‚dxoØhigh\n", 
__func__
);

499 
fš®_ndx
 = 0;

501 ià(
fš®_ndx
 < 0) {

502 
	`DPRINTF
(
sc
, "%s: fš®‚dxoØlow\n", 
__func__
);

503 
fš®_ndx
 = 0;

506 ià(
DEBUG2
){

507 iàĞ
¢
->
Şd_tx¿‹
 !ğ
fš®_¿‹
){

509 
	`´štk
(
MAC_FMT
 " mš¡»l:x_¿‹ %d,…ack‘_couÁ %d\n", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

510 (
fš®_¿‹
 & 
IEEE80211_RATE_VAL
 )/2, 
¢
->
·ck‘_couÁ
 );

511 
¢
->
Şd_tx¿‹
 = 
fš®_¿‹
;

517 
Œ›s
 = 
ts
->
ts_lÚg»Œy
 + 1;

519 ià(
¢
->
num_¿‹s
 <= 0) {

520 
	`DPRINTF
(
sc
, "%s: " 
MAC_FMT
 " % nØ¿‹ y‘\n", 
dev_šfo
,

521 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
), 
__func__
);

525 ià(!
ts
->
ts_¡©us
)

526 
¢
->
rs_¿‹sucûss
[
fš®_ndx
]++;

528 
m¼
 = 
sc
->
sc_m¼‘ry
 &&

529 !(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
) &&

530 
ENABLE_MRR
;

532 ià(!
m¼
) {

533 ià((0 <ğ
fš®_ndx
è&& (fš®_ndx < 
¢
->
num_¿‹s
)) {

535 
¢
->
rs_¿‹©‹m±s
[
fš®_ndx
] +ğ
Œ›s
;

545 
¿‹0
 = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e0
)].
›“¿‹
;

546 
Œ›s0
 = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s0
);

547 
ndx0
 = 
	`¿‹_to_ndx
(
¢
, 
¿‹0
);

549 
¿‹1
 = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e1
)].
›“¿‹
;

550 
Œ›s1
 = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s1
);

551 
ndx1
 = 
	`¿‹_to_ndx
(
¢
, 
¿‹1
);

553 
¿‹2
 = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e2
)].
›“¿‹
;

554 
Œ›s2
 = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s2
);

555 
ndx2
 = 
	`¿‹_to_ndx
(
¢
, 
¿‹2
);

557 
¿‹3
 = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e3
)].
›“¿‹
;

558 
Œ›s3
 = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s3
);

559 
ndx3
 = 
	`¿‹_to_ndx
(
¢
, 
¿‹3
);

561 
¢
->
rs_¿‹©‹m±s
[
ndx0
] +ğ
	`MIN
(
Œ›s
, 
Œ›s0
);

562 ià(
Œ›s
 <ğ
Œ›s0
)

565 ià(
Œ›s1
 < 0)

567 
Œ›s
 =r› - 
Œ›s0
;

568 
¢
->
rs_¿‹©‹m±s
[
ndx1
] +ğ
	`MIN
(
Œ›s
, 
Œ›s1
);

569 ià(
Œ›s
 <ğ
Œ›s1
)

572 ià(
Œ›s2
 < 0)

574 
Œ›s
 =r› - 
Œ›s1
;

575 
¢
->
rs_¿‹©‹m±s
[
ndx2
] +ğ
	`MIN
(
Œ›s
, 
Œ›s2
);

576 ià(
Œ›s
 <ğ
Œ›s2
)

579 ià(
Œ›s3
 < 0)

581 
Œ›s
 =r› - 
Œ›s2
;

582 
¢
->
rs_¿‹©‹m±s
[
ndx3
] +ğ
	`MIN
(
Œ›s
, 
Œ›s3
);

585 
	}
}

588 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

590 
	`DPRINTF
(
sc
, "%s: " 
MAC_FMT
 " %s\n", 
dev_šfo
,

591 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
), 
__func__
);

592 ià(
i¢ew
)

593 
	`©h_¿‹_ùl_»£t
(
sc
, &
ª
->
ª_node
);

594 
	}
}

597 
	$©h_fl_§m¶e_bË
(
©h_soác
 *
sc
, 
mš¡»l_node
 *
¢
)

599 
num_§m¶e_¿‹s
 = (
¢
->
num_¿‹s
 - 1);

602 
i
, 
cŞumn_šdex
, 
ÃwIndex
;

603 
u_št8_t
 
¿ndom_by‹s
[8];

607 
	`mem£t
(
¢
->
rs_§m¶eTabË
, 0, (sn->rs_sampleTable));

609 
¢
->
rs_§m¶eCŞumn
 = 0;

610 
¢
->
rs_§m¶eIndex
 = 0;

615 
¢
->
¿ndom_n
 = 1;

616 
¢
->
a
 = 1664525;

617 
¢
->
b
 = 1013904223;

619 ià(
¢
->
num_¿‹s
 > 1) {

620 
cŞumn_šdex
 = 0; cŞumn_šdex < 
MINSTREL_COLUMNS
; column_index++) {

621 
i
 = 0; i < 
num_§m¶e_¿‹s
; i++) {

622 
	`g‘_¿ndom_by‹s
(
¿ndom_by‹s
, 8);

623 
ÃwIndex
 = (
i
 + 
¿ndom_by‹s
[˜& 7]è% 
num_§m¶e_¿‹s
;

625 
¢
->
rs_§m¶eTabË
[
ÃwIndex
][
cŞumn_šdex
] != 0)

626 
ÃwIndex
 = (ÃwIndex + 1è% 
num_§m¶e_¿‹s
;

628 
¢
->
rs_§m¶eTabË
[
ÃwIndex
][
cŞumn_šdex
] = 
i
 + 1;

633 
cŞumn_šdex
 = 0; cŞumn_šdex < 
MINSTREL_COLUMNS
; column_index++) {

634 
i
 = 0; i < 
num_§m¶e_¿‹s
 && i < 
IEEE80211_RATE_MAXSIZE
; i++) {

635 
	`DPRINTF
(
sc
, "rs_sampleTable[%2u][%2u] = %2u\n",

636 
i
, 
cŞumn_šdex
, 
¢
->
rs_§m¶eTabË
[i][column_index]);

639 
	}
}

643 
	$©h_¿‹_ùl_»£t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

645 
mš¡»l_node
 *
¢
 = 
	`ATH_NODE_MINSTREL
(
	`ATH_NODE
(
ni
));

646 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

647 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

648 
x
;

649 
»Œy_šdex
, 
tx_time
;

650 
¤©e
;

651 
ndx
 = 0;

653 
¢
->
num_¿‹s
 = 0;

654 
¢
->
max__¿‹
 = 0;

655 
¢
->
max__¿‹2
 = 0;

656 
¢
->
max_´ob_¿‹
 = 0;

657 
¢
->
·ck‘_couÁ
 = 0;

658 
¢
->
§m¶e_couÁ
 = 0;

659 
¢
->
is_§m¶šg
 = 0;

661 ià(
¹
 =ğ
NULL
) {

662 
	`DPRINTF
(
sc
, "nØ¿‹ y‘! mod%u\n", sc->
sc_curmode
);

665 
¢
->
¡©ic_¿‹_ndx
 = -1;

667 
¢
->
num_¿‹s
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
;

668 
x
 = 0; x < 
ni
->
ni_¿‹s
.
rs_Ä©es
; x++) {

669 
¢
->
rs_¿‹©‹m±s
 [
x
] = 0;

670 
¢
->
rs_thi¥rob
 [
x
] = 0;

671 
¢
->
rs_¿‹sucûss
 [
x
] = 0;

672 
¢
->
rs_Ï¡¿‹©‹m±s
 [
x
] = 0;

673 
¢
->
rs_Ï¡¿‹sucûss
 [
x
] = 0;

674 
¢
->
rs_´obab™y
 [
x
] = 0;

675 
¢
->
rs_succ_hi¡
 [
x
] = 0;

676 
¢
->
rs_©t_hi¡
 [
x
] = 0;

677 
¢
->
rs_this_
 [
x
] = 0;

679 
¢
->
¿‹s
[
x
].
¿‹
 = 
ni
->
ni_¿‹s
.
rs_¿‹s
[x] & 
IEEE80211_RATE_VAL
;

680 
¢
->
¿‹s
[
x
].
rix
 = 
sc
->
sc_rixm­
[¢->¿‹s[x].
¿‹
];

681 ià(
¢
->
¿‹s
[
x
].
rix
 == 0xff) {

682 
	`DPRINTF
(
sc
, "%s: %s ignore bogus„ix‡t %d\n",

683 
dev_šfo
, 
__func__
, 
x
);

686 
¢
->
¿‹s
[
x
].
¿‹Code
 = 
¹
->
šfo
[¢->¿‹s[x].
rix
].rateCode;

687 
¢
->
¿‹s
[
x
].
shÜtP»ambËR©eCode
 =

688 
¹
->
šfo
[
¢
->
¿‹s
[
x
].
rix
].
¿‹Code
 |

689 
¹
->
šfo
[
¢
->
¿‹s
[
x
].
rix
].
shÜtP»ambË
;

692 
	`©h_fl_§m¶e_bË
(
sc
, 
¢
);

694 
ni
->
ni_tx¿‹
 = 0;

696 ià(
¢
->
num_¿‹s
 <= 0) {

697 
	`DPRINTF
(
sc
, "%s: % " 
MAC_FMT
 "‚o„ates (fixed %d) \n",

698 
dev_šfo
, 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

699 
v­
->
iv_fixed_¿‹
);

704 ià(
v­
->
iv_fixed_¿‹
 !ğ
IEEE80211_FIXED_RATE_NONE
) {

705 
¤©e
 = 
¢
->
num_¿‹s
 - 1;

714 (
¤©e
 >= 0) &&

715 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¤©e
] &

716 
IEEE80211_RATE_VAL
è!ğ
v­
->
iv_fixed_¿‹
;

717 
¤©e
--);

719 
	`KASSERT
(
¤©e
 >= 0,

720 ("fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

722 
¢
->
¡©ic_¿‹_ndx
 = 
¤©e
;

723 
ni
->
ni_tx¿‹
 = 
¤©e
;

724 
	`DPRINTF
(
sc
, "%s: % " 
MAC_FMT
 " fixed„ate %d%sMbps\n",

725 
dev_šfo
, 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

726 
¢
->
¿‹s
[
¤©e
].
¿‹
 / 2,

727 (
¢
->
¿‹s
[
¤©e
].
¿‹
 % 2) ? ".5 " : " ");

731 
x
 = 0; x < 
ni
->
ni_¿‹s
.
rs_Ä©es
; x++) {

732 ià(
¢
->
¿‹s
[
x
].
rix
 == 0xff) {

733 
	`DPRINTF
(
sc
, "%s: %s ignore bogus„ix‡t %d\n",

734 
dev_šfo
, 
__func__
, 
x
);

738 
¢
->
rs_¿‹©‹m±s
 [
x
] = 0;

739 
¢
->
rs_thi¥rob
 [
x
] = 0;

740 
¢
->
rs_¿‹sucûss
 [
x
] = 0;

741 
¢
->
rs_´obab™y
 [
x
] = 0;

742 
¢
->
rs_Ï¡¿‹©‹m±s
 [
x
] = 0;

743 
¢
->
rs_Ï¡¿‹sucûss
 [
x
] = 0;

744 
¢
->
rs_succ_hi¡
 [
x
] = 0;

745 
¢
->
rs_©t_hi¡
 [
x
] = 0;

746 
¢
->
³rãù_tx_time
 [
x
] =

747 
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 1200,

748 
¢
->
¿‹s
[
x
].
rix
,

750 
¢
->
»Œy_couÁ
 [
x
] = 1;

751 
¢
->
»Œy_adju¡ed_couÁ
[
x
] = 1;

753 
»Œy_šdex
 = 2;„‘ry_šdex < 
ATH_TXMAXTRY
;„etry_index++) {

754 
tx_time
 = 
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 1200,

755 
¢
->
¿‹s
[
x
].
rix
, 0, 
»Œy_šdex
);

756 ià(
tx_time
 > 
©h_£gm’t_size
)

758 
¢
->
»Œy_couÁ
[
x
] = 
»Œy_šdex
;

759 
¢
->
»Œy_adju¡ed_couÁ
[
x
] = 
»Œy_šdex
;

764 
	`DPRINTF
(
sc
, "%s: R‘ryabË fÜhi node\n", 
__func__
);

765 
x
 = 0; x < 
ni
->
ni_¿‹s
.
rs_Ä©es
; x++)

766 
	`DPRINTF
(
sc
, "%2d %2d %6d \n", 
x
, 
¢
->
»Œy_couÁ
[x],

767 
¢
->
³rãù_tx_time
[
x
]);

771 
ndx
 = 
¢
->
num_¿‹s
 - 1;‚dx > 0;‚dx--)

772 ià(
¢
->
¿‹s
[
ndx
].
¿‹
 <= 72)

774 
¢
->
cu¼’t_¿‹
 = 
ndx
;

776 
ni
->
ni_tx¿‹
 = 
¢
->
cu¼’t_¿‹
;

777 
	}
}

780 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

782 
	`©h_¿‹_ùl_»£t
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i);

783 
	}
}

787 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
Ãw¡©e
)

789 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

791 ià(
Ãw¡©e
 =ğ
IEEE80211_S_RUN
) {

792 ià(
ic
->
ic_İmode
 !ğ
IEEE80211_M_STA
) {

795 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
,

796 
©h_¿‹_cb
, 
NULL
);

798 
	`©h_¿‹_Ãwassoc
(
	`Ãtdev_´iv
(
ic
->
ic_dev
),

799 
	`ATH_NODE
(
v­
->
iv_bss
), 1);

801 
	}
}

804 
	$©h_tim”_funùiÚ
(
d©a
)

806 
mš¡»l_soác
 *
ssc
 = (mš¡»l_soáø*)
d©a
;

807 
©h_soác
 *
sc
 = 
ssc
->sc;

808 
›“80211com
 *
ic
;

809 
Ãt_deviû
 *
dev
 = 
ssc
->
sc_dev
;

810 
tim”_li¡
 *
tim”
;

811 
š‹rv®
 = 
©h_tim”_š‹rv®
;

813 ià(
dev
 =ğ
NULL
)

814 
	`DPRINTF
(
sc
, "%s: 'dev' i nuÎ iÀthi tim” \n", 
__func__
);

816 ià(
sc
 =ğ
NULL
)

817 
	`DPRINTF
(
sc
, "%s: 'sc' i nuÎ iÀthi tim”\n", 
__func__
);

819 
ic
 = &
sc
->
sc_ic
;

821 ià(
ssc
->
şo£_tim”_now
)

824 ià(
dev
->
æags
 & 
IFF_RUNNING
) {

825 
sc
->
sc_¡©s
.
a¡_¿‹_ÿÎs
++;

827 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

828 
›“80211v­
 *
tmpv­
;

829 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

831 
	`©h_¿‹_¡©i¡ics
(
sc
, 
tmpv­
->
iv_bss
);

834 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
,

835 
©h_¿‹_¡©i¡ics
, 
sc
);

838 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
)

839 
š‹rv®
 = 
©h_tim”_š‹rv®
 >> 1;

841 
tim”
 = &(
ssc
->timer);

842 ià(
tim”
 =ğ
NULL
)

843 
	`DPRINTF
(
sc
, "%s:im” i nuÎ -†—v™\n", 
__func__
);

845 
	`mod_tim”
(
tim”
, 
jiff›s
 + ((
HZ
 * 
š‹rv®
) / 1000));

846 
	}
}

849 
	$©h_¿‹_¡©i¡ics
(*
¬g
, 
›“80211_node
 *
ni
)

851 
©h_node
 *
ª
 = (©h_nod*)
ni
;

852 
›“80211_¿‹£t
 *
rs
 = &
ni
->
ni_¿‹s
;

853 
mš¡»l_node
 *
º
 = 
	`ATH_NODE_MINSTREL
(
ª
);

854 
i
;

855 
u_št32_t
 
p
;

856 
u_št32_t
 
miüo_£cs
;

857 
u_št32_t
 
max_´ob
, 
šdex_max_´ob
;

858 
u_št32_t
 
max_
, 
šdex_max_
, 
šdex_max_2
;

862 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

863 
miüo_£cs
 = 
º
->
³rãù_tx_time
[
i
];

864 ià(
miüo_£cs
 == 0)

865 
miüo_£cs
 = 
ONE_SECOND
;

867 ià(
º
->
rs_¿‹©‹m±s
[
i
] != 0) {

868 
p
 = (
º
->
rs_¿‹sucûss
[
i
] * 18000) /

869 
º
->
rs_¿‹©‹m±s
[
i
];

870 
º
->
rs_succ_hi¡
[
i
] +ğº->
rs_¿‹sucûss
[i];

871 
º
->
rs_©t_hi¡
[
i
] +ğº->
rs_¿‹©‹m±s
[i];

872 
º
->
rs_thi¥rob
[
i
] = 
p
;

873 
p
 = (Õ * (100 - 
©h_ewma_Ëv–
)) +

874 (
º
->
rs_´obab™y
[
i
] * 
©h_ewma_Ëv–
)) / 100;

875 
º
->
rs_´obab™y
[
i
] = 
p
;

876 
º
->
rs_this_
[
i
] = 
p
 * (
ONE_SECOND
 / 
miüo_£cs
);

877 
º
->
rs_Ï¡¿‹sucûss
[
i
] =„n->
rs_¿‹sucûss
[i];

878 
º
->
rs_Ï¡¿‹©‹m±s
[
i
] =„n->
rs_¿‹©‹m±s
[i];

879 
º
->
rs_¿‹sucûss
[
i
] = 0;

880 
º
->
rs_¿‹©‹m±s
[
i
] = 0;

882 
º
->
rs_Ï¡¿‹sucûss
[
i
] = 0;

883 
º
->
rs_Ï¡¿‹©‹m±s
[
i
] = 0;

890 ià((
º
->
rs_´obab™y
[
i
] > 17100) ||

891 (
º
->
rs_´obab™y
[
i
] < 1800)) {

892 
º
->
»Œy_adju¡ed_couÁ
[
i
] =„n->
»Œy_couÁ
[i] >> 1;

893 ià(
º
->
»Œy_adju¡ed_couÁ
[
i
] > 2)

894 
º
->
»Œy_adju¡ed_couÁ
[
i
] = 2;

896 
º
->
»Œy_adju¡ed_couÁ
[
i
] =„n->
»Œy_couÁ
[i];

897 ià(
º
->
»Œy_adju¡ed_couÁ
[
i
] == 0)

898 
º
->
»Œy_adju¡ed_couÁ
[
i
] = 1;

904 
max_´ob
 = 0;

905 
šdex_max_´ob
 = 0;

906 
max_
 = 0;

907 
šdex_max_
 = 0;

908 
šdex_max_2
 = 0;

912 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

913 ià(
max_
 < 
º
->
rs_this_
[
i
]) {

914 
šdex_max_
 = 
i
;

915 
max_
 = 
º
->
rs_this_
[
i
];

918 ià(
max_´ob
 < 
º
->
rs_´obab™y
[
i
]) {

919 
šdex_max_´ob
 = 
i
;

920 
max_´ob
 = 
º
->
rs_´obab™y
[
i
];

924 
max_
 = 0;

925 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

926 ià((
i
 !ğ
šdex_max_
è&& (
max_
 < 
º
->
rs_this_
[i])) {

927 
šdex_max_2
 = 
i
;

928 
max_
 = 
º
->
rs_this_
[
i
];

932 
º
->
max__¿‹
 = 
šdex_max_
;

933 
º
->
max__¿‹2
 = 
šdex_max_2
;

934 
º
->
max_´ob_¿‹
 = 
šdex_max_´ob
;

935 
º
->
cu¼’t_¿‹
 = 
šdex_max_
;

936 
	}
}

938 
©h_¿‹ù¾
 *

939 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

941 
mš¡»l_soác
 *
osc
;

942 
	`DPRINTF
(
sc
, "%s: %s\n", 
dev_šfo
, 
__func__
);

944 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

945 
osc
 = 
	`km®loc
((
mš¡»l_soác
), 
GFP_ATOMIC
);

946 ià(
osc
 =ğ
NULL
) {

947 
	`_MOD_DEC_USE
(
THIS_MODULE
);

948  
NULL
;

951 
osc
->
¬c
.
¬c_¥aû
 = (
mš¡»l_node
);

952 
osc
->
¬c
.
¬c_v­_¥aû
 = 0;

954 
osc
->
şo£_tim”_now
 = 0;

955 
	`š™_tim”
(&
osc
->
tim”
);

956 
osc
->
sc
 = sc;

957 
osc
->
sc_dev
 = 
sc
->sc_dev;

958 
osc
->
tim”
.
funùiÚ
 = 
©h_tim”_funùiÚ
;

959 
osc
->
tim”
.
d©a
 = ()osc;

961 
	`mod_tim”
(&
osc
->
tim”
, 
jiff›s
 + 
HZ
);

963  &
osc
->
¬c
;

964 
	}
}

967 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

969 
mš¡»l_soác
 *
osc
 = (mš¡»l_soáø*)
¬c
;

970 
osc
->
şo£_tim”_now
 = 1;

971 
	`d–_tim”
(&
osc
->
tim”
);

972 
	`kä“
(
osc
);

973 
	`_MOD_DEC_USE
(
THIS_MODULE
);

974 
	}
}

976 #ifdeà
CONFIG_SYSCTL


978 
	$©h_´oc_»ad_nodes
(
›“80211v­
 *
v­
, *
buf
, 
¥aû
)

980 *
p
 = 
buf
;

981 
›“80211_node
 *
ni
;

982 
mš¡»l_node
 *
od¡
;

983 
›“80211_node_bË
 *
Á
 =

984 (
›“80211_node_bË
 *)&
v­
->
iv_ic
->
ic_¡a
;

985 
x
 = 0;

986 
this_
, 
this_´ob
, 
this_•rob
;

987 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
v­
->
iv_ic
->
ic_dev
);

989 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

990 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

992 ià((
buf
 + 
¥aû
è< (
p
 + 1500)) {

993 ià((
buf
 + 
¥aû
è> (
p
 + 100)) {

994 
p
 +ğ
	`¥rštf
(p, "out of„oom for‚ode "

995 
MAC_FMT
 "\n\n",

996 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

999 
	`DPRINTF
(
sc
, "%s: out of memeoryo write "

1000 "®Èoàthnodes\n", 
__func__
);

1003 
od¡
 = 
	`ATH_NODE_MINSTREL
(
	`ATH_NODE
(
ni
));

1005 ià(
	`IEEE80211_ADDR_EQ
(
v­
->
iv_myaddr
, 
ni
->
ni_maÿddr
))

1008 
p
 +ğ
	`¥rštf
Õ, "¿‹ d©¨fÜ‚ode: " 
MAC_FMT
 "\n",

1009 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

1010 
p
 +ğ
	`¥rštf
(p, "„atehroughput EWMA…robhis…robhis "

1012 
x
 = 0; x < 
od¡
->
num_¿‹s
; x++) {

1013 
p
 +ğ
	`¥rštf
(p, "%c",

1014 (
x
 =ğ
od¡
->
cu¼’t_¿‹
) ? 'T' : ' ');

1016 
p
 +ğ
	`¥rštf
(p, "%c",

1017 (
x
 =ğ
od¡
->
max__¿‹2
) ? 't' : ' ');

1019 
p
 +ğ
	`¥rštf
(p, "%c",

1020 (
x
 =ğ
od¡
->
max_´ob_¿‹
) ? 'P' : ' ');

1022 
p
 +ğ
	`¥rštf
(p, " %2u%s",

1023 
od¡
->
¿‹s
[
x
].
¿‹
 / 2,

1024 (
od¡
->
¿‹s
[
x
].
¿‹
 & 0x1) != 0 ?

1027 
this_
 = ((
od¡
->
rs_this_
[
x
] / 18000) * 96) >> 10;

1028 
this_´ob
 = 
od¡
->
rs_thi¥rob
[
x
] / 18;

1029 
this_•rob
 = 
od¡
->
rs_´obab™y
[
x
] / 18;

1030 
p
 +ğ
	`¥rštf
(p, " %2u.%1u %2u.%1u %6u.%1u"

1032 
this_
 / 10,his_tp % 10,

1033 
this_•rob
 / 10,his_eprob % 10,

1034 
this_´ob
 / 10,his_prob % 10,

1035 
od¡
->
rs_Ï¡¿‹sucûss
[
x
],

1036 
od¡
->
rs_Ï¡¿‹©‹m±s
[
x
],

1037 ()
od¡
->
rs_succ_hi¡
[
x
],

1038 ()
od¡
->
rs_©t_hi¡
[
x
]);

1040 
p
 +ğ
	`¥rštf
(p, "\n");

1042 
p
 +ğ
	`¥rštf
(p, "Total…acket count:: ideal %d "

1044 
od¡
->
·ck‘_couÁ
, od¡->
§m¶e_couÁ
);

1046 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1048  (
p
 - 
buf
);

1049 
	}
}

1052 
	$©h_´oc_¿‹§m¶e_İ’
(
šode
 *šode, 
fe
 *file)

1054 
´oc_›“80211_´iv
 *
pv
 = 
NULL
;

1055 
´oc_dœ_’Œy
 *
dp
 = 
	`PDE
(
šode
);

1056 
›“80211v­
 *
v­
 = 
dp
->
d©a
;

1058 ià(!(
fe
->
´iv©e_d©a
 = 
	`kz®loc
((
´oc_›“80211_´iv
),

1059 
GFP_KERNEL
)))

1060  -
ENOMEM
;

1063 
pv
 = (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

1064 
pv
->
rbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

1065 ià(!
pv
->
rbuf
) {

1066 
	`kä“
(
pv
);

1067  -
ENOMEM
;

1069 
pv
->
wbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

1070 ià(!
pv
->
wbuf
) {

1071 
	`vä“
(
pv
->
rbuf
);

1072 
	`kä“
(
pv
);

1073  -
ENOMEM
;

1076 
	`mem£t
(
pv
->
wbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

1077 
	`mem£t
(
pv
->
rbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

1078 
pv
->
max_wËn
 = 
MAX_PROC_IEEE80211_SIZE
;

1079 
pv
->
max_¾’
 = 
MAX_PROC_IEEE80211_SIZE
;

1082 
pv
->
¾’
 = 
	`©h_´oc_»ad_nodes
(
v­
,…v->
rbuf
, 
MAX_PROC_IEEE80211_SIZE
);

1084 
	}
}

1086 
fe_İ”©iÚs
 
	g©h_´oc_¿‹§m¶e_İs
 = {

1087 .
»ad
 = 
NULL
,

1088 .
	gwr™e
 = 
NULL
,

1089 .
	gİ’
 = 
©h_´oc_¿‹§m¶e_İ’
,

1090 .
	g»Ëa£
 = 
NULL
,

1094 
	$©h_¿‹_dyÇmic_´oc_»gi¡”
(
›“80211v­
 *
v­
)

1097 
	`›“80211_´oc_vü—‹
(
v­
, &
©h_´oc_¿‹§m¶e_İs
, "rate_info");

1098 
	}
}

1102 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

1103 .
¿‹ùl_id
 = 
IEEE80211_RATE_MINSTREL
,

1104 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

1105 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

1106 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

1107 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

1108 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

1109 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

1110 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

1111 .
	g©ch
 = 
©h_¿‹_©ch
,

1112 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

1113 .
	gdyÇmic_´oc_»gi¡”
 = 
©h_¿‹_dyÇmic_´oc_»gi¡”
,

1116 
MODULE_AUTHOR
("John Bicket/Derek Smithies");

1117 
MODULE_DESCRIPTION
("Minstrel Rate bit-rate selection‡lgorithm for Atheros devices");

1118 #ifdeà
MODULE_VERSION


1119 
MODULE_VERSION
(
RELEASE_VERSION
);

1121 #ifdeà
MODULE_LICENSE


1122 
MODULE_LICENSE
("Dual BSD/GPL");

1125 
__š™
 
	$©h_¿‹_mš¡»l_š™
()

1129 
	`´štk
(
KERN_INFO
 "%s:†ook‡round„ate seto %d%%\n",

1130 
dev_šfo
, 
©h_look¬ound_¿‹
);

1131 
	`´štk
(
KERN_INFO
 "%s: EWMA„olloff†evel seto %d%%\n",

1132 
dev_šfo
, 
©h_ewma_Ëv–
);

1133 
	`´štk
(
KERN_INFO
 "%s: max segment size inhe MRR set "

1134 "tØ%d us\n", 
dev_šfo
, 
©h_£gm’t_size
);

1136  
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

1137 
	}
}

1138 
moduË_š™
(
©h_¿‹_mš¡»l_š™
);

1140 
__ex™
 
	$©h_¿‹_mš¡»l_ex™
()

1142 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

1143 
	}
}

1144 
moduË_ex™
(
©h_¿‹_mš¡»l_ex™
);

	@minstrel/minstrel.h

68 #iâdeà
_DEV_ATH_RATE_MINSTREL_H


69 
	#_DEV_ATH_RATE_MINSTREL_H


	)

70 
	#MINSTREL_COLUMNS
 10

	)

73 
	smš¡»l_soác
 {

74 
©h_¿‹ù¾
 
	m¬c
;

76 #ifdeà
CONFIG_SYSCTL


77 
ùl_bË_h—d”
 *
	msysùl_h—d”
;

78 
ùl_bË
 *
	msysùls
;

80 
©h_soác
 *
	msc
;

81 
Ãt_deviû
 *
	msc_dev
;

84 
tim”_li¡
 
	mtim”
;

85 
	mşo£_tim”_now
;

89 
	#ATH_SOFTC_MINSTREL
(
sc
è((
mš¡»l_soác
 *)sc->
sc_rc
)

	)

91 
	s¿‹_šfo
 {

92 
	m¿‹
;

93 
	mrix
;

94 
	m¿‹Code
;

95 
	mshÜtP»ambËR©eCode
;

101 
	smš¡»l_node
 {

103 
	mmn_·ck‘_couÁ
;

104 
	mŞd_tx¿‹
;

106 
	m¡©ic_¿‹_ndx
;

107 
	mnum_¿‹s
;

108 
¿‹_šfo
 
	m¿‹s
[
IEEE80211_RATE_MAXSIZE
];

110 
	m³rãù_tx_time
[
IEEE80211_RATE_MAXSIZE
];

111 
	m»Œy_couÁ
[
IEEE80211_RATE_MAXSIZE
];

112 
	m»Œy_adju¡ed_couÁ
[
IEEE80211_RATE_MAXSIZE
];

113 
	mcu¼’t_¿‹
;

115 
u_št32_t
 
	mrs_¿‹©‹m±s
[
IEEE80211_RATE_MAXSIZE
];

116 
u_št32_t
 
	mrs_thi¥rob
 [
IEEE80211_RATE_MAXSIZE
];

117 
u_št32_t
 
	mrs_¿‹sucûss
 [
IEEE80211_RATE_MAXSIZE
];

118 
u_št32_t
 
	mrs_Ï¡¿‹©‹m±s
[
IEEE80211_RATE_MAXSIZE
];

119 
u_št32_t
 
	mrs_Ï¡¿‹sucûss
 [
IEEE80211_RATE_MAXSIZE
];

120 
u_št32_t
 
	mrs_´obab™y
 [
IEEE80211_RATE_MAXSIZE
];

121 
u_št64_t
 
	mrs_succ_hi¡
 [
IEEE80211_RATE_MAXSIZE
];

122 
u_št64_t
 
	mrs_©t_hi¡
 [
IEEE80211_RATE_MAXSIZE
];

124 
u_št32_t
 
	mrs_this_
 [
IEEE80211_RATE_MAXSIZE
];

128 
	mis_§m¶šg
;

133 
	mrs_§m¶e_¿‹
;

138 
	mrs_§m¶e_¿‹_¦ow”
;

143 
	mmax__¿‹
;

144 
	mmax__¿‹2
;

145 
	mmax_´ob_¿‹
;

153 
	m·ck‘_couÁ
;

155 
	m§m¶e_couÁ
;

163 
u_št8_t
 
	mrs_§m¶eTabË
[
IEEE80211_RATE_MAXSIZE
][
MINSTREL_COLUMNS
];

164 
	mrs_§m¶eCŞumn
;

165 
	mrs_§m¶eIndex
;

172 
	m¿ndom_n
;

173 
	ma
, 
	mb
;

177 
	#ATH_NODE_MINSTREL
(
ª
è((
mš¡»l_node
 *)&ª[1])

	)

180 #iâdeà
MIN


181 
	#MIN
(
a
,
b
è(×è< (bè? (aè: (b))

	)

183 #iâdeà
MAX


184 
	#MAX
(
a
,
b
è(×è> (bè? (aè: (b))

	)

193 
	#ds_ùl2
 
ds_hw
[0]

	)

194 
	#ds_ùl3
 
ds_hw
[1]

	)

197 
	#AR_Xm™D©aTr›s0
 0x000f0000

	)

198 
	#AR_Xm™D©aTr›s0_S
 16

	)

199 
	#AR_Xm™D©aTr›s1
 0x00f00000

	)

200 
	#AR_Xm™D©aTr›s1_S
 20

	)

201 
	#AR_Xm™D©aTr›s2
 0x0f000000

	)

202 
	#AR_Xm™D©aTr›s2_S
 24

	)

203 
	#AR_Xm™D©aTr›s3
 0xf0000000

	)

204 
	#AR_Xm™D©aTr›s3_S
 28

	)

207 
	#AR_Xm™R©e0
 0x0000001à

	)

208 
	#AR_Xm™R©e0_S
 0

	)

209 
	#AR_Xm™R©e1
 0x000003e0

	)

210 
	#AR_Xm™R©e1_S
 5

	)

211 
	#AR_Xm™R©e2
 0x00007c00

	)

212 
	#AR_Xm™R©e2_S
 10

	)

213 
	#AR_Xm™R©e3
 0x000f8000

	)

214 
	#AR_Xm™R©e3_S
 15

	)

216 
	#MS
(
_v
, 
_f
è(((_vè& (_f)è>> _f##
_S
)

	)

	@onoe/ath_rate_onoe.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

37 cÚ¡ 
	g__moduË_d•’ds
[]

38 
__©Œibu‹_u£d__


39 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

43 
MODULE_INFO
(
¤cv”siÚ
, "9F14E0BE80CBF2492B19B90");

	@onoe/onoe.c

42 #iâdeà
AUTOCONF_INCLUDED


43 
	~<lšux/cÚfig.h
>

45 
	~<lšux/v”siÚ.h
>

46 
	~<lšux/moduË.h
>

47 
	~<lšux/š™.h
>

48 
	~<lšux/skbuff.h
>

49 
	~<lšux/Ãtdeviû.h
>

50 
	~<lšux/¿ndom.h
>

51 
	~<lšux/d–ay.h
>

52 
	~<lšux/ÿche.h
>

53 
	~<lšux/sysùl.h
>

54 
	~<lšux/´oc_fs.h
>

55 
	~<lšux/if_¬p.h
>

57 
	~<asm/uacûss.h
>

59 
	~<Ãt80211/if_medŸ.h
>

60 
	~<Ãt80211/›“80211_v¬.h
>

61 
	~<Ãt80211/›“80211_¿‹.h
>

63 
	~"if_©hv¬.h
"

64 
	~"if_©h_h®.h
"

65 
	~"ah_desc.h
"

67 
	~"ÚÛ.h
"

69 
	#ONOE_DEBUG


	)

70 #ifdeà
ONOE_DEBUG


72 
	mATH_DEBUG_RATE
 = 0x00000010,

74 
	#DEBUG
 0

	)

75 
	#DEBUG2
 1

	)

76 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

77 ià(
DEBUG
) \

78 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

79 } 0)

	)

81 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

103 
	g©h_¿‹š‹rv®
 = 1000;

104 
	g©h_¿‹_¿i£
 = 10;

105 
	g©h_¿‹_¿i£_th»shŞd
 = 10;

107 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

108 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

109 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

110 
boŞ
 
	gfœ¡_time
 = 
Œue
;

112 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

115 
ÚÛ_node
* 
Ú
 = 
	`ATH_NODE_ONOE
(
ª
);

116 
›“80211_node
* 
ni
 = &
ª
->
ª_node
;

117 
i
 ;

118 iàĞ
fœ¡_time
 ){

123 
¡©s
[0].
¿‹
 = 1;

124 
¡©s
[1].
¿‹
 = 2;

125 
¡©s
[2].
¿‹
 = 5;

126 
¡©s
[3].
¿‹
 = 6;

127 
¡©s
[4].
¿‹
 = 9;

128 
¡©s
[5].
¿‹
 = 11;

129 
¡©s
[6].
¿‹
 = 12;

130 
¡©s
[7].
¿‹
 = 18;

131 
¡©s
[8].
¿‹
 = 24;

132 
¡©s
[9].
¿‹
 = 36;

133 
¡©s
[10].
¿‹
 = 48;

134 
¡©s
[11].
¿‹
 = 54;

138  
i
 = 0 ; i < 
MAX_NUM_RATE
 ; ++i){

141 
¡©s
[
i
].
couÁ
 = 0 ;

147 
Ú
->
tx_·ck‘_couÁ
 = 0 ;

148 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

149 ià(
DEBUG2
){

150 iàĞ
fœ¡_time
 ){

152 
	`´štk
(
MAC_FMT
 " onÛ_š™ : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

153 
Ú
->
Şd_tx¿‹
 = 
ni
->
ni_tx¿‹
;

154 
fœ¡_time
 = 
çl£
;

157 
	}
}

160 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

162 
	}
}

165 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

166 
shÜtP»ambË
, 
size_t
 
äameL’
,

167 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

169 
ÚÛ_node
 *
Ú
 = 
	`ATH_NODE_ONOE
(
ª
);

171 *
rix
 = 
Ú
->
Ú_tx_rix0
;

172 *
Œy0
 = 
Ú
->
Ú_tx_Œy0
;

173 ià(
shÜtP»ambË
)

174 *
tx¿‹
 = 
Ú
->
Ú_tx_¿‹0¥
;

176 *
tx¿‹
 = 
Ú
->
Ú_tx_¿‹0
;

177 
	}
}

180 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

181 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

183 
ÚÛ_node
 *
Ú
 = 
	`ATH_NODE_ONOE
(
ª
);

185 
m¼
->
¿‹1
 = 
Ú
->
Ú_tx_¿‹1¥
;

186 
m¼
->
»Œ›s1
 = 2;

187 
m¼
->
¿‹2
 = 
Ú
->
Ú_tx_¿‹2¥
;

188 
m¼
->
»Œ›s2
 = 2;

189 
m¼
->
¿‹3
 = 
Ú
->
Ú_tx_¿‹3¥
;

190 
m¼
->
»Œ›s3
 = 2;

191 
	}
}

194 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

195 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

197 
ÚÛ_node
 *
Ú
 = 
	`ATH_NODE_ONOE
(
ª
);

198 
›“80211_node
 *
ni
 = &
ª
->
ª_node
;

199 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

201 ià(
ts
->
ts_¡©us
 == 0)

202 
Ú
->
Ú_tx_ok
++;

204 
Ú
->
Ú_tx_”r
++;

206 
Ú
->
tx_·ck‘_couÁ
++;

208 
Ú
->
Ú_tx_»Œ
 +ğ
ts
->
ts_shÜŒ‘ry


209 + 
ts
->
ts_lÚg»Œy
;

210 ià(
	`time_aá”_eq
(
jiff›s
, 
Ú
->
Ú_Ãxtcheck
)) {

211 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

213 
Ú
->
Ú_Ãxtcheck
 = 
jiff›s
 + (
©h_¿‹š‹rv®
 * 
HZ
) / 1000;

217 ià(
DEBUG2
){

218 iàĞ
Ú
->
Şd_tx¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

219 
	`´štk
("ÚÛ: " 
MAC_FMT
 " : ",

220 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

221 
	`´štk
("x_rate: %d,x_count: %d\n",

222 
¡©s
[
ni
->
ni_tx¿‹
].
¿‹
, 
Ú
->
tx_·ck‘_couÁ
 );

223 
Ú
->
Şd_tx¿‹
 = 
ni
->
ni_tx¿‹
 ;

227 
	}
}

230 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

232 ià(
i¢ew
)

233 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

234 
	}
}

237 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

239 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

240 
ÚÛ_node
 *
Ú
 = 
	`ATH_NODE_ONOE
(
ª
);

241 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

242 
u_št8_t
 
rix
;

244 
	`KASSERT
(
¹
 !ğ
NULL
, ("nØ¿‹abË, mod%u", 
sc
->
sc_curmode
));

246 
	`DPRINTF
(
sc
, "%s: s‘ xm™„©fÜ " 
MAC_FMT
 "o %dM\n",

247 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

248 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

249 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

251 
ni
->
ni_tx¿‹
 = 
¿‹
;

259 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 == 0)

260 
dÚe
;

261 
Ú
->
Ú_tx_rix0
 = 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

262 
Ú
->
Ú_tx_¿‹0
 = 
¹
->
šfo
[Ú->
Ú_tx_rix0
].
¿‹Code
;

264 
Ú
->
Ú_tx_¿‹0¥
 = on->
Ú_tx_¿‹0
 |

265 
¹
->
šfo
[
Ú
->
Ú_tx_rix0
].
shÜtP»ambË
;

266 ià(
sc
->
sc_m¼‘ry
) {

274 
Ú
->
Ú_tx_Œy0
 = 1 + 3;

275 ià(--
¿‹
 >= 0) {

276 
rix
 = 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

277 
Ú
->
Ú_tx_¿‹1
 = 
¹
->
šfo
[
rix
].
¿‹Code
;

278 
Ú
->
Ú_tx_¿‹1¥
 = on->
Ú_tx_¿‹1
 |

279 
¹
->
šfo
[
rix
].
shÜtP»ambË
;

281 
Ú
->
Ú_tx_¿‹1
 = on->
Ú_tx_¿‹1¥
 = 0;

282 ià(--
¿‹
 >= 0) {

283 
rix
 = 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

284 
Ú
->
Ú_tx_¿‹2
 = 
¹
->
šfo
[
rix
].
¿‹Code
;

285 
Ú
->
Ú_tx_¿‹2¥
 = on->
Ú_tx_¿‹2
 |

286 
¹
->
šfo
[
rix
].
shÜtP»ambË
;

288 
Ú
->
Ú_tx_¿‹2
 = on->
Ú_tx_¿‹2¥
 = 0;

289 ià(
¿‹
 > 0) {

291 
Ú
->
Ú_tx_¿‹3
 = 
¹
->
šfo
[0].
¿‹Code
;

292 
Ú
->
Ú_tx_¿‹3¥
 =

293 
Ú
->
Ú_tx_¿‹3
 | 
¹
->
šfo
[0].
shÜtP»ambË
;

295 
Ú
->
Ú_tx_¿‹3
 = on->
Ú_tx_¿‹3¥
 = 0;

297 
Ú
->
Ú_tx_Œy0
 = 
ATH_TXMAXTRY
;

298 
Ú
->
Ú_tx_¿‹1
 = on->
Ú_tx_¿‹1¥
 = 0;

299 
Ú
->
Ú_tx_¿‹2
 = on->
Ú_tx_¿‹2¥
 = 0;

300 
Ú
->
Ú_tx_¿‹3
 = on->
Ú_tx_¿‹3¥
 = 0;

302 
dÚe
:

303 
Ú
->
Ú_tx_ok
 = on->
Ú_tx_”r
 = on->
Ú_tx_»Œ
 = on->
Ú_tx_uµ”
 = 0;

305 
	}
}

311 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

313 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

314 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

315 
¤©e
;

317 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("no„ates"));

318 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

324 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

325 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

331 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

332 
	`KASSERT
(
¤©e
 >= 0, ("bogus„ate set"));

343 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

344 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

345 
	`KASSERT
(
¤©e
 >= 0,

346 ("fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

348 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

349 #undeà
RATE


350 
	}
}

353 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

355 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

356 
	}
}

362 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

364 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

365 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

366 
›“80211_node
 *
ni
;

368 ià(
¡©e
 =ğ
IEEE80211_S_INIT
)

370 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

375 
ni
 = 
v­
->
iv_bss
;

376 ià(
¡©e
 =ğ
IEEE80211_S_RUN
) {

377 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

379 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

388 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

389 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

391 
	}
}

397 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

399 
©h_soác
 *
sc
 = 
¬g
;

400 
ÚÛ_node
 *
Ú
 = 
	`ATH_NODE_ONOE
(
	`ATH_NODE
(
ni
));

401 
›“80211_¿‹£t
 *
rs
 = &
ni
->
ni_¿‹s
;

402 
dœ
 = 0, 
Ä©e
, 
’ough
;

404 
sc
->
sc_¡©s
.
a¡_¿‹_ÿÎs
++;

410 
’ough
 = (
Ú
->
Ú_tx_ok
 + on->
Ú_tx_”r
 >= 10);

413 ià(
Ú
->
Ú_tx_”r
 > 0 && on->
Ú_tx_ok
 == 0)

414 
dœ
 = -1;

417 ià(
’ough
 && 
Ú
->
Ú_tx_ok
 < on->
Ú_tx_»Œ
)

418 
dœ
 = -1;

421 ià(
’ough
 && 
Ú
->
Ú_tx_”r
 == 0 &&

422 
Ú
->
Ú_tx_»Œ
 < (Ú->
Ú_tx_ok
 * 
©h_¿‹_¿i£
) / 100)

423 
dœ
 = 1;

425 
	`DPRINTF
(
sc
, 
MAC_FMT
 ": ok %dƒrr %d„etr %d upper %d dir %d\n",

426 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

427 
Ú
->
Ú_tx_ok
, on->
Ú_tx_”r
, on->
Ú_tx_»Œ
,

428 
Ú
->
Ú_tx_uµ”
, 
dœ
);

430 
Ä©e
 = 
ni
->
ni_tx¿‹
;

431 
dœ
) {

433 ià(
’ough
 && 
Ú
->
Ú_tx_uµ”
 > 0)

434 
Ú
->
Ú_tx_uµ”
--;

437 ià(
Ä©e
 > 0) {

438 
Ä©e
--;

439 
sc
->
sc_¡©s
.
a¡_¿‹_drİ
++;

441 
Ú
->
Ú_tx_uµ”
 = 0;

445 ià(++
Ú
->
Ú_tx_uµ”
 < 
©h_¿‹_¿i£_th»shŞd
)

447 
Ú
->
Ú_tx_uµ”
 = 0;

448 ià(
Ä©e
 + 1 < 
rs
->
rs_Ä©es
) {

449 
Ä©e
++;

450 
sc
->
sc_¡©s
.
a¡_¿‹_¿i£
++;

455 ià(
Ä©e
 !ğ
ni
->
ni_tx¿‹
) {

456 
	`DPRINTF
(
sc
, "%s: %dM -> %dM (%d ok, %dƒrr, %d„etr)\n",

457 
__func__
,

458 (
rs
->
rs_¿‹s
[
ni
->
ni_tx¿‹
] & 
IEEE80211_RATE_VAL
) / 2,

459 (
rs
->
rs_¿‹s
[
Ä©e
] & 
IEEE80211_RATE_VAL
) / 2,

460 
Ú
->
Ú_tx_ok
, on->
Ú_tx_”r
, on->
Ú_tx_»Œ
);

461 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
Ä©e
);

462 } ià(
’ough
)

463 
Ú
->
Ú_tx_ok
 = on->
Ú_tx_”r
 = on->
Ú_tx_»Œ
 = 0;

464 
	}
}

466 
©h_¿‹ù¾
 *

467 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

469 
ÚÛ_soác
 *
osc
;

471 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

472 
osc
 = 
	`km®loc
((
ÚÛ_soác
), 
GFP_ATOMIC
);

473 ià(
osc
 =ğ
NULL
) {

474 
	`_MOD_DEC_USE
(
THIS_MODULE
);

475  
NULL
;

477 
osc
->
¬c
.
¬c_¥aû
 = (
ÚÛ_node
);

478 
osc
->
¬c
.
¬c_v­_¥aû
 = 0;

480  &
osc
->
¬c
;

481 
	}
}

484 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

486 
ÚÛ_soác
 *
osc
 = (ÚÛ_soáø*)
¬c
;

488 
	`kä“
(
osc
);

489 
	`_MOD_DEC_USE
(
THIS_MODULE
);

490 
	}
}

492 
	gmš¿‹š‹rv®
 = 500;

493 
	gmax³rûÁ
 = 100;

494 
	gmš³rûÁ
 = 0;

495 
	gmaxšt
 = 0x7fffffff;

500 
ùl_bË
 
	g©h_¿‹_¡©ic_sysùls
[] = {

501 { .
ùl_Çme
 = 
CTL_AUTO
,

502 .
	g´oúame
 = "interval",

503 .
	gmode
 = 0644,

504 .
	gd©a
 = &
©h_¿‹š‹rv®
,

505 .
	gmaxËn
 = (
©h_¿‹š‹rv®
),

506 .
	gexŒa1
 = &
mš¿‹š‹rv®
,

507 .
	gexŒa2
 = &
maxšt
,

508 .
	g´oc_hªdËr
 = 
´oc_doštvec_mšmax


510 { .
	gùl_Çme
 = 
CTL_AUTO
,

511 .
	g´oúame
 = "raise",

512 .
	gmode
 = 0644,

513 .
	gd©a
 = &
©h_¿‹_¿i£
,

514 .
	gmaxËn
 = (
©h_¿‹_¿i£
),

515 .
	gexŒa1
 = &
mš³rûÁ
,

516 .
	gexŒa2
 = &
max³rûÁ
,

517 .
	g´oc_hªdËr
 = 
´oc_doštvec_mšmax


519 { .
	gùl_Çme
 = 
CTL_AUTO
,

520 .
	g´oúame
 = "raise_threshold",

521 .
	gmode
 = 0644,

522 .
	gd©a
 = &
©h_¿‹_¿i£_th»shŞd
,

523 .
	gmaxËn
 = (
©h_¿‹_¿i£_th»shŞd
),

524 .
	g´oc_hªdËr
 = 
´oc_doštvec


528 
ùl_bË
 
	g©h_¿‹_bË
[] = {

529 { .
ùl_Çme
 = 
CTL_AUTO
,

530 .
	g´oúame
 = "rate_onoe",

531 .
	gmode
 = 0555,

532 .
	gchd
 = 
©h_¿‹_¡©ic_sysùls


535 
ùl_bË
 
	g©h_©h_bË
[] = {

536 { .
ùl_Çme
 = 
DEV_ATH
,

537 .
	g´oúame
 = "ath",

538 .
	gmode
 = 0555,

539 .
	gchd
 = 
©h_¿‹_bË


542 
ùl_bË
 
	g©h_roÙ_bË
[] = {

543 { .
ùl_Çme
 = 
CTL_DEV
,

544 .
	g´oúame
 = "dev",

545 .
	gmode
 = 0555,

546 .
	gchd
 = 
©h_©h_bË


549 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

551 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

552 .
¿‹ùl_id
 = 
IEEE80211_RATE_ONOE
,

553 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

554 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

555 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

556 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

557 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

558 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

559 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

560 .
	g©ch
 = 
©h_¿‹_©ch
,

561 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

564 
	~"»Ëa£.h
"

566 *
	gv”siÚ
 = "1.0 (" 
RELEASE_VERSION
 ")";

567 *
	gdev_šfo
 = "ath_rate_onoe";

570 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

571 
MODULE_DESCRIPTION
("Atsushi Onoe's„ate control‡lgorithm for Atheros devices");

572 #ifdeà
MODULE_VERSION


573 
MODULE_VERSION
(
RELEASE_VERSION
);

575 #ifdeà
MODULE_LICENSE


576 
MODULE_LICENSE
("Dual BSD/GPL");

579 
__š™


580 
	$š™_©h_¿‹_ÚÛ
()

582 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

583 ià(
»t
)

584  
»t
;

586 
©h_sysùl_h—d”
 = 
	`ATH_REGISTER_SYSCTL_TABLE
(
©h_roÙ_bË
);

588 
	}
}

589 
moduË_š™
(
š™_©h_¿‹_ÚÛ
);

591 
__ex™


592 
	$ex™_©h_¿‹_ÚÛ
()

594 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

595 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

596 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

597 
	}
}

598 
moduË_ex™
(
ex™_©h_¿‹_ÚÛ
);

	@onoe/onoe.h

42 #iâdeà
_DEV_ATH_RATE_ONOE_H


43 
	#_DEV_ATH_RATE_ONOE_H


	)

45 
	#MAX_NUM_RATE
 12

	)

47 
	sÚÛ_soác
 {

48 
©h_¿‹ù¾
 
	m¬c
;

52 
	sÚÛ_¡©s
{

53 
u_št
 
	m¿‹
;

54 
u_št
 
	mcouÁ
;

57 
ÚÛ_¡©s
 
	g¡©s
[
MAX_NUM_RATE
];

60 
	sÚÛ_node
 {

61 
	mŞd_tx¿‹
 ;

63 
	mtx_·ck‘_couÁ
;

65 
u_št
 
	mÚ_tx_ok
;

66 
u_št
 
	mÚ_tx_”r
;

67 
u_št
 
	mÚ_tx_»Œ
;

68 
	mÚ_tx_uµ”
;

69 
u_št8_t
 
	mÚ_tx_rix0
;

70 
u_št8_t
 
	mÚ_tx_Œy0
;

71 
u_št8_t
 
	mÚ_tx_¿‹0
;

72 
u_št8_t
 
	mÚ_tx_¿‹1
;

73 
u_št8_t
 
	mÚ_tx_¿‹2
;

74 
u_št8_t
 
	mÚ_tx_¿‹3
;

75 
u_št8_t
 
	mÚ_tx_¿‹0¥
;

76 
u_št8_t
 
	mÚ_tx_¿‹1¥
;

77 
u_št8_t
 
	mÚ_tx_¿‹2¥
;

78 
u_št8_t
 
	mÚ_tx_¿‹3¥
;

79 
	mÚ_Ãxtcheck
;

81 
	#ATH_NODE_ONOE
(
ª
è((
ÚÛ_node
 *)&ª[1])

	)

	@rraa/ath_rate_rraa.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "FC676813BE66D631674601A");

	@rraa/rraa.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 50;

81 
¼¯_m­
[1].
pÜi
 = 50;

82 
¼¯_m­
[2].
pÜi
 = 50;

83 
¼¯_m­
[3].
pÜi
 = 50;

84 
¼¯_m­
[4].
pÜi
 = 14;

85 
¼¯_m­
[5].
pÜi
 = 16;

86 
¼¯_m­
[6].
pÜi
 = 19;

87 
¼¯_m­
[7].
pÜi
 = 13;

88 
¼¯_m­
[8].
pÜi
 = 17;

89 
¼¯_m­
[9].
pÜi
 = 12;

90 
¼¯_m­
[10].
pÜi
 = 5;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 39;

95 
¼¯_m­
[1].
pm
 = 39;

96 
¼¯_m­
[2].
pm
 = 39;

97 
¼¯_m­
[3].
pm
 = 39;

98 
¼¯_m­
[4].
pm
 = 39;

99 
¼¯_m­
[5].
pm
 = 32;

100 
¼¯_m­
[6].
pm
 = 29;

101 
¼¯_m­
[7].
pm
 = 37;

102 
¼¯_m­
[8].
pm
 = 27;

103 
¼¯_m­
[9].
pm
 = 34;

104 
¼¯_m­
[10].
pm
 = 23;

105 
¼¯_m­
[11].
pm
 = 9;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

378 
	`DPRINTF
(
sc
, "¼¯: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

379 
	`DPRINTF
(
sc
,

381 
¼¯
->
¼¯_tx_couÁ
,

382 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

383 
¼¯
->
¼¯_loss_¿tio
,

384 
¼¯
->
¼¯_couÁ”
);

389 
	}
}

391 
©h_¿‹ù¾
 *

392 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

395 
¼¯_soác
 *
asc
;

397 ià(
DEBUG
){

398 
	`´štk
("rraa:his ishe‚ew„raa module!\n");

401 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

402 
asc
 = 
	`km®loc
((
¼¯_soác
), 
GFP_ATOMIC
);

403 ià(
asc
 =ğ
NULL
) {

404 
	`_MOD_DEC_USE
(
THIS_MODULE
);

405  
NULL
;

407 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_node
);

408 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

410  &
asc
->
¬c
;

411 
	}
}

414 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

416 
¼¯_soác
 *
asc
 = (¼¯_soáø*)
¬c
;

417 
	`kä“
(
asc
);

418 
	`_MOD_DEC_USE
(
THIS_MODULE
);

419 
	}
}

421 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

423 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

424 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAA
,

425 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

426 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

427 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

428 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

429 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

430 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

431 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

432 .
	g©ch
 = 
©h_¿‹_©ch
,

433 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

436 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

438 
	~"»Ëa£.h
"

440 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

441 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

442 #ifdeà
MODULE_VERSION


443 
MODULE_VERSION
(
RELEASE_VERSION
);

445 #ifdeà
MODULE_LICENSE


446 
MODULE_LICENSE
("Dual BSD/GPL");

449 
__š™


450 
	$š™_©h_¿‹_¼¯_soác
()

452 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

453 ià(
»t
)

454  
»t
;

456 
	}
}

457 
moduË_š™
(
š™_©h_¿‹_¼¯_soác
);

459 
__ex™


460 
	$ex™_©h_¿‹_¼¯_soác
()

462 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

463 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

464 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

465 
	}
}

466 
moduË_ex™
(
ex™_©h_¿‹_¼¯_soác
);

	@rraa/rraa.h

11 #iâdeà
_DEV_ATH_RATE_RRAA_H


12 
	#_DEV_ATH_RATE_RRAA_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_node
 *)&ª[1])

	)

63 
	#ATH_NODE_RRAA
(
ª
è((
¼¯_node
 *)&ª[1])

	)

	@rraac1/ath_rate_rraac1.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

30 cÚ¡ 
	g__moduË_d•’ds
[]

31 
__©Œibu‹_u£d__


32 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

36 
MODULE_INFO
(
¤cv”siÚ
, "6D2A01157B91C8F60AC7E1D");

	@rraac1/rraac1.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c1.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_c1_node
 *
¼¯
 = 
	`ATH_NODE_C1_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 38;

81 
¼¯_m­
[1].
pÜi
 = 38;

82 
¼¯_m­
[2].
pÜi
 = 38;

83 
¼¯_m­
[3].
pÜi
 = 38;

84 
¼¯_m­
[4].
pÜi
 = 11;

85 
¼¯_m­
[5].
pÜi
 = 12;

86 
¼¯_m­
[6].
pÜi
 = 14;

87 
¼¯_m­
[7].
pÜi
 = 10;

88 
¼¯_m­
[8].
pÜi
 = 13;

89 
¼¯_m­
[9].
pÜi
 = 9;

90 
¼¯_m­
[10].
pÜi
 = 4;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 39;

95 
¼¯_m­
[1].
pm
 = 39;

96 
¼¯_m­
[2].
pm
 = 39;

97 
¼¯_m­
[3].
pm
 = 39;

98 
¼¯_m­
[4].
pm
 = 39;

99 
¼¯_m­
[5].
pm
 = 32;

100 
¼¯_m­
[6].
pm
 = 29;

101 
¼¯_m­
[7].
pm
 = 37;

102 
¼¯_m­
[8].
pm
 = 27;

103 
¼¯_m­
[9].
pm
 = 34;

104 
¼¯_m­
[10].
pm
 = 23;

105 
¼¯_m­
[11].
pm
 = 9;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_c1_node
 *
¼¯
 = 
	`ATH_NODE_C1_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_c1_node
 *
¼¯
 = 
	`ATH_NODE_C1_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_c1_node
 *
¼¯
 = 
	`ATH_NODE_C1_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_c1_node
 *
¼¯
 = 
	`ATH_NODE_C1_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

379 
	`DPRINTF
(
sc
, "¼¯c1: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

390 
	}
}

392 
©h_¿‹ù¾
 *

393 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

396 
¼¯_c1_soác
 *
asc
;

398 ià(
DEBUG
){

399 
	`´štk
("rraa:his ishe‚ew„raa module!\n");

402 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

403 
asc
 = 
	`km®loc
((
¼¯_c1_soác
), 
GFP_ATOMIC
);

404 ià(
asc
 =ğ
NULL
) {

405 
	`_MOD_DEC_USE
(
THIS_MODULE
);

406  
NULL
;

408 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_c1_node
);

409 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

411  &
asc
->
¬c
;

412 
	}
}

415 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

417 
¼¯_c1_soác
 *
asc
 = (¼¯_c1_soáø*)
¬c
;

418 
	`kä“
(
asc
);

419 
	`_MOD_DEC_USE
(
THIS_MODULE
);

420 
	}
}

422 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

424 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

425 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC1
,

426 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

427 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

428 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

429 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

430 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

431 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

432 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

433 .
	g©ch
 = 
©h_¿‹_©ch
,

434 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

437 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

439 
	~"»Ëa£.h
"

441 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

442 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

443 #ifdeà
MODULE_VERSION


444 
MODULE_VERSION
(
RELEASE_VERSION
);

446 #ifdeà
MODULE_LICENSE


447 
MODULE_LICENSE
("Dual BSD/GPL");

450 
__š™


451 
	$š™_©h_¿‹_¼¯_c1_soác
()

453 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

454 ià(
»t
)

455  
»t
;

457 
	}
}

458 
moduË_š™
(
š™_©h_¿‹_¼¯_c1_soác
);

460 
__ex™


461 
	$ex™_©h_¿‹_¼¯_c1_soác
()

463 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

464 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

465 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

466 
	}
}

467 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c1_soác
);

	@rraac1/rraac1.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC1_H


12 
	#_DEV_ATH_RATE_RRAAC1_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c1_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_c1_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_c1_node
 *)&ª[1])

	)

63 
	#ATH_NODE_C1_RRAA
(
ª
è((
¼¯_c1_node
 *)&ª[1])

	)

	@rraac2/ath_rate_rraac2.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "4F54BDD2BAF2DD7E745CC17");

	@rraac2/rraac2.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c2.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_c2_node
 *
¼¯
 = 
	`ATH_NODE_C2_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 50;

81 
¼¯_m­
[1].
pÜi
 = 50;

82 
¼¯_m­
[2].
pÜi
 = 50;

83 
¼¯_m­
[3].
pÜi
 = 50;

84 
¼¯_m­
[4].
pÜi
 = 14;

85 
¼¯_m­
[5].
pÜi
 = 16;

86 
¼¯_m­
[6].
pÜi
 = 19;

87 
¼¯_m­
[7].
pÜi
 = 13;

88 
¼¯_m­
[8].
pÜi
 = 17;

89 
¼¯_m­
[9].
pÜi
 = 12;

90 
¼¯_m­
[10].
pÜi
 = 5;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 29;

95 
¼¯_m­
[1].
pm
 = 29;

96 
¼¯_m­
[2].
pm
 = 29;

97 
¼¯_m­
[3].
pm
 = 29;

98 
¼¯_m­
[4].
pm
 = 29;

99 
¼¯_m­
[5].
pm
 = 24;

100 
¼¯_m­
[6].
pm
 = 22;

101 
¼¯_m­
[7].
pm
 = 28;

102 
¼¯_m­
[8].
pm
 = 20;

103 
¼¯_m­
[9].
pm
 = 26;

104 
¼¯_m­
[10].
pm
 = 17;

105 
¼¯_m­
[11].
pm
 = 7;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_c2_node
 *
¼¯
 = 
	`ATH_NODE_C2_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_c2_node
 *
¼¯
 = 
	`ATH_NODE_C2_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_c2_node
 *
¼¯
 = 
	`ATH_NODE_C2_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_c2_node
 *
¼¯
 = 
	`ATH_NODE_C2_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraac2:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

379 
	`DPRINTF
(
sc
, "¼¯c2: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

390 
	}
}

392 
©h_¿‹ù¾
 *

393 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

396 
¼¯_c2_soác
 *
asc
;

398 ià(
DEBUG
){

399 
	`´štk
("rraac2:his ishe‚ew„raac2 module!\n");

402 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

403 
asc
 = 
	`km®loc
((
¼¯_c2_soác
), 
GFP_ATOMIC
);

404 ià(
asc
 =ğ
NULL
) {

405 
	`_MOD_DEC_USE
(
THIS_MODULE
);

406  
NULL
;

408 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_c2_node
);

409 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

411  &
asc
->
¬c
;

412 
	}
}

415 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

417 
¼¯_c2_soác
 *
asc
 = (¼¯_c2_soáø*)
¬c
;

418 
	`kä“
(
asc
);

419 
	`_MOD_DEC_USE
(
THIS_MODULE
);

420 
	}
}

422 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

424 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

425 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC2
,

426 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

427 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

428 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

429 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

430 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

431 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

432 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

433 .
	g©ch
 = 
©h_¿‹_©ch
,

434 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

437 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

439 
	~"»Ëa£.h
"

441 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

442 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

443 #ifdeà
MODULE_VERSION


444 
MODULE_VERSION
(
RELEASE_VERSION
);

446 #ifdeà
MODULE_LICENSE


447 
MODULE_LICENSE
("Dual BSD/GPL");

450 
__š™


451 
	$š™_©h_¿‹_¼¯_c2_soác
()

453 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

454 ià(
»t
)

455  
»t
;

457 
	}
}

458 
moduË_š™
(
š™_©h_¿‹_¼¯_c2_soác
);

460 
__ex™


461 
	$ex™_©h_¿‹_¼¯_c2_soác
()

463 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

464 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

465 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

466 
	}
}

467 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c2_soác
);

	@rraac2/rraac2.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC2_H


12 
	#_DEV_ATH_RATE_RRAAC2_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c2_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_c2_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_c2_node
 *)&ª[1])

	)

63 
	#ATH_NODE_C2_RRAA
(
ª
è((
¼¯_c2_node
 *)&ª[1])

	)

	@rraac3/ath_rate_rraac3.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "D18497B95C415235FFA6BEF");

	@rraac3/rraac3.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c3.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 63;

81 
¼¯_m­
[1].
pÜi
 = 63;

82 
¼¯_m­
[2].
pÜi
 = 63;

83 
¼¯_m­
[3].
pÜi
 = 63;

84 
¼¯_m­
[4].
pÜi
 = 18;

85 
¼¯_m­
[5].
pÜi
 = 20;

86 
¼¯_m­
[6].
pÜi
 = 24;

87 
¼¯_m­
[7].
pÜi
 = 16;

88 
¼¯_m­
[8].
pÜi
 = 21;

89 
¼¯_m­
[9].
pÜi
 = 15;

90 
¼¯_m­
[10].
pÜi
 = 6;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 39;

95 
¼¯_m­
[1].
pm
 = 39;

96 
¼¯_m­
[2].
pm
 = 39;

97 
¼¯_m­
[3].
pm
 = 39;

98 
¼¯_m­
[4].
pm
 = 39;

99 
¼¯_m­
[5].
pm
 = 32;

100 
¼¯_m­
[6].
pm
 = 29;

101 
¼¯_m­
[7].
pm
 = 37;

102 
¼¯_m­
[8].
pm
 = 27;

103 
¼¯_m­
[9].
pm
 = 34;

104 
¼¯_m­
[10].
pm
 = 23;

105 
¼¯_m­
[11].
pm
 = 9;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_node
 *
¼¯
 = 
	`ATH_NODE_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

379 
	`DPRINTF
(
sc
, "¼¯c3: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

390 
	}
}

392 
©h_¿‹ù¾
 *

393 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

396 
¼¯_c3_soác
 *
asc
;

398 ià(
DEBUG
){

399 
	`´štk
("rraac3:his ishe‚ew„raa module!\n");

402 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

403 
asc
 = 
	`km®loc
((
¼¯_c3_soác
), 
GFP_ATOMIC
);

404 ià(
asc
 =ğ
NULL
) {

405 
	`_MOD_DEC_USE
(
THIS_MODULE
);

406  
NULL
;

408 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_node
);

409 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

411  &
asc
->
¬c
;

412 
	}
}

415 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

417 
¼¯_c3_soác
 *
asc
 = (¼¯_c3_soáø*)
¬c
;

418 
	`kä“
(
asc
);

419 
	`_MOD_DEC_USE
(
THIS_MODULE
);

420 
	}
}

422 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

424 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

425 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC3
,

426 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

427 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

428 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

429 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

430 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

431 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

432 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

433 .
	g©ch
 = 
©h_¿‹_©ch
,

434 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

437 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

439 
	~"»Ëa£.h
"

441 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

442 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

443 #ifdeà
MODULE_VERSION


444 
MODULE_VERSION
(
RELEASE_VERSION
);

446 #ifdeà
MODULE_LICENSE


447 
MODULE_LICENSE
("Dual BSD/GPL");

450 
__š™


451 
	$š™_©h_¿‹_¼¯_c3_soác
()

453 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

454 ià(
»t
)

455  
»t
;

457 
	}
}

458 
moduË_š™
(
š™_©h_¿‹_¼¯_c3_soác
);

460 
__ex™


461 
	$ex™_©h_¿‹_¼¯_c3_soác
()

463 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

464 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

465 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

466 
	}
}

467 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c3_soác
);

	@rraac3/rraac3.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC3_H


12 
	#_DEV_ATH_RATE_RRAAC3_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c3_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_node
 *)&ª[1])

	)

63 
	#ATH_NODE_RRAA
(
ª
è((
¼¯_node
 *)&ª[1])

	)

	@rraac4/ath_rate_rraac4.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "1963FA3FE640451F2B59E93");

	@rraac4/rraac4.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c4.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_c4_node
 *
¼¯
 = 
	`ATH_NODE_C4_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 50;

81 
¼¯_m­
[1].
pÜi
 = 50;

82 
¼¯_m­
[2].
pÜi
 = 50;

83 
¼¯_m­
[3].
pÜi
 = 50;

84 
¼¯_m­
[4].
pÜi
 = 14;

85 
¼¯_m­
[5].
pÜi
 = 16;

86 
¼¯_m­
[6].
pÜi
 = 19;

87 
¼¯_m­
[7].
pÜi
 = 13;

88 
¼¯_m­
[8].
pÜi
 = 17;

89 
¼¯_m­
[9].
pÜi
 = 12;

90 
¼¯_m­
[10].
pÜi
 = 5;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 49;

95 
¼¯_m­
[1].
pm
 = 49;

96 
¼¯_m­
[2].
pm
 = 49;

97 
¼¯_m­
[3].
pm
 = 49;

98 
¼¯_m­
[4].
pm
 = 49;

99 
¼¯_m­
[5].
pm
 = 40;

100 
¼¯_m­
[6].
pm
 = 36;

101 
¼¯_m­
[7].
pm
 = 46;

102 
¼¯_m­
[8].
pm
 = 34;

103 
¼¯_m­
[9].
pm
 = 43;

104 
¼¯_m­
[10].
pm
 = 29;

105 
¼¯_m­
[11].
pm
 = 11;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_c4_node
 *
¼¯
 = 
	`ATH_NODE_C4_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_c4_node
 *
¼¯
 = 
	`ATH_NODE_C4_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_c4_node
 *
¼¯
 = 
	`ATH_NODE_C4_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_c4_node
 *
¼¯
 = 
	`ATH_NODE_C4_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

379 
	`DPRINTF
(
sc
, "¼¯c4: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

391 
	}
}

393 
©h_¿‹ù¾
 *

394 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

397 
¼¯_c4_soác
 *
asc
;

399 ià(
DEBUG
){

400 
	`´štk
("rraac4:his ishe‚ew„raa module!\n");

403 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

404 
asc
 = 
	`km®loc
((
¼¯_c4_soác
), 
GFP_ATOMIC
);

405 ià(
asc
 =ğ
NULL
) {

406 
	`_MOD_DEC_USE
(
THIS_MODULE
);

407  
NULL
;

409 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_c4_node
);

410 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

412  &
asc
->
¬c
;

413 
	}
}

416 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

418 
¼¯_c4_soác
 *
asc
 = (¼¯_c4_soáø*)
¬c
;

419 
	`kä“
(
asc
);

420 
	`_MOD_DEC_USE
(
THIS_MODULE
);

421 
	}
}

423 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

425 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

426 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC4
,

427 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

428 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

429 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

430 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

431 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

432 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

433 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

434 .
	g©ch
 = 
©h_¿‹_©ch
,

435 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

438 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

440 
	~"»Ëa£.h
"

442 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

443 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

444 #ifdeà
MODULE_VERSION


445 
MODULE_VERSION
(
RELEASE_VERSION
);

447 #ifdeà
MODULE_LICENSE


448 
MODULE_LICENSE
("Dual BSD/GPL");

451 
__š™


452 
	$š™_©h_¿‹_¼¯_c4_soác
()

454 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

455 ià(
»t
)

456  
»t
;

458 
	}
}

459 
moduË_š™
(
š™_©h_¿‹_¼¯_c4_soác
);

461 
__ex™


462 
	$ex™_©h_¿‹_¼¯_c4_soác
()

464 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

465 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

466 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

467 
	}
}

468 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c4_soác
);

	@rraac4/rraac4.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC4_H


12 
	#_DEV_ATH_RATE_RRAAC4_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c4_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_c4_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_c4_node
 *)&ª[1])

	)

63 
	#ATH_NODE_C4_RRAA
(
ª
è((
¼¯_c4_node
 *)&ª[1])

	)

	@rraac5/ath_rate_rraac5.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "F61C5EDB76E83510CA761E5");

	@rraac5/rraac5.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c5.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_c5_node
 *
¼¯
 = 
	`ATH_NODE_C5_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 63;

81 
¼¯_m­
[1].
pÜi
 = 63;

82 
¼¯_m­
[2].
pÜi
 = 63;

83 
¼¯_m­
[3].
pÜi
 = 63;

84 
¼¯_m­
[4].
pÜi
 = 18;

85 
¼¯_m­
[5].
pÜi
 = 20;

86 
¼¯_m­
[6].
pÜi
 = 24;

87 
¼¯_m­
[7].
pÜi
 = 16;

88 
¼¯_m­
[8].
pÜi
 = 21;

89 
¼¯_m­
[9].
pÜi
 = 15;

90 
¼¯_m­
[10].
pÜi
 = 6;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 29;

95 
¼¯_m­
[1].
pm
 = 29;

96 
¼¯_m­
[2].
pm
 = 29;

97 
¼¯_m­
[3].
pm
 = 29;

98 
¼¯_m­
[4].
pm
 = 29;

99 
¼¯_m­
[5].
pm
 = 24;

100 
¼¯_m­
[6].
pm
 = 22;

101 
¼¯_m­
[7].
pm
 = 28;

102 
¼¯_m­
[8].
pm
 = 20;

103 
¼¯_m­
[9].
pm
 = 26;

104 
¼¯_m­
[10].
pm
 = 17;

105 
¼¯_m­
[11].
pm
 = 7;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_c5_node
 *
¼¯
 = 
	`ATH_NODE_C5_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_c5_node
 *
¼¯
 = 
	`ATH_NODE_C5_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_c5_node
 *
¼¯
 = 
	`ATH_NODE_C5_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_c5_node
 *
¼¯
 = 
	`ATH_NODE_C5_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

377 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

378 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

380 
	`DPRINTF
(
sc
, "¼¯c4: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

381 
	`DPRINTF
(
sc
,

383 
¼¯
->
¼¯_tx_couÁ
,

384 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

385 
¼¯
->
¼¯_loss_¿tio
,

386 
¼¯
->
¼¯_couÁ”
);

391 
	}
}

393 
©h_¿‹ù¾
 *

394 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

397 
¼¯_c5_soác
 *
asc
;

399 ià(
DEBUG
){

400 
	`´štk
("rraac5:his ishe‚ew„raa module!\n");

403 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

404 
asc
 = 
	`km®loc
((
¼¯_c5_soác
), 
GFP_ATOMIC
);

405 ià(
asc
 =ğ
NULL
) {

406 
	`_MOD_DEC_USE
(
THIS_MODULE
);

407  
NULL
;

409 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_c5_node
);

410 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

412  &
asc
->
¬c
;

413 
	}
}

416 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

418 
¼¯_c5_soác
 *
asc
 = (¼¯_c5_soáø*)
¬c
;

419 
	`kä“
(
asc
);

420 
	`_MOD_DEC_USE
(
THIS_MODULE
);

421 
	}
}

423 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

425 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

426 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC5
,

427 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

428 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

429 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

430 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

431 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

432 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

433 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

434 .
	g©ch
 = 
©h_¿‹_©ch
,

435 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

438 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

440 
	~"»Ëa£.h
"

442 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

443 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

444 #ifdeà
MODULE_VERSION


445 
MODULE_VERSION
(
RELEASE_VERSION
);

447 #ifdeà
MODULE_LICENSE


448 
MODULE_LICENSE
("Dual BSD/GPL");

451 
__š™


452 
	$š™_©h_¿‹_¼¯_c5_soác
()

454 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

455 ià(
»t
)

456  
»t
;

458 
	}
}

459 
moduË_š™
(
š™_©h_¿‹_¼¯_c5_soác
);

461 
__ex™


462 
	$ex™_©h_¿‹_¼¯_c5_soác
()

464 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

465 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

466 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

467 
	}
}

468 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c5_soác
);

	@rraac5/rraac5.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC5_H


12 
	#_DEV_ATH_RATE_RRAAC5_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c5_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_c5_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_c5_node
 *)&ª[1])

	)

63 
	#ATH_NODE_C5_RRAA
(
ª
è((
¼¯_c5_node
 *)&ª[1])

	)

	@rraac6/ath_rate_rraac6.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "B190E5DC4C9BCD57DBA9335");

	@rraac6/rraac6.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯c6.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_c6_node
 *
¼¯
 = 
	`ATH_NODE_C6_RRAA
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 38;

81 
¼¯_m­
[1].
pÜi
 = 38;

82 
¼¯_m­
[2].
pÜi
 = 38;

83 
¼¯_m­
[3].
pÜi
 = 38;

84 
¼¯_m­
[4].
pÜi
 = 11;

85 
¼¯_m­
[5].
pÜi
 = 12;

86 
¼¯_m­
[6].
pÜi
 = 14;

87 
¼¯_m­
[7].
pÜi
 = 10;

88 
¼¯_m­
[8].
pÜi
 = 13;

89 
¼¯_m­
[9].
pÜi
 = 9;

90 
¼¯_m­
[10].
pÜi
 = 4;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 49;

95 
¼¯_m­
[1].
pm
 = 49;

96 
¼¯_m­
[2].
pm
 = 49;

97 
¼¯_m­
[3].
pm
 = 49;

98 
¼¯_m­
[4].
pm
 = 49;

99 
¼¯_m­
[5].
pm
 = 40;

100 
¼¯_m­
[6].
pm
 = 36;

101 
¼¯_m­
[7].
pm
 = 46;

102 
¼¯_m­
[8].
pm
 = 34;

103 
¼¯_m­
[9].
pm
 = 43;

104 
¼¯_m­
[10].
pm
 = 29;

105 
¼¯_m­
[11].
pm
 = 11;

108 
¼¯_m­
[0].
ewnd
 = 6;

109 
¼¯_m­
[1].
ewnd
 = 6;

110 
¼¯_m­
[2].
ewnd
 = 6;

111 
¼¯_m­
[3].
ewnd
 = 6;

112 
¼¯_m­
[4].
ewnd
 = 10;

113 
¼¯_m­
[5].
ewnd
 = 15;

114 
¼¯_m­
[6].
ewnd
 = 20;

115 
¼¯_m­
[7].
ewnd
 = 20;

116 
¼¯_m­
[8].
ewnd
 = 40;

117 
¼¯_m­
[9].
ewnd
 = 40;

118 
¼¯_m­
[10].
ewnd
 = 40;

119 
¼¯_m­
[11].
ewnd
 = 40;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_c6_node
 *
¼¯
 = 
	`ATH_NODE_C6_RRAA
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_c6_node
 *
¼¯
 = 
	`ATH_NODE_C6_RRAA
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_c6_node
 *
¼¯
 = 
	`ATH_NODE_C6_RRAA
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_c6_node
 *
¼¯
 = 
	`ATH_NODE_C6_RRAA
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

376 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 ){

377 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

379 
	`DPRINTF
(
sc
, "¼¯c4: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

390 
	}
}

392 
©h_¿‹ù¾
 *

393 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

396 
¼¯_c6_soác
 *
asc
;

398 ià(
DEBUG
){

399 
	`´štk
("rraac6:his ishe‚ew„raa module!\n");

402 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

403 
asc
 = 
	`km®loc
((
¼¯_c6_soác
), 
GFP_ATOMIC
);

404 ià(
asc
 =ğ
NULL
) {

405 
	`_MOD_DEC_USE
(
THIS_MODULE
);

406  
NULL
;

408 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_c6_node
);

409 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

411  &
asc
->
¬c
;

412 
	}
}

415 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

417 
¼¯_c6_soác
 *
asc
 = (¼¯_c6_soáø*)
¬c
;

418 
	`kä“
(
asc
);

419 
	`_MOD_DEC_USE
(
THIS_MODULE
);

420 
	}
}

422 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

424 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

425 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAC6
,

426 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

427 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

428 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

429 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

430 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

431 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

432 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

433 .
	g©ch
 = 
©h_¿‹_©ch
,

434 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

437 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

439 
	~"»Ëa£.h
"

441 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

442 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

443 #ifdeà
MODULE_VERSION


444 
MODULE_VERSION
(
RELEASE_VERSION
);

446 #ifdeà
MODULE_LICENSE


447 
MODULE_LICENSE
("Dual BSD/GPL");

450 
__š™


451 
	$š™_©h_¿‹_¼¯_c6_soác
()

453 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

454 ià(
»t
)

455  
»t
;

457 
	}
}

458 
moduË_š™
(
š™_©h_¿‹_¼¯_c6_soác
);

460 
__ex™


461 
	$ex™_©h_¿‹_¼¯_c6_soác
()

463 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

464 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

465 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

466 
	}
}

467 
moduË_ex™
(
ex™_©h_¿‹_¼¯_c6_soác
);

	@rraac6/rraac6.h

11 #iâdeà
_DEV_ATH_RATE_RRAAC6_H


12 
	#_DEV_ATH_RATE_RRAAC6_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_c6_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_c6_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_c6_node
 *)&ª[1])

	)

63 
	#ATH_NODE_C6_RRAA
(
ª
è((
¼¯_c6_node
 *)&ª[1])

	)

	@rraamod/ath_rate_rraamod.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "5BA22D90837B3096577F984");

	@rraamod/rraamod.c

11 #iâdeà
AUTOCONF_INCLUDED


12 
	~<lšux/cÚfig.h
>

14 
	~<lšux/v”siÚ.h
>

15 
	~<lšux/moduË.h
>

16 
	~<lšux/š™.h
>

17 
	~<lšux/skbuff.h
>

18 
	~<lšux/Ãtdeviû.h
>

19 
	~<lšux/¿ndom.h
>

20 
	~<lšux/d–ay.h
>

21 
	~<lšux/ÿche.h
>

22 
	~<lšux/sysùl.h
>

23 
	~<lšux/´oc_fs.h
>

24 
	~<lšux/if_¬p.h
>

26 
	~<asm/uacûss.h
>

28 
	~<Ãt80211/if_medŸ.h
>

29 
	~<Ãt80211/›“80211_v¬.h
>

30 
	~<Ãt80211/›“80211_¿‹.h
>

32 
	~"if_©hv¬.h
"

33 
	~"if_©h_h®.h
"

34 
	~"ah_desc.h
"

36 
	~"¼¯mod.h
"

38 
	#DEBUG
 1

	)

39 
	#AMRR_DEBUG


	)

40 #ifdeà
AMRR_DEBUG


41 
	#DPRINTF
(
sc
, 
_fmt
, ...) do { \

42 ià(
DEBUG
) \

43 
	`´štk
(
_fmt
, 
__VA_ARGS__
); \

44 } 0)

	)

46 
	#DPRINTF
(
sc
, 
_fmt
, ...)

	)

50 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

51 
	gtÙ®_num_·ck‘s
 ;

52 
©h_¿‹_upd©e
(
©h_soác
 *, 
›“80211_node
 *, );

53 
©h_¿‹_ùl_¡¬t
(
©h_soác
 *, 
›“80211_node
 *);

54 
©h_¿‹_ùl
(*, 
›“80211_node
 *);

57 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

61 
¼¯_mod_node
 *
¼¯
 = 
	`ATH_NODE_RRAA_MOD
(
ª
);

64 ià(
fœ¡_time
){

65 
tÙ®_num_·ck‘s
 = 0;

66 
¼¯_m­
[0].
¿‹
 = 1;

67 
¼¯_m­
[1].
¿‹
 = 2;

68 
¼¯_m­
[2].
¿‹
 = 5;

69 
¼¯_m­
[3].
¿‹
 = 6;

70 
¼¯_m­
[4].
¿‹
 = 9;

71 
¼¯_m­
[5].
¿‹
 = 11;

72 
¼¯_m­
[6].
¿‹
 = 12;

73 
¼¯_m­
[7].
¿‹
 = 18;

74 
¼¯_m­
[8].
¿‹
 = 24;

75 
¼¯_m­
[9].
¿‹
 = 36;

76 
¼¯_m­
[10].
¿‹
 = 48;

77 
¼¯_m­
[11].
¿‹
 = 54;

80 
¼¯_m­
[0].
pÜi
 = 50;

81 
¼¯_m­
[1].
pÜi
 = 50;

82 
¼¯_m­
[2].
pÜi
 = 50;

83 
¼¯_m­
[3].
pÜi
 = 50;

84 
¼¯_m­
[4].
pÜi
 = 14;

85 
¼¯_m­
[5].
pÜi
 = 16;

86 
¼¯_m­
[6].
pÜi
 = 19;

87 
¼¯_m­
[7].
pÜi
 = 13;

88 
¼¯_m­
[8].
pÜi
 = 17;

89 
¼¯_m­
[9].
pÜi
 = 12;

90 
¼¯_m­
[10].
pÜi
 = 5;

91 
¼¯_m­
[11].
pÜi
 = 0;

94 
¼¯_m­
[0].
pm
 = 39;

95 
¼¯_m­
[1].
pm
 = 39;

96 
¼¯_m­
[2].
pm
 = 39;

97 
¼¯_m­
[3].
pm
 = 39;

98 
¼¯_m­
[4].
pm
 = 39;

99 
¼¯_m­
[5].
pm
 = 32;

100 
¼¯_m­
[6].
pm
 = 29;

101 
¼¯_m­
[7].
pm
 = 37;

102 
¼¯_m­
[8].
pm
 = 27;

103 
¼¯_m­
[9].
pm
 = 34;

104 
¼¯_m­
[10].
pm
 = 23;

105 
¼¯_m­
[11].
pm
 = 9;

108 
¼¯_m­
[0].
ewnd
 = 12;

109 
¼¯_m­
[1].
ewnd
 = 12;

110 
¼¯_m­
[2].
ewnd
 = 12;

111 
¼¯_m­
[3].
ewnd
 = 12;

112 
¼¯_m­
[4].
ewnd
 = 20;

113 
¼¯_m­
[5].
ewnd
 = 30;

114 
¼¯_m­
[6].
ewnd
 = 40;

115 
¼¯_m­
[7].
ewnd
 = 40;

116 
¼¯_m­
[8].
ewnd
 = 50;

117 
¼¯_m­
[9].
ewnd
 = 50;

118 
¼¯_m­
[10].
ewnd
 = 80;

119 
¼¯_m­
[11].
ewnd
 = 80;

122 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
MAX_RATE_POS
].
ewnd
;

124 
	`©h_¿‹_upd©e
(
sc
, &
ª
->
ª_node
, 0);

126 
fœ¡_time
 = 
çl£
;

130 
	}
}

133 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

135 
	}
}

140 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

141 
shÜtP»ambË
, 
size_t
 
äameL’
,

142 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

145 
¼¯_mod_node
 *
¼¯
 = 
	`ATH_NODE_RRAA_MOD
(
ª
);

147 *
rix
 = 
¼¯
->
¼¯_tx_rix0
;

148 *
Œy0
 = 
¼¯
->
¼¯_tx_Œy0
;

149 ià(
shÜtP»ambË
)

150 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0¥
;

152 *
tx¿‹
 = 
¼¯
->
¼¯_tx_¿‹0
;

153 
	}
}

158 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

159 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

166 
m¼
->
¿‹1
 = 0;

167 
m¼
->
»Œ›s1
 = 0;

168 
m¼
->
¿‹2
 = 0;

169 
m¼
->
»Œ›s2
 = 0;

170 
m¼
->
¿‹3
 = 0;

171 
m¼
->
»Œ›s3
 = 0;

172 
	}
}

176 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

177 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

181 
¼¯_mod_node
 *
¼¯
 = 
	`ATH_NODE_RRAA_MOD
(
ª
);

183 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

185 ià(
ts
->
ts_¡©us
 == 0)

186 
¼¯
->
¼¯_tx_com¶‘e
++;

188 
¼¯
->
¼¯_tx_ç
++;

191 
¼¯
->
¼¯_tx_»Œy
 +ğ
ts
->
ts_shÜŒ‘ry
 +s->
ts_lÚg»Œy
;

195 iàĞ--
¼¯
->
¼¯_couÁ”
 <= 0 )

196 
	`©h_¿‹_ùl
(
sc
, &
ª
->
ª_node
);

198 
	}
}

201 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

203 ià(
i¢ew
)

204 
	`©h_¿‹_ùl_¡¬t
(
sc
, &
ª
->
ª_node
);

205 
	}
}

208 
	$©h_¿‹_upd©e
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
, 
¿‹
)

210 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

211 
¼¯_mod_node
 *
¼¯
 = 
	`ATH_NODE_RRAA_MOD
(
ª
);

212 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

214 
	`KASSERT
(
¹
 !ğ
NULL
, ("¼¯_mod:‚Ø¿‹abË, mod%u", 
sc
->
sc_curmode
));

217 
	`DPRINTF
(
sc
, "¼¯_m­: %s: s‘x„©fÜ " 
MAC_FMT
 "o %dM\n",

218 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

219 
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0 ?

220 (
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
) / 2 : 0);

223 
ni
->
ni_tx¿‹
 = 
¿‹
;

225 ià(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0) {

226 
¼¯
->
¼¯_tx_rix0
 =

227 
sc
->
sc_rixm­
[
ni
->
ni_¿‹s
.
rs_¿‹s
[
¿‹
] & 
IEEE80211_RATE_VAL
];

228 
¼¯
->
¼¯_tx_¿‹0
 = 
¹
->
šfo
[¼¯->
¼¯_tx_rix0
].
¿‹Code
;

229 
¼¯
->
¼¯_tx_¿‹0¥
 =„¿a->
¼¯_tx_¿‹0
 |

230 
¹
->
šfo
[
¼¯
->
¼¯_tx_rix0
].
shÜtP»ambË
;

236 
¼¯
->
¼¯_tx_Œy0
 = 
ATH_TXMAXTRY
;

238 
	}
}

244 
	$©h_¿‹_ùl_¡¬t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

246 
	#RATE
(
_ix
è(
ni
->
ni_¿‹s
.
rs_¿‹s
[(_ix)] & 
IEEE80211_RATE_VAL
)

	)

247 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

248 
¤©e
;

250 
	`KASSERT
(
ni
->
ni_¿‹s
.
rs_Ä©es
 > 0, ("rraa_mod:‚o„ates"));

251 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

257 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

259 ià(
sc
->
sc_curmode
 !ğ
IEEE80211_MODE_11B
) {

265 ; 
¤©e
 >ğ0 && 
	`RATE
(srate) > 72; srate--);

266 
	`KASSERT
(
¤©e
 >= 0, ("rraa_mod: bogus„ate set"));

277 
¤©e
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
 - 1;

278 ; 
¤©e
 >ğ0 && 
	`RATE
(¤©eè!ğ
v­
->
iv_fixed_¿‹
; srate--);

279 
	`KASSERT
(
¤©e
 >= 0,

280 ("¼¯_mod: fixed„©%d‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

283 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 
¤©e
);

284 #undeà
RATE


285 
	}
}

288 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

290 
	`©h_¿‹_upd©e
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i, (è
¬g
);

291 
	}
}

297 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
¡©e
)

299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

300 
©h_soác
 *
sc
 = 
	`Ãtdev_´iv
(
ic
->
ic_dev
);

301 
›“80211_node
 *
ni
;

303 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
) {

308 
ni
 = 
v­
->
iv_bss
;

309 ià(
¡©e
 =ğ
IEEE80211_S_RUN
)

310 
	`©h_¿‹_ùl_¡¬t
(
sc
, 
ni
);

313 ià(
fœ¡_time
){

314 
	`©h_¿‹_upd©e
(
sc
, 
ni
, 0);

324 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

325 ià(
fœ¡_time
){

326 
	`©h_¿‹_upd©e
(
sc
, 
v­
->
iv_bss
, 0);

329 
	}
}

335 
	$©h_¿‹_ùl
(*
¬g
, 
›“80211_node
 *
ni
)

337 
	#is_max_¿‹
(
ni
è(Òi->
ni_tx¿‹
 + 1è>ğni->
ni_¿‹s
.
rs_Ä©es
)

	)

338 
	#is_mš_¿‹
(
ni
èÒi->
ni_tx¿‹
 =ğ0)

	)

340 
¼¯_mod_node
 *
¼¯
 = 
	`ATH_NODE_RRAA_MOD
(
	`ATH_NODE
(
ni
));

341 
©h_soác
 *
sc
 = 
¬g
;

342 
Şd_¿‹
;

344 
Şd_¿‹
 = 
ni
->
ni_tx¿‹
;

346 
¼¯
->
¼¯_loss_¿tio
 =

347 (
¼¯
->
¼¯_tx_»Œy
*100)/Ô¿a->¼¯_tx_»Œy +„¿a->
¼¯_tx_com¶‘e
);

350 
	`DPRINTF
 (
sc
, "rraa_mod:x_complete: %dx_fail: %dx_retry: %dx_loss_ratio: %d\n",

351 
¼¯
->
¼¯_tx_com¶‘e
,

352 
¼¯
->
¼¯_tx_ç
,

353 
¼¯
->
¼¯_tx_»Œy
,

354 
¼¯
->
¼¯_loss_¿tio
);

357 iàĞ
¼¯
->
¼¯_loss_¿tio
 > 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pm
 ) {

358 iàĞ!
	`is_mš_¿‹
(
ni
) )

359 
ni
->
ni_tx¿‹
 --;

361 iàĞ
¼¯
->
¼¯_loss_¿tio
 < 
¼¯_m­
[
ni
->
ni_tx¿‹
].
pÜi
 ) {

362 iàĞ!
	`is_max_¿‹
(
ni
) )

363 
ni
->
ni_tx¿‹
 ++;

367 
¼¯
->
¼¯_couÁ”
 = 
¼¯_m­
[
ni
->
ni_tx¿‹
].
ewnd
;

369 
¼¯
->
¼¯_tx_couÁ
 +ğ¼¯->
¼¯_tx_com¶‘e
 ;

372 
¼¯
->
¼¯_tx_com¶‘e
 = 0;

373 
¼¯
->
¼¯_tx_ç
 = 0;

374 
¼¯
->
¼¯_tx_»Œy
 = 0;

377 
	`DPRINTF
(
sc
, "¼¯_mod: " 
MAC_FMT
 " : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

380 
	`DPRINTF
(
sc
,

382 
¼¯
->
¼¯_tx_couÁ
,

383 
¼¯_m­
[
ni
->
ni_tx¿‹
].
¿‹
,

384 
¼¯
->
¼¯_loss_¿tio
,

385 
¼¯
->
¼¯_couÁ”
);

387 iàĞ
Şd_¿‹
 !ğ
ni
->
ni_tx¿‹
 )

388 
	`©h_¿‹_upd©e
(
sc
, 
ni
,‚i->
ni_tx¿‹
);

392 
	}
}

394 
©h_¿‹ù¾
 *

395 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

398 
¼¯_mod_soác
 *
asc
;

400 ià(
DEBUG
){

401 
	`´štk
("rraa_mod:his ishe‚ew„raa_mod module!\n");

404 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

405 
asc
 = 
	`km®loc
((
¼¯_mod_soác
), 
GFP_ATOMIC
);

406 ià(
asc
 =ğ
NULL
) {

407 
	`_MOD_DEC_USE
(
THIS_MODULE
);

408  
NULL
;

410 
asc
->
¬c
.
¬c_¥aû
 = (
¼¯_mod_node
);

411 
asc
->
¬c
.
¬c_v­_¥aû
 = 0;

413  &
asc
->
¬c
;

414 
	}
}

417 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

419 
¼¯_mod_soác
 *
asc
 = (¼¯_mod_soáø*)
¬c
;

420 
	`kä“
(
asc
);

421 
	`_MOD_DEC_USE
(
THIS_MODULE
);

422 
	}
}

424 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

426 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

427 .
¿‹ùl_id
 = 
IEEE80211_RATE_RRAAMOD
,

428 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

429 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

430 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

431 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

432 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

433 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

434 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

435 .
	g©ch
 = 
©h_¿‹_©ch
,

436 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

439 
ùl_bË_h—d”
 *
	g©h_sysùl_h—d”
;

441 
	~"»Ëa£.h
"

443 
MODULE_AUTHOR
("Nathaniel Conos, Juan M. Navarro,‡nd Lucas Wanner");

444 
MODULE_DESCRIPTION
("RRAA Rate control‡lgorithm");

445 #ifdeà
MODULE_VERSION


446 
MODULE_VERSION
(
RELEASE_VERSION
);

448 #ifdeà
MODULE_LICENSE


449 
MODULE_LICENSE
("Dual BSD/GPL");

452 
__š™


453 
	$š™_©h_¿‹_¼¯_mod_soác
()

455 
»t
 = 
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

456 ià(
»t
)

457  
»t
;

459 
	}
}

460 
moduË_š™
(
š™_©h_¿‹_¼¯_mod_soác
);

462 
__ex™


463 
	$ex™_©h_¿‹_¼¯_mod_soác
()

465 ià(
©h_sysùl_h—d”
 !ğ
NULL
)

466 
	`uÄegi¡”_sysùl_bË
(
©h_sysùl_h—d”
);

467 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

468 
	}
}

469 
moduË_ex™
(
ex™_©h_¿‹_¼¯_mod_soác
);

	@rraamod/rraamod.h

11 #iâdeà
_DEV_ATH_RATE_RRAAMOD_H


12 
	#_DEV_ATH_RATE_RRAAMOD_H


	)

14 
	#MAX_NUM_RATE
 12

	)

15 
	#MAX_RATE_POS
 11

	)

17 
	s¼¯_¿‹_m­
 {

18 
u_št
 
	m¿‹
;

19 
u_št
 
	mpÜi
;

20 
u_št
 
	mpm
;

21 
u_št
 
	mewnd
;

24 
¼¯_¿‹_m­
 
	g¼¯_m­
[
MAX_NUM_RATE
];

27 
	g‹¡_num
 ;

30 
	s¼¯_mod_soác
 {

31 
©h_¿‹ù¾
 
	m¬c
;

35 
	s¼¯_mod_node
 {

38 
u_št
 
	m¼¯_tx_com¶‘e
;

39 
u_št
 
	m¼¯_tx_ç
;

40 
u_št
 
	m¼¯_tx_»Œy
;

43 
u_št
 
	m¼¯_tx_couÁ
;

46 
u_št
 
	m¼¯_loss_¿tio
;

49 
	m¼¯_couÁ”
 ;

53 
u_št8_t
 
	m¼¯_tx_rix0
;

54 
u_št8_t
 
	m¼¯_tx_¿‹0
;

55 
u_št8_t
 
	m¼¯_tx_¿‹0¥
;

56 
u_št8_t
 
	m¼¯_tx_Œy0
;

62 
	#ATH_NODE_AMRR
(
ª
è((
¼¯_mod_node
 *)&ª[1])

	)

63 
	#ATH_NODE_RRAA_MOD
(
ª
è((
¼¯_mod_node
 *)&ª[1])

	)

	@sample/ath_rate_sample.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

41 cÚ¡ 
	g__moduË_d•’ds
[]

42 
__©Œibu‹_u£d__


43 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

47 
MODULE_INFO
(
¤cv”siÚ
, "79F187D84AF7923B8A00E29");

	@sample/sample.c

44 #iâdeà
AUTOCONF_INCLUDED


45 
	~<lšux/cÚfig.h
>

47 
	~<lšux/v”siÚ.h
>

48 
	~<lšux/moduË.h
>

49 
	~<lšux/š™.h
>

50 
	~<lšux/skbuff.h
>

51 
	~<lšux/Ãtdeviû.h
>

52 
	~<lšux/¿ndom.h
>

53 
	~<lšux/d–ay.h
>

54 
	~<lšux/ÿche.h
>

55 
	~<lšux/´oc_fs.h
>

56 
	~<lšux/if_¬p.h
>

57 
	~<lšux/vm®loc.h
>

59 
	~<asm/uacûss.h
>

61 
	~<Ãt80211/if_medŸ.h
>

62 
	~<Ãt80211/›“80211_v¬.h
>

63 
	~<Ãt80211/›“80211_¿‹.h
>

65 
	~"if_©hv¬.h
"

66 
	~"if_©h_h®.h
"

67 
	~"ah_desc.h
"

69 
	~"§m¶e.h
"

71 
	#SAMPLE_DEBUG


	)

72 #ifdeà
SAMPLE_DEBUG


74 
	mATH_DEBUG_RATE
 = 0x00000010,

75 
	mATH_DEBUG_ANY
 = 0xffffffff

77 
	#DEBUG
 0

	)

78 
	#DEBUG2
 1

	)

79 
	#DPRINTF
(
sc
, 
m
, 
fmt
, ...) do { \

80 ià(
DEBUG
) \

81 
	`´štk
(
fmt
, 
__VA_ARGS__
); \

82 } 0)

	)

84 
	#DPRINTF
(
sc
, 
m
, 
fmt
, ...) do { \

85 (è
sc
; \

86 } 0)

	)

114 
	~"»Ëa£.h
"

116 *
	gv”siÚ
 = "1.2 (" 
RELEASE_VERSION
 ")";

118 *
	gdev_šfo
 = "ath_rate_sample";

121 
	#STALE_FAILURE_TIMEOUT_MS
 10000

	)

122 
	#MIN_SWITCH_MS
 1000

	)

124 
	#ENABLE_MRR
 1

	)

126 
	g©h_smoÙhšg_¿‹
 = 95;

127 
	g©h_§m¶e_¿‹
 = 10;

130 
	gŞd_tx¿‹
 ;

131 
boŞ
 
	gfœ¡_time
 = 
Œue
 ;

132 
©h_¿‹_ùl_»£t
(
©h_soác
 *, 
›“80211_node
 *);

136 
__šlše
 

137 
	$size_to_bš
(
size
)

139 
x
;

140 
x
 = 0; x < 
NUM_PACKET_SIZE_BINS
; x++)

141 ià(
size
 <ğ
·ck‘_size_bšs
[
x
])

142  
x
;

144  
NUM_PACKET_SIZE_BINS
 - 1;

145 
	}
}

147 
__šlše
 

148 
	$bš_to_size
(
šdex
) {

149  
·ck‘_size_bšs
[
šdex
];

150 
	}
}

152 
__šlše
 

153 
	$¿‹_to_ndx
(
§m¶e_node
 *
¢
, 
¿‹
)

155 
x
;

156 
x
 = 0; x < 
¢
->
num_¿‹s
; x++)

157 ià(
¢
->
¿‹s
[
x
].
¿‹
 ==„ate)

158  
x
;

160 
	}
}

166 
	$ÿlc_u£cs_uniÿ¡_·ck‘
(
©h_soác
 *
sc
, 
Ëngth
,

167 
rix
, 
shÜt_»Œ›s
, 
lÚg_»Œ›s
)

169 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

170 
¹s
, 
ùs
;

172 
t_¦Ù
;

173 
t_difs
;

174 
t_sifs
;

175 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

176 
‰
 = 0;

177 
x
;

178 
cw
 = 
ATH_DEFAULT_CWMIN
;

179 
cix
 = 
¹
->
šfo
[
rix
].
cÚŒŞR©e
;

180 
	`KASSERT
(
¹
 !ğ
NULL
, ("nØ¿‹abË, mod%u", 
sc
->
sc_curmode
));

182 ià(!
¹
->
šfo
[
rix
].
¿‹Kbps
) {

183 
	`´štk
(
KERN_WARNING
 "rix %u (%u) bad„atekbps %u mode %u\n",

184 
rix
, 
¹
->
šfo
[rix].
dÙ11R©e
,

185 
¹
->
šfo
[
rix
].
¿‹Kbps
,

186 
sc
->
sc_curmode
);

191 
cix
 = 
¹
->
šfo
[
rix
].
cÚŒŞR©e
;

197 
¹
->
šfo
[
rix
].
phy
) {

198 
IEEE80211_T_OFDM
:

199 
t_¦Ù
 = 9;

200 
t_sifs
 = 16;

201 
t_difs
 = 28;

203 
IEEE80211_T_TURBO
:

204 
t_¦Ù
 = 9;

205 
t_sifs
 = 8;

206 
t_difs
 = 28;

208 
IEEE80211_T_DS
:

212 
t_¦Ù
 = 20;

213 
t_difs
 = 50;

214 
t_sifs
 = 10;

217 
¹s
 = 
ùs
 = 0;

219 ià((
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
) &&

220 
¹
->
šfo
[
rix
].
phy
 =ğ
IEEE80211_T_OFDM
) {

221 ià(
ic
->
ic_´Ùmode
 =ğ
IEEE80211_PROT_RTSCTS
)

222 
¹s
 = 1;

223 ià(
ic
->
ic_´Ùmode
 =ğ
IEEE80211_PROT_CTSONLY
)

224 
ùs
 = 1;

226 
cix
 = 
¹
->
šfo
[
sc
->
sc_´Ùrix
].
cÚŒŞR©e
;

230 
¹s
 = 1;

232 ià(
¹s
 || 
ùs
) {

233 
ù¤©e
;

234 
ùsdu¿tiÚ
 = 0;

236 ià(!
¹
->
šfo
[
cix
].
¿‹Kbps
) {

237 
	`´štk
(
KERN_WARNING
 "cix %u (%u) bad„atekbps %u mode %u\n",

238 
cix
, 
¹
->
šfo
[cix].
dÙ11R©e
,

239 
¹
->
šfo
[
cix
].
¿‹Kbps
,

240 
sc
->
sc_curmode
);

245 
ù¤©e
 = 
¹
->
šfo
[
cix
].
¿‹Code
 |„t->šfo[cix].
shÜtP»ambË
;

246 ià(
¹s
)

247 
ùsdu¿tiÚ
 +ğ
¹
->
šfo
[
cix
].
¥AckDu¿tiÚ
;

249 
ùsdu¿tiÚ
 +ğ
	`©h_h®_compu‹txtime
(
sc
->
sc_ah
,

250 
¹
, 
Ëngth
, 
rix
, 
AH_TRUE
);

252 ià(
ùs
)

253 
ùsdu¿tiÚ
 +ğ
¹
->
šfo
[
cix
].
¥AckDu¿tiÚ
;

255 
‰
 +ğ(
shÜt_»Œ›s
 + 1è* 
ùsdu¿tiÚ
;

257 
‰
 +ğ
t_difs
;

258 
‰
 +ğ(
lÚg_»Œ›s
+1)*(
t_sifs
 + 
¹
->
šfo
[
rix
].
¥AckDu¿tiÚ
);

259 
‰
 +ğ(
lÚg_»Œ›s
+1)*
	`©h_h®_compu‹txtime
(
sc
->
sc_ah
, 
¹
, 
Ëngth
,

260 
rix
, 
AH_TRUE
);

261 
x
 = 0; x <ğ
shÜt_»Œ›s
 + 
lÚg_»Œ›s
; x++) {

262 
cw
 = 
	`MIN
(
ATH_DEFAULT_CWMAX
, (cw + 1) * 2);

263 
‰
 +ğ(
t_¦Ù
 * 
cw
 / 2);

265  
‰
;

266 
	}
}

269 
	$©h_¿‹_node_š™
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

272 
§m¶e_node
* 
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

273 
›“80211_node
* 
ni
 = &
ª
->
ª_node
;

274 
	`©h_¿‹_ùl_»£t
(
sc
, &
ª
->
ª_node
);

275 
¢
->
·ck‘_couÁ
 = 0;

276 
¢
->
cu¼’t_tx_¿‹
 = 
ni
->
ni_tx¿‹
;

277 ià(
DEBUG2
){

278 iàĞ
fœ¡_time
){

279 
	`´štk
(
MAC_FMT
 " sam¶e_š™ : ", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

280 
fœ¡_time
 = 
çl£
 ;

284 
	}
}

287 
	$©h_¿‹_node_ş—nup
(
©h_soác
 *
sc
, 
©h_node
 *
ª
)

289 
	}
}

293 
	$©h_¿‹_node_cİy
(
©h_soác
 *
sc
,

294 
©h_node
 *
d¡
, cÚ¡ ©h_nod*
¤c
)

296 
§m¶e_node
 *
od¡
 = 
	`ATH_NODE_SAMPLE
(
d¡
);

297 cÚ¡ 
§m¶e_node
 *
o¤c
 = (cÚ¡ §m¶e_nod*)&
¤c
[1];

298 
	`memıy
(
od¡
, 
o¤c
, (
§m¶e_node
));

299 
	}
}

306 
__šlše
 
	$be¡_¿‹_ndx
(
§m¶e_node
 *
¢
, 
size_bš
,

307 
»quœe_acked_befÜe
)

309 
x
;

310 
be¡_¿‹_‰
 = 0;

311 
be¡_¿‹_ndx
 = -1;

313 
x
 = 0; x < 
¢
->
num_¿‹s
; x++) {

314 
‰
 = 
¢
->
¡©s
[
size_bš
][
x
].
av”age_tx_time
;

315 ià(
‰
 <ğ0 || (
»quœe_acked_befÜe
 &&

316 !
¢
->
¡©s
[
size_bš
][
x
].
·ck‘s_acked
))

320 ià(
¢
->
¿‹s
[
x
].
¿‹
 == 18)

324 ià(
¢
->
¡©s
[
size_bš
][
x
].
sucûssive_çu»s
 > 3)

327 ià(!
be¡_¿‹_‰
 || be¡_¿‹_‰ > 
‰
) {

328 
be¡_¿‹_‰
 = 
‰
;

329 
be¡_¿‹_ndx
 = 
x
;

332  
be¡_¿‹_ndx
;

333 
	}
}

338 
__šlše
 

339 
	$pick_§m¶e_ndx
(
§m¶e_node
 *
¢
, 
size_bš
)

341 
x
;

342 
cu¼’t_‰
;

343 
cu¼’t_ndx
;

345 
cu¼’t_ndx
 = 
¢
->
cu¼’t_¿‹
[
size_bš
];

346 ià(
cu¼’t_ndx
 < 0) {

351 
cu¼’t_‰
 = 
¢
->
¡©s
[
size_bš
][
cu¼’t_ndx
].
av”age_tx_time
;

353 
x
 = 0; x < 
¢
->
num_¿‹s
; x++) {

354 
ndx
 = (
¢
->
Ï¡_§m¶e_ndx
[
size_bš
] + 1 + 
x
è% sn->
num_¿‹s
;

357 ià(
ndx
 =ğ
cu¼’t_ndx
)

361 ià(
¢
->
¡©s
[
size_bš
][
ndx
].
³rãù_tx_time
 > 
cu¼’t_‰
)

365 ià(
	`time_befÜe
(
jiff›s
, 
¢
->
¡©s
[
size_bš
][
ndx
].
Ï¡_tx
 +

366 ((
HZ
 * 
STALE_FAILURE_TIMEOUT_MS
) / 1000)) &&

367 
¢
->
¡©s
[
size_bš
][
ndx
].
sucûssive_çu»s
 > 3)

373 ià(
¢
->
¿‹s
[
ndx
].
¿‹
 > 22 &&‚dx > 
cu¼’t_ndx
 + 2)

377 ià(
¢
->
¿‹s
[
ndx
].
¿‹
 == 18)

382 ià(
¢
->
¿‹s
[
cu¼’t_ndx
].
¿‹
 =ğ22 && 
ndx
 > current_ndx + 1)

385 
¢
->
Ï¡_§m¶e_ndx
[
size_bš
] = 
ndx
;

386  
ndx
;

388  
cu¼’t_ndx
;

389 
	}
}

392 
	$©h_¿‹_fšd¿‹
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

393 
shÜtP»ambË
, 
size_t
 
äameL’
,

394 
u_št8_t
 *
rix
, *
Œy0
, u_št8_ˆ*
tx¿‹
)

396 
§m¶e_node
 *
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

397 
§m¶e_soác
 *
ssc
 = 
	`ATH_SOFTC_SAMPLE
(
sc
);

398 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

399 
size_bš
, 
m¼
, 
chªge_¿‹s
;

400 
ndx
, 
be¡_ndx
;

401 
av”age_tx_time
;

403 ià(
¢
->
num_¿‹s
 <= 0) {

404 
	`´štk
(
KERN_WARNING
 "%s:‚Ø¿‹ fÜ " 
MAC_FMT
 "?\n",

405 
dev_šfo
,

406 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
));

410 
m¼
 = 
sc
->
sc_m¼‘ry
 && !(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
è&& 
ENABLE_MRR
;

411 
size_bš
 = 
	`size_to_bš
(
äameL’
);

412 
be¡_ndx
 = 
	`be¡_¿‹_ndx
(
¢
, 
size_bš
, !
m¼
);

414 ià(
be¡_ndx
 >= 0)

415 
av”age_tx_time
 = 
¢
->
¡©s
[
size_bš
][
be¡_ndx
].average_tx_time;

417 
av”age_tx_time
 = 0;

419 ià(
¢
->
¡©ic_¿‹_ndx
 != -1) {

420 
ndx
 = 
¢
->
¡©ic_¿‹_ndx
;

421 *
Œy0
 = 
ATH_TXMAXTRY
;

423 *
Œy0
 = 
m¼
 ? 2 : 
ATH_TXMAXTRY
;

425 ià(
¢
->
§m¶e_‰
[
size_bš
] < 
av”age_tx_time
 * (¢->
·ck‘s_sšû_§m¶e
[size_bš] * 
ssc
->
©h_§m¶e_¿‹
 / 100)) {

431 
ndx
 = 
	`pick_§m¶e_ndx
(
¢
, 
size_bš
);

432 ià(
ndx
 !ğ
¢
->
cu¼’t_¿‹
[
size_bš
])

433 
¢
->
cu¼’t_§m¶e_ndx
[
size_bš
] = 
ndx
;

435 
¢
->
cu¼’t_§m¶e_ndx
[
size_bš
] = -1;

436 
¢
->
·ck‘s_sšû_§m¶e
[
size_bš
] = 0;

439 
chªge_¿‹s
 = 0;

440 ià(!
¢
->
·ck‘s_£Á
[
size_bš
] || 
be¡_ndx
 == -1) {

446 
š™Ÿl_¿‹
 = 72;

447 ià(
ª
->
ª_avgrssi
 > 50) {

448 
š™Ÿl_¿‹
 = 108;

449 } ià(
ª
->
ª_avgrssi
 > 30) {

450 
š™Ÿl_¿‹
 = 72;

452 
š™Ÿl_¿‹
 = 22;

455 
ndx
 = 
¢
->
num_¿‹s
-1;‚dx > 0;‚dx--) {

460 ià(
¢
->
¿‹s
[
ndx
].
¿‹
 <ğ
š™Ÿl_¿‹
 &&

461 
¢
->
¡©s
[
size_bš
][
ndx
].
sucûssive_çu»s
 == 0)

464 
chªge_¿‹s
 = 1;

465 
be¡_ndx
 = 
ndx
;

466 } ià(
¢
->
·ck‘s_£Á
[
size_bš
] < 20) {

468 
chªge_¿‹s
 = 1;

469 } ià(
	`time_aá”
(
jiff›s
,

470 
¢
->
jiff›s_sšû_sw™ch
[
size_bš
] +

471 ((
HZ
 * 
MIN_SWITCH_MS
) / 1000))) {

473 
chªge_¿‹s
 = 1;

474 } ià(
av”age_tx_time
 * 2 < 
¢
->
¡©s
[
size_bš
][¢->
cu¼’t_¿‹
[size_bin]].average_tx_time) {

476 
chªge_¿‹s
 = 1;

479 
¢
->
·ck‘s_sšû_§m¶e
[
size_bš
]++;

481 ià(
chªge_¿‹s
) {

482 ià(
be¡_ndx
 !ğ
¢
->
cu¼’t_¿‹
[
size_bš
]) {

483 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: " 
MAC_FMT
 " size %u switch„ate %u (%u/%u) -> %u (%u/%u)‡fter %u…ackets mrr %u\n",

484 
dev_šfo
,

485 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
),

486 
·ck‘_size_bšs
[
size_bš
],

487 
¢
->
¿‹s
[¢->
cu¼’t_¿‹
[
size_bš
]].
¿‹
,

488 
¢
->
¡©s
[
size_bš
][¢->
cu¼’t_¿‹
[size_bš]].
av”age_tx_time
,

489 
¢
->
¡©s
[
size_bš
][¢->
cu¼’t_¿‹
[size_bš]].
³rãù_tx_time
,

490 
¢
->
¿‹s
[
be¡_ndx
].
¿‹
,

491 
¢
->
¡©s
[
size_bš
][
be¡_ndx
].
av”age_tx_time
,

492 
¢
->
¡©s
[
size_bš
][
be¡_ndx
].
³rãù_tx_time
,

493 
¢
->
·ck‘s_sšû_sw™ch
[
size_bš
],

494 
m¼
);

496 
¢
->
·ck‘s_sšû_sw™ch
[
size_bš
] = 0;

497 
¢
->
cu¼’t_¿‹
[
size_bš
] = 
be¡_ndx
;

498 
¢
->
jiff›s_sšû_sw™ch
[
size_bš
] = 
jiff›s
;

500 
ndx
 = 
¢
->
cu¼’t_¿‹
[
size_bš
];

501 
¢
->
·ck‘s_sšû_sw™ch
[
size_bš
]++;

502 ià(
size_bš
 == 0) {

507 
ª
->
ª_node
.
ni_tx¿‹
 = 
ndx
;

512 
	`KASSERT
(
ndx
 >ğ0 &&‚dx < 
¢
->
num_¿‹s
,

513 ("%s: bad‚dx (%u/%uèfÜ " 
MAC_FMT
 "?",

514 
dev_šfo
, 
ndx
, 
¢
->
num_¿‹s
,

515 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
)));

518 *
rix
 = 
¢
->
¿‹s
[
ndx
].rix;

519 ià(
shÜtP»ambË
)

520 *
tx¿‹
 = 
¢
->
¿‹s
[
ndx
].
shÜtP»ambËR©eCode
;

522 *
tx¿‹
 = 
¢
->
¿‹s
[
ndx
].
¿‹Code
;

523 
¢
->
·ck‘s_£Á
[
size_bš
]++;

524 
	}
}

527 
	$©h_¿‹_g‘_m¼
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
shÜtP»ambË
,

528 
size_t
 
äame_size
, 
u_št8_t
 
rix
, 
›“80211_m¼
 *
m¼
)

530 
§m¶e_node
 *
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

531 
size_bš
;

532 
ndx
;

534 
size_bš
 = 
	`size_to_bš
(
äame_size
);

535 
ndx
 = 
¢
->
cu¼’t_¿‹
[
size_bš
];

537 ià(!
¢
->
¡©s
[
size_bš
][
ndx
].
·ck‘s_acked
)

538 
ndx
 = 0;

540 ià(
shÜtP»ambË
)

541 
m¼
->
¿‹1
 = 
¢
->
¿‹s
[
ndx
].
shÜtP»ambËR©eCode
;

543 
m¼
->
¿‹1
 = 
¢
->
¿‹s
[
ndx
].
¿‹Code
;

545 
m¼
->
»Œ›s1
 = 3;

546 
m¼
->
¿‹2
 = 
¢
->
¿‹s
[0].
¿‹Code
;

547 
m¼
->
»Œ›s2
 = 3;

548 
m¼
->
¿‹3
 = 0;

549 
m¼
->
»Œ›s3
 = 0;

550 
	}
}

553 
	$upd©e_¡©s
(
©h_soác
 *
sc
, 
©h_node
 *
ª
,

554 
äame_size
,

555 
ndx0
, 
Œ›s0
,

556 
ndx1
, 
Œ›s1
,

557 
ndx2
, 
Œ›s2
,

558 
ndx3
, 
Œ›s3
,

559 
shÜt_Œ›s
, 
Œ›s
, 
¡©us
)

561 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

562 
§m¶e_node
 *
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

563 
§m¶e_soác
 *
ssc
 = 
	`ATH_SOFTC_SAMPLE
(
sc
);

564 
‰
 = 0;

565 
Œ›s_so_çr
 = 0;

566 
size_bš
;

567 
size
;

568 
¿‹
;

570 
size_bš
 = 
	`size_to_bš
(
äame_size
);

571 
size
 = 
	`bš_to_size
(
size_bš
);

573 ià(!(0 <ğ
ndx0
 &&‚dx0 < 
¢
->
num_¿‹s
)) {

574 
	`´štk
("%s: bogus‚dx0 %d, max %u, mode %u\n",

575 
__func__
, 
ndx0
, 
¢
->
num_¿‹s
, 
sc
->
sc_curmode
);

578 
¿‹
 = 
¢
->
¿‹s
[
ndx0
].rate;

580 ià(!
¹
->
šfo
[
ndx0
].
¿‹Kbps
) {

587 
‰
 +ğ
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 
size
, 
¢
->
¿‹s
[
ndx0
].
rix
,

588 
shÜt_Œ›s
,

589 
	`MIN
(
Œ›s0
, 
Œ›s
) - 1);

590 
Œ›s_so_çr
 +ğ
Œ›s0
;

591 ià(
Œ›s1
 && (
Œ›s0
 < 
Œ›s
)) {

592 ià(!(0 <ğ
ndx1
 &&‚dx1 < 
¢
->
num_¿‹s
)) {

593 
	`´štk
("%s: bogus‚dx1 %d, max %u, mode %u\n",

594 
__func__
, 
ndx1
, 
¢
->
num_¿‹s
, 
sc
->
sc_curmode
);

597 
‰
 +ğ
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 
size
, 
¢
->
¿‹s
[
ndx1
].
rix
,

598 
shÜt_Œ›s
,

599 
	`MIN
(
Œ›s1
 + 
Œ›s_so_çr
, 
Œ›s
) -ries_so_far - 1);

601 
Œ›s_so_çr
 +ğ
Œ›s1
;

603 ià(
Œ›s2
 && ((
Œ›s0
 + 
Œ›s1
è< 
Œ›s
)) {

604 ià(!(0 <ğ
ndx2
 &&‚dx2 < 
¢
->
num_¿‹s
)) {

605 
	`´štk
("%s: bogus‚dx2 %d, max %u, mode %u\n",

606 
__func__
, 
ndx2
, 
¢
->
num_¿‹s
, 
sc
->
sc_curmode
);

609 
‰
 +ğ
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 
size
, 
¢
->
¿‹s
[
ndx2
].
rix
,

610 
shÜt_Œ›s
,

611 
	`MIN
(
Œ›s2
 + 
Œ›s_so_çr
, 
Œ›s
) -ries_so_far - 1);

614 
Œ›s_so_çr
 +ğ
Œ›s2
;

616 ià(
Œ›s3
 && ((
Œ›s0
 + 
Œ›s1
 + 
Œ›s2
è< 
Œ›s
)) {

617 ià(!(0 <ğ
ndx3
 &&‚dx3 < 
¢
->
num_¿‹s
)) {

618 
	`´štk
("%s: bogus‚dx3 %d, max %u, mode %u\n",

619 
__func__
, 
ndx3
, 
¢
->
num_¿‹s
, 
sc
->
sc_curmode
);

622 
‰
 +ğ
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 
size
, 
¢
->
¿‹s
[
ndx3
].
rix
,

623 
shÜt_Œ›s
,

624 
	`MIN
(
Œ›s3
 + 
Œ›s_so_çr
, 
Œ›s
) -ries_so_far - 1);

627 ià(
¢
->
¡©s
[
size_bš
][
ndx0
].
tÙ®_·ck‘s
 < (100 / (100 - 
ssc
->
©h_smoÙhšg_¿‹
))) {

629 
avg_tx
 = 
¢
->
¡©s
[
size_bš
][
ndx0
].
av”age_tx_time
;

630 
·ck‘s
 = 
¢
->
¡©s
[
size_bš
][
ndx0
].
tÙ®_·ck‘s
;

631 
¢
->
¡©s
[
size_bš
][
ndx0
].
av”age_tx_time
 =

632 (
‰
 + (
avg_tx
 * 
·ck‘s
)) / (packets + 1);

635 
¢
->
¡©s
[
size_bš
][
ndx0
].
av”age_tx_time
 =

636 ((
¢
->
¡©s
[
size_bš
][
ndx0
].
av”age_tx_time
 * 
ssc
->
©h_smoÙhšg_¿‹
) +

637 (
‰
 * (100 - 
ssc
->
©h_smoÙhšg_¿‹
))) / 100;

640 ià(
¡©us
) {

641 
y
;

642 
¢
->
¡©s
[
size_bš
][
ndx0
].
sucûssive_çu»s
++;

643 
y
 = 
size_bš
 + 1; y < 
NUM_PACKET_SIZE_BINS
; y++) {

648 
¢
->
¡©s
[
y
][
ndx0
].
sucûssive_çu»s
++;

649 
¢
->
¡©s
[
y
][
ndx0
].
Ï¡_tx
 = 
jiff›s
;

650 
¢
->
¡©s
[
y
][
ndx0
].
Œ›s
 +=ries;

651 
¢
->
¡©s
[
y
][
ndx0
].
tÙ®_·ck‘s
++;

654 
¢
->
¡©s
[
size_bš
][
ndx0
].
·ck‘s_acked
++;

655 
¢
->
¡©s
[
size_bš
][
ndx0
].
sucûssive_çu»s
 = 0;

657 
¢
->
¡©s
[
size_bš
][
ndx0
].
Œ›s
 +=ries;

658 
¢
->
¡©s
[
size_bš
][
ndx0
].
Ï¡_tx
 = 
jiff›s
;

659 
¢
->
¡©s
[
size_bš
][
ndx0
].
tÙ®_·ck‘s
++;

661 ià(
ndx0
 =ğ
¢
->
cu¼’t_§m¶e_ndx
[
size_bš
]) {

662 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: " 
MAC_FMT
 " size %u sample„ate %uries (%u/%u)t %u‡vg_tt (%u/%u) status %u\n",

663 
dev_šfo
, 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
),

664 
size
, 
¿‹
, 
shÜt_Œ›s
, 
Œ›s
, 
‰
,

665 
¢
->
¡©s
[
size_bš
][
ndx0
].
av”age_tx_time
,

666 
¢
->
¡©s
[
size_bš
][
ndx0
].
³rãù_tx_time
,

667 
¡©us
);

668 
¢
->
§m¶e_‰
[
size_bš
] = 
‰
;

669 
¢
->
cu¼’t_§m¶e_ndx
[
size_bš
] = -1;

671 
	}
}

674 
	$©h_¿‹_tx_com¶‘e
(
©h_soác
 *
sc
,

675 
©h_node
 *
ª
, cÚ¡ 
©h_buf
 *
bf
)

677 
§m¶e_node
 *
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

678 
›“80211com
 *
ic
 = &
sc
->
sc_ic
;

679 cÚ¡ 
©h_tx_¡©us
 *
ts
 = &
bf
->
bf_ds¡©us
.
ds_tx¡©
;

680 cÚ¡ 
©h_desc
 *
ds
 = &
bf
->
bf_desc
[0];

681 
fš®_¿‹
;

682 
shÜt_Œ›s
;

683 
lÚg_Œ›s
;

684 
äame_size
;

685 
m¼
;

686 
›“80211_node
 *
ni
 = &
ª
->
ª_node
;

688 
fš®_¿‹
 = 
sc
->
sc_hwm­
[
ts
->
ts_¿‹
 &~ 
HAL_TXSTAT_ALTRATE
].
›“¿‹
;

689 
shÜt_Œ›s
 = 
ts
->
ts_shÜŒ‘ry
 + 1;

690 
lÚg_Œ›s
 = 
ts
->
ts_lÚg»Œy
 + 1;

691 
äame_size
 = 
ds
->
ds_ùl0
 & 0x0fff;

692 
¢
->
·ck‘_couÁ
 ++;

693 ià(
DEBUG2
){

695 iàĞ
Şd_tx¿‹
 !ğ
fš®_¿‹
 ){

696 
	`´štk
(
MAC_FMT
 " sam¶e:x_¿‹ %d,…ack‘_couÁ %d\n", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

697 (
fš®_¿‹
 & 
IEEE80211_RATE_VAL
 )/2, 
¢
->
·ck‘_couÁ
 );

701 ià(
äame_size
 == 0)

702 
äame_size
 = 1500;

704 ià(
¢
->
num_¿‹s
 <= 0) {

705 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: " 
MAC_FMT
 " % nØ¿‹ y‘\n", 
dev_šfo
,

706 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
), 
__func__
);

710 
m¼
 = 
sc
->
sc_m¼‘ry
 && !(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
è&& 
ENABLE_MRR
;

713 ià(
sc
->
sc_m¼‘ry
 && 
ts
->
ts_¡©us
) {

715 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: " 
MAC_FMT
 " size %u„ate/try %u/%u %u/%u %u/%u %u/%u status %s„etries (%u/%u)\n",

716 
dev_šfo
,

717 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
),

718 
	`bš_to_size
(
	`size_to_bš
(
äame_size
)),

719 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e0
)].
›“¿‹
,

720 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s0
),

721 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e1
)].
›“¿‹
,

722 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s1
),

723 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e2
)].
›“¿‹
,

724 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s2
),

725 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e3
)].
›“¿‹
,

726 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s3
),

727 
ts
->
ts_¡©us
 ? "FAIL" : "OK",

728 
shÜt_Œ›s
, 
lÚg_Œ›s
);

731 
m¼
 = 
sc
->
sc_m¼‘ry
 && !(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
è&& 
ENABLE_MRR
;

734 ià(!
m¼
 || !(
ts
->
ts_¿‹
 & 
HAL_TXSTAT_ALTRATE
)) {

736 
ndx
 = 
	`¿‹_to_ndx
(
¢
, 
fš®_¿‹
);

737 ià((
ndx
 >ğ0è&& (ndx < 
¢
->
num_¿‹s
)) {

738 
	`upd©e_¡©s
(
sc
, 
ª
, 
äame_size
,

739 
ndx
, 
lÚg_Œ›s
,

743 
shÜt_Œ›s
, 
lÚg_Œ›s
, 
ts
->
ts_¡©us
);

746 
¿‹
[4], 
Œ›s
[4];

747 
ndx
[4];

748 
fš®TSIdx
 = 
ts
->
ts_fš®tsi
;

754 
¿‹
[0] = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e0
)].
›“¿‹
;

755 
Œ›s
[0] = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s0
);

756 
ndx
[0] = 
	`¿‹_to_ndx
(
¢
, 
¿‹
[0]);

758 
¿‹
[1] = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e1
)].
›“¿‹
;

759 
Œ›s
[1] = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s1
);

760 
ndx
[1] = 
	`¿‹_to_ndx
(
¢
, 
¿‹
[1]);

762 
¿‹
[2] = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e2
)].
›“¿‹
;

763 
Œ›s
[2] = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s2
);

764 
ndx
[2] = 
	`¿‹_to_ndx
(
¢
, 
¿‹
[2]);

766 
¿‹
[3] = 
sc
->
sc_hwm­
[
	`MS
(
ds
->
ds_ùl3
, 
AR_Xm™R©e3
)].
›“¿‹
;

767 
Œ›s
[3] = 
	`MS
(
ds
->
ds_ùl2
, 
AR_Xm™D©aTr›s3
);

768 
ndx
[3] = 
	`¿‹_to_ndx
(
¢
, 
¿‹
[3]);

771 
	`DPRINTF
(
sc
, "%s: " 
MAC_FMT
 " size %u finaltsidx %uries %u status %u„ate/try %u/%u %u/%u %u/%u %u/%u\n",

772 
dev_šfo
, 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
),

773 
	`bš_to_size
(
	`size_to_bš
(
äame_size
)),

774 
fš®TSIdx
,

775 
lÚg_Œ›s
,

776 
ds
->
ds_tx¡©
.
ts_¡©us
,

777 
¿‹
[0], 
Œ›s
[0],

778 
¿‹
[1], 
Œ›s
[1],

779 
¿‹
[2], 
Œ›s
[2],

780 
¿‹
[3], 
Œ›s
[3]);

789 ià(
Œ›s
[0] && 
ndx
[0] >= 0) {

790 
	`upd©e_¡©s
(
sc
, 
ª
, 
äame_size
,

791 
ndx
[0], 
Œ›s
[0],

792 
ndx
[1], 
Œ›s
[1],

793 
ndx
[2], 
Œ›s
[2],

794 
ndx
[3], 
Œ›s
[3],

795 
shÜt_Œ›s
, 
lÚg_Œ›s
,

796 
lÚg_Œ›s
 > 
Œ›s
[0]);

797 
lÚg_Œ›s
 -ğ
Œ›s
[0];

801 ià(
Œ›s
[1] && 
ndx
[1] >ğ0 && 
fš®TSIdx
 > 0) {

802 
	`upd©e_¡©s
(
sc
, 
ª
, 
äame_size
,

803 
ndx
[1], 
Œ›s
[1],

804 
ndx
[2], 
Œ›s
[2],

805 
ndx
[3], 
Œ›s
[3],

807 
shÜt_Œ›s
, 
lÚg_Œ›s
,

808 
ts
->
ts_¡©us
);

809 
lÚg_Œ›s
 -ğ
Œ›s
[1];

812 ià(
Œ›s
[2] && 
ndx
[2] >ğ0 && 
fš®TSIdx
 > 1) {

813 
	`upd©e_¡©s
(
sc
, 
ª
, 
äame_size
,

814 
ndx
[2], 
Œ›s
[2],

815 
ndx
[3], 
Œ›s
[3],

818 
shÜt_Œ›s
, 
lÚg_Œ›s
,

819 
ts
->
ts_¡©us
);

820 
lÚg_Œ›s
 -ğ
Œ›s
[2];

823 ià(
Œ›s
[3] && 
ndx
[3] >ğ0 && 
fš®TSIdx
 > 2) {

824 
	`upd©e_¡©s
(
sc
, 
ª
, 
äame_size
,

825 
ndx
[3], 
Œ›s
[3],

829 
shÜt_Œ›s
, 
lÚg_Œ›s
,

830 
ts
->
ts_¡©us
);

835 
Şd_tx¿‹
 = 
fš®_¿‹
;

836 
	}
}

839 
	$©h_¿‹_Ãwassoc
(
©h_soác
 *
sc
, 
©h_node
 *
ª
, 
i¢ew
)

841 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: " 
MAC_FMT
 " % i¢ew %d\n", 
dev_šfo
,

842 
	`MAC_ADDR
(
ª
->
ª_node
.
ni_maÿddr
), 
__func__
, 
i¢ew
);

843 ià(
i¢ew
)

844 
	`©h_¿‹_ùl_»£t
(
sc
, &
ª
->
ª_node
);

845 
	}
}

851 
	$©h_¿‹_ùl_»£t
(
©h_soác
 *
sc
, 
›“80211_node
 *
ni
)

853 
©h_node
 *
ª
 = 
	`ATH_NODE
(
ni
);

854 
§m¶e_node
 *
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

855 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

856 cÚ¡ 
HAL_RATE_TABLE
 *
¹
 = 
sc
->
sc_cu¼©es
;

857 
x
, 
y
;

858 
¤©e
;

860 
¢
->
num_¿‹s
 = 0;

862 ià(
¹
 =ğ
NULL
) {

863 
	`´štk
(
KERN_WARNING
 "nØ¿‹ y‘! mod%u\n", 
sc
->
sc_curmode
);

866 
¢
->
¡©ic_¿‹_ndx
 = -1;

868 
¢
->
num_¿‹s
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
;

869 
x
 = 0; x < 
ni
->
ni_¿‹s
.
rs_Ä©es
; x++) {

870 
¢
->
¿‹s
[
x
].
¿‹
 = 
ni
->
ni_¿‹s
.
rs_¿‹s
[x] & 
IEEE80211_RATE_VAL
;

871 
¢
->
¿‹s
[
x
].
rix
 = 
sc
->
sc_rixm­
[¢->¿‹s[x].
¿‹
];

872 ià(
¢
->
¿‹s
[
x
].
rix
 == 0xff) {

873 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: %s ignore bogus„ix‡t %u\n",

874 
dev_šfo
, 
__func__
, 
x
);

877 
¢
->
¿‹s
[
x
].
¿‹Code
 = 
¹
->
šfo
[¢->¿‹s[x].
rix
].rateCode;

878 
¢
->
¿‹s
[
x
].
shÜtP»ambËR©eCode
 =

879 
¹
->
šfo
[
¢
->
¿‹s
[
x
].
rix
].
¿‹Code
 |

880 
¹
->
šfo
[
¢
->
¿‹s
[
x
].
rix
].
shÜtP»ambË
;

883 
ni
->
ni_tx¿‹
 = 0;

884 
¢
->
num_¿‹s
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
;

886 ià(
¢
->
num_¿‹s
 <= 0) {

887 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
,"%s: % " 
MAC_FMT
 "‚o„ates (fixed %u) \n",

888 
dev_šfo
, 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

889 
v­
->
iv_fixed_¿‹
);

894 ià(
v­
->
iv_fixed_¿‹
 !ğ
IEEE80211_FIXED_RATE_NONE
) {

903 
x
 = 0, 
¤©e
 = 0; x < 
¢
->
num_¿‹s
; x++)

904 ià((
ni
->
ni_¿‹s
.
rs_¿‹s
[
x
] & 
IEEE80211_RATE_VAL
è=ğ
v­
->
iv_fixed_¿‹
)

905 
¤©e
 = 
x
;

907 
	`KASSERT
(((
ni
->
ni_¿‹s
.
rs_¿‹s
[
¤©e
] & 
IEEE80211_RATE_VAL
è=ğ
v­
->
iv_fixed_¿‹
),

908 ("fixed„©%u‚Ù iÀ¿‹ s‘", 
v­
->
iv_fixed_¿‹
));

910 
¢
->
¡©ic_¿‹_ndx
 = 
¤©e
;

911 
ni
->
ni_tx¿‹
 = 
¤©e
;

912 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: % " 
MAC_FMT
 " fixed„ate %u%sMbps\n",

913 
dev_šfo
, 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

914 
¢
->
¿‹s
[
¤©e
].
¿‹
 / 2,

915 (
¢
->
¿‹s
[
¤©e
].
¿‹
 % 0x1) ? ".5" : " ");

920 
y
 = 0; y < 
NUM_PACKET_SIZE_BINS
; y++) {

921 
size
 = 
	`bš_to_size
(
y
);

922 
ndx
 = 0;

923 
¢
->
·ck‘s_£Á
[
y
] = 0;

924 
¢
->
cu¼’t_§m¶e_ndx
[
y
] = -1;

925 
¢
->
Ï¡_§m¶e_ndx
[
y
] = 0;

927 
x
 = 0; x < 
ni
->
ni_¿‹s
.
rs_Ä©es
; x++) {

928 ià(
¢
->
¿‹s
[
x
].
rix
 == 0xff) {

929 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: %s ignore bogus„ix‡t %u\n",

930 
dev_šfo
, 
__func__
, 
x
);

933 
¢
->
¡©s
[
y
][
x
].
sucûssive_çu»s
 = 0;

934 
¢
->
¡©s
[
y
][
x
].
Œ›s
 = 0;

935 
¢
->
¡©s
[
y
][
x
].
tÙ®_·ck‘s
 = 0;

936 
¢
->
¡©s
[
y
][
x
].
·ck‘s_acked
 = 0;

937 
¢
->
¡©s
[
y
][
x
].
Ï¡_tx
 = 0;

939 
¢
->
¡©s
[
y
][
x
].
³rãù_tx_time
 =

940 
	`ÿlc_u£cs_uniÿ¡_·ck‘
(
sc
, 
size
,

941 
¢
->
¿‹s
[
x
].
rix
,

943 
¢
->
¡©s
[
y
][
x
].
av”age_tx_time
 =

944 
¢
->
¡©s
[
y
][
x
].
³rãù_tx_time
;

949 
ndx
 = 
¢
->
num_¿‹s
 - 1;‚dx > 0;‚dx--)

950 ià(
¢
->
¿‹s
[
ndx
].
¿‹
 <= 72)

952 
¢
->
cu¼’t_¿‹
[
y
] = 
ndx
;

955 
	`DPRINTF
(
sc
, 
ATH_DEBUG_RATE
, "%s: % " 
MAC_FMT


957 
dev_šfo
, 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

958 
¢
->
num_¿‹s
,

959 
¢
->
¿‹s
[0].
¿‹
 / 2, sn->rates[0].rate % 0x1 ? ".5" : "",

960 
¢
->
¡©s
[1][0].
³rãù_tx_time
,

961 
¢
->
¿‹s
[¢->
num_¿‹s
-1].
¿‹
 / 2,

962 
¢
->
¿‹s
[¢->
num_¿‹s
-1].
¿‹
 % 0x1 ? ".5" : "",

963 
¢
->
¡©s
[1][¢->
num_¿‹s
-1].
³rãù_tx_time
);

965 
ni
->
ni_tx¿‹
 = 
¢
->
cu¼’t_¿‹
[0];

966 
	}
}

969 
	$©h_¿‹_cb
(*
¬g
, 
›“80211_node
 *
ni
)

971 
	`©h_¿‹_ùl_»£t
(
	`Ãtdev_´iv
(
ni
->
ni_ic
->
ic_dev
),‚i);

972 
	}
}

978 
	$©h_¿‹_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
Ãw¡©e
)

980 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

982 ià(
Ãw¡©e
 =ğ
IEEE80211_S_RUN
) {

983 ià(
ic
->
ic_İmode
 !ğ
IEEE80211_M_STA
) {

987 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
©h_¿‹_cb
, 
NULL
);

989 
	`©h_¿‹_Ãwassoc
(
	`Ãtdev_´iv
(
ic
->
ic_dev
), 
	`ATH_NODE
(
v­
->
iv_bss
), 1);

991 
	}
}

993 
©h_¿‹ù¾
 *

994 
	$©h_¿‹_©ch
(
©h_soác
 *
sc
)

996 
§m¶e_soác
 *
osc
;

997 
	`DPRINTF
(
sc
, 
ATH_DEBUG_ANY
, "%s: %s\n", 
dev_šfo
, 
__func__
);

999 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

1000 
osc
 = 
	`km®loc
((
§m¶e_soác
), 
GFP_ATOMIC
);

1001 ià(
osc
 =ğ
NULL
) {

1002 
	`_MOD_DEC_USE
(
THIS_MODULE
);

1003  
NULL
;

1005 
osc
->
¬c
.
¬c_¥aû
 = (
§m¶e_node
);

1006 
osc
->
¬c
.
¬c_v­_¥aû
 = 0;

1008 
osc
->
©h_smoÙhšg_¿‹
 =‡th_smoothing_rate;

1009 
osc
->
©h_§m¶e_¿‹
 =‡th_sample_rate;

1011  &
osc
->
¬c
;

1012 
	}
}

1015 
	$©h_¿‹_d‘ach
(
©h_¿‹ù¾
 *
¬c
)

1017 
§m¶e_soác
 *
osc
 = (§m¶e_soáø*)
¬c
;

1018 
	`kä“
(
osc
);

1019 
	`_MOD_DEC_USE
(
THIS_MODULE
);

1020 
	}
}

1023 
	$´oc_»ad_nodes
(
›“80211v­
 *
v­
, cÚ¡ 
size
, *
buf
, 
¥aû
)

1025 *
p
 = 
buf
;

1026 
›“80211_node
 *
ni
;

1027 
©h_node
 *
ª
;

1028 
§m¶e_node
 *
¢
;

1029 
›“80211_node_bË
 *
Á
 =

1030 (
›“80211_node_bË
 *)&
v­
->
iv_ic
->
ic_¡a
;

1031 
ndx
;

1032 
size_bš
;

1034 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1035 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

1037 ià(
buf
 + 
¥aû
 < 
p
 + 500)

1039 
ª
 = 
	`ATH_NODE
(
ni
);

1040 
¢
 = 
	`ATH_NODE_SAMPLE
(
ª
);

1042 ià(
	`memcmp
(
v­
->
iv_myaddr
, 
ni
->
ni_maÿddr
,

1043 
IEEE80211_ADDR_LEN
)==0) {

1047 
size_bš
 = 
	`size_to_bš
(
size
);

1048 
p
 +ğ
	`¥rštf
Õ, 
MAC_FMT
 "\n", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

1049 
p
 +ğ
	`¥rštf
(p,

1051 
ndx
 = 0;‚dx < 
¢
->
num_¿‹s
;‚dx++) {

1052 
a
 = 1;

1053 
t
 = 1;

1055 
p
 +ğ
	`¥rštf
(p, "%s",

1056 (
ndx
 =ğ
¢
->
cu¼’t_¿‹
[
size_bš
]) ? "*" : " ");

1058 
p
 +ğ
	`¥rštf
(p, "%3u%s",

1059 
¢
->
¿‹s
[
ndx
].
¿‹
 / 2,

1060 (
¢
->
¿‹s
[
ndx
].
¿‹
 & 0x1) ? ".5" : ".0");

1062 
p
 +ğ
	`¥rštf
(p, "\t%4u\t%4u\t%2u\t%6u",

1063 
¢
->
¡©s
[
size_bš
][
ndx
].
av”age_tx_time
,

1064 
¢
->
¡©s
[
size_bš
][
ndx
].
³rãù_tx_time
,

1065 
¢
->
¡©s
[
size_bš
][
ndx
].
sucûssive_çu»s
,

1066 
¢
->
¡©s
[
size_bš
][
ndx
].
tÙ®_·ck‘s
);

1068 ià(
¢
->
¡©s
[
size_bš
][
ndx
].
tÙ®_·ck‘s
) {

1069 
a
 = 
¢
->
¡©s
[
size_bš
][
ndx
].
tÙ®_·ck‘s
;

1070 
t
 = 
¢
->
¡©s
[
size_bš
][
ndx
].
Œ›s
;

1073 
p
 +ğ
	`¥rštf
Õ, "\t%u.%02u\t\t", 
t
 / 
a
, (t * 100 /‡) % 100);

1074 ià(
¢
->
¡©s
[
size_bš
][
ndx
].
Ï¡_tx
) {

1075 
d
 = 
jiff›s
 -

1076 
¢
->
¡©s
[
size_bš
][
ndx
].
Ï¡_tx
;

1077 
p
 +ğ
	`¥rštf
Õ, "%lu.%02lu", 
d
 / 
HZ
, d % HZ);

1079 
p
 +ğ
	`¥rštf
(p, "-");

1082 
p
 +ğ
	`¥rštf
(p, "\n");

1085 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1087  (
p
 - 
buf
);

1088 
	}
}

1091 
	$´oc_¿‹§m¶e_İ’
(
šode
 *šode, 
fe
 *file)

1093 
´oc_›“80211_´iv
 *
pv
;

1094 
´oc_dœ_’Œy
 *
dp
 = 
	`PDE
(
šode
);

1095 
›“80211v­
 *
v­
 = 
dp
->
d©a
;

1096 
size
;

1098 ià(!(
fe
->
´iv©e_d©a
 = 
	`kz®loc
((
´oc_›“80211_´iv
),

1099 
GFP_KERNEL
)))

1100  -
ENOMEM
;

1103 
pv
 = (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

1104 
pv
->
rbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

1105 ià(!
pv
->
rbuf
) {

1106 
	`kä“
(
pv
);

1107  -
ENOMEM
;

1109 
pv
->
wbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

1110 ià(!
pv
->
wbuf
) {

1111 
	`vä“
(
pv
->
rbuf
);

1112 
	`kä“
(
pv
);

1113  -
ENOMEM
;

1115 
	`mem£t
(
pv
->
wbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

1116 
	`mem£t
(
pv
->
rbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

1117 
pv
->
max_wËn
 = 
MAX_PROC_IEEE80211_SIZE
;

1118 
pv
->
max_¾’
 = 
MAX_PROC_IEEE80211_SIZE
;

1121 
size
 = 
	`sim¶e_¡¹oul
(
dp
->
Çme
 + 10, 
NULL
, 0);

1124 
pv
->
¾’
 = 
	`´oc_»ad_nodes
(
v­
, 
size
,…v->
rbuf
, 
MAX_PROC_IEEE80211_SIZE
);

1126 
	}
}

1128 
fe_İ”©iÚs
 
	g´oc_¿‹§m¶e_İs
 = {

1129 .
»ad
 = 
NULL
,

1130 .
	gwr™e
 = 
NULL
,

1131 .
	gİ’
 = 
´oc_¿‹§m¶e_İ’
,

1132 .
	g»Ëa£
 = 
NULL
,

1136 
	$©h_¿‹_dyÇmic_´oc_»gi¡”
(
›“80211v­
 *
v­
)

1139 
	`›“80211_´oc_vü—‹
(
v­
, &
´oc_¿‹§m¶e_İs
, "ratestats_250");

1140 
	`›“80211_´oc_vü—‹
(
v­
, &
´oc_¿‹§m¶e_İs
, "ratestats_1600");

1141 
	`›“80211_´oc_vü—‹
(
v­
, &
´oc_¿‹§m¶e_İs
, "ratestats_3000");

1142 
	}
}

1144 
›“80211_¿‹_İs
 
	g©h_¿‹_İs
 = {

1145 .
¿‹ùl_id
 = 
IEEE80211_RATE_SAMPLE
,

1146 .
	gnode_š™
 = 
©h_¿‹_node_š™
,

1147 .
	gnode_ş—nup
 = 
©h_¿‹_node_ş—nup
,

1148 .
	gfšd¿‹
 = 
©h_¿‹_fšd¿‹
,

1149 .
	gg‘_m¼
 = 
©h_¿‹_g‘_m¼
,

1150 .
	gtx_com¶‘e
 = 
©h_¿‹_tx_com¶‘e
,

1151 .
	gÃwassoc
 = 
©h_¿‹_Ãwassoc
,

1152 .
	gÃw¡©e
 = 
©h_¿‹_Ãw¡©e
,

1153 .
	g©ch
 = 
©h_¿‹_©ch
,

1154 .
	gd‘ach
 = 
©h_¿‹_d‘ach
,

1155 .
	gdyÇmic_´oc_»gi¡”
 = 
©h_¿‹_dyÇmic_´oc_»gi¡”
,

1158 
MODULE_AUTHOR
("John Bicket");

1159 
MODULE_DESCRIPTION
("SampleRate bit-rate selection‡lgorithm for Atheros devices");

1160 #ifdeà
MODULE_VERSION


1161 
MODULE_VERSION
(
RELEASE_VERSION
);

1163 #ifdeà
MODULE_LICENSE


1164 
MODULE_LICENSE
("Dual BSD/GPL");

1167 
__š™


1168 
	$š™_©h_¿‹_§m¶e
()

1170  
	`›“80211_¿‹_»gi¡”
(&
©h_¿‹_İs
);

1171 
	}
}

1172 
moduË_š™
(
š™_©h_¿‹_§m¶e
);

1174 
__ex™


1175 
	$ex™_©h_¿‹_§m¶e
()

1177 
	`›“80211_¿‹_uÄegi¡”
(&
©h_¿‹_İs
);

1178 
	}
}

1179 
moduË_ex™
(
ex™_©h_¿‹_§m¶e
);

	@sample/sample.h

42 #iâdeà
_DEV_ATH_RATE_SAMPLE_H


43 
	#_DEV_ATH_RATE_SAMPLE_H


	)

46 
	s§m¶e_soác
 {

47 
©h_¿‹ù¾
 
	m¬c
;

48 
	m©h_smoÙhšg_¿‹
;

49 
	m©h_§m¶e_¿‹
;

51 
	#ATH_SOFTC_SAMPLE
(
sc
è((
§m¶e_soác
 *)sc->
sc_rc
)

	)

53 
	s¿‹_šfo
 {

54 
	m¿‹
;

55 
	mrix
;

56 
	m¿‹Code
;

57 
	mshÜtP»ambËR©eCode
;

61 
	s¿‹_¡©s
 {

62 
	mav”age_tx_time
;

63 
	msucûssive_çu»s
;

64 
	mŒ›s
;

65 
	mtÙ®_·ck‘s
;

66 
	m·ck‘s_acked
;

67 
	m³rãù_tx_time
;

68 
	mÏ¡_tx
;

76 
	#NUM_PACKET_SIZE_BINS
 3

	)

77 
	g·ck‘_size_bšs
[
NUM_PACKET_SIZE_BINS
] = {250, 1600, 3000};

80 
	s§m¶e_node
 {

81 
	m·ck‘_couÁ
;

82 
	m¡©ic_¿‹_ndx
;

83 
	mnum_¿‹s
;

84 
	mcu¼’t_tx_¿‹
;

86 
¿‹_šfo
 
	m¿‹s
[
IEEE80211_RATE_MAXSIZE
];

88 
¿‹_¡©s
 
	m¡©s
[
NUM_PACKET_SIZE_BINS
][
IEEE80211_RATE_MAXSIZE
];

89 
	mÏ¡_§m¶e_ndx
[
NUM_PACKET_SIZE_BINS
];

91 
	mcu¼’t_§m¶e_ndx
[
NUM_PACKET_SIZE_BINS
];

92 
	m·ck‘s_£Á
[
NUM_PACKET_SIZE_BINS
];

94 
	mcu¼’t_¿‹
[
NUM_PACKET_SIZE_BINS
];

95 
	m·ck‘s_sšû_sw™ch
[
NUM_PACKET_SIZE_BINS
];

96 
	mjiff›s_sšû_sw™ch
[
NUM_PACKET_SIZE_BINS
];

98 
	m·ck‘s_sšû_§m¶e
[
NUM_PACKET_SIZE_BINS
];

99 
	m§m¶e_‰
[
NUM_PACKET_SIZE_BINS
];

101 
	#ATH_NODE_SAMPLE
(
ª
è((
§m¶e_node
 *)&ª[1])

	)

104 #iâdeà
MIN


105 
	#MIN
(
a
,
b
è(×è< (bè? (aè: (b))

	)

107 #iâdeà
MAX


108 
	#MAX
(
a
,
b
è(×è> (bè? (aè: (b))

	)

117 
	#ds_ùl2
 
ds_hw
[0]

	)

118 
	#ds_ùl3
 
ds_hw
[1]

	)

121 
	#AR_Xm™D©aTr›s0
 0x000f0000

	)

122 
	#AR_Xm™D©aTr›s0_S
 16

	)

123 
	#AR_Xm™D©aTr›s1
 0x00f00000

	)

124 
	#AR_Xm™D©aTr›s1_S
 20

	)

125 
	#AR_Xm™D©aTr›s2
 0x0f000000

	)

126 
	#AR_Xm™D©aTr›s2_S
 24

	)

127 
	#AR_Xm™D©aTr›s3
 0xf0000000

	)

128 
	#AR_Xm™D©aTr›s3_S
 28

	)

131 
	#AR_Xm™R©e0
 0x0000001à

	)

132 
	#AR_Xm™R©e0_S
 0

	)

133 
	#AR_Xm™R©e1
 0x000003e0

	)

134 
	#AR_Xm™R©e1_S
 5

	)

135 
	#AR_Xm™R©e2
 0x00007c00

	)

136 
	#AR_Xm™R©e2_S
 10

	)

137 
	#AR_Xm™R©e3
 0x000f8000

	)

138 
	#AR_Xm™R©e3_S
 15

	)

140 
	#MS
(
_v
, 
_f
è(((_vè& (_f)è>> _f##
_S
)

	)

	@/usr/include/linux/if_arp.h

23 #iâdeà
_LINUX_IF_ARP_H


24 
	#_LINUX_IF_ARP_H


	)

26 
	~<lšux/Ãtdeviû.h
>

29 
	#ARPHRD_NETROM
 0

	)

30 
	#ARPHRD_ETHER
 1

	)

31 
	#ARPHRD_EETHER
 2

	)

32 
	#ARPHRD_AX25
 3

	)

33 
	#ARPHRD_PRONET
 4

	)

34 
	#ARPHRD_CHAOS
 5

	)

35 
	#ARPHRD_IEEE802
 6

	)

36 
	#ARPHRD_ARCNET
 7

	)

37 
	#ARPHRD_APPLETLK
 8

	)

38 
	#ARPHRD_DLCI
 15

	)

39 
	#ARPHRD_ATM
 19

	)

40 
	#ARPHRD_METRICOM
 23

	)

41 
	#ARPHRD_IEEE1394
 24

	)

42 
	#ARPHRD_EUI64
 27

	)

43 
	#ARPHRD_INFINIBAND
 32

	)

46 
	#ARPHRD_SLIP
 256

	)

47 
	#ARPHRD_CSLIP
 257

	)

48 
	#ARPHRD_SLIP6
 258

	)

49 
	#ARPHRD_CSLIP6
 259

	)

50 
	#ARPHRD_RSRVD
 260

	)

51 
	#ARPHRD_ADAPT
 264

	)

52 
	#ARPHRD_ROSE
 270

	)

53 
	#ARPHRD_X25
 271

	)

54 
	#ARPHRD_HWX25
 272

	)

55 
	#ARPHRD_WIMAX
 273

	)

57 
	#ARPHRD_PPP
 512

	)

58 
	#ARPHRD_CISCO
 513

	)

59 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

60 
	#ARPHRD_LAPB
 516

	)

61 
	#ARPHRD_DDCMP
 517

	)

62 
	#ARPHRD_RAWHDLC
 518

	)

64 
	#ARPHRD_TUNNEL
 768

	)

65 
	#ARPHRD_TUNNEL6
 769

	)

66 
	#ARPHRD_FRAD
 770

	)

67 
	#ARPHRD_SKIP
 771

	)

68 
	#ARPHRD_LOOPBACK
 772

	)

69 
	#ARPHRD_LOCALTLK
 773

	)

70 
	#ARPHRD_FDDI
 774

	)

71 
	#ARPHRD_BIF
 775

	)

72 
	#ARPHRD_SIT
 776

	)

73 
	#ARPHRD_IPDDP
 777

	)

74 
	#ARPHRD_IPGRE
 778

	)

75 
	#ARPHRD_PIMREG
 779

	)

76 
	#ARPHRD_HIPPI
 780

	)

77 
	#ARPHRD_ASH
 781

	)

78 
	#ARPHRD_ECONET
 782

	)

79 
	#ARPHRD_IRDA
 783

	)

81 
	#ARPHRD_FCPP
 784

	)

82 
	#ARPHRD_FCAL
 785

	)

83 
	#ARPHRD_FCPL
 786

	)

84 
	#ARPHRD_FCFABRIC
 787

	)

86 
	#ARPHRD_IEEE802_TR
 800

	)

87 
	#ARPHRD_IEEE80211
 801

	)

88 
	#ARPHRD_IEEE80211_PRISM
 802

	)

89 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

91 
	#ARPHRD_VOID
 0xFFFF

	)

92 
	#ARPHRD_NONE
 0xFFFE

	)

95 
	#ARPOP_REQUEST
 1

	)

96 
	#ARPOP_REPLY
 2

	)

97 
	#ARPOP_RREQUEST
 3

	)

98 
	#ARPOP_RREPLY
 4

	)

99 
	#ARPOP_InREQUEST
 8

	)

100 
	#ARPOP_InREPLY
 9

	)

101 
	#ARPOP_NAK
 10

	)

105 
	s¬´eq
 {

106 
sockaddr
 
	m¬p_·
;

107 
sockaddr
 
	m¬p_ha
;

108 
	m¬p_æags
;

109 
sockaddr
 
	m¬p_Ãtmask
;

110 
	m¬p_dev
[16];

113 
	s¬´eq_Şd
 {

114 
sockaddr
 
	m¬p_·
;

115 
sockaddr
 
	m¬p_ha
;

116 
	m¬p_æags
;

117 
sockaddr
 
	m¬p_Ãtmask
;

121 
	#ATF_COM
 0x02

	)

122 
	#ATF_PERM
 0x04

	)

123 
	#ATF_PUBL
 0x08

	)

124 
	#ATF_USETRAILERS
 0x10

	)

125 
	#ATF_NETMASK
 0x20

	)

127 
	#ATF_DONTPUB
 0x40

	)

133 
	s¬phdr


135 
__be16
 
	m¬_hrd
;

136 
__be16
 
	m¬_´o
;

137 
	m¬_hÊ
;

138 
	m¬_¶n
;

139 
__be16
 
	m¬_İ
;

145 
	m¬_sha
[
ETH_ALEN
];

146 
	m¬_s
[4];

147 
	m¬_tha
[
ETH_ALEN
];

148 
	m¬_t
[4];

	@/usr/include/linux/net.h

18 #iâdeà
_LINUX_NET_H


19 
	#_LINUX_NET_H


	)

21 
	~<lšux/wa™.h
>

22 
	~<asm/sock‘.h
>

24 
	gpŞl_bË_¡ruù
;

25 
	gšode
;

26 
	gÃt
;

28 
	#NPROTO
 34

	)

30 
	#SYS_SOCKET
 1

	)

31 
	#SYS_BIND
 2

	)

32 
	#SYS_CONNECT
 3

	)

33 
	#SYS_LISTEN
 4

	)

34 
	#SYS_ACCEPT
 5

	)

35 
	#SYS_GETSOCKNAME
 6

	)

36 
	#SYS_GETPEERNAME
 7

	)

37 
	#SYS_SOCKETPAIR
 8

	)

38 
	#SYS_SEND
 9

	)

39 
	#SYS_RECV
 10

	)

40 
	#SYS_SENDTO
 11

	)

41 
	#SYS_RECVFROM
 12

	)

42 
	#SYS_SHUTDOWN
 13

	)

43 
	#SYS_SETSOCKOPT
 14

	)

44 
	#SYS_GETSOCKOPT
 15

	)

45 
	#SYS_SENDMSG
 16

	)

46 
	#SYS_RECVMSG
 17

	)

49 
	mSS_FREE
 = 0,

50 
	mSS_UNCONNECTED
,

51 
	mSS_CONNECTING
,

52 
	mSS_CONNECTED
,

53 
	mSS_DISCONNECTING


54 } 
	tsock‘_¡©e
;

56 
	#__SO_ACCEPTCON
 (1 << 16è

	)

	@/usr/include/linux/netdevice.h

25 #iâdeà
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<lšux/if.h
>

29 
	~<lšux/if_‘h”.h
>

30 
	~<lšux/if_·ck‘.h
>

33 
	#MAX_ADDR_LEN
 32

	)

36 
	#NETDEV_TX_OK
 0

	)

37 
	#NETDEV_TX_BUSY
 1

	)

38 
	#NETDEV_TX_LOCKED
 -1

	)

45 #ià!
defšed
(
CONFIG_AX25
è&& !defšed(
CONFIG_AX25_MODULE
è&& !defšed(
CONFIG_TR
)

46 
	#LL_MAX_HEADER
 32

	)

48 #ià
defšed
(
CONFIG_AX25
è|| defšed(
CONFIG_AX25_MODULE
)

49 
	#LL_MAX_HEADER
 96

	)

51 
	#LL_MAX_HEADER
 48

	)

55 #ià!
defšed
(
CONFIG_NET_IPIP
è&& !defšed(
CONFIG_NET_IPIP_MODULE
) && \

56 !
defšed
(
CONFIG_NET_IPGRE
è&& !defšed(
CONFIG_NET_IPGRE_MODULE
) && \

57 !
defšed
(
CONFIG_IPV6_SIT
è&& !defšed(
CONFIG_IPV6_SIT_MODULE
) && \

58 !
defšed
(
CONFIG_IPV6_TUNNEL
è&& !
	$defšed
(
CONFIG_IPV6_TUNNEL_MODULE
)

59 
	#MAX_HEADER
 
LL_MAX_HEADER


	)

61 
	#MAX_HEADER
 (
LL_MAX_HEADER
 + 48)

	)

64 
	sÃt_deviû_subqueue


69 
¡©e
;

77 
	sÃt_deviû_¡©s


79 
rx_·ck‘s
;

80 
tx_·ck‘s
;

81 
rx_by‹s
;

82 
tx_by‹s
;

83 
rx_”rÜs
;

84 
tx_”rÜs
;

85 
rx_drİ³d
;

86 
tx_drİ³d
;

87 
muÉiÿ¡
;

88 
cŞlisiÚs
;

91 
rx_Ëngth_”rÜs
;

92 
rx_ov”_”rÜs
;

93 
rx_üc_”rÜs
;

94 
rx_äame_”rÜs
;

95 
rx_fifo_”rÜs
;

96 
rx_mis£d_”rÜs
;

99 
tx_abÜ‹d_”rÜs
;

100 
tx_ÿ¼›r_”rÜs
;

101 
tx_fifo_”rÜs
;

102 
tx_h—¹b—t_”rÜs
;

103 
tx_wšdow_”rÜs
;

106 
rx_com´es£d
;

107 
tx_com´es£d
;

113 
IF_PORT_UNKNOWN
 = 0,

114 
IF_PORT_10BASE2
,

115 
IF_PORT_10BASET
,

116 
IF_PORT_AUI
,

117 
IF_PORT_100BASET
,

118 
IF_PORT_100BASETX
,

119 
IF_PORT_100BASEFX


	@/usr/include/linux/random.h

7 #iâdeà
_LINUX_RANDOM_H


8 
	#_LINUX_RANDOM_H


	)

10 
	~<lšux/ioùl.h
>

15 
	#RNDGETENTCNT
 
	`_IOR
Ğ'R', 0x00, )

	)

18 
	#RNDADDTOENTCNT
 
	`_IOW
Ğ'R', 0x01, )

	)

21 
	#RNDGETPOOL
 
	`_IOR
Ğ'R', 0x02, [2] )

	)

27 
	#RNDADDENTROPY
 
	`_IOW
Ğ'R', 0x03, [2] )

	)

30 
	#RNDZAPENTCNT
 
	`_IO
Ğ'R', 0x04 )

	)

33 
	#RNDCLEARPOOL
 
	`_IO
Ğ'R', 0x06 )

	)

35 
	s¿nd_poŞ_šfo
 {

36 
	m’Œİy_couÁ
;

37 
	mbuf_size
;

38 
__u32
 
	mbuf
[0];

	@/usr/include/linux/sysctl.h

25 #iâdeà
_LINUX_SYSCTL_H


26 
	#_LINUX_SYSCTL_H


	)

28 
	~<lšux/k”Ãl.h
>

29 
	~<lšux/ty³s.h
>

31 
	gfe
;

32 
	gcom¶‘iÚ
;

34 
	#CTL_MAXNAME
 10

	)

39 
	s__sysùl_¬gs
 {

40 *
	mÇme
;

41 
	mÆ’
;

42 *
	mŞdv®
;

43 
size_t
 *
	mŞdËÅ
;

44 *
	mÃwv®
;

45 
size_t
 
	mÃwËn
;

46 
	m__unu£d
[4];

57 
	mCTL_KERN
=1,

58 
	mCTL_VM
=2,

59 
	mCTL_NET
=3,

60 
	mCTL_PROC
=4,

61 
	mCTL_FS
=5,

62 
	mCTL_DEBUG
=6,

63 
	mCTL_DEV
=7,

64 
	mCTL_BUS
=8,

65 
	mCTL_ABI
=9,

66 
	mCTL_CPU
=10,

67 
	mCTL_ARLAN
=254,

68 
	mCTL_S390DBF
=5677,

69 
	mCTL_SUNRPC
=7249,

70 
	mCTL_PM
=9899,

71 
	mCTL_FRV
=9898,

77 
	mCTL_BUS_ISA
=1

83 
	mINOTIFY_MAX_USER_INSTANCES
=1,

84 
	mINOTIFY_MAX_USER_WATCHES
=2,

85 
	mINOTIFY_MAX_QUEUED_EVENTS
=3

91 
	mKERN_OSTYPE
=1,

92 
	mKERN_OSRELEASE
=2,

93 
	mKERN_OSREV
=3,

94 
	mKERN_VERSION
=4,

95 
	mKERN_SECUREMASK
=5,

96 
	mKERN_PROF
=6,

97 
	mKERN_NODENAME
=7,

98 
	mKERN_DOMAINNAME
=8,

100 
	mKERN_CAP_BSET
=14,

101 
	mKERN_PANIC
=15,

102 
	mKERN_REALROOTDEV
=16,

104 
	mKERN_SPARC_REBOOT
=21,

105 
	mKERN_CTLALTDEL
=22,

106 
	mKERN_PRINTK
=23,

107 
	mKERN_NAMETRANS
=24,

108 
	mKERN_PPC_HTABRECLAIM
=25,

109 
	mKERN_PPC_ZEROPAGED
=26,

110 
	mKERN_PPC_POWERSAVE_NAP
=27,

111 
	mKERN_MODPROBE
=28,

112 
	mKERN_SG_BIG_BUFF
=29,

113 
	mKERN_ACCT
=30,

114 
	mKERN_PPC_L2CR
=31,

116 
	mKERN_RTSIGNR
=32,

117 
	mKERN_RTSIGMAX
=33,

119 
	mKERN_SHMMAX
=34,

120 
	mKERN_MSGMAX
=35,

121 
	mKERN_MSGMNB
=36,

122 
	mKERN_MSGPOOL
=37,

123 
	mKERN_SYSRQ
=38,

124 
	mKERN_MAX_THREADS
=39,

125 
	mKERN_RANDOM
=40,

126 
	mKERN_SHMALL
=41,

127 
	mKERN_MSGMNI
=42,

128 
	mKERN_SEM
=43,

129 
	mKERN_SPARC_STOP_A
=44,

130 
	mKERN_SHMMNI
=45,

131 
	mKERN_OVERFLOWUID
=46,

132 
	mKERN_OVERFLOWGID
=47,

133 
	mKERN_SHMPATH
=48,

134 
	mKERN_HOTPLUG
=49,

135 
	mKERN_IEEE_EMULATION_WARNINGS
=50,

136 
	mKERN_S390_USER_DEBUG_LOGGING
=51,

137 
	mKERN_CORE_USES_PID
=52,

138 
	mKERN_TAINTED
=53,

139 
	mKERN_CADPID
=54,

140 
	mKERN_PIDMAX
=55,

141 
	mKERN_CORE_PATTERN
=56,

142 
	mKERN_PANIC_ON_OOPS
=57,

143 
	mKERN_HPPA_PWRSW
=58,

144 
	mKERN_HPPA_UNALIGNED
=59,

145 
	mKERN_PRINTK_RATELIMIT
=60,

146 
	mKERN_PRINTK_RATELIMIT_BURST
=61,

147 
	mKERN_PTY
=62,

148 
	mKERN_NGROUPS_MAX
=63,

149 
	mKERN_SPARC_SCONS_PWROFF
=64,

150 
	mKERN_HZ_TIMER
=65,

151 
	mKERN_UNKNOWN_NMI_PANIC
=66,

152 
	mKERN_BOOTLOADER_TYPE
=67,

153 
	mKERN_RANDOMIZE
=68,

154 
	mKERN_SETUID_DUMPABLE
=69,

155 
	mKERN_SPIN_RETRY
=70,

156 
	mKERN_ACPI_VIDEO_FLAGS
=71,

157 
	mKERN_IA64_UNALIGNED
=72,

158 
	mKERN_COMPAT_LOG
=73,

159 
	mKERN_MAX_LOCK_DEPTH
=74,

160 
	mKERN_NMI_WATCHDOG
=75,

161 
	mKERN_PANIC_ON_NMI
=76,

169 
	mVM_UNUSED1
=1,

170 
	mVM_UNUSED2
=2,

171 
	mVM_UNUSED3
=3,

172 
	mVM_UNUSED4
=4,

173 
	mVM_OVERCOMMIT_MEMORY
=5,

174 
	mVM_UNUSED5
=6,

175 
	mVM_UNUSED7
=7,

176 
	mVM_UNUSED8
=8,

177 
	mVM_UNUSED9
=9,

178 
	mVM_PAGE_CLUSTER
=10,

179 
	mVM_DIRTY_BACKGROUND
=11,

180 
	mVM_DIRTY_RATIO
=12,

181 
	mVM_DIRTY_WB_CS
=13,

182 
	mVM_DIRTY_EXPIRE_CS
=14,

183 
	mVM_NR_PDFLUSH_THREADS
=15,

184 
	mVM_OVERCOMMIT_RATIO
=16,

185 
	mVM_PAGEBUF
=17,

186 
	mVM_HUGETLB_PAGES
=18,

187 
	mVM_SWAPPINESS
=19,

188 
	mVM_LOWMEM_RESERVE_RATIO
=20,

189 
	mVM_MIN_FREE_KBYTES
=21,

190 
	mVM_MAX_MAP_COUNT
=22,

191 
	mVM_LAPTOP_MODE
=23,

192 
	mVM_BLOCK_DUMP
=24,

193 
	mVM_HUGETLB_GROUP
=25,

194 
	mVM_VFS_CACHE_PRESSURE
=26,

195 
	mVM_LEGACY_VA_LAYOUT
=27,

196 
	mVM_SWAP_TOKEN_TIMEOUT
=28,

197 
	mVM_DROP_PAGECACHE
=29,

198 
	mVM_PERCPU_PAGELIST_FRACTION
=30,

199 
	mVM_ZONE_RECLAIM_MODE
=31,

200 
	mVM_MIN_UNMAPPED
=32,

201 
	mVM_PANIC_ON_OOM
=33,

202 
	mVM_VDSO_ENABLED
=34,

203 
	mVM_MIN_SLAB
=35,

210 
	mNET_CORE
=1,

211 
	mNET_ETHER
=2,

212 
	mNET_802
=3,

213 
	mNET_UNIX
=4,

214 
	mNET_IPV4
=5,

215 
	mNET_IPX
=6,

216 
	mNET_ATALK
=7,

217 
	mNET_NETROM
=8,

218 
	mNET_AX25
=9,

219 
	mNET_BRIDGE
=10,

220 
	mNET_ROSE
=11,

221 
	mNET_IPV6
=12,

222 
	mNET_X25
=13,

223 
	mNET_TR
=14,

224 
	mNET_DECNET
=15,

225 
	mNET_ECONET
=16,

226 
	mNET_SCTP
=17,

227 
	mNET_LLC
=18,

228 
	mNET_NETFILTER
=19,

229 
	mNET_DCCP
=20,

230 
	mNET_IRDA
=412,

236 
	mRANDOM_POOLSIZE
=1,

237 
	mRANDOM_ENTROPY_COUNT
=2,

238 
	mRANDOM_READ_THRESH
=3,

239 
	mRANDOM_WRITE_THRESH
=4,

240 
	mRANDOM_BOOT_ID
=5,

241 
	mRANDOM_UUID
=6

247 
	mPTY_MAX
=1,

248 
	mPTY_NR
=2

254 
	mBUS_ISA_MEM_BASE
=1,

255 
	mBUS_ISA_PORT_BASE
=2,

256 
	mBUS_ISA_PORT_SHIFT
=3

262 
	mNET_CORE_WMEM_MAX
=1,

263 
	mNET_CORE_RMEM_MAX
=2,

264 
	mNET_CORE_WMEM_DEFAULT
=3,

265 
	mNET_CORE_RMEM_DEFAULT
=4,

267 
	mNET_CORE_MAX_BACKLOG
=6,

268 
	mNET_CORE_FASTROUTE
=7,

269 
	mNET_CORE_MSG_COST
=8,

270 
	mNET_CORE_MSG_BURST
=9,

271 
	mNET_CORE_OPTMEM_MAX
=10,

272 
	mNET_CORE_HOT_LIST_LENGTH
=11,

273 
	mNET_CORE_DIVERT_VERSION
=12,

274 
	mNET_CORE_NO_CONG_THRESH
=13,

275 
	mNET_CORE_NO_CONG
=14,

276 
	mNET_CORE_LO_CONG
=15,

277 
	mNET_CORE_MOD_CONG
=16,

278 
	mNET_CORE_DEV_WEIGHT
=17,

279 
	mNET_CORE_SOMAXCONN
=18,

280 
	mNET_CORE_BUDGET
=19,

281 
	mNET_CORE_AEVENT_ETIME
=20,

282 
	mNET_CORE_AEVENT_RSEQTH
=21,

283 
	mNET_CORE_WARNINGS
=22,

294 
	mNET_UNIX_DESTROY_DELAY
=1,

295 
	mNET_UNIX_DELETE_DELAY
=2,

296 
	mNET_UNIX_MAX_DGRAM_QLEN
=3,

302 
	mNET_NF_CONNTRACK_MAX
=1,

303 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

304 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

305 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

306 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

307 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

308 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

309 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

310 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

311 
	mNET_NF_CONNTRACK_UDP_TIMEOUT
=10,

312 
	mNET_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

313 
	mNET_NF_CONNTRACK_ICMP_TIMEOUT
=12,

314 
	mNET_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

315 
	mNET_NF_CONNTRACK_BUCKETS
=14,

316 
	mNET_NF_CONNTRACK_LOG_INVALID
=15,

317 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

318 
	mNET_NF_CONNTRACK_TCP_LOOSE
=17,

319 
	mNET_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

320 
	mNET_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

321 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

322 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

323 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

324 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

325 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

326 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

327 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

328 
	mNET_NF_CONNTRACK_COUNT
=27,

329 
	mNET_NF_CONNTRACK_ICMPV6_TIMEOUT
=28,

330 
	mNET_NF_CONNTRACK_FRAG6_TIMEOUT
=29,

331 
	mNET_NF_CONNTRACK_FRAG6_LOW_THRESH
=30,

332 
	mNET_NF_CONNTRACK_FRAG6_HIGH_THRESH
=31,

333 
	mNET_NF_CONNTRACK_CHECKSUM
=32,

340 
	mNET_IPV4_FORWARD
=8,

341 
	mNET_IPV4_DYNADDR
=9,

343 
	mNET_IPV4_CONF
=16,

344 
	mNET_IPV4_NEIGH
=17,

345 
	mNET_IPV4_ROUTE
=18,

346 
	mNET_IPV4_FIB_HASH
=19,

347 
	mNET_IPV4_NETFILTER
=20,

349 
	mNET_IPV4_TCP_TIMESTAMPS
=33,

350 
	mNET_IPV4_TCP_WINDOW_SCALING
=34,

351 
	mNET_IPV4_TCP_SACK
=35,

352 
	mNET_IPV4_TCP_RETRANS_COLLAPSE
=36,

353 
	mNET_IPV4_DEFAULT_TTL
=37,

354 
	mNET_IPV4_AUTOCONFIG
=38,

355 
	mNET_IPV4_NO_PMTU_DISC
=39,

356 
	mNET_IPV4_TCP_SYN_RETRIES
=40,

357 
	mNET_IPV4_IPFRAG_HIGH_THRESH
=41,

358 
	mNET_IPV4_IPFRAG_LOW_THRESH
=42,

359 
	mNET_IPV4_IPFRAG_TIME
=43,

360 
	mNET_IPV4_TCP_MAX_KA_PROBES
=44,

361 
	mNET_IPV4_TCP_KEEPALIVE_TIME
=45,

362 
	mNET_IPV4_TCP_KEEPALIVE_PROBES
=46,

363 
	mNET_IPV4_TCP_RETRIES1
=47,

364 
	mNET_IPV4_TCP_RETRIES2
=48,

365 
	mNET_IPV4_TCP_FIN_TIMEOUT
=49,

366 
	mNET_IPV4_IP_MASQ_DEBUG
=50,

367 
	mNET_TCP_SYNCOOKIES
=51,

368 
	mNET_TCP_STDURG
=52,

369 
	mNET_TCP_RFC1337
=53,

370 
	mNET_TCP_SYN_TAILDROP
=54,

371 
	mNET_TCP_MAX_SYN_BACKLOG
=55,

372 
	mNET_IPV4_LOCAL_PORT_RANGE
=56,

373 
	mNET_IPV4_ICMP_ECHO_IGNORE_ALL
=57,

374 
	mNET_IPV4_ICMP_ECHO_IGNORE_BROADCASTS
=58,

375 
	mNET_IPV4_ICMP_SOURCEQUENCH_RATE
=59,

376 
	mNET_IPV4_ICMP_DESTUNREACH_RATE
=60,

377 
	mNET_IPV4_ICMP_TIMEEXCEED_RATE
=61,

378 
	mNET_IPV4_ICMP_PARAMPROB_RATE
=62,

379 
	mNET_IPV4_ICMP_ECHOREPLY_RATE
=63,

380 
	mNET_IPV4_ICMP_IGNORE_BOGUS_ERROR_RESPONSES
=64,

381 
	mNET_IPV4_IGMP_MAX_MEMBERSHIPS
=65,

382 
	mNET_TCP_TW_RECYCLE
=66,

383 
	mNET_IPV4_ALWAYS_DEFRAG
=67,

384 
	mNET_IPV4_TCP_KEEPALIVE_INTVL
=68,

385 
	mNET_IPV4_INET_PEER_THRESHOLD
=69,

386 
	mNET_IPV4_INET_PEER_MINTTL
=70,

387 
	mNET_IPV4_INET_PEER_MAXTTL
=71,

388 
	mNET_IPV4_INET_PEER_GC_MINTIME
=72,

389 
	mNET_IPV4_INET_PEER_GC_MAXTIME
=73,

390 
	mNET_TCP_ORPHAN_RETRIES
=74,

391 
	mNET_TCP_ABORT_ON_OVERFLOW
=75,

392 
	mNET_TCP_SYNACK_RETRIES
=76,

393 
	mNET_TCP_MAX_ORPHANS
=77,

394 
	mNET_TCP_MAX_TW_BUCKETS
=78,

395 
	mNET_TCP_FACK
=79,

396 
	mNET_TCP_REORDERING
=80,

397 
	mNET_TCP_ECN
=81,

398 
	mNET_TCP_DSACK
=82,

399 
	mNET_TCP_MEM
=83,

400 
	mNET_TCP_WMEM
=84,

401 
	mNET_TCP_RMEM
=85,

402 
	mNET_TCP_APP_WIN
=86,

403 
	mNET_TCP_ADV_WIN_SCALE
=87,

404 
	mNET_IPV4_NONLOCAL_BIND
=88,

405 
	mNET_IPV4_ICMP_RATELIMIT
=89,

406 
	mNET_IPV4_ICMP_RATEMASK
=90,

407 
	mNET_TCP_TW_REUSE
=91,

408 
	mNET_TCP_FRTO
=92,

409 
	mNET_TCP_LOW_LATENCY
=93,

410 
	mNET_IPV4_IPFRAG_SECRET_INTERVAL
=94,

411 
	mNET_IPV4_IGMP_MAX_MSF
=96,

412 
	mNET_TCP_NO_METRICS_SAVE
=97,

413 
	mNET_TCP_DEFAULT_WIN_SCALE
=105,

414 
	mNET_TCP_MODERATE_RCVBUF
=106,

415 
	mNET_TCP_TSO_WIN_DIVISOR
=107,

416 
	mNET_TCP_BIC_BETA
=108,

417 
	mNET_IPV4_ICMP_ERRORS_USE_INBOUND_IFADDR
=109,

418 
	mNET_TCP_CONG_CONTROL
=110,

419 
	mNET_TCP_ABC
=111,

420 
	mNET_IPV4_IPFRAG_MAX_DIST
=112,

421 
	mNET_TCP_MTU_PROBING
=113,

422 
	mNET_TCP_BASE_MSS
=114,

423 
	mNET_IPV4_TCP_WORKAROUND_SIGNED_WINDOWS
=115,

424 
	mNET_TCP_DMA_COPYBREAK
=116,

425 
	mNET_TCP_SLOW_START_AFTER_IDLE
=117,

426 
	mNET_CIPSOV4_CACHE_ENABLE
=118,

427 
	mNET_CIPSOV4_CACHE_BUCKET_SIZE
=119,

428 
	mNET_CIPSOV4_RBM_OPTFMT
=120,

429 
	mNET_CIPSOV4_RBM_STRICTVALID
=121,

430 
	mNET_TCP_AVAIL_CONG_CONTROL
=122,

431 
	mNET_TCP_ALLOWED_CONG_CONTROL
=123,

432 
	mNET_TCP_MAX_SSTHRESH
=124,

433 
	mNET_TCP_FRTO_RESPONSE
=125,

437 
	mNET_IPV4_ROUTE_FLUSH
=1,

438 
	mNET_IPV4_ROUTE_MIN_DELAY
=2,

439 
	mNET_IPV4_ROUTE_MAX_DELAY
=3,

440 
	mNET_IPV4_ROUTE_GC_THRESH
=4,

441 
	mNET_IPV4_ROUTE_MAX_SIZE
=5,

442 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL
=6,

443 
	mNET_IPV4_ROUTE_GC_TIMEOUT
=7,

444 
	mNET_IPV4_ROUTE_GC_INTERVAL
=8,

445 
	mNET_IPV4_ROUTE_REDIRECT_LOAD
=9,

446 
	mNET_IPV4_ROUTE_REDIRECT_NUMBER
=10,

447 
	mNET_IPV4_ROUTE_REDIRECT_SILENCE
=11,

448 
	mNET_IPV4_ROUTE_ERROR_COST
=12,

449 
	mNET_IPV4_ROUTE_ERROR_BURST
=13,

450 
	mNET_IPV4_ROUTE_GC_ELASTICITY
=14,

451 
	mNET_IPV4_ROUTE_MTU_EXPIRES
=15,

452 
	mNET_IPV4_ROUTE_MIN_PMTU
=16,

453 
	mNET_IPV4_ROUTE_MIN_ADVMSS
=17,

454 
	mNET_IPV4_ROUTE_SECRET_INTERVAL
=18,

455 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL_MS
=19,

460 
	mNET_PROTO_CONF_ALL
=-2,

461 
	mNET_PROTO_CONF_DEFAULT
=-3

468 
	mNET_IPV4_CONF_FORWARDING
=1,

469 
	mNET_IPV4_CONF_MC_FORWARDING
=2,

470 
	mNET_IPV4_CONF_PROXY_ARP
=3,

471 
	mNET_IPV4_CONF_ACCEPT_REDIRECTS
=4,

472 
	mNET_IPV4_CONF_SECURE_REDIRECTS
=5,

473 
	mNET_IPV4_CONF_SEND_REDIRECTS
=6,

474 
	mNET_IPV4_CONF_SHARED_MEDIA
=7,

475 
	mNET_IPV4_CONF_RP_FILTER
=8,

476 
	mNET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
=9,

477 
	mNET_IPV4_CONF_BOOTP_RELAY
=10,

478 
	mNET_IPV4_CONF_LOG_MARTIANS
=11,

479 
	mNET_IPV4_CONF_TAG
=12,

480 
	mNET_IPV4_CONF_ARPFILTER
=13,

481 
	mNET_IPV4_CONF_MEDIUM_ID
=14,

482 
	mNET_IPV4_CONF_NOXFRM
=15,

483 
	mNET_IPV4_CONF_NOPOLICY
=16,

484 
	mNET_IPV4_CONF_FORCE_IGMP_VERSION
=17,

485 
	mNET_IPV4_CONF_ARP_ANNOUNCE
=18,

486 
	mNET_IPV4_CONF_ARP_IGNORE
=19,

487 
	mNET_IPV4_CONF_PROMOTE_SECONDARIES
=20,

488 
	mNET_IPV4_CONF_ARP_ACCEPT
=21,

489 
	m__NET_IPV4_CONF_MAX


495 
	mNET_IPV4_NF_CONNTRACK_MAX
=1,

496 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

497 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

498 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

499 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

500 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

501 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

502 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

503 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

504 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT
=10,

505 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

506 
	mNET_IPV4_NF_CONNTRACK_ICMP_TIMEOUT
=12,

507 
	mNET_IPV4_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

508 
	mNET_IPV4_NF_CONNTRACK_BUCKETS
=14,

509 
	mNET_IPV4_NF_CONNTRACK_LOG_INVALID
=15,

510 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

511 
	mNET_IPV4_NF_CONNTRACK_TCP_LOOSE
=17,

512 
	mNET_IPV4_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

513 
	mNET_IPV4_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

514 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

515 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

516 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

517 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

518 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

519 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

520 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

521 
	mNET_IPV4_NF_CONNTRACK_COUNT
=27,

522 
	mNET_IPV4_NF_CONNTRACK_CHECKSUM
=28,

527 
	mNET_IPV6_CONF
=16,

528 
	mNET_IPV6_NEIGH
=17,

529 
	mNET_IPV6_ROUTE
=18,

530 
	mNET_IPV6_ICMP
=19,

531 
	mNET_IPV6_BINDV6ONLY
=20,

532 
	mNET_IPV6_IP6FRAG_HIGH_THRESH
=21,

533 
	mNET_IPV6_IP6FRAG_LOW_THRESH
=22,

534 
	mNET_IPV6_IP6FRAG_TIME
=23,

535 
	mNET_IPV6_IP6FRAG_SECRET_INTERVAL
=24,

536 
	mNET_IPV6_MLD_MAX_MSF
=25,

540 
	mNET_IPV6_ROUTE_FLUSH
=1,

541 
	mNET_IPV6_ROUTE_GC_THRESH
=2,

542 
	mNET_IPV6_ROUTE_MAX_SIZE
=3,

543 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL
=4,

544 
	mNET_IPV6_ROUTE_GC_TIMEOUT
=5,

545 
	mNET_IPV6_ROUTE_GC_INTERVAL
=6,

546 
	mNET_IPV6_ROUTE_GC_ELASTICITY
=7,

547 
	mNET_IPV6_ROUTE_MTU_EXPIRES
=8,

548 
	mNET_IPV6_ROUTE_MIN_ADVMSS
=9,

549 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL_MS
=10

553 
	mNET_IPV6_FORWARDING
=1,

554 
	mNET_IPV6_HOP_LIMIT
=2,

555 
	mNET_IPV6_MTU
=3,

556 
	mNET_IPV6_ACCEPT_RA
=4,

557 
	mNET_IPV6_ACCEPT_REDIRECTS
=5,

558 
	mNET_IPV6_AUTOCONF
=6,

559 
	mNET_IPV6_DAD_TRANSMITS
=7,

560 
	mNET_IPV6_RTR_SOLICITS
=8,

561 
	mNET_IPV6_RTR_SOLICIT_INTERVAL
=9,

562 
	mNET_IPV6_RTR_SOLICIT_DELAY
=10,

563 
	mNET_IPV6_USE_TEMPADDR
=11,

564 
	mNET_IPV6_TEMP_VALID_LFT
=12,

565 
	mNET_IPV6_TEMP_PREFERED_LFT
=13,

566 
	mNET_IPV6_REGEN_MAX_RETRY
=14,

567 
	mNET_IPV6_MAX_DESYNC_FACTOR
=15,

568 
	mNET_IPV6_MAX_ADDRESSES
=16,

569 
	mNET_IPV6_FORCE_MLD_VERSION
=17,

570 
	mNET_IPV6_ACCEPT_RA_DEFRTR
=18,

571 
	mNET_IPV6_ACCEPT_RA_PINFO
=19,

572 
	mNET_IPV6_ACCEPT_RA_RTR_PREF
=20,

573 
	mNET_IPV6_RTR_PROBE_INTERVAL
=21,

574 
	mNET_IPV6_ACCEPT_RA_RT_INFO_MAX_PLEN
=22,

575 
	mNET_IPV6_PROXY_NDP
=23,

576 
	mNET_IPV6_ACCEPT_SOURCE_ROUTE
=25,

577 
	m__NET_IPV6_MAX


582 
	mNET_IPV6_ICMP_RATELIMIT
=1

587 
	mNET_NEIGH_MCAST_SOLICIT
=1,

588 
	mNET_NEIGH_UCAST_SOLICIT
=2,

589 
	mNET_NEIGH_APP_SOLICIT
=3,

590 
	mNET_NEIGH_RETRANS_TIME
=4,

591 
	mNET_NEIGH_REACHABLE_TIME
=5,

592 
	mNET_NEIGH_DELAY_PROBE_TIME
=6,

593 
	mNET_NEIGH_GC_STALE_TIME
=7,

594 
	mNET_NEIGH_UNRES_QLEN
=8,

595 
	mNET_NEIGH_PROXY_QLEN
=9,

596 
	mNET_NEIGH_ANYCAST_DELAY
=10,

597 
	mNET_NEIGH_PROXY_DELAY
=11,

598 
	mNET_NEIGH_LOCKTIME
=12,

599 
	mNET_NEIGH_GC_INTERVAL
=13,

600 
	mNET_NEIGH_GC_THRESH1
=14,

601 
	mNET_NEIGH_GC_THRESH2
=15,

602 
	mNET_NEIGH_GC_THRESH3
=16,

603 
	mNET_NEIGH_RETRANS_TIME_MS
=17,

604 
	mNET_NEIGH_REACHABLE_TIME_MS
=18,

605 
	m__NET_NEIGH_MAX


610 
	mNET_DCCP_DEFAULT
=1,

615 
	mNET_IPX_PPROP_BROADCASTING
=1,

616 
	mNET_IPX_FORWARDING
=2

621 
	mNET_LLC2
=1,

622 
	mNET_LLC_STATION
=2,

627 
	mNET_LLC2_TIMEOUT
=1,

632 
	mNET_LLC_STATION_ACK_TIMEOUT
=1,

637 
	mNET_LLC2_ACK_TIMEOUT
=1,

638 
	mNET_LLC2_P_TIMEOUT
=2,

639 
	mNET_LLC2_REJ_TIMEOUT
=3,

640 
	mNET_LLC2_BUSY_TIMEOUT
=4,

645 
	mNET_ATALK_AARP_EXPIRY_TIME
=1,

646 
	mNET_ATALK_AARP_TICK_TIME
=2,

647 
	mNET_ATALK_AARP_RETRANSMIT_LIMIT
=3,

648 
	mNET_ATALK_AARP_RESOLVE_TIME
=4

654 
	mNET_NETROM_DEFAULT_PATH_QUALITY
=1,

655 
	mNET_NETROM_OBSOLESCENCE_COUNT_INITIALISER
=2,

656 
	mNET_NETROM_NETWORK_TTL_INITIALISER
=3,

657 
	mNET_NETROM_TRANSPORT_TIMEOUT
=4,

658 
	mNET_NETROM_TRANSPORT_MAXIMUM_TRIES
=5,

659 
	mNET_NETROM_TRANSPORT_ACKNOWLEDGE_DELAY
=6,

660 
	mNET_NETROM_TRANSPORT_BUSY_DELAY
=7,

661 
	mNET_NETROM_TRANSPORT_REQUESTED_WINDOW_SIZE
=8,

662 
	mNET_NETROM_TRANSPORT_NO_ACTIVITY_TIMEOUT
=9,

663 
	mNET_NETROM_ROUTING_CONTROL
=10,

664 
	mNET_NETROM_LINK_FAILS_COUNT
=11,

665 
	mNET_NETROM_RESET
=12

670 
	mNET_AX25_IP_DEFAULT_MODE
=1,

671 
	mNET_AX25_DEFAULT_MODE
=2,

672 
	mNET_AX25_BACKOFF_TYPE
=3,

673 
	mNET_AX25_CONNECT_MODE
=4,

674 
	mNET_AX25_STANDARD_WINDOW
=5,

675 
	mNET_AX25_EXTENDED_WINDOW
=6,

676 
	mNET_AX25_T1_TIMEOUT
=7,

677 
	mNET_AX25_T2_TIMEOUT
=8,

678 
	mNET_AX25_T3_TIMEOUT
=9,

679 
	mNET_AX25_IDLE_TIMEOUT
=10,

680 
	mNET_AX25_N2
=11,

681 
	mNET_AX25_PACLEN
=12,

682 
	mNET_AX25_PROTOCOL
=13,

683 
	mNET_AX25_DAMA_SLAVE_TIMEOUT
=14

688 
	mNET_ROSE_RESTART_REQUEST_TIMEOUT
=1,

689 
	mNET_ROSE_CALL_REQUEST_TIMEOUT
=2,

690 
	mNET_ROSE_RESET_REQUEST_TIMEOUT
=3,

691 
	mNET_ROSE_CLEAR_REQUEST_TIMEOUT
=4,

692 
	mNET_ROSE_ACK_HOLD_BACK_TIMEOUT
=5,

693 
	mNET_ROSE_ROUTING_CONTROL
=6,

694 
	mNET_ROSE_LINK_FAIL_TIMEOUT
=7,

695 
	mNET_ROSE_MAX_VCS
=8,

696 
	mNET_ROSE_WINDOW_SIZE
=9,

697 
	mNET_ROSE_NO_ACTIVITY_TIMEOUT
=10

702 
	mNET_X25_RESTART_REQUEST_TIMEOUT
=1,

703 
	mNET_X25_CALL_REQUEST_TIMEOUT
=2,

704 
	mNET_X25_RESET_REQUEST_TIMEOUT
=3,

705 
	mNET_X25_CLEAR_REQUEST_TIMEOUT
=4,

706 
	mNET_X25_ACK_HOLD_BACK_TIMEOUT
=5,

707 
	mNET_X25_FORWARD
=6

713 
	mNET_TR_RIF_TIMEOUT
=1

718 
	mNET_DECNET_NODE_TYPE
 = 1,

719 
	mNET_DECNET_NODE_ADDRESS
 = 2,

720 
	mNET_DECNET_NODE_NAME
 = 3,

721 
	mNET_DECNET_DEFAULT_DEVICE
 = 4,

722 
	mNET_DECNET_TIME_WAIT
 = 5,

723 
	mNET_DECNET_DN_COUNT
 = 6,

724 
	mNET_DECNET_DI_COUNT
 = 7,

725 
	mNET_DECNET_DR_COUNT
 = 8,

726 
	mNET_DECNET_DST_GC_INTERVAL
 = 9,

727 
	mNET_DECNET_CONF
 = 10,

728 
	mNET_DECNET_NO_FC_MAX_CWND
 = 11,

729 
	mNET_DECNET_MEM
 = 12,

730 
	mNET_DECNET_RMEM
 = 13,

731 
	mNET_DECNET_WMEM
 = 14,

732 
	mNET_DECNET_DEBUG_LEVEL
 = 255

737 
	mNET_DECNET_CONF_LOOPBACK
 = -2,

738 
	mNET_DECNET_CONF_DDCMP
 = -3,

739 
	mNET_DECNET_CONF_PPP
 = -4,

740 
	mNET_DECNET_CONF_X25
 = -5,

741 
	mNET_DECNET_CONF_GRE
 = -6,

742 
	mNET_DECNET_CONF_ETHER
 = -7

749 
	mNET_DECNET_CONF_DEV_PRIORITY
 = 1,

750 
	mNET_DECNET_CONF_DEV_T1
 = 2,

751 
	mNET_DECNET_CONF_DEV_T2
 = 3,

752 
	mNET_DECNET_CONF_DEV_T3
 = 4,

753 
	mNET_DECNET_CONF_DEV_FORWARDING
 = 5,

754 
	mNET_DECNET_CONF_DEV_BLKSIZE
 = 6,

755 
	mNET_DECNET_CONF_DEV_STATE
 = 7

760 
	mNET_SCTP_RTO_INITIAL
 = 1,

761 
	mNET_SCTP_RTO_MIN
 = 2,

762 
	mNET_SCTP_RTO_MAX
 = 3,

763 
	mNET_SCTP_RTO_ALPHA
 = 4,

764 
	mNET_SCTP_RTO_BETA
 = 5,

765 
	mNET_SCTP_VALID_COOKIE_LIFE
 = 6,

766 
	mNET_SCTP_ASSOCIATION_MAX_RETRANS
 = 7,

767 
	mNET_SCTP_PATH_MAX_RETRANS
 = 8,

768 
	mNET_SCTP_MAX_INIT_RETRANSMITS
 = 9,

769 
	mNET_SCTP_HB_INTERVAL
 = 10,

770 
	mNET_SCTP_PRESERVE_ENABLE
 = 11,

771 
	mNET_SCTP_MAX_BURST
 = 12,

772 
	mNET_SCTP_ADDIP_ENABLE
 = 13,

773 
	mNET_SCTP_PRSCTP_ENABLE
 = 14,

774 
	mNET_SCTP_SNDBUF_POLICY
 = 15,

775 
	mNET_SCTP_SACK_TIMEOUT
 = 16,

776 
	mNET_SCTP_RCVBUF_POLICY
 = 17,

781 
	mNET_BRIDGE_NF_CALL_ARPTABLES
 = 1,

782 
	mNET_BRIDGE_NF_CALL_IPTABLES
 = 2,

783 
	mNET_BRIDGE_NF_CALL_IP6TABLES
 = 3,

784 
	mNET_BRIDGE_NF_FILTER_VLAN_TAGGED
 = 4,

785 
	mNET_BRIDGE_NF_FILTER_PPPOE_TAGGED
 = 5,

790 
	mNET_IRDA_DISCOVERY
=1,

791 
	mNET_IRDA_DEVNAME
=2,

792 
	mNET_IRDA_DEBUG
=3,

793 
	mNET_IRDA_FAST_POLL
=4,

794 
	mNET_IRDA_DISCOVERY_SLOTS
=5,

795 
	mNET_IRDA_DISCOVERY_TIMEOUT
=6,

796 
	mNET_IRDA_SLOT_TIMEOUT
=7,

797 
	mNET_IRDA_MAX_BAUD_RATE
=8,

798 
	mNET_IRDA_MIN_TX_TURN_TIME
=9,

799 
	mNET_IRDA_MAX_TX_DATA_SIZE
=10,

800 
	mNET_IRDA_MAX_TX_WINDOW
=11,

801 
	mNET_IRDA_MAX_NOREPLY_TIME
=12,

802 
	mNET_IRDA_WARN_NOREPLY_TIME
=13,

803 
	mNET_IRDA_LAP_KEEPALIVE_TIME
=14,

810 
	mFS_NRINODE
=1,

811 
	mFS_STATINODE
=2,

812 
	mFS_MAXINODE
=3,

813 
	mFS_NRDQUOT
=4,

814 
	mFS_MAXDQUOT
=5,

815 
	mFS_NRFILE
=6,

816 
	mFS_MAXFILE
=7,

817 
	mFS_DENTRY
=8,

818 
	mFS_NRSUPER
=9,

819 
	mFS_MAXSUPER
=10,

820 
	mFS_OVERFLOWUID
=11,

821 
	mFS_OVERFLOWGID
=12,

822 
	mFS_LEASES
=13,

823 
	mFS_DIR_NOTIFY
=14,

824 
	mFS_LEASE_TIME
=15,

825 
	mFS_DQSTATS
=16,

826 
	mFS_XFS
=17,

827 
	mFS_AIO_NR
=18,

828 
	mFS_AIO_MAX_NR
=19,

829 
	mFS_INOTIFY
=20,

830 
	mFS_OCFS2
=988,

835 
	mFS_DQ_LOOKUPS
 = 1,

836 
	mFS_DQ_DROPS
 = 2,

837 
	mFS_DQ_READS
 = 3,

838 
	mFS_DQ_WRITES
 = 4,

839 
	mFS_DQ_CACHE_HITS
 = 5,

840 
	mFS_DQ_ALLOCATED
 = 6,

841 
	mFS_DQ_FREE
 = 7,

842 
	mFS_DQ_SYNCS
 = 8,

843 
	mFS_DQ_WARNINGS
 = 9,

850 
	mDEV_CDROM
=1,

851 
	mDEV_HWMON
=2,

852 
	mDEV_PARPORT
=3,

853 
	mDEV_RAID
=4,

854 
	mDEV_MAC_HID
=5,

855 
	mDEV_SCSI
=6,

856 
	mDEV_IPMI
=7,

861 
	mDEV_CDROM_INFO
=1,

862 
	mDEV_CDROM_AUTOCLOSE
=2,

863 
	mDEV_CDROM_AUTOEJECT
=3,

864 
	mDEV_CDROM_DEBUG
=4,

865 
	mDEV_CDROM_LOCK
=5,

866 
	mDEV_CDROM_CHECK_MEDIA
=6

871 
	mDEV_PARPORT_DEFAULT
=-3

876 
	mDEV_RAID_SPEED_LIMIT_MIN
=1,

877 
	mDEV_RAID_SPEED_LIMIT_MAX
=2

882 
	mDEV_PARPORT_DEFAULT_TIMESLICE
=1,

883 
	mDEV_PARPORT_DEFAULT_SPINTIME
=2

888 
	mDEV_PARPORT_SPINTIME
=1,

889 
	mDEV_PARPORT_BASE_ADDR
=2,

890 
	mDEV_PARPORT_IRQ
=3,

891 
	mDEV_PARPORT_DMA
=4,

892 
	mDEV_PARPORT_MODES
=5,

893 
	mDEV_PARPORT_DEVICES
=6,

894 
	mDEV_PARPORT_AUTOPROBE
=16

899 
	mDEV_PARPORT_DEVICES_ACTIVE
=-3,

904 
	mDEV_PARPORT_DEVICE_TIMESLICE
=1,

909 
	mDEV_MAC_HID_KEYBOARD_SENDS_LINUX_KEYCODES
=1,

910 
	mDEV_MAC_HID_KEYBOARD_LOCK_KEYCODES
=2,

911 
	mDEV_MAC_HID_MOUSE_BUTTON_EMULATION
=3,

912 
	mDEV_MAC_HID_MOUSE_BUTTON2_KEYCODE
=4,

913 
	mDEV_MAC_HID_MOUSE_BUTTON3_KEYCODE
=5,

914 
	mDEV_MAC_HID_ADB_MOUSE_SENDS_KEYCODES
=6

919 
	mDEV_SCSI_LOGGING_LEVEL
=1,

924 
	mDEV_IPMI_POWEROFF_POWERCYCLE
=1,

930 
	mABI_DEFHANDLER_COFF
=1,

931 
	mABI_DEFHANDLER_ELF
=2,

932 
	mABI_DEFHANDLER_LCALL7
=3,

933 
	mABI_DEFHANDLER_LIBCSO
=4,

934 
	mABI_TRACE
=5,

935 
	mABI_FAKE_UTSNAME
=6,

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 132632

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
è((×è<< 16è+ ((bè<< 8è+ (c))

	)

	@/usr/include/asm/socket.h

1 #iâdeà
_ASM_SOCKET_H


2 
	#_ASM_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

24 
	#SO_BSDCOMPAT
 14

	)

26 
	#SO_PASSCRED
 16

	)

27 
	#SO_PEERCRED
 17

	)

28 
	#SO_RCVLOWAT
 18

	)

29 
	#SO_SNDLOWAT
 19

	)

30 
	#SO_RCVTIMEO
 20

	)

31 
	#SO_SNDTIMEO
 21

	)

34 
	#SO_SECURITY_AUTHENTICATION
 22

	)

35 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

36 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

38 
	#SO_BINDTODEVICE
 25

	)

41 
	#SO_ATTACH_FILTER
 26

	)

42 
	#SO_DETACH_FILTER
 27

	)

44 
	#SO_PEERNAME
 28

	)

45 
	#SO_TIMESTAMP
 29

	)

46 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

48 
	#SO_ACCEPTCONN
 30

	)

50 
	#SO_PEERSEC
 31

	)

51 
	#SO_PASSSEC
 34

	)

52 
	#SO_TIMESTAMPNS
 35

	)

53 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

	@/usr/include/linux/if.h

19 #iâdeà
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<lšux/ty³s.h
>

23 
	~<lšux/sock‘.h
>

25 
	#IFNAMSIZ
 16

	)

26 
	~<lšux/hdlc/ioùl.h
>

29 
	#IFF_UP
 0x1

	)

30 
	#IFF_BROADCAST
 0x2

	)

31 
	#IFF_DEBUG
 0x4

	)

32 
	#IFF_LOOPBACK
 0x8

	)

33 
	#IFF_POINTOPOINT
 0x10

	)

34 
	#IFF_NOTRAILERS
 0x20

	)

35 
	#IFF_RUNNING
 0x40

	)

36 
	#IFF_NOARP
 0x80

	)

37 
	#IFF_PROMISC
 0x100

	)

38 
	#IFF_ALLMULTI
 0x200

	)

40 
	#IFF_MASTER
 0x400

	)

41 
	#IFF_SLAVE
 0x800

	)

43 
	#IFF_MULTICAST
 0x1000

	)

45 
	#IFF_PORTSEL
 0x2000

	)

46 
	#IFF_AUTOMEDIA
 0x4000

	)

47 
	#IFF_DYNAMIC
 0x8000

	)

49 
	#IFF_LOWER_UP
 0x10000

	)

50 
	#IFF_DORMANT
 0x20000

	)

52 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|\

53 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

56 
	#IFF_802_1Q_VLAN
 0x1

	)

57 
	#IFF_EBRIDGE
 0x2

	)

58 
	#IFF_SLAVE_INACTIVE
 0x4

	)

59 
	#IFF_MASTER_8023AD
 0x8

	)

60 
	#IFF_MASTER_ALB
 0x10

	)

61 
	#IFF_BONDING
 0x20

	)

62 
	#IFF_SLAVE_NEEDARP
 0x40

	)

64 
	#IF_GET_IFACE
 0x0001

	)

65 
	#IF_GET_PROTO
 0x0002

	)

68 
	#IF_IFACE_V35
 0x1000

	)

69 
	#IF_IFACE_V24
 0x1001

	)

70 
	#IF_IFACE_X21
 0x1002

	)

71 
	#IF_IFACE_T1
 0x1003

	)

72 
	#IF_IFACE_E1
 0x1004

	)

73 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

74 
	#IF_IFACE_X21D
 0x1006

	)

77 
	#IF_PROTO_HDLC
 0x2000

	)

78 
	#IF_PROTO_PPP
 0x2001

	)

79 
	#IF_PROTO_CISCO
 0x2002

	)

80 
	#IF_PROTO_FR
 0x2003

	)

81 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

82 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

83 
	#IF_PROTO_X25
 0x2006

	)

84 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

85 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

86 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

87 
	#IF_PROTO_FR_PVC
 0x200A

	)

88 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

89 
	#IF_PROTO_RAW
 0x200C

	)

93 
	mIF_OPER_UNKNOWN
,

94 
	mIF_OPER_NOTPRESENT
,

95 
	mIF_OPER_DOWN
,

96 
	mIF_OPER_LOWERLAYERDOWN
,

97 
	mIF_OPER_TESTING
,

98 
	mIF_OPER_DORMANT
,

99 
	mIF_OPER_UP
,

104 
	mIF_LINK_MODE_DEFAULT
,

105 
	mIF_LINK_MODE_DORMANT
,

118 
	sifm­


120 
	mmem_¡¬t
;

121 
	mmem_’d
;

122 
	mba£_addr
;

123 
	mœq
;

124 
	mdma
;

125 
	mpÜt
;

129 
	sif_£‰šgs


131 
	mty³
;

132 
	msize
;

135 
¿w_hdlc_´Ùo
 *
	m¿w_hdlc
;

136 
cisco_´Ùo
 *
	mcisco
;

137 
ä_´Ùo
 *
	mä
;

138 
ä_´Ùo_pvc
 *
	mä_pvc
;

139 
ä_´Ùo_pvc_šfo
 *
	mä_pvc_šfo
;

142 
sync_£rŸl_£‰šgs
 *
	msync
;

143 
‹1_£‰šgs
 *
	m‹1
;

144 } 
	mifs_ifsu
;

154 
	siäeq


156 
	#IFHWADDRLEN
 6

	)

159 
	miän_Çme
[
IFNAMSIZ
];

160 } 
	miä_iän
;

163 
sockaddr
 
	miäu_addr
;

164 
sockaddr
 
	miäu_d¡addr
;

165 
sockaddr
 
	miäu_brßdaddr
;

166 
sockaddr
 
	miäu_Ãtmask
;

167 
sockaddr
 
	miäu_hwaddr
;

168 
	miäu_æags
;

169 
	miäu_iv®ue
;

170 
	miäu_mtu
;

171 
ifm­
 
	miäu_m­
;

172 
	miäu_¦ave
[
IFNAMSIZ
];

173 
	miäu_ÃwÇme
[
IFNAMSIZ
];

174 * 
	miäu_d©a
;

175 
if_£‰šgs
 
	miäu_£‰šgs
;

176 } 
	miä_iäu
;

179 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

180 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

181 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

182 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

183 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

184 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

185 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

186 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

187 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

188 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

189 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

190 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

191 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

192 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

193 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

194 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

195 
	#iä_£‰šgs
 
iä_iäu
.
iäu_£‰šgs


	)

204 
	sifcÚf


206 
	mifc_Ën
;

209 *
	mifcu_buf
;

210 
iäeq
 *
	mifcu_»q
;

211 } 
	mifc_ifcu
;

213 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

214 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

	@/usr/include/linux/if_ether.h

21 #iâdeà
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<lšux/ty³s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_IP
 0x0800

	)

46 
	#ETH_P_X25
 0x0805

	)

47 
	#ETH_P_ARP
 0x0806

	)

48 
	#ETH_P_BPQ
 0x08FF

	)

49 
	#ETH_P_IEEEPUP
 0x0a00

	)

50 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

51 
	#ETH_P_DEC
 0x6000

	)

52 
	#ETH_P_DNA_DL
 0x6001

	)

53 
	#ETH_P_DNA_RC
 0x6002

	)

54 
	#ETH_P_DNA_RT
 0x6003

	)

55 
	#ETH_P_LAT
 0x6004

	)

56 
	#ETH_P_DIAG
 0x6005

	)

57 
	#ETH_P_CUST
 0x6006

	)

58 
	#ETH_P_SCA
 0x6007

	)

59 
	#ETH_P_RARP
 0x8035

	)

60 
	#ETH_P_ATALK
 0x809B

	)

61 
	#ETH_P_AARP
 0x80F3

	)

62 
	#ETH_P_8021Q
 0x8100

	)

63 
	#ETH_P_IPX
 0x8137

	)

64 
	#ETH_P_IPV6
 0x86DD

	)

65 
	#ETH_P_PAUSE
 0x8808

	)

66 
	#ETH_P_SLOW
 0x8809

	)

67 
	#ETH_P_WCCP
 0x883E

	)

69 
	#ETH_P_PPP_DISC
 0x8863

	)

70 
	#ETH_P_PPP_SES
 0x8864

	)

71 
	#ETH_P_MPLS_UC
 0x8847

	)

72 
	#ETH_P_MPLS_MC
 0x8848

	)

73 
	#ETH_P_ATMMPOA
 0x884ø

	)

74 
	#ETH_P_ATMFATE
 0x8884

	)

77 
	#ETH_P_AOE
 0x88A2

	)

78 
	#ETH_P_TIPC
 0x88CA

	)

84 
	#ETH_P_802_3
 0x0001

	)

85 
	#ETH_P_AX25
 0x0002

	)

86 
	#ETH_P_ALL
 0x0003

	)

87 
	#ETH_P_802_2
 0x0004

	)

88 
	#ETH_P_SNAP
 0x0005

	)

89 
	#ETH_P_DDCMP
 0x0006

	)

90 
	#ETH_P_WAN_PPP
 0x0007

	)

91 
	#ETH_P_PPP_MP
 0x0008

	)

92 
	#ETH_P_LOCALTALK
 0x0009

	)

93 
	#ETH_P_PPPTALK
 0x0010

	)

94 
	#ETH_P_TR_802_2
 0x0011

	)

95 
	#ETH_P_MOBITEX
 0x0015

	)

96 
	#ETH_P_CONTROL
 0x0016

	)

97 
	#ETH_P_IRDA
 0x0017

	)

98 
	#ETH_P_ECONET
 0x0018

	)

99 
	#ETH_P_HDLC
 0x0019

	)

100 
	#ETH_P_ARCNET
 0x001A

	)

106 
	s‘hhdr
 {

107 
	mh_de¡
[
ETH_ALEN
];

108 
	mh_sourû
[
ETH_ALEN
];

109 
__be16
 
	mh_´Ùo
;

110 } 
__©Œibu‹__
((
·cked
));

	@/usr/include/linux/if_packet.h

1 #iâdeà
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<lšux/ty³s.h
>

6 
	ssockaddr_pkt


8 
	m¥kt_çmy
;

9 
	m¥kt_deviû
[14];

10 
__be16
 
	m¥kt_´ÙocŞ
;

13 
	ssockaddr_Î


15 
	m¦l_çmy
;

16 
__be16
 
	m¦l_´ÙocŞ
;

17 
	m¦l_ifšdex
;

18 
	m¦l_h©y³
;

19 
	m¦l_pk‰y³
;

20 
	m¦l_h®’
;

21 
	m¦l_addr
[8];

26 
	#PACKET_HOST
 0

	)

27 
	#PACKET_BROADCAST
 1

	)

28 
	#PACKET_MULTICAST
 2

	)

29 
	#PACKET_OTHERHOST
 3

	)

30 
	#PACKET_OUTGOING
 4

	)

32 
	#PACKET_LOOPBACK
 5

	)

33 
	#PACKET_FASTROUTE
 6

	)

37 
	#PACKET_ADD_MEMBERSHIP
 1

	)

38 
	#PACKET_DROP_MEMBERSHIP
 2

	)

39 
	#PACKET_RECV_OUTPUT
 3

	)

41 
	#PACKET_RX_RING
 5

	)

42 
	#PACKET_STATISTICS
 6

	)

43 
	#PACKET_COPY_THRESH
 7

	)

44 
	#PACKET_AUXDATA
 8

	)

45 
	#PACKET_ORIGDEV
 9

	)

47 
	sack‘_¡©s


49 
	m_·ck‘s
;

50 
	m_drİs
;

53 
	sack‘_auxd©a


55 
__u32
 
	m_¡©us
;

56 
__u32
 
	m_Ën
;

57 
__u32
 
	m_¢­Ën
;

58 
__u16
 
	m_mac
;

59 
__u16
 
	m_Ãt
;

62 
	sack‘_hdr


64 
	m_¡©us
;

65 
	#TP_STATUS_KERNEL
 0

	)

66 
	#TP_STATUS_USER
 1

	)

67 
	#TP_STATUS_COPY
 2

	)

68 
	#TP_STATUS_LOSING
 4

	)

69 
	#TP_STATUS_CSUMNOTREADY
 8

	)

70 
	m_Ën
;

71 
	m_¢­Ën
;

72 
	m_mac
;

73 
	m_Ãt
;

74 
	m_£c
;

75 
	m_u£c
;

78 
	#TPACKET_ALIGNMENT
 16

	)

79 
	#TPACKET_ALIGN
(
x
è(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

80 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘_hdr
)è+ (
sockaddr_Î
))

	)

95 
	sack‘_»q


97 
	m_block_size
;

98 
	m_block_Ä
;

99 
	m_äame_size
;

100 
	m_äame_Ä
;

103 
	s·ck‘_m»q


105 
	mmr_ifšdex
;

106 
	mmr_ty³
;

107 
	mmr_®’
;

108 
	mmr_add»ss
[8];

111 
	#PACKET_MR_MULTICAST
 0

	)

112 
	#PACKET_MR_PROMISC
 1

	)

113 
	#PACKET_MR_ALLMULTI
 2

	)

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

9 
	#SI_LOAD_SHIFT
 16

	)

10 
	ssysšfo
 {

11 
	mu±ime
;

12 
	mlßds
[3];

13 
	mtÙ®¿m
;

14 
	mä“¿m
;

15 
	msh¬ed¿m
;

16 
	mbufã¼am
;

17 
	mtÙ®sw­
;

18 
	mä“sw­
;

19 
	m´ocs
;

20 
	m·d
;

21 
	mtÙ®high
;

22 
	mä“high
;

23 
	mmem_un™
;

24 
	m_f
[20-2*()-()];

28 
	#BUILD_BUG_ON
(
cÚd™iÚ
è(()([1 - 2*!!(cÚd™iÚ)]))

	)

34 
	#BUILD_BUG_ON_ZERO
(
e
è(([1 - 2 * !!Ó)]è- 1)

	)

37 
	#__FUNCTION__
 (
__func__
)

	)

40 #ifdeà
CONFIG_NUMA


41 
	#NUMA_BUILD
 1

	)

43 
	#NUMA_BUILD
 0

	)

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

5 
	~<lšux/posix_ty³s.h
>

6 
	~<asm/ty³s.h
>

8 #iâdeà
__KERNEL_STRICT_NAMES


10 
__u32
 
	t__k”Ãl_dev_t
;

12 
__k”Ãl_fd_£t
 
	tfd_£t
;

13 
__k”Ãl_dev_t
 
	tdev_t
;

14 
__k”Ãl_šo_t
 
	tšo_t
;

15 
__k”Ãl_mode_t
 
	tmode_t
;

16 
__k”Ãl_Æšk_t
 
	tÆšk_t
;

17 
__k”Ãl_off_t
 
	toff_t
;

18 
__k”Ãl_pid_t
 
	tpid_t
;

19 
__k”Ãl_daddr_t
 
	tdaddr_t
;

20 
__k”Ãl_key_t
 
	tkey_t
;

21 
__k”Ãl_su£cÚds_t
 
	tsu£cÚds_t
;

22 
__k”Ãl_tim”_t
 
	ttim”_t
;

23 
__k”Ãl_şockid_t
 
	tşockid_t
;

24 
__k”Ãl_mqd_t
 
	tmqd_t
;

26 
__k”Ãl_uid_t
 
	tuid_t
;

27 
__k”Ãl_gid_t
 
	tgid_t
;

29 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

30 
__k”Ãl_loff_t
 
	tloff_t
;

37 #iâdeà
_SIZE_T


38 
	#_SIZE_T


	)

39 
__k”Ãl_size_t
 
	tsize_t
;

42 #iâdeà
_SSIZE_T


43 
	#_SSIZE_T


	)

44 
__k”Ãl_ssize_t
 
	tssize_t
;

47 #iâdeà
_PTRDIFF_T


48 
	#_PTRDIFF_T


	)

49 
__k”Ãl_±rdiff_t
 
	t±rdiff_t
;

52 #iâdeà
_TIME_T


53 
	#_TIME_T


	)

54 
__k”Ãl_time_t
 
	ttime_t
;

57 #iâdeà
_CLOCK_T


58 
	#_CLOCK_T


	)

59 
__k”Ãl_şock_t
 
	tşock_t
;

62 #iâdeà
_CADDR_T


63 
	#_CADDR_T


	)

64 
__k”Ãl_ÿddr_t
 
	tÿddr_t
;

68 
	tu_ch¬
;

69 
	tu_shÜt
;

70 
	tu_št
;

71 
	tu_lÚg
;

74 
	tunch¬
;

75 
	tushÜt
;

76 
	tušt
;

77 
	tulÚg
;

79 #iâdeà
__BIT_TYPES_DEFINED__


80 
	#__BIT_TYPES_DEFINED__


	)

82 
__u8
 
	tu_št8_t
;

83 
__s8
 
	tšt8_t
;

84 
__u16
 
	tu_št16_t
;

85 
__s16
 
	tšt16_t
;

86 
__u32
 
	tu_št32_t
;

87 
__s32
 
	tšt32_t
;

91 
__u8
 
	tušt8_t
;

92 
__u16
 
	tušt16_t
;

93 
__u32
 
	tušt32_t
;

95 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

96 
__u64
 
	tušt64_t
;

97 
__u64
 
	tu_št64_t
;

98 
__s64
 
	tšt64_t
;

102 
	#®igÃd_u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

103 
	#®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

104 
	#®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

112 #ifdeà
CONFIG_LBD


113 
u64
 
	t£ùÜ_t
;

115 
	t£ùÜ_t
;

121 #ifdeà
CONFIG_LSF


122 
u64
 
	tblkút_t
;

124 
	tblkút_t
;

131 #iâdeà
pgoff_t


132 
	#pgoff_t
 

	)

142 #ifdeà
__CHECKER__


143 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

145 
	#__b™wi£__


	)

147 #ifdeà
__CHECK_ENDIAN__


148 
	#__b™wi£
 
__b™wi£__


	)

150 
	#__b™wi£


	)

153 
__u16
 
	t__b™wi£
 
	t__Ë16
;

154 
__u16
 
	t__b™wi£
 
	t__be16
;

155 
__u32
 
	t__b™wi£
 
	t__Ë32
;

156 
__u32
 
	t__b™wi£
 
	t__be32
;

157 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

158 
__u64
 
	t__b™wi£
 
	t__Ë64
;

159 
__u64
 
	t__b™wi£
 
	t__be64
;

161 
__u16
 
	t__b™wi£
 
	t__sum16
;

162 
__u32
 
	t__b™wi£
 
	t__wsum
;

165 
	su¡©
 {

166 
__k”Ãl_daddr_t
 
	mf_tä“
;

167 
__k”Ãl_šo_t
 
	mf_tšode
;

168 
	mf_âame
[6];

169 
	mf_åack
[6];

	@/usr/include/linux/wait.h

1 #iâdeà
_LINUX_WAIT_H


2 
	#_LINUX_WAIT_H


	)

4 
	#WNOHANG
 0x00000001

	)

5 
	#WUNTRACED
 0x00000002

	)

6 
	#WSTOPPED
 
WUNTRACED


	)

7 
	#WEXITED
 0x00000004

	)

8 
	#WCONTINUED
 0x00000008

	)

9 
	#WNOWAIT
 0x01000000

	)

11 
	#__WNOTHREAD
 0x20000000

	)

12 
	#__WALL
 0x40000000

	)

13 
	#__WCLONE
 0x80000000

	)

16 
	#P_ALL
 0

	)

17 
	#P_PID
 1

	)

18 
	#P_PGID
 2

	)

	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/sockios.h

1 #iâdeà
_ASM_X86_SOCKIOS_H


2 
	#_ASM_X86_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 #iâdeà
__ASSEMBLY__


6 
	tumode_t
;

13 
__sigÃd__
 
	t__s8
;

14 
	t__u8
;

16 
__sigÃd__
 
	t__s16
;

17 
	t__u16
;

19 
__sigÃd__
 
	t__s32
;

20 
	t__u32
;

22 #ifdeà
__i386__


23 #ifdeà
__GNUC__


24 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

25 
__ex‹nsiÚ__
 
	t__u64
;

28 
__sigÃd__
 
	t__s64
;

29 
	t__u64
;

	@/usr/include/linux/hdlc/ioctl.h

1 #iâdeà
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

38 
	mşock_¿‹
;

39 
	mşock_ty³
;

40 
	mloİback
;

41 } 
	tsync_£rŸl_£‰šgs
;

44 
	mşock_¿‹
;

45 
	mşock_ty³
;

46 
	mloİback
;

47 
	m¦Ù_m­
;

48 } 
	t‹1_£‰šgs
;

51 
	m’codšg
;

52 
	m·r™y
;

53 } 
	t¿w_hdlc_´Ùo
;

56 
	mt391
;

57 
	mt392
;

58 
	mn391
;

59 
	mn392
;

60 
	mn393
;

61 
	mlmi
;

62 
	mdû
;

63 } 
	tä_´Ùo
;

66 
	mdlci
;

67 } 
	tä_´Ùo_pvc
;

70 
	mdlci
;

71 
	mma¡”
[
IFNAMSIZ
];

72 }
	tä_´Ùo_pvc_šfo
;

75 
	mš‹rv®
;

76 
	mtimeout
;

77 } 
	tcisco_´Ùo
;

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #undeà
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #undeà
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #undeà
__FDELT


31 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

33 #undeà
__FDMASK


34 
	#__FDMASK
(
d
è(1UL << ((dè% 
__NFDBITS
))

	)

37 
	mfds_b™s
 [
__FDSET_LONGS
];

38 } 
	t__k”Ãl_fd_£t
;

41 (*
	t__k”Ãl_sighªdËr_t
)();

44 
	t__k”Ãl_key_t
;

45 
	t__k”Ãl_mqd_t
;

47 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/socket.h

1 #iâdeà
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__®ignof__
 (
sockaddr
 *))

	)

11 
	s__k”Ãl_sockaddr_¡Üage
 {

12 
	mss_çmy
;

14 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

17 } 
__©Œibu‹__
 ((
®igÃd
(
_K_SS_ALIGNSIZE
)));

19 #ià
defšed
(
__KERNEL__
è|| !defšed(
__GLIBC__
) || (__GLIBC__ < 2)

21 
	~<asm/sock‘.h
>

22 
	~<lšux/sockios.h
>

23 
	~<lšux/uio.h
>

24 
	~<lšux/ty³s.h
>

26 
sysùl_somaxcÚn
;

27 #ifdeà
CONFIG_PROC_FS


28 
	g£q_fe
;

29 
sock‘_£q_show
(
£q_fe
 *
£q
);

32 
	t§_çmy_t
;

38 
	ssockaddr
 {

39 
§_çmy_t
 
	m§_çmy
;

40 
	m§_d©a
[14];

43 
	slšg”
 {

44 
	ml_Úoff
;

45 
	ml_lšg”
;

48 
	#sockaddr_¡Üage
 
__k”Ãl_sockaddr_¡Üage


	)

56 
	smsghdr
 {

57 * 
	mmsg_Çme
;

58 
	mmsg_Çm–’
;

59 
iovec
 * 
	mmsg_iov
;

60 
__k”Ãl_size_t
 
	mmsg_iovËn
;

61 * 
	mmsg_cÚŒŞ
;

62 
__k”Ãl_size_t
 
	mmsg_cÚŒŞËn
;

63 
	mmsg_æags
;

72 
	scmsghdr
 {

73 
__k”Ãl_size_t
 
	mcmsg_Ën
;

74 
	mcmsg_Ëv–
;

75 
	mcmsg_ty³
;

83 
	#__CMSG_NXTHDR
(
ùl
, 
Ën
, 
cmsg
è
	`__cmsg_nxthdr
((ùl),Ö’),(cmsg))

	)

84 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`cmsg_nxthdr
((mhdr), (cmsg))

	)

86 
	#CMSG_ALIGN
(
Ën
èĞ(Ö’)+()-1è& ~(()-1è)

	)

88 
	#CMSG_DATA
(
cmsg
è((*)((*)(cmsgè+ 
	`CMSG_ALIGN
((
cmsghdr
))))

	)

89 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
((
cmsghdr
)è+ CMSG_ALIGNÖ’))

	)

90 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
((
cmsghdr
)è+ (Ën))

	)

92 
	#__CMSG_FIRSTHDR
(
ùl
,
Ën
è(Ö’è>ğ(
cmsghdr
) ? \

93 (
cmsghdr
 *)(
ùl
) : \

94 (
cmsghdr
 *)
NULL
)

	)

95 
	#CMSG_FIRSTHDR
(
msg
è
	`__CMSG_FIRSTHDR
((msg)->
msg_cÚŒŞ
, (msg)->
msg_cÚŒŞËn
)

	)

96 
	#CMSG_OK
(
mhdr
, 
cmsg
è((cmsg)->
cmsg_Ën
 >ğ(
cmsghdr
) && \

97 (
cmsg
)->
cmsg_Ën
 <= () \

98 ((
mhdr
)->
msg_cÚŒŞËn
 - \

99 ((*)(
cmsg
è- (*)(
mhdr
)->
msg_cÚŒŞ
)))

	)

105 #ià 
defšed
(
__GNUC__
)

106 
	#__KINLINE
 
__šlše__


	)

107 #–ià
defšed
(
__ılu¥lus
)

108 
	#__KINLINE
 
šlše


	)

110 
	#__KINLINE
 

	)

127 
__KINLINE
 
cmsghdr
 * 
	$__cmsg_nxthdr
(*
__ùl
, 
__k”Ãl_size_t
 
__size
,

128 
cmsghdr
 *
__cmsg
)

130 
cmsghdr
 * 
__±r
;

132 
__±r
 = (
cmsghdr
*)(((*è
__cmsg
è+ 
	`CMSG_ALIGN
(__cmsg->
cmsg_Ën
));

133 ià(()((*)(
__±r
+1è- (*è
__ùl
è> 
__size
)

134  (
cmsghdr
 *)0;

136  
__±r
;

137 
	}
}

139 
__KINLINE
 
cmsghdr
 * 
	$cmsg_nxthdr
 (
msghdr
 *
__msg
, 
cmsghdr
 *
__cmsg
)

141  
	`__cmsg_nxthdr
(
__msg
->
msg_cÚŒŞ
, __msg->
msg_cÚŒŞËn
, 
__cmsg
);

142 
	}
}

146 
	#SCM_RIGHTS
 0x01

	)

147 
	#SCM_CREDENTIALS
 0x02

	)

148 
	#SCM_SECURITY
 0x03

	)

150 
	suüed
 {

151 
__u32
 
	mpid
;

152 
__u32
 
	muid
;

153 
__u32
 
	mgid
;

157 
	#AF_UNSPEC
 0

	)

158 
	#AF_UNIX
 1

	)

159 
	#AF_LOCAL
 1

	)

160 
	#AF_INET
 2

	)

161 
	#AF_AX25
 3

	)

162 
	#AF_IPX
 4

	)

163 
	#AF_APPLETALK
 5

	)

164 
	#AF_NETROM
 6

	)

165 
	#AF_BRIDGE
 7

	)

166 
	#AF_ATMPVC
 8

	)

167 
	#AF_X25
 9

	)

168 
	#AF_INET6
 10

	)

169 
	#AF_ROSE
 11

	)

170 
	#AF_DECÃt
 12

	)

171 
	#AF_NETBEUI
 13

	)

172 
	#AF_SECURITY
 14

	)

173 
	#AF_KEY
 15

	)

174 
	#AF_NETLINK
 16

	)

175 
	#AF_ROUTE
 
AF_NETLINK


	)

176 
	#AF_PACKET
 17

	)

177 
	#AF_ASH
 18

	)

178 
	#AF_ECONET
 19

	)

179 
	#AF_ATMSVC
 20

	)

180 
	#AF_SNA
 22

	)

181 
	#AF_IRDA
 23

	)

182 
	#AF_PPPOX
 24

	)

183 
	#AF_WANPIPE
 25

	)

184 
	#AF_LLC
 26

	)

185 
	#AF_TIPC
 30

	)

186 
	#AF_BLUETOOTH
 31

	)

187 
	#AF_IUCV
 32

	)

188 
	#AF_RXRPC
 33

	)

189 
	#AF_MAX
 34

	)

192 
	#PF_UNSPEC
 
AF_UNSPEC


	)

193 
	#PF_UNIX
 
AF_UNIX


	)

194 
	#PF_LOCAL
 
AF_LOCAL


	)

195 
	#PF_INET
 
AF_INET


	)

196 
	#PF_AX25
 
AF_AX25


	)

197 
	#PF_IPX
 
AF_IPX


	)

198 
	#PF_APPLETALK
 
AF_APPLETALK


	)

199 
	#PF_NETROM
 
AF_NETROM


	)

200 
	#PF_BRIDGE
 
AF_BRIDGE


	)

201 
	#PF_ATMPVC
 
AF_ATMPVC


	)

202 
	#PF_X25
 
AF_X25


	)

203 
	#PF_INET6
 
AF_INET6


	)

204 
	#PF_ROSE
 
AF_ROSE


	)

205 
	#PF_DECÃt
 
AF_DECÃt


	)

206 
	#PF_NETBEUI
 
AF_NETBEUI


	)

207 
	#PF_SECURITY
 
AF_SECURITY


	)

208 
	#PF_KEY
 
AF_KEY


	)

209 
	#PF_NETLINK
 
AF_NETLINK


	)

210 
	#PF_ROUTE
 
AF_ROUTE


	)

211 
	#PF_PACKET
 
AF_PACKET


	)

212 
	#PF_ASH
 
AF_ASH


	)

213 
	#PF_ECONET
 
AF_ECONET


	)

214 
	#PF_ATMSVC
 
AF_ATMSVC


	)

215 
	#PF_SNA
 
AF_SNA


	)

216 
	#PF_IRDA
 
AF_IRDA


	)

217 
	#PF_PPPOX
 
AF_PPPOX


	)

218 
	#PF_WANPIPE
 
AF_WANPIPE


	)

219 
	#PF_LLC
 
AF_LLC


	)

220 
	#PF_TIPC
 
AF_TIPC


	)

221 
	#PF_BLUETOOTH
 
AF_BLUETOOTH


	)

222 
	#PF_IUCV
 
AF_IUCV


	)

223 
	#PF_RXRPC
 
AF_RXRPC


	)

224 
	#PF_MAX
 
AF_MAX


	)

227 
	#SOMAXCONN
 128

	)

233 
	#MSG_OOB
 1

	)

234 
	#MSG_PEEK
 2

	)

235 
	#MSG_DONTROUTE
 4

	)

236 
	#MSG_TRYHARD
 4

	)

237 
	#MSG_CTRUNC
 8

	)

238 
	#MSG_PROBE
 0x10

	)

239 
	#MSG_TRUNC
 0x20

	)

240 
	#MSG_DONTWAIT
 0x40

	)

241 
	#MSG_EOR
 0x80

	)

242 
	#MSG_WAITALL
 0x100

	)

243 
	#MSG_FIN
 0x200

	)

244 
	#MSG_SYN
 0x400

	)

245 
	#MSG_CONFIRM
 0x800

	)

246 
	#MSG_RST
 0x1000

	)

247 
	#MSG_ERRQUEUE
 0x2000

	)

248 
	#MSG_NOSIGNAL
 0x4000

	)

249 
	#MSG_MORE
 0x8000

	)

251 
	#MSG_EOF
 
MSG_FIN


	)

253 
	#MSG_CMSG_CLOEXEC
 0x40000000

	)

256 #ià
defšed
(
CONFIG_COMPAT
)

257 
	#MSG_CMSG_COMPAT
 0x80000000

	)

259 
	#MSG_CMSG_COMPAT
 0

	)

264 
	#SOL_IP
 0

	)

266 
	#SOL_TCP
 6

	)

267 
	#SOL_UDP
 17

	)

268 
	#SOL_IPV6
 41

	)

269 
	#SOL_ICMPV6
 58

	)

270 
	#SOL_SCTP
 132

	)

271 
	#SOL_UDPLITE
 136

	)

272 
	#SOL_RAW
 255

	)

273 
	#SOL_IPX
 256

	)

274 
	#SOL_AX25
 257

	)

275 
	#SOL_ATALK
 258

	)

276 
	#SOL_NETROM
 259

	)

277 
	#SOL_ROSE
 260

	)

278 
	#SOL_DECNET
 261

	)

279 
	#SOL_X25
 262

	)

280 
	#SOL_PACKET
 263

	)

281 
	#SOL_ATM
 264

	)

282 
	#SOL_AAL
 265

	)

283 
	#SOL_IRDA
 266

	)

284 
	#SOL_NETBEUI
 267

	)

285 
	#SOL_LLC
 268

	)

286 
	#SOL_DCCP
 269

	)

287 
	#SOL_NETLINK
 270

	)

288 
	#SOL_TIPC
 271

	)

289 
	#SOL_RXRPC
 272

	)

290 
	#SOL_PPPOL2TP
 273

	)

291 
	#SOL_BLUETOOTH
 274

	)

294 
	#IPX_TYPE
 1

	)

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

24 
	#_IOC_SIZEBITS
 14

	)

25 
	#_IOC_DIRBITS
 2

	)

27 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

28 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

29 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

30 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

32 
	#_IOC_NRSHIFT
 0

	)

33 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

34 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

35 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

40 
	#_IOC_NONE
 0U

	)

41 
	#_IOC_WRITE
 1U

	)

42 
	#_IOC_READ
 2U

	)

44 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

45 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

46 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

47 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

48 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

51 
__šv®id_size_¬gum’t_fÜ_IOC
;

52 
	#_IOC_TYPECHECK
(
t
) \

53 (((
t
) == (t[1]) && \

54 (
t
è< (1 << 
_IOC_SIZEBITS
)) ? \

55 (
t
è: 
__šv®id_size_¬gum’t_fÜ_IOC
)

	)

58 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

59 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

60 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

61 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

62 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

63 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

64 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

67 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

68 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

69 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

70 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

74 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

75 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

76 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

77 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

78 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~"posix_ty³s_32.h
"

4 
	~"posix_ty³s_64.h
"

	@/usr/include/linux/sockios.h

18 #iâdeà
_LINUX_SOCKIOS_H


19 
	#_LINUX_SOCKIOS_H


	)

21 
	~<asm/sockios.h
>

24 
	#SIOCINQ
 
FIONREAD


	)

25 
	#SIOCOUTQ
 
TIOCOUTQ


	)

28 
	#SIOCADDRT
 0x890B

	)

29 
	#SIOCDELRT
 0x890C

	)

30 
	#SIOCRTMSG
 0x890D

	)

33 
	#SIOCGIFNAME
 0x8910

	)

34 
	#SIOCSIFLINK
 0x8911

	)

35 
	#SIOCGIFCONF
 0x8912

	)

36 
	#SIOCGIFFLAGS
 0x8913

	)

37 
	#SIOCSIFFLAGS
 0x8914

	)

38 
	#SIOCGIFADDR
 0x8915

	)

39 
	#SIOCSIFADDR
 0x8916

	)

40 
	#SIOCGIFDSTADDR
 0x8917

	)

41 
	#SIOCSIFDSTADDR
 0x8918

	)

42 
	#SIOCGIFBRDADDR
 0x8919

	)

43 
	#SIOCSIFBRDADDR
 0x891¨

	)

44 
	#SIOCGIFNETMASK
 0x891b

	)

45 
	#SIOCSIFNETMASK
 0x891ø

	)

46 
	#SIOCGIFMETRIC
 0x891d

	)

47 
	#SIOCSIFMETRIC
 0x891

	)

48 
	#SIOCGIFMEM
 0x891à

	)

49 
	#SIOCSIFMEM
 0x8920

	)

50 
	#SIOCGIFMTU
 0x8921

	)

51 
	#SIOCSIFMTU
 0x8922

	)

52 
	#SIOCSIFNAME
 0x8923

	)

53 
	#SIOCSIFHWADDR
 0x8924

	)

54 
	#SIOCGIFENCAP
 0x8925

	)

55 
	#SIOCSIFENCAP
 0x8926

	)

56 
	#SIOCGIFHWADDR
 0x8927

	)

57 
	#SIOCGIFSLAVE
 0x8929

	)

58 
	#SIOCSIFSLAVE
 0x8930

	)

59 
	#SIOCADDMULTI
 0x8931

	)

60 
	#SIOCDELMULTI
 0x8932

	)

61 
	#SIOCGIFINDEX
 0x8933

	)

62 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

63 
	#SIOCSIFPFLAGS
 0x8934

	)

64 
	#SIOCGIFPFLAGS
 0x8935

	)

65 
	#SIOCDIFADDR
 0x8936

	)

66 
	#SIOCSIFHWBROADCAST
 0x8937

	)

67 
	#SIOCGIFCOUNT
 0x8938

	)

69 
	#SIOCGIFBR
 0x8940

	)

70 
	#SIOCSIFBR
 0x8941

	)

72 
	#SIOCGIFTXQLEN
 0x8942

	)

73 
	#SIOCSIFTXQLEN
 0x8943

	)

78 
	#SIOCETHTOOL
 0x8946

	)

80 
	#SIOCGMIIPHY
 0x8947

	)

81 
	#SIOCGMIIREG
 0x8948

	)

82 
	#SIOCSMIIREG
 0x8949

	)

84 
	#SIOCWANDEV
 0x894A

	)

88 
	#SIOCDARP
 0x8953

	)

89 
	#SIOCGARP
 0x8954

	)

90 
	#SIOCSARP
 0x8955

	)

93 
	#SIOCDRARP
 0x8960

	)

94 
	#SIOCGRARP
 0x8961

	)

95 
	#SIOCSRARP
 0x8962

	)

99 
	#SIOCGIFMAP
 0x8970

	)

100 
	#SIOCSIFMAP
 0x8971

	)

104 
	#SIOCADDDLCI
 0x8980

	)

105 
	#SIOCDELDLCI
 0x8981

	)

107 
	#SIOCGIFVLAN
 0x8982

	)

108 
	#SIOCSIFVLAN
 0x8983

	)

112 
	#SIOCBONDENSLAVE
 0x8990

	)

113 
	#SIOCBONDRELEASE
 0x8991

	)

114 
	#SIOCBONDSETHWADDR
 0x8992

	)

115 
	#SIOCBONDSLAVEINFOQUERY
 0x8993

	)

116 
	#SIOCBONDINFOQUERY
 0x8994

	)

117 
	#SIOCBONDCHANGEACTIVE
 0x8995

	)

120 
	#SIOCBRADDBR
 0x89a0

	)

121 
	#SIOCBRDELBR
 0x89a1

	)

122 
	#SIOCBRADDIF
 0x89a2

	)

123 
	#SIOCBRDELIF
 0x89a3

	)

136 
	#SIOCDEVPRIVATE
 0x89F0

	)

142 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/linux/stddef.h

1 #iâdeà
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

5 #undeà
NULL


6 #ià
defšed
(
__ılu¥lus
)

7 
	#NULL
 0

	)

9 
	#NULL
 ((*)0)

	)

	@/usr/include/linux/uio.h

1 #iâdeà
__LINUX_UIO_H


2 
	#__LINUX_UIO_H


	)

4 
	~<lšux/ty³s.h
>

15 
	siovec


17 *
	miov_ba£
;

18 
__k”Ãl_size_t
 
	miov_Ën
;

26 
	#UIO_FASTIOV
 8

	)

27 
	#UIO_MAXIOV
 1024

	)

36 
__šlše__
 
size_t
 
	$iov_Ëngth
(cÚ¡ 
iovec
 *
iov
, 
Ä_£gs
)

38 
£g
;

39 
size_t
 
»t
 = 0;

41 
£g
 = 0; seg < 
Ä_£gs
; seg++)

42 
»t
 +ğ
iov
[
£g
].
iov_Ën
;

43  
»t
;

44 
	}
}

46 
iov_shÜ‹n
(
iovec
 *
iov
, 
Ä_£gs
, 
size_t
 
to
);

	@
1
.
1
/usr/include
61
1418
amrr/amrr.c
amrr/amrr.h
amrr/ath_rate_amrr.mod.c
minstrel/ath_rate_minstrel.mod.c
minstrel/minstrel.c
minstrel/minstrel.h
onoe/ath_rate_onoe.mod.c
onoe/onoe.c
onoe/onoe.h
rraa/ath_rate_rraa.mod.c
rraa/rraa.c
rraa/rraa.h
rraac1/ath_rate_rraac1.mod.c
rraac1/rraac1.c
rraac1/rraac1.h
rraac2/ath_rate_rraac2.mod.c
rraac2/rraac2.c
rraac2/rraac2.h
rraac3/ath_rate_rraac3.mod.c
rraac3/rraac3.c
rraac3/rraac3.h
rraac4/ath_rate_rraac4.mod.c
rraac4/rraac4.c
rraac4/rraac4.h
rraac5/ath_rate_rraac5.mod.c
rraac5/rraac5.c
rraac5/rraac5.h
rraac6/ath_rate_rraac6.mod.c
rraac6/rraac6.c
rraac6/rraac6.h
rraamod/ath_rate_rraamod.mod.c
rraamod/rraamod.c
rraamod/rraamod.h
sample/ath_rate_sample.mod.c
sample/sample.c
sample/sample.h
/usr/include/linux/if_arp.h
/usr/include/linux/net.h
/usr/include/linux/netdevice.h
/usr/include/linux/random.h
/usr/include/linux/sysctl.h
/usr/include/linux/version.h
/usr/include/asm/socket.h
/usr/include/linux/if.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/kernel.h
/usr/include/linux/types.h
/usr/include/linux/wait.h
/usr/include/asm/ioctl.h
/usr/include/asm/sockios.h
/usr/include/asm/types.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm/posix_types.h
/usr/include/linux/sockios.h
/usr/include/linux/stddef.h
/usr/include/linux/uio.h
