cscope 15 $HOME/madwifi/net80211               0000974135
	@_ieee80211.h

34 #iâdeà
_NET80211__IEEE80211_H_


35 
	#_NET80211__IEEE80211_H_


	)

40 
	e›“80211_phyty³
 {

41 
	mIEEE80211_T_DS
 = 0,

42 
	mIEEE80211_T_FH
 = 1,

43 
	mIEEE80211_T_OFDM
 = 2,

44 
	mIEEE80211_T_TURBO
 = 3,

45 
	mIEEE80211_T_HT
 = 4,

46 
	mIEEE80211_T_XR
 = 5,

48 
	#IEEE80211_T_CCK
 
IEEE80211_T_DS


	)

51 
	e›“80211_phymode
 {

52 
	mIEEE80211_MODE_AUTO
 = 0,

53 
	mIEEE80211_MODE_11A
 = 1,

54 
	mIEEE80211_MODE_11B
 = 2,

55 
	mIEEE80211_MODE_11G
 = 3,

56 
	mIEEE80211_MODE_FH
 = 4,

57 
	mIEEE80211_MODE_TURBO_A
 = 5,

58 
	mIEEE80211_MODE_TURBO_G
 = 6,

60 
	#IEEE80211_MODE_MAX
 (
IEEE80211_MODE_TURBO_G
+1)

	)

62 
	e›“80211_İmode
 {

63 
	mIEEE80211_M_STA
 = 1,

64 
	mIEEE80211_M_IBSS
 = 0,

65 
	mIEEE80211_M_AHDEMO
 = 3,

66 
	mIEEE80211_M_HOSTAP
 = 6,

67 
	mIEEE80211_M_MONITOR
 = 8,

68 
	mIEEE80211_M_WDS
 = 2

75 
	#IEEE80211_IS_MODE_BEACON
(
_İmode
) \

76 ((
_İmode
 =ğ
IEEE80211_M_IBSS
) || \

77 (
_İmode
 =ğ
IEEE80211_M_HOSTAP
))

	)

86 
	#IEEE80211_IS_MODE_DFS_MASTER
(
_İmode
) \

87 ((
_İmode
 =ğ
IEEE80211_M_IBSS
) || \

88 (
_İmode
 =ğ
IEEE80211_M_AHDEMO
) || \

89 (
_İmode
 =ğ
IEEE80211_M_HOSTAP
) || \

90 (
_İmode
 =ğ
IEEE80211_M_WDS
))

	)

95 
	e›“80211_´Ùmode
 {

96 
	mIEEE80211_PROT_NONE
 = 0,

97 
	mIEEE80211_PROT_CTSONLY
 = 1,

98 
	mIEEE80211_PROT_RTSCTS
 = 2,

104 
	e›“80211_authmode
 {

105 
	mIEEE80211_AUTH_NONE
 = 0,

106 
	mIEEE80211_AUTH_OPEN
 = 1,

107 
	mIEEE80211_AUTH_SHARED
 = 2,

108 
	mIEEE80211_AUTH_8021X
 = 3,

109 
	mIEEE80211_AUTH_AUTO
 = 4,

111 
	mIEEE80211_AUTH_WPA
 = 5,

123 
	e›“80211_rßmšgmode
 {

124 
	mIEEE80211_ROAMING_DEVICE
= 0,

125 
	mIEEE80211_ROAMING_AUTO
 = 1,

126 
	mIEEE80211_ROAMING_MANUAL
= 2,

134 
	e›“80211_sÿnmode
 {

135 
	mIEEE80211_SCAN_DEVICE
 = 0,

136 
	mIEEE80211_SCAN_BEST
 = 1,

137 
	mIEEE80211_SCAN_FIRST
 = 2,

143 
	s›“80211_chªÃl
 {

144 
u_št16_t
 
	mic_äeq
;

145 
u_št16_t
 
	mic_æags
;

146 
u_št8_t
 
	mic_›“
;

147 
št8_t
 
	mic_max»gpow”
;

148 
št8_t
 
	mic_maxpow”
;

149 
št8_t
 
	mic_mšpow”
;

152 
	#IEEE80211_CHAN_MAX
 255

	)

153 
	#IEEE80211_CHAN_BYTES
 32

	)

154 
	#IEEE80211_CHAN_ANY
 0xfffà

	)

155 
	#IEEE80211_CHAN_ANYC
 ((
›“80211_chªÃl
 *)
IEEE80211_CHAN_ANY
)

	)

157 
	#IEEE80211_RADAR_CHANCHANGE_TBTT_COUNT
 0

	)

158 
	#IEEE80211_DEFAULT_CHANCHANGE_TBTT_COUNT
 3

	)

160 
	#IEEE80211_RADAR_TEST_MUTE_CHAN
 36

	)

164 
	#IEEE80211_CHAN_INDOOR
 0x0004

	)

165 
	#IEEE80211_CHAN_OUTDOOR
 0x0008

	)

166 
	#IEEE80211_CHAN_TURBO
 0x0010

	)

167 
	#IEEE80211_CHAN_CCK
 0x0020

	)

168 
	#IEEE80211_CHAN_OFDM
 0x0040

	)

169 
	#IEEE80211_CHAN_2GHZ
 0x0080

	)

170 
	#IEEE80211_CHAN_5GHZ
 0x0100

	)

171 
	#IEEE80211_CHAN_PASSIVE
 0x0200

	)

172 
	#IEEE80211_CHAN_DYN
 0x0400

	)

173 
	#IEEE80211_CHAN_GFSK
 0x0800

	)

174 
	#IEEE80211_CHAN_RADAR
 0x1000

	)

175 
	#IEEE80211_CHAN_STURBO
 0x2000

	)

176 
	#IEEE80211_CHAN_HALF
 0x4000

	)

177 
	#IEEE80211_CHAN_QUARTER
 0x8000

	)

182 
	#IEEE80211_CHAN_FHSS
 \

183 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_GFSK
)

	)

184 
	#IEEE80211_CHAN_A
 \

185 (
IEEE80211_CHAN_5GHZ
 | 
IEEE80211_CHAN_OFDM
)

	)

186 
	#IEEE80211_CHAN_B
 \

187 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_CCK
)

	)

188 
	#IEEE80211_CHAN_PUREG
 \

189 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_OFDM
)

	)

190 
	#IEEE80211_CHAN_G
 \

191 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_DYN
)

	)

192 
	#IEEE80211_CHAN_108A
 \

193 (
IEEE80211_CHAN_5GHZ
 | 
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_TURBO
)

	)

194 
	#IEEE80211_CHAN_108G
 \

195 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_TURBO
)

	)

196 
	#IEEE80211_CHAN_ST
 \

197 (
IEEE80211_CHAN_108A
 | 
IEEE80211_CHAN_STURBO
)

	)

199 
	#IEEE80211_CHAN_ALL
 \

200 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_5GHZ
 | 
IEEE80211_CHAN_GFSK
 | \

201 
IEEE80211_CHAN_CCK
 | 
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_DYN
)

	)

202 
	#IEEE80211_CHAN_ALLTURBO
 \

203 (
IEEE80211_CHAN_ALL
 | 
IEEE80211_CHAN_TURBO
 | 
IEEE80211_CHAN_STURBO
)

	)

205 
	#IEEE80211_IS_CHAN_INDOOR
(
_c
) \

206 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_INDOOR
è!ğ0)

	)

207 
	#IEEE80211_IS_CHAN_OUTDOOR
(
_c
) \

208 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_OUTDOOR
è!ğ0)

	)

209 
	#IEEE80211_IS_CHAN_FHSS
(
_c
) \

210 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_FHSS
è=ğIEEE80211_CHAN_FHSS)

	)

211 
	#IEEE80211_IS_CHAN_A
(
_c
) \

212 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_A
è=ğIEEE80211_CHAN_A)

	)

213 
	#IEEE80211_IS_CHAN_B
(
_c
) \

214 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_B
è=ğIEEE80211_CHAN_B)

	)

215 
	#IEEE80211_IS_CHAN_PUREG
(
_c
) \

216 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_PUREG
è=ğIEEE80211_CHAN_PUREG)

	)

217 
	#IEEE80211_IS_CHAN_G
(
_c
) \

218 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_G
è=ğIEEE80211_CHAN_G)

	)

219 
	#IEEE80211_IS_CHAN_ANYG
(
_c
) \

220 (
	`IEEE80211_IS_CHAN_PUREG
(
_c
è|| 
	`IEEE80211_IS_CHAN_G
(_c))

	)

221 
	#IEEE80211_IS_CHAN_ST
(
_c
) \

222 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_ST
è=ğIEEE80211_CHAN_ST)

	)

223 
	#IEEE80211_IS_CHAN_108A
(
_c
) \

224 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_108A
è=ğIEEE80211_CHAN_108A)

	)

225 
	#IEEE80211_IS_CHAN_108G
(
_c
) \

226 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_108G
è=ğIEEE80211_CHAN_108G)

	)

228 
	#IEEE80211_IS_CHAN_2GHZ
(
_c
) \

229 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_2GHZ
è!ğ0)

	)

230 
	#IEEE80211_IS_CHAN_5GHZ
(
_c
) \

231 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_5GHZ
è!ğ0)

	)

232 
	#IEEE80211_IS_CHAN_OFDM
(
_c
) \

233 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_OFDM
è!ğ0)

	)

234 
	#IEEE80211_IS_CHAN_CCK
(
_c
) \

235 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_CCK
è!ğ0)

	)

236 
	#IEEE80211_IS_CHAN_GFSK
(
_c
) \

237 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_GFSK
è!ğ0)

	)

238 
	#IEEE80211_IS_CHAN_TURBO
(
_c
) \

239 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_TURBO
è!ğ0)

	)

240 
	#IEEE80211_IS_CHAN_STURBO
(
_c
) \

241 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_STURBO
è!ğ0)

	)

242 
	#IEEE80211_IS_CHAN_DTURBO
(
_c
) \

243 (((
_c
)->
ic_æags
 & \

244 (
IEEE80211_CHAN_TURBO
 | 
IEEE80211_CHAN_STURBO
)è=ğIEEE80211_CHAN_TURBO)

	)

245 
	#IEEE80211_IS_CHAN_HALF
(
_c
) \

246 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_HALF
è!ğ0)

	)

247 
	#IEEE80211_IS_CHAN_QUARTER
(
_c
) \

248 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_QUARTER
è!ğ0)

	)

250 
	#IEEE80211_IS_CHAN_PASSIVE
(
_c
) \

251 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_PASSIVE
è!ğ0)

	)

252 
	#IEEE80211_IS_CHAN_RADAR
(
_c
) \

253 (((
_c
)->
ic_æags
 & 
IEEE80211_CHAN_RADAR
è!ğ0)

	)

254 
	#IEEE80211_ARE_CHANS_SAME_MODE
(
_a
, 
_b
) \

255 (((
_a
)->
ic_æags
 & 
IEEE80211_CHAN_ALLTURBO
è=ğ((
_b
)->ic_æag & IEEE80211_CHAN_ALLTURBO))

	)

258 
	#IEEE80211_FH_CHANMOD
 80

	)

259 
	#IEEE80211_FH_CHAN
(
£t
,
·t
è(((£tè- 1è* 
IEEE80211_FH_CHANMOD
 + (·t))

	)

260 
	#IEEE80211_FH_CHANSET
(
chª
è((chªè/ 
IEEE80211_FH_CHANMOD
 + 1)

	)

261 
	#IEEE80211_FH_CHANPAT
(
chª
è((chªè% 
IEEE80211_FH_CHANMOD
)

	)

269 
	e›“80211_sc_®gÜ™hm
 {

270 
	mIEEE80211_SC_NONE
,

277 
	mIEEE80211_SC_LOOSE
,

284 
	mIEEE80211_SC_TIGHT
,

298 
	mIEEE80211_SC_STRICT


309 
	#IEEE80211_RATE_SIZE
 8

	)

310 
	#IEEE80211_RATE_MAXSIZE
 15

	)

311 
	#IEEE80211_SANITISE_RATESIZE
(
_rsz
) \

312 ((
_rsz
 > 
IEEE80211_RATE_MAXSIZE
è? IEEE80211_RATE_MAXSIZE : _rsz)

	)

314 
	s›“80211_¿‹£t
 {

315 
u_št8_t
 
	mrs_Ä©es
;

316 
u_št8_t
 
	mrs_¿‹s
[
IEEE80211_RATE_MAXSIZE
];

319 
	s›“80211_rßm
 {

320 
št8_t
 
	mrssi11a
;

321 
št8_t
 
	mrssi11g
;

322 
št8_t
 
	mrssi11bOÆy
;

323 
u_št8_t
 
	m¿‹11a
;

324 
u_št8_t
 
	m¿‹11g
;

325 
u_št8_t
 
	m¿‹11bOÆy
;

	@ieee80211.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/¹Ãšk.h
>

50 
	~"if_medŸ.h
"

52 
	~<Ãt80211/›“80211_v¬.h
>

53 
	~<Ãt80211/if_©h´Ùo.h
>

55 cÚ¡ *
	g›“80211_phymode_Çme
[] = {

65 
EXPORT_SYMBOL
(
›“80211_phymode_Çme
);

67 cÚ¡ *
	g›“80211_İmode_Çme
[] = {

78 
EXPORT_SYMBOL
(
›“80211_İmode_Çme
);

81 
›“80211com_medŸ_¡©us
(
Ãt_deviû
 *, 
ifmedŸ»q
 *);

82 
›“80211com_medŸ_chªge
(
Ãt_deviû
 *);

83 
Ãt_deviû_¡©s
 *
›“80211_g‘¡©s
(
Ãt_deviû
 *);

84 
›“80211_chªge_mtu
(
Ãt_deviû
 *, );

85 
›“80211_£t_muÉiÿ¡_li¡
(
Ãt_deviû
 *);

86 
›“80211_expœe_dfs_exş_tim”
();

88 
MALLOC_DEFINE
(
M_80211_VAP
, "80211vap", "802.11 vap state");

93 
	scouÁry_code_to_¡ršg
 {

94 
u_št16_t
 
	miso_code
;

95 cÚ¡ *
	miso_Çme
;

101 
	#CTRY_DEBUG
 0x1fà

	)

102 
	#CTRY_DEFAULT
 0

	)

104 cÚ¡ 
couÁry_code_to_¡ršg
 
	gcouÁry_¡ršgs
[] = {

105 {
CTRY_DEBUG
, "DB"},

106 {
CTRY_DEFAULT
, "NA"},

107 {
CTRY_ALBANIA
, "AL"},

108 {
CTRY_ALGERIA
, "DZ"},

109 {
CTRY_ARGENTINA
, "AR"},

110 {
CTRY_ARMENIA
, "AM"},

111 {
CTRY_AUSTRALIA
, "AU"},

112 {
CTRY_AUSTRIA
, "AT"},

113 {
CTRY_AZERBAIJAN
, "AZ"},

114 {
CTRY_BAHRAIN
, "BH"},

115 {
CTRY_BELARUS
, "BY"},

116 {
CTRY_BELGIUM
, "BE"},

117 {
CTRY_BELIZE
, "BZ"},

118 {
CTRY_BOLIVIA
, "BO"},

119 {
CTRY_BRAZIL
, "BR"},

120 {
CTRY_BRUNEI_DARUSSALAM
, "BN"},

121 {
CTRY_BULGARIA
, "BG"},

122 {
CTRY_CANADA
, "CA"},

123 {
CTRY_CHILE
, "CL"},

124 {
CTRY_CHINA
, "CN"},

125 {
CTRY_COLOMBIA
, "CO"},

126 {
CTRY_COSTA_RICA
, "CR"},

127 {
CTRY_CROATIA
, "HR"},

128 {
CTRY_CYPRUS
, "CY"},

129 {
CTRY_CZECH
, "CZ"},

130 {
CTRY_DENMARK
, "DK"},

131 {
CTRY_DOMINICAN_REPUBLIC
, "DO"},

132 {
CTRY_ECUADOR
, "EC"},

133 {
CTRY_EGYPT
, "EG"},

134 {
CTRY_EL_SALVADOR
, "SV"},

135 {
CTRY_ESTONIA
, "EE"},

136 {
CTRY_FINLAND
, "FI"},

137 {
CTRY_FRANCE
, "FR"},

138 {
CTRY_FRANCE2
, "F2"},

139 {
CTRY_GEORGIA
, "GE"},

140 {
CTRY_GERMANY
, "DE"},

141 {
CTRY_GREECE
, "GR"},

142 {
CTRY_GUATEMALA
, "GT"},

143 {
CTRY_HONDURAS
, "HN"},

144 {
CTRY_HONG_KONG
, "HK"},

145 {
CTRY_HUNGARY
, "HU"},

146 {
CTRY_ICELAND
, "IS"},

147 {
CTRY_INDIA
, "IN"},

148 {
CTRY_INDONESIA
, "ID"},

149 {
CTRY_IRAN
, "IR"},

150 {
CTRY_IRELAND
, "IE"},

151 {
CTRY_ISRAEL
, "IL"},

152 {
CTRY_ITALY
, "IT"},

153 {
CTRY_JAPAN
, "JP"},

154 {
CTRY_JAPAN1
, "J1"},

155 {
CTRY_JAPAN2
, "J2"},

156 {
CTRY_JAPAN3
, "J3"},

157 {
CTRY_JAPAN4
, "J4"},

158 {
CTRY_JAPAN5
, "J5"},

159 {
CTRY_JAPAN7
, "JP"},

160 {
CTRY_JAPAN6
, "JP"},

161 {
CTRY_JAPAN8
, "JP"},

162 {
CTRY_JAPAN9
, "JP"},

163 {
CTRY_JAPAN10
, "JP"},

164 {
CTRY_JAPAN11
, "JP"},

165 {
CTRY_JAPAN12
, "JP"},

166 {
CTRY_JAPAN13
, "JP"},

167 {
CTRY_JAPAN14
, "JP"},

168 {
CTRY_JAPAN15
, "JP"},

169 {
CTRY_JAPAN16
, "JP"},

170 {
CTRY_JAPAN17
, "JP"},

171 {
CTRY_JAPAN18
, "JP"},

172 {
CTRY_JAPAN19
, "JP"},

173 {
CTRY_JAPAN20
, "JP"},

174 {
CTRY_JAPAN21
, "JP"},

175 {
CTRY_JAPAN22
, "JP"},

176 {
CTRY_JAPAN23
, "JP"},

177 {
CTRY_JAPAN24
, "JP"},

178 {
CTRY_JAPAN25
, "JP"},

179 {
CTRY_JAPAN26
, "JP"},

180 {
CTRY_JAPAN27
, "JP"},

181 {
CTRY_JAPAN28
, "JP"},

182 {
CTRY_JAPAN29
, "JP"},

183 {
CTRY_JAPAN30
, "JP"},

184 {
CTRY_JAPAN31
, "JP"},

185 {
CTRY_JAPAN32
, "JP"},

186 {
CTRY_JAPAN33
, "JP"},

187 {
CTRY_JAPAN34
, "JP"},

188 {
CTRY_JAPAN35
, "JP"},

189 {
CTRY_JAPAN36
, "JP"},

190 {
CTRY_JAPAN37
, "JP"},

191 {
CTRY_JAPAN38
, "JP"},

192 {
CTRY_JAPAN39
, "JP"},

193 {
CTRY_JAPAN40
, "JP"},

194 {
CTRY_JAPAN41
, "JP"},

195 {
CTRY_JAPAN42
, "JP"},

196 {
CTRY_JAPAN43
, "JP"},

197 {
CTRY_JAPAN44
, "JP"},

198 {
CTRY_JAPAN45
, "JP"},

199 {
CTRY_JAPAN46
, "JP"},

200 {
CTRY_JAPAN47
, "JP"},

201 {
CTRY_JAPAN48
, "JP"},

202 {
CTRY_JORDAN
, "JO"},

203 {
CTRY_KAZAKHSTAN
, "KZ"},

204 {
CTRY_KOREA_NORTH
, "KP"},

205 {
CTRY_KOREA_ROC
, "KR"},

206 {
CTRY_KOREA_ROC2
, "K2"},

207 {
CTRY_KUWAIT
, "KW"},

208 {
CTRY_LATVIA
, "LV"},

209 {
CTRY_LEBANON
, "LB"},

210 {
CTRY_LIECHTENSTEIN
, "LI"},

211 {
CTRY_LITHUANIA
, "LT"},

212 {
CTRY_LUXEMBOURG
, "LU"},

213 {
CTRY_MACAU
, "MO"},

214 {
CTRY_MACEDONIA
, "MK"},

215 {
CTRY_MALAYSIA
, "MY"},

216 {
CTRY_MEXICO
, "MX"},

217 {
CTRY_MONACO
, "MC"},

218 {
CTRY_MOROCCO
, "MA"},

219 {
CTRY_NETHERLANDS
, "NL"},

220 {
CTRY_NEW_ZEALAND
, "NZ"},

221 {
CTRY_NORWAY
, "NO"},

222 {
CTRY_OMAN
, "OM"},

223 {
CTRY_PAKISTAN
, "PK"},

224 {
CTRY_PANAMA
, "PA"},

225 {
CTRY_PERU
, "PE"},

226 {
CTRY_PHILIPPINES
, "PH"},

227 {
CTRY_POLAND
, "PL"},

228 {
CTRY_PORTUGAL
, "PT"},

229 {
CTRY_PUERTO_RICO
, "PR"},

230 {
CTRY_QATAR
, "QA"},

231 {
CTRY_ROMANIA
, "RO"},

232 {
CTRY_RUSSIA
, "RU"},

233 {
CTRY_SAUDI_ARABIA
, "SA"},

234 {
CTRY_SINGAPORE
, "SG"},

235 {
CTRY_SLOVAKIA
, "SK"},

236 {
CTRY_SLOVENIA
, "SI"},

237 {
CTRY_SOUTH_AFRICA
, "ZA"},

238 {
CTRY_SPAIN
, "ES"},

239 {
CTRY_SWEDEN
, "SE"},

240 {
CTRY_SWITZERLAND
, "CH"},

241 {
CTRY_SYRIA
, "SY"},

242 {
CTRY_TAIWAN
, "TW"},

243 {
CTRY_THAILAND
, "TH"},

244 {
CTRY_TRINIDAD_Y_TOBAGO
, "TT"},

245 {
CTRY_TUNISIA
, "TN"},

246 {
CTRY_TURKEY
, "TR"},

247 {
CTRY_UKRAINE
, "UA"},

248 {
CTRY_UAE
, "AE"},

249 {
CTRY_UNITED_KINGDOM
, "GB"},

250 {
CTRY_UNITED_STATES
, "US"},

251 {
CTRY_UNITED_STATES_FCC49
, "US"},

252 {
CTRY_URUGUAY
, "UY"},

253 {
CTRY_UZBEKISTAN
, "UZ"},

254 {
CTRY_VENEZUELA
, "VE"},

255 {
CTRY_VIET_NAM
, "VN"},

256 {
CTRY_YEMEN
, "YE"},

257 {
CTRY_ZIMBABWE
, "ZW"}

261 
	$›“80211_iç‰ach
(
›“80211com
 *
ic
)

263 
Ãt_deviû
 *
dev
 = 
ic
->
ic_dev
;

264 
›“80211_chªÃl
 *
c
;

265 
ifmedŸ»q
 
imr
;

266 
i
;

268 
	`_MOD_INC_USE
(
THIS_MODULE
,  -
ENODEV
);

276 
ic
->
ic_İmode
 = 
IEEE80211_M_STA
;

283 
	`KASSERT
(0 < 
ic
->
ic_nchªs
 && ic->ic_nchª < 
IEEE80211_CHAN_MAX
,

284 ("šv®id‚umb” oàchªÃl ¥ecif›d: %u", 
ic
->
ic_nchªs
));

285 
	`mem£t
(
ic
->
ic_chª_ava
, 0, (ic->ic_chan_avail));

286 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_AUTO
;

288 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

289 
c
 = &
ic
->
ic_chªÃls
[
i
];

290 
	`KASSERT
(
c
->
ic_æags
 != 0, ("channel with‚o flags"));

291 
	`KASSERT
(
c
->
ic_›“
 < 
IEEE80211_CHAN_MAX
,

292 ("chªÃÈw™h bogu ›“‚umb” %u", 
c
->
ic_›“
));

293 
	`£tb™
(
ic
->
ic_chª_ava
, 
c
->
ic_›“
);

296 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

297 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_11A
;

298 ià(
	`IEEE80211_IS_CHAN_B
(
c
))

299 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_11B
;

300 ià(
	`IEEE80211_IS_CHAN_PUREG
(
c
))

301 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_11G
;

302 ià(
	`IEEE80211_IS_CHAN_FHSS
(
c
))

303 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_FH
;

304 ià(
	`IEEE80211_IS_CHAN_108A
(
c
))

305 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_TURBO_A
;

306 ià(
	`IEEE80211_IS_CHAN_108G
(
c
))

307 
ic
->
ic_modeÿps
 |ğ1 << 
IEEE80211_MODE_TURBO_G
;

310 
	`memıy
(
ic
->
ic_chª_aùive
, ic->
ic_chª_ava
,

311 (
ic
->
ic_chª_ava
));

313 
	`›“80211_bud_sc_›
(
ic
);

315 ià((
ic
->
ic_modeÿps
 & (1 << ic->
ic_curmode
)) == 0)

316 
ic
->
ic_curmode
 = 
IEEE80211_MODE_AUTO
;

321 ià(
ic
->
ic_modeÿps
 & (1 << 
IEEE80211_MODE_11G
))

322 
	`›“80211_£t11gbasiü©es
(

323 &
ic
->
ic_sup_¿‹s
[
IEEE80211_MODE_11G
],

324 
IEEE80211_MODE_11G
);

327 
ic
->
ic_bsschª
 = 
IEEE80211_CHAN_ANYC
;

329 
ic
->
ic_curchª
 = &ic->
ic_chªÃls
[0];

332 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_MARKDFS
;

335 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_WME
)

336 
ic
->
ic_æags
 |ğ
IEEE80211_F_WME
;

337 (è
	`›“80211_£tmode
(
ic
, ic->
ic_curmode
);

340 ià(
ic
->
ic_lštv®
 == 0)

341 
ic
->
ic_lštv®
 = 
IEEE80211_BINTVAL_DEFAULT
;

345 ià(
ic
->
ic_bmis¡h»shŞd
 == 0) {

346 
ic
->
ic_bmis¡h»shŞd
 = 
	`howmªy
(
	`roundup
(

347 
	`IEEE80211_MS_TO_TU
(
IEEE80211_BMISSTHRESH_DEFAULT_MS
),

348 
ic
->
ic_lštv®
), ic->ic_lintval);

351 
	`IEEE80211_LOCK_INIT
(
ic
, "ieee80211com");

352 
	`IEEE80211_VAPS_LOCK_INIT
(
ic
, "ieee80211com_vaps");

353 
	`TAILQ_INIT
(&
ic
->
ic_v­s
);

355 
ic
->
ic_txpowlim™
 = 
IEEE80211_TXPOWER_MAX
;

356 
ic
->
ic_txpowlim™
 = 
IEEE80211_TXPOWER_MIN
;

357 
ic
->
ic_Ãwtxpowlim™
 = 
IEEE80211_TXPOWER_MAX
;

359 
	`š™_tim”
(&
ic
->
ic_dfs_exş_tim”
);

360 
ic
->
ic_dfs_exş_tim”
.
funùiÚ
 =

361 
›“80211_expœe_dfs_exş_tim”
;

362 
ic
->
ic_dfs_exş_tim”
.
d©a
 = () ic;

364 
	`›“80211_üy±o_©ch
(
ic
);

365 
	`›“80211_node_©ch
(
ic
);

366 
	`›“80211_pow”_©ch
(
ic
);

367 
	`›“80211_´Ùo_©ch
(
ic
);

368 
	`›“80211_sÿn_©ch
(
ic
);

370 
	`›“80211_medŸ_£tup
(
ic
, &ic->
ic_medŸ
, ic->
ic_ÿps
,

371 
›“80211com_medŸ_chªge
, 
›“80211com_medŸ_¡©us
);

372 
	`›“80211com_medŸ_¡©us
(
dev
, &
imr
);

373 
	`ifmedŸ_£t
(&
ic
->
ic_medŸ
, 
imr
.
ifm_aùive
);

375 
	}
}

376 
EXPORT_SYMBOL
(
›“80211_iç‰ach
);

379 
	$›“80211_ifd‘ach
(
›“80211com
 *
ic
)

381 
›“80211v­
 *
v­
;

383 
	`¹Æ_lock
();

384 (
v­
 = 
	`TAILQ_FIRST
(&
ic
->
ic_v­s
)è!ğ
NULL
)

385 
ic
->
	`ic_v­_d–‘e
(
v­
);

386 
	`¹Æ_uÆock
();

388 
	`d–_tim”
(&
ic
->
ic_dfs_exş_tim”
);

389 
	`›“80211_sÿn_d‘ach
(
ic
);

390 
	`›“80211_´Ùo_d‘ach
(
ic
);

391 
	`›“80211_üy±o_d‘ach
(
ic
);

392 
	`›“80211_pow”_d‘ach
(
ic
);

393 
	`›“80211_node_d‘ach
(
ic
);

394 
	`ifmedŸ_»mov—Î
(&
ic
->
ic_medŸ
);

396 
	`IEEE80211_VAPS_LOCK_DESTROY
(
ic
);

397 
	`IEEE80211_LOCK_DESTROY
(
ic
);

399 
	`_MOD_DEC_USE
(
THIS_MODULE
);

400 
	}
}

401 
EXPORT_SYMBOL
(
›“80211_ifd‘ach
);

404 
	$›“80211_v­_£tup
(
›“80211com
 *
ic
, 
Ãt_deviû
 *
dev
,

405 cÚ¡ *
Çme
, 
İmode
, 
æags
)

407 
	#IEEE80211_C_OPMODE
 \

408 (
IEEE80211_C_IBSS
 | 
IEEE80211_C_HOSTAP
 | 
IEEE80211_C_AHDEMO
 | \

409 
IEEE80211_C_MONITOR
)

	)

410 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

411 
Ãt_deviû
 *
·»Á
 = 
ic
->
ic_dev
;

412 
”r
;

414 ià(
Çme
 !ğ
NULL
) {

415 ià(
	`¡rchr
(
Çme
, '%')) {

416 ià((
”r
 = 
	`dev_®loc_Çme
(
dev
, 
Çme
)) < 0) {

417 
	`´štk
(
KERN_ERR
 "ÿn'ˆ®loøÇm%s\n", 
Çme
);

418  
”r
;

421 
	`¡ºıy
(
dev
->
Çme
,‚ame, (dev->name));

424 
dev
->
g‘_¡©s
 = 
›“80211_g‘¡©s
;

425 
dev
->
İ’
 = 
›“80211_İ’
;

426 
dev
->
¡İ
 = 
›“80211_¡İ
;

427 
dev
->
h¬d_¡¬t_xm™
 = 
›“80211_h¬d¡¬t
;

428 
dev
->
£t_muÉiÿ¡_li¡
 = 
›“80211_£t_muÉiÿ¡_li¡
;

430 
dev
->
£t_mac_add»ss
 = 
›“80211_£t_mac_add»ss
;

432 
dev
->
chªge_mtu
 = 
›“80211_chªge_mtu
;

433 
dev
->
tx_queue_Ën
 = 0;

434 
dev
->
h¬d_h—d”_Ën
 = 
·»Á
->hard_header_len;

440 #ià
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,0)

442 
dev
->
ã©u»s
 |ğ
NETIF_F_DYNALLOC
;

444 
dev
->
de¡ruùÜ
 = 
ä“_Ãtdev
;

447 
v­
->
iv_ic
 = 
ic
;

448 
v­
->
iv_dev
 = 
dev
;

449 
v­
->
iv_xrv­
 = 
NULL
;

450 
v­
->
iv_æags
 = 
ic
->
ic_æags
;

451 
v­
->
iv_æags_ext
 = 
ic
->
ic_æags_ext
;

452 
v­
->
iv_©h_ÿp
 = 
ic
->
ic_©h_ÿp
;

453 
v­
->
iv_mÿ¡_¿‹
 = 1000;

455 #ifdeà
ATH_SUPERG_XR


460 ià(
æags
 & 
IEEE80211_VAP_XR
) {

461 
v­
->
iv_æags
 |ğ
IEEE80211_F_XR
;

462 
v­
->
iv_mÿ¡_¿‹
 = 256;

466 
v­
->
iv_ÿps
 = 
ic
->
ic_ÿps
 &~ 
IEEE80211_C_OPMODE
;

467 
İmode
) {

468 
IEEE80211_M_STA
:

470 ià(
æags
 & 
IEEE80211_USE_SW_BEACON_TIMERS
)

471 
v­
->
iv_æags_ext
 |ğ
IEEE80211_FEXT_SWBMISS
;

473 
IEEE80211_M_IBSS
:

474 
v­
->
iv_ÿps
 |ğ
IEEE80211_C_IBSS
;

475 
v­
->
iv_©h_ÿp
 &ğ~
IEEE80211_ATHC_XR
;

477 
IEEE80211_M_AHDEMO
:

478 
v­
->
iv_ÿps
 |ğ
IEEE80211_C_AHDEMO
;

479 
v­
->
iv_©h_ÿp
 &ğ~
IEEE80211_ATHC_XR
;

481 
IEEE80211_M_HOSTAP
:

482 
v­
->
iv_ÿps
 |ğ
IEEE80211_C_HOSTAP
;

483 
v­
->
iv_©h_ÿp
 &ğ~
IEEE80211_ATHC_TURBOP
;

484 ià((
v­
->
iv_æags
 & 
IEEE80211_VAP_XR
) == 0)

485 
v­
->
iv_©h_ÿp
 &ğ~
IEEE80211_ATHC_XR
;

487 
IEEE80211_M_MONITOR
:

488 
v­
->
iv_ÿps
 |ğ
IEEE80211_C_MONITOR
;

489 
v­
->
iv_©h_ÿp
 &ğ~(
IEEE80211_ATHC_XR
 | 
IEEE80211_ATHC_TURBOP
);

491 
IEEE80211_M_WDS
:

492 
v­
->
iv_ÿps
 |ğ
IEEE80211_C_WDS
;

493 
v­
->
iv_©h_ÿp
 &ğ~(
IEEE80211_ATHC_XR
 | 
IEEE80211_ATHC_TURBOP
);

494 
v­
->
iv_æags_ext
 |ğ
IEEE80211_FEXT_WDS
;

497 
v­
->
iv_İmode
 = 
İmode
;

498 
	`IEEE80211_INIT_TQUEUE
(&
v­
->
iv_¡ajoš1tq
, 
›“80211_¡a_još1_skËt
, vap);

500 
v­
->
iv_chªchªge_couÁ
 = 0;

503 #ifdeà
ATH_WME


504 ià(
v­
->
iv_ÿps
 & 
IEEE80211_C_WME
)

505 
v­
->
iv_æags
 |ğ
IEEE80211_F_WME
;

507 ià(
v­
->
iv_ÿps
 & 
IEEE80211_C_FF
)

508 
v­
->
iv_æags
 |ğ
IEEE80211_F_FF
;

510 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_STA
 &&

511 (
v­
->
iv_ÿps
 & 
IEEE80211_C_BGSCAN
))

512 
v­
->
iv_æags
 |ğ
IEEE80211_F_BGSCAN
;

514 
v­
->
iv_dtim_³riod
 = 
IEEE80211_DTIM_DEFAULT
;

515 
v­
->
iv_des_chª
 = 
IEEE80211_CHAN_ANYC
;

517 
v­
->
iv_mÚ™Ü_üc_”rÜs
 = 0;

518 
v­
->
iv_mÚ™Ü_phy_”rÜs
 = 0;

520 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_myaddr
, 
ic
->
ic_myaddr
);

521 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_bssid
, 
ic
->
ic_myaddr
);

524 
	`›“80211_üy±o_v©ch
(
v­
);

525 
	`›“80211_node_v©ch
(
v­
);

526 
	`›“80211_pow”_v©ch
(
v­
);

527 
	`›“80211_´Ùo_v©ch
(
v­
);

528 
	`›“80211_sÿn_v©ch
(
v­
);

529 
	`›“80211_vÏn_v©ch
(
v­
);

530 
	`›“80211_ioùl_v©ch
(
v­
);

533 #undeà
IEEE80211_C_OPMODE


534 
	}
}

535 
EXPORT_SYMBOL
(
›“80211_v­_£tup
);

538 
	$›“80211_v­_©ch
(
›“80211v­
 *
v­
,

539 
ifm_chªge_cb_t
 
medŸ_chªge
, 
ifm_¡©_cb_t
 
medŸ_¡©us
)

541 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

542 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

543 
ifmedŸ»q
 
imr
;

544 
	`›“80211_node_Ï‹v©ch
(
v­
);

545 
	`›“80211_pow”_Ï‹v©ch
(
v­
);

547 
	`mem£t
(
v­
->
wds_mac
, 0x00, 
IEEE80211_ADDR_LEN
);

549 (è
	`›“80211_medŸ_£tup
(
ic
, &
v­
->
iv_medŸ
, v­->
iv_ÿps
,

550 
medŸ_chªge
, 
medŸ_¡©us
);

551 
	`›“80211_medŸ_¡©us
(
dev
, &
imr
);

552 
	`ifmedŸ_£t
(&
v­
->
iv_medŸ
, 
imr
.
ifm_aùive
);

553 
	`IEEE80211_LOCK_IRQ
(
ic
);

554 
	`TAILQ_INSERT_TAIL
(&
ic
->
ic_v­s
, 
v­
, 
iv_Ãxt
);

555 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

557 
	`IEEE80211_ADDR_COPY
(
dev
->
dev_addr
, 
v­
->
iv_myaddr
);

559 #ifdeà
ATH_SUPERG_XR


561 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XR
)

565 
	`›“80211_sÿÂ”_g‘
(
v­
->
iv_İmode
, 1);

568 ià(
	`»gi¡”_Ãtdeviû
(
dev
)) {

569 
	`´štk
(
KERN_ERR
 "%s: uÇbËØ»gi¡” deviû\n", 
dev
->
Çme
);

575 
	`›“80211_vœtfs_Ï‹v©ch
(
v­
);

578 
	}
}

579 
EXPORT_SYMBOL
(
›“80211_v­_©ch
);

582 
	$›“80211_v­_d‘ach
(
›“80211v­
 *
v­
)

584 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

585 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

587 
	`IEEE80211_CANCEL_TQUEUE
(&
v­
->
iv_¡ajoš1tq
);

588 
	`IEEE80211_LOCK_IRQ
(
ic
);

589 
	`TAILQ_REMOVE
(&
ic
->
ic_v­s
, 
v­
, 
iv_Ãxt
);

590 ià(
	`TAILQ_EMPTY
(&
ic
->
ic_v­s
))

591 
ic
->
ic_İmode
 = 
IEEE80211_M_STA
;

592 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

594 
	`ifmedŸ_»mov—Î
(&
v­
->
iv_medŸ
);

596 
	`›“80211_vœtfs_vd‘ach
(
v­
);

597 
	`›“80211_´oc_ş—nup
(
v­
);

598 
	`›“80211_ioùl_vd‘ach
(
v­
);

599 
	`›“80211_vÏn_vd‘ach
(
v­
);

600 
	`›“80211_sÿn_vd‘ach
(
v­
);

601 
	`›“80211_´Ùo_vd‘ach
(
v­
);

602 
	`›“80211_üy±o_vd‘ach
(
v­
);

603 
	`›“80211_pow”_vd‘ach
(
v­
);

604 
	`›“80211_node_vd‘ach
(
v­
);

606 #ifdeà
ATH_SUPERG_XR


608 ià(!(
v­
->
iv_æags
 & 
IEEE80211_F_XR
))

611 
	`uÄegi¡”_Ãtdeviû
(
dev
);

612 
	}
}

613 
EXPORT_SYMBOL
(
›“80211_v­_d‘ach
);

618 
u_št


619 
	$›“80211_mhz2›“
(
u_št
 
äeq
, u_šˆ
æags
)

621 ià(
æags
 & 
IEEE80211_CHAN_2GHZ
) {

622 ià(
äeq
 == 2484)

624 ià((
äeq
 >= 2412) && (freq < 2484))

625  (
äeq
 - 2407) / 5;

627 } ià(
æags
 & 
IEEE80211_CHAN_5GHZ
) {

628 ià((
äeq
 >= 5150) && (freq <= 5825))

629  (
äeq
 - 5000) / 5;

635 
	}
}

636 
EXPORT_SYMBOL
(
›“80211_mhz2›“
);

641 
u_št


642 
	$›“80211_chª2›“
(
›“80211com
 *
ic
, cÚ¡ 
›“80211_chªÃl
 *
c
)

644 ià(
c
 =ğ
NULL
) {

645 
	`if_´štf
(
ic
->
ic_dev
, "invalid channel (NULL)\n");

648  (
c
 =ğ
IEEE80211_CHAN_ANYC
 ? 
IEEE80211_CHAN_ANY
 : c->
ic_›“
);

649 
	}
}

650 
EXPORT_SYMBOL
(
›“80211_chª2›“
);

655 
u_št


656 
	$›“80211_›“2mhz
(
u_št
 
chª
, u_šˆ
æags
)

658 ià(
æags
 & 
IEEE80211_CHAN_2GHZ
) {

659 ià(
chª
 == 14)

661 ià(
chª
 < 14)

662  2407 + 
chª
 * 5;

664  2512 + ((
chª
 - 15) * 20);

665 } ià(
æags
 & 
IEEE80211_CHAN_5GHZ
)

666  5000 + (
chª
 * 5);

668 ià(
chª
 == 14)

670 ià(
chª
 < 14)

671  2407 + 
chª
 * 5;

672 ià(
chª
 < 27)

673  2512 + ((
chª
 - 15) * 20);

674  5000 + (
chª
 * 5);

676 
	}
}

677 
EXPORT_SYMBOL
(
›“80211_›“2mhz
);

684 
›“80211_chªÃl
 *

685 
	$›“80211_fšd_chªÃl
(
›“80211com
 *
ic
, 
äeq
, 
æags
)

687 
›“80211_chªÃl
 *
c
;

688 
i
;

691 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

692 
c
 = &
ic
->
ic_chªÃls
[
i
];

693 ià(
c
->
ic_äeq
 =ğ
äeq
 &&

694 (
æags
 == 0 ||

695 (
c
->
ic_æags
 & 
IEEE80211_CHAN_ALLTURBO
è=ğ
æags
))

696  
c
;

698  
NULL
;

699 
	}
}

700 
EXPORT_SYMBOL
(
›“80211_fšd_chªÃl
);

708 
	$›“80211_medŸ_£tup
(
›“80211com
 *
ic
,

709 
ifmedŸ
 *
medŸ
, 
u_št32_t
 
ÿps
,

710 
ifm_chªge_cb_t
 
medŸ_chªge
, 
ifm_¡©_cb_t
 
medŸ_¡©
)

712 
	#ADD
(
_medŸ
, 
_s
, 
_o
) \

713 
	`ifmedŸ_add
(
_medŸ
, 
	`IFM_MAKEWORD
(
IFM_IEEE80211
, (
_s
), (
_o
), 0), 0, 
NULL
)

	)

714 
i
, 
j
, 
mode
, 
¿‹
, 
max¿‹
, 
mwÜd
, 
mİt
, 
r
;

715 
›“80211_¿‹£t
 *
rs
;

716 
›“80211_¿‹£t
 
®Ì©es
;

719 
	`ifmedŸ_š™
(
medŸ
, 0, 
medŸ_chªge
, 
medŸ_¡©
);

720 
max¿‹
 = 0;

721 
	`mem£t
(&
®Ì©es
, 0, (allrates));

723 
mode
 = 
IEEE80211_MODE_AUTO
; mod< 
IEEE80211_MODE_MAX
; mode++) {

724 cÚ¡ 
u_št
 
mİts
[] = {

725 
IFM_AUTO
,

726 
IFM_IEEE80211_11A
,

727 
IFM_IEEE80211_11B
,

728 
IFM_IEEE80211_11G
,

729 
IFM_IEEE80211_FH
,

730 
IFM_IEEE80211_11A
 | 
IFM_IEEE80211_TURBO
,

731 
IFM_IEEE80211_11G
 | 
IFM_IEEE80211_TURBO
,

733 ià((
ic
->
ic_modeÿps
 & (1 << 
mode
)) == 0)

735 
mİt
 = 
mİts
[
mode
];

736 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
);

737 ià(
ÿps
 & 
IEEE80211_C_IBSS
)

738 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
 | 
IFM_IEEE80211_ADHOC
);

739 ià(
ÿps
 & 
IEEE80211_C_HOSTAP
)

740 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
 | 
IFM_IEEE80211_HOSTAP
);

741 ià(
ÿps
 & 
IEEE80211_C_AHDEMO
)

742 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
 | 
IFM_IEEE80211_ADHOC
 | 
IFM_FLAG0
);

743 ià(
ÿps
 & 
IEEE80211_C_MONITOR
)

744 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
 | 
IFM_IEEE80211_MONITOR
);

745 ià(
ÿps
 & 
IEEE80211_C_WDS
)

746 
	`ADD
(
medŸ
, 
IFM_AUTO
, 
mİt
 | 
IFM_IEEE80211_WDS
);

747 ià(
mode
 =ğ
IEEE80211_MODE_AUTO
)

749 
rs
 = &
ic
->
ic_sup_¿‹s
[
mode
];

751 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

752 
¿‹
 = 
rs
->
rs_¿‹s
[
i
];

753 
mwÜd
 = 
	`›“80211_¿‹2medŸ
(
ic
, 
¿‹
, 
mode
);

754 ià(
mwÜd
 == 0)

756 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
);

757 ià(
ÿps
 & 
IEEE80211_C_IBSS
)

758 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
 | 
IFM_IEEE80211_ADHOC
);

759 ià(
ÿps
 & 
IEEE80211_C_HOSTAP
)

760 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
 | 
IFM_IEEE80211_HOSTAP
);

761 ià(
ÿps
 & 
IEEE80211_C_AHDEMO
)

762 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
 | 
IFM_IEEE80211_ADHOC
 | 
IFM_FLAG0
);

763 ià(
ÿps
 & 
IEEE80211_C_MONITOR
)

764 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
 | 
IFM_IEEE80211_MONITOR
);

765 ià(
ÿps
 & 
IEEE80211_C_WDS
)

766 
	`ADD
(
medŸ
, 
mwÜd
, 
mİt
 | 
IFM_IEEE80211_WDS
);

768 
r
 = 
¿‹
 & 
IEEE80211_RATE_VAL
;

769 
j
 = 0; j < 
®Ì©es
.
rs_Ä©es
; j++)

770 ià(
®Ì©es
.
rs_¿‹s
[
j
] =ğ
r
)

772 ià(
j
 =ğ
®Ì©es
.
rs_Ä©es
) {

774 
®Ì©es
.
rs_¿‹s
[
j
] = 
r
;

775 
®Ì©es
.
rs_Ä©es
++;

777 
¿‹
 = (¿‹ & 
IEEE80211_RATE_VAL
) / 2;

778 ià(
¿‹
 > 
max¿‹
)

779 
max¿‹
 = 
¿‹
;

783 
i
 = 0; i < 
®Ì©es
.
rs_Ä©es
; i++) {

784 
mwÜd
 = 
	`›“80211_¿‹2medŸ
(
ic
, 
®Ì©es
.
rs_¿‹s
[
i
],

785 
IEEE80211_MODE_AUTO
);

786 ià(
mwÜd
 == 0)

788 
mwÜd
 = 
	`IFM_SUBTYPE
(mword);

789 
	`ADD
(
medŸ
, 
mwÜd
, 0);

790 ià(
ÿps
 & 
IEEE80211_C_IBSS
)

791 
	`ADD
(
medŸ
, 
mwÜd
, 
IFM_IEEE80211_ADHOC
);

792 ià(
ÿps
 & 
IEEE80211_C_HOSTAP
)

793 
	`ADD
(
medŸ
, 
mwÜd
, 
IFM_IEEE80211_HOSTAP
);

794 ià(
ÿps
 & 
IEEE80211_C_AHDEMO
)

795 
	`ADD
(
medŸ
, 
mwÜd
, 
IFM_IEEE80211_ADHOC
 | 
IFM_FLAG0
);

796 ià(
ÿps
 & 
IEEE80211_C_MONITOR
)

797 
	`ADD
(
medŸ
, 
mwÜd
, 
IFM_IEEE80211_MONITOR
);

798 ià(
ÿps
 & 
IEEE80211_C_WDS
)

799 
	`ADD
(
medŸ
, 
mwÜd
, 
IFM_IEEE80211_WDS
);

802  
max¿‹
;

803 #undeà
ADD


804 
	}
}

815 
	$›“80211_dfs_aùiÚ
(
›“80211com
 *
ic
) {

816 
›“80211v­
 *
v­
;

819 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

820 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

825 ià(
v­
 =ğ
NULL
) {

831 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

832 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_SCAN
) {

839 ià(
v­
 =ğ
NULL
)

843 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
)

849 ià(!(
	`›“80211_check_sÿn
(
v­
, 
IEEE80211_SCAN_NOSSID
 |

850 
IEEE80211_SCAN_KEEPMODE
 |

851 
IEEE80211_SCAN_USECACHE
, 0,

852 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
,

853 
›“80211_sÿn_dfs_aùiÚ
))) {

856 
	`›“80211_sÿn_dfs_aùiÚ
(
v­
, 
NULL
);

858 
	}
}

861 
	$›“80211_expœe_exş_»¡riùiÚs
(
›“80211com
 *
ic
)

863 
›“80211_chªÃl
 *
c
 = 
NULL
;

864 
Ãt_deviû
 *
dev
 = 
ic
->
ic_dev
;

865 
timev®
 
tv_now
;

866 
i
;

868 
	`do_g‘timeofday
(&
tv_now
);

869 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

870 
c
 = &
ic
->
ic_chªÃls
[
i
];

871 ià(
c
->
ic_æags
 & 
IEEE80211_CHAN_RADAR
) {

872 ià(
	`timev®_com·»
(&
ic
->
ic_chª_nÚ_occupy
[
i
],

873 &
tv_now
) < 0) {

874 
	`if_´štf
(
dev
,

879 
c
->
ic_›“
, c->
ic_äeq
, 
tv_now
.
tv_£c
,

880 
tv_now
.
tv_u£c
);

881 
c
->
ic_æags
 &ğ~
IEEE80211_CHAN_RADAR
;

883 
	`if_´štf
(
dev
,

888 
c
->
ic_›“
, c->
ic_äeq
,

889 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_£c
 -

890 
tv_now
.
tv_£c
,

891 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_£c
,

892 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_u£c
);

896 
	}
}

897 
EXPORT_SYMBOL
(
›“80211_expœe_exş_»¡riùiÚs
);

902 
	$›“80211_upd©e_dfs_exş_tim”
(
›“80211com
 *
ic
)

904 
›“80211_chªÃl
 * 
chª
;

905 
timev®
 
tv_now
, 
tv_Ãxt
;

906 
i
;

907 
jiff›s_tmp
;

909 
	`do_g‘timeofday
(&
tv_now
);

910 
jiff›s_tmp
 = 
jiff›s
;

912 
tv_Ãxt
.
tv_£c
 = 0;

913 
tv_Ãxt
.
tv_u£c
 = 0;

914 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

915 
chª
 = &
ic
->
ic_chªÃls
[
i
];

916 ià(
chª
->
ic_æags
 & 
IEEE80211_CHAN_RADAR
) {

917 ià((
tv_Ãxt
.
tv_£c
 == 0) &&

918 (
tv_Ãxt
.
tv_u£c
 == 0)) {

919 
tv_Ãxt
 = 
ic
->
ic_chª_nÚ_occupy
[
i
];

921 ià(
	`timev®_com·»
(&
ic
->
ic_chª_nÚ_occupy
[
i
],

922 &
tv_Ãxt
) < 0) {

923 
tv_Ãxt
 = 
ic
->
ic_chª_nÚ_occupy
[
i
];

928 ià((
tv_Ãxt
.
tv_£c
 == 0) &&

929 (
tv_Ãxt
.
tv_u£c
 == 0)) {

930 
	`d–_tim”
(&
ic
->
ic_dfs_exş_tim”
);

932 
	`mod_tim”
(&
ic
->
ic_dfs_exş_tim”
,

933 
jiff›s_tmp
 +

934 (
tv_Ãxt
.
tv_£c
 - 
tv_now
.tv_£ø+ 1è* 
HZ
);

936 
	}
}

940 
	$›“80211_expœe_dfs_exş_tim”
(
d©a
)

942 
›“80211com
 *
ic
 = (›“80211com *)
d©a
;

943 
›“80211v­
 *
v­
;

945 
	`´štk
(
KERN_INFO
 "%s: %s:ƒxpiring Non-Occupancy Period\n",

946 
	`DEV_NAME
(
ic
->
ic_dev
), 
__func__
);

948 ià(
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_MARKDFS
) {

951 
	`›“80211_expœe_exş_»¡riùiÚs
(
ic
);

954 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

958 ià((
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) &&

959 ((
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) ||

960 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)) &&

962 (
v­
->
iv_des_chª
 !ğ
IEEE80211_CHAN_ANYC
) &&

963 (
v­
->
iv_des_chª
->
ic_äeq
 > 0) &&

964 (
v­
->
iv_des_chª
->
ic_äeq
 !=

965 
ic
->
ic_bsschª
->
ic_äeq
)) {

966 
›“80211_chªÃl
 *
des_chª
 =

967 
	`›“80211_fšd_chªÃl
(
ic
,

968 
v­
->
iv_des_chª
->

969 
ic_äeq
,

970 
v­
->
iv_des_chª
->

971 
ic_æags
);

973 ià(
NULL
 =ğ
des_chª
) {

974 
	`IEEE80211_DPRINTF
(
v­
,

975 
IEEE80211_MSG_DOTH
,

978 
__func__
,

979 
v­
->
iv_des_chª
->

980 
ic_äeq
,

981 
v­
->
iv_des_chª
->

982 
ic_æags
);

983 } ià(!(
des_chª
->
ic_æags
 &

984 
IEEE80211_CHAN_RADAR
)) {

985 
	`IEEE80211_DPRINTF
(
v­
,

986 
IEEE80211_MSG_DOTH
,

990 
__func__
,

991 
v­
->
iv_des_chª
->

992 
ic_äeq
,

993 
v­
->
iv_des_chª
->

994 
ic_æags
);

995 
ic
->
ic_chªchªge_chª
 =

996 
des_chª
->
ic_›“
;

997 
ic
->
ic_chªchªge_tb‰
 =

998 
IEEE80211_RADAR_CHANCHANGE_TBTT_COUNT
;

999 
ic
->
ic_æags
 |ğ
IEEE80211_F_CHANSWITCH
;

1000 } ià(
	`›“80211_msg_is_»pÜ‹d
(
v­
,

1001 
IEEE80211_MSG_DOTH
)) {

1005 
i_des_chª
 = -1, 
i
 = 0;

1006 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1007 ià(&
ic
->
ic_chªÃls
[
i
] ==

1008 
des_chª
) {

1009 
i_des_chª
 = 
i
;

1013 
	`IEEE80211_DPRINTF
(
v­
,

1014 
IEEE80211_MSG_DOTH
,

1019 
__func__
,

1020 
ic
->
ic_chª_nÚ_occupy


1021 [
i_des_chª
].

1022 
tv_£c
,

1023 
ic
->
ic_chª_nÚ_occupy


1024 [
i_des_chª
].

1025 
tv_u£c


1033 
	`›“80211_upd©e_dfs_exş_tim”
(
ic
);

1034 
	}
}

1039 
	$›“80211_m¬k_dfs
(
›“80211com
 *
ic
, 
›“80211_chªÃl
 *
ichª
)

1041 
›“80211_chªÃl
 *
c
=
NULL
;

1042 
Ãt_deviû
 *
dev
 = 
ic
->
ic_dev
;

1043 
timev®
 
tv_now
;

1044 
exş_³riod
 = 
ic
->
	`ic_g‘_dfs_exş_³riod
(ic);

1045 
i
;

1047 
	`do_g‘timeofday
(&
tv_now
);

1048 
	`if_´štf
(
dev
, "Radar found on channel %3d (%4d MHz) -- "

1050 
ichª
->
ic_›“
, ichª->
ic_äeq
,

1051 
tv_now
.
tv_£c
,v_now.
tv_u£c
);

1052 ià(
	`IEEE80211_IS_MODE_DFS_MASTER
(
ic
->
ic_İmode
)) {

1054 ià(
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_MARKDFS
) {

1055 
	`if_´štf
(
dev
, "Marking channel %3d (%4d MHz) in "

1057 
ichª
->
ic_›“
, ichª->
ic_äeq
,

1058 
tv_now
.
tv_£c
,v_now.
tv_u£c
);

1059 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1060 
c
 = &
ic
->
ic_chªÃls
[
i
];

1061 ià(
c
->
ic_äeq
 =ğ
ichª
->ic_freq) {

1062 
c
->
ic_æags
 |ğ
IEEE80211_CHAN_RADAR
;

1063 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_£c
 =

1064 
tv_now
.
tv_£c
 + 
exş_³riod
;

1065 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_u£c
 =

1066 
tv_now
.
tv_u£c
;

1068 
	`if_´štf
(
dev
, "Channel %3d (%4d MHz) "

1073 
ichª
->
ic_›“
, ichª->
ic_äeq
,

1074 
exş_³riod
,

1075 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_£c
,

1076 
ic
->
ic_chª_nÚ_occupy
[
i
].
tv_u£c
);

1082 
	`›“80211_upd©e_dfs_exş_tim”
(
ic
);

1084 
c
 = 
	`›“80211_fšd_chªÃl
(
ic
, 
ichª
->
ic_äeq
,

1085 
ichª
->
ic_æags
);

1086 ià(
c
 =ğ
NULL
) {

1087 
	`if_´štf
(
dev
, "%s: Couldn't find matching "

1090 
__func__
, 
ichª
->
ic_äeq
,

1091 
ichª
->
ic_æags
);

1094 ià(
ic
->
ic_curchª
->
ic_äeq
 =ğ
c
->ic_freq) {

1095 
	`if_´štf
(
dev
, "%s: Invoking "

1098 
__func__
, 
ichª
->
ic_äeq
,

1099 
ichª
->
ic_æags
);

1102 
	`›“80211_dfs_aùiÚ
(
ic
);

1104 
	`if_´štf
(
dev
,

1110 
ichª
->
ic_›“
,

1111 
ichª
->
ic_äeq
,

1112 
ic
->
ic_curchª
->
ic_›“
,

1113 
ic
->
ic_curchª
->
ic_äeq
);

1117 
ic
->
ic_chªchªge_chª
 = 
IEEE80211_RADAR_TEST_MUTE_CHAN
;

1118 
ic
->
ic_chªchªge_tb‰
 =

1119 
IEEE80211_RADAR_CHANCHANGE_TBTT_COUNT
;

1120 
ic
->
ic_æags
 |ğ
IEEE80211_F_CHANSWITCH
;

1121 
	`if_´štf
(
dev
,

1127 
ichª
->
ic_›“
, ichª->
ic_äeq
,

1128 
ic
->
ic_curchª
->
ic_›“
,

1129 
ic
->
ic_curchª
->
ic_äeq
);

1135 
	}
}

1136 
EXPORT_SYMBOL
(
›“80211_m¬k_dfs
);

1139 
	$›“80211_ªnounû
(
›“80211com
 *
ic
)

1143 
Ãt_deviû
 *
dev
 = 
ic
->
ic_dev
;

1144 
i
, 
mode
, 
¿‹
, 
mwÜd
;

1145 
›“80211_¿‹£t
 *
rs
;

1147 
mode
 = 
IEEE80211_MODE_11A
; mod< 
IEEE80211_MODE_MAX
; mode++) {

1148 ià((
ic
->
ic_modeÿps
 & (1 << 
mode
)) == 0)

1150 
	`if_´štf
(
dev
, "% ¿‹s: ", 
›“80211_phymode_Çme
[
mode
]);

1151 
rs
 = &
ic
->
ic_sup_¿‹s
[
mode
];

1152 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

1153 
¿‹
 = 
rs
->
rs_¿‹s
[
i
];

1154 
mwÜd
 = 
	`›“80211_¿‹2medŸ
(
ic
, 
¿‹
, 
mode
);

1155 ià(
mwÜd
 == 0)

1157 
	`´štk
("%s%d%sMbps", (
i
 != 0 ? " " : ""),

1158 (
¿‹
 & 
IEEE80211_RATE_VAL
) / 2,

1159 ((
¿‹
 & 0x1) != 0 ? ".5" : ""));

1161 
	`´štk
("\n");

1163 
	`if_´štf
(
dev
, "H/Wƒncryption support:");

1164 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_WEP
)

1165 
	`´štk
(" WEP");

1166 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_AES
)

1167 
	`´štk
(" AES");

1168 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_AES_CCM
)

1169 
	`´štk
(" AES_CCM");

1170 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_CKIP
)

1171 
	`´štk
(" CKIP");

1172 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_TKIP
)

1173 
	`´štk
(" TKIP");

1174 
	`´štk
("\n");

1176 
	}
}

1177 
EXPORT_SYMBOL
(
›“80211_ªnounû
);

1180 
	$›“80211_ªnounû_chªÃls
(
›“80211com
 *
ic
)

1182 cÚ¡ 
›“80211_chªÃl
 *
c
;

1183 
ty³
;

1184 
i
;

1186 
	`´štk
(
KERN_INFO
 "Chan Freq RegPwr MinPwr MaxPwr\n");

1187 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1188 
c
 = &
ic
->
ic_chªÃls
[
i
];

1189 ià(
	`IEEE80211_IS_CHAN_ST
(
c
))

1190 
ty³
 = 'S';

1191 ià(
	`IEEE80211_IS_CHAN_108A
(
c
))

1192 
ty³
 = 'T';

1193 ià(
	`IEEE80211_IS_CHAN_108G
(
c
))

1194 
ty³
 = 'G';

1195 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

1196 
ty³
 = 'a';

1197 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
))

1198 
ty³
 = 'g';

1199 ià(
	`IEEE80211_IS_CHAN_B
(
c
))

1200 
ty³
 = 'b';

1202 
ty³
 = 'f';

1203 
	`´štk
(
KERN_INFO
 "%4d %4d%c %6d %6d %6d\n",

1204 
c
->
ic_›“
, c->
ic_äeq
, 
ty³
,

1205 
c
->
ic_max»gpow”
,

1206 
c
->
ic_mšpow”
, c->
ic_maxpow”


1209 
	}
}

1210 
EXPORT_SYMBOL
(
›“80211_ªnounû_chªÃls
);

1217 
	$medŸ_¡©us
(
›“80211_İmode
 
İmode
, cÚ¡ 
›“80211_chªÃl
 *
chª
)

1219 
¡©us
;

1221 
¡©us
 = 
IFM_IEEE80211
;

1222 
İmode
) {

1223 
IEEE80211_M_STA
:

1225 
IEEE80211_M_AHDEMO
:

1226 
¡©us
 |ğ
IFM_IEEE80211_ADHOC
 | 
IFM_FLAG0
;

1228 
IEEE80211_M_IBSS
:

1229 
¡©us
 |ğ
IFM_IEEE80211_ADHOC
;

1231 
IEEE80211_M_HOSTAP
:

1232 
¡©us
 |ğ
IFM_IEEE80211_HOSTAP
;

1234 
IEEE80211_M_MONITOR
:

1235 
¡©us
 |ğ
IFM_IEEE80211_MONITOR
;

1237 
IEEE80211_M_WDS
:

1238 
¡©us
 |ğ
IFM_IEEE80211_WDS
;

1241 ià(
	`IEEE80211_IS_CHAN_A
(
chª
)) {

1242 
¡©us
 |ğ
IFM_IEEE80211_11A
;

1243 ià(
	`IEEE80211_IS_CHAN_TURBO
(
chª
))

1244 
¡©us
 |ğ
IFM_IEEE80211_TURBO
;

1245 } ià(
	`IEEE80211_IS_CHAN_B
(
chª
)) {

1246 
¡©us
 |ğ
IFM_IEEE80211_11B
;

1247 } ià(
	`IEEE80211_IS_CHAN_ANYG
(
chª
)) {

1248 
¡©us
 |ğ
IFM_IEEE80211_11G
;

1249 ià(
	`IEEE80211_IS_CHAN_TURBO
(
chª
))

1250 
¡©us
 |ğ
IFM_IEEE80211_TURBO
;

1251 } ià(
	`IEEE80211_IS_CHAN_FHSS
(
chª
)) {

1252 
¡©us
 |ğ
IFM_IEEE80211_FH
;

1256  
¡©us
;

1257 
	}
}

1263 
	$›“80211com_medŸ_¡©us
(
Ãt_deviû
 *
dev
, 
ifmedŸ»q
 *
imr
)

1265 
›“80211com
 *
ic
 = 
	`Ãtdev_´iv
(
dev
);

1267 
imr
->
ifm_¡©us
 = 
IFM_AVALID
;

1268 ià(!
	`TAILQ_EMPTY
(&
ic
->
ic_v­s
))

1269 
imr
->
ifm_¡©us
 |ğ
IFM_ACTIVE
;

1270 
imr
->
ifm_aùive
 = 
	`medŸ_¡©us
(
ic
->
ic_İmode
, ic->
ic_curchª
);

1271 
	}
}

1277 
	$medŸ2mode
(cÚ¡ 
ifmedŸ_’Œy
 *
ime
, 
›“80211_phymode
 *
mode
)

1280 
	`IFM_MODE
(
ime
->
ifm_medŸ
)) {

1281 
IFM_IEEE80211_11A
:

1282 *
mode
 = 
IEEE80211_MODE_11A
;

1284 
IFM_IEEE80211_11B
:

1285 *
mode
 = 
IEEE80211_MODE_11B
;

1287 
IFM_IEEE80211_11G
:

1288 *
mode
 = 
IEEE80211_MODE_11G
;

1290 
IFM_IEEE80211_FH
:

1291 *
mode
 = 
IEEE80211_MODE_FH
;

1293 
IFM_AUTO
:

1294 *
mode
 = 
IEEE80211_MODE_AUTO
;

1303 ià(
ime
->
ifm_medŸ
 & 
IFM_IEEE80211_TURBO
) {

1304 ià(*
mode
 =ğ
IEEE80211_MODE_11A
)

1305 *
mode
 = 
IEEE80211_MODE_TURBO_A
;

1306 ià(*
mode
 =ğ
IEEE80211_MODE_11G
)

1307 *
mode
 = 
IEEE80211_MODE_TURBO_G
;

1312 
	}
}

1315 
	$›“80211com_medŸ_chªge
(
Ãt_deviû
 *
dev
)

1317 
›“80211com
 *
ic
 = 
	`Ãtdev_´iv
(
dev
);

1318 
›“80211v­
 *
v­
;

1319 
ifmedŸ_’Œy
 *
ime
 = 
ic
->
ic_medŸ
.
ifm_cur
;

1320 
›“80211_phymode
 
Ãwphymode
;

1321 
j
, 
”rÜ
 = 0;

1325 ià(!
	`medŸ2mode
(
ime
, &
Ãwphymode
))

1326  -
EINVAL
;

1335 ià((
ic
->
ic_İmode
 =ğ
IEEE80211_M_HOSTAP
) &&

1336 (
Ãwphymode
 =ğ
IEEE80211_MODE_AUTO
)) {

1337 
j
 = 
IEEE80211_MODE_11A
; j < 
IEEE80211_MODE_MAX
; j++)

1338 ià(
ic
->
ic_modeÿps
 & (1 << 
j
)) {

1339 
Ãwphymode
 = 
j
;

1345 
	`IEEE80211_LOCK_IRQ
(
ic
);

1346 ià(
ic
->
ic_curmode
 !ğ
Ãwphymode
) {

1347 
”rÜ
 = 
	`›“80211_£tmode
(
ic
, 
Ãwphymode
);

1348 ià(
”rÜ
 != 0) {

1349 
	`IEEE80211_UNLOCK_IRQ_EARLY
(
ic
);

1350  
”rÜ
;

1352 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1354 
	`›“80211_wme_š™·¿ms_locked
(
v­
);

1361 
	`KASSERT
(
v­
->
iv_bss
 !ğ
NULL
, ("no bss‚ode"));

1362 
v­
->
iv_bss
->
ni_¿‹s
 = 
ic
->
ic_sup_¿‹s
[
Ãwphymode
];

1364 
”rÜ
 = -
ENETRESET
;

1366 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

1368 #ifdeà
nÙdef


1369 ià(
”rÜ
 == 0)

1370 
iå
->
if_baud¿‹
 = 
	`ifmedŸ_baud¿‹
(
ime
->
ifm_medŸ
);

1372  
”rÜ
;

1373 
	}
}

1376 
	$fšd¿‹
(
›“80211com
 *
ic
, 
›“80211_phymode
 
mode
, 
¿‹
)

1378 
	#IEEERATE
(
_ic
,
_m
,
_i
) \

1379 ((
_ic
)->
ic_sup_¿‹s
[
_m
].
rs_¿‹s
[
_i
] & 
IEEE80211_RATE_VAL
)

	)

1380 
i
, 
Ä©es
 = 
ic
->
ic_sup_¿‹s
[
mode
].
rs_Ä©es
;

1381 
i
 = 0; i < 
Ä©es
; i++)

1382 ià(
	`IEEERATE
(
ic
, 
mode
, 
i
è=ğ
¿‹
)

1383  
i
;

1385 #undeà
IEEERATE


1386 
	}
}

1394 
	$check¿‹
(
›“80211com
 *
ic
, 
›“80211_phymode
 
mode
, 
¿‹
)

1398 ià(
mode
 =ğ
IEEE80211_MODE_AUTO
) {

1399 
i
;

1401 
i
 = 
IEEE80211_MODE_11A
; i < 
IEEE80211_MODE_MAX
; i++) {

1402 ià((
ic
->
ic_modeÿps
 & (1 << 
i
)) &&

1403 
	`fšd¿‹
(
ic
, 
i
, 
¿‹
) != -1)

1409  (
	`fšd¿‹
(
ic
, 
mode
, 
¿‹
) != -1);

1411 
	}
}

1419 
	$›“80211_medŸ_chªge
(
Ãt_deviû
 *
dev
)

1421 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1422 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1423 
ifmedŸ_’Œy
 *
ime
 = 
v­
->
iv_medŸ
.
ifm_cur
;

1424 
›“80211_phymode
 
Ãwmode
;

1425 
Ãw¿‹
, 
”rÜ
;

1428 ià(!
	`medŸ2mode
(
ime
, &
Ãwmode
))

1429  -
EINVAL
;

1431 ià(
	`IFM_SUBTYPE
(
ime
->
ifm_medŸ
è!ğ
IFM_AUTO
) {

1436 
Ãw¿‹
 = 
	`›“80211_medŸ2¿‹
(
ime
->
ifm_medŸ
);

1437 ià((
Ãw¿‹
 =ğ0è|| !
	`check¿‹
(
ic
, 
Ãwmode
,‚ewrate))

1438  -
EINVAL
;

1440 
Ãw¿‹
 = 
IEEE80211_FIXED_RATE_NONE
;

1443 
”rÜ
 = 0;

1444 ià(
v­
->
iv_fixed_¿‹
 !ğ
Ãw¿‹
) {

1445 
v­
->
iv_fixed_¿‹
 = 
Ãw¿‹
;

1446 
”rÜ
 = -
ENETRESET
;

1448 ià(
v­
->
iv_des_mode
 !ğ
Ãwmode
) {

1449 
v­
->
iv_des_mode
 = 
Ãwmode
;

1450 
”rÜ
 = -
ENETRESET
;

1452  
”rÜ
;

1453 
	}
}

1454 
EXPORT_SYMBOL
(
›“80211_medŸ_chªge
);

1457 
	$›“80211_medŸ_¡©us
(
Ãt_deviû
 *
dev
, 
ifmedŸ»q
 *
imr
)

1459 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1460 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1461 
›“80211_phymode
 
mode
;

1462 
›“80211_¿‹£t
 *
rs
;

1464 
imr
->
ifm_¡©us
 = 
IFM_AVALID
;

1470 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

1471 
imr
->
ifm_¡©us
 |ğ
IFM_ACTIVE
;

1472 
mode
 = 
	`›“80211_chª2mode
(
ic
->
ic_curchª
);

1474 
mode
 = 
IEEE80211_MODE_AUTO
;

1475 
imr
->
ifm_aùive
 = 
	`medŸ_¡©us
(
v­
->
iv_İmode
, 
ic
->
ic_curchª
);

1477 ià(
v­
->
iv_fixed_¿‹
 !ğ
IEEE80211_FIXED_RATE_NONE
) {

1479 
imr
->
ifm_aùive
 |ğ
	`›“80211_¿‹2medŸ
(
ic
,

1480 
v­
->
iv_fixed_¿‹
, 
mode
);

1481 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

1483 
rs
 = &
v­
->
iv_bss
->
ni_¿‹s
;

1484 
imr
->
ifm_aùive
 |ğ
	`›“80211_¿‹2medŸ
(
ic
,

1485 
rs
->
rs_¿‹s
[
v­
->
iv_bss
->
ni_tx¿‹
], 
mode
);

1487 
imr
->
ifm_aùive
 |ğ
IFM_AUTO
;

1488 
	}
}

1489 
EXPORT_SYMBOL
(
›“80211_medŸ_¡©us
);

1495 
	$›“80211_£tmode
(
›“80211com
 *
ic
, 
›“80211_phymode
 
mode
)

1501 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
 &&

1502 
mode
 !ğ
	`›“80211_chª2mode
(
ic
->
ic_bsschª
))

1503 
ic
->
ic_bsschª
 = 
IEEE80211_CHAN_ANYC
;

1505 
	`›“80211_»£t_”p
(
ic
, 
mode
);

1506 
ic
->
ic_curmode
 = 
mode
;

1508 
	}
}

1509 
EXPORT_SYMBOL
(
›“80211_£tmode
);

1514 
›“80211_phymode


1515 
	$›“80211_chª2mode
(cÚ¡ 
›“80211_chªÃl
 *
chª
)

1522 
	`KASSERT
(
chª
 !ğ
IEEE80211_CHAN_ANYC
, ("channel‚ot setup"));

1524 ià(
	`IEEE80211_IS_CHAN_108G
(
chª
))

1525  
IEEE80211_MODE_TURBO_G
;

1526 ià(
	`IEEE80211_IS_CHAN_TURBO
(
chª
))

1527  
IEEE80211_MODE_TURBO_A
;

1528 ià(
	`IEEE80211_IS_CHAN_A
(
chª
))

1529  
IEEE80211_MODE_11A
;

1530 ià(
	`IEEE80211_IS_CHAN_ANYG
(
chª
))

1531  
IEEE80211_MODE_11G
;

1532 ià(
	`IEEE80211_IS_CHAN_B
(
chª
))

1533  
IEEE80211_MODE_11B
;

1534 ià(
	`IEEE80211_IS_CHAN_FHSS
(
chª
))

1535  
IEEE80211_MODE_FH
;

1538 
	`´štk
(
KERN_ERR
 "%s: cannot map channelo mode; freq %u flags 0x%x\n",

1539 
__func__
, 
chª
->
ic_äeq
, chª->
ic_æags
);

1540  
IEEE80211_MODE_11B
;

1541 
	}
}

1542 
EXPORT_SYMBOL
(
›“80211_chª2mode
);

1549 
	$›“80211_¿‹2medŸ
(
›“80211com
 *
ic
, 
¿‹
, 
›“80211_phymode
 
mode
)

1552 
u_št
 
m
;

1553 
u_št
 
r
;

1554 } 
¿‹s
[] = {

1555 { 2 | 
IFM_IEEE80211_FH
, 
IFM_IEEE80211_FH1
 },

1556 { 4 | 
IFM_IEEE80211_FH
, 
IFM_IEEE80211_FH2
 },

1557 { 2 | 
IFM_IEEE80211_11B
, 
IFM_IEEE80211_DS1
 },

1558 { 4 | 
IFM_IEEE80211_11B
, 
IFM_IEEE80211_DS2
 },

1559 { 11 | 
IFM_IEEE80211_11B
, 
IFM_IEEE80211_DS5
 },

1560 { 22 | 
IFM_IEEE80211_11B
, 
IFM_IEEE80211_DS11
 },

1561 { 44 | 
IFM_IEEE80211_11B
, 
IFM_IEEE80211_DS22
 },

1562 { 3 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM1_50
 },

1563 { 4 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM2_25
 },

1564 { 6 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM3
 },

1565 { 9 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM4_50
 },

1566 { 12 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM6
 },

1567 { 18 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM9
 },

1568 { 24 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM12
 },

1569 { 27 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM13_5
 },

1570 { 36 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM18
 },

1571 { 48 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM24
 },

1572 { 54 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM27
 },

1573 { 72 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM36
 },

1574 { 96 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM48
 },

1575 { 108 | 
IFM_IEEE80211_11A
, 
IFM_IEEE80211_OFDM54
 },

1576 { 2 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_DS1
 },

1577 { 4 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_DS2
 },

1578 { 11 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_DS5
 },

1579 { 22 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_DS11
 },

1580 { 12 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM6
 },

1581 { 18 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM9
 },

1582 { 24 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM12
 },

1583 { 36 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM18
 },

1584 { 48 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM24
 },

1585 { 72 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM36
 },

1586 { 96 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM48
 },

1587 { 108 | 
IFM_IEEE80211_11G
, 
IFM_IEEE80211_OFDM54
 },

1591 
u_št
 
mask
, 
i
;

1592 
mask
 = 
¿‹
 & 
IEEE80211_RATE_VAL
;

1593 
mode
) {

1594 
IEEE80211_MODE_11A
:

1595 
IEEE80211_MODE_TURBO_A
:

1596 
mask
 |ğ
IFM_IEEE80211_11A
;

1598 
IEEE80211_MODE_11B
:

1599 
mask
 |ğ
IFM_IEEE80211_11B
;

1601 
IEEE80211_MODE_FH
:

1602 
mask
 |ğ
IFM_IEEE80211_FH
;

1604 
IEEE80211_MODE_AUTO
:

1606 ià(
ic
 && (ic->
ic_phyty³
 =ğ
IEEE80211_T_FH
)) {

1607 
mask
 |ğ
IFM_IEEE80211_FH
;

1612 
IEEE80211_MODE_11G
:

1613 
IEEE80211_MODE_TURBO_G
:

1614 
mask
 |ğ
IFM_IEEE80211_11G
;

1617 
i
 = 0; i < 
	`ARRAY_SIZE
(
¿‹s
); i++)

1618 ià(
¿‹s
[
i
].
m
 =ğ
mask
)

1619  
¿‹s
[
i
].
r
;

1620  
IFM_AUTO
;

1621 
	}
}

1622 
EXPORT_SYMBOL
(
›“80211_¿‹2medŸ
);

1625 
	$›“80211_medŸ2¿‹
(
mwÜd
)

1627 cÚ¡ 
›“¿‹s
[] = {

1654  
	`IFM_SUBTYPE
(
mwÜd
è< 
	`ARRAY_SIZE
(
›“¿‹s
) ?

1655 
›“¿‹s
[
	`IFM_SUBTYPE
(
mwÜd
)] : 0;

1656 
	}
}

1657 
EXPORT_SYMBOL
(
›“80211_medŸ2¿‹
);

1662 
Ãt_deviû_¡©s
 *

1663 
	$›“80211_g‘¡©s
(
Ãt_deviû
 *
dev
)

1665 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1666 
Ãt_deviû_¡©s
 *
¡©s
 = &
v­
->
iv_dev¡©s
;

1670 
¡©s
->
tx_”rÜs
 = 
v­
->
iv_¡©s
.
is_tx_nodefkey


1671 + 
v­
->
iv_¡©s
.
is_tx_noh—droom


1672 + 
v­
->
iv_¡©s
.
is_üy±o_’micç
;

1673 
¡©s
->
tx_drİ³d
 = 
v­
->
iv_¡©s
.
is_tx_nobuf


1674 + 
v­
->
iv_¡©s
.
is_tx_nÚode


1675 + 
v­
->
iv_¡©s
.
is_tx_unknownmgt


1676 + 
v­
->
iv_¡©s
.
is_tx_badch”


1677 + 
v­
->
iv_¡©s
.
is_tx_nodefkey
;

1678 
¡©s
->
rx_”rÜs
 = 
v­
->
iv_¡©s
.
is_rx_tooshÜt


1679 + 
v­
->
iv_¡©s
.
is_rx_w•ç


1680 + 
v­
->
iv_¡©s
.
is_rx_deÿp


1681 + 
v­
->
iv_¡©s
.
is_rx_nobuf


1682 + 
v­
->
iv_¡©s
.
is_rx_deüy±üc


1683 + 
v­
->
iv_¡©s
.
is_rx_ccmpmic


1684 + 
v­
->
iv_¡©s
.
is_rx_tkmic


1685 + 
v­
->
iv_¡©s
.
is_rx_tkicv
;

1686 
¡©s
->
rx_üc_”rÜs
 = 0;

1688  
¡©s
;

1689 
	}
}

1692 
	$›“80211_chªge_mtu
(
Ãt_deviû
 *
dev
, 
mtu
)

1694 ià((
IEEE80211_MTU_MIN
 >ğ
mtu
è|| (mtu > 
IEEE80211_MTU_MAX
))

1695  -
EINVAL
;

1696 
dev
->
mtu
 = mtu;

1699 
	}
}

1702 
	$›“80211_£t_muÉiÿ¡_li¡
(
Ãt_deviû
 *
dev
)

1704 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1705 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1706 
Ãt_deviû
 *
·»Á
 = 
ic
->
ic_dev
;

1708 
	`IEEE80211_LOCK_IRQ
(
ic
);

1709 ià(
dev
->
æags
 & 
IFF_PROMISC
) {

1710 ià((
v­
->
iv_æags
 & 
IEEE80211_F_PROMISC
) == 0) {

1711 
v­
->
iv_æags
 |ğ
IEEE80211_F_PROMISC
;

1712 
ic
->
ic_´omisc
++;

1713 
·»Á
->
æags
 |ğ
IFF_PROMISC
;

1716 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PROMISC
) {

1717 
v­
->
iv_æags
 &ğ~
IEEE80211_F_PROMISC
;

1718 
ic
->
ic_´omisc
--;

1719 
·»Á
->
æags
 &ğ~
IFF_PROMISC
;

1722 ià(
dev
->
æags
 & 
IFF_ALLMULTI
) {

1723 ià((
v­
->
iv_æags
 & 
IEEE80211_F_ALLMULTI
) == 0) {

1724 
v­
->
iv_æags
 |ğ
IEEE80211_F_ALLMULTI
;

1725 
ic
->
ic_®lmuÉi
++;

1726 
·»Á
->
æags
 |ğ
IFF_ALLMULTI
;

1729 ià(
v­
->
iv_æags
 & 
IEEE80211_F_ALLMULTI
) {

1730 
v­
->
iv_æags
 &ğ~
IEEE80211_F_ALLMULTI
;

1731 
ic
->
ic_®lmuÉi
--;

1732 
·»Á
->
æags
 &ğ~
IFF_ALLMULTI
;

1735 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

1738 
·»Á
->
	`£t_muÉiÿ¡_li¡
(
ic
->
ic_dev
);

1739 
	}
}

1742 
	$›“80211_bud_couÁry›
(
›“80211com
 *
ic
)

1744 
i
, 
found
;

1745 
Ãt_deviû
 *
dev
 = 
ic
->
ic_dev
;

1746 
›“80211_chªÃl
 *
c
;

1747 
u_št8_t
 *
cur_ruÆ’
, *
cur_chª
, *
cur_pow
, 
´evchª
;

1750 
	`mem£t
(&
ic
->
ic_couÁry_›
, 0, (ic->ic_country_ie));

1751 
ic
->
ic_couÁry_›
.
couÁry_id
 = 
IEEE80211_ELEMID_COUNTRY
;

1754 
found
 = 0;

1755 
i
 = 0; i < 
	`ARRAY_SIZE
(
couÁry_¡ršgs
); i++) {

1756 ià(
couÁry_¡ršgs
[
i
].
iso_code
 =ğ
ic
->
ic_couÁry_code
) {

1757 
ic
->
ic_couÁry_›
.
couÁry_¡r
[0] = 
couÁry_¡ršgs
[
i
].
iso_Çme
[0];

1758 
ic
->
ic_couÁry_›
.
couÁry_¡r
[1] = 
couÁry_¡ršgs
[
i
].
iso_Çme
[1];

1759 
found
 = 1;

1763 ià(!
found
) {

1764 
	`if_´štf
(
dev
, "bad country string ignored: %d\n",

1765 
ic
->
ic_couÁry_code
);

1766 
ic
->
ic_couÁry_›
.
couÁry_¡r
[0] = ' ';

1767 
ic
->
ic_couÁry_›
.
couÁry_¡r
[1] = ' ';

1778 
ic
->
ic_couÁry_›
.
couÁry_¡r
[2] = 'I';

1779 ià(
ic
->
ic_couÁry_outdoÜ
)

1780 
ic
->
ic_couÁry_›
.
couÁry_¡r
[2] = ' ';

1782 
cur_ruÆ’
 = &
ic
->
ic_couÁry_›
.
couÁry_ŒËt
[1];

1783 
cur_chª
 = &
ic
->
ic_couÁry_›
.
couÁry_ŒËt
[0];

1784 
cur_pow
 = &
ic
->
ic_couÁry_›
.
couÁry_ŒËt
[2];

1785 
´evchª
 = 0;

1786 
ic
->
ic_couÁry_›
.
couÁry_Ën
 = 3;

1788 ià((
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_REGCLASS
è&& ic->
ic_Äegşass
) {

1796 
i
 = 0; i < 
ic
->
ic_Äegşass
; i++) {

1797 *
cur_chª
 = 
IEEE80211_REG_EXT_ID
;

1798 *
cur_ruÆ’
 = 
ic
->
ic_»gşassids
[
i
];

1799 *
cur_pow
 = 
ic
->
ic_cov”ageşass
;

1801 
cur_ruÆ’
 += 3;

1802 
cur_chª
 += 3;

1803 
cur_pow
 += 3;

1804 
ic
->
ic_couÁry_›
.
couÁry_Ën
 += 3;

1807 
u_št16_t
 
curmode_nÙurbo
 = 
ic
->
ic_curmode
;

1810 
curmode_nÙurbo
) {

1811 
IEEE80211_MODE_TURBO_A
:

1812 
curmode_nÙurbo
 = 
IEEE80211_MODE_11A
;

1814 
IEEE80211_MODE_TURBO_G
:

1815 
curmode_nÙurbo
 = 
IEEE80211_MODE_11G
;

1819 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1820 
c
 = &
ic
->
ic_chªÃls
[
i
];

1823 ià(
	`›“80211_chª2mode
(
c
è!ğ
curmode_nÙurbo
)

1827 ià(
	`IEEE80211_IS_CHAN_HALF
(
c
) ||

1828 
	`IEEE80211_IS_CHAN_QUARTER
(
c
))

1831 ià(*
cur_ruÆ’
 == 0) {

1832 (*
cur_ruÆ’
)++;

1833 *
cur_pow
 = 
c
->
ic_max»gpow”
;

1834 *
cur_chª
 = 
c
->
ic_›“
;

1835 
´evchª
 = 
c
->
ic_›“
;

1836 
ic
->
ic_couÁry_›
.
couÁry_Ën
 += 3;

1837 } ià(*
cur_pow
 =ğ
c
->
ic_max»gpow”
 &&

1838 
c
->
ic_›“
 =ğ
´evchª
 +

1839 (
	`IEEE80211_IS_CHAN_5GHZ
(
c
) ? 4 : 1)) {

1840 (*
cur_ruÆ’
)++;

1841 
´evchª
 = 
c
->
ic_›“
;

1843 
cur_ruÆ’
 +=3;

1844 
cur_chª
 += 3;

1845 
cur_pow
 += 3;

1846 (*
cur_ruÆ’
)++;

1847 *
cur_pow
 = 
c
->
ic_max»gpow”
;

1848 *
cur_chª
 = 
c
->
ic_›“
;

1849 
´evchª
 = 
c
->
ic_›“
;

1850 
ic
->
ic_couÁry_›
.
couÁry_Ën
 += 3;

1856 ià(
ic
->
ic_couÁry_›
.
couÁry_Ën
 & 1)

1857 
ic
->
ic_couÁry_›
.
couÁry_Ën
++;

1858 
	}
}

1861 
	$›“80211_bud_sc_›
(
›“80211com
 *
ic
)

1863 
›“80211_›_sc
 *
›
 = &
ic
->
ic_sc_›
;

1864 
i
, 
j
;

1865 
›“80211_chªÃl
 *
c
;

1866 
u_št8_t
 
´evchª
;

1869 
	`mem£t
(
›
, 0, (*ie));

1870 
›
->
sc_id
 = 
IEEE80211_ELEMID_SUPPCHAN
;

1872 
´evchª
 = 0;

1874 
j
 = 0;

1875 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1876 
c
 = &
ic
->
ic_chªÃls
[
i
];

1879 ià(
	`isşr
(
ic
->
ic_chª_aùive
, 
c
->
ic_›“
))

1883 ià(
	`IEEE80211_IS_CHAN_TURBO
(
c
))

1887 ià(
	`IEEE80211_IS_CHAN_HALF
(
c
) ||

1888 
	`IEEE80211_IS_CHAN_QUARTER
(
c
))

1892 ià(
c
->
ic_›“
 =ğ
´evchª
)

1895 ià(
›
->
sc_subbªd
[
j
].
sc_numb”
 == 0) {

1896 
›
->
sc_subbªd
[
j
].
sc_fœ¡
 = 
c
->
ic_›“
;

1897 } ià(
c
->
ic_›“
 !ğ
´evchª
 +

1900 (
	`IEEE80211_IS_CHAN_5GHZ
(
c
) ? 4 : 1)) {

1901 
j
++;

1902 
›
->
sc_subbªd
[
j
].
sc_fœ¡
 = 
c
->
ic_›“
;

1904 
›
->
sc_subbªd
[
j
].
sc_numb”
++;

1905 
´evchª
 = 
c
->
ic_›“
;

1907 
›
->
sc_Ën
 = (
j
+1) * 2;

1908 
	}
}

1910 
	g©h_debug_glob®
 = 0;

1911 
EXPORT_SYMBOL
(
©h_debug_glob®
);

	@ieee80211.h

34 #iâdeà
_NET80211_IEEE80211_H_


35 
	#_NET80211_IEEE80211_H_


	)

41 
	#IEEE80211_ADDR_LEN
 6

	)

43 
	#IEEE80211_IS_MULTICAST
(
_a
è(*(_aè& 0x01)

	)

46 
	s›“80211_¶ı_hdr
 {

47 
u_št16_t
 
	mi_sfd
;

48 
u_št8_t
 
	mi_sigÇl
;

49 
u_št8_t
 
	mi_£rviû
;

50 
u_št16_t
 
	mi_Ëngth
;

51 
u_št16_t
 
	mi_üc
;

52 } 
	g__·cked
;

54 
	#IEEE80211_PLCP_SFD
 0xF3A0

	)

55 
	#IEEE80211_PLCP_SERVICE
 0x00

	)

60 
	s›“80211_äame
 {

61 
u_št8_t
 
	mi_fc
[2];

62 
__Ë16
 
	mi_dur
;

63 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

64 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

65 
u_št8_t
 
	mi_addr3
[
IEEE80211_ADDR_LEN
];

66 
u_št8_t
 
	mi_£q
[2];

69 } 
	g__·cked
;

71 
	s›“80211_qosäame
 {

72 
u_št8_t
 
	mi_fc
[2];

73 
__Ë16
 
	mi_dur
;

74 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

75 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

76 
u_št8_t
 
	mi_addr3
[
IEEE80211_ADDR_LEN
];

77 
u_št8_t
 
	mi_£q
[2];

78 
u_št8_t
 
	mi_qos
[2];

81 } 
	g__·cked
;

83 
	s›“80211_qosú
 {

84 
u_št8_t
 
	mi_qos
[2];

87 
	s›“80211_äame_addr4
 {

88 
u_št8_t
 
	mi_fc
[2];

89 
__Ë16
 
	mi_dur
;

90 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

91 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

92 
u_št8_t
 
	mi_addr3
[
IEEE80211_ADDR_LEN
];

93 
u_št8_t
 
	mi_£q
[2];

94 
u_št8_t
 
	mi_addr4
[
IEEE80211_ADDR_LEN
];

95 } 
	g__·cked
;

98 
	s›“80211_qosäame_addr4
 {

99 
u_št8_t
 
	mi_fc
[2];

100 
__Ë16
 
	mi_dur
;

101 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

102 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

103 
u_št8_t
 
	mi_addr3
[
IEEE80211_ADDR_LEN
];

104 
u_št8_t
 
	mi_£q
[2];

105 
u_št8_t
 
	mi_addr4
[
IEEE80211_ADDR_LEN
];

106 
u_št8_t
 
	mi_qos
[2];

107 } 
	g__·cked
;

109 
	s›“80211_ùläame_addr2
 {

110 
u_št8_t
 
	mi_fc
[2];

111 
__Ë16
 
	mi_aidÜdur
;

112 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

113 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

114 } 
	g__·cked
;

116 
	#IEEE80211_FC0_VERSION_MASK
 0x03

	)

117 
	#IEEE80211_FC0_VERSION_SHIFT
 0

	)

118 
	#IEEE80211_FC0_VERSION_0
 0x00

	)

119 
	#IEEE80211_FC0_TYPE_MASK
 0x0c

	)

120 
	#IEEE80211_FC0_TYPE_SHIFT
 2

	)

121 
	#IEEE80211_FC0_TYPE_MGT
 0x00

	)

122 
	#IEEE80211_FC0_TYPE_CTL
 0x04

	)

123 
	#IEEE80211_FC0_TYPE_DATA
 0x08

	)

125 
	#IEEE80211_FC0_SUBTYPE_MASK
 0xf0

	)

126 
	#IEEE80211_FC0_SUBTYPE_SHIFT
 4

	)

128 
	#IEEE80211_FC0_SUBTYPE_ASSOC_REQ
 0x00

	)

129 
	#IEEE80211_FC0_SUBTYPE_ASSOC_RESP
 0x10

	)

130 
	#IEEE80211_FC0_SUBTYPE_REASSOC_REQ
 0x20

	)

131 
	#IEEE80211_FC0_SUBTYPE_REASSOC_RESP
 0x30

	)

132 
	#IEEE80211_FC0_SUBTYPE_PROBE_REQ
 0x40

	)

133 
	#IEEE80211_FC0_SUBTYPE_PROBE_RESP
 0x50

	)

134 
	#IEEE80211_FC0_SUBTYPE_BEACON
 0x80

	)

135 
	#IEEE80211_FC0_SUBTYPE_ATIM
 0x90

	)

136 
	#IEEE80211_FC0_SUBTYPE_DISASSOC
 0xa0

	)

137 
	#IEEE80211_FC0_SUBTYPE_AUTH
 0xb0

	)

138 
	#IEEE80211_FC0_SUBTYPE_DEAUTH
 0xc0

	)

139 
	#IEEE80211_FC0_SUBTYPE_ACTION
 0xd0

	)

141 
	#IEEE80211_FC0_SUBTYPE_PS_POLL
 0xa0

	)

142 
	#IEEE80211_FC0_SUBTYPE_RTS
 0xb0

	)

143 
	#IEEE80211_FC0_SUBTYPE_CTS
 0xc0

	)

144 
	#IEEE80211_FC0_SUBTYPE_ACK
 0xd0

	)

145 
	#IEEE80211_FC0_SUBTYPE_CF_END
 0xe0

	)

146 
	#IEEE80211_FC0_SUBTYPE_CF_END_ACK
 0xf0

	)

148 
	#IEEE80211_FC0_SUBTYPE_DATA
 0x00

	)

149 
	#IEEE80211_FC0_SUBTYPE_CF_ACK
 0x10

	)

150 
	#IEEE80211_FC0_SUBTYPE_CF_POLL
 0x20

	)

151 
	#IEEE80211_FC0_SUBTYPE_CF_ACPL
 0x30

	)

152 
	#IEEE80211_FC0_SUBTYPE_NULL
 0x40

	)

153 
	#IEEE80211_FC0_SUBTYPE_CFACK
 0x50

	)

154 
	#IEEE80211_FC0_SUBTYPE_CFPOLL
 0x60

	)

155 
	#IEEE80211_FC0_SUBTYPE_CF_ACK_CF_ACK
 0x70

	)

156 
	#IEEE80211_FC0_SUBTYPE_QOS
 0x80

	)

157 
	#IEEE80211_FC0_SUBTYPE_QOS_NULL
 0xc0

	)

159 
	#IEEE80211_FC1_DIR_MASK
 0x03

	)

160 
	#IEEE80211_FC1_DIR_NODS
 0x00

	)

161 
	#IEEE80211_FC1_DIR_TODS
 0x01

	)

162 
	#IEEE80211_FC1_DIR_FROMDS
 0x02

	)

163 
	#IEEE80211_FC1_DIR_DSTODS
 0x03

	)

165 
	#IEEE80211_FC1_MORE_FRAG
 0x04

	)

166 
	#IEEE80211_FC1_RETRY
 0x08

	)

167 
	#IEEE80211_FC1_PWR_MGT
 0x10

	)

168 
	#IEEE80211_FC1_MORE_DATA
 0x20

	)

169 
	#IEEE80211_FC1_PROT
 0x40

	)

170 
	#IEEE80211_FC1_ORDER
 0x80

	)

172 
	#IEEE80211_SEQ_FRAG_MASK
 0x000f

	)

173 
	#IEEE80211_SEQ_FRAG_SHIFT
 0

	)

174 
	#IEEE80211_SEQ_SEQ_MASK
 0xfff0

	)

175 
	#IEEE80211_SEQ_SEQ_SHIFT
 4

	)

177 
	#IEEE80211_SEQ_LEQ
(
a
,
b
è(()(×)-(b)è<ğ0)

	)

179 
	#IEEE80211_NWID_LEN
 32

	)

181 
	#IEEE80211_QOS_TXOP
 0x00ff

	)

183 
	#IEEE80211_QOS_ACKPOLICY
 0x60

	)

184 
	#IEEE80211_QOS_ACKPOLICY_S
 5

	)

185 
	#IEEE80211_QOS_EOSP
 0x10

	)

186 
	#IEEE80211_QOS_EOSP_S
 4

	)

187 
	#IEEE80211_QOS_TID
 0x0f

	)

189 
	#IEEE80211_FRM_HAS_BODY
(
_wh
) \

190 (((
_wh
)->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
) != \

191 
IEEE80211_FC0_TYPE_CTL
)

	)

198 
	eCouÁryCode
 {

199 
	mCTRY_ALBANIA
 = 8,

200 
	mCTRY_ALGERIA
 = 12,

201 
	mCTRY_ARGENTINA
 = 32,

202 
	mCTRY_ARMENIA
 = 51,

203 
	mCTRY_AUSTRALIA
 = 36,

204 
	mCTRY_AUSTRIA
 = 40,

205 
	mCTRY_AZERBAIJAN
 = 31,

206 
	mCTRY_BAHRAIN
 = 48,

207 
	mCTRY_BELARUS
 = 112,

208 
	mCTRY_BELGIUM
 = 56,

209 
	mCTRY_BELIZE
 = 84,

210 
	mCTRY_BOLIVIA
 = 68,

211 
	mCTRY_BRAZIL
 = 76,

212 
	mCTRY_BRUNEI_DARUSSALAM
 = 96,

213 
	mCTRY_BULGARIA
 = 100,

214 
	mCTRY_CANADA
 = 124,

215 
	mCTRY_CHILE
 = 152,

216 
	mCTRY_CHINA
 = 156,

217 
	mCTRY_COLOMBIA
 = 170,

218 
	mCTRY_COSTA_RICA
 = 188,

219 
	mCTRY_CROATIA
 = 191,

220 
	mCTRY_CYPRUS
 = 196,

221 
	mCTRY_CZECH
 = 203,

222 
	mCTRY_DENMARK
 = 208,

223 
	mCTRY_DOMINICAN_REPUBLIC
 = 214,

224 
	mCTRY_ECUADOR
 = 218,

225 
	mCTRY_EGYPT
 = 818,

226 
	mCTRY_EL_SALVADOR
 = 222,

227 
	mCTRY_ESTONIA
 = 233,

228 
	mCTRY_FAEROE_ISLANDS
 = 234,

229 
	mCTRY_FINLAND
 = 246,

230 
	mCTRY_FRANCE
 = 250,

231 
	mCTRY_FRANCE2
 = 255,

232 
	mCTRY_GEORGIA
 = 268,

233 
	mCTRY_GERMANY
 = 276,

234 
	mCTRY_GREECE
 = 300,

235 
	mCTRY_GUATEMALA
 = 320,

236 
	mCTRY_HONDURAS
 = 340,

237 
	mCTRY_HONG_KONG
 = 344,

238 
	mCTRY_HUNGARY
 = 348,

239 
	mCTRY_ICELAND
 = 352,

240 
	mCTRY_INDIA
 = 356,

241 
	mCTRY_INDONESIA
 = 360,

242 
	mCTRY_IRAN
 = 364,

243 
	mCTRY_IRAQ
 = 368,

244 
	mCTRY_IRELAND
 = 372,

245 
	mCTRY_ISRAEL
 = 376,

246 
	mCTRY_ITALY
 = 380,

247 
	mCTRY_JAMAICA
 = 388,

248 
	mCTRY_JAPAN
 = 392,

249 
	mCTRY_JAPAN1
 = 393,

250 
	mCTRY_JAPAN2
 = 394,

251 
	mCTRY_JAPAN3
 = 395,

252 
	mCTRY_JAPAN4
 = 396,

253 
	mCTRY_JAPAN5
 = 397,

254 
	mCTRY_JAPAN6
 = 399,

255 
	mCTRY_JAPAN7
 = 900,

256 
	mCTRY_JAPAN8
 = 901,

257 
	mCTRY_JAPAN9
 = 902,

258 
	mCTRY_JAPAN10
 = 903,

259 
	mCTRY_JAPAN11
 = 904,

260 
	mCTRY_JAPAN12
 = 905,

261 
	mCTRY_JAPAN13
 = 906,

262 
	mCTRY_JAPAN14
 = 907,

263 
	mCTRY_JAPAN15
 = 908,

264 
	mCTRY_JAPAN16
 = 909,

265 
	mCTRY_JAPAN17
 = 910,

266 
	mCTRY_JAPAN18
 = 911,

267 
	mCTRY_JAPAN19
 = 912,

268 
	mCTRY_JAPAN20
 = 913,

269 
	mCTRY_JAPAN21
 = 914,

270 
	mCTRY_JAPAN22
 = 915,

271 
	mCTRY_JAPAN23
 = 916,

272 
	mCTRY_JAPAN24
 = 917,

273 
	mCTRY_JAPAN25
 = 918,

274 
	mCTRY_JAPAN26
 = 919,

275 
	mCTRY_JAPAN27
 = 920,

276 
	mCTRY_JAPAN28
 = 921,

277 
	mCTRY_JAPAN29
 = 922,

278 
	mCTRY_JAPAN30
 = 923,

279 
	mCTRY_JAPAN31
 = 924,

280 
	mCTRY_JAPAN32
 = 925,

281 
	mCTRY_JAPAN33
 = 926,

282 
	mCTRY_JAPAN34
 = 927,

283 
	mCTRY_JAPAN35
 = 928,

284 
	mCTRY_JAPAN36
 = 929,

285 
	mCTRY_JAPAN37
 = 930,

286 
	mCTRY_JAPAN38
 = 931,

287 
	mCTRY_JAPAN39
 = 932,

288 
	mCTRY_JAPAN40
 = 933,

289 
	mCTRY_JAPAN41
 = 934,

290 
	mCTRY_JAPAN42
 = 935,

291 
	mCTRY_JAPAN43
 = 936,

292 
	mCTRY_JAPAN44
 = 937,

293 
	mCTRY_JAPAN45
 = 938,

294 
	mCTRY_JAPAN46
 = 939,

295 
	mCTRY_JAPAN47
 = 940,

296 
	mCTRY_JAPAN48
 = 941,

297 
	mCTRY_JORDAN
 = 400,

298 
	mCTRY_KAZAKHSTAN
 = 398,

299 
	mCTRY_KENYA
 = 404,

300 
	mCTRY_KOREA_NORTH
 = 408,

301 
	mCTRY_KOREA_ROC
 = 410,

302 
	mCTRY_KOREA_ROC2
 = 411,

303 
	mCTRY_KUWAIT
 = 414,

304 
	mCTRY_LATVIA
 = 428,

305 
	mCTRY_LEBANON
 = 422,

306 
	mCTRY_LIBYA
 = 434,

307 
	mCTRY_LIECHTENSTEIN
 = 438,

308 
	mCTRY_LITHUANIA
 = 440,

309 
	mCTRY_LUXEMBOURG
 = 442,

310 
	mCTRY_MACAU
 = 446,

311 
	mCTRY_MACEDONIA
 = 807,

312 
	mCTRY_MALAYSIA
 = 458,

313 
	mCTRY_MEXICO
 = 484,

314 
	mCTRY_MONACO
 = 492,

315 
	mCTRY_MOROCCO
 = 504,

316 
	mCTRY_NETHERLANDS
 = 528,

317 
	mCTRY_NEW_ZEALAND
 = 554,

318 
	mCTRY_NICARAGUA
 = 558,

319 
	mCTRY_NORWAY
 = 578,

320 
	mCTRY_OMAN
 = 512,

321 
	mCTRY_PAKISTAN
 = 586,

322 
	mCTRY_PANAMA
 = 591,

323 
	mCTRY_PARAGUAY
 = 600,

324 
	mCTRY_PERU
 = 604,

325 
	mCTRY_PHILIPPINES
 = 608,

326 
	mCTRY_POLAND
 = 616,

327 
	mCTRY_PORTUGAL
 = 620,

328 
	mCTRY_PUERTO_RICO
 = 630,

329 
	mCTRY_QATAR
 = 634,

330 
	mCTRY_ROMANIA
 = 642,

331 
	mCTRY_RUSSIA
 = 643,

332 
	mCTRY_SAUDI_ARABIA
 = 682,

333 
	mCTRY_SINGAPORE
 = 702,

334 
	mCTRY_SLOVAKIA
 = 703,

335 
	mCTRY_SLOVENIA
 = 705,

336 
	mCTRY_SOUTH_AFRICA
 = 710,

337 
	mCTRY_SPAIN
 = 724,

338 
	mCTRY_SWEDEN
 = 752,

339 
	mCTRY_SWITZERLAND
 = 756,

340 
	mCTRY_SYRIA
 = 760,

341 
	mCTRY_TAIWAN
 = 158,

342 
	mCTRY_THAILAND
 = 764,

343 
	mCTRY_TRINIDAD_Y_TOBAGO
 = 780,

344 
	mCTRY_TUNISIA
 = 788,

345 
	mCTRY_TURKEY
 = 792,

346 
	mCTRY_UAE
 = 784,

347 
	mCTRY_UKRAINE
 = 804,

348 
	mCTRY_UNITED_KINGDOM
 = 826,

349 
	mCTRY_UNITED_STATES
 = 840,

350 
	mCTRY_UNITED_STATES_FCC49
 = 842,

351 
	mCTRY_URUGUAY
 = 858,

352 
	mCTRY_UZBEKISTAN
 = 860,

353 
	mCTRY_VENEZUELA
 = 862,

354 
	mCTRY_VIET_NAM
 = 704,

355 
	mCTRY_YEMEN
 = 887,

356 
	mCTRY_ZIMBABWE
 = 716

362 
	s›“80211_›
 {

363 
u_št8_t
 
	mid
;

364 
u_št8_t
 
	mËn
;

365 
u_št8_t
 
	mšfo
[0];

366 } 
	g__·cked
;

371 
	#IEEE80211_COUNTRY_MAX_TRIPLETS
 (83)

	)

372 
	s›“80211_›_couÁry
 {

373 
u_št8_t
 
	mcouÁry_id
;

374 
u_št8_t
 
	mcouÁry_Ën
;

375 
u_št8_t
 
	mcouÁry_¡r
[3];

376 
u_št8_t
 
	mcouÁry_ŒËt
[
IEEE80211_COUNTRY_MAX_TRIPLETS
 * 3];

377 } 
	g__·cked
;

382 
	s›“80211_›_pwrú¡r
 {

383 
u_št8_t
 
	mpc_id
;

384 
u_št8_t
 
	mpc_Ën
;

385 
u_št8_t
 
	mpc_Íc
;

386 } 
	g__·cked
;

391 
	s›“80211_›_pwrÿp
 {

392 
u_št8_t
 
	mpc_id
;

393 
u_št8_t
 
	mpc_Ën
;

394 
št8_t
 
	mpc_mštxpow
;

395 
št8_t
 
	mpc_maxtxpow
;

396 } 
	g__·cked
;

401 
	#IEEE80211_SUPPCHAN_MAX_PAIRS
 (127)

	)

402 
	s›“80211_›_sc
 {

403 
u_št8_t
 
	msc_id
;

404 
u_št8_t
 
	msc_Ën
;

406 
u_št8_t
 
	msc_fœ¡
;

407 
u_št8_t
 
	msc_numb”
;

408 } 
__·cked
 
	msc_subbªd
[
IEEE80211_SUPPCHAN_MAX_PAIRS
];

409 } 
	g__·cked
;

414 
	s›“80211_›_c§
 {

415 
u_št8_t
 
	mc§_id
;

416 
u_št8_t
 
	mc§_Ën
;

417 
u_št8_t
 
	mc§_mode
;

418 
u_št8_t
 
	mc§_chª
;

419 
u_št8_t
 
	mc§_couÁ
;

420 } 
	g__·cked
;

423 
	#IEEE80211_CSA_PROTECTION_PERIOD
 3

	)

426 
	#IEEE80211_CSA_SANITY_THRESHOLD
 100

	)

430 
	#IEEE80211_QOS_HAS_SEQ
(
wh
) \

431 (((
wh
)->
i_fc
[0] & \

432 (
IEEE80211_FC0_TYPE_MASK
 | 
IEEE80211_FC0_SUBTYPE_QOS
)) == \

433 (
IEEE80211_FC0_TYPE_DATA
 | 
IEEE80211_FC0_SUBTYPE_QOS
))

	)

435 
	#WME_QOSINFO_COUNT
 0x0à

	)

439 
	s›“80211_›_wme
 {

440 
u_št8_t
 
	mwme_id
;

441 
u_št8_t
 
	mwme_Ën
;

442 
u_št8_t
 
	mwme_oui
[3];

443 
u_št8_t
 
	mwme_ty³
;

444 
u_št8_t
 
	mwme_subty³
;

445 
u_št8_t
 
	mwme_v”siÚ
;

446 
u_št8_t
 
	mwme_šfo
;

447 } 
	g__·cked
;

452 
	s›“80211_wme_t¥ec
 {

453 
u_št8_t
 
	mts_id
;

454 
u_št8_t
 
	mts_Ën
;

455 
u_št8_t
 
	mts_oui
[3];

456 
u_št8_t
 
	mts_oui_ty³
;

457 
u_št8_t
 
	mts_oui_subty³
;

458 
u_št8_t
 
	mts_v”siÚ
;

459 
u_št8_t
 
	mts_tsšfo
[3];

460 
u_št8_t
 
	mts_nom_msdu
[2];

461 
u_št8_t
 
	mts_max_msdu
[2];

462 
u_št8_t
 
	mts_mš_svc
[4];

463 
u_št8_t
 
	mts_max_svc
[4];

464 
u_št8_t
 
	mts_šaùv_štv
[4];

465 
u_št8_t
 
	mts_su¥_štv
[4];

466 
u_št8_t
 
	mts_¡¬t_svc
[4];

467 
u_št8_t
 
	mts_mš_¿‹
[4];

468 
u_št8_t
 
	mts_m—n_¿‹
[4];

469 
u_št8_t
 
	mts_max_bur¡
[4];

470 
u_št8_t
 
	mts_mš_phy
[4];

471 
u_št8_t
 
	mts_³ak_¿‹
[4];

472 
u_št8_t
 
	mts_d–ay
[4];

473 
u_št8_t
 
	mts_su½lus
[2];

474 
u_št8_t
 
	mts_medium_time
[2];

475 } 
	g__·cked
;

481 
	s›“80211_wme_aı¬ams
 {

482 
u_št8_t
 
	maı_aci_aif¢
;

483 
u_št8_t
 
	maı_logcwmšmax
;

484 
u_št16_t
 
	maı_txİ
;

485 } 
	g__·cked
;

487 
	#IEEE80211_WME_PARAM_LEN
 24

	)

488 
	#WME_NUM_AC
 4

	)

490 
	#WME_PARAM_ACI
 0x60

	)

491 
	#WME_PARAM_ACI_S
 5

	)

492 
	#WME_PARAM_ACM
 0x10

	)

493 
	#WME_PARAM_ACM_S
 4

	)

494 
	#WME_PARAM_AIFSN
 0x0à

	)

495 
	#WME_PARAM_AIFSN_S
 0

	)

496 
	#WME_PARAM_LOGCWMIN
 0x0à

	)

497 
	#WME_PARAM_LOGCWMIN_S
 0

	)

498 
	#WME_PARAM_LOGCWMAX
 0xf0

	)

499 
	#WME_PARAM_LOGCWMAX_S
 4

	)

501 
	#WME_AC_TO_TID
(
_ac
) ( \

502 ((
_ac
è=ğ
WME_AC_VO
) ? 6 : \

503 ((
_ac
è=ğ
WME_AC_VI
) ? 5 : \

504 ((
_ac
è=ğ
WME_AC_BK
) ? 1 : \

505 0)

	)

507 
	#TID_TO_WME_AC
(
_tid
) ( \

508 ((
_tid
è< 1è? 
WME_AC_BE
 : \

509 ((
_tid
è< 3è? 
WME_AC_BK
 : \

510 ((
_tid
è< 6è? 
WME_AC_VI
 : \

511 
WME_AC_VO
)

	)

517 
	s›“80211_wme_·¿m
 {

518 
u_št8_t
 
	m·¿m_id
;

519 
u_št8_t
 
	m·¿m_Ën
;

520 
u_št8_t
 
	m·¿m_oui
[3];

521 
u_št8_t
 
	m·¿m_oui_ty³
;

522 
u_št8_t
 
	m·¿m_oui_sybty³
;

523 
u_št8_t
 
	m·¿m_v”siÚ
;

524 
u_št8_t
 
	m·¿m_qosInfo
;

525 
u_št8_t
 
	m·¿m_»£rved
;

526 
›“80211_wme_aı¬ams
 
	m·¿ms_acP¬ams
[
WME_NUM_AC
];

527 } 
	g__·cked
;

532 
	#WME_CAPINFO_UAPSD_EN
 0x00000080

	)

533 
	#WME_CAPINFO_UAPSD_VO
 0x00000001

	)

534 
	#WME_CAPINFO_UAPSD_VI
 0x00000002

	)

535 
	#WME_CAPINFO_UAPSD_BK
 0x00000004

	)

536 
	#WME_CAPINFO_UAPSD_BE
 0x00000008

	)

537 
	#WME_CAPINFO_UAPSD_ACFLAGS_SHIFT
 0

	)

538 
	#WME_CAPINFO_UAPSD_ACFLAGS_MASK
 0xF

	)

539 
	#WME_CAPINFO_UAPSD_MAXSP_SHIFT
 5

	)

540 
	#WME_CAPINFO_UAPSD_MAXSP_MASK
 0x3

	)

541 
	#WME_CAPINFO_IE_OFFSET
 8

	)

542 
	#WME_UAPSD_MAXSP
(
_qosšfo
) \

543 (((
_qosšfo
è>> 
WME_CAPINFO_UAPSD_MAXSP_SHIFT
) & \

544 
WME_CAPINFO_UAPSD_MAXSP_MASK
)

	)

545 
	#WME_UAPSD_AC_ENABLED
(
_ac
, 
_qosšfo
) \

546 ((1 << (3 - (
_ac
))) & ( \

547 ((
_qosšfo
è>> 
WME_CAPINFO_UAPSD_ACFLAGS_SHIFT
) & \

548 
WME_CAPINFO_UAPSD_ACFLAGS_MASK
))

	)

553 
	s›“80211_›_©hAdvC­
 {

554 
u_št8_t
 
	m©hAdvC­_id
;

555 
u_št8_t
 
	m©hAdvC­_Ën
;

556 
u_št8_t
 
	m©hAdvC­_oui
[3];

557 
u_št8_t
 
	m©hAdvC­_ty³
;

558 
u_št8_t
 
	m©hAdvC­_subty³
;

559 
u_št8_t
 
	m©hAdvC­_v”siÚ
;

560 
u_št8_t
 
	m©hAdvC­_ÿ·b™y
;

561 
u_št16_t
 
	m©hAdvC­_defKeyIndex
;

562 } 
	g__·cked
;

567 
	s›“80211_xr_·¿m
 {

568 
u_št8_t
 
	m·¿m_id
;

569 
u_št8_t
 
	m·¿m_Ën
;

570 
u_št8_t
 
	m·¿m_oui
[3];

571 
u_št8_t
 
	m·¿m_oui_ty³
;

572 
u_št8_t
 
	m·¿m_oui_sybty³
;

573 
u_št8_t
 
	m·¿m_v”siÚ
;

574 
u_št8_t
 
	m·¿m_Info
;

575 
u_št8_t
 
	m·¿m_ba£_bssid
[
IEEE80211_ADDR_LEN
];

576 
u_št8_t
 
	m·¿m_xr_bssid
[
IEEE80211_ADDR_LEN
];

577 
u_št16_t
 
	m·¿m_xr_b—cÚ_š‹rv®
;

578 
u_št8_t
 
	m·¿m_ba£_©h_ÿ·b™y
;

579 
u_št8_t
 
	m·¿m_xr_©h_ÿ·b™y
;

580 } 
	g__·cked
;

583 
	#IEEE80211_ATHC_TURBOP
 0x0001

	)

584 
	#IEEE80211_ATHC_COMP
 0x0002

	)

585 
	#IEEE80211_ATHC_FF
 0x0004

	)

586 
	#IEEE80211_ATHC_XR
 0x0008

	)

587 
	#IEEE80211_ATHC_AR
 0x0010

	)

588 
	#IEEE80211_ATHC_BURST
 0x0020

	)

589 
	#IEEE80211_ATHC_WME
 0x0040

	)

590 
	#IEEE80211_ATHC_BOOST
 0x0080

	)

595 
	s›“80211_mnf
 {

596 
u_št8_t
 
	mmnf_ÿ‹gÜy
;

597 
u_št8_t
 
	mmnf_aùiÚ
;

598 
u_št8_t
 
	mmnf_dŸlog
;

599 
u_št8_t
 
	mmnf_¡©us
;

600 } 
	g__·cked
;

601 
	#MNF_SETUP_REQ
 0

	)

602 
	#MNF_SETUP_RESP
 1

	)

603 
	#MNF_TEARDOWN
 2

	)

608 
	s›“80211_äame_mš
 {

609 
u_št8_t
 
	mi_fc
[2];

610 
__Ë16
 
	mi_dur
;

611 
u_št8_t
 
	mi_addr1
[
IEEE80211_ADDR_LEN
];

612 
u_št8_t
 
	mi_addr2
[
IEEE80211_ADDR_LEN
];

614 } 
	g__·cked
;

616 
	s›“80211_äame_¹s
 {

617 
u_št8_t
 
	mi_fc
[2];

618 
__Ë16
 
	mi_dur
;

619 
u_št8_t
 
	mi_¿
[
IEEE80211_ADDR_LEN
];

620 
u_št8_t
 
	mi_
[
IEEE80211_ADDR_LEN
];

622 } 
	g__·cked
;

624 
	s›“80211_äame_ùs
 {

625 
u_št8_t
 
	mi_fc
[2];

626 
__Ë16
 
	mi_dur
;

627 
u_št8_t
 
	mi_¿
[
IEEE80211_ADDR_LEN
];

629 } 
	g__·cked
;

631 
	s›“80211_äame_ack
 {

632 
u_št8_t
 
	mi_fc
[2];

633 
__Ë16
 
	mi_dur
;

634 
u_št8_t
 
	mi_¿
[
IEEE80211_ADDR_LEN
];

636 } 
	g__·cked
;

638 
	s›“80211_äame_p¥Şl
 {

639 
u_št8_t
 
	mi_fc
[2];

640 
u_št8_t
 
	mi_aid
[2];

641 
u_št8_t
 
	mi_bssid
[
IEEE80211_ADDR_LEN
];

642 
u_št8_t
 
	mi_
[
IEEE80211_ADDR_LEN
];

644 } 
	g__·cked
;

646 
	s›“80211_äame_cãnd
 {

647 
u_št8_t
 
	mi_fc
[2];

648 
__Ë16
 
	mi_dur
;

649 
u_št8_t
 
	mi_¿
[
IEEE80211_ADDR_LEN
];

650 
u_št8_t
 
	mi_bssid
[
IEEE80211_ADDR_LEN
];

652 } 
	g__·cked
;

666 
u_št8_t
 *
	t›“80211_mgt_b—cÚ_t
;

668 
	#IEEE80211_BEACON_INTERVAL
(
b—cÚ
) \

669 ((
b—cÚ
)[8] | ((b—cÚ)[9] << 8))

	)

670 
	#IEEE80211_BEACON_CAPABILITY
(
b—cÚ
) \

671 ((
b—cÚ
)[10] | ((b—cÚ)[11] << 8))

	)

673 
	#IEEE80211_CAPINFO_ESS
 0x0001

	)

674 
	#IEEE80211_CAPINFO_IBSS
 0x0002

	)

675 
	#IEEE80211_CAPINFO_CF_POLLABLE
 0x0004

	)

676 
	#IEEE80211_CAPINFO_CF_POLLREQ
 0x0008

	)

677 
	#IEEE80211_CAPINFO_PRIVACY
 0x0010

	)

678 
	#IEEE80211_CAPINFO_SHORT_PREAMBLE
 0x0020

	)

679 
	#IEEE80211_CAPINFO_PBCC
 0x0040

	)

680 
	#IEEE80211_CAPINFO_CHNL_AGILITY
 0x0080

	)

682 
	#IEEE80211_CAPINFO_SPECTRUM_MGMT
 0x0100

	)

683 
	#IEEE80211_CAPINFO_SHORT_SLOTTIME
 0x0400

	)

684 
	#IEEE80211_CAPINFO_RSN
 0x0800

	)

686 
	#IEEE80211_CAPINFO_DSSSOFDM
 0x2000

	)

692 
	s›“80211_›_w·
 {

693 
u_št8_t
 
	mw·_id
;

694 
u_št8_t
 
	mw·_Ën
;

695 
u_št8_t
 
	mw·_oui
[3];

696 
u_št8_t
 
	mw·_ty³
;

697 
u_št16_t
 
	mw·_v”siÚ
;

698 
u_št32_t
 
	mw·_mch”
[1];

699 
u_št16_t
 
	mw·_uch”út
;

700 
u_št32_t
 
	mw·_uch”s
[8];

701 
u_št16_t
 
	mw·_auth£lút
;

702 
u_št32_t
 
	mw·_auth£ls
[8];

703 
u_št16_t
 
	mw·_ÿps
;

704 
u_št16_t
 
	mw·_pmkidút
;

705 
u_št16_t
 
	mw·_pmkids
[8];

706 } 
	g__·cked
;

713 
	mIEEE80211_ELEMID_SSID
 = 0,

714 
	mIEEE80211_ELEMID_RATES
 = 1,

715 
	mIEEE80211_ELEMID_FHPARMS
 = 2,

716 
	mIEEE80211_ELEMID_DSPARMS
 = 3,

717 
	mIEEE80211_ELEMID_CFPARMS
 = 4,

718 
	mIEEE80211_ELEMID_TIM
 = 5,

719 
	mIEEE80211_ELEMID_IBSSPARMS
 = 6,

720 
	mIEEE80211_ELEMID_COUNTRY
 = 7,

721 
	mIEEE80211_ELEMID_HOPPATRNPARMS
 = 8,

722 
	mIEEE80211_ELEMID_HOPPATRNTABLE
 = 9,

723 
	mIEEE80211_ELEMID_REQINFO
 = 10,

724 
	mIEEE80211_ELEMID_QBSSLOAD
 = 11,

725 
	mIEEE80211_ELEMID_EDCAPARAM
 = 12,

726 
	mIEEE80211_ELEMID_TSPEC
 = 13,

727 
	mIEEE80211_ELEMID_TRAFCLASS
 = 14,

728 
	mIEEE80211_ELEMID_SCHEDULE
 = 15,

729 
	mIEEE80211_ELEMID_CHALLENGE
 = 16,

731 
	mIEEE80211_ELEMID_PWRCNSTR
 = 32,

732 
	mIEEE80211_ELEMID_PWRCAP
 = 33,

733 
	mIEEE80211_ELEMID_TPCREQ
 = 34,

734 
	mIEEE80211_ELEMID_TPCREP
 = 35,

735 
	mIEEE80211_ELEMID_SUPPCHAN
 = 36,

736 
	mIEEE80211_ELEMID_CHANSWITCHANN
 = 37,

737 
	mIEEE80211_ELEMID_MEASREQ
 = 38,

738 
	mIEEE80211_ELEMID_MEASREP
 = 39,

739 
	mIEEE80211_ELEMID_QUIET
 = 40,

740 
	mIEEE80211_ELEMID_IBSSDFS
 = 41,

741 
	mIEEE80211_ELEMID_ERP
 = 42,

742 
	mIEEE80211_ELEMID_TSDELAY
 = 43,

743 
	mIEEE80211_ELEMID_TCLASSPROC
 = 44,

744 
	mIEEE80211_ELEMID_QOS
 = 46,

745 
	mIEEE80211_ELEMID_RSN
 = 48,

747 
	mIEEE80211_ELEMID_XRATES
 = 50,

749 
	mIEEE80211_ELEMID_AGERE1
 = 128,

750 
	mIEEE80211_ELEMID_AGERE2
 = 129,

751 
	mIEEE80211_ELEMID_TPC
 = 150,

752 
	mIEEE80211_ELEMID_CCKM
 = 156,

753 
	mIEEE80211_ELEMID_VENDOR
 = 221,

756 
	#IEEE80211_CHANSWITCHANN_BYTES
 5

	)

757 
	#BITCTL_BUFD_MCAST
 1

	)

758 
	#BITCTL_BUFD_UCAST_AID_MASK
 ((
u_št8_t
)~(
BITCTL_BUFD_MCAST
))

	)

759 
	#BITCTL_BUFD_UCAST_AID_SHIFT
 1

	)

761 
	s›“80211_tim_›
 {

762 
u_št8_t
 
	mtim_›
;

763 
u_št8_t
 
	mtim_Ën
;

764 
u_št8_t
 
	mtim_couÁ
;

765 
u_št8_t
 
	mtim_³riod
;

766 
u_št8_t
 
	mtim_b™ùl
;

767 
u_št8_t
 
	mtim_b™m­
[1];

768 } 
	g__·cked
;

770 
	s›“80211_couÁry_›
 {

771 
u_št8_t
 
	m›
;

772 
u_št8_t
 
	mËn
;

773 
u_št8_t
 
	mcc
[3];

775 
u_št8_t
 
	mschª
;

776 
u_št8_t
 
	mnchª
;

777 
u_št8_t
 
	mmaxtxpwr
;

778 } 
__·cked
 
	mbªd
[4];

779 } 
	g__·cked
;

781 
	#IEEE80211_CHALLENGE_LEN
 128

	)

783 
	#IEEE80211_SUPPCHAN_LEN
 26

	)

785 
	#IEEE80211_RATE_BASIC
 0x80

	)

786 
	#IEEE80211_RATE_VAL
 0x7f

	)

789 
	#IEEE80211_ERP_NON_ERP_PRESENT
 0x01

	)

790 
	#IEEE80211_ERP_USE_PROTECTION
 0x02

	)

791 
	#IEEE80211_ERP_LONG_PREAMBLE
 0x04

	)

794 
	#ATHEROS_CAP_TURBO_PRIME
 0x01

	)

795 
	#ATHEROS_CAP_COMPRESSION
 0x02

	)

796 
	#ATHEROS_CAP_FAST_FRAME
 0x04

	)

798 
	#ATHEROS_CAP_BOOST
 0x80

	)

800 
	#ATH_OUI
 0x7f0300

	)

801 
	#ATH_OUI_TYPE
 0x01

	)

802 
	#ATH_OUI_SUBTYPE
 0x01

	)

803 
	#ATH_OUI_VERSION
 0x00

	)

804 
	#ATH_OUI_TYPE_XR
 0x03

	)

805 
	#ATH_OUI_SUBTYPE_XR
 0x01

	)

806 
	#ATH_OUI_VER_XR
 0x00

	)

808 
	#WPA_OUI
 0xf25000

	)

809 
	#WPA_OUI_TYPE
 0x01

	)

810 
	#WPA_VERSION
 1

	)

812 
	#WPA_CSE_NULL
 0x00

	)

813 
	#WPA_CSE_WEP40
 0x01

	)

814 
	#WPA_CSE_TKIP
 0x02

	)

815 
	#WPA_CSE_CCMP
 0x04

	)

816 
	#WPA_CSE_WEP104
 0x05

	)

818 
	#WPA_ASE_NONE
 0x00

	)

819 
	#WPA_ASE_8021X_UNSPEC
 0x01

	)

820 
	#WPA_ASE_8021X_PSK
 0x02

	)

822 
	#RSN_OUI
 0xac0f00

	)

823 
	#RSN_VERSION
 1

	)

825 
	#RSN_CSE_NULL
 0x00

	)

826 
	#RSN_CSE_WEP40
 0x01

	)

827 
	#RSN_CSE_TKIP
 0x02

	)

828 
	#RSN_CSE_WRAP
 0x03

	)

829 
	#RSN_CSE_CCMP
 0x04

	)

830 
	#RSN_CSE_WEP104
 0x05

	)

832 
	#RSN_ASE_NONE
 0x00

	)

833 
	#RSN_ASE_8021X_UNSPEC
 0x01

	)

834 
	#RSN_ASE_8021X_PSK
 0x02

	)

836 
	#RSN_CAP_PREAUTH
 0x01

	)

838 
	#WME_OUI
 0xf25000

	)

839 
	#WME_OUI_TYPE
 0x02

	)

840 
	#WME_INFO_OUI_SUBTYPE
 0x00

	)

841 
	#WME_PARAM_OUI_SUBTYPE
 0x01

	)

842 
	#WME_VERSION
 1

	)

845 
	#WME_AC_BE
 0

	)

846 
	#WME_AC_BK
 1

	)

847 
	#WME_AC_VI
 2

	)

848 
	#WME_AC_VO
 3

	)

861 
u_št8_t
 *
	t›“80211_mgt_auth_t
;

863 
	#IEEE80211_AUTH_ALGORITHM
(
auth
) \

864 ((
auth
)[0] | (×uth)[1] << 8))

	)

865 
	#IEEE80211_AUTH_TRANSACTION
(
auth
) \

866 ((
auth
)[2] | (×uth)[3] << 8))

	)

867 
	#IEEE80211_AUTH_STATUS
(
auth
) \

868 ((
auth
)[4] | (×uth)[5] << 8))

	)

870 
	#IEEE80211_AUTH_ALG_OPEN
 0x0000

	)

871 
	#IEEE80211_AUTH_ALG_SHARED
 0x0001

	)

872 
	#IEEE80211_AUTH_ALG_LEAP
 0x0080

	)

875 
	mIEEE80211_AUTH_OPEN_REQUEST
 = 1,

876 
	mIEEE80211_AUTH_OPEN_RESPONSE
 = 2,

880 
	mIEEE80211_AUTH_SHARED_REQUEST
 = 1,

881 
	mIEEE80211_AUTH_SHARED_CHALLENGE
 = 2,

882 
	mIEEE80211_AUTH_SHARED_RESPONSE
 = 3,

883 
	mIEEE80211_AUTH_SHARED_PASS
 = 4,

893 
	mIEEE80211_REASON_UNSPECIFIED
 = 1,

894 
	mIEEE80211_REASON_AUTH_EXPIRE
 = 2,

895 
	mIEEE80211_REASON_AUTH_LEAVE
 = 3,

896 
	mIEEE80211_REASON_ASSOC_EXPIRE
 = 4,

897 
	mIEEE80211_REASON_ASSOC_TOOMANY
 = 5,

898 
	mIEEE80211_REASON_NOT_AUTHED
 = 6,

899 
	mIEEE80211_REASON_NOT_ASSOCED
 = 7,

900 
	mIEEE80211_REASON_ASSOC_LEAVE
 = 8,

901 
	mIEEE80211_REASON_ASSOC_NOT_AUTHED
 = 9,

903 
	mIEEE80211_REASON_PWRCAP_UNACCEPTABLE
 = 10,

904 
	mIEEE80211_REASON_SUPPCHAN_UNACCEPTABLE
 = 11,

905 
	mIEEE80211_REASON_RSN_REQUIRED
 = 11,

906 
	mIEEE80211_REASON_RSN_INCONSISTENT
 = 12,

907 
	mIEEE80211_REASON_IE_INVALID
 = 13,

908 
	mIEEE80211_REASON_MIC_FAILURE
 = 14,

910 
	mIEEE80211_STATUS_SUCCESS
 = 0,

911 
	mIEEE80211_STATUS_UNSPECIFIED
 = 1,

912 
	mIEEE80211_STATUS_CAPINFO
 = 10,

913 
	mIEEE80211_STATUS_NOT_ASSOCED
 = 11,

914 
	mIEEE80211_STATUS_OTHER
 = 12,

915 
	mIEEE80211_STATUS_ALG
 = 13,

916 
	mIEEE80211_STATUS_SEQUENCE
 = 14,

917 
	mIEEE80211_STATUS_CHALLENGE
 = 15,

918 
	mIEEE80211_STATUS_TIMEOUT
 = 16,

919 
	mIEEE80211_STATUS_TOOMANY
 = 17,

920 
	mIEEE80211_STATUS_BASIC_RATE
 = 18,

921 
	mIEEE80211_STATUS_SP_REQUIRED
 = 19,

922 
	mIEEE80211_STATUS_PBCC_REQUIRED
 = 20,

923 
	mIEEE80211_STATUS_CA_REQUIRED
 = 21,

924 
	mIEEE80211_STATUS_SM_REQUIRED
 = 22,

925 
	mIEEE80211_STATUS_PWRCAP_UNACCEPTABLE
 = 23,

926 
	mIEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
 = 24,

927 
	mIEEE80211_STATUS_TOO_MANY_STATIONS
 = 22,

928 
	mIEEE80211_STATUS_RATES
 = 23,

929 
	mIEEE80211_STATUS_SHORTSLOT_REQUIRED
 = 25,

930 
	mIEEE80211_STATUS_DSSSOFDM_REQUIRED
 = 26,

933 
	#IEEE80211_WEP_KEYLEN
 5

	)

934 
	#IEEE80211_WEP_IVLEN
 3

	)

935 
	#IEEE80211_WEP_KIDLEN
 1

	)

936 
	#IEEE80211_WEP_CRCLEN
 4

	)

937 
	#IEEE80211_WEP_NKID
 4

	)

946 
	#IEEE80211_WEP_EXTIV
 0x20

	)

947 
	#IEEE80211_WEP_EXTIVLEN
 4

	)

948 
	#IEEE80211_WEP_MICLEN
 8

	)

950 
	#IEEE80211_CRC_LEN
 4

	)

959 
	#IEEE80211_MTU_MAX
 2290

	)

960 
	#IEEE80211_MTU_MIN
 32

	)

962 
	#IEEE80211_MAX_LEN
 (2300 + 
IEEE80211_CRC_LEN
 + \

963 (
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
 + 
IEEE80211_WEP_CRCLEN
))

	)

964 
	#IEEE80211_ACK_LEN
 \

965 ((
›“80211_äame_ack
è+ 
IEEE80211_CRC_LEN
)

	)

966 
	#IEEE80211_MIN_LEN
 \

967 ((
›“80211_äame_mš
è+ 
IEEE80211_CRC_LEN
)

	)

976 
	#IEEE80211_AID_MAX
 2007

	)

977 
	#IEEE80211_AID_DEF
 128

	)

979 
	#IEEE80211_AID
(
b
è((bè&~ 0xc000)

	)

985 
	#IEEE80211_RTS_DEFAULT
 512

	)

986 
	#IEEE80211_RTS_MIN
 1

	)

987 
	#IEEE80211_RTS_MAX
 2346

	)

992 
	#IEEE80211_REG_EXT_ID
 201

	)

997 
	#IEEE80211_TSF_LEN
 8

	)

	@ieee80211_acl.c

33 #iâdeà
EXPORT_SYMTAB


34 
	#EXPORT_SYMTAB


	)

48 #iâdeà
AUTOCONF_INCLUDED


49 
	~<lšux/cÚfig.h
>

51 
	~<lšux/v”siÚ.h
>

52 
	~<lšux/moduË.h
>

53 
	~<lšux/skbuff.h
>

54 
	~<lšux/Ãtdeviû.h
>

55 
	~<lšux/š™.h
>

57 
	~"if_medŸ.h
"

59 
	~<Ãt80211/›“80211_v¬.h
>

62 
	mACL_POLICY_OPEN
 = 0,

63 
	mACL_POLICY_ALLOW
 = 1,

64 
	mACL_POLICY_DENY
 = 2,

67 
	#ACL_HASHSIZE
 32

	)

69 
	saş
 {

70 
TAILQ_ENTRY
(
aş
è
	maş_li¡
;

71 
LIST_ENTRY
(
aş
è
	maş_hash
;

72 
u_št8_t
 
	maş_maÿddr
[
IEEE80211_ADDR_LEN
];

75 
	saş¡©e
 {

76 
aş_lock_t
 
	mas_lock
;

77 
	mas_pŞicy
;

78 
TAILQ_HEAD
(, 
aş
è
	mas_li¡
;

79 
ATH_LIST_HEAD
(, 
aş
è
	mas_hash
[
ACL_HASHSIZE
];

83 
	#ACL_HASH
(
addr
) \

84 (((cÚ¡ 
u_št8_t
 *)(
addr
))[
IEEE80211_ADDR_LEN
 - 1] % 
ACL_HASHSIZE
)

	)

86 
MALLOC_DEFINE
(
M_80211_ACL
, "acl", "802.11 station‡cl");

88 
aş_ä“_®l_locked
(
aş¡©e
 *);

91 
	$aş_©ch
(
›“80211v­
 *
v­
)

93 
aş¡©e
 *
as
;

95 
	`_MOD_INC_USE
(
THIS_MODULE
,  0);

97 
	`MALLOC
(
as
, 
aş¡©e
 *, (aclstate),

98 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

99 ià(
as
 =ğ
NULL
) {

100 
	`_MOD_DEC_USE
(
THIS_MODULE
);

103 
	`ACL_LOCK_INIT
(
as
, "acl");

104 
	`TAILQ_INIT
(&
as
->
as_li¡
);

105 
as
->
as_pŞicy
 = 
ACL_POLICY_OPEN
;

106 
v­
->
iv_as
 = 
as
;

108 
	}
}

111 
	$aş_d‘ach
(
›“80211v­
 *
v­
)

113 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

115 
	`ACL_LOCK
(
as
);

116 
	`aş_ä“_®l_locked
(
as
);

117 
	`ACL_UNLOCK
(
as
);

118 
v­
->
iv_as
 = 
NULL
;

119 
	`ACL_LOCK_DESTROY
(
as
);

120 
	`FREE
(
as
, 
M_DEVBUF
);

122 
	`_MOD_DEC_USE
(
THIS_MODULE
);

123 
	}
}

125 
__šlše
 
aş
 *

126 
	$_fšd_aş
(
aş¡©e
 *
as
, cÚ¡ 
u_št8_t
 *
maÿddr
)

128 
aş
 *acl;

129 
hash
;

131 
hash
 = 
	`ACL_HASH
(
maÿddr
);

132 
	`LIST_FOREACH
(
aş
, &
as
->
as_hash
[
hash
], 
aş_hash
) {

133 ià(
	`IEEE80211_ADDR_EQ
(
aş
->
aş_maÿddr
, 
maÿddr
))

134  
aş
;

136  
NULL
;

137 
	}
}

140 
	$_aş_ä“
(
aş¡©e
 *
as
, 
aş
 *acl)

143 
	`TAILQ_REMOVE
(&
as
->
as_li¡
, 
aş
, 
aş_li¡
);

144 
	`LIST_REMOVE
(
aş
, 
aş_hash
);

145 
	`FREE
(
aş
, 
M_80211_ACL
);

146 
	}
}

149 
	$aş_check
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
])

151 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

153 
as
->
as_pŞicy
) {

154 
ACL_POLICY_OPEN
:

156 
ACL_POLICY_ALLOW
:

157  
	`_fšd_aş
(
as
, 
mac
è!ğ
NULL
;

158 
ACL_POLICY_DENY
:

159  
	`_fšd_aş
(
as
, 
mac
è=ğ
NULL
;

162 
	}
}

165 
	$aş_add
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
])

167 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

168 
aş
 *aş, *
Ãw
;

169 
hash
;

171 
	`MALLOC
(
Ãw
, 
aş
 *, (aş), 
M_80211_ACL
, 
M_NOWAIT
 | 
M_ZERO
);

172 ià(
Ãw
 =ğ
NULL
) {

173 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
,

174 "ACL:‡dd " 
MAC_FMT
 " faed,‚ØmemÜy\n", 
	`MAC_ADDR
(
mac
));

176  -
ENOMEM
;

179 
	`ACL_LOCK
(
as
);

180 
hash
 = 
	`ACL_HASH
(
mac
);

181 
	`LIST_FOREACH
(
aş
, &
as
->
as_hash
[
hash
], 
aş_hash
) {

182 ià(
	`IEEE80211_ADDR_EQ
(
aş
->
aş_maÿddr
, 
mac
)) {

183 
	`ACL_UNLOCK_EARLY
(
as
);

184 
	`FREE
(
Ãw
, 
M_80211_ACL
);

185 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
,

186 "ACL:‡dd " 
MAC_FMT
 " failed,‡lready…resent\n",

187 
	`MAC_ADDR
(
mac
));

188  -
EEXIST
;

191 
	`IEEE80211_ADDR_COPY
(
Ãw
->
aş_maÿddr
, 
mac
);

192 
	`TAILQ_INSERT_TAIL
(&
as
->
as_li¡
, 
Ãw
, 
aş_li¡
);

193 
	`LIST_INSERT_HEAD
(&
as
->
as_hash
[
hash
], 
Ãw
, 
aş_hash
);

194 
	`ACL_UNLOCK
(
as
);

196 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
,

197 "ACL:‡dd " 
MAC_FMT
 "\n", 
	`MAC_ADDR
(
mac
));

199 
	}
}

202 
	$aş_»move
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
])

204 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

205 
aş
 *acl;

207 
	`ACL_LOCK
(
as
);

208 
aş
 = 
	`_fšd_aş
(
as
, 
mac
);

209 ià(
aş
 !ğ
NULL
)

210 
	`_aş_ä“
(
as
, 
aş
);

211 
	`ACL_UNLOCK
(
as
);

213 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
,

214 "ACL:„emov" 
MAC_FMT
 "%s\n", 
	`MAC_ADDR
(
mac
),

215 
aş
 =ğ
NULL
 ? ",‚ot…resent" : "");

217  (
aş
 =ğ
NULL
 ? 
ENOENT
 : 0);

218 
	}
}

221 
	$aş_ä“_®l_locked
(
aş¡©e
 *
as
)

223 
aş
 *acl;

225 
	`ACL_LOCK_ASSERT
(
as
);

227 (
aş
 = 
	`TAILQ_FIRST
(&
as
->
as_li¡
)è!ğ
NULL
)

228 
	`_aş_ä“
(
as
, 
aş
);

229 
	}
}

232 
	$aş_ä“_®l
(
›“80211v­
 *
v­
)

234 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

236 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
, "ACL: %s\n", "free‡ll");

238 
	`ACL_LOCK
(
as
);

239 
	`aş_ä“_®l_locked
(
v­
->
iv_as
);

240 
	`ACL_UNLOCK
(
as
);

243 
	}
}

246 
	$aş_£Şicy
(
›“80211v­
 *
v­
, 
pŞicy
)

248 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

250 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ACL
,

251 "ACL: s‘…ŞicyØ%u\n", 
pŞicy
);

253 
pŞicy
) {

254 
IEEE80211_MACCMD_POLICY_OPEN
:

255 
as
->
as_pŞicy
 = 
ACL_POLICY_OPEN
;

257 
IEEE80211_MACCMD_POLICY_ALLOW
:

258 
as
->
as_pŞicy
 = 
ACL_POLICY_ALLOW
;

260 
IEEE80211_MACCMD_POLICY_DENY
:

261 
as
->
as_pŞicy
 = 
ACL_POLICY_DENY
;

264  -
EINVAL
;

267 
	}
}

270 
	$aş_g‘pŞicy
(
›“80211v­
 *
v­
)

272 
aş¡©e
 *
as
 = 
v­
->
iv_as
;

274  
as
->
as_pŞicy
;

275 
	}
}

281 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

282 
MODULE_DESCRIPTION
("802.11 wireless support: MAC-based ACL…olicy");

283 #ifdeà
MODULE_LICENSE


284 
MODULE_LICENSE
("Dual BSD/GPL");

287 cÚ¡ 
›“80211_aş©Ü
 
	gmac
 = {

288 .
Ÿc_Çme
 = "mac",

289 .
	gŸc_©ch
 = 
aş_©ch
,

290 .
	gŸc_d‘ach
 = 
aş_d‘ach
,

291 .
	gŸc_check
 = 
aş_check
,

292 .
	gŸc_add
 = 
aş_add
,

293 .
	gŸc_»move
 = 
aş_»move
,

294 .
	gŸc_æush
 = 
aş_ä“_®l
,

295 .
	gŸc_£Şicy
 = 
aş_£Şicy
,

296 .
	gŸc_g‘pŞicy
 = 
aş_g‘pŞicy
,

299 
__š™


300 
	$š™_›“80211_aş
()

302 
	`›“80211_aş©Ü_»gi¡”
(&
mac
);

304 
	}
}

305 
moduË_š™
(
š™_›“80211_aş
);

307 
__ex™


308 
	$ex™_›“80211_aş
()

310 
	`›“80211_aş©Ü_uÄegi¡”
(&
mac
);

311 
	}
}

312 
moduË_ex™
(
ex™_›“80211_aş
);

	@ieee80211_beacon.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/if_vÏn.h
>

50 
	~"if_medŸ.h
"

51 
	~<Ãt80211/›“80211_v¬.h
>

54 
u_št8_t
 *

55 
	$›“80211_b—cÚ_š™
(
›“80211_node
 *
ni
, 
›“80211_b—cÚ_off£ts
 *
bo
,

56 
u_št8_t
 *
äm
)

58 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

59 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

60 
u_št16_t
 
ÿpšfo
;

61 
›“80211_¿‹£t
 *
rs
 = &
ni
->
ni_¿‹s
;

63 
	`KASSERT
(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
, ("no bss chan"));

66 
	`mem£t
(
äm
, 0, 8);

67 
äm
 += 8;

70 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ni
->
ni_štv®
);

71 
äm
 += 2;

74 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)

75 
ÿpšfo
 = 
IEEE80211_CAPINFO_IBSS
;

77 
ÿpšfo
 = 
IEEE80211_CAPINFO_ESS
;

78 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

79 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

80 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

81 
	`IEEE80211_IS_CHAN_2GHZ
(
ic
->
ic_bsschª
))

82 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

83 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
)

84 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_SLOTTIME
;

85 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
)

86 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SPECTRUM_MGMT
;

87 
bo
->
bo_ÿps
 = (
__Ë16
 *)
äm
;

88 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ÿpšfo
);

89 
äm
 += 2;

92 *
äm
++ = 
IEEE80211_ELEMID_SSID
;

93 ià((
v­
->
iv_æags
 & 
IEEE80211_F_HIDESSID
) == 0) {

94 *
äm
++ = 
ni
->
ni_es¦’
;

95 
	`memıy
(
äm
, 
ni
->
ni_essid
,‚i->
ni_es¦’
);

96 
äm
 +ğ
ni
->
ni_es¦’
;

98 *
äm
++ = 0;

101 
äm
 = 
	`›“80211_add_¿‹s
(äm, 
rs
);

106 ià(!
	`IEEE80211_IS_CHAN_FHSS
(
ic
->
ic_bsschª
)) {

107 *
äm
++ = 
IEEE80211_ELEMID_DSPARMS
;

108 *
äm
++ = 1;

109 *
äm
++ = 
	`›“80211_chª2›“
(
ic
, ic->
ic_bsschª
);

111 
bo
->
bo_tim
 = 
äm
;

114 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

115 *
äm
++ = 
IEEE80211_ELEMID_IBSSPARMS
;

116 *
äm
++ = 2;

117 *
äm
++ = 0; *frm++ = 0;

118 
bo
->
bo_tim_Ën
 = 0;

120 
›“80211_tim_›
 *
t›
 = (›“80211_tim_› *)
äm
;

122 
t›
->
tim_›
 = 
IEEE80211_ELEMID_TIM
;

123 
t›
->
tim_Ën
 = 4;

124 
t›
->
tim_couÁ
 = 0;

125 
t›
->
tim_³riod
 = 
v­
->
iv_dtim_³riod
;

126 
t›
->
tim_b™ùl
 = 0;

127 
t›
->
tim_b™m­
[0] = 0;

128 
äm
 +ğ(
›“80211_tim_›
);

129 
bo
->
bo_tim_Ën
 = 1;

131 
bo
->
bo_tim_Œa”
 = 
äm
;

134 ià((
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) ||

135 (
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_COUNTRYIE
))

136 
äm
 = 
	`›“80211_add_couÁry
(äm, 
ic
);

139 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
)

140 
äm
 = 
	`›“80211_add_pwrú¡r
(äm, 
ic
);

143 
bo
->
bo_chªsw™ch
 = 
äm
;

146 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
)) {

147 
bo
->
bo_”p
 = 
äm
;

148 
äm
 = 
	`›“80211_add_”p
(äm, 
ic
);

152 
äm
 = 
	`›“80211_add_x¿‹s
(äm, 
rs
);

155 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WME
) {

156 
bo
->
bo_wme
 = 
äm
;

157 
äm
 = 
	`›“80211_add_wme_·¿m
(äm, &
ic
->
ic_wme
, 
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
));

158 
v­
->
iv_æags
 &ğ~
IEEE80211_F_WMEUPDATE
;

162 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

163 
äm
 = 
	`›“80211_add_w·
(äm, 
v­
);

166 
bo
->
bo_©h_ÿps
 = 
äm
;

167 ià(
v­
->
iv_bss
 && v­->iv_bss->
ni_©h_æags
)

168 
äm
 = 
	`›“80211_add_©hAdvC­
(äm, 
v­
->
iv_bss
->
ni_©h_æags
,

169 
v­
->
iv_bss
->
ni_©h_defkeyšdex
);

172 
bo
->
bo_xr
 = 
äm
;

173 #ifdeà
ATH_SUPERG_XR


174 ià(
v­
->
iv_xrv­
 && v­->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
)

175 
äm
 = 
	`›“80211_add_xr_·¿m
(äm, 
v­
);

177 
bo
->
bo_­p›_buf
 = 
äm
;

178 
bo
->
bo_­p›_buf_Ën
 = 0;

180 
bo
->
bo_tim_Œa”Ën
 = 
äm
 - bo->
bo_tim_Œa”
;

181 
bo
->
bo_chªsw™ch_Œa”Ën
 = 
äm
 - bo->
bo_chªsw™ch
;

183  
äm
;

184 
	}
}

190 
sk_buff
 *

191 
	$›“80211_b—cÚ_®loc
(
›“80211_node
 *
ni
,

192 
›“80211_b—cÚ_off£ts
 *
bo
)

194 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

195 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

196 
›“80211_äame
 *
wh
;

197 
sk_buff
 *
skb
;

198 
pk’
;

199 
u_št8_t
 *
äm
;

200 
›“80211_¿‹£t
 *
rs
;

223 
rs
 = &
ni
->
ni_¿‹s
;

224 
pk’
 = 8

225 + (
u_št16_t
)

226 + (
u_št16_t
)

227 + 2 + 
ni
->
ni_es¦’


228 + 2 + 
IEEE80211_RATE_SIZE


230 + 2 + 4 + 
v­
->
iv_tim_Ën


231 + 
ic
->
ic_couÁry_›
.
couÁry_Ën
 + 2

235 + 2 + (
IEEE80211_RATE_MAXSIZE
 - 
IEEE80211_RATE_SIZE
)

236 + (
v­
->
iv_ÿps
 & 
IEEE80211_C_WME
 ?

237 (
›“80211_wme_·¿m
) : 0)

238 + (
v­
->
iv_ÿps
 & 
IEEE80211_C_WPA
 ?

239 2 * (
›“80211_›_w·
) : 0)

240 + (
›“80211_›_©hAdvC­
)

241 #ifdeà
ATH_SUPERG_XR


242 + (
ic
->
ic_©h_ÿp
 & 
IEEE80211_ATHC_XR
 ?

243 (
›“80211_xr_·¿m
) : 0)

246 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 
pk’
);

247 ià(
skb
 =ğ
NULL
) {

248 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ANY
, 
ni
,

249 "%s: cªnÙ g‘ buf; siz%u", 
__func__
, 
pk’
);

250 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

251  
NULL
;

254 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
ni
);

256 
äm
 = 
	`›“80211_b—cÚ_š™
(
ni
, 
bo
, frm);

258 
	`skb_Œim
(
skb
, 
äm
 - skb->
d©a
);

260 
wh
 = (
›“80211_äame
 *)

261 
	`skb_push
(
skb
, (
›“80211_äame
));

262 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_MGT
 |

263 
IEEE80211_FC0_SUBTYPE_BEACON
;

264 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_NODS
;

265 
wh
->
i_dur
 = 0;

266 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
ic
->
ic_dev
->
brßdÿ¡
);

267 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

268 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
v­
->
iv_bssid
);

269 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

270 "%s: b—cÚ bssid:" 
MAC_FMT
 "\n",

271 
__func__
, 
	`MAC_ADDR
(
wh
->
i_addr3
));

272 *(
u_št16_t
 *)
wh
->
i_£q
 = 0;

274  
skb
;

275 
	}
}

276 
EXPORT_SYMBOL
(
›“80211_b—cÚ_®loc
);

282 
	$›“80211_b—cÚ_upd©e
(
›“80211_node
 *
ni
,

283 
›“80211_b—cÚ_off£ts
 *
bo
, 
sk_buff
 *
skb
,

284 
mÿ¡
, *
is_dtim
)

286 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

287 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

288 
Ën_chªged
 = 0;

289 
u_št16_t
 
ÿpšfo
;

291 
	`IEEE80211_LOCK_IRQ
(
ic
);

294 ià((
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) &&

295 (
v­
->
iv_æags
 & 
IEEE80211_F_CHANSWITCH
)) {

296 
›“80211_chªÃl
 *
c
 =

297 
	`›“80211_dÙh_fšdchª
(
v­
, 
ic
->
ic_chªchªge_chª
);

299 ià(!
v­
->
iv_chªchªge_couÁ
 && !
c
) {

300 
v­
->
iv_æags
 &ğ~
IEEE80211_F_CHANSWITCH
;

301 
ic
->
ic_æags
 &ğ~
IEEE80211_F_CHANSWITCH
;

302 } ià(
v­
->
iv_chªchªge_couÁ
 &&

303 ((!
ic
->
ic_chªchªge_tb‰
) ||

304 (
v­
->
iv_chªchªge_couÁ
 =ğ
ic
->
ic_chªchªge_tb‰
))) {

305 
u_št8_t
 *
äm
;

307 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

308 "%s:„eš™ b—cÚ\n", 
__func__
);

312 ià(
c
 =ğ
NULL
) {

315 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

316 "%s: fšd chªÃÈçu»\n", 
__func__
);

318 
ic
->
ic_bsschª
 = 
c
;

320 
	`skb_puÎ
(
skb
, (
›“80211_äame
));

321 
	`skb_Œim
(
skb
, 0);

322 
äm
 = 
skb
->
d©a
;

323 
	`skb_put
(
skb
, 
	`›“80211_b—cÚ_š™
(
ni
, 
bo
, 
äm
) - frm);

324 
	`skb_push
(
skb
, (
›“80211_äame
));

326 
v­
->
iv_chªchªge_couÁ
 = 0;

327 
v­
->
iv_æags
 &ğ~
IEEE80211_F_CHANSWITCH
;

328 
ic
->
ic_æags
 &ğ~
IEEE80211_F_CHANSWITCH
;

332 ià(
c
 && (
ic
->
ic_curchª
 != c)) {

333 
ic
->
ic_curchª
 = 
c
;

334 
ic
->
	`ic_£t_chªÃl
(ic);

337 
Ën_chªged
 = 1;

342 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)

343 
ÿpšfo
 = 
IEEE80211_CAPINFO_IBSS
;

345 
ÿpšfo
 = 
IEEE80211_CAPINFO_ESS
;

347 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

348 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

349 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

350 
	`IEEE80211_IS_CHAN_2GHZ
(
ic
->
ic_bsschª
))

351 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

352 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
)

353 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_SLOTTIME
;

354 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
)

355 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SPECTRUM_MGMT
;

357 *
bo
->
bo_ÿps
 = 
	`htŞe16
(
ÿpšfo
);

359 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WME
) {

360 
›“80211_wme_¡©e
 *
wme
 = &
ic
->
ic_wme
;

369 ià(
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) {

370 ià(
wme
->
wme_hri_Œaffic
 >

371 
wme
->
wme_hri_sw™ch_th»sh
) {

372 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_WME
, 
ni
,

374 
__func__
, 
wme
->
wme_hri_Œaffic
);

375 
wme
->
wme_æags
 &ğ~
WME_F_AGGRMODE
;

376 
	`›“80211_wme_upd©•¬ams_locked
(
v­
);

377 
wme
->
wme_hri_Œaffic
 =

378 
wme
->
wme_hri_sw™ch_hy¡”esis
;

380 
wme
->
wme_hri_Œaffic
 = 0;

382 ià(
wme
->
wme_hri_Œaffic
 <=

383 
wme
->
wme_hri_sw™ch_th»sh
) {

384 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_WME
, 
ni
,

386 
__func__
, 
wme
->
wme_hri_Œaffic
);

387 
wme
->
wme_æags
 |ğ
WME_F_AGGRMODE
;

388 
	`›“80211_wme_upd©•¬ams_locked
(
v­
);

389 
wme
->
wme_hri_Œaffic
 = 0;

391 
wme
->
wme_hri_Œaffic
 =

392 
wme
->
wme_hri_sw™ch_hy¡”esis
;

395 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WMEUPDATE
) {

396 (è
	`›“80211_add_wme_·¿m
(
bo
->
bo_wme
, 
wme
, 
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
));

397 
v­
->
iv_æags
 &ğ~
IEEE80211_F_WMEUPDATE
;

401 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

402 
›“80211_tim_›
 *
t›
 =

403 (
›“80211_tim_›
 *)
bo
->
bo_tim
;

404 ià(
v­
->
iv_æags
 & 
IEEE80211_F_TIMUPDATE
) {

405 
u_št
 
timËn
, 
timoff
, 
i
;

422 ià(
v­
->
iv_ps_³ndšg
 != 0) {

423 
timoff
 = 128;

424 
i
 = 0; i < 
v­
->
iv_tim_Ën
; i++)

425 ià(
v­
->
iv_tim_b™m­
[
i
]) {

426 
timoff
 = 
i
 & 
BITCTL_BUFD_UCAST_AID_MASK
;

429 
	`KASSERT
(
timoff
 != 128, ("tim bitmapƒmpty!"));

430 
i
 = 
v­
->
iv_tim_Ën
-1; i >ğ
timoff
; i--)

431 ià(
v­
->
iv_tim_b™m­
[
i
])

433 
timËn
 = 1 + (
i
 - 
timoff
);

435 
timoff
 = 0;

436 
timËn
 = 1;

438 ià(
timËn
 !ğ
bo
->
bo_tim_Ën
) {

440 
Œa”_adju¡
 =

441 (
t›
->
tim_b™m­
+
timËn
è- (
bo
->
bo_tim_Œa”
);

442 
	`memmove
(
t›
->
tim_b™m­
+
timËn
, 
bo
->
bo_tim_Œa”
,

443 
bo
->
bo_tim_Œa”Ën
);

444 
bo
->
bo_tim_Œa”
 = 
t›
->
tim_b™m­
+
timËn
;

445 
bo
->
bo_chªsw™ch
 +ğ
Œa”_adju¡
;

446 
bo
->
bo_wme
 +ğ
Œa”_adju¡
;

447 
bo
->
bo_”p
 +ğ
Œa”_adju¡
;

448 
bo
->
bo_©h_ÿps
 +ğ
Œa”_adju¡
;

449 
bo
->
bo_xr
 +ğ
Œa”_adju¡
;

450 ià(
timËn
 > 
bo
->
bo_tim_Ën
)

451 
	`skb_put
(
skb
, 
timËn
 - 
bo
->
bo_tim_Ën
);

453 
	`skb_Œim
(
skb
, skb->
Ën
 - (
bo
->
bo_tim_Ën
 - 
timËn
));

454 
bo
->
bo_tim_Ën
 = 
timËn
;

457 
t›
->
tim_Ën
 = 3 + 
timËn
;

458 
t›
->
tim_b™ùl
 = 
timoff
;

459 
Ën_chªged
 = 1;

461 
	`memıy
(
t›
->
tim_b™m­
, 
v­
->
iv_tim_b™m­
 + 
timoff
,

462 
bo
->
bo_tim_Ën
);

464 
v­
->
iv_æags
 &ğ~
IEEE80211_F_TIMUPDATE
;

466 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

468 
__func__
, 
v­
->
iv_ps_³ndšg
, 
timoff
, 
timËn
);

471 ià(
t›
->
tim_couÁ
 == 0)

472 
t›
->
tim_couÁ
 =›->
tim_³riod
 - 1;

474 
t›
->
tim_couÁ
--;

476 ià(
mÿ¡
 && (
t›
->
tim_couÁ
 == 0))

477 
t›
->
tim_b™ùl
 |ğ
BITCTL_BUFD_MCAST
;

479 
t›
->
tim_b™ùl
 &ğ~
BITCTL_BUFD_MCAST
;

480 *
is_dtim
 = (
t›
->
tim_couÁ
 == 0);

491 ià(
	`IEEE80211_IS_MODE_BEACON
(
v­
->
iv_İmode
)) {

493 ià((
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) &&

494 (
ic
->
ic_æags
 & 
IEEE80211_F_CHANSWITCH
)) {

495 
›“80211_›_c§
 *
c§_›
 =

496 (
›“80211_›_c§
 *)
bo
->
bo_chªsw™ch
;

498 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

500 "%d/%d\n", 
__func__
,

501 
ic
->
ic_chªchªge_chª
,

502 
ic
->
ic_chªchªge_tb‰
);

503 ià(!
v­
->
iv_chªchªge_couÁ
) {

504 
v­
->
iv_æags
 |ğ
IEEE80211_F_CHANSWITCH
;

507 
	`memmove
(
bo
->
bo_chªsw™ch
 + (*
c§_›
),

508 
bo
->
bo_chªsw™ch
,

509 
bo
->
bo_chªsw™ch_Œa”Ën
);

512 
c§_›
->
c§_id
 = 
IEEE80211_ELEMID_CHANSWITCHANN
;

514 
c§_›
->
c§_Ën
 = (*csa_ie) - 2;

516 
c§_›
->
c§_mode
 = 1;

517 
c§_›
->
c§_chª
 = 
ic
->
ic_chªchªge_chª
;

518 
c§_›
->
c§_couÁ
 = 
ic
->
ic_chªchªge_tb‰
;

521 
bo
->
bo_chªsw™ch_Œa”Ën
 +ğ(*
c§_›
);

522 
bo
->
bo_tim_Œa”Ën
 +ğ(*
c§_›
);

523 
bo
->
bo_wme
 +ğ(*
c§_›
);

524 
bo
->
bo_”p
 +ğ(*
c§_›
);

525 
bo
->
bo_©h_ÿps
 +ğ(*
c§_›
);

526 
bo
->
bo_xr
 +ğ(*
c§_›
);

530 
	`skb_put
(
skb
, (*
c§_›
));

531 
Ën_chªged
 = 1;

532 } ià(
c§_›
->
c§_couÁ
)

533 
c§_›
->
c§_couÁ
--;

535 
v­
->
iv_chªchªge_couÁ
++;

536 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

538 
__func__
, 
c§_›
->
c§_couÁ
);

540 #ifdeà
ATH_SUPERG_XR


541 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XRUPDATE
) {

542 ià(
v­
->
iv_xrv­
)

543 ()
	`›“80211_add_xr_·¿m
(
bo
->
bo_xr
, 
v­
);

544 
v­
->
iv_æags
 &ğ~
IEEE80211_F_XRUPDATE
;

547 ià((
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_ERPUPDATE
) &&

548 (
bo
->
bo_”p
 !ğ
NULL
)) {

549 ()
	`›“80211_add_”p
(
bo
->
bo_”p
, 
ic
);

550 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_ERPUPDATE
;

554 ià(((
ic
->
ic_©h_ÿp
 & 
IEEE80211_ATHC_BOOST
) != 0) ^

555 
	`IEEE80211_IS_CHAN_TURBO
(
ic
->
ic_curchª
))

556 
	`›“80211_add_©hAdvC­
(
bo
->
bo_©h_ÿps
,

557 
v­
->
iv_bss
->
ni_©h_æags
,

558 
v­
->
iv_bss
->
ni_©h_defkeyšdex
);

560 ià(
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_APPIE_UPDATE
) {

562 ià(
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_BEACON
].
Ëngth
 !=

563 
bo
->
bo_­p›_buf_Ën
) {

564 
diff_Ën
;

565 
diff_Ën
 =

566 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_BEACON
].

567 
Ëngth
 -

568 
bo
->
bo_­p›_buf_Ën
;

570 ià(
diff_Ën
 > 0)

571 
	`skb_put
(
skb
, 
diff_Ën
);

573 
	`skb_Œim
(
skb
, skb->
Ën
 + 
diff_Ën
);

575 
bo
->
bo_­p›_buf_Ën
 =

576 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_BEACON
].

577 
Ëngth
;

579 
bo
->
bo_chªsw™ch_Œa”Ën
 +ğ
diff_Ën
;

580 
bo
->
bo_tim_Œa”Ën
 +ğ
diff_Ën
;

582 
Ën_chªged
 = 1;

584 
	`memıy
(
bo
->
bo_­p›_buf
,

585 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_BEACON
].
›
,

586 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_BEACON
].
Ëngth
);

588 
v­
->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_APPIE_UPDATE
;

591 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

593  
Ën_chªged
;

594 
	}
}

595 
EXPORT_SYMBOL
(
›“80211_b—cÚ_upd©e
);

	@ieee80211_crypto.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/kmod.h
>

47 
	~<lšux/skbuff.h
>

48 
	~<lšux/Ãtdeviû.h
>

49 
	~<lšux/¿ndom.h
>

51 
	~"if_‘h”subr.h
"

52 
	~"if_medŸ.h
"

54 
	~<Ãt80211/›“80211_v¬.h
>

59 cÚ¡ 
›“80211_ch”
 *
	gch”s
[
IEEE80211_CIPHER_MAX
];

61 
›“80211_üy±o_d–key_locked
(
›“80211v­
 *,

62 
›“80211_key
 *, 
›“80211_node
 *);

67 
›“80211_keyix_t


68 
	$nuÎ_key_®loc
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
k
)

70  
IEEE80211_KEYIX_NONE
;

71 
	}
}

73 
	$nuÎ_key_d–‘e
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
k
,

74 
›“80211_node
 *
ni
)

77 
	}
}

79 
	$nuÎ_key_£t
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
k
,

80 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
])

83 
	}
}

84 
	$nuÎ_key_upd©e
(
›“80211v­
 *
v­
)

86 
	}
}

88 #ifdeà
ATH_SUPERG_COMP


90 
	$nuÎ_comp_£t
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
,

91 
’
)

93 
	}
}

99 
__šlše
 

100 
	$ch”_d‘ach
(
›“80211_key
 *
key
)

102 
key
->
wk_ch”
->
	`ic_d‘ach
(key);

103 
	}
}

105 
__šlše
 *

106 
	$ch”_©ch
(
›“80211v­
 *
v­
, 
›“80211_key
 *
key
)

108  
key
->
wk_ch”
->
	`ic_©ch
(
v­
, key);

109 
	}
}

114 
__šlše
 
›“80211_keyix_t


115 
	$dev_key_®loc
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
key
)

117  
v­
->
	`iv_key_®loc
(v­, 
key
);

118 
	}
}

120 
__šlše
 

121 
	$dev_key_d–‘e
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
key
,

122 
›“80211_node
 *
ni
)

124  
v­
->
	`iv_key_d–‘e
(v­, 
key
, 
ni
);

125 
	}
}

127 
__šlše
 

128 
	$dev_key_£t
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_key
 *
key
,

129 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
])

131  
v­
->
	`iv_key_£t
(v­, 
key
, 
mac
);

132 
	}
}

134 #ifdeà
ATH_SUPERG_COMP


135 
__šlše
 

136 
	$dev_comp_£t
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
, 
’
)

138  
v­
->
	`iv_comp_£t
(v­, 
ni
, 
’
);

139 
	}
}

146 
	$›“80211_üy±o_©ch
(
›“80211com
 *
ic
)

149 
ch”s
[
IEEE80211_CIPHER_NONE
] = &
›“80211_ch”_nÚe
;

150 
	}
}

151 
EXPORT_SYMBOL
(
›“80211_üy±o_©ch
);

157 
	$›“80211_üy±o_d‘ach
(
›“80211com
 *
ic
)

159 
	}
}

160 
EXPORT_SYMBOL
(
›“80211_üy±o_d‘ach
);

166 
	$›“80211_üy±o_v©ch
(
›“80211v­
 *
v­
)

168 
i
;

171 
v­
->
iv_def_txkey
 = 
IEEE80211_KEYIX_NONE
;

172 
i
 = 0; i < 
IEEE80211_WEP_NKID
; i++)

173 
	`›“80211_üy±o_»£tkey
(
v­
, &v­->
iv_nw_keys
[
i
],

174 
IEEE80211_KEYIX_NONE
);

179 
v­
->
iv_key_®loc
 = 
nuÎ_key_®loc
;

180 
v­
->
iv_key_£t
 = 
nuÎ_key_£t
;

181 
v­
->
iv_key_d–‘e
 = 
nuÎ_key_d–‘e
;

182 
v­
->
iv_key_upd©e_begš
 = 
nuÎ_key_upd©e
;

183 
v­
->
iv_key_upd©e_’d
 = 
nuÎ_key_upd©e
;

184 #ifdeà
ATH_SUPERG_COMP


185 
v­
->
iv_comp_£t
 = 
nuÎ_comp_£t
;

187 
	}
}

188 
EXPORT_SYMBOL
(
›“80211_üy±o_v©ch
);

194 
	$›“80211_üy±o_vd‘ach
(
›“80211v­
 *
v­
)

196 
	`›“80211_üy±o_d–glob®keys
(
v­
);

197 
	}
}

198 
EXPORT_SYMBOL
(
›“80211_üy±o_vd‘ach
);

204 
	$›“80211_üy±o_»gi¡”
(cÚ¡ 
›“80211_ch”
 *
c
)

206 ià(
c
->
ic_ch”
 >ğ
IEEE80211_CIPHER_MAX
) {

207 
	`´štk
(
KERN_ERR
 "%s: cipher %s has‡n invalid cipher index %u\n",

208 
__func__
, 
c
->
ic_Çme
, c->
ic_ch”
);

211 ià((
ch”s
[
c
->
ic_ch”
] !ğ
NULL
) && (ciphers[cip->ic_cipher] != cip)) {

212 
	`´štk
(
KERN_ERR
 "%s: cipher %s„egistered with‡ differentemplate\n",

213 
__func__
, 
c
->
ic_Çme
);

216 
ch”s
[
c
->
ic_ch”
] = cip;

217 
	}
}

218 
EXPORT_SYMBOL
(
›“80211_üy±o_»gi¡”
);

224 
	$›“80211_üy±o_uÄegi¡”
(cÚ¡ 
›“80211_ch”
 *
c
)

226 ià(
c
->
ic_ch”
 >ğ
IEEE80211_CIPHER_MAX
) {

227 
	`´štk
(
KERN_ERR
 "%s: cipher %s has‡n invalid cipher index %u\n",

228 
__func__
, 
c
->
ic_Çme
, c->
ic_ch”
);

231 ià(
ch”s
[
c
->
ic_ch”
] !ğ
NULL
 && ciphers[cip->ic_cipher] != cip) {

232 
	`´štk
(
KERN_ERR
 "%s: cipher %s„egistered with‡ differentemplate\n",

233 
__func__
, 
c
->
ic_Çme
);

238 
ch”s
[
c
->
ic_ch”
] = 
NULL
;

239 
	}
}

240 
EXPORT_SYMBOL
(
›“80211_üy±o_uÄegi¡”
);

243 cÚ¡ *
	gch”_modÇmes
[] = {

253 
	$›“80211_üy±o_avaabË
(
›“80211v­
 *
v­
, 
u_št
 
ch”
)

255 
¡©us
 = 0;

257 ià(
ch”
 < 
IEEE80211_CIPHER_MAX
) {

258 ià(
ch”s
[
ch”
] =ğ
NULL
) {

265 ià(
ch”
 < 
	`ARRAY_SIZE
(
ch”_modÇmes
)) {

266 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

268 
__func__
, 
ch”
, 
ch”_modÇmes
[cipher]);

269 
	`›“80211_lßd_moduË
(
ch”_modÇmes
[
ch”
]);

276 ià(
ch”s
[
ch”
] =ğ
NULL
) {

277 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

279 
__func__
, 
ch”
,

280 
ch”
 < 
	`ARRAY_SIZE
(
ch”_modÇmes
) ?

281 
ch”_modÇmes
[
ch”
] : "<unknown>");

282 
v­
->
iv_¡©s
.
is_üy±o_noch”
++;

284 
¡©us
 = 1;

287 
¡©us
 = 1;

289  
¡©us
;

290 
	}
}

291 
EXPORT_SYMBOL
(
›“80211_üy±o_avaabË
);

307 
	$›“80211_üy±o_Ãwkey
(
›“80211v­
 *
v­
,

308 
ch”
, 
æags
, 
›“80211_key
 *
key
)

310 cÚ¡ 
›“80211_ch”
 *
c
;

311 *
keyùx
;

312 
oæags
;

317 ià(
ch”
 >ğ
IEEE80211_CIPHER_MAX
) {

318 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

319 "%s: inv®id ch” %u\n", 
__func__
, 
ch”
);

320 
v­
->
iv_¡©s
.
is_üy±o_badch”
++;

323 
c
 = 
ch”s
[
ch”
];

324 ià(
c
 =ğ
NULL
)

327 
oæags
 = 
key
->
wk_æags
;

328 
æags
 &ğ
IEEE80211_KEY_COMMON
;

333 ià(!(
v­
->
iv_ÿps
 & (1 << 
ch”
))) {

334 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

336 
__func__
, 
c
->
ic_Çme
);

337 
æags
 |ğ
IEEE80211_KEY_SWCRYPT
;

344 ià(
ch”
 =ğ
IEEE80211_CIPHER_TKIP
) {

345 ià(!(
v­
->
iv_ÿps
 & 
IEEE80211_C_TKIPMIC
)) {

346 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

348 
__func__
);

349 
æags
 |ğ
IEEE80211_KEY_SWMIC
;

350 } ià(!((
v­
->
iv_ÿps
 & 
IEEE80211_C_WME_TKIPMIC
)) &&

351 (
v­
->
iv_æags
 & 
IEEE80211_F_WME
)) {

352 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

355 
__func__
);

356 
æags
 |ğ
IEEE80211_KEY_SWMIC
;

366 ià((
key
->
wk_ch”
 !ğ
c
è|| (key->
wk_æags
 !ğ
æags
)) {

367 
agaš
:

377 
key
->
wk_æags
 = 
æags
;

378 
keyùx
 = 
c
->
	`ic_©ch
(
v­
, 
key
);

379 ià(
keyùx
 =ğ
NULL
) {

380 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

382 
__func__
, 
c
->
ic_Çme
);

383 
key
->
wk_æags
 = 
oæags
;

384 
v­
->
iv_¡©s
.
is_üy±o_©chç
++;

387 
	`ch”_d‘ach
(
key
);

388 
key
->
wk_ch”
 = 
c
;

389 
key
->
wk_´iv©e
 = 
keyùx
;

394 
key
->
wk_æags
 = 
æags
;

404 ià(
key
->
wk_keyix
 =ğ
IEEE80211_KEYIX_NONE
) {

405 
key
->
wk_keyix
 = 
	`dev_key_®loc
(
v­
, key);

406 ià(
key
->
wk_keyix
 =ğ
IEEE80211_KEYIX_NONE
) {

415 ià((
key
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) == 0) {

416 
v­
->
iv_¡©s
.
is_üy±o_swçÎback
++;

417 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

420 
__func__
, 
c
->
ic_Çme
);

421 
oæags
 = 
key
->
wk_æags
;

422 
æags
 |ğ
IEEE80211_KEY_SWCRYPT
;

423 ià(
ch”
 =ğ
IEEE80211_CIPHER_TKIP
)

424 
æags
 |ğ
IEEE80211_KEY_SWMIC
;

425 
agaš
;

427 
v­
->
iv_¡©s
.
is_üy±o_keyç
++;

428 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

430 
__func__
, 
c
->
ic_Çme
);

435 
	}
}

436 
EXPORT_SYMBOL
(
›“80211_üy±o_Ãwkey
);

442 
	$›“80211_üy±o_d–key_locked
(
›“80211v­
 *
v­
, 
›“80211_key
 *
key
,

443 
›“80211_node
 *
ni
)

445 
›“80211_keyix_t
 
keyix
;

447 
	`KASSERT
(
key
->
wk_ch”
 !ğ
NULL
, ("No cipher!"));

449 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

450 "%s: % keyix %u fÏg 0x%xsø%Îu†’ %u\n", 
__func__
,

451 
key
->
wk_ch”
->
ic_Çme
, key->
wk_keyix
, key->
wk_æags
,

452 ()
key
->
wk_keytsc
, key->
wk_keyËn
);

454 
keyix
 = 
key
->
wk_keyix
;

455 ià(
keyix
 !ğ
IEEE80211_KEYIX_NONE
) {

458 ià(!
	`dev_key_d–‘e
(
v­
, 
key
, 
ni
)) {

459 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

461 
__func__
, 
keyix
);

462 
v­
->
iv_¡©s
.
is_üy±o_d–key
++;

466 
	`ch”_d‘ach
(
key
);

467 
	`mem£t
(
key
, 0, (*key));

468 
	`›“80211_üy±o_»£tkey
(
v­
, 
key
, 
IEEE80211_KEYIX_NONE
);

470 
	}
}

476 
	$›“80211_üy±o_d–key
(
›“80211v­
 *
v­
, 
›“80211_key
 *
key
,

477 
›“80211_node
 *
ni
)

479 
¡©us
;

481 #ifdeà
ATH_SUPERG_COMP


483 ià(
ni
)

484 
	`dev_comp_£t
(
v­
, 
ni
, 0);

486 
	`›“80211_key_upd©e_begš
(
v­
);

487 
¡©us
 = 
	`›“80211_üy±o_d–key_locked
(
v­
, 
key
, 
ni
);

488 
	`›“80211_key_upd©e_’d
(
v­
);

490  
¡©us
;

491 
	}
}

492 
EXPORT_SYMBOL
(
›“80211_üy±o_d–key
);

498 
	$›“80211_üy±o_d–glob®keys
(
›“80211v­
 *
v­
)

500 
i
;

502 
	`›“80211_key_upd©e_begš
(
v­
);

503 
i
 = 0; i < 
IEEE80211_WEP_NKID
; i++)

504 (è
	`›“80211_üy±o_d–key_locked
(
v­
, &v­->
iv_nw_keys
[
i
], 
NULL
);

505 
	`›“80211_key_upd©e_’d
(
v­
);

506 
	}
}

507 
EXPORT_SYMBOL
(
›“80211_üy±o_d–glob®keys
);

517 
	$›“80211_üy±o_£tkey
(
›“80211v­
 *
v­
, 
›“80211_key
 *
key
,

518 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
],

519 
›“80211_node
 *
ni
)

521 cÚ¡ 
›“80211_ch”
 *
c
 = 
key
->
wk_ch”
;

522 
»t
;

524 
	`KASSERT
(
c
 !ğ
NULL
, ("No cipher!"));

526 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

527 "%s: % keyix %u fÏg 0x%x maø" 
MAC_FMT
 "sø%Îu†’ %u\n", 
__func__
,

528 
c
->
ic_Çme
, 
key
->
wk_keyix
, key->
wk_æags
,

529 
	`MAC_ADDR
(
maÿddr
), ()
key
->
wk_keytsc
,

530 
key
->
wk_keyËn
);

536 ià(!
c
->
	`ic_£tkey
(
key
)) {

537 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

539 
__func__
, 
c
->
ic_Çme
, 
key
->
wk_keyix
,

540 
key
->
wk_keyËn
, key->
wk_æags
);

541 
v­
->
iv_¡©s
.
is_üy±o_£tkey_ch”
++;

544 ià(
key
->
wk_keyix
 =ğ
IEEE80211_KEYIX_NONE
) {

546 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

547 "%s:‚Økey index; should‚Ù h­³n!\n", 
__func__
);

548 
v­
->
iv_¡©s
.
is_üy±o_£tkey_nokey
++;

551 
»t
 = 
	`dev_key_£t
(
v­
, 
key
, 
maÿddr
);

552 #ifdeà
ATH_SUPERG_COMP


553 ià(
»t
 && 
ni
) {

555 ià(
key
->
wk_æags
 & 
IEEE80211_KEY_RECV
)

556 
	`dev_comp_£t
(
v­
, 
ni
, 1);

560  
»t
;

561 
	}
}

562 
EXPORT_SYMBOL
(
›“80211_üy±o_£tkey
);

567 
›“80211_key
 *

568 
	$›“80211_üy±o_’ÿp
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
)

570 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

571 
›“80211_key
 *
k
;

572 
›“80211_äame
 *
wh
;

573 cÚ¡ 
›“80211_ch”
 *
c
;

574 
u_št8_t
 
keyid
;

582 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

583 ià(
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
) ||

584 
ni
->
ni_uÿ¡key
.
wk_ch”
 =ğ&
›“80211_ch”_nÚe
) {

585 ià(
v­
->
iv_def_txkey
 =ğ
IEEE80211_KEYIX_NONE
) {

586 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

587 
wh
->
i_addr1
,

589 
__func__
, 
v­
->
iv_def_txkey
);

590 
v­
->
iv_¡©s
.
is_tx_nodefkey
++;

591  
NULL
;

593 
keyid
 = 
v­
->
iv_def_txkey
;

594 
k
 = &
v­
->
iv_nw_keys
[v­->
iv_def_txkey
];

596 
keyid
 = 0;

597 
k
 = &
ni
->
ni_uÿ¡key
;

599 
c
 = 
k
->
wk_ch”
;

600 ià(
	`skb_h—droom
(
skb
è< 
c
->
ic_h—d”
) {

605 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr1
,

607 
__func__
, 
c
->
ic_Çme
, 
	`skb_h—droom
(
skb
));

608 
v­
->
iv_¡©s
.
is_tx_noh—droom
++;

609  
NULL
;

611  (
c
->
	`ic_’ÿp
(
k
, 
skb
, 
keyid
 << 6è? k : 
NULL
);

612 
	}
}

613 
EXPORT_SYMBOL
(
›“80211_üy±o_’ÿp
);

619 
›“80211_key
 *

620 
	$›“80211_üy±o_deÿp
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
, 
hd¾’
)

622 
	#IEEE80211_WEP_HDRLEN
 (
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
)

	)

623 
	#IEEE80211_WEP_MINLEN
 \

624 ((
›“80211_äame
) + \

625 
IEEE80211_WEP_HDRLEN
 + 
IEEE80211_WEP_CRCLEN
)

	)

626 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

627 
›“80211_key
 *
k
;

628 
›“80211_äame
 *
wh
;

629 cÚ¡ 
›“80211_ch”
 *
c
;

630 cÚ¡ 
u_št8_t
 *
ivp
;

631 
u_št8_t
 
keyid
;

634 ià(
skb
->
Ën
 < 
IEEE80211_WEP_MINLEN
) {

635 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ANY
, 
ni
,

637 
__func__
, 
skb
->
Ën
);

638 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

639  
NULL
;

647 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

648 
ivp
 = 
skb
->
d©a
 + 
hd¾’
;

649 
keyid
 = 
ivp
[
IEEE80211_WEP_IVLEN
];

650 ià(
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
) ||

651 
ni
->
ni_uÿ¡key
.
wk_ch”
 =ğ&
›“80211_ch”_nÚe
)

652 
k
 = &
v­
->
iv_nw_keys
[
keyid
 >> 6];

654 
k
 = &
ni
->
ni_uÿ¡key
;

656 
c
 = 
k
->
wk_ch”
;

657  (
c
->
	`ic_deÿp
(
k
, 
skb
, 
hd¾’
è? k : 
NULL
);

658 #undeà
IEEE80211_WEP_MINLEN


659 #undeà
IEEE80211_WEP_HDRLEN


660 
	}
}

661 
EXPORT_SYMBOL
(
›“80211_üy±o_deÿp
);

	@ieee80211_crypto.h

34 #iâdeà
_NET80211_IEEE80211_CRYPTO_H_


35 
	#_NET80211_IEEE80211_CRYPTO_H_


	)

40 
	#IEEE80211_KEYBUF_SIZE
 16

	)

41 
	#IEEE80211_MICBUF_SIZE
 (8 + 8è

	)

42 
	#IEEE80211_TID_SIZE
 17

	)

47 
	s›“80211_w•key
 {

48 
u_št
 
	mwk_Ën
;

49 
u_št8_t
 
	mwk_key
[
IEEE80211_KEYBUF_SIZE
];

52 
	g›“80211_ch”
;

71 
u_št16_t
 
	t›“80211_keyix_t
;

75 
	s›“80211_key
 {

76 
u_št8_t
 
	mwk_keyËn
;

77 
u_št8_t
 
	mwk_æags
;

78 
	#IEEE80211_KEY_XMIT
 0x01

	)

79 
	#IEEE80211_KEY_RECV
 0x02

	)

80 
	#IEEE80211_KEY_GROUP
 0x04

	)

81 
	#IEEE80211_KEY_SWCRYPT
 0x10

	)

82 
	#IEEE80211_KEY_SWMIC
 0x20

	)

83 
	#IEEE80211_KEY_TXRX
 (
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
)

	)

84 
›“80211_keyix_t
 
	mwk_keyix
;

85 
u_št8_t
 
	mwk_key
[
IEEE80211_KEYBUF_SIZE
+
IEEE80211_MICBUF_SIZE
];

86 
	#wk_txmic
 
wk_key
+
IEEE80211_KEYBUF_SIZE
+0

	)

87 
	#wk_rxmic
 
wk_key
+
IEEE80211_KEYBUF_SIZE
+8

	)

88 
u_št64_t
 
	mwk_keyrsc
[
IEEE80211_TID_SIZE
];

89 
u_št64_t
 
	mwk_keytsc
;

90 cÚ¡ 
›“80211_ch”
 *
	mwk_ch”
;

91 *
	mwk_´iv©e
;

93 
	#IEEE80211_KEY_COMMON
 \

94 (
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
 | 
IEEE80211_KEY_GROUP
)

	)

101 
	#IEEE80211_CIPHER_WEP
 0

	)

102 
	#IEEE80211_CIPHER_TKIP
 1

	)

103 
	#IEEE80211_CIPHER_AES_OCB
 2

	)

104 
	#IEEE80211_CIPHER_AES_CCM
 3

	)

105 
	#IEEE80211_CIPHER_CKIP
 5

	)

106 
	#IEEE80211_CIPHER_NONE
 6

	)

108 
	#IEEE80211_CIPHER_MAX
 (
IEEE80211_CIPHER_NONE
 + 1)

	)

110 
	#IEEE80211_KEYIX_NONE
 ((
›“80211_keyix_t
)-1)

	)

112 #ià
defšed
(
__KERNEL__
è|| defšed(
_KERNEL
)

114 
	g›“80211com
;

115 
	g›“80211v­
;

116 
	g›“80211_node
;

117 
	gsk_buff
;

119 
›“80211_üy±o_©ch
(
›“80211com
 *);

120 
›“80211_üy±o_d‘ach
(
›“80211com
 *);

121 
›“80211_üy±o_v©ch
(
›“80211v­
 *);

122 
›“80211_üy±o_vd‘ach
(
›“80211v­
 *);

123 
›“80211_üy±o_Ãwkey
(
›“80211v­
 *, , ,

124 
›“80211_key
 *);

125 
›“80211_üy±o_d–key
(
›“80211v­
 *, 
›“80211_key
 *,

126 
›“80211_node
 *);

127 
›“80211_üy±o_£tkey
(
›“80211v­
 *, 
›“80211_key
 *,

128 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
], 
›“80211_node
 *);

129 
›“80211_üy±o_d–glob®keys
(
›“80211v­
 *);

137 
	s›“80211_ch”
 {

138 cÚ¡ *
	mic_Çme
;

139 
u_št
 
	mic_ch”
;

140 
u_št
 
	mic_h—d”
;

141 
u_št
 
	mic_Œa”
;

142 
u_št
 
	mic_miş’
;

143 *(*
	mic_©ch
)(
	m›“80211v­
 *, 
	m›“80211_key
 *);

144 (*
	mic_d‘ach
)(
	m›“80211_key
 *);

145 (*
	mic_£tkey
)(
	m›“80211_key
 *);

146 (*
	mic_’ÿp
)(
	m›“80211_key
 *, 
	msk_buff
 *, 
	mu_št8_t
);

147 (*
	mic_deÿp
)(
	m›“80211_key
 *, 
	msk_buff
 *, );

148 (*
	mic_’mic
)(
	m›“80211_key
 *, 
	msk_buff
 *, );

149 (*
	mic_demic
)(
	m›“80211_key
 *, 
	msk_buff
 *, , );

151 cÚ¡ 
›“80211_ch”
 
›“80211_ch”_nÚe
;

153 
›“80211_üy±o_»gi¡”
(cÚ¡ 
›“80211_ch”
 *);

154 
›“80211_üy±o_uÄegi¡”
(cÚ¡ 
›“80211_ch”
 *);

155 
›“80211_üy±o_avaabË
(
›“80211v­
 *, 
u_št
);

157 
›“80211_key
 *
›“80211_üy±o_’ÿp
(
›“80211_node
 *,

158 
sk_buff
 *);

159 
›“80211_key
 *
›“80211_üy±o_deÿp
(
›“80211_node
 *,

160 
sk_buff
 *, );

165 
__šlše
 

166 
	$›“80211_üy±o_demic
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
,

167 
sk_buff
 *
skb
, 
hd¾’
, 
fÜû_sw
)

169 cÚ¡ 
›“80211_ch”
 *
c
 = 
k
->
wk_ch”
;

170  (
c
->
ic_miş’
 > 0 ? c->
	`ic_demic
(
k
, 
skb
, 
hd¾’
, 
fÜû_sw
) : 1);

171 
	}
}

176 
__šlše
 

177 
	$›“80211_üy±o_’mic
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
,

178 
sk_buff
 *
skb
, 
fÜû_sw
)

180 cÚ¡ 
›“80211_ch”
 *
c
 = 
k
->
wk_ch”
;

181  (
c
->
ic_miş’
 > 0 ? c->
	`ic_’mic
(
k
, 
skb
, 
fÜû_sw
) : 1);

182 
	}
}

189 
__šlše
 

190 
	$›“80211_üy±o_»£tkey
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
,

191 
›“80211_keyix_t
 
ix
)

193 
k
->
wk_ch”
 = &
›“80211_ch”_nÚe
;;

194 
k
->
wk_´iv©e
 = k->
wk_ch”
->
	`ic_©ch
(
v­
, k);

195 
k
->
wk_keyix
 = 
ix
;

196 
k
->
wk_æags
 = 
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
;

197 
	}
}

202 
›“80211_nÙify_»¶ay_çu»
(
›“80211v­
 *,

203 cÚ¡ 
›“80211_äame
 *, cÚ¡ 
›“80211_key
 *,

204 
u_št64_t
 
rsc
);

205 
›“80211_nÙify_mich«l_çu»
(
›“80211v­
 *,

206 cÚ¡ 
›“80211_äame
 *, 
›“80211_keyix_t
 
keyix
);

	@ieee80211_crypto_ccmp.c

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/¿ndom.h
>

49 
	~<lšux/š™.h
>

51 
	~<lšux/üy±o.h
>

52 
	~<asm/sÿ‰”li¡.h
>

54 
	~"if_medŸ.h
"

56 
	~<Ãt80211/›“80211_v¬.h
>

58 
	#AES_BLOCK_LEN
 16

	)

60 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,19)

61 
	#üy±o_ch”
 
üy±o_tfm


	)

64 
	sccmp_ùx
 {

65 
›“80211v­
 *
	mcc_v­
;

66 
›“80211com
 *
	mcc_ic
;

67 
üy±o_ch”
 *
	mcc_tfm
;

70 *
ccmp_©ch
(
›“80211v­
 *, 
›“80211_key
 *);

71 
ccmp_d‘ach
(
›“80211_key
 *);

72 
ccmp_£tkey
(
›“80211_key
 *);

73 
ccmp_’ÿp
(
›“80211_key
 *, 
sk_buff
 *, 
u_št8_t
);

74 
ccmp_deÿp
(
›“80211_key
 *, 
sk_buff
 *, );

75 
ccmp_’mic
(
›“80211_key
 *, 
sk_buff
 *, );

76 
ccmp_demic
(
›“80211_key
 *, 
sk_buff
 *, , );

78 cÚ¡ 
›“80211_ch”
 
	gccmp
 = {

79 .
ic_Çme
 = "AES-CCM",

80 .
	gic_ch”
 = 
IEEE80211_CIPHER_AES_CCM
,

81 .
	gic_h—d”
 = 
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
 +

82 
IEEE80211_WEP_EXTIVLEN
,

83 .
	gic_Œa”
 = 
IEEE80211_WEP_MICLEN
,

84 .
	gic_miş’
 = 0,

85 .
	gic_©ch
 = 
ccmp_©ch
,

86 .
	gic_d‘ach
 = 
ccmp_d‘ach
,

87 .
	gic_£tkey
 = 
ccmp_£tkey
,

88 .
	gic_’ÿp
 = 
ccmp_’ÿp
,

89 .
	gic_deÿp
 = 
ccmp_deÿp
,

90 .
	gic_’mic
 = 
ccmp_’mic
,

91 .
	gic_demic
 = 
ccmp_demic
,

94 
ccmp_’üy±
(
›“80211_key
 *, 
sk_buff
 *, );

95 
ccmp_deüy±
(
›“80211_key
 *, 
u_št64_t
, 
sk_buff
 *, );

98 
	$ccmp_©ch
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
)

100 
ccmp_ùx
 *
ùx
;

101 
¡©us
 = 1;

103 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

105 
	`MALLOC
(
ùx
, 
ccmp_ùx
 *, (ccmp_ctx),

106 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

107 ià(
ùx
 =ğ
NULL
) {

108 
v­
->
iv_¡©s
.
is_üy±o_nomem
++;

109 
¡©us
 = 0;

114 ià(
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) {

115 #ià
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,19)

116 
ùx
->
cc_tfm
 = 
	`üy±o_®loc_tfm
("aes", 0);

118 
ùx
->
cc_tfm
 = 
	`üy±o_®loc_ch”
("aes", 0,

119 
CRYPTO_ALG_ASYNC
);

120 ià(
	`IS_ERR
(
ùx
->
cc_tfm
))

121 
ùx
->
cc_tfm
 = 
NULL
;

124 ià(
ùx
->
cc_tfm
 =ğ
NULL
) {

125 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

129 
__func__
);

130 
	`FREE
(
ùx
, 
M_DEVBUF
);

131 
ùx
 = 
NULL
;

132 
v­
->
iv_¡©s
.
is_üy±o_noch”
++;

133 
¡©us
 = 0;

137 ià(!
¡©us
)

138 
	`_MOD_DEC_USE
(
THIS_MODULE
);

140 
ùx
->
cc_v­
 = 
v­
;

141 
ùx
->
cc_ic
 = 
v­
->
iv_ic
;

144  
ùx
;

145 
	}
}

148 
	$ccmp_d‘ach
(
›“80211_key
 *
k
)

150 
ccmp_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

152 ià(
ùx
->
cc_tfm
 !ğ
NULL
)

153 #ià
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,19)

154 
	`üy±o_ä“_tfm
(
ùx
->
cc_tfm
);

156 
	`üy±o_ä“_ch”
(
ùx
->
cc_tfm
);

158 
	`FREE
(
ùx
, 
M_DEVBUF
);

160 
	`_MOD_DEC_USE
(
THIS_MODULE
);

161 
	}
}

164 
	$ccmp_£tkey
(
›“80211_key
 *
k
)

166 
ccmp_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

168 ià(
k
->
wk_keyËn
 !ğ(128 / 
NBBY
)) {

169 
	`IEEE80211_DPRINTF
(
ùx
->
cc_v­
, 
IEEE80211_MSG_CRYPTO
,

171 
__func__
, 
k
->
wk_keyËn
, 128 / 
NBBY
);

175 ià(
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
)

176 
	`üy±o_ch”_£tkey
(
ùx
->
cc_tfm
, 
k
->
wk_key
, k->
wk_keyËn
);

179 
	}
}

185 
	$ccmp_’ÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
u_št8_t
 
keyid
)

187 
ccmp_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

188 
›“80211com
 *
ic
 = 
ùx
->
cc_ic
;

189 
u_št8_t
 *
ivp
;

190 
hd¾’
;

192 
hd¾’
 = 
	`›“80211_hdr¥aû
(
ic
, 
skb
->
d©a
);

197 
ivp
 = 
	`skb_push
(
skb
, 
ccmp
.
ic_h—d”
);

198 
	`memmove
(
ivp
, iv°+ 
ccmp
.
ic_h—d”
, 
hd¾’
);

199 
ivp
 +ğ
hd¾’
;

201 
k
->
wk_keytsc
++;

202 
ivp
[0] = 
k
->
wk_keytsc
 >> 0;

203 
ivp
[1] = 
k
->
wk_keytsc
 >> 8;

204 
ivp
[2] = 0;

205 
ivp
[3] = 
keyid
 | 
IEEE80211_WEP_EXTIV
;

206 
ivp
[4] = 
k
->
wk_keytsc
 >> 16;

207 
ivp
[5] = 
k
->
wk_keytsc
 >> 24;

208 
ivp
[6] = 
k
->
wk_keytsc
 >> 32;

209 
ivp
[7] = 
k
->
wk_keytsc
 >> 40;

214 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) &&

215 !
	`ccmp_’üy±
(
k
, 
skb
, 
hd¾’
))

219 
	}
}

225 
	$ccmp_’mic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
fÜû_sw
)

228 
	}
}

230 
__šlše
 
ušt64_t


231 
	$READ_6
(
ušt8_t
 
b0
, ušt8_ˆ
b1
, ušt8_ˆ
b2
, ušt8_ˆ
b3
, ušt8_ˆ
b4
, ušt8_ˆ
b5
)

233 
ušt32_t
 
iv32
 = (
b0
 << 0è| (
b1
 << 8è| (
b2
 << 16è| (
b3
 << 24);

234 
ušt16_t
 
iv16
 = (
b4
 << 0è| (
b5
 << 8);

235  (((
ušt64_t
)
iv16
è<< 32è| 
iv32
;

236 
	}
}

244 
	$ccmp_deÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
)

246 
ccmp_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

247 
›“80211v­
 *
v­
 = 
ùx
->
cc_v­
;

248 
›“80211_äame
 *
wh
;

249 
ušt8_t
 *
ivp
;

250 
ušt64_t
 
²
;

251 
u_št8_t
 
tid
;

257 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

258 
ivp
 = 
skb
->
d©a
 + 
hd¾’
;

259 ià((
ivp
[
IEEE80211_WEP_IVLEN
] & 
IEEE80211_WEP_EXTIV
) == 0) {

263 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

265 
v­
->
iv_¡©s
.
is_rx_ccmpfÜm©
++;

268 
tid
 = 0;

269 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
))

270 
tid
 = ((
›“80211_qosäame
 *)
wh
)->
i_qos
[0] & 
IEEE80211_QOS_TID
;

272 
²
 = 
	`READ_6
(
ivp
[0], ivp[1], ivp[4], ivp[5], ivp[6], ivp[7]);

273 ià(
²
 &&…À<ğ
k
->
wk_keyrsc
[
tid
]) {

277 
	`›“80211_nÙify_»¶ay_çu»
(
v­
, 
wh
, 
k
, 
²
);

278 
v­
->
iv_¡©s
.
is_rx_ccm´•Ïy
++;

289 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) &&

290 !
	`ccmp_deüy±
(
k
, 
²
, 
skb
, 
hd¾’
))

296 
	`memmove
(
skb
->
d©a
 + 
ccmp
.
ic_h—d”
, skb->d©a, 
hd¾’
);

297 
	`skb_puÎ
(
skb
, 
ccmp
.
ic_h—d”
);

298 
skb
->
Ãxt
 !ğ
NULL
)

299 
skb
 = skb->
Ãxt
;

300 
	`skb_Œim
(
skb
, skb->
Ën
 - 
ccmp
.
ic_Œa”
);

305 
k
->
wk_keyrsc
[
tid
] = 
²
;

308 
	}
}

314 
	$ccmp_demic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
, 
fÜû_sw
)

317 
	}
}

319 
__šlše
 

320 
	$xÜ_block
(
u8
 *
b
, cÚ¡ u8 *
a
, 
size_t
 
Ën
)

322 
i
;

323 
i
 = 0; i < 
Ën
; i++)

324 
b
[
i
] ^ğ
a
[i];

325 
	}
}

328 
	$rijnd«l_’üy±
(
üy±o_ch”
 *
tfm
, cÚ¡ *
¤c
, *
d¡
)

330 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,19)

331 
	`üy±o_ch”_’üy±_Úe
(
tfm
, 
d¡
, 
¤c
);

333 
sÿ‰”li¡
 
sg_¤c
;

334 
sÿ‰”li¡
 
sg_d¡
;

336 
sg_¤c
.
·ge
 = 
	`vœt_to_·ge
(
¤c
);

337 
sg_¤c
.
off£t
 = 
	`off£t_š_·ge
(
¤c
);

338 
sg_¤c
.
Ëngth
 = 
AES_BLOCK_LEN
;

340 
sg_d¡
.
·ge
 = 
	`vœt_to_·ge
(
d¡
);

341 
sg_d¡
.
off£t
 = 
	`off£t_š_·ge
(
d¡
);

342 
sg_d¡
.
Ëngth
 = 
AES_BLOCK_LEN
;

343 
	`üy±o_ch”_’üy±
(
tfm
, &
sg_d¡
, &
sg_¤c
, 
AES_BLOCK_LEN
);

345 
	}
}

362 
	$ccmp_š™_blocks
(
üy±o_ch”
 *
tfm
, 
›“80211_äame
 *
wh
,

363 
u_št64_t
 
²
, 
size_t
 
dËn
,

364 
ušt8_t
 
b0
[
AES_BLOCK_LEN
], ušt8_ˆ
¯d
[2 * AES_BLOCK_LEN],

365 
ušt8_t
 
auth
[
AES_BLOCK_LEN
], ušt8_ˆ
s0
[AES_BLOCK_LEN])

367 
	#IS_4ADDRESS
(
wh
) \

368 ((
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
è=ğ
IEEE80211_FC1_DIR_DSTODS
)

	)

369 
	#IS_QOS_DATA
(
wh
è
	`IEEE80211_QOS_HAS_SEQ
(wh)

	)

376 
b0
[0] = 0x59;

378 
	`IEEE80211_ADDR_COPY
(
b0
 + 2, 
wh
->
i_addr2
);

379 
b0
[8] = 
²
 >> 40;

380 
b0
[9] = 
²
 >> 32;

381 
b0
[10] = 
²
 >> 24;

382 
b0
[11] = 
²
 >> 16;

383 
b0
[12] = 
²
 >> 8;

384 
b0
[13] = 
²
 >> 0;

385 
b0
[14] = (
dËn
 >> 8) & 0xff;

386 
b0
[15] = 
dËn
 & 0xff;

395 
¯d
[0] = 0;

397 
¯d
[2] = 
wh
->
i_fc
[0] & 0x8f;

398 
¯d
[3] = 
wh
->
i_fc
[1] & 0xc7;

400 
	`memıy
(
¯d
 + 4, 
wh
->
i_addr1
, 3 * 
IEEE80211_ADDR_LEN
);

401 
¯d
[22] = 
wh
->
i_£q
[0] & 
IEEE80211_SEQ_FRAG_MASK
;

402 
¯d
[23] = 0;

413 ià(
	`IS_4ADDRESS
(
wh
)) {

414 
	`IEEE80211_ADDR_COPY
(
¯d
 + 24,

415 ((
›“80211_äame_addr4
 *)
wh
)->
i_addr4
);

416 ià(
	`IS_QOS_DATA
(
wh
)) {

417 
›“80211_qosäame_addr4
 *
qwh4
 =

418 (
›“80211_qosäame_addr4
 *)
wh
;

419 
¯d
[30] = 
qwh4
->
i_qos
[0] & 0x0f;

420 
¯d
[31] = 0;

421 
b0
[1] = 
¯d
[30];

422 
¯d
[1] = 22 + 
IEEE80211_ADDR_LEN
 + 2;

424 *(
u_št16_t
 *)&
¯d
[30] = 0;

425 
b0
[1] = 0;

426 
¯d
[1] = 22 + 
IEEE80211_ADDR_LEN
;

429 ià(
	`IS_QOS_DATA
(
wh
)) {

430 
›“80211_qosäame
 *
qwh
 =

431 (
›“80211_qosäame
 *)
wh
;

432 
¯d
[24] = 
qwh
->
i_qos
[0] & 0x0f;

433 
¯d
[25] = 0;

434 
b0
[1] = 
¯d
[24];

435 
¯d
[1] = 22 + 2;

437 *(
u_št16_t
 *)&
¯d
[24] = 0;

438 
b0
[1] = 0;

439 
¯d
[1] = 22;

441 *(
u_št16_t
 *)&
¯d
[26] = 0;

442 *(
u_št32_t
 *)&
¯d
[28] = 0;

446 
	`rijnd«l_’üy±
(
tfm
, 
b0
, 
auth
);

447 
	`xÜ_block
(
auth
, 
¯d
, 
AES_BLOCK_LEN
);

448 
	`rijnd«l_’üy±
(
tfm
, 
auth
,‡uth);

449 
	`xÜ_block
(
auth
, &
¯d
[
AES_BLOCK_LEN
], AES_BLOCK_LEN);

450 
	`rijnd«l_’üy±
(
tfm
, 
auth
,‡uth);

451 
b0
[0] &= 0x07;

452 
b0
[14] = b0[15] = 0;

453 
	`rijnd«l_’üy±
(
tfm
, 
b0
, 
s0
);

454 #undeà
IS_QOS_DATA


455 #undeà
IS_4ADDRESS


456 
	}
}

458 
	#CCMP_ENCRYPT
(
_i
, 
_b
, 
_b0
, 
_pos
, 
_e
, 
_Ën
) do { \

460 
	`xÜ_block
(
_b
, 
_pos
, 
_Ën
); \

461 
	`rijnd«l_’üy±
(
ùx
->
cc_tfm
, 
_b
, _b); \

463 
_b0
[14] = (
_i
 >> 8) & 0xff; \

464 
_b0
[15] = 
_i
 & 0xff; \

465 
	`rijnd«l_’üy±
(
ùx
->
cc_tfm
, 
_b0
, 
_e
); \

466 
	`xÜ_block
(
_pos
, 
_e
, 
_Ën
); \

467 } 0)

	)

470 
	$ccmp_’üy±
(
›“80211_key
 *
key
, 
sk_buff
 *
skb0
, 
hd¾’
)

472 
ccmp_ùx
 *
ùx
 = 
key
->
wk_´iv©e
;

473 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb0
->
d©a
;

474 
sk_buff
 *
skb
;

475 
d©a_Ën
, 
i
;

476 
ušt8_t
 
¯d
[2 * 
AES_BLOCK_LEN
], 
b0
[AES_BLOCK_LEN], 
b
[AES_BLOCK_LEN];

477 
ušt8_t
 
e
[
AES_BLOCK_LEN
], 
s0
[AES_BLOCK_LEN];

478 
ušt8_t
 *
mic
, *
pos
;

479 
u_št
 
¥aû
;

481 
ùx
->
cc_v­
->
iv_¡©s
.
is_üy±o_ccmp
++;

483 
skb
 = 
skb0
;

484 
d©a_Ën
 = 
skb
->
Ën
;

485 
skb
->
Ãxt
 !ğ
NULL
) {

486 
skb
 = skb->
Ãxt
;

487 
d©a_Ën
 +ğ
skb
->
Ën
;

489 
d©a_Ën
 -ğ
hd¾’
 + 
ccmp
.
ic_h—d”
;

490 ià(
	`skb_room
(
skb
è< 
ccmp
.
ic_Œa”
) {

492 
	`IEEE80211_NOTE_MAC
(
ùx
->
cc_v­
, 
IEEE80211_MSG_CRYPTO
,

493 
wh
->
i_addr1
, "No„oom for %s MIC,ailroom %u",

494 
ccmp
.
ic_Çme
, 
	`skb_room
(
skb
));

498 
	`ccmp_š™_blocks
(
ùx
->
cc_tfm
, 
wh
, 
key
->
wk_keytsc
,

499 
d©a_Ën
, 
b0
, 
¯d
, 
b
, 
s0
);

501 
i
 = 1;

502 
skb
 = 
skb0
;

503 
pos
 = 
skb
->
d©a
 + 
hd¾’
 + 
ccmp
.
ic_h—d”
;

505 
¥aû
 = 
skb
->
Ën
 - (
hd¾’
 + 
ccmp
.
ic_h—d”
);

507 ià(
¥aû
 > 
d©a_Ën
)

508 
¥aû
 = 
d©a_Ën
;

512 
¥aû
 >ğ
AES_BLOCK_LEN
) {

513 
	`CCMP_ENCRYPT
(
i
, 
b
, 
b0
, 
pos
, 
e
, 
AES_BLOCK_LEN
);

514 
pos
 +ğ
AES_BLOCK_LEN
, 
¥aû
 -= AES_BLOCK_LEN;

515 
d©a_Ën
 -ğ
AES_BLOCK_LEN
;

516 
i
++;

518 ià(
d©a_Ën
 <= 0)

520 ià(
skb
->
Ãxt
 =ğ
NULL
) {

521 ià(
¥aû
 != 0) {

525 
	`CCMP_ENCRYPT
(
i
, 
b
, 
b0
, 
pos
, 
e
, 
¥aû
);

529 
skb
 = skb->
Ãxt
;

530 ià(
¥aû
 != 0) {

531 
ušt8_t
 *
pos_Ãxt
;

532 
u_št
 
¥aû_Ãxt
;

533 
u_št
 
Ën
;

539 
pos_Ãxt
 = 
skb
->
d©a
;

540 
Ën
 = 
	`mš
(
d©a_Ën
, 
AES_BLOCK_LEN
);

541 
¥aû_Ãxt
 = 
Ën
 > 
¥aû
 ?†en - space : 0;

542 
	`KASSERT
(
skb
->
Ën
 >ğ
¥aû_Ãxt
,

544 "skb†’ %u‚“d %u", 
skb
->
Ën
, 
¥aû_Ãxt
));

546 
	`xÜ_block
(
b
 + 
¥aû
, 
pos_Ãxt
, 
¥aû_Ãxt
);

547 
	`CCMP_ENCRYPT
(
i
, 
b
, 
b0
, 
pos
, 
e
, 
¥aû
);

548 
	`xÜ_block
(
pos_Ãxt
, 
e
 + 
¥aû
, 
¥aû_Ãxt
);

549 
d©a_Ën
 -ğ
Ën
;

551 
i
++;

553 
pos
 = 
pos_Ãxt
 + 
¥aû_Ãxt
;

554 
¥aû
 = 
skb
->
Ën
 - 
¥aû_Ãxt
;

559 
pos
 = 
skb
->
d©a
;

560 
¥aû
 = 
skb
->
Ën
;

564 
mic
 = 
	`skb_put
(
skb
, 
ccmp
.
ic_Œa”
);

565 
i
 = 0; i < 
ccmp
.
ic_Œa”
; i++)

566 
mic
[
i
] = 
b
[i] ^ 
s0
[i];

568 
	}
}

569 #undeà
CCMP_ENCRYPT


571 
	#CCMP_DECRYPT
(
_i
, 
_b
, 
_b0
, 
_pos
, 
_a
, 
_Ën
) do { \

573 
_b0
[14] = (
_i
 >> 8) & 0xff; \

574 
_b0
[15] = 
_i
 & 0xff; \

575 
	`rijnd«l_’üy±
(
ùx
->
cc_tfm
, 
_b0
, 
_b
); \

576 
	`xÜ_block
(
_pos
, 
_b
, 
_Ën
); \

578 
	`xÜ_block
(
_a
, 
_pos
, 
_Ën
); \

579 
	`rijnd«l_’üy±
(
ùx
->
cc_tfm
, 
_a
, _a); \

580 } 0)

	)

583 
	$ccmp_deüy±
(
›“80211_key
 *
key
, 
u_št64_t
 
²
, 
sk_buff
 *
skb0
, 
hd¾’
)

585 
ccmp_ùx
 *
ùx
 = 
key
->
wk_´iv©e
;

586 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb0
->
d©a
;

587 
sk_buff
 *
skb
;

588 
ušt8_t
 
¯d
[2 * 
AES_BLOCK_LEN
];

589 
ušt8_t
 
b0
[
AES_BLOCK_LEN
], 
b
[AES_BLOCK_LEN], 
a
[AES_BLOCK_LEN];

590 
size_t
 
d©a_Ën
;

591 
i
;

592 
ušt8_t
 *
pos
, *
mic
;

593 
u_št
 
¥aû
;

595 
ùx
->
cc_v­
->
iv_¡©s
.
is_üy±o_ccmp
++;

597 
skb
 = 
skb0
;

598 
d©a_Ën
 = 
skb
->
Ën
;

599 
skb
->
Ãxt
 !ğ
NULL
) {

600 
skb
 = skb->
Ãxt
;

601 
d©a_Ën
 +ğ
skb
->
Ën
;

603 
d©a_Ën
 -ğ
hd¾’
 + 
ccmp
.
ic_h—d”
 + ccmp.
ic_Œa”
;

605 
	`ccmp_š™_blocks
(
ùx
->
cc_tfm
, 
wh
, 
²
, 
d©a_Ën
, 
b0
, 
¯d
, 
a
, 
b
);

608 
mic
 = 
skb
->
d©a
 + skb->
Ën
 - 
ccmp
.
ic_Œa”
;

609 
	`xÜ_block
(
mic
, 
b
, 
ccmp
.
ic_Œa”
);

611 
i
 = 1;

612 
skb
 = 
skb0
;

613 
pos
 = 
skb
->
d©a
 + 
hd¾’
 + 
ccmp
.
ic_h—d”
;

614 
¥aû
 = 
skb
->
Ën
 - (
hd¾’
 + 
ccmp
.
ic_h—d”
);

616 ià(
¥aû
 > 
d©a_Ën
)

617 
¥aû
 = 
d©a_Ën
;

618 
¥aû
 >ğ
AES_BLOCK_LEN
) {

619 
	`CCMP_DECRYPT
(
i
, 
b
, 
b0
, 
pos
, 
a
, 
AES_BLOCK_LEN
);

620 
pos
 +ğ
AES_BLOCK_LEN
;

621 
¥aû
 -ğ
AES_BLOCK_LEN
;

622 
d©a_Ën
 -ğ
AES_BLOCK_LEN
;

623 
i
++;

625 ià(
d©a_Ën
 <= 0)

627 
skb
 = skb->
Ãxt
;

628 ià(
skb
 =ğ
NULL
) {

629 ià(
¥aû
 != 0)

630 
	`CCMP_DECRYPT
(
i
, 
b
, 
b0
, 
pos
, 
a
, 
¥aû
);

633 ià(
¥aû
 != 0) {

634 
ušt8_t
 *
pos_Ãxt
;

635 
u_št
 
¥aû_Ãxt
;

636 
u_št
 
Ën
;

642 
pos_Ãxt
 = 
skb
->
d©a
;

643 
Ën
 = 
	`mš
(
d©a_Ën
, (
size_t
è
AES_BLOCK_LEN
);

644 
¥aû_Ãxt
 = 
Ën
 > 
¥aû
 ?†en - space : 0;

645 
	`KASSERT
(
skb
->
Ën
 >ğ
¥aû_Ãxt
,

647 "skb†’ %u‚“d %u", 
skb
->
Ën
, 
¥aû_Ãxt
));

649 
	`xÜ_block
(
b
+
¥aû
, 
pos_Ãxt
, 
¥aû_Ãxt
);

650 
	`CCMP_DECRYPT
(
i
, 
b
, 
b0
, 
pos
, 
a
, 
¥aû
);

651 
	`xÜ_block
(
pos_Ãxt
, 
b
+
¥aû
, 
¥aû_Ãxt
);

652 
d©a_Ën
 -ğ
Ën
;

653 
i
++;

655 
pos
 = 
pos_Ãxt
 + 
¥aû_Ãxt
;

656 
¥aû
 = 
skb
->
Ën
 - 
¥aû_Ãxt
;

661 
pos
 = 
skb
->
d©a
;

662 
¥aû
 = 
skb
->
Ën
;

666 ià(
	`memcmp
(
mic
, 
a
, 
ccmp
.
ic_Œa”
) != 0) {

667 
	`IEEE80211_NOTE_MAC
(
ùx
->
cc_v­
, 
IEEE80211_MSG_CRYPTO
,

668 
wh
->
i_addr2
,

670 
key
->
wk_keyix
, ()
²
);

671 
ùx
->
cc_v­
->
iv_¡©s
.
is_rx_ccmpmic
++;

675 
	}
}

676 #undeà
CCMP_DECRYPT


682 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

683 
MODULE_DESCRIPTION
("802.11 wireless support: AES-CCM cipher");

684 #ifdeà
MODULE_LICENSE


685 
MODULE_LICENSE
("Dual BSD/GPL");

688 
__š™


689 
	$š™_üy±o_ccmp
()

691 
	`›“80211_üy±o_»gi¡”
(&
ccmp
);

693 
	}
}

694 
moduË_š™
(
š™_üy±o_ccmp
);

696 
__ex™


697 
	$ex™_üy±o_ccmp
()

699 
	`›“80211_üy±o_uÄegi¡”
(&
ccmp
);

700 
	}
}

701 
moduË_ex™
(
ex™_üy±o_ccmp
);

	@ieee80211_crypto_none.c

37 #iâdeà
AUTOCONF_INCLUDED


38 
	~<lšux/cÚfig.h
>

40 
	~<lšux/v”siÚ.h
>

41 
	~<lšux/moduË.h
>

42 
	~<lšux/skbuff.h
>

43 
	~<lšux/Ãtdeviû.h
>

45 
	~"if_medŸ.h
"

47 
	~<Ãt80211/›“80211_v¬.h
>

49 *
nÚe_©ch
(
›“80211v­
 *, 
›“80211_key
 *);

50 
nÚe_d‘ach
(
›“80211_key
 *);

51 
nÚe_£tkey
(
›“80211_key
 *);

52 
nÚe_’ÿp
(
›“80211_key
 *, 
sk_buff
 *, 
u_št8_t
);

53 
nÚe_deÿp
(
›“80211_key
 *, 
sk_buff
 *, );

54 
nÚe_’mic
(
›“80211_key
 *, 
sk_buff
 *, );

55 
nÚe_demic
(
›“80211_key
 *, 
sk_buff
 *, , );

57 cÚ¡ 
›“80211_ch”
 
	g›“80211_ch”_nÚe
 = {

58 .
ic_Çme
 = "NONE",

59 .
	gic_ch”
 = 
IEEE80211_CIPHER_NONE
,

60 .
	gic_h—d”
 = 0,

61 .
	gic_Œa”
 = 0,

62 .
	gic_miş’
 = 0,

63 .
	gic_©ch
 = 
nÚe_©ch
,

64 .
	gic_d‘ach
 = 
nÚe_d‘ach
,

65 .
	gic_£tkey
 = 
nÚe_£tkey
,

66 .
	gic_’ÿp
 = 
nÚe_’ÿp
,

67 .
	gic_deÿp
 = 
nÚe_deÿp
,

68 .
	gic_’mic
 = 
nÚe_’mic
,

69 .
	gic_demic
 = 
nÚe_demic
,

71 
EXPORT_SYMBOL
(
›“80211_ch”_nÚe
);

74 
	$nÚe_©ch
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
)

76  
v­
;

77 
	}
}

80 
	$nÚe_d‘ach
(
›“80211_key
 *
k
)

82 (è
k
;

83 
	}
}

86 
	$nÚe_£tkey
(
›“80211_key
 *
k
)

88 (è
k
;

90 
	}
}

93 
	$nÚe_’ÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
u_št8_t
 
keyid
)

95 
›“80211v­
 *
v­
 = 
k
->
wk_´iv©e
;

96 #ifdeà
IEEE80211_DEBUG


97 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb
->
d©a
;

104 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr1
,

105 "key id %u i nÙ s‘ (’ÿp)", 
keyid
>>6);

106 
v­
->
iv_¡©s
.
is_tx_badch”
++;

108 
	}
}

111 
	$nÚe_deÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
)

113 
›“80211v­
 *
v­
 = 
k
->
wk_´iv©e
;

114 #ifdeà
IEEE80211_DEBUG


115 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb
->
d©a
;

116 cÚ¡ 
u_št8_t
 *
ivp
 = (cÚ¡ u_št8_ˆ*)&
wh
[1];

124 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

125 "key id %u i nÙ s‘ (deÿp)", 
ivp
[
IEEE80211_WEP_IVLEN
] >> 6);

126 
v­
->
iv_¡©s
.
is_rx_badkeyid
++;

128 
	}
}

131 
	$nÚe_’mic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
fÜû_sw
)

133 
›“80211v­
 *
v­
 = 
k
->
wk_´iv©e
;

135 
v­
->
iv_¡©s
.
is_tx_badch”
++;

137 
	}
}

140 
	$nÚe_demic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
, 
fÜû_sw
)

142 
›“80211v­
 *
v­
 = 
k
->
wk_´iv©e
;

144 
v­
->
iv_¡©s
.
is_rx_badkeyid
++;

146 
	}
}

	@ieee80211_crypto_tkip.c

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/š™.h
>

50 
	~"if_medŸ.h
"

52 
	~<Ãt80211/›“80211_v¬.h
>

54 *
tk_©ch
(
›“80211v­
 *, 
›“80211_key
 *);

55 
tk_d‘ach
(
›“80211_key
 *);

56 
tk_£tkey
(
›“80211_key
 *);

57 
tk_’ÿp
(
›“80211_key
 *, 
sk_buff
 *, 
u_št8_t
);

58 
tk_’mic
(
›“80211_key
 *, 
sk_buff
 *, );

59 
tk_deÿp
(
›“80211_key
 *, 
sk_buff
 *, );

60 
tk_demic
(
›“80211_key
 *, 
sk_buff
 *, , );

62 cÚ¡ 
›“80211_ch”
 
	gtk
 = {

63 .
ic_Çme
 = "TKIP",

64 .
	gic_ch”
 = 
IEEE80211_CIPHER_TKIP
,

65 .
	gic_h—d”
 = 
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
 +

66 
IEEE80211_WEP_EXTIVLEN
,

67 .
	gic_Œa”
 = 
IEEE80211_WEP_CRCLEN
,

68 .
	gic_miş’
 = 
IEEE80211_WEP_MICLEN
,

69 .
	gic_©ch
 = 
tk_©ch
,

70 .
	gic_d‘ach
 = 
tk_d‘ach
,

71 .
	gic_£tkey
 = 
tk_£tkey
,

72 .
	gic_’ÿp
 = 
tk_’ÿp
,

73 .
	gic_deÿp
 = 
tk_deÿp
,

74 .
	gic_’mic
 = 
tk_’mic
,

75 .
	gic_demic
 = 
tk_demic
,

78 
	stk_ùx
 {

79 
›“80211v­
 *
	mtc_v­
;

80 
›“80211com
 *
	mtc_ic
;

82 
u16
 
	mtx_‰ak
[5];

83 
	mtx_pha£1_dÚe
;

84 
u8
 
	mtx_rc4key
[16];

86 
u16
 
	mrx_‰ak
[5];

87 
	mrx_pha£1_dÚe
;

88 
u8
 
	mrx_rc4key
[16];

89 
ušt64_t
 
	mrx_rsc
;

92 
mich«l_mic
(
tk_ùx
 *, cÚ¡ 
u8
 *,

93 
sk_buff
 *, 
u_št
, 
size_t
,

94 
u8
 
mic
[
IEEE80211_WEP_MICLEN
]);

95 
tk_’üy±
(
tk_ùx
 *, 
›“80211_key
 *,

96 
sk_buff
 *, );

97 
tk_deüy±
(
tk_ùx
 *, 
›“80211_key
 *,

98 
sk_buff
 *, );

101 
	$tk_©ch
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
)

103 
tk_ùx
 *
ùx
;

105 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

107 
	`MALLOC
(
ùx
, 
tk_ùx
 *, (tkip_ctx),

108 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

109 ià(
ùx
 =ğ
NULL
) {

110 
v­
->
iv_¡©s
.
is_üy±o_nomem
++;

111 
	`_MOD_DEC_USE
(
THIS_MODULE
);

112  
NULL
;

115 
ùx
->
tc_v­
 = 
v­
;

116 
ùx
->
tc_ic
 = 
v­
->
iv_ic
;

117  
ùx
;

118 
	}
}

121 
	$tk_d‘ach
(
›“80211_key
 *
k
)

123 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

125 
	`FREE
(
ùx
, 
M_DEVBUF
);

127 
	`_MOD_DEC_USE
(
THIS_MODULE
);

128 
	}
}

131 
	$tk_£tkey
(
›“80211_key
 *
k
)

133 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

135 ià(
k
->
wk_keyËn
 !ğ(128 / 
NBBY
)) {

136 (è
ùx
;

137 
	`IEEE80211_DPRINTF
(
ùx
->
tc_v­
, 
IEEE80211_MSG_CRYPTO
,

139 
__func__
, 
k
->
wk_keyËn
, 128 / 
NBBY
);

142 
k
->
wk_keytsc
 = 1;

144 
	}
}

150 
	$tk_’ÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
u_št8_t
 
keyid
)

152 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

153 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

154 
›“80211com
 *
ic
 = 
ùx
->
tc_ic
;

155 
u_št8_t
 *
ivp
;

156 
hd¾’
;

161 ià(
v­
->
iv_æags
 & 
IEEE80211_F_COUNTERM
) {

162 #ifdeà
IEEE80211_DEBUG


163 
›“80211_äame
 *
wh
 =

164 (
›“80211_äame
 *)
skb
->
d©a
;

167 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

168 "Disÿrd f¿mdutØcouÁ”m—su» (%s)", 
__func__
);

169 
v­
->
iv_¡©s
.
is_üy±o_tkcm
++;

172 
hd¾’
 = 
	`›“80211_hdr¥aû
(
ic
, 
skb
->
d©a
);

177 
ivp
 = 
	`skb_push
(
skb
, 
tk
.
ic_h—d”
);

178 
	`memmove
(
ivp
, iv°+ 
tk
.
ic_h—d”
, 
hd¾’
);

179 
ivp
 +ğ
hd¾’
;

181 
ivp
[0] = 
k
->
wk_keytsc
 >> 8;

182 
ivp
[1] = (ivp[0] | 0x20) & 0x7f;

183 
ivp
[2] = 
k
->
wk_keytsc
 >> 0;

184 
ivp
[3] = 
keyid
 | 
IEEE80211_WEP_EXTIV
;

185 
ivp
[4] = 
k
->
wk_keytsc
 >> 16;

186 
ivp
[5] = 
k
->
wk_keytsc
 >> 24;

187 
ivp
[6] = 
k
->
wk_keytsc
 >> 32;

188 
ivp
[7] = 
k
->
wk_keytsc
 >> 40;

193 ià(
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) {

194 ià(!
	`tk_’üy±
(
ùx
, 
k
, 
skb
, 
hd¾’
))

198 
k
->
wk_keytsc
++;

201 
	}
}

207 
	$tk_’mic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb0
, 
fÜû_sw
)

209 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

211 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWMIC
è|| 
fÜû_sw
) {

212 
›“80211_äame
 *
wh
 =

213 (
›“80211_äame
 *)
skb0
->
d©a
;

214 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

215 
›“80211com
 *
ic
 = 
ùx
->
tc_ic
;

216 
hd¾’
;

217 
sk_buff
 *
skb
;

218 
size_t
 
d©a_Ën
;

219 
ušt8_t
 
mic
[
IEEE80211_WEP_MICLEN
];

221 
v­
->
iv_¡©s
.
is_üy±o_tk’mic
++;

223 
skb
 = 
skb0
;

224 
d©a_Ën
 = 
skb
->
Ën
;

225 
skb
->
Ãxt
 !ğ
NULL
) {

226 
skb
 = skb->
Ãxt
;

227 
d©a_Ën
 +ğ
skb
->
Ën
;

229 ià(
	`skb_room
(
skb
è< 
tk
.
ic_miş’
) {

231 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

232 
wh
->
i_addr1
,

234 
	`skb_room
(
skb
));

239 
hd¾’
 = 
	`›“80211_hdr¥aû
(
ic
, 
wh
);

240 
	`mich«l_mic
(
ùx
, 
k
->
wk_txmic
,

241 
skb0
, 
hd¾’
, 
d©a_Ën
 - hd¾’, 
mic
);

242 
	`memıy
(
	`skb_put
(
skb
, 
tk
.
ic_miş’
), 
mic
,kip.ic_miclen);

245 
	}
}

247 
__šlše
 
ušt64_t


248 
	$READ_6
(
ušt8_t
 
b0
, ušt8_ˆ
b1
, ušt8_ˆ
b2
, ušt8_ˆ
b3
, ušt8_ˆ
b4
, ušt8_ˆ
b5
)

250 
ušt32_t
 
iv32
 = (
b0
 << 0è| (
b1
 << 8è| (
b2
 << 16è| (
b3
 << 24);

251 
ušt16_t
 
iv16
 = (
b4
 << 0è| (
b5
 << 8);

252  (((
ušt64_t
)
iv16
è<< 32è| 
iv32
;

253 
	}
}

261 
	$tk_deÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
)

263 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

264 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

265 
›“80211_äame
 *
wh
;

266 
ušt8_t
 *
ivp
;

267 
u_št8_t
 
tid
;

273 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

275 
ivp
 = 
skb
->
d©a
 + 
hd¾’
;

276 ià((
ivp
[
IEEE80211_WEP_IVLEN
] & 
IEEE80211_WEP_EXTIV
) == 0) {

280 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

282 
v­
->
iv_¡©s
.
is_rx_tkfÜm©
++;

288 ià(
v­
->
iv_æags
 & 
IEEE80211_F_COUNTERM
) {

289 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

290 "disÿrd f¿mdutØcouÁ”m—su» (%s)", 
__func__
);

291 
v­
->
iv_¡©s
.
is_üy±o_tkcm
++;

295 
tid
 = 0;

296 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
))

297 
tid
 = ((
›“80211_qosäame
 *)
wh
)->
i_qos
[0] & 
IEEE80211_QOS_TID
;

299 
ùx
->
rx_rsc
 = 
	`READ_6
(
ivp
[2], ivp[0], ivp[4], ivp[5], ivp[6], ivp[7]);

300 ià(
ùx
->
rx_rsc
 && ctx->rx_rsø<ğ
k
->
wk_keyrsc
[
tid
]) {

304 
	`›“80211_nÙify_»¶ay_çu»
(
v­
, 
wh
, 
k
, 
ùx
->
rx_rsc
);

305 
v­
->
iv_¡©s
.
is_rx_tk»¶ay
++;

322 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) &&

323 !
	`tk_deüy±
(
ùx
, 
k
, 
skb
, 
hd¾’
))

329 
	`memmove
(
skb
->
d©a
 + 
tk
.
ic_h—d”
, skb->d©a, 
hd¾’
);

330 
	`skb_puÎ
(
skb
, 
tk
.
ic_h—d”
);

331 
skb
->
Ãxt
 !ğ
NULL
)

332 
skb
 = skb->
Ãxt
;

333 
	`skb_Œim
(
skb
, skb->
Ën
 - 
tk
.
ic_Œa”
);

336 
	}
}

342 
	$tk_demic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb0
, 
hd¾’
, 
fÜû_sw
)

344 
tk_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

345 
sk_buff
 *
skb
;

346 
size_t
 
pk’
;

347 
›“80211_äame
 *
wh
 ;

348 
u_št8_t
 
tid
;

350 
skb
 = 
skb0
;

351 
pk’
 = 
skb
->
Ën
;

352 
skb
->
Ãxt
 !ğ
NULL
) {

353 
skb
 = skb->
Ãxt
;

354 
pk’
 +ğ
skb
->
Ën
;

356 
wh
 = (
›“80211_äame
 *)
skb0
->
d©a
;

358 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWMIC
è|| 
fÜû_sw
) {

359 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

360 
u8
 
mic
[
IEEE80211_WEP_MICLEN
];

361 
u8
 
mic0
[
IEEE80211_WEP_MICLEN
];

363 
v­
->
iv_¡©s
.
is_üy±o_tkdemic
++;

365 
	`mich«l_mic
(
ùx
, 
k
->
wk_rxmic
,

366 
skb0
, 
hd¾’
, 
pk’
 - (hd¾’ + 
tk
.
ic_miş’
),

367 
mic
);

369 
	`memıy
(
mic0
, 
skb
->
d©a
 + skb->
Ën
 - 
tk
.
ic_miş’
,

370 
tk
.
ic_miş’
);

371 ià(
	`memcmp
(
mic
, 
mic0
, 
tk
.
ic_miş’
)) {

373 
	`›“80211_nÙify_mich«l_çu»
(
v­
, 
wh
, 
k
->
wk_keyix
);

380 
	`skb_Œim
(
skb
, skb->
Ën
 - 
tk
.
ic_miş’
);

385 
tid
 = 0;

386 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
))

387 
tid
 = ((
›“80211_qosäame
 *)
wh
)->
i_qos
[0] & 
IEEE80211_QOS_TID
;

388 
k
->
wk_keyrsc
[
tid
] = 
ùx
->
rx_rsc
;

391 
	}
}

407 cÚ¡ 
__u32
 
	güc32_bË
[256] = {

462 
__šlše
 
u16


463 
	$RÙR1
(
u16
 
v®
)

465  (
v®
 >> 1) | (val << 15);

466 
	}
}

468 
__šlše
 
u8


469 
	$Lo8
(
u16
 
v®
)

471  
v®
 & 0xff;

472 
	}
}

474 
__šlše
 
u8


475 
	$Hi8
(
u16
 
v®
)

477  
v®
 >> 8;

478 
	}
}

480 
__šlše
 
u16


481 
	$Lo16
(
u32
 
v®
)

483  
v®
 & 0xffff;

484 
	}
}

486 
__šlše
 
u16


487 
	$Hi16
(
u32
 
v®
)

489  
v®
 >> 16;

490 
	}
}

492 
__šlše
 
u16


493 
	$Mk16
(
u8
 
hi
, u8 
lo
)

495  
lo
 | (((
u16
è
hi
) << 8);

496 
	}
}

498 
__šlše
 
u16


499 
	$Mk16_Ë
(cÚ¡ 
__Ë16
 *
v
)

501  
	`Ë16_to_ıu
(*
v
);

502 
	}
}

504 cÚ¡ 
u16
 
	gSbox
[256] = {

539 
__šlše
 
u16


540 
	$_S_
(
u16
 
v
)

542 
u16
 
t
 = 
Sbox
[
	`Hi8
(
v
)];

543  
Sbox
[
	`Lo8
(
v
)] ^ ((
t
 << 8) | (t >> 8));

544 
	}
}

546 
	#PHASE1_LOOP_COUNT
 8

	)

549 
	$tk_mixšg_pha£1
(
u16
 *
TTAK
, cÚ¡ 
u8
 *
TK
, cÚ¡ u8 *
TA
, 
u32
 
IV32
)

551 
i
, 
j
;

554 
TTAK
[0] = 
	`Lo16
(
IV32
);

555 
TTAK
[1] = 
	`Hi16
(
IV32
);

556 
TTAK
[2] = 
	`Mk16
(
TA
[1], TA[0]);

557 
TTAK
[3] = 
	`Mk16
(
TA
[3], TA[2]);

558 
TTAK
[4] = 
	`Mk16
(
TA
[5], TA[4]);

560 
i
 = 0; i < 
PHASE1_LOOP_COUNT
; i++) {

561 
j
 = 2 * (
i
 & 1);

562 
TTAK
[0] +ğ
	`_S_
(TTAK[4] ^ 
	`Mk16
(
TK
[1 + 
j
], TK[0 + j]));

563 
TTAK
[1] +ğ
	`_S_
(TTAK[0] ^ 
	`Mk16
(
TK
[5 + 
j
], TK[4 + j]));

564 
TTAK
[2] +ğ
	`_S_
(TTAK[1] ^ 
	`Mk16
(
TK
[9 + 
j
], TK[8 + j]));

565 
TTAK
[3] +ğ
	`_S_
(TTAK[2] ^ 
	`Mk16
(
TK
[13 + 
j
], TK[12 + j]));

566 
TTAK
[4] +ğ
	`_S_
(TTAK[3] ^ 
	`Mk16
(
TK
[1 + 
j
], TK[0 + j])è+ 
i
;

568 
	}
}

570 #iâdeà
_BYTE_ORDER


575 
	$tk_mixšg_pha£2
(
u8
 *
WEPS“d
, cÚ¡ u8 *
TK
, cÚ¡ 
u16
 *
TTAK
, u16 
IV16
)

579 
u16
 *
PPK
 = (u16 *)&
WEPS“d
[4];

582 
PPK
[0] = 
TTAK
[0];

583 
PPK
[1] = 
TTAK
[1];

584 
PPK
[2] = 
TTAK
[2];

585 
PPK
[3] = 
TTAK
[3];

586 
PPK
[4] = 
TTAK
[4];

587 
PPK
[5] = 
TTAK
[4] + 
IV16
;

590 
PPK
[0] +ğ
	`_S_
(PPK[5] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[0]));

591 
PPK
[1] +ğ
	`_S_
(PPK[0] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[2]));

592 
PPK
[2] +ğ
	`_S_
(PPK[1] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[4]));

593 
PPK
[3] +ğ
	`_S_
(PPK[2] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[6]));

594 
PPK
[4] +ğ
	`_S_
(PPK[3] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[8]));

595 
PPK
[5] +ğ
	`_S_
(PPK[4] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[10]));

597 
PPK
[0] +ğ
	`RÙR1
(PPK[5] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[12]));

598 
PPK
[1] +ğ
	`RÙR1
(PPK[0] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[14]));

599 
PPK
[2] +ğ
	`RÙR1
(PPK[1]);

600 
PPK
[3] +ğ
	`RÙR1
(PPK[2]);

601 
PPK
[4] +ğ
	`RÙR1
(PPK[3]);

602 
PPK
[5] +ğ
	`RÙR1
(PPK[4]);

606 
WEPS“d
[0] = 
	`Hi8
(
IV16
);

607 
WEPS“d
[1] = (
	`Hi8
(
IV16
) | 0x20) & 0x7F;

608 
WEPS“d
[2] = 
	`Lo8
(
IV16
);

609 
WEPS“d
[3] = 
	`Lo8
((
PPK
[5] ^ 
	`Mk16_Ë
((cÚ¡ 
__Ë16
 *)&
TK
[0])) >> 1);

611 #ià
_BYTE_ORDER
 =ğ
_BIG_ENDIAN


613 
i
;

614 
i
 = 0; i < 6; i++)

615 
PPK
[
i
] = (PPK[i] << 8) | (PPK[i] >> 8);

618 
	}
}

621 
	$w•_’üy±
(
u8
 *
key
, 
sk_buff
 *
skb0
, 
u_št
 
off
, 
size_t
 
d©a_Ën
)

623 
	#S_SWAP
(
a
,
b
èdØ{ 
ušt8_t
 
t
 = 
S
[a]; S[a] = S[b]; S[b] =; } 0)

	)

624 
sk_buff
 *
skb
 = 
skb0
;

625 
ušt32_t
 
i
, 
j
, 
k
, 
üc
;

626 
size_t
 
buæ’
;

627 
ušt8_t
 
S
[256];

628 
ušt8_t
 *
pos
, *
icv
;

631 
i
 = 0; i < 256; i++)

632 
S
[
i
] = i;

633 
j
 = 0;

634 
i
 = 0; i < 256; i++) {

635 
j
 = (j + 
S
[
i
] + 
key
[i & 0x0f]) & 0xff;

636 
	`S_SWAP
(
i
, 
j
);

640 
üc
 = ~0;

641 
i
 = 
j
 = 0;

642 
pos
 = 
skb
->
d©a
 + 
off
;

643 
buæ’
 = 
skb
->
Ën
 - 
off
;

645 ià(
buæ’
 > 
d©a_Ën
)

646 
buæ’
 = 
d©a_Ën
;

647 
d©a_Ën
 -ğ
buæ’
;

648 
k
 = 0; k < 
buæ’
; k++) {

649 
üc
 = 
üc32_bË
[(üø^ *
pos
) & 0xff] ^ (crc >> 8);

650 
i
 = (i + 1) & 0xff;

651 
j
 = (j + 
S
[
i
]) & 0xff;

652 
	`S_SWAP
(
i
, 
j
);

653 *
pos
++ ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

655 ià(
skb
->
Ãxt
 =ğ
NULL
) {

656 
	`KASSERT
(
d©a_Ën
 == 0,

657 ("missšg d©a, d©a_ËÀ%u", ()
d©a_Ën
));

660 
skb
 = skb->
Ãxt
;

661 
pos
 = 
skb
->
d©a
;

662 
buæ’
 = 
skb
->
Ën
;

664 
üc
 = ~crc;

666 
icv
 = 
	`skb_put
(
skb
, 
tk
.
ic_Œa”
);

668 
icv
[0] = 
üc
;

669 
icv
[1] = 
üc
 >> 8;

670 
icv
[2] = 
üc
 >> 16;

671 
icv
[3] = 
üc
 >> 24;

672 
k
 = 0; k < 
IEEE80211_WEP_CRCLEN
; k++) {

673 
i
 = (i + 1) & 0xff;

674 
j
 = (j + 
S
[
i
]) & 0xff;

675 
	`S_SWAP
(
i
, 
j
);

676 
icv
[
k
] ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

678 #undeà
S_SWAP


679 
	}
}

682 
	$w•_deüy±
(
u8
 *
key
, 
sk_buff
 *
skb
, 
u_št
 
off
, 
size_t
 
d©a_Ën
)

684 
	#S_SWAP
(
a
,
b
èdØ{ 
ušt8_t
 
t
 = 
S
[a]; S[a] = S[b]; S[b] =; } 0)

	)

685 
u32
 
i
, 
j
, 
k
, 
üc
;

686 
u8
 
S
[256];

687 
u8
 *
pos
, 
icv
[4];

688 
size_t
 
buæ’
;

691 
i
 = 0; i < 256; i++)

692 
S
[
i
] = i;

693 
j
 = 0;

694 
i
 = 0; i < 256; i++) {

695 
j
 = (j + 
S
[
i
] + 
key
[i & 0x0f]) & 0xff;

696 
	`S_SWAP
(
i
, 
j
);

700 
üc
 = ~0;

701 
i
 = 
j
 = 0;

702 
pos
 = 
skb
->
d©a
 + 
off
;

703 
buæ’
 = 
skb
->
Ën
 - 
off
;

705 ià(
buæ’
 > 
d©a_Ën
)

706 
buæ’
 = 
d©a_Ën
;

707 
d©a_Ën
 -ğ
buæ’
;

708 
k
 = 0; k < 
buæ’
; k++) {

709 
i
 = (i + 1) & 0xff;

710 
j
 = (j + 
S
[
i
]) & 0xff;

711 
	`S_SWAP
(
i
, 
j
);

712 *
pos
 ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

713 
üc
 = 
üc32_bË
[(üø^ *
pos
) & 0xff] ^ (crc >> 8);

714 
pos
++;

716 ià(
skb
->
Ãxt
 =ğ
NULL
) {

717 ià(
d©a_Ën
 != 0) {

723 
skb
 = skb->
Ãxt
;

724 
pos
 = 
skb
->
d©a
;

725 
buæ’
 = 
skb
->
Ën
;

727 
üc
 = ~crc;

731 
icv
[0] = 
üc
;

732 
icv
[1] = 
üc
 >> 8;

733 
icv
[2] = 
üc
 >> 16;

734 
icv
[3] = 
üc
 >> 24;

735 
k
 = 0; k < 4; k++) {

736 
i
 = (i + 1) & 0xff;

737 
j
 = (j + 
S
[
i
]) & 0xff;

738 
	`S_SWAP
(
i
, 
j
);

739 ià((
icv
[
k
] ^ 
S
[(S[
i
] + S[
j
]è& 0xff]è!ğ*
pos
++) {

745 #undeà
S_SWAP


746 
	}
}

749 
__šlše
 
u32


750 
	$rÙl
(
u32
 
v®
, 
b™s
)

752  (
v®
 << 
b™s
) | (val >> (32 - bits));

753 
	}
}

756 
__šlše
 
u32


757 
	$rÙr
(
u32
 
v®
, 
b™s
)

759  (
v®
 >> 
b™s
) | (val << (32 - bits));

760 
	}
}

763 
__šlše
 
u32


764 
	$xsw­
(
u32
 
v®
)

766  ((
v®
 & 0x00ff00ff) << 8) | ((val & 0xff00ff00) >> 8);

767 
	}
}

770 
	#mich«l_block
(
l
, 
r
) \

772 
r
 ^ğ
	`rÙl
(
l
, 17); \

773 
l
 +ğ
r
; \

774 
r
 ^ğ
	`xsw­
(
l
); \

775 
l
 +ğ
r
; \

776 
r
 ^ğ
	`rÙl
(
l
, 3); \

777 
l
 +ğ
r
; \

778 
r
 ^ğ
	`rÙr
(
l
, 2); \

779 
l
 +ğ
r
; \

780 } 0)

	)

783 
__šlše
 
u32


784 
	$g‘_Ë32_¥l™
(
u8
 
b0
, u8 
b1
, u8 
b2
, u8 
b3
)

786  
b0
 | (
b1
 << 8è| (
b2
 << 16è| (
b3
 << 24);

787 
	}
}

789 
__šlše
 
u32


790 
	$g‘_Ë32
(cÚ¡ 
u8
 *
p
)

792  
	`g‘_Ë32_¥l™
(
p
[0],…[1],…[2],…[3]);

793 
	}
}

796 
__šlše
 

797 
	$put_Ë32
(
u8
 *
p
, 
u32
 
v
)

799 
p
[0] = 
v
;

800 
p
[1] = 
v
 >> 8;

801 
p
[2] = 
v
 >> 16;

802 
p
[3] = 
v
 >> 24;

803 
	}
}

809 
	$mich«l_mic_hdr
(cÚ¡ 
›“80211_äame
 *
wh0
, 
u8
 
hdr
[16])

811 cÚ¡ 
›“80211_äame_addr4
 *
wh
 =

812 (cÚ¡ 
›“80211_äame_addr4
 *)
wh0
;

814 
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
) {

815 
IEEE80211_FC1_DIR_NODS
:

816 
	`IEEE80211_ADDR_COPY
(
hdr
, 
wh
->
i_addr1
);

817 
	`IEEE80211_ADDR_COPY
(
hdr
 + 
IEEE80211_ADDR_LEN
, 
wh
->
i_addr2
);

819 
IEEE80211_FC1_DIR_TODS
:

820 
	`IEEE80211_ADDR_COPY
(
hdr
, 
wh
->
i_addr3
);

821 
	`IEEE80211_ADDR_COPY
(
hdr
 + 
IEEE80211_ADDR_LEN
, 
wh
->
i_addr2
);

823 
IEEE80211_FC1_DIR_FROMDS
:

824 
	`IEEE80211_ADDR_COPY
(
hdr
, 
wh
->
i_addr1
);

825 
	`IEEE80211_ADDR_COPY
(
hdr
 + 
IEEE80211_ADDR_LEN
, 
wh
->
i_addr3
);

827 
IEEE80211_FC1_DIR_DSTODS
:

828 
	`IEEE80211_ADDR_COPY
(
hdr
, 
wh
->
i_addr3
);

829 
	`IEEE80211_ADDR_COPY
(
hdr
 + 
IEEE80211_ADDR_LEN
, 
wh
->
i_addr4
);

833 ià(
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_QOS
) {

834 cÚ¡ 
›“80211_qosäame
 *
qwh
 =

835 (cÚ¡ 
›“80211_qosäame
 *)
wh
;

836 
hdr
[12] = 
qwh
->
i_qos
[0] & 
IEEE80211_QOS_TID
;

838 
hdr
[12] = 0;

839 
hdr
[13] = hdr[14] = hdr[15] = 0;

840 
	}
}

843 
	$mich«l_mic
(
tk_ùx
 *
ùx
, cÚ¡ 
u8
 *
key
,

844 
sk_buff
 *
skb
, 
u_št
 
off
, 
size_t
 
d©a_Ën
,

845 
u8
 
mic
[
IEEE80211_WEP_MICLEN
])

847 
ušt8_t
 
hdr
[16];

848 
u32
 
l
, 
r
;

849 cÚ¡ 
ušt8_t
 *
d©a
;

850 
u_št
 
¥aû
;

852 
	`mich«l_mic_hdr
((
›“80211_äame
 *)
skb
->
d©a
, 
hdr
);

854 
l
 = 
	`g‘_Ë32
(
key
);

855 
r
 = 
	`g‘_Ë32
(
key
 + 4);

858 
l
 ^ğ
	`g‘_Ë32
(
hdr
);

859 
	`mich«l_block
(
l
, 
r
);

860 
l
 ^ğ
	`g‘_Ë32
(&
hdr
[4]);

861 
	`mich«l_block
(
l
, 
r
);

862 
l
 ^ğ
	`g‘_Ë32
(&
hdr
[8]);

863 
	`mich«l_block
(
l
, 
r
);

864 
l
 ^ğ
	`g‘_Ë32
(&
hdr
[12]);

865 
	`mich«l_block
(
l
, 
r
);

868 
d©a
 = 
skb
->d©¨+ 
off
;

869 
¥aû
 = 
skb
->
Ën
 - 
off
;

871 ià(
¥aû
 > 
d©a_Ën
)

872 
¥aû
 = 
d©a_Ën
;

874 
¥aû
 >ğ(
ušt32_t
)) {

875 
l
 ^ğ
	`g‘_Ë32
(
d©a
);

876 
	`mich«l_block
(
l
, 
r
);

877 
d©a
 +ğ(
ušt32_t
), 
¥aû
 -= (uint32_t);

878 
d©a_Ën
 -ğ(
ušt32_t
);

880 ià(
d©a_Ën
 < (
ušt32_t
))

882 
skb
 = skb->
Ãxt
;

883 ià(
skb
 =ğ
NULL
) {

884 
	`KASSERT
(0, ("out of data, data_len %lu",

885 ()
d©a_Ën
));

888 ià(
¥aû
 != 0) {

889 cÚ¡ 
ušt8_t
 *
d©a_Ãxt
;

893 
d©a_Ãxt
 = 
skb
->
d©a
;

894 
	`KASSERT
(
skb
->
Ën
 >ğ(
ušt32_t
è- 
¥aû
,

896 "skb†’ %u‚“d %u", 
skb
->
Ën
,

897 ()(
ušt32_t
è- 
¥aû
));

898 
¥aû
) {

900 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], 
d©a_Ãxt
[0],

901 
d©a_Ãxt
[1], data_next[2]);

902 
d©a
 = 
d©a_Ãxt
 + 3;

903 
¥aû
 = 
skb
->
Ën
 - 3;

906 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], data[1],

907 
d©a_Ãxt
[0], data_next[1]);

908 
d©a
 = 
d©a_Ãxt
 + 2;

909 
¥aû
 = 
skb
->
Ën
 - 2;

912 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], data[1],

913 
d©a
[2], 
d©a_Ãxt
[0]);

914 
d©a
 = 
d©a_Ãxt
 + 1;

915 
¥aû
 = 
skb
->
Ën
 - 1;

918 
	`mich«l_block
(
l
, 
r
);

919 
d©a_Ën
 -ğ(
ušt32_t
);

924 
d©a
 = 
skb
->data;

925 
¥aû
 = 
skb
->
Ën
;

929 
d©a_Ën
) {

931 
l
 ^ğ
	`g‘_Ë32_¥l™
(0x5a, 0, 0, 0);

934 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], 0x5a, 0, 0);

937 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], data[1], 0x5a, 0);

940 
l
 ^ğ
	`g‘_Ë32_¥l™
(
d©a
[0], data[1], data[2], 0x5a);

943 
	`mich«l_block
(
l
, 
r
);

945 
	`mich«l_block
(
l
, 
r
);

947 
	`put_Ë32
(
mic
, 
l
);

948 
	`put_Ë32
(
mic
 + 4, 
r
);

949 
	}
}

952 
	$tk_’üy±
(
tk_ùx
 *
ùx
, 
›“80211_key
 *
key
,

953 
sk_buff
 *
skb0
, 
hd¾’
)

955 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb0
->
d©a
;

956 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

957 
sk_buff
 *
skb
;

958 
size_t
 
pk’
;

960 
v­
->
iv_¡©s
.
is_üy±o_tk
++;

962 
skb
 = 
skb0
;

963 
pk’
 = 
skb
->
Ën
;

964 
skb
->
Ãxt
 !ğ
NULL
) {

965 
skb
 = skb->
Ãxt
;

966 
pk’
 +ğ
skb
->
Ën
;

968 ià(
	`skb_room
(
skb
è< 
tk
.
ic_Œa”
) {

970 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

971 
wh
->
i_addr1
, "No„oom for TKIP CRC,ailroom %u",

972 
	`skb_room
(
skb
));

977 ià(!
ùx
->
tx_pha£1_dÚe
) {

978 
	`tk_mixšg_pha£1
(
ùx
->
tx_‰ak
, 
key
->
wk_key
, 
wh
->
i_addr2
,

979 (
u32
)(
key
->
wk_keytsc
 >> 16));

980 
ùx
->
tx_pha£1_dÚe
 = 1;

982 
	`tk_mixšg_pha£2
(
ùx
->
tx_rc4key
, 
key
->
wk_key
, ctx->
tx_‰ak
,

983 (
u16
è
key
->
wk_keytsc
);

985 
	`w•_’üy±
(
ùx
->
tx_rc4key
,

986 
skb0
, 
hd¾’
 + 
tk
.
ic_h—d”
,

987 
pk’
 - (
hd¾’
 + 
tk
.
ic_h—d”
));

989 
key
->
wk_keytsc
++;

990 ià((
u16
)(
key
->
wk_keytsc
) == 0)

991 
ùx
->
tx_pha£1_dÚe
 = 0;

993 
	}
}

996 
	$tk_deüy±
(
tk_ùx
 *
ùx
, 
›“80211_key
 *
key
,

997 
sk_buff
 *
skb0
, 
hd¾’
)

999 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb0
->
d©a
;

1000 
›“80211v­
 *
v­
 = 
ùx
->
tc_v­
;

1001 
sk_buff
 *
skb
;

1002 
size_t
 
pk’
;

1003 
u32
 
iv32
;

1004 
u16
 
iv16
;

1005 
u_št8_t
 
tid
;

1007 
v­
->
iv_¡©s
.
is_üy±o_tk
++;

1009 
skb
 = 
skb0
;

1010 
pk’
 = 
skb
->
Ën
;

1011 
skb
->
Ãxt
 !ğ
NULL
) {

1012 
skb
 = skb->
Ãxt
;

1013 
pk’
 +ğ
skb
->
Ën
;

1016 
iv16
 = (
u16
è
ùx
->
rx_rsc
;

1017 
iv32
 = (
u32
è(
ùx
->
rx_rsc
 >> 16);

1019 
wh
 = (
›“80211_äame
 *)
skb0
->
d©a
;

1020 
tid
 = 0;

1021 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
))

1022 
tid
 = ((
›“80211_qosäame
 *)
wh
)->
i_qos
[0] & 
IEEE80211_QOS_TID
;

1023 ià(
iv32
 !ğ(
u32
)(
key
->
wk_keyrsc
[
tid
] >> 16è|| !
ùx
->
rx_pha£1_dÚe
) {

1024 
	`tk_mixšg_pha£1
(
ùx
->
rx_‰ak
, 
key
->
wk_key
,

1025 
wh
->
i_addr2
, 
iv32
);

1026 
ùx
->
rx_pha£1_dÚe
 = 1;

1028 
	`tk_mixšg_pha£2
(
ùx
->
rx_rc4key
, 
key
->
wk_key
, ctx->
rx_‰ak
, 
iv16
);

1031 ià(
	`w•_deüy±
(
ùx
->
rx_rc4key
,

1032 
skb0
, 
hd¾’
 + 
tk
.
ic_h—d”
,

1033 
pk’
 - (
hd¾’
 + 
tk
.
ic_h—d”
 +k.
ic_Œa”
))) {

1034 ià(
iv32
 !ğ(
u32
)(
key
->
wk_keyrsc
[
tid
] >> 16)) {

1037 
ùx
->
rx_pha£1_dÚe
 = 0;

1039 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_CRYPTO
,

1040 "[" 
MAC_FMT
 "] TKIP ICV mismatch on decrypt (keyix %d,„sc %llu)\n",

1041 
	`MAC_ADDR
(
wh
->
i_addr2
), 
key
->
wk_keyix
,

1042 ()
ùx
->
rx_rsc
);

1043 
v­
->
iv_¡©s
.
is_rx_tkicv
++;

1047 
	}
}

1052 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

1053 
MODULE_DESCRIPTION
("802.11 wireless support: TKIP cipher");

1054 #ifdeà
MODULE_LICENSE


1055 
MODULE_LICENSE
("Dual BSD/GPL");

1058 
__š™


1059 
	$š™_üy±o_tk
()

1061 
	`›“80211_üy±o_»gi¡”
(&
tk
);

1063 
	}
}

1064 
moduË_š™
(
š™_üy±o_tk
);

1066 
__ex™


1067 
	$ex™_üy±o_tk
()

1069 
	`›“80211_üy±o_uÄegi¡”
(&
tk
);

1070 
	}
}

1071 
moduË_ex™
(
ex™_üy±o_tk
);

	@ieee80211_crypto_wep.c

37 #iâdeà
AUTOCONF_INCLUDED


38 
	~<lšux/cÚfig.h
>

40 
	~<lšux/v”siÚ.h
>

41 
	~<lšux/moduË.h
>

42 
	~<lšux/skbuff.h
>

43 
	~<lšux/Ãtdeviû.h
>

44 
	~<lšux/¿ndom.h
>

45 
	~<lšux/š™.h
>

47 
	~"if_medŸ.h
"

49 
	~<Ãt80211/›“80211_v¬.h
>

51 *
w•_©ch
(
›“80211v­
 *, 
›“80211_key
 *);

52 
w•_d‘ach
(
›“80211_key
 *);

53 
w•_£tkey
(
›“80211_key
 *);

54 
w•_’ÿp
(
›“80211_key
 *, 
sk_buff
 *, 
u_št8_t
);

55 
w•_deÿp
(
›“80211_key
 *, 
sk_buff
 *, );

56 
w•_’mic
(
›“80211_key
 *, 
sk_buff
 *, );

57 
w•_demic
(
›“80211_key
 *, 
sk_buff
 *, , );

59 cÚ¡ 
›“80211_ch”
 
	gw•
 = {

60 .
ic_Çme
 = "WEP",

61 .
	gic_ch”
 = 
IEEE80211_CIPHER_WEP
,

62 .
	gic_h—d”
 = 
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
,

63 .
	gic_Œa”
 = 
IEEE80211_WEP_CRCLEN
,

64 .
	gic_miş’
 = 0,

65 .
	gic_©ch
 = 
w•_©ch
,

66 .
	gic_d‘ach
 = 
w•_d‘ach
,

67 .
	gic_£tkey
 = 
w•_£tkey
,

68 .
	gic_’ÿp
 = 
w•_’ÿp
,

69 .
	gic_deÿp
 = 
w•_deÿp
,

70 .
	gic_’mic
 = 
w•_’mic
,

71 .
	gic_demic
 = 
w•_demic
,

74 
w•_’üy±
(
›“80211_key
 *, 
sk_buff
 *, );

75 
w•_deüy±
(
›“80211_key
 *, 
sk_buff
 *, );

77 
	sw•_ùx
 {

78 
›“80211v­
 *
	mwc_v­
;

79 
›“80211com
 *
	mwc_ic
;

80 
u_št32_t
 
	mwc_iv
;

84 
	$w•_©ch
(
›“80211v­
 *
v­
, 
›“80211_key
 *
k
)

86 
w•_ùx
 *
ùx
;

88 
	`_MOD_INC_USE
(
THIS_MODULE
,  
NULL
);

90 
	`MALLOC
(
ùx
, 
w•_ùx
 *, (wep_ctx),

91 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

92 ià(
ùx
 =ğ
NULL
) {

93 
v­
->
iv_¡©s
.
is_üy±o_nomem
++;

94 
	`_MOD_DEC_USE
(
THIS_MODULE
);

95  
NULL
;

98 
ùx
->
wc_v­
 = 
v­
;

99 
ùx
->
wc_ic
 = 
v­
->
iv_ic
;

100 
	`g‘_¿ndom_by‹s
(&
ùx
->
wc_iv
, (ctx->wc_iv));

101  
ùx
;

102 
	}
}

105 
	$w•_d‘ach
(
›“80211_key
 *
k
)

107 
w•_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

109 
	`FREE
(
ùx
, 
M_DEVBUF
);

111 
	`_MOD_DEC_USE
(
THIS_MODULE
);

112 
	}
}

115 
	$w•_£tkey
(
›“80211_key
 *
k
)

117  
k
->
wk_keyËn
 >ğ40 / 
NBBY
;

118 
	}
}

120 #iâdeà
_BYTE_ORDER


128 
	$w•_’ÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
u_št8_t
 
keyid
)

130 
w•_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

131 
›“80211com
 *
ic
 = 
ùx
->
wc_ic
;

132 
u_št32_t
 
iv
;

133 
u_št8_t
 *
ivp
;

134 
hd¾’
;

136 
hd¾’
 = 
	`›“80211_hdr¥aû
(
ic
, 
skb
->
d©a
);

141 
ivp
 = 
	`skb_push
(
skb
, 
w•
.
ic_h—d”
);

142 
	`memmove
(
ivp
, iv°+ 
w•
.
ic_h—d”
, 
hd¾’
);

143 
ivp
 +ğ
hd¾’
;

164 
iv
 = 
ùx
->
wc_iv
;

165 ià((
iv
 & 0xff00) == 0xff00) {

166 
B
 = (
iv
 & 0xff0000) >> 16;

167 ià(3 <ğ
B
 && B < 16)

168 
iv
 += 0x0100;

170 
ùx
->
wc_iv
 = 
iv
 + 1;

176 #ià
_BYTE_ORDER
 =ğ
_BIG_ENDIAN


177 
ivp
[0] = 
iv
 >> 0;

178 
ivp
[1] = 
iv
 >> 8;

179 
ivp
[2] = 
iv
 >> 16;

181 
ivp
[2] = 
iv
 >> 0;

182 
ivp
[1] = 
iv
 >> 8;

183 
ivp
[0] = 
iv
 >> 16;

185 
ivp
[3] = 
keyid
;

190 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) &&

191 !
	`w•_’üy±
(
k
, 
skb
, 
hd¾’
))

195 
	}
}

201 
	$w•_’mic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
fÜû_sw
)

204 
	}
}

212 
	$w•_deÿp
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
)

214 
w•_ùx
 *
ùx
 = 
k
->
wk_´iv©e
;

215 
›“80211v­
 *
v­
 = 
ùx
->
wc_v­
;

216 
›“80211_äame
 *
wh
;

218 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

225 ià((
k
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
) &&

226 !
	`w•_deüy±
(
k
, 
skb
, 
hd¾’
)) {

227 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

229 
v­
->
iv_¡©s
.
is_rx_w•ç
++;

236 
	`memmove
(
skb
->
d©a
 + 
w•
.
ic_h—d”
, skb->d©a, 
hd¾’
);

237 
	`skb_puÎ
(
skb
, 
w•
.
ic_h—d”
);

238 
	`skb_Œim
(
skb
, skb->
Ën
 - 
w•
.
ic_Œa”
);

241 
	}
}

247 
	$w•_demic
(
›“80211_key
 *
k
, 
sk_buff
 *
skb
, 
hd¾’
, 
fÜû_sw
)

250 
	}
}

252 cÚ¡ 
ušt32_t
 
	güc32_bË
[256] = {

308 
	$w•_’üy±
(
›“80211_key
 *
key
, 
sk_buff
 *
skb0
, 
hd¾’
)

310 
	#S_SWAP
(
a
,
b
èdØ{ 
ušt8_t
 
t
 = 
S
[a]; S[a] = S[b]; S[b] =; } 0)

	)

311 
w•_ùx
 *
ùx
 = 
key
->
wk_´iv©e
;

312 
›“80211v­
 *
v­
 = 
ùx
->
wc_v­
;

313 
sk_buff
 *
skb
 = 
skb0
;

314 
u_št8_t
 
rc4key
[
IEEE80211_WEP_IVLEN
 + 
IEEE80211_KEYBUF_SIZE
];

315 
ušt8_t
 *
icv
;

316 
ušt32_t
 
i
, 
j
, 
k
, 
üc
;

317 
size_t
 
buæ’
, 
d©a_Ën
;

318 
ušt8_t
 
S
[256];

319 
ušt8_t
 *
pos
;

320 
u_št
 
off
, 
keyËn
;

322 
v­
->
iv_¡©s
.
is_üy±o_w•
++;

325 
	`memıy
(
rc4key
, 
skb
->
d©a
 + 
hd¾’
, 
IEEE80211_WEP_IVLEN
);

326 
	`memıy
(
rc4key
 + 
IEEE80211_WEP_IVLEN
, 
key
->
wk_key
, key->
wk_keyËn
);

329 
i
 = 0; i < 256; i++)

330 
S
[
i
] = i;

331 
j
 = 0;

332 
keyËn
 = 
key
->
wk_keyËn
 + 
IEEE80211_WEP_IVLEN
;

333 
i
 = 0; i < 256; i++) {

334 
j
 = (j + 
S
[
i
] + 
rc4key
[˜% 
keyËn
]) & 0xff;

335 
	`S_SWAP
(
i
, 
j
);

338 
off
 = 
hd¾’
 + 
w•
.
ic_h—d”
;

339 
d©a_Ën
 = 
skb
->
Ën
 - 
off
;

342 
üc
 = ~0;

343 
i
 = 
j
 = 0;

344 
pos
 = 
skb
->
d©a
 + 
off
;

345 
buæ’
 = 
skb
->
Ën
 - 
off
;

347 ià(
buæ’
 > 
d©a_Ën
)

348 
buæ’
 = 
d©a_Ën
;

349 
d©a_Ën
 -ğ
buæ’
;

350 
k
 = 0; k < 
buæ’
; k++) {

351 
üc
 = 
üc32_bË
[(üø^ *
pos
) & 0xff] ^ (crc >> 8);

352 
i
 = (i + 1) & 0xff;

353 
j
 = (j + 
S
[
i
]) & 0xff;

354 
	`S_SWAP
(
i
, 
j
);

355 *
pos
++ ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

357 ià(
skb
->
Ãxt
 =ğ
NULL
) {

358 ià(
d©a_Ën
 != 0) {

359 #ifdeà
IEEE80211_DEBUG


360 cÚ¡ 
›“80211_äame
 *
wh
 =

361 (cÚ¡ 
›“80211_äame
 *)
skb0
->
d©a
;

363 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

364 
wh
->
i_addr2
,

366 (è
d©a_Ën
);

371 
skb
 = skb->
Ãxt
;

372 
pos
 = 
skb
->
d©a
;

373 
buæ’
 = 
skb
->
Ën
;

375 
üc
 = ~crc;

377 ià(
	`skb_room
(
skb
è< 
w•
.
ic_Œa”
) {

378 #ifdeà
IEEE80211_DEBUG


379 cÚ¡ 
›“80211_äame
 *
wh
 =

380 (cÚ¡ 
›“80211_äame
 *)
skb0
->
d©a
;

383 
	`IEEE80211_NOTE_MAC
(
ùx
->
wc_v­
, 
IEEE80211_MSG_CRYPTO
,

384 
wh
->
i_addr1
, "no„oom for %s ICV,ailroom %u",

385 
w•
.
ic_Çme
, 
	`skb_room
(
skb
));

390 
icv
 = 
	`skb_put
(
skb
, 
IEEE80211_WEP_CRCLEN
);

391 
icv
[0] = 
üc
;

392 
icv
[1] = 
üc
 >> 8;

393 
icv
[2] = 
üc
 >> 16;

394 
icv
[3] = 
üc
 >> 24;

395 
k
 = 0; k < 
IEEE80211_WEP_CRCLEN
; k++) {

396 
i
 = (i + 1) & 0xff;

397 
j
 = (j + 
S
[
i
]) & 0xff;

398 
	`S_SWAP
(
i
, 
j
);

399 
icv
[
k
] ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

402 #undeà
S_SWAP


403 
	}
}

406 
	$w•_deüy±
(
›“80211_key
 *
key
, 
sk_buff
 *
skb0
, 
hd¾’
)

408 
	#S_SWAP
(
a
,
b
èdØ{ 
ušt8_t
 
t
 = 
S
[a]; S[a] = S[b]; S[b] =; } 0)

	)

409 
w•_ùx
 *
ùx
 = 
key
->
wk_´iv©e
;

410 
›“80211v­
 *
v­
 = 
ùx
->
wc_v­
;

411 
sk_buff
 *
skb
 = 
skb0
;

412 
u_št8_t
 
rc4key
[
IEEE80211_WEP_IVLEN
 + 
IEEE80211_KEYBUF_SIZE
];

413 
ušt8_t
 
icv
[
IEEE80211_WEP_CRCLEN
];

414 
ušt32_t
 
i
, 
j
, 
k
, 
üc
;

415 
size_t
 
buæ’
, 
d©a_Ën
;

416 
ušt8_t
 
S
[256];

417 
ušt8_t
 *
pos
;

418 
u_št
 
off
, 
keyËn
;

420 
v­
->
iv_¡©s
.
is_üy±o_w•
++;

423 
	`memıy
(
rc4key
, 
skb
->
d©a
 + 
hd¾’
, 
IEEE80211_WEP_IVLEN
);

424 
	`memıy
(
rc4key
 + 
IEEE80211_WEP_IVLEN
, 
key
->
wk_key
, key->
wk_keyËn
);

427 
i
 = 0; i < 256; i++)

428 
S
[
i
] = i;

429 
j
 = 0;

430 
keyËn
 = 
key
->
wk_keyËn
 + 
IEEE80211_WEP_IVLEN
;

431 
i
 = 0; i < 256; i++) {

432 
j
 = (j + 
S
[
i
] + 
rc4key
[˜% 
keyËn
]) & 0xff;

433 
	`S_SWAP
(
i
, 
j
);

436 
off
 = 
hd¾’
 + 
w•
.
ic_h—d”
;

437 
d©a_Ën
 = 
skb
->
Ën
 - (
off
 + 
w•
.
ic_Œa”
),

440 
üc
 = ~0;

441 
i
 = 
j
 = 0;

442 
pos
 = 
skb
->
d©a
 + 
off
;

443 
buæ’
 = 
skb
->
Ën
 - 
off
;

445 ià(
buæ’
 > 
d©a_Ën
)

446 
buæ’
 = 
d©a_Ën
;

447 
d©a_Ën
 -ğ
buæ’
;

448 
k
 = 0; k < 
buæ’
; k++) {

449 
i
 = (i + 1) & 0xff;

450 
j
 = (j + 
S
[
i
]) & 0xff;

451 
	`S_SWAP
(
i
, 
j
);

452 *
pos
 ^ğ
S
[(S[
i
] + S[
j
]) & 0xff];

453 
üc
 = 
üc32_bË
[(üø^ *
pos
) & 0xff] ^ (crc >> 8);

454 
pos
++;

456 
skb
 = skb->
Ãxt
;

457 ià(
skb
 =ğ
NULL
) {

458 ià(
d©a_Ën
 != 0) {

459 #ifdeà
IEEE80211_DEBUG


460 cÚ¡ 
›“80211_äame
 *
wh
 =

461 (cÚ¡ 
›“80211_äame
 *)
skb0
->
d©a
;

463 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

464 
wh
->
i_addr2
,

466 (è
d©a_Ën
);

471 
pos
 = 
skb
->
d©a
;

472 
buæ’
 = 
skb
->
Ën
;

474 
üc
 = ~crc;

478 
icv
[0] = 
üc
;

479 
icv
[1] = 
üc
 >> 8;

480 
icv
[2] = 
üc
 >> 16;

481 
icv
[3] = 
üc
 >> 24;

482 
k
 = 0; k < 
IEEE80211_WEP_CRCLEN
; k++) {

483 
i
 = (i + 1) & 0xff;

484 
j
 = (j + 
S
[
i
]) & 0xff;

485 
	`S_SWAP
(
i
, 
j
);

487 ià((
icv
[
k
] ^ 
S
[(S[
i
] + S[
j
]è& 0xff]è!ğ*
pos
++) {

493 #undeà
S_SWAP


494 
	}
}

500 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

501 
MODULE_DESCRIPTION
("802.11 wireless support: WEP cipher");

502 #ifdeà
MODULE_LICENSE


503 
MODULE_LICENSE
("Dual BSD/GPL");

506 
__š™


507 
	$š™_üy±o_w•
()

509 
	`›“80211_üy±o_»gi¡”
(&
w•
);

511 
	}
}

512 
moduË_š™
(
š™_üy±o_w•
);

514 
__ex™


515 
	$ex™_üy±o_w•
()

517 
	`›“80211_üy±o_uÄegi¡”
(&
w•
);

518 
	}
}

519 
moduË_ex™
(
ex™_üy±o_w•
);

	@ieee80211_debug.h

34 #iâdeà
_NET80211_IEEE80211_DEBUG_H_


35 
	#_NET80211_IEEE80211_DEBUG_H_


	)

37 
	~<Ãt80211/›“80211_v¬.h
>

38 
	~<Ãt80211/›“80211.h
>

41 
©h_debug_glob®
;

43 
	mGLOBAL_DEBUG_SKB_REF
 = 0x00000040,

44 
	mGLOBAL_DEBUG_SKB
 = 0x40000000,

48 
	#IEEE80211_MSG_NODE_REF
 0x80000000

	)

49 
	#IEEE80211_MSG_DEBUG
 0x40000000

	)

50 
	#IEEE80211_MSG_DUMPPKTS
 0x20000000

	)

51 
	#IEEE80211_MSG_CRYPTO
 0x10000000

	)

52 
	#IEEE80211_MSG_INPUT
 0x08000000

	)

53 
	#IEEE80211_MSG_XRATE
 0x04000000

	)

54 
	#IEEE80211_MSG_ELEMID
 0x02000000

	)

55 
	#IEEE80211_MSG_NODE
 0x01000000

	)

56 
	#IEEE80211_MSG_ASSOC
 0x00800000

	)

57 
	#IEEE80211_MSG_AUTH
 0x00400000

	)

58 
	#IEEE80211_MSG_SCAN
 0x00200000

	)

59 
	#IEEE80211_MSG_OUTPUT
 0x00100000

	)

60 
	#IEEE80211_MSG_STATE
 0x00080000

	)

61 
	#IEEE80211_MSG_POWER
 0x00040000

	)

62 
	#IEEE80211_MSG_DOT1X
 0x00020000

	)

63 
	#IEEE80211_MSG_DOT1XSM
 0x00010000

	)

64 
	#IEEE80211_MSG_RADIUS
 0x00008000

	)

65 
	#IEEE80211_MSG_RADDUMP
 0x00004000

	)

66 
	#IEEE80211_MSG_RADKEYS
 0x00002000

	)

67 
	#IEEE80211_MSG_WPA
 0x00001000

	)

68 
	#IEEE80211_MSG_ACL
 0x00000800

	)

69 
	#IEEE80211_MSG_WME
 0x00000400

	)

70 
	#IEEE80211_MSG_SUPG
 0x00000200

	)

71 
	#IEEE80211_MSG_DOTH
 0x00000100

	)

72 
	#IEEE80211_MSG_INACT
 0x00000080

	)

73 
	#IEEE80211_MSG_ROAM
 0x00000040

	)

75 
	#IEEE80211_MSG_ANY
 0xfffffffà

	)

77 
	#IEEE80211_MSG_IC
 (
IEEE80211_MSG_NODE_REF
è

	)

79 #ifdeà
IEEE80211_DEBUG


80 
	#›“80211_msg_is_»pÜ‹d
(
_v­
, 
m
) \

81 (!!(((
_v­
)->
iv_debug
 | (_v­)->
iv_ic
->
ic_debug
è& (
m
)))

	)

82 
	#IEEE80211_DPRINTF
(
_v­
, 
_m
, 
_fmt
, ...) do { \

83 ià(
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
_m
)) \

84 
	`›“80211_nÙe
(
_v­
, 
_fmt
, 
__VA_ARGS__
); \

85 } 0)

	)

86 
	#IEEE80211_NOTE
(
_v­
, 
_m
, 
_ni
, 
_fmt
, ...) do { \

87 ià(
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
_m
)) \

88 
	`›“80211_nÙe_mac
(
_v­
, (
_ni
)->
ni_maÿddr
, 
_fmt
, 
__VA_ARGS__
);\

89 } 0)

	)

90 
	#IEEE80211_NOTE_MAC
(
_v­
, 
_m
, 
_mac
, 
_fmt
, ...) do { \

91 ià(
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
_m
)) \

92 
	`›“80211_nÙe_mac
(
_v­
, 
_mac
, 
_fmt
, 
__VA_ARGS__
); \

93 } 0)

	)

94 
	#IEEE80211_NOTE_FRAME
(
_v­
, 
_m
, 
_wh
, 
_fmt
, ...) do { \

95 ià(
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
_m
)) \

96 
	`›“80211_nÙe_äame
(
_v­
, 
_wh
, 
_fmt
, 
__VA_ARGS__
); \

97 } 0)

	)

98 
	g›“80211v­
;

99 
	g›“80211_äame
;

100 
›“80211_nÙe
(
›“80211v­
 *, const *, ...);

101 
›“80211_nÙe_mac
(
›“80211v­
 *,

102 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
], const *, ...);

103 
›“80211_nÙe_äame
(
›“80211v­
 *,

104 cÚ¡ 
›“80211_äame
 *, const *, ...);

105 
	#›“80211_msg_debug
(
_v­
) \

106 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_DEBUG
)

	)

107 
	#›“80211_msg_dumµkts
(
_v­
) \

108 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_DUMPPKTS
)

	)

109 
	#›“80211_msg_šput
(
_v­
) \

110 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_INPUT
)

	)

111 
	#›“80211_msg_¿dius
(
_v­
) \

112 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_RADIUS
)

	)

113 
	#›“80211_msg_dum´adius
(
_v­
) \

114 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_RADDUMP
)

	)

115 
	#›“80211_msg_dum´adkeys
(
_v­
) \

116 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_RADKEYS
)

	)

117 
	#›“80211_msg_sÿn
(
_v­
) \

118 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_SCAN
)

	)

119 
	#›“80211_msg_assoc
(
_v­
) \

120 
	`›“80211_msg_is_»pÜ‹d
(
_v­
, 
IEEE80211_MSG_ASSOC
)

	)

122 
	#›“80211_msg_is_»pÜ‹d
(
_v­
, 
_m
è(0)

	)

123 
	#IEEE80211_DPRINTF
(
_v­
, 
_m
, 
_fmt
, ...)

	)

124 
	#IEEE80211_NOTE
(
_v­
, 
_m
, 
_wh
, 
_fmt
, ...)

	)

125 
	#IEEE80211_NOTE_FRAME
(
_v­
, 
_m
, 
_wh
, 
_fmt
, ...)

	)

126 
	#IEEE80211_NOTE_MAC
(
_v­
, 
_m
, 
_mac
, 
_fmt
, ...)

	)

	@ieee80211_input.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/‘h”deviû.h
>

49 
	~<lšux/¿ndom.h
>

50 
	~<lšux/if_vÏn.h
>

51 
	~<Ãt/iw_hªdËr.h
>

52 
	~<lšux/wœ–ess.h
>

53 
	~<lšux/if_¬p.h
>

55 
	~<Ãt80211/if_Îc.h
>

56 
	~<Ãt80211/if_‘h”subr.h
>

57 
	~<Ãt80211/if_medŸ.h
>

58 
	~<Ãt80211/if_©h´Ùo.h
>

60 
	~<Ãt80211/›“80211_v¬.h
>

62 #ifdeà
IEEE80211_DEBUG


64 
	#BUF_LEN
 192

	)

71 
__šlše
 

72 
	$dİršt
(
›“80211v­
 *
v­
, 
subty³
)

74 
subty³
) {

75 
IEEE80211_FC0_SUBTYPE_BEACON
:

76  (
v­
->
iv_ic
->
ic_æags
 & 
IEEE80211_F_SCAN
);

77 
IEEE80211_FC0_SUBTYPE_PROBE_REQ
:

78  (
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
);

81 
	}
}

89 
	#IEEE80211_DISCARD
(
_v­
, 
_m
, 
_wh
, 
_ty³
, 
_fmt
, ...) do { \

90 ià((
_v­
)->
iv_debug
 & (
_m
)) \

91 
	`›“80211_disÿrd_äame
(
_v­
, 
_wh
, 
_ty³
, 
_fmt
, 
__VA_ARGS__
);\

92 } 0)

	)

93 
	#IEEE80211_DISCARD_IE
(
_v­
, 
_m
, 
_wh
, 
_ty³
, 
_fmt
, ...) do { \

94 ià((
_v­
)->
iv_debug
 & (
_m
)) \

95 
	`›“80211_disÿrd_›
(
_v­
, 
_wh
, 
_ty³
, 
_fmt
, 
__VA_ARGS__
);\

96 } 0)

	)

97 
	#IEEE80211_DISCARD_MAC
(
_v­
, 
_m
, 
_mac
, 
_ty³
, 
_fmt
, ...) do { \

98 ià((
_v­
)->
iv_debug
 & (
_m
)) \

99 
	`›“80211_disÿrd_mac
(
_v­
, 
_mac
, 
_ty³
, 
_fmt
, 
__VA_ARGS__
);\

100 } 0)

	)

102 cÚ¡ 
u_št8_t
 *
›“80211_g‘bssid
(
›“80211v­
 *,

103 cÚ¡ 
›“80211_äame
 *);

104 
›“80211_disÿrd_äame
(
›“80211v­
 *,

105 cÚ¡ 
›“80211_äame
 *, const *, const *, ...);

106 
›“80211_disÿrd_›
(
›“80211v­
 *,

107 cÚ¡ 
›“80211_äame
 *, const *, const *, ...);

108 
›“80211_disÿrd_mac
(
›“80211v­
 *,

109 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
], const *,

112 
	#IEEE80211_DISCARD
(
_v­
, 
_m
, 
_wh
, 
_ty³
, 
_fmt
, ...)

	)

113 
	#IEEE80211_DISCARD_IE
(
_v­
, 
_m
, 
_wh
, 
_ty³
, 
_fmt
, ...)

	)

114 
	#IEEE80211_DISCARD_MAC
(
_v­
, 
_m
, 
_mac
, 
_ty³
, 
_fmt
, ...)

	)

117 
sk_buff
 *
›“80211_deäag
(
›“80211_node
 *,

118 
sk_buff
 *, );

119 
›“80211_d–iv”_d©a
(
›“80211_node
 *, 
sk_buff
 *);

120 
sk_buff
 *
›“80211_deÿp
(
›“80211v­
 *,

121 
sk_buff
 *, );

122 
›“80211_£nd_”rÜ
(
›“80211_node
 *, cÚ¡ 
u_št8_t
 *,

124 
›“80211_»cv_p¥Şl
(
›“80211_node
 *, 
sk_buff
 *);

125 
acû±_d©a_äame
(
›“80211v­
 *, 
›“80211_node
 *,

126 
›“80211_key
 *, 
sk_buff
 *, 
‘h”_h—d”
 *);

129 #ifdeà
ATH_SUPERG_FF


130 
©hff_deÿp
(
sk_buff
 *);

132 #ifdeà
USE_HEADERLEN_RESV


133 
__be16
 
©h_‘h_ty³_Œªs
(
sk_buff
 *, 
Ãt_deviû
 *);

136 #ià
WIRELESS_EXT
 >= 16

147 
	$iw¥y_ev’t
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
, 
u_št
 
rssi
)

149 ià(
v­
->
iv_¥y
.
thr_low
 && v­->iv_¥y.
num
 && 
ni
 && (
rssi
 <

150 
v­
->
iv_¥y
.
thr_low
 || 
rssi
 > v­->iv_¥y.
thr_high
)) {

151 
i
;

152 
i
 = 0; i < 
v­
->
iv_¥y
.
num
; i++) {

153 ià(
	`IEEE80211_ADDR_EQ
(
ni
->
ni_maÿddr
,

154 &(
v­
->
iv_¥y
.
mac
[
i
 * 
IEEE80211_ADDR_LEN
]))) {

156 
iw»q_d©a
 
wrq
;

157 
iw_thr¥y
 
thr
;

158 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
,

159 "%s: w¥y " 
MAC_FMT


162 
__func__
, 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

163 
	`mem£t
(&
wrq
, 0, (wrq));

164 
wrq
.
d©a
.
Ëngth
 = 1;

165 
	`mem£t
(&
thr
, 0, (
iw_thr¥y
));

166 
	`memıy
(
thr
.
addr
.
§_d©a
, 
ni
->
ni_maÿddr
,

167 
IEEE80211_ADDR_LEN
);

168 
thr
.
addr
.
§_çmy
 = 
ARPHRD_ETHER
;

169 
	`£t_qu®™y
(&
thr
.
qu®
, 
rssi
, 
v­
->
iv_ic
->
ic_chªnoi£
);

170 
	`£t_qu®™y
(&
thr
.
low
, 
v­
->
iv_¥y
.
thr_low
, v­->
iv_ic
->
ic_chªnoi£
);

171 
	`£t_qu®™y
(&
thr
.
high
, 
v­
->
iv_¥y
.
thr_high
, v­->
iv_ic
->
ic_chªnoi£
);

172 
	`wœ–ess_£nd_ev’t
(
v­
->
iv_dev
,

173 
SIOCGIWTHRSPY
, &
wrq
, (*)&
thr
);

178 
	}
}

181 
	#iw¥y_ev’t
(
_v­
, 
_ni
, 
_rssi
)

	)

197 
	$›“80211_šput
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni_Ü_nuÎ
,

198 
sk_buff
 *
skb
, 
rssi
, 
u_št64_t
 
¹sf
)

200 
	#HAS_SEQ
(
ty³
è(Ñy³ & 0x4è=ğ0)

	)

201 
›“80211_node
 *
ni
 = 
ni_Ü_nuÎ
;

202 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

203 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

204 
›“80211_äame
 *
wh
;

205 
›“80211_key
 *
key
;

206 
‘h”_h—d”
 *
eh
;

207 #ifdeà
ATH_SUPERG_FF


208 
Îc
 *llc;

210 
hd¾’
;

211 
u_št8_t
 
dœ
, 
ty³
 = -1, 
subty³
;

212 
u_št8_t
 *
bssid
;

213 
u_št16_t
 
rx£q
;

215 ià((
v­
->
iv_dev
->
æags
 & (
IFF_RUNNING
 | 
IFF_UP
)) !=

216 (
IFF_RUNNING
 | 
IFF_UP
))

217 
out
;

220 ià(
ni_Ü_nuÎ
 =ğ
NULL
) {

224 
ni
 = 
	`›“80211_»f_node
(
v­
->
iv_bss
);

226 
	`KASSERT
(
skb
 !ğ
NULL
, ("null skb"));

227 
	`KASSERT
(
ni
 !ğ
NULL
, ("null‚ode"));

228 
ni
->
ni_šaù
 =‚i->
ni_šaù_»lßd
;

233 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
)

234 
out
;

235 ià(
skb
->
Ën
 < (
›“80211_äame_mš
)) {

236 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_ANY
,

237 
ni
->
ni_maÿddr
, 
NULL
,

238 "toØshÜˆ(1):†’ %u", 
skb
->
Ën
);

239 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

240 
out
;

247 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

249 ià((
wh
->
i_fc
[0] & 
IEEE80211_FC0_VERSION_MASK
) !=

250 
IEEE80211_FC0_VERSION_0
) {

251 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_ANY
,

252 
ni
->
ni_maÿddr
, 
NULL
, "wrÚg v”siÚ %x", 
wh
->
i_fc
[0]);

253 
v­
->
iv_¡©s
.
is_rx_badv”siÚ
++;

254 
”r
;

257 
dœ
 = 
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
;

258 
ty³
 = 
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
;

259 
subty³
 = 
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
;

260 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0) {

261 
v­
->
iv_İmode
) {

262 
IEEE80211_M_STA
:

263 
bssid
 = 
wh
->
i_addr2
;

264 ià(!
	`IEEE80211_ADDR_EQ
(
bssid
, 
v­
->
iv_bssid
)) {

266 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

267 
bssid
, 
NULL
, "%s", "noto bss");

268 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
++;

269 
out
;

271 
	`iw¥y_ev’t
(
v­
, 
ni
, 
rssi
);

273 
IEEE80211_M_IBSS
:

274 
IEEE80211_M_AHDEMO
:

275 ià(
dœ
 !ğ
IEEE80211_FC1_DIR_NODS
)

276 
bssid
 = 
wh
->
i_addr1
;

277 ià(
ty³
 =ğ
IEEE80211_FC0_TYPE_CTL
)

278 
bssid
 = 
wh
->
i_addr1
;

280 ià(
skb
->
Ën
 < (
›“80211_äame
)) {

281 
	`IEEE80211_DISCARD_MAC
(
v­
,

282 
IEEE80211_MSG_ANY
, 
ni
->
ni_maÿddr
,

283 
NULL
, "too short (2):†en %u",

284 
skb
->
Ën
);

285 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

286 
out
;

288 
bssid
 = 
wh
->
i_addr3
;

291 ià(
ty³
 =ğ
IEEE80211_FC0_TYPE_DATA
 && 
ni
 =ğ
v­
->
iv_bss
 &&

292 !
	`IEEE80211_ADDR_EQ
(
v­
->
iv_bss
->
ni_maÿddr
, 
wh
->
i_addr2
)) {

294 
ni
 = 
	`›“80211_fšd_node
(
v­
->
iv_bss
->
ni_bË
, 
wh
->
i_addr2
);

295 ià(
ni
 =ğ
NULL
) {

301 
ni
 = 
	`›“80211_çkeup_adhoc_node
(
v­
,

302 
wh
->
i_addr2
);

303 ià(
ni
 =ğ
NULL
) {

305 
”r
;

309 
	`iw¥y_ev’t
(
v­
, 
ni
, 
rssi
);

311 
IEEE80211_M_HOSTAP
:

312 ià(
dœ
 !ğ
IEEE80211_FC1_DIR_NODS
)

313 
bssid
 = 
wh
->
i_addr1
;

314 ià(
ty³
 =ğ
IEEE80211_FC0_TYPE_CTL
)

315 
bssid
 = 
wh
->
i_addr1
;

317 ià(
skb
->
Ën
 < (
›“80211_äame
)) {

318 
	`IEEE80211_DISCARD_MAC
(
v­
,

319 
IEEE80211_MSG_ANY
, 
ni
->
ni_maÿddr
,

320 
NULL
, "too short (2):†en %u",

321 
skb
->
Ën
);

322 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

323 
out
;

325 
bssid
 = 
wh
->
i_addr3
;

330 #ifdeà
ATH_SUPERG_XR


331 ià(!
	`IEEE80211_ADDR_EQ
(
bssid
, 
v­
->
iv_bssid
) &&

332 !
	`IEEE80211_ADDR_EQ
(
bssid
, 
dev
->
brßdÿ¡
)) {

338 ià(!(
v­
->
iv_xrv­
 &&

339 
	`IEEE80211_ADDR_EQ
(
bssid
, 
v­
->
iv_xrv­
->
iv_bssid
) &&

340 
ty³
 =ğ
IEEE80211_FC0_TYPE_MGT
 &&

341 
ni
 !ğ
v­
->
iv_bss
)) {

343 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

344 
bssid
, 
NULL
, "%s", "noto bss or xrbss");

345 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
++;

346 
out
;

350 ià(!
	`IEEE80211_ADDR_EQ
(
bssid
, 
v­
->
iv_bssid
) &&

351 !
	`IEEE80211_ADDR_EQ
(
bssid
, 
dev
->
brßdÿ¡
)) {

353 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

354 
bssid
, 
NULL
, "%s", "noto bss");

355 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
++;

356 
out
;

361 
IEEE80211_M_WDS
:

362 ià(
skb
->
Ën
 < (
›“80211_äame_addr4
)) {

363 
	`IEEE80211_DISCARD_MAC
(
v­
,

364 
IEEE80211_MSG_ANY
, 
ni
->
ni_maÿddr
,

365 
NULL
, "too short (3):†en %u",

366 
skb
->
Ën
);

367 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

368 
out
;

370 
bssid
 = 
wh
->
i_addr1
;

371 ià(!
	`IEEE80211_ADDR_EQ
(
bssid
, 
v­
->
iv_bssid
) &&

372 !
	`IEEE80211_ADDR_EQ
(
bssid
, 
dev
->
brßdÿ¡
)) {

374 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

375 
bssid
, 
NULL
, "%s", "noto bss");

376 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
++;

377 
out
;

379 ià(!
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr2
, 
v­
->
wds_mac
)) {

381 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

382 
wh
->
i_addr2
, 
NULL
, "%s", "not from DS");

383 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
++;

384 
out
;

389 
out
;

395 ià(
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr2
, 
ni
->
ni_maÿddr
)) {

396 
ni
->
ni_rssi
 = 
rssi
;

397 
ni
->
ni_¹sf
 = 
¹sf
;

398 
ni
->
ni_Ï¡_rx
 = 
jiff›s
;

400 ià(
	`HAS_SEQ
(
ty³
)) {

401 
u_št8_t
 
tid
;

402 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
)) {

403 
tid
 = ((
›“80211_qosäame
 *)
wh
)->

404 
i_qos
[0] & 
IEEE80211_QOS_TID
;

405 ià(
	`TID_TO_WME_AC
(
tid
è>ğ
WME_AC_VI
)

406 
ic
->
ic_wme
.
wme_hri_Œaffic
++;

407 
tid
++;

409 
tid
 = 0;

410 
rx£q
 = 
	`Ë16toh
(*(
__Ë16
 *)
wh
->
i_£q
);

411 ià((
wh
->
i_fc
[1] & 
IEEE80211_FC1_RETRY
) &&

412 
	`IEEE80211_SEQ_LEQ
(
rx£q
, 
ni
->
ni_rx£qs
[
tid
])) {

414 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

415 
bssid
, "duplicate",

417 
rx£q
 >> 
IEEE80211_SEQ_SEQ_SHIFT
,

418 
ni
->
ni_rx£qs
[
tid
] >>

419 
IEEE80211_SEQ_SEQ_SHIFT
,

420 
rx£q
 & 
IEEE80211_SEQ_FRAG_MASK
,

421 
ni
->
ni_rx£qs
[
tid
] &

422 
IEEE80211_SEQ_FRAG_MASK
,

423 
tid
);

424 
v­
->
iv_¡©s
.
is_rx_dup
++;

425 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_dup
);

426 
out
;

428 
ni
->
ni_rx£qs
[
tid
] = 
rx£q
;

432 
ty³
) {

433 
IEEE80211_FC0_TYPE_DATA
:

434 
hd¾’
 = 
	`›“80211_hdrsize
(
wh
);

435 ià(
skb
->
Ën
 < 
hd¾’
) {

436 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

437 
wh
, "data", "too short:†en %u,ƒxpecting %u",

438 
skb
->
Ën
, 
hd¾’
);

439 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

440 
out
;

442 
v­
->
iv_İmode
) {

443 
IEEE80211_M_STA
:

444 ià((
dœ
 !ğ
IEEE80211_FC1_DIR_FROMDS
) &&

445 (!((
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_WDS
) &&

446 (
dœ
 =ğ
IEEE80211_FC1_DIR_DSTODS
)))) {

447 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

448 
wh
, "d©a", "šv®id dœ 0x%x", 
dœ
);

449 
v­
->
iv_¡©s
.
is_rx_wrÚgdœ
++;

450 
out
;

453 ià(
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
)) {

455 ià((0 !ğ
	`memcmp
(
wh
->
i_addr3
, 
dev
->
brßdÿ¡
, 
ETH_ALEN
)) &&

456 (0 =ğ(
dev
->
æags
 & 
IFF_MULTICAST
))) {

457 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

458 
wh
, 
NULL
, "%s", "multicast disabled.");

459 
	`´štk
(
KERN_ERR
 "CONFIG ERROR: multicast flag "

461 
v­
->
iv_¡©s
.
is_rx_mÿ¡di§bËd
++;

462 
out
;

465 ià(
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr3
, 
v­
->
iv_myaddr
)) {

476 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

477 
wh
, 
NULL
, "%s", "multicastƒcho");

478 
v­
->
iv_¡©s
.
is_rx_mÿ¡echo
++;

479 
out
;

485 ià(
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_WDS
) {

486 
›“80211_node_bË
 *
Á
;

487 
›“80211_node
 *
ni_wds
;

488 
Á
 = &
ic
->
ic_¡a
;

489 
ni_wds
 = 
	`›“80211_fšd_wds_node
(
Á
, 
wh
->
i_addr3
);

490 ià(
ni_wds
) {

491 
	`›“80211_uÄef_node
(&
ni_wds
);

492 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

493 
wh
, 
NULL
, "%s",

495 
v­
->
iv_¡©s
.
is_rx_mÿ¡echo
++;

496 
out
;

501 
IEEE80211_M_IBSS
:

502 
IEEE80211_M_AHDEMO
:

503 ià(
dœ
 !ğ
IEEE80211_FC1_DIR_NODS
) {

504 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

505 
wh
, "d©a", "šv®id dœ 0x%x", 
dœ
);

506 
v­
->
iv_¡©s
.
is_rx_wrÚgdœ
++;

507 
out
;

511 
IEEE80211_M_HOSTAP
:

512 ià((
dœ
 !ğ
IEEE80211_FC1_DIR_TODS
) &&

513 (
dœ
 !ğ
IEEE80211_FC1_DIR_DSTODS
)) {

514 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

515 
wh
, "d©a", "šv®id dœ 0x%x", 
dœ
);

516 
v­
->
iv_¡©s
.
is_rx_wrÚgdœ
++;

517 
out
;

520 ià(
ni
 =ğ
v­
->
iv_bss
) {

521 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

522 
wh
, "data", "%s", "unknown src");

524 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
)

525 
	`›“80211_£nd_”rÜ
(
ni
, 
wh
->
i_addr2
,

526 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

527 
IEEE80211_REASON_NOT_AUTHED
);

528 
v­
->
iv_¡©s
.
is_rx_nÙassoc
++;

529 
”r
;

531 ià(
ni
->
ni_associd
 == 0) {

532 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

533 
wh
, "data", "%s", "unassoc src");

534 
	`IEEE80211_SEND_MGMT
(
ni
,

535 
IEEE80211_FC0_SUBTYPE_DISASSOC
,

536 
IEEE80211_REASON_NOT_ASSOCED
);

537 
v­
->
iv_¡©s
.
is_rx_nÙassoc
++;

538 
”r
;

546 ià(
dœ
 =ğ
IEEE80211_FC1_DIR_DSTODS
) {

547 
›“80211_node_bË
 *
Á
;

548 
›“80211_äame_addr4
 *
wh4
;

549 
›“80211_node
 *
ni_wds
;

551 ià(!(
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_WDS
)) {

552 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

553 
wh
, "data", "%s", "4‡ddr‚ot‡llowed");

554 
”r
;

556 
wh4
 = (
›“80211_äame_addr4
 *)
skb
->
d©a
;

557 
Á
 = &
ic
->
ic_¡a
;

558 
ni_wds
 = 
	`›“80211_fšd_wds_node
(
Á
, 
wh4
->
i_addr4
);

560 ià((
ni_wds
 !ğ
NULL
è&& (ni_wd !ğ
ni
)) {

567 (è
	`›“80211_»move_wds_addr
(
Á
, 
wh4
->
i_addr4
);

568 
	`›“80211_add_wds_addr
(
Á
, 
ni
, 
wh4
->
i_addr4
, 0);

570 ià(
ni_wds
 =ğ
NULL
)

571 
	`›“80211_add_wds_addr
(
Á
, 
ni
, 
wh4
->
i_addr4
, 0);

573 
	`›“80211_uÄef_node
(&
ni_wds
);

579 ià(!(
ni
->
ni_æags
 & 
IEEE80211_NODE_UAPSD
)) {

580 ià((
wh
->
i_fc
[1] & 
IEEE80211_FC1_PWR_MGT
) ^

581 (
ni
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
))

582 
	`›“80211_node_pwr§ve
(
ni
, 
wh
->
i_fc
[1] & 
IEEE80211_FC1_PWR_MGT
);

583 } ià(
ni
->
ni_æags
 & 
IEEE80211_NODE_PS_CHANGED
) {

584 
pwr_§ve_chªged
 = 0;

585 
	`IEEE80211_LOCK_IRQ
(
ic
);

586 ià((*(
__Ë16
 *)(&
wh
->
i_£q
[0])è=ğ
ni
->
ni_pschªge£q
) {

587 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_PS_CHANGED
;

588 
pwr_§ve_chªged
 = 1;

590 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

591 ià(
pwr_§ve_chªged
)

592 
	`›“80211_node_pwr§ve
(
ni
, 
wh
->
i_fc
[1] & 
IEEE80211_FC1_PWR_MGT
);

595 
IEEE80211_M_WDS
:

596 ià(
dœ
 !ğ
IEEE80211_FC1_DIR_DSTODS
) {

597 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

598 
wh
, "d©a", "šv®id dœ 0x%x", 
dœ
);

599 
v­
->
iv_¡©s
.
is_rx_wrÚgdœ
++;

600 
out
;

605 
out
;

609 ià((
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_NULL
) ||

610 (
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_QOS_NULL
))

611 
out
;

621 ià(
wh
->
i_fc
[1] & 
IEEE80211_FC1_PROT
) {

622 ià((
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0) {

626 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

627 
wh
, "WEP", "%s", "PRIVACY off");

628 
v­
->
iv_¡©s
.
is_rx_nİrivacy
++;

629 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_nİrivacy
);

630 
out
;

632 
key
 = 
	`›“80211_üy±o_deÿp
(
ni
, 
skb
, 
hd¾’
);

633 ià(
key
 =ğ
NULL
) {

635 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_w•ç
);

636 
out
;

638 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

639 
wh
->
i_fc
[1] &ğ~
IEEE80211_FC1_PROT
;

641 
key
 = 
NULL
;

644 ià(!
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
)) {

645 
skb
 = 
	`›“80211_deäag
(
ni
, skb, 
hd¾’
);

646 ià(
skb
 =ğ
NULL
) {

648 
out
;

651 
wh
 = 
NULL
;

654 ià(
key
 !ğ
NULL
 &&

655 !
	`›“80211_üy±o_demic
(
v­
, 
key
, 
skb
, 
hd¾’
, 0)) {

656 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

657 
ni
->
ni_maÿddr
, "data", "%s", "demicƒrror");

658 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_demicç
);

659 
out
;

663 
skb
 = 
	`›“80211_deÿp
(
v­
, skb, 
hd¾’
);

664 ià(
skb
 =ğ
NULL
) {

665 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

666 
ni
->
ni_maÿddr
, "data", "%s", "decapƒrror");

667 
v­
->
iv_¡©s
.
is_rx_deÿp
++;

668 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_deÿp
);

669 
”r
;

671 
eh
 = (
‘h”_h—d”
 *)
skb
->
d©a
;

673 ià(!
	`acû±_d©a_äame
(
v­
, 
ni
, 
key
, 
skb
, 
eh
))

674 
out
;

676 
v­
->
iv_dev¡©s
.
rx_·ck‘s
++;

677 
v­
->
iv_dev¡©s
.
rx_by‹s
 +ğ
skb
->
Ën
;

678 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_d©a
);

679 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
rx_by‹s
, 
skb
->
Ën
);

680 
ic
->
ic_Ï¡d©a
 = 
jiff›s
;

682 #ifdeà
ATH_SUPERG_FF


684 
Îc
 = (Îø*)(
skb
->
d©a
 + (
‘h”_h—d”
));

685 ià(
	`Áohs
(
Îc
->
Îc_¢­
.
‘h”_ty³
è=ğ(
u_št16_t
)
ATH_ETH_TYPE
) {

686 
sk_buff
 *
skb1
 = 
NULL
;

687 
‘h”_h—d”
 *
eh_tmp
;

688 
©hl2p_tuÂ–_hdr
 *
©h_hdr
;

689 
äame_Ën
;

694 
©h_hdr
 = (
©hl2p_tuÂ–_hdr
 *)

695 
	`skb_puÎ
(
skb
, (
‘h”_h—d”
è+ 
LLC_SNAPFRAMELEN
);

697 ià(
©h_hdr
 =ğ
NULL
)

698 
”r
;

701 ià(
©h_hdr
->
´Ùo
 !ğ
ATH_L2TUNNEL_PROTO_FF
) {

702 
	`IEEE80211_DISCARD_MAC
(
v­
,

703 
IEEE80211_MSG_SUPG
 | 
IEEE80211_MSG_INPUT
,

704 
eh
->
‘h”_sho¡
, "fast-frame",

706 
©h_hdr
->
´Ùo
);

707 
v­
->
iv_¡©s
.
is_rx_bad©hŠl
++;

708 
”r
;

710 
v­
->
iv_¡©s
.
is_rx_ffút
++;

713 
	`skb_puÎ
(
skb
, 
	`roundup
((
©hl2p_tuÂ–_hdr
) - 2, 4) + 2);

714 
eh_tmp
 = (
‘h”_h—d”
 *)
skb
->
d©a
;

717 
äame_Ën
 = 
	`Áohs
(
eh_tmp
->
‘h”_ty³
);

719 
skb1
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

720 ià(
skb1
 =ğ
NULL
)

721 
”r
;

722 
	`›“80211_skb_cİy_nod”ef
(
skb
, 
skb1
);

726 
	`©hff_deÿp
(
skb
);

729 
	`skb_Œim
(
skb
, (
‘h”_h—d”
è+ 
äame_Ën
 - 
LLC_SNAPFRAMELEN
);

732 
	`skb_puÎ
(
skb1
, 
	`roundup
((
‘h”_h—d”
è+ 
äame_Ën
, 4));

735 ià(
	`©hff_deÿp
(
skb1
)) {

736 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

737 
ni
->
ni_maÿddr
, "data", "%s", "Decapsulationƒrror");

738 
v­
->
iv_¡©s
.
is_rx_deÿp
++;

739 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_deÿp
);

740 
	`›“80211_dev_kä“_skb
(&
skb1
);

741 
”r
;

745 
	`›“80211_d–iv”_d©a
(
ni
, 
skb
);

746 
	`›“80211_d–iv”_d©a
(
ni
, 
skb1
);

749 
	`›“80211_d–iv”_d©a
(
ni
, 
skb
);

752 
	`›“80211_d–iv”_d©a
(
ni
, 
skb
);

754 ià(
ni_Ü_nuÎ
 =ğ
NULL
)

755 
	`›“80211_uÄef_node
(&
ni
);

760  
IEEE80211_FC0_TYPE_DATA
;

761 
IEEE80211_FC0_TYPE_MGT
:

763 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) {

764 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

765 
out
;

767 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_mgmt
);

768 ià(
dœ
 !ğ
IEEE80211_FC1_DIR_NODS
) {

769 
v­
->
iv_¡©s
.
is_rx_wrÚgdœ
++;

770 
”r
;

772 ià(
skb
->
Ën
 < (
›“80211_äame
)) {

773 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_ANY
,

774 
ni
->
ni_maÿddr
, "mgt", "too short:†en %u",

775 
skb
->
Ën
);

776 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

777 
out
;

779 #ifdeà
IEEE80211_DEBUG


780 ià((
	`›“80211_msg_debug
(
v­
è&& 
	`dİršt
(v­, 
subty³
)) ||

781 
	`›“80211_msg_dumµkts
(
v­
)) {

782 
	`›“80211_nÙe
(
v­
,

783 "»ûived % äom " 
MAC_FMT
 "„ssi %d\n",

784 
›“80211_mgt_subty³_Çme
[
subty³
 >>

785 
IEEE80211_FC0_SUBTYPE_SHIFT
],

786 
	`MAC_ADDR
(
wh
->
i_addr2
), 
rssi
);

789 ià(
wh
->
i_fc
[1] & 
IEEE80211_FC1_PROT
) {

790 ià(
subty³
 !ğ
IEEE80211_FC0_SUBTYPE_AUTH
) {

795 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

796 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

797 
IEEE80211_FC0_SUBTYPE_SHIFT
],

799 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

800 
out
;

802 ià((
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0) {

806 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

807 
wh
, "mgt", "%s", "WEP set but PRIVACY off");

808 
v­
->
iv_¡©s
.
is_rx_nİrivacy
++;

809 
out
;

811 
hd¾’
 = 
	`›“80211_hdrsize
(
wh
);

812 
key
 = 
	`›“80211_üy±o_deÿp
(
ni
, 
skb
, 
hd¾’
);

813 ià(
key
 =ğ
NULL
) {

815 
out
;

817 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

818 
wh
->
i_fc
[1] &ğ~
IEEE80211_FC1_PROT
;

820 
ic
->
	`ic_»cv_mgmt
(
v­
, 
ni_Ü_nuÎ
, 
skb
, 
subty³
, 
rssi
, 
¹sf
);

821 
out
;

823 
IEEE80211_FC0_TYPE_CTL
:

824 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_ù¾
);

825 
v­
->
iv_¡©s
.
is_rx_ùl
++;

826 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

827 ià(
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_PS_POLL
)

828 
	`›“80211_»cv_p¥Şl
(
ni
, 
skb
);

829 
out
;

832 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

833 
wh
, 
NULL
, "bad f¿mty³ 0x%x", 
ty³
);

837 
”r
:

838 
v­
->
iv_dev¡©s
.
rx_”rÜs
++;

839 
out
:

840 
	`›“80211_dev_kä“_skb
(&
skb
);

841 ià(
ni_Ü_nuÎ
 =ğ
NULL
)

842 
	`›“80211_uÄef_node
(&
ni
);

843  
ty³
;

844 #undeà
HAS_SEQ


845 
	}
}

847 
EXPORT_SYMBOL
(
›“80211_šput
);

852 
	$›“80211_šput_®l
(
›“80211com
 *
ic
,

853 
sk_buff
 *
skb
, 
rssi
, 
u_št64_t
 
¹sf
)

855 
›“80211v­
 *
v­
, *
Ãxt_v­
;

856 
sk_buff
 *
tskb
 = 
NULL
;

857 
ty³
 = -1;

861 
v­
 = 
	`TAILQ_FIRST
(&
ic
->
ic_v­s
);

862 
v­
) {

863 
Ãxt_v­
 = 
	`TAILQ_NEXT
(
v­
, 
iv_Ãxt
);‚ext_vap;

864 
Ãxt_v­
 = 
	`TAILQ_NEXT
Òext_v­, 
iv_Ãxt
)) {

865 ià((
Ãxt_v­
->
iv_dev
->
æags
 & (
IFF_RUNNING
 | 
IFF_UP
))

866 =ğ(
IFF_RUNNING
 | 
IFF_UP
))

870 ià(!
Ãxt_v­
) {

871 
tskb
 = 
skb
;

872 
skb
 = 
NULL
;

874 
tskb
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

876 ià(!
tskb
)

878 
v­
->
iv_dev¡©s
.
tx_drİ³d
++;

880 
ty³
 = 
	`›“80211_šput
(
v­
, 
NULL
, 
tskb
, 
rssi
, 
¹sf
);

882 
v­
 = 
Ãxt_v­
;

885 
	`›“80211_dev_kä“_skb
(&
skb
);

886  
ty³
;

887 
	}
}

888 
EXPORT_SYMBOL
(
›“80211_šput_®l
);

894 
	$acû±_d©a_äame
(
›“80211v­
 *
v­
,

895 
›“80211_node
 *
ni
, 
›“80211_key
 *
key
,

896 
sk_buff
 *
skb
, 
‘h”_h—d”
 *
eh
)

898 
	#IS_EAPOL
(
eh
è(Óh)->
‘h”_ty³
 =ğ
	`__cÚ¡ªt_htÚs
(
ETHERTYPE_PAE
))

	)

899 
	#PAIRWISE_SET
(
v­
è((v­)->
iv_nw_keys
[0].
wk_ch”
 !ğ&
›“80211_ch”_nÚe
)

	)

900 ià(
	`IS_EAPOL
(
eh
)) {

902 ià(
key
)

905 ià(!
	`PAIRWISE_SET
(
v­
))

908 ià(!
	`IEEE80211_VAP_DROPUNENC_EAPOL
(
v­
))

911 ià(!(
v­
->
iv_æags
 & 
IEEE80211_F_DROPUNENC
))

914 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

915 
eh
->
‘h”_sho¡
, "data",

917 
	`Áohs
(
eh
->
‘h”_ty³
), 
skb
->
Ën
);

918 
v­
->
iv_¡©s
.
is_rx_uÇuth
++;

919 
v­
->
iv_dev¡©s
.
rx_”rÜs
++;

920 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_uÇuth
);

924 ià(!
	`›“80211_node_is_authÜized
(
ni
)) {

933 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

934 
eh
->
‘h”_sho¡
, "data",

936 
	`Áohs
(
eh
->
‘h”_ty³
), 
skb
->
Ën
);

937 
v­
->
iv_¡©s
.
is_rx_uÇuth
++;

938 
v­
->
iv_dev¡©s
.
rx_”rÜs
++;

939 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_uÇuth
);

946 ià((
v­
->
iv_æags
 & 
IEEE80211_F_DROPUNENC
è&& 
key
 =ğ
NULL
) {

947 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_uÃnüy±ed
);

953 #undeà
IS_EAPOL


954 #undeà
PAIRWISE_SET


955 
	}
}

966 
sk_buff
 *

967 
	$›“80211_deäag
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
, 
hd¾’
)

969 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb
->
d©a
;

970 
u_št16_t
 
rx£q
, 
Ï¡_rx£q
;

971 
u_št8_t
 
äagno
, 
Ï¡_äagno
;

972 
u_št8_t
 
mÜe_äag
 = 
wh
->
i_fc
[1] & 
IEEE80211_FC1_MORE_FRAG
;

974 
rx£q
 = 
	`Ë16_to_ıu
(*(
__Ë16
 *)
wh
->
i_£q
è>> 
IEEE80211_SEQ_SEQ_SHIFT
;

975 
äagno
 = 
	`Ë16_to_ıu
(*(
__Ë16
 *)
wh
->
i_£q
è& 
IEEE80211_SEQ_FRAG_MASK
;

978 ià(!
mÜe_äag
 && 
äagno
 =ğ0 && 
ni
->
ni_rxäag
 =ğ
NULL
)

979  
skb
;

984 ià(
ni
->
ni_bË
 =ğ
NULL
) {

994 
	`›“80211_dev_kä“_skb
(&
skb
);

995  
NULL
;

1005 
ni
->
ni_rxäag¡amp
 = 
jiff›s
;

1011 ià(
ni
->
ni_rxäag
) {

1012 
›“80211_äame
 *
lwh
;

1014 
lwh
 = (
›“80211_äame
 *)
ni
->
ni_rxäag
->
d©a
;

1015 
Ï¡_rx£q
 = 
	`Ë16_to_ıu
(*(
__Ë16
 *)
lwh
->
i_£q
) >>

1016 
IEEE80211_SEQ_SEQ_SHIFT
;

1017 
Ï¡_äagno
 = 
	`Ë16_to_ıu
(*(
__Ë16
 *)
lwh
->
i_£q
) &

1018 
IEEE80211_SEQ_FRAG_MASK
;

1019 ià(
rx£q
 !ğ
Ï¡_rx£q


1020 || 
äagno
 !ğ
Ï¡_äagno
 + 1

1021 || (!
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr1
, 
lwh
->i_addr1))

1022 || (!
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr2
, 
lwh
->i_addr2))

1023 || (
ni
->
ni_rxäag
->
’d
 -‚i->ni_rxäag->

 <

1024 
skb
->
Ën
)) {

1029 
	`›“80211_dev_kä“_skb
(&
ni
->
ni_rxäag
);

1034 ià(
ni
->
ni_rxäag
 =ğ
NULL
 && 
äagno
 == 0) {

1035 
ni
->
ni_rxäag
 = 
skb
;

1037 ià(
mÜe_äag
) {

1038 ià(
	`skb_is_nÚlš—r
(
skb
)) {

1043 
ni
->
ni_rxäag
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

1044 ià(
ni
->
ni_rxäag
) {

1045 
	`›“80211_skb_cİy_nod”ef
(
skb
, 
ni
->
ni_rxäag
);

1046 
	`›“80211_dev_kä“_skb
(&
skb
);

1054 ià((
	`skb_’d_poš‹r
(
skb
è- skb->
h—d
) <

1055 (
ni
->
ni_v­
->
iv_dev
->
mtu
 + 
hd¾’
)) {

1056 
ni
->
ni_rxäag
 = 
	`skb_cİy_ex·nd
(
skb
, 0,

1057 (
ni
->
ni_v­
->
iv_dev
->
mtu
 + 
hd¾’
) -

1058 (
	`skb_’d_poš‹r
(
skb
è- skb->
h—d
),

1059 
GFP_ATOMIC
);

1060 ià(
ni
->
ni_rxäag
)

1061 
	`›“80211_skb_cİy_nod”ef
(
skb
, 
ni
->
ni_rxäag
);

1062 
	`›“80211_dev_kä“_skb
(&
skb
);

1066 ià(
ni
->
ni_rxäag
) {

1067 
›“80211_äame
 *
lwh
 = (ieee80211_frame *)

1068 
ni
->
ni_rxäag
->
d©a
;

1075 
	`memıy
(
	`skb__poš‹r
(
ni
->
ni_rxäag
),

1076 
skb
->
d©a
 + 
hd¾’
, skb->
Ën
 - hdrlen);

1078 
	`skb_put
(
ni
->
ni_rxäag
, 
skb
->
Ën
 - 
hd¾’
);

1080 *(
__Ë16
 *)
lwh
->
i_£q
 = *(__Ë16 *)
wh
->i_seq;

1083 
	`›“80211_dev_kä“_skb
(&
skb
);

1086 ià(
mÜe_äag
) {

1088 
skb
 = 
NULL
;

1091 
skb
 = 
ni
->
ni_rxäag
;

1092 
ni
->
ni_rxäag
 = 
NULL
;

1094  
skb
;

1095 
	}
}

1098 
	$›“80211_d–iv”_d©a
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
)

1100 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1101 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

1102 
‘h”_h—d”
 *
eh
 = (‘h”_h—d” *)
skb
->
d©a
;

1103 
›“80211_node
 *
Ši
;

1104 
»t
;

1106 #ifdeà
ATH_SUPERG_XR


1112 ià(
v­
->
iv_xrv­
 && v­->
iv_æags
 & 
IEEE80211_F_XR
)

1113 
dev
 = 
v­
->
iv_xrv­
->
iv_dev
;

1118 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

1119 (
v­
->
iv_æags
 & 
IEEE80211_F_NOBRIDGE
) == 0) {

1120 
sk_buff
 *
skb1
 = 
NULL
;

1122 ià(
	`ETHER_IS_MULTICAST
(
eh
->
‘h”_dho¡
)) {

1124 
skb1
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

1125 ià(
skb1
)

1126 
	`SKB_NI
(
skb1
èğ
	`›“80211_»f_node
(
v­
->
iv_bss
);

1134 
›“80211_node
 *
ni1
 = 
	`›“80211_fšd_node
(

1135 &
v­
->
iv_ic
->
ic_¡a
, 
eh
->
‘h”_dho¡
);

1136 ià(
ni1
 !ğ
NULL
) {

1137 ià((
ni1
->
ni_v­
 =ğ
v­
) &&

1138 (
ni1
 !ğ
v­
->
iv_bss
) &&

1139 
	`›“80211_node_is_authÜized
(
ni1
)) {

1140 
skb1
 = 
skb
;

1141 
skb
 = 
NULL
;

1144 
	`›“80211_uÄef_node
(&
ni1
);

1147 ià(
skb1
 !ğ
NULL
) {

1148 
skb1
->
dev
 = dev;

1149 
	`skb_»£t_mac_h—d”
(
skb1
);

1150 
	`skb_£t_ÃtwÜk_h—d”
(
skb1
, (
‘h”_h—d”
));

1152 
skb1
->
´ÙocŞ
 = 
	`__cÚ¡ªt_htÚs
(
ETH_P_802_2
);

1159 
Ši
 = 
	`SKB_NI
(
skb1
);

1161 ià(
	`dev_queue_xm™
(
skb1
è=ğ
NET_XMIT_DROP
) {

1162 
v­
->
iv_dev¡©s
.
tx_drİ³d
++;

1163 ià(
Ši
 !ğ
NULL
)

1164 
	`›“80211_uÄef_node
(&
Ši
);

1167 
skb1
 = 
NULL
;

1171 ià(
skb
 !ğ
NULL
) {

1172 
v­
->
iv_dev¡©s
.
rx_·ck‘s
++;

1173 
v­
->
iv_dev¡©s
.
rx_by‹s
 +ğ
skb
->
Ën
;

1174 
dev
->
Ï¡_rx
 = 
jiff›s
;

1176 
skb
->
dev
 = dev;

1177 #ifdeà
USE_HEADERLEN_RESV


1178 
skb
->
´ÙocŞ
 = 
	`©h_‘h_ty³_Œªs
(skb, 
dev
);

1180 
skb
->
´ÙocŞ
 = 
	`‘h_ty³_Œªs
(skb, 
dev
);

1182 
Ši
 = 
	`SKB_NI
(
skb
);

1183 ià((
ni
->
ni_vÏn
 !ğ0è&& (
v­
->
iv_vlg½
 !ğ
NULL
))

1185 
»t
 = 
	`vÏn_hwacûl_rx
(
skb
,

1186 
v­
->
iv_vlg½
, 
ni
->
ni_vÏn
);

1188 
»t
 = 
	`Ãtif_rx
(
skb
);

1189 ià(
»t
 =ğ
NET_RX_DROP
)

1190 
v­
->
iv_dev¡©s
.
rx_drİ³d
++;

1191 ià(
Ši
 !ğ
NULL
)

1192 
	`›“80211_uÄef_node
(&
Ši
);

1193 
skb
 = 
NULL
;

1195 
	}
}

1199 
sk_buff
 *

1200 
	$›“80211_deÿp
(
›“80211v­
 *
v­
, 
sk_buff
 *
skb
, 
hd¾’
)

1202 cÚ¡ 
Îc
 
¢­_hdr
 = {.
Îc_d§p
 = 
LLC_SNAP_LSAP
,

1203 .
Îc_s§p
 = 
LLC_SNAP_LSAP
,

1204 .
Îc_¢­
.
cÚŒŞ
 = 
LLC_UI
,

1205 .
Îc_¢­
.
Üg_code
 = {0x0, 0x0, 0x0}};

1206 
›“80211_qosäame_addr4
 
wh
;

1207 
‘h”_h—d”
 *
eh
;

1208 
Îc
 *llc;

1209 
__be16
 
‘h”_ty³
 = 0;

1211 
	`memıy
(&
wh
, 
skb
->
d©a
, 
hd¾’
);

1213 
Îc
 = (Îø*)
	`skb_puÎ
(
skb
, 
hd¾’
);

1217 ià((
skb
->
Ën
 >ğ
LLC_SNAPFRAMELEN
è&& (
	`memcmp
(&
¢­_hdr
, 
Îc
, 5) == 0) &&

1218 ((
Îc
->
Îc_¢­
.
Üg_code
[2] == 0x0) ||

1219 (
Îc
->
Îc_¢­
.
Üg_code
[2] == 0xf8))) {

1220 
‘h”_ty³
 = 
Îc
->
Îc_un
.
ty³_¢­
.ether_type;

1221 
	`skb_puÎ
(
skb
, 
LLC_SNAPFRAMELEN
);

1222 
Îc
 = 
NULL
;

1225 
eh
 = (
‘h”_h—d”
 *)
	`skb_push
(
skb
, (ether_header));

1226 
wh
.
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
) {

1227 
IEEE80211_FC1_DIR_NODS
:

1228 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_dho¡
, 
wh
.
i_addr1
);

1229 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_sho¡
, 
wh
.
i_addr2
);

1231 
IEEE80211_FC1_DIR_TODS
:

1232 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_dho¡
, 
wh
.
i_addr3
);

1233 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_sho¡
, 
wh
.
i_addr2
);

1235 
IEEE80211_FC1_DIR_FROMDS
:

1236 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_dho¡
, 
wh
.
i_addr1
);

1237 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_sho¡
, 
wh
.
i_addr3
);

1239 
IEEE80211_FC1_DIR_DSTODS
:

1240 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_dho¡
, 
wh
.
i_addr3
);

1241 
	`IEEE80211_ADDR_COPY
(
eh
->
‘h”_sho¡
, 
wh
.
i_addr4
);

1245 ià(
Îc
 !ğ
NULL
)

1246 
eh
->
‘h”_ty³
 = 
	`htÚs
(
skb
->
Ën
 - (*eh));

1248 
eh
->
‘h”_ty³
 =ƒther_type;

1250  
skb
;

1251 
	}
}

1257 
	$›“80211_£tup_¿‹s
(
›“80211_node
 *
ni
,

1258 cÚ¡ 
u_št8_t
 *
¿‹s
, cÚ¡ u_št8_ˆ*
x¿‹s
, 
æags
)

1260 
›“80211_¿‹£t
 *
rs
 = &
ni
->
ni_¿‹s
;

1262 
	`mem£t
(
rs
, 0, (*rs));

1263 
rs
->
rs_Ä©es
 = 
¿‹s
[1];

1264 
	`memıy
(
rs
->
rs_¿‹s
, 
¿‹s
 + 2,„s->
rs_Ä©es
);

1265 ià(
x¿‹s
 !ğ
NULL
) {

1266 
u_št8_t
 
nx¿‹s
;

1270 
nx¿‹s
 = 
x¿‹s
[1];

1271 ià(
rs
->
rs_Ä©es
 + 
nx¿‹s
 > 
IEEE80211_RATE_MAXSIZE
) {

1272 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1274 
nx¿‹s
 = 
IEEE80211_RATE_MAXSIZE
 - 
rs
->
rs_Ä©es
;

1275 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_XRATE
, 
ni
,

1278 
nx¿‹s
, 
x¿‹s
[1]);

1279 
v­
->
iv_¡©s
.
is_rx_r¡oobig
++;

1281 
	`memıy
(
rs
->
rs_¿‹s
 +„s->
rs_Ä©es
, 
x¿‹s
+2, 
nx¿‹s
);

1282 
rs
->
rs_Ä©es
 +ğ
nx¿‹s
;

1284  
	`›“80211_fix_¿‹
(
ni
, 
æags
);

1285 
	}
}

1288 
	$›“80211_auth_İ’
(
›“80211_node
 *
ni
, 
›“80211_äame
 *
wh
,

1289 
rssi
, 
u_št64_t
 
¹sf
, 
u_št16_t
 
£q
, u_št16_ˆ
¡©us
)

1291 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1292 
tm²ode
 = 0;

1294 ià(
ni
->
ni_authmode
 =ğ
IEEE80211_AUTH_SHARED
) {

1295 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1296 
ni
->
ni_maÿddr
, "open‡uth",

1297 "bad s‡uth mod%u", 
ni
->
ni_authmode
);

1298 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1299 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

1300 ià(
ni
 =ğ
v­
->
iv_bss
) {

1301 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
wh
->
i_addr2
, 0);

1302 ià(
ni
 =ğ
NULL
)

1304 
tm²ode
 = 1;

1306 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_AUTH
,

1307 (
£q
 + 1è| (
IEEE80211_STATUS_ALG
 << 16));

1309 ià(
tm²ode
)

1310 
	`›“80211_uÄef_node
(&
ni
);

1314 
v­
->
iv_İmode
) {

1315 
IEEE80211_M_IBSS
:

1316 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
 ||

1317 
£q
 !ğ
IEEE80211_AUTH_OPEN_REQUEST
) {

1318 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1321 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_AUTH
,

1322 
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
);

1325 
IEEE80211_M_AHDEMO
:

1326 
IEEE80211_M_WDS
:

1330 
IEEE80211_M_HOSTAP
:

1331 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
 ||

1332 
£q
 !ğ
IEEE80211_AUTH_OPEN_REQUEST
) {

1333 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1337 ià(
ni
 =ğ
v­
->
iv_bss
) {

1338 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
wh
->
i_addr2
, 0);

1339 ià(
ni
 =ğ
NULL
)

1341 
tm²ode
 = 1;

1344 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_AUTH
, 
£q
 + 1);

1345 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
,

1346 
ni
, "station‡uthenticated (%s)", "open");

1351 ià(
ni
->
ni_authmode
 !ğ
IEEE80211_AUTH_8021X
)

1352 
	`›“80211_node_authÜize
(
ni
);

1353 ià(
tm²ode
)

1354 
	`›“80211_uÄef_node
(&
ni
);

1357 
IEEE80211_M_STA
:

1358 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_AUTH
 ||

1359 
£q
 !ğ
IEEE80211_AUTH_OPEN_RESPONSE
) {

1360 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1363 ià(
¡©us
 != 0) {

1364 
	`IEEE80211_NOTE
(
v­
,

1365 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
, 
ni
,

1366 "İ’‡uth faed (»asÚ %d)", 
¡©us
);

1367 
v­
->
iv_¡©s
.
is_rx_auth_ç
++;

1368 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
,

1369 
IEEE80211_SCAN_FAIL_STATUS
);

1371 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_ASSOC
, 0);

1373 
IEEE80211_M_MONITOR
:

1376 
	}
}

1386 
	$›“80211_£nd_”rÜ
(
›“80211_node
 *
ni
,

1387 cÚ¡ 
u_št8_t
 *
mac
, 
subty³
, 
¬g
)

1389 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1390 
i¡mp
;

1392 ià(
ni
 =ğ
v­
->
iv_bss
) {

1393 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
mac
, 1);

1394 ià(
ni
 =ğ
NULL
) {

1398 
i¡mp
 = 1;

1400 
i¡mp
 = 0;

1401 
	`IEEE80211_SEND_MGMT
(
ni
, 
subty³
, 
¬g
);

1402 ià(
i¡mp
)

1403 
	`›“80211_uÄef_node
(&
ni
);

1404 
	}
}

1407 
	$®loc_ch®Ënge
(
›“80211_node
 *
ni
)

1409 ià(
ni
->
ni_ch®Ënge
 =ğ
NULL
)

1410 
	`MALLOC
(
ni
->
ni_ch®Ënge
, 
u_št32_t
*, 
IEEE80211_CHALLENGE_LEN
,

1411 
M_DEVBUF
, 
M_NOWAIT
);

1412 ià(
ni
->
ni_ch®Ënge
 =ğ
NULL
) {

1413 
	`IEEE80211_NOTE
(
ni
->
ni_v­
,

1414 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
, 
ni
,

1418  (
ni
->
ni_ch®Ënge
 !ğ
NULL
);

1419 
	}
}

1423 
	$›“80211_auth_sh¬ed
(
›“80211_node
 *
ni
, 
›“80211_äame
 *
wh
,

1424 
u_št8_t
 *
äm
, u_št8_ˆ*
eäm
, 
rssi
, 
u_št64_t
 
¹sf
,

1425 
u_št16_t
 
£q
, u_št16_ˆ
¡©us
)

1427 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1428 
u_št8_t
 *
ch®Ënge
;

1429 
®locbs
 = 0, 
e¡©us
 = 0;

1439 ià((
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0) {

1440 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1441 
ni
->
ni_maÿddr
, "shared key‡uth",

1443 
e¡©us
 = 
IEEE80211_STATUS_ALG
;

1444 
bad
;

1451 ià(
ni
->
ni_authmode
 !ğ
IEEE80211_AUTH_AUTO
 &&

1452 
ni
->
ni_authmode
 !ğ
IEEE80211_AUTH_SHARED
) {

1453 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1454 
ni
->
ni_maÿddr
, "shared key‡uth",

1455 "bad s‡uth mod%u", 
ni
->
ni_authmode
);

1456 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1457 
e¡©us
 = 
IEEE80211_STATUS_ALG
;

1458 
bad
;

1461 
ch®Ënge
 = 
NULL
;

1462 ià(
äm
 + 1 < 
eäm
) {

1463 ià((
äm
[1] + 2è> (
eäm
 - frm)) {

1464 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1465 
ni
->
ni_maÿddr
, "shared key‡uth",

1467 
äm
[0], (äm[1] + 2è- (
eäm
 - frm));

1468 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1469 
e¡©us
 = 
IEEE80211_STATUS_CHALLENGE
;

1470 
bad
;

1472 ià(*
äm
 =ğ
IEEE80211_ELEMID_CHALLENGE
)

1473 
ch®Ënge
 = 
äm
;

1474 
äm
 += frm[1] + 2;

1476 
£q
) {

1477 
IEEE80211_AUTH_SHARED_CHALLENGE
:

1478 
IEEE80211_AUTH_SHARED_RESPONSE
:

1479 ià(
ch®Ënge
 =ğ
NULL
) {

1480 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1481 
ni
->
ni_maÿddr
, "shared key‡uth",

1483 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1484 
e¡©us
 = 
IEEE80211_STATUS_CHALLENGE
;

1485 
bad
;

1487 ià(
ch®Ënge
[1] !ğ
IEEE80211_CHALLENGE_LEN
) {

1488 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1489 
ni
->
ni_maÿddr
, "shared key‡uth",

1490 "bad ch®ËngËÀ%d", 
ch®Ënge
[1]);

1491 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1492 
e¡©us
 = 
IEEE80211_STATUS_CHALLENGE
;

1493 
bad
;

1498 
v­
->
iv_İmode
) {

1499 
IEEE80211_M_MONITOR
:

1500 
IEEE80211_M_AHDEMO
:

1501 
IEEE80211_M_IBSS
:

1502 
IEEE80211_M_WDS
:

1503 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1504 
ni
->
ni_maÿddr
, "shared key‡uth",

1505 "bad o³¿tšg mod%u", 
v­
->
iv_İmode
);

1507 
IEEE80211_M_HOSTAP
:

1508 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
) {

1509 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1510 
ni
->
ni_maÿddr
, "shared key‡uth",

1511 "bad s‹ %u", 
v­
->
iv_¡©e
);

1512 
e¡©us
 = 
IEEE80211_STATUS_ALG
;

1513 
bad
;

1515 
£q
) {

1516 
IEEE80211_AUTH_SHARED_REQUEST
:

1517 ià(
ni
 =ğ
v­
->
iv_bss
) {

1518 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
wh
->
i_addr2
, 0);

1519 ià(
ni
 =ğ
NULL
) {

1523 
®locbs
 = 1;

1526 
ni
->
ni_rssi
 = 
rssi
;

1527 
ni
->
ni_¹sf
 = 
¹sf
;

1528 
ni
->
ni_Ï¡_rx
 = 
jiff›s
;

1529 ià(!
	`®loc_ch®Ënge
(
ni
)) {

1530 ià(
®locbs
)

1531 
	`›“80211_uÄef_node
(&
ni
);

1535 
	`g‘_¿ndom_by‹s
(
ni
->
ni_ch®Ënge
,

1536 
IEEE80211_CHALLENGE_LEN
);

1537 
	`IEEE80211_NOTE
(
v­
,

1538 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
, 
ni
,

1539 "sh¬ed key %§uth„eque¡", 
®locbs
 ? "" : "re");

1541 
IEEE80211_AUTH_SHARED_RESPONSE
:

1542 ià(
ni
 =ğ
v­
->
iv_bss
) {

1543 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1544 
ni
->
ni_maÿddr
, "shared key„esponse",

1549 ià(
ni
->
ni_ch®Ënge
 =ğ
NULL
) {

1550 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1551 
ni
->
ni_maÿddr
, "shared key„esponse",

1553 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1554 
e¡©us
 = 
IEEE80211_STATUS_CHALLENGE
;

1555 
bad
;

1557 ià(
	`memcmp
(
ni
->
ni_ch®Ënge
, &
ch®Ënge
[2],

1558 
ch®Ënge
[1]) != 0) {

1559 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1560 
ni
->
ni_maÿddr
, "shared key„esponse",

1562 
v­
->
iv_¡©s
.
is_rx_auth_ç
++;

1563 
e¡©us
 = 
IEEE80211_STATUS_CHALLENGE
;

1564 
bad
;

1566 
	`IEEE80211_NOTE
(
v­
,

1567 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
, 
ni
,

1569 
	`›“80211_node_authÜize
(
ni
);

1572 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_AUTH
,

1573 
ni
->
ni_maÿddr
, "shared key‡uth",

1574 "bad seq %d", 
£q
);

1575 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1576 
e¡©us
 = 
IEEE80211_STATUS_SEQUENCE
;

1577 
bad
;

1579 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_AUTH
, 
£q
 + 1);

1582 
IEEE80211_M_STA
:

1583 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_AUTH
)

1585 
£q
) {

1586 
IEEE80211_AUTH_SHARED_PASS
:

1587 ià(
ni
->
ni_ch®Ënge
 !ğ
NULL
) {

1588 
	`FREE
(
ni
->
ni_ch®Ënge
, 
M_DEVBUF
);

1589 
ni
->
ni_ch®Ënge
 = 
NULL
;

1591 ià(
¡©us
 != 0) {

1592 
	`IEEE80211_NOTE_MAC
(
v­
,

1593 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_AUTH
,

1594 
	`›“80211_g‘bssid
(
v­
, 
wh
),

1596 
¡©us
);

1597 
v­
->
iv_¡©s
.
is_rx_auth_ç
++;

1599 
bad
;

1601 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_ASSOC
, 0);

1603 
IEEE80211_AUTH_SHARED_CHALLENGE
:

1604 ià(!
	`®loc_ch®Ënge
(
ni
))

1605 
bad
;

1607 
	`memıy
(
ni
->
ni_ch®Ënge
, &
ch®Ënge
[2], challenge[1]);

1608 
	`IEEE80211_SEND_MGMT
(
ni
,

1609 
IEEE80211_FC0_SUBTYPE_AUTH
, 
£q
 + 1);

1612 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_AUTH
,

1613 
wh
, "sh¬ed key‡uth", "bad seq %d", 
£q
);

1614 
v­
->
iv_¡©s
.
is_rx_bad_auth
++;

1615 
bad
;

1619 ià(
®locbs
)

1620 
	`›“80211_uÄef_node
(&
ni
);

1622 
bad
:

1624 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

1626 
	`›“80211_£nd_”rÜ
(
ni
, 
wh
->
i_addr2
,

1627 
IEEE80211_FC0_SUBTYPE_AUTH
,

1628 (
£q
 + 1è| (
e¡©us
<<16));

1631 ià(!
®locbs
 && (
ni
 !ğ
v­
->
iv_bss
))

1632 
	`›“80211_node_Ëave
(
ni
);

1633 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

1639 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_AUTH
)

1640 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

1642 ià(
®locbs
)

1643 
	`›“80211_uÄef_node
(&
ni
);

1644 
	}
}

1647 
	#IEEE80211_VERIFY_ELEMENT
(
__–em
, 
__maxËn
) do { \

1648 ià((
__–em
è=ğ
NULL
) { \

1649 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ELEMID
, \

1650 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >> \

1651 
IEEE80211_FC0_SUBTYPE_SHIFT
], \

1653 
v­
->
iv_¡©s
.
is_rx_–em_missšg
++; \

1656 ià((
__–em
)[1] > (
__maxËn
)) { \

1657 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ELEMID
, \

1658 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >> \

1659 
IEEE80211_FC0_SUBTYPE_SHIFT
], \

1660 "bad " #__–em "†’ %d", (
__–em
)[1]); \

1661 
v­
->
iv_¡©s
.
is_rx_–em_toobig
++; \

1664 } 0)

	)

1666 
	#IEEE80211_VERIFY_LENGTH
(
_Ën
, 
_mšËn
) do { \

1667 ià((
_Ën
è< (
_mšËn
)) { \

1668 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ELEMID
, \

1669 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >> \

1670 
IEEE80211_FC0_SUBTYPE_SHIFT
], \

1672 
v­
->
iv_¡©s
.
is_rx_–em_toosm®l
++; \

1675 } 0)

	)

1677 #ifdeà
IEEE80211_DEBUG


1679 
	$›“80211_ssid_mism©ch
(
›“80211v­
 *
v­
, cÚ¡ *
g
,

1680 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
], u_št8_ˆ*
ssid
)

1682 
	`´štk
("[" 
MAC_FMT
 "] discard %s frame, ssid mismatch: ",

1683 
	`MAC_ADDR
(
mac
), 
g
);

1684 
	`›“80211_´št_essid
(
ssid
 + 2, ssid[1]);

1685 
	`´štk
("\n");

1686 
	}
}

1688 
	#IEEE80211_VERIFY_SSID
(
_ni
, 
_ssid
) do { \

1689 ià((
_ssid
)[1] != 0 && \

1690 ((
_ssid
)[1] !ğ(
_ni
)->
ni_es¦’
 || \

1691 
	`memcmp
((
_ssid
è+ 2, (
_ni
)->
ni_essid
, (_ssid)[1]) != 0)) { \

1692 ià(
	`›“80211_msg_šput
(
v­
)) \

1693 
	`›“80211_ssid_mism©ch
(
v­
, \

1694 
›“80211_mgt_subty³_Çme
[
subty³
 >> \

1695 
IEEE80211_FC0_SUBTYPE_SHIFT
], \

1696 
wh
->
i_addr2
, 
_ssid
); \

1697 
v­
->
iv_¡©s
.
is_rx_ssidmism©ch
++; \

1700 } 0)

	)

1702 
	#IEEE80211_VERIFY_SSID
(
_ni
, 
_ssid
) do { \

1703 ià((
_ssid
)[1] != 0 && \

1704 ((
_ssid
)[1] !ğ(
_ni
)->
ni_es¦’
 || \

1705 
	`memcmp
((
_ssid
è+ 2, (
_ni
)->
ni_essid
, (_ssid)[1]) != 0)) { \

1706 
v­
->
iv_¡©s
.
is_rx_ssidmism©ch
++; \

1709 } 0)

	)

1713 
	#LE_READ_2
(
p
) \

1714 ((
u_št16_t
) \

1715 ((((cÚ¡ 
u_št8_t
 *)(
p
))[0] ) | \

1716 (((cÚ¡ 
u_št8_t
 *)(
p
))[1] << 8)))

	)

1717 
	#LE_READ_4
(
p
) \

1718 ((
u_št32_t
) \

1719 ((((cÚ¡ 
u_št8_t
 *)(
p
))[0] ) | \

1720 (((cÚ¡ 
u_št8_t
 *)(
p
))[1] << 8) | \

1721 (((cÚ¡ 
u_št8_t
 *)(
p
))[2] << 16) | \

1722 (((cÚ¡ 
u_št8_t
 *)(
p
))[3] << 24)))

	)

1724 
__šlše
 

1725 
	$isw·oui
(cÚ¡ 
u_št8_t
 *
äm
)

1727  
äm
[1] > 3 && 
	`LE_READ_4
(äm+2è=ğ((
WPA_OUI_TYPE
<<24)|
WPA_OUI
);

1728 
	}
}

1730 
__šlše
 

1731 
	$iswmeoui
(cÚ¡ 
u_št8_t
 *
äm
)

1733  
äm
[1] > 3 && 
	`LE_READ_4
(äm+2è=ğ((
WME_OUI_TYPE
<<24)|
WME_OUI
);

1734 
	}
}

1736 
__šlše
 

1737 
	$iswm•¬am
(cÚ¡ 
u_št8_t
 *
äm
)

1739  
äm
[1] > 5 && 
	`LE_READ_4
(äm+2è=ğ((
WME_OUI_TYPE
<<24)|
WME_OUI
) &&

1740 
äm
[6] =ğ
WME_PARAM_OUI_SUBTYPE
;

1741 
	}
}

1743 
__šlše
 

1744 
	$iswmešfo
(cÚ¡ 
u_št8_t
 *
äm
)

1746  
äm
[1] > 5 && 
	`LE_READ_4
(äm+2è=ğ((
WME_OUI_TYPE
<<24)|
WME_OUI
) &&

1747 
äm
[6] =ğ
WME_INFO_OUI_SUBTYPE
;

1748 
	}
}

1750 
__šlše
 

1751 
	$i§th”osoui
(cÚ¡ 
u_št8_t
 *
äm
)

1753  
äm
[1] > 3 && 
	`LE_READ_4
(äm+2è=ğ((
ATH_OUI_TYPE
<<24)|
ATH_OUI
);

1754 
	}
}

1762 
	$w·_ch”
(
u_št8_t
 *
£l
, u_št8_ˆ*
keyËn
)

1764 
	#WPA_SEL
(
x
è(((xè<< 24è| 
WPA_OUI
)

	)

1765 
u_št32_t
 
w
 = 
	`LE_READ_4
(
£l
);

1767 
w
) {

1768 
	`WPA_SEL
(
WPA_CSE_NULL
):

1769  
IEEE80211_CIPHER_NONE
;

1770 
	`WPA_SEL
(
WPA_CSE_WEP40
):

1771 ià(
keyËn
)

1772 *
keyËn
 = 40 / 
NBBY
;

1773  
IEEE80211_CIPHER_WEP
;

1774 
	`WPA_SEL
(
WPA_CSE_WEP104
):

1775 ià(
keyËn
)

1776 *
keyËn
 = 104 / 
NBBY
;

1777  
IEEE80211_CIPHER_WEP
;

1778 
	`WPA_SEL
(
WPA_CSE_TKIP
):

1779  
IEEE80211_CIPHER_TKIP
;

1780 
	`WPA_SEL
(
WPA_CSE_CCMP
):

1781  
IEEE80211_CIPHER_AES_CCM
;

1784 #undeà
WPA_SEL


1785 
	}
}

1792 
	$w·_keymgmt
(
u_št8_t
 *
£l
)

1794 
	#WPA_SEL
(
x
è(((x)<<24)|
WPA_OUI
)

	)

1795 
u_št32_t
 
w
 = 
	`LE_READ_4
(
£l
);

1797 
w
) {

1798 
	`WPA_SEL
(
WPA_ASE_8021X_UNSPEC
):

1799  
WPA_ASE_8021X_UNSPEC
;

1800 
	`WPA_SEL
(
WPA_ASE_8021X_PSK
):

1801  
WPA_ASE_8021X_PSK
;

1802 
	`WPA_SEL
(
WPA_ASE_NONE
):

1803  
WPA_ASE_NONE
;

1806 #undeà
WPA_SEL


1807 
	}
}

1815 
	$›“80211_·r£_w·
(
›“80211v­
 *
v­
, 
u_št8_t
 *
äm
,

1816 
›“80211_r¢·rms
 *
r¢_·rm
, cÚ¡ 
›“80211_äame
 *
wh
)

1818 
u_št8_t
 
Ën
 = 
äm
[1];

1819 
u_št32_t
 
w
;

1820 
n
;

1827 ià(!(
v­
->
iv_æags
 & 
IEEE80211_F_WPA1
)) {

1828 
	`IEEE80211_DISCARD_IE
(
v­
,

1829 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1830 
wh
, "WPA", "v­‚Ù WPA, fÏg 0x%x", 
v­
->
iv_æags
);

1831  
IEEE80211_REASON_IE_INVALID
;

1834 ià(
Ën
 < 14) {

1835 
	`IEEE80211_DISCARD_IE
(
v­
,

1836 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1837 
wh
, "WPA", "toØshÜt,†’ %u", 
Ën
);

1838  
IEEE80211_REASON_IE_INVALID
;

1840 
äm
 +ğ6, 
Ën
 -= 4;

1842 
w
 = 
	`LE_READ_2
(
äm
);

1843 ià(
w
 !ğ
WPA_VERSION
) {

1844 
	`IEEE80211_DISCARD_IE
(
v­
,

1845 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1846 
wh
, "WPA", "bad v”siÚ %u", 
w
);

1847  
IEEE80211_REASON_IE_INVALID
;

1849 
äm
 += 2;

1850 
Ën
 -= 2;

1853 
w
 = 
	`w·_ch”
(
äm
, &
r¢_·rm
->
r¢_mÿ¡keyËn
);

1854 ià(
w
 !ğ
r¢_·rm
->
r¢_mÿ¡ch”
) {

1855 
	`IEEE80211_DISCARD_IE
(
v­
,

1856 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1857 
wh
, "WPA", "mcast cipher mismatch; got %u,ƒxpected %u",

1858 
w
, 
r¢_·rm
->
r¢_mÿ¡ch”
);

1859  
IEEE80211_REASON_IE_INVALID
;

1861 
äm
 += 4;

1862 
Ën
 -= 4;

1865 
n
 = 
	`LE_READ_2
(
äm
);

1866 
äm
 += 2;

1867 
Ën
 -= 2;

1868 ià(
Ën
 < 
n
*4+2) {

1869 
	`IEEE80211_DISCARD_IE
(
v­
,

1870 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1871 
wh
, "WPA", "ucast cipher dataoo short;†en %u,‚ %u",

1872 
Ën
, 
n
);

1873  
IEEE80211_REASON_IE_INVALID
;

1875 
w
 = 0;

1876 ; 
n
 > 0;‚--) {

1877 
w
 |ğ1 << 
	`w·_ch”
(
äm
, &
r¢_·rm
->
r¢_uÿ¡keyËn
);

1878 
äm
 += 4;

1879 
Ën
 -= 4;

1881 
w
 &ğ
r¢_·rm
->
r¢_uÿ¡ch”£t
;

1882 ià(
w
 == 0) {

1883 
	`IEEE80211_DISCARD_IE
(
v­
,

1884 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1885 
wh
, "WPA", "%s", "ucast cipher setƒmpty");

1886  
IEEE80211_REASON_IE_INVALID
;

1888 ià(
w
 & (1 << 
IEEE80211_CIPHER_TKIP
))

1889 
r¢_·rm
->
r¢_uÿ¡ch”
 = 
IEEE80211_CIPHER_TKIP
;

1891 
r¢_·rm
->
r¢_uÿ¡ch”
 = 
IEEE80211_CIPHER_AES_CCM
;

1894 
n
 = 
	`LE_READ_2
(
äm
);

1895 
äm
 += 2;

1896 
Ën
 -= 2;

1897 ià(
Ën
 < 
n
 * 4) {

1898 
	`IEEE80211_DISCARD_IE
(
v­
,

1899 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1900 
wh
, "WPA", "key mgmt‡lg dataoo short;†en %u,‚ %u",

1901 
Ën
, 
n
);

1902  
IEEE80211_REASON_IE_INVALID
;

1904 
w
 = 0;

1905 ; 
n
 > 0;‚--) {

1906 
w
 |ğ
	`w·_keymgmt
(
äm
);

1907 
äm
 += 4;

1908 
Ën
 -= 4;

1910 
w
 &ğ
r¢_·rm
->
r¢_keymgmt£t
;

1911 ià(
w
 == 0) {

1912 
	`IEEE80211_DISCARD_IE
(
v­
,

1913 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

1914 
wh
, "WPA", "%s", "no‡cceptable key mgmt‡lg");

1915  
IEEE80211_REASON_IE_INVALID
;

1917 ià(
w
 & 
WPA_ASE_8021X_UNSPEC
)

1918 
r¢_·rm
->
r¢_keymgmt
 = 
WPA_ASE_8021X_UNSPEC
;

1920 
r¢_·rm
->
r¢_keymgmt
 = 
WPA_ASE_8021X_PSK
;

1922 ià(
Ën
 > 2)

1923 
r¢_·rm
->
r¢_ÿps
 = 
	`LE_READ_2
(
äm
);

1926 
	}
}

1934 
	$r¢_ch”
(
u_št8_t
 *
£l
, u_št8_ˆ*
keyËn
)

1936 
	#RSN_SEL
(
x
è(((xè<< 24è| 
RSN_OUI
)

	)

1937 
u_št32_t
 
w
 = 
	`LE_READ_4
(
£l
);

1939 
w
) {

1940 
	`RSN_SEL
(
RSN_CSE_NULL
):

1941  
IEEE80211_CIPHER_NONE
;

1942 
	`RSN_SEL
(
RSN_CSE_WEP40
):

1943 ià(
keyËn
)

1944 *
keyËn
 = 40 / 
NBBY
;

1945  
IEEE80211_CIPHER_WEP
;

1946 
	`RSN_SEL
(
RSN_CSE_WEP104
):

1947 ià(
keyËn
)

1948 *
keyËn
 = 104 / 
NBBY
;

1949  
IEEE80211_CIPHER_WEP
;

1950 
	`RSN_SEL
(
RSN_CSE_TKIP
):

1951  
IEEE80211_CIPHER_TKIP
;

1952 
	`RSN_SEL
(
RSN_CSE_CCMP
):

1953  
IEEE80211_CIPHER_AES_CCM
;

1954 
	`RSN_SEL
(
RSN_CSE_WRAP
):

1955  
IEEE80211_CIPHER_AES_OCB
;

1958 #undeà
RSN_SEL


1959 
	}
}

1966 
	$r¢_keymgmt
(
u_št8_t
 *
£l
)

1968 
	#RSN_SEL
(
x
è(((xè<< 24è| 
RSN_OUI
)

	)

1969 
u_št32_t
 
w
 = 
	`LE_READ_4
(
£l
);

1971 
w
) {

1972 
	`RSN_SEL
(
RSN_ASE_8021X_UNSPEC
):

1973  
RSN_ASE_8021X_UNSPEC
;

1974 
	`RSN_SEL
(
RSN_ASE_8021X_PSK
):

1975  
RSN_ASE_8021X_PSK
;

1976 
	`RSN_SEL
(
RSN_ASE_NONE
):

1977  
RSN_ASE_NONE
;

1980 #undeà
RSN_SEL


1981 
	}
}

1989 
	$›“80211_·r£_r¢
(
›“80211v­
 *
v­
, 
u_št8_t
 *
äm
,

1990 
›“80211_r¢·rms
 *
r¢_·rm
, cÚ¡ 
›“80211_äame
 *
wh
)

1992 
u_št8_t
 
Ën
 = 
äm
[1];

1993 
u_št32_t
 
w
;

1994 
n
;

2001 ià(!(
v­
->
iv_æags
 & 
IEEE80211_F_WPA2
)) {

2002 
	`IEEE80211_DISCARD_IE
(
v­
,

2003 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2004 
wh
, "RSN", "v­‚Ù RSN, fÏg 0x%x", 
v­
->
iv_æags
);

2005  
IEEE80211_REASON_IE_INVALID
;

2008 ià(
Ën
 < 10) {

2009 
	`IEEE80211_DISCARD_IE
(
v­
,

2010 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2011 
wh
, "RSN", "toØshÜt,†’ %u", 
Ën
);

2012  
IEEE80211_REASON_IE_INVALID
;

2014 
äm
 += 2;

2015 
w
 = 
	`LE_READ_2
(
äm
);

2016 ià(
w
 !ğ
RSN_VERSION
) {

2017 
	`IEEE80211_DISCARD_IE
(
v­
,

2018 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2019 
wh
, "RSN", "bad v”siÚ %u", 
w
);

2020  
IEEE80211_REASON_IE_INVALID
;

2022 
äm
 += 2;

2023 
Ën
 -= 2;

2026 
w
 = 
	`r¢_ch”
(
äm
, &
r¢_·rm
->
r¢_mÿ¡keyËn
);

2027 ià(
w
 !ğ
r¢_·rm
->
r¢_mÿ¡ch”
) {

2028 
	`IEEE80211_DISCARD_IE
(
v­
,

2029 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2030 
wh
, "RSN", "mcast cipher mismatch; got %u,ƒxpected %u",

2031 
w
, 
r¢_·rm
->
r¢_mÿ¡ch”
);

2032  
IEEE80211_REASON_IE_INVALID
;

2034 
äm
 += 4;

2035 
Ën
 -= 4;

2038 
n
 = 
	`LE_READ_2
(
äm
);

2039 
äm
 += 2;

2040 
Ën
 -= 2;

2041 ià(
Ën
 < 
n
 * 4 + 2) {

2042 
	`IEEE80211_DISCARD_IE
(
v­
,

2043 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2044 
wh
, "RSN", "ucast cipher dataoo short;†en %u,‚ %u",

2045 
Ën
, 
n
);

2046  
IEEE80211_REASON_IE_INVALID
;

2048 
w
 = 0;

2049 ; 
n
 > 0;‚--) {

2050 
w
 |ğ1 << 
	`r¢_ch”
(
äm
, &
r¢_·rm
->
r¢_uÿ¡keyËn
);

2051 
äm
 += 4;

2052 
Ën
 -= 4;

2054 
w
 &ğ
r¢_·rm
->
r¢_uÿ¡ch”£t
;

2055 ià(
w
 == 0) {

2056 
	`IEEE80211_DISCARD_IE
(
v­
,

2057 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2058 
wh
, "RSN", "%s", "ucast cipher setƒmpty");

2059  
IEEE80211_REASON_IE_INVALID
;

2061 ià(
w
 & (1<<
IEEE80211_CIPHER_TKIP
))

2062 
r¢_·rm
->
r¢_uÿ¡ch”
 = 
IEEE80211_CIPHER_TKIP
;

2064 
r¢_·rm
->
r¢_uÿ¡ch”
 = 
IEEE80211_CIPHER_AES_CCM
;

2067 
n
 = 
	`LE_READ_2
(
äm
);

2068 
äm
 += 2;

2069 
Ën
 -= 2;

2070 ià(
Ën
 < 
n
 * 4) {

2071 
	`IEEE80211_DISCARD_IE
(
v­
,

2072 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2073 
wh
, "RSN", "key mgmt‡lg dataoo short;†en %u,‚ %u",

2074 
Ën
, 
n
);

2075  
IEEE80211_REASON_IE_INVALID
;

2077 
w
 = 0;

2078 ; 
n
 > 0;‚--) {

2079 
w
 |ğ
	`r¢_keymgmt
(
äm
);

2080 
äm
 += 4;

2081 
Ën
 -= 4;

2083 
w
 &ğ
r¢_·rm
->
r¢_keymgmt£t
;

2084 ià(
w
 == 0) {

2085 
	`IEEE80211_DISCARD_IE
(
v­
,

2086 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WPA
,

2087 
wh
, "RSN", "%s", "no‡cceptable key mgmt‡lg");

2088  
IEEE80211_REASON_IE_INVALID
;

2090 ià(
w
 & 
RSN_ASE_8021X_UNSPEC
)

2091 
r¢_·rm
->
r¢_keymgmt
 = 
RSN_ASE_8021X_UNSPEC
;

2093 
r¢_·rm
->
r¢_keymgmt
 = 
RSN_ASE_8021X_PSK
;

2096 ià(
Ën
 > 2)

2097 
r¢_·rm
->
r¢_ÿps
 = 
	`LE_READ_2
(
äm
);

2101 
	}
}

2105 
	$›“80211_§ve›
(
u_št8_t
 **
›p
, cÚ¡ u_št8_ˆ*
›
)

2107 ià((*
›p
 =ğ
NULL
è|| (
›
 == NULL) || ((*iep)[1] != ie[1])) {

2108 ià(*
›p
 !ğ
NULL
)

2109 
	`FREE
(*
›p
, 
M_DEVBUF
);

2110 *
›p
 = 
NULL
;

2111 ià(
›
 !ğ
NULL
)

2112 
	`MALLOC
(*
›p
, *, 
›
[1] + 2, 
M_DEVBUF
, 
M_NOWAIT
);

2114 ià((*
›p
 !ğ
NULL
è&& (
›
 != NULL))

2115 
	`memıy
(*
›p
, 
›
, ie[1] + 2);

2116 
	}
}

2117 
EXPORT_SYMBOL
(
›“80211_§ve›
);

2120 
	$›“80211_·r£_wme›
(
u_št8_t
 *
äm
, cÚ¡ 
›“80211_äame
 *
wh
,

2121 
›“80211_node
 *
ni
)

2123 
u_št
 
Ën
 = 
äm
[1];

2125 ià(
Ën
 != 7) {

2126 
	`IEEE80211_DISCARD_IE
(
ni
->
ni_v­
,

2127 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WME
,

2128 
wh
, "WME IE", "toØshÜt,†’ %u", 
Ën
);

2131 
ni
->
ni_u­sd
 = 
äm
[
WME_CAPINFO_IE_OFFSET
];

2132 ià(
ni
->
ni_u­sd
) {

2133 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_UAPSD
;

2134 
	`WME_UAPSD_MAXSP
(
ni
->
ni_u­sd
)) {

2136 
ni
->
ni_u­sd_max¥
 = 2; ;

2138 
ni
->
ni_u­sd_max¥
 = 4; ;

2140 
ni
->
ni_u­sd_max¥
 = 6; ;

2142 
ni
->
ni_u­sd_max¥
 = 
WME_UAPSD_NODE_MAXQDEPTH
;

2145 
	`IEEE80211_NOTE
(
ni
->
ni_v­
, 
IEEE80211_MSG_POWER
,‚i,

2146 "UAPSD b™ s‘tšg äom STA: %02x", 
ni
->
ni_u­sd
);

2149 
	}
}

2152 
	$›“80211_·r£_wm•¬ams
(
›“80211v­
 *
v­
, 
u_št8_t
 *
äm
,

2153 cÚ¡ 
›“80211_äame
 *
wh
, 
u_št8_t
 *
qosšfo
)

2155 
	#MS
(
_v
, 
_f
è(((_vè& _fè>> _f##
_S
)

	)

2156 
›“80211_wme_¡©e
 *
wme
 = &
v­
->
iv_ic
->
ic_wme
;

2157 
u_št
 
Ën
 = 
äm
[1], 
qosšfo_couÁ
;

2158 
i
;

2160 *
qosšfo
 = 0;

2162 ià(
Ën
 < (
›“80211_wme_·¿m
)-2) {

2163 
	`IEEE80211_DISCARD_IE
(
v­
,

2164 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_WME
,

2165 
wh
, "WME", "toØshÜt,†’ %u", 
Ën
);

2168 *
qosšfo
 = 
äm
[
	`__off£tof
(
›“80211_wme_·¿m
, 
·¿m_qosInfo
)];

2169 
qosšfo_couÁ
 = *
qosšfo
 & 
WME_QOSINFO_COUNT
;

2171 ià(
qosšfo_couÁ
 =ğ
wme
->
wme_wmeChªP¬ams
.
ÿp_šfo_couÁ
)

2173 
äm
 +ğ
	`__off£tof
(
›“80211_wme_·¿m
, 
·¿ms_acP¬ams
);

2174 
i
 = 0; i < 
WME_NUM_AC
; i++) {

2175 
wmeP¬ams
 *
wm•
 =

2176 &
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
];

2178 
wm•
->
wm•_acm
 = 
	`MS
(
äm
[0], 
WME_PARAM_ACM
);

2179 
wm•
->
wm•_aif¢
 = 
	`MS
(
äm
[0], 
WME_PARAM_AIFSN
);

2180 
wm•
->
wm•_logcwmš
 = 
	`MS
(
äm
[1], 
WME_PARAM_LOGCWMIN
);

2181 
wm•
->
wm•_logcwmax
 = 
	`MS
(
äm
[1], 
WME_PARAM_LOGCWMAX
);

2182 
wm•
->
wm•_txİLim™
 = 
	`LE_READ_2
(
äm
 + 2);

2183 
äm
 += 4;

2185 
wme
->
wme_wmeChªP¬ams
.
ÿp_šfo_couÁ
 = 
qosšfo_couÁ
;

2187 #undeà
MS


2188 
	}
}

2191 
	$›“80211_·r£_©hP¬ams
(
›“80211_node
 *
ni
, 
u_št8_t
 *
›
)

2193 #ifdeà
ATH_SUPERG_DYNTURBO


2194 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2195 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

2197 
›“80211_›_©hAdvC­
 *
©hIe
 =

2198 (
›“80211_›_©hAdvC­
 *)
›
;

2200 
ni
->
ni_©h_æags
 = 
©hIe
->
©hAdvC­_ÿ·b™y
;

2201 ià(
ni
->
ni_©h_æags
 & 
IEEE80211_ATHC_COMP
)

2202 
ni
->
ni_©h_defkeyšdex
 = 
	`LE_READ_2
(&
©hIe
->
©hAdvC­_defKeyIndex
);

2205 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_SUPG
, 
ni
,

2207 
©hIe
->
©hAdvC­_ÿ·b™y
, 
ni
->
ni_©h_æags
,

2208 
ni
->
ni_©h_defkeyšdex
);

2210 #ifdeà
ATH_SUPERG_DYNTURBO


2211 ià(
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_ATHC_TURBOP
)) {

2212 
u_št16_t
 
curæags
, 
Ãwæags
;

2218 
Ãwæags
 = 
curæags
 = 
ic
->
ic_bsschª
->
ic_æags
;

2220 ià(
©hIe
->
©hAdvC­_ÿ·b™y
 & 
IEEE80211_ATHC_BOOST
)

2221 
Ãwæags
 |ğ
IEEE80211_CHAN_TURBO
;

2223 
Ãwæags
 &ğ~
IEEE80211_CHAN_TURBO
;

2224 ià(
Ãwæags
 !ğ
curæags
)

2225 
	`›“80211_dturbo_sw™ch
(
ic
, 
Ãwæags
);

2228 
	}
}

2231 
	$fÜw¬d_mgmt_to_­p
(
›“80211v­
 *
v­
, 
subty³
, 
sk_buff
 *
skb
,

2232 
›“80211_äame
 *
wh
)

2234 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

2235 
f‹r_ty³
 = 0;

2237 
subty³
) {

2238 
IEEE80211_FC0_SUBTYPE_BEACON
:

2239 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_BEACON
;

2241 
IEEE80211_FC0_SUBTYPE_PROBE_REQ
:

2242 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_PROBE_REQ
;

2244 
IEEE80211_FC0_SUBTYPE_PROBE_RESP
:

2245 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_PROBE_RESP
;

2247 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
:

2248 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
:

2249 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_ASSOC_REQ
;

2251 
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
:

2252 
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
:

2253 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_ASSOC_RESP
;

2255 
IEEE80211_FC0_SUBTYPE_AUTH
:

2256 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_AUTH
;

2258 
IEEE80211_FC0_SUBTYPE_DEAUTH
:

2259 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_DEAUTH
;

2261 
IEEE80211_FC0_SUBTYPE_DISASSOC
:

2262 
f‹r_ty³
 = 
IEEE80211_FILTER_TYPE_DISASSOC
;

2268 ià(
f‹r_ty³
 && ((
v­
->
­p_f‹r
 & filter_type) == filter_type)) {

2269 
sk_buff
 *
skb1
;

2271 
skb1
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

2272 ià(
skb1
 =ğ
NULL
)

2275 
	`›“80211_skb_cİy_nod”ef
(
skb
, 
skb1
);

2276 
skb1
->
dev
 = dev;

2277 
	`skb_»£t_mac_h—d”
(
skb1
);

2279 
skb1
->
_summed
 = 
CHECKSUM_NONE
;

2280 
skb1
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

2281 
skb1
->
´ÙocŞ
 = 
	`__cÚ¡ªt_htÚs
(0x0019);

2283 
v­
->
iv_dev¡©s
.
rx_·ck‘s
++;

2284 
v­
->
iv_dev¡©s
.
rx_by‹s
 +ğ
skb1
->
Ën
;

2286 ià(
	`SKB_NI
(
skb1
è!ğ
NULL
)

2287 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb1
));

2288 ià(
	`Ãtif_rx
(
skb1
è=ğ
NET_RX_DROP
)

2289 
v­
->
iv_dev¡©s
.
rx_drİ³d
++;

2291 
	}
}

2294 
	$›“80211_§v—th
(
›“80211_node
 *
ni
, 
u_št8_t
 *
›
)

2296 cÚ¡ 
›“80211_›_©hAdvC­
 *
©hIe
 =

2297 (cÚ¡ 
›“80211_›_©hAdvC­
 *)
›
;

2299 
	`›“80211_§ve›
(&
ni
->
ni_©h_›
, 
›
);

2300 ià(
©hIe
 !ğ
NULL
) {

2301 
ni
->
ni_©h_æags
 = 
©hIe
->
©hAdvC­_ÿ·b™y
;

2302 ià(
ni
->
ni_©h_æags
 & 
IEEE80211_ATHC_COMP
)

2303 
ni
->
ni_©h_defkeyšdex
 = 
	`LE_READ_2
(&
©hIe
->
©hAdvC­_defKeyIndex
);

2305 
ni
->
ni_©h_æags
 = 0;

2306 
ni
->
ni_©h_defkeyšdex
 = 
IEEE80211_INVAL_DEFKEY
;

2308 
	}
}

2313 
	scouÁ_nodes_¬g
 {

2314 cÚ¡ 
	mk
;

2315 cÚ¡ *
	msub£t
;

2316 
	mcouÁ
;

2317 
›“80211_node
 *
	mÃw
;

2322 
	$couÁ_nodes
(*
_¬g
, 
›“80211_node
 *
ni
)

2324 
couÁ_nodes_¬g
 *
¬g
 = (couÁ_nodes_¬g *)
_¬g
;

2325 
i
;

2327 ià(
ni
->
ni_suµchªs
 =ğ
NULL
)

2330 ià(
ni
 =ğ
¬g
->
Ãw
)

2333 
i
 = 0; i < 
¬g
->
k
; i++)

2334 ià(
	`isşr
(
ni
->
ni_suµchªs
, 
¬g
->
sub£t
[
i
])) {

2335 
¬g
->
couÁ
++;

2338 
	}
}

2341 
	schªÃl_combš©iÚ_¬g
 {

2342 
›“80211com
 *
	mic
;

2343 
›“80211_node
 *
	mÃw
;

2344 *
	mbe¡
;

2345 
	mb’ef™
;

2348 #ifdeà
IEEE80211_DEBUG


2351 
	$šts_¥rštf
(cÚ¡ 
k
, cÚ¡ 
£t
[])

2353 
buf
[915];

2354 *
±r
 = 
buf
;

2355 
i
;

2356 
i
 = 0; i < 
k
; i++)

2357 
±r
 +ğ
	`¢´štf
ÕŒ, 
buf
 + (bufè-…Œ, "%d ", 
£t
[
i
]);

2358  
buf
;

2359 
	}
}

2365 
	$chªÃl_combš©iÚ
(cÚ¡ 
k
, cÚ¡ 
sub£t
[], *
_¬g
)

2367 
chªÃl_combš©iÚ_¬g
 *
¬g
 =

2368 (
chªÃl_combš©iÚ_¬g
 *)
_¬g
;

2369 
›“80211com
 *
ic
 = 
¬g
->ic;

2370 
couÁ_nodes_¬g
 
ú_¬g
 = { 
k
, 
sub£t
, 0, 
¬g
->
Ãw
 };

2371 
³rm
, 
®lowed
;

2372 
¡a_assoc
 = 
ic
->
ic_¡a_assoc
;

2375 
	`›“80211_™”©e_nodes
(&
¬g
->
ic
->
ic_¡a
,

2376 &
couÁ_nodes
, (*)&
ú_¬g
);

2381 ià(
ú_¬g
.
couÁ
 == 0) {

2382 
	`IEEE80211_NOTE
(
¬g
->
Ãw
->
ni_v­
, 
IEEE80211_MSG_ANY
,‡rg->new,

2387 ià(
¡a_assoc
 == 0) {

2388 
	`IEEE80211_NOTE
(
¬g
->
Ãw
->
ni_v­
, 
IEEE80211_MSG_ANY
,‡rg->new,

2394 
³rm
 = 1000 * 
ú_¬g
.
couÁ
 / 
¡a_assoc
;

2395 
®lowed
 = 
ic
->
ic_sc_¦cg
 * 
k
;

2397 ià(
®lowed
 > 1000)

2398 
®lowed
 = 1000;

2400 
	`IEEE80211_NOTE
(
¬g
->
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
|
IEEE80211_MSG_DOTH
,

2401 
¬g
->
Ãw
, "Making channels %savailable would„equire "

2402 "kickšg ouˆ%d stiÚs,", 
	`šts_¥rštf
(
k
, 
sub£t
),

2403 
ú_¬g
.
couÁ
);

2404 
	`IEEE80211_NOTE
(
¬g
->
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
|
IEEE80211_MSG_DOTH
,

2405 
¬g
->
Ãw
, "what is %d…ermils of‡ll‡ssociated STAs "

2406 "(¦cg…”m™ < %d).", 
³rm
, 
®lowed
);

2408 ià(
³rm
 > 
®lowed
)

2410 ià(
®lowed
 - 
³rm
 > 
¬g
->
b’ef™
) {

2411 
	`memıy
(
¬g
->
be¡
, 
sub£t
, 
k
 * (*subset));

2412 
¬g
->
b’ef™
 = 
®lowed
 - 
³rm
;

2414 
	}
}

2419 
combš©iÚs
(
n
, 
£t
[], 
k
,

2420 (*
ÿÎback
)(cÚ¡ , cÚ¡ [], *), *
¬g
)

2422 
sub£t
[
k
], 
pos
[k], 
i
;

2423 
i
 = 0; i < 
k
; i++)

2424 
pos
[
i
] = 0;

2425 
i
 = 0;

2426 
fÜw¬d
:

2427 ià(
i
 > 0) {

2428 
£t
[
pos
[
i
]] < 
sub£t
[˜- 1] &&…os[i] < 
n
)

2429 
pos
[
i
]++;

2430 ià(
pos
[
i
] =ğ
n
)

2431 
backw¬d
;

2433 
sub£t
[
i
] = 
£t
[
pos
[i]];

2434 
£t
[
pos
[
i
]] = s‘[
n
 - 1];

2435 
n
--;

2437 
i
++;

2438 ià(
i
 =ğ
k
) {

2439 
	`ÿÎback
(
k
, 
sub£t
, 
¬g
);

2441 
pos
[
i
] = 0;

2442 
fÜw¬d
;

2444 
backw¬d
:

2445 
i
--;

2446 ià(
i
 < 0)

2448 
£t
[
pos
[
i
]] = 
sub£t
[i];

2449 
n
++;

2451 
pos
[
i
]++;

2452 ià(
pos
[
i
] =ğ
n
)

2453 
backw¬d
;

2454 
fÜw¬d
;

2455 
	}
}

2457 
__šlše
 

2458 
	$fšd_wÜ£_nodes
(
›“80211com
 *
ic
, 
›“80211_node
 *
Ãw
)

2460 
i
, 
tmp1
, 
tmp2
;

2461 
u_št16_t
 
n_commÚ
, 
n_uncommÚ
;

2462 
u_št16_t
 
ú_tÙ®
 = 
ic
->
ic_ú_tÙ®
;

2463 
u_št16_t
 
to_gaš
;

2465 ià(
ú_tÙ®
 == 0)

2469 
n_commÚ
 = 
n_uncommÚ
 = 0;

2471 
	`CHANNEL_FOREACH
(
i
, 
ic
, 
tmp1
, 
tmp2
) {

2472 ià(
	`is£t
(
Ãw
->
ni_suµchªs_Ãw
, 
i
)) {

2473 ià(
ic
->
ic_chª_nodes
[
i
] =ğic->
ic_ú_tÙ®
) {

2474 
n_commÚ
++;

2476 
n_uncommÚ
++;

2481 
to_gaš
 = 
ic
->
ic_sc_mšcom
 - 
n_commÚ
 + 1;

2482 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DOTH
,

2483 
Ãw
, "By‡ccepting STA we would‚eedo gain‡t†east "

2484 "%d commÚ chªÃls.", 
to_gaš
);

2485 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DOTH
,

2486 
Ãw
, "%d channels supported byhe joining STA‡re "

2487 "nÙ commÚly suµÜ‹d by oth”s.", 
n_uncommÚ
);

2489 ià(
to_gaš
 > 
n_uncommÚ
) {

2490 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
 |

2491 
IEEE80211_MSG_DOTH
, 
Ãw
, "%s",

2498 
uncommÚ
[
n_uncommÚ
];

2499 
be¡
[
to_gaš
];

2500 
chªÃl_combš©iÚ_¬g
 
¬g
 = { 
ic
, 
Ãw
, 
be¡
, -1 };

2501 
j
 = 0;

2503 
	`CHANNEL_FOREACH
(
i
, 
ic
, 
tmp1
, 
tmp2
)

2504 ià(
	`is£t
(
Ãw
->
ni_suµchªs_Ãw
, 
i
) &&

2505 (
ic
->
ic_chª_nodes
[
i
] !=

2506 
ic
->
ic_ú_tÙ®
)) {

2507 ià(
j
 =ğ
n_uncommÚ
)

2510 
uncommÚ
[
j
++] = 
i
;

2513 
	`combš©iÚs
(
n_uncommÚ
, 
uncommÚ
, 
to_gaš
,

2514 &
chªÃl_combš©iÚ
, &
¬g
);

2515 ià(
¬g
.
b’ef™
 < 0) {

2516 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
 |

2517 
IEEE80211_MSG_DOTH
, 
Ãw
, "%s",

2522 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_ASSOC
 |

2523 
IEEE80211_MSG_DOTH
, 
Ãw
,

2526 
	`šts_¥rštf
(
to_gaš
, 
be¡
));

2528 ià(
Ãw
->
ni_Ãeded_chªs
 !ğ
NULL
)

2529 
	`FREE
(
Ãw
->
ni_Ãeded_chªs
, 
M_DEVBUF
);

2530 
	`MALLOC
(
Ãw
->
ni_Ãeded_chªs
, *,

2531 
to_gaš
 * (*
Ãw
->
ni_Ãeded_chªs
),

2532 
M_DEVBUF
, 
M_NOWAIT
);

2534 ià(
Ãw
->
ni_Ãeded_chªs
 =ğ
NULL
) {

2535 
	`IEEE80211_NOTE
(
Ãw
->
ni_v­
, 
IEEE80211_MSG_DEBUG
 |

2536 
IEEE80211_MSG_DOTH
, 
Ãw
, "%s",

2543 
i
 = 0; i < 
to_gaš
; i++)

2544 
Ãw
->
ni_Ãeded_chªs
[
i
] = 
be¡
[i];

2545 
Ãw
->
ni_n_Ãeded_chªs
 = 
to_gaš
;

2548 
	}
}

2551 
	$›“80211_·r£_sc_›
(
›“80211_node
 *
ni
, 
u_št8_t
 *
äm
,

2552 cÚ¡ 
›“80211_äame
 *
wh
)

2554 
›“80211_›_sc
 *
sc_›
 = (›“80211_›_sø*)
äm
;

2555 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

2556 #ifdeà
IEEE80211_DEBUG


2557 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2558 
»assoc
 = (
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
) ==

2559 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
;

2561 
i
, 
tmp1
, 
tmp2
;

2562 
couÁ
;

2564 ià(
sc_›
 =ğ
NULL
) {

2565 ià(
ni
->
ni_ic
->
ic_sc_®gÜ™hm
 =ğ
IEEE80211_SC_STRICT
) {

2566 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2567 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2570 
»assoc
 ? "reassoc" : "assoc");

2571  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2573 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2574 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2576 
»assoc
 ? "reassoc" : "assoc");

2577  
IEEE80211_STATUS_SUCCESS
;

2579 ià(
sc_›
->
sc_Ën
 % 2 != 0) {

2580 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2581 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2584 
»assoc
 ? "reassoc" : "assoc");

2586  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2588 ià(
ni
->
ni_suµchªs_Ãw
 =ğ
NULL
) {

2589 
	`MALLOC
(
ni
->
ni_suµchªs_Ãw
, *, 
IEEE80211_CHAN_BYTES
,

2590 
M_DEVBUF
, 
M_NOWAIT
);

2591 ià(
ni
->
ni_suµchªs_Ãw
 =ğ
NULL
) {

2592 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2593 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2596 
»assoc
 ? "reassoc" : "assoc");

2597  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2600 
	`mem£t
(
ni
->
ni_suµchªs_Ãw
, 0, 
IEEE80211_CHAN_BYTES
);

2601 
i
 = 0; i < (
sc_›
->
sc_Ën
 / 2); i++) {

2602 
u_št8_t
 
chª
 = 
sc_›
->
sc_subbªd
[
i
].
sc_fœ¡
;

2605 
u_št8_t
 
¡•
 = (
chª
 <= 14 ? 1 : 4);

2606 
u_št16_t
 
Ï¡
 = 
chª
 + 
¡•
 *

2607 (
sc_›
->
sc_subbªd
[
i
].
sc_numb”
 - 1);

2610 ià((
Ï¡
 < 
chª
) || ((chan <= 14) && (last > 14)) ||

2611 (
chª
 > 14 && 
Ï¡
 > 200)) {

2613 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2614 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2617 
»assoc
 ? "reassoc" : "assoc",

2618 
chª
, 
Ï¡
);

2619  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2622 ; 
chª
 <ğ
Ï¡
; chª +ğ
¡•
)

2623 
	`£tb™
(
ni
->
ni_suµchªs_Ãw
, 
chª
);

2627 ià(
	`isşr
(
ni
->
ni_suµchªs_Ãw
, 
ic
->
ic_bsschª
->
ic_›“
)) {

2628 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2629 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2632 
»assoc
 ? "reassoc" : "assoc");

2633  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2636 ià((
ic
->
ic_sc_®gÜ™hm
 !ğ
IEEE80211_SC_TIGHT
) &&

2637 (
ic
->
ic_sc_®gÜ™hm
 !ğ
IEEE80211_SC_STRICT
))

2638 
sucûss
;

2642 
couÁ
 = 0;

2643 
	`CHANNEL_FOREACH
(
i
, 
ic
, 
tmp1
, 
tmp2
)

2644 ià(
	`is£t
(
ni
->
ni_suµchªs_Ãw
, 
i
) && (

2645 
ic
->
ic_chª_nodes
[
i
] =ğic->
ic_ú_tÙ®
))

2646 
couÁ
++;

2648 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DOTH
,

2649 
wh
->
i_addr2
, "%s„equest: %d common channels, %d "

2650 "»quœed", 
»assoc
 ? "reassoc" : "assoc",

2651 
couÁ
, 
ic
->
ic_sc_mšcom
);

2652 ià(
couÁ
 < 
ic
->
ic_sc_mšcom
) {

2654 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DOTH
,

2655 
wh
->
i_addr2
, "%s„equest:‚otƒnough common "

2657 "’gaged", 
»assoc
 ? "reassoc" : "assoc");

2659 ià(!
	`fšd_wÜ£_nodes
(
ic
, 
ni
)) {

2660 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
 |

2661 
IEEE80211_MSG_DOTH
, 
wh
->
i_addr2
,

2664 
»assoc
 ? "reassoc" : "assoc");

2665  
IEEE80211_STATUS_SUPPCHAN_UNACCEPTABLE
;

2669 
sucûss
:

2670 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_DOTH
 | 
IEEE80211_MSG_ASSOC
 |

2671 
IEEE80211_MSG_ELEMID
, 
wh
->
i_addr2
,

2673  
IEEE80211_STATUS_SUCCESS
;

2674 
	}
}

2677 
›“80211_chªÃl
 *

2678 
	$›“80211_dÙh_fšdchª
(
›“80211v­
 *
v­
, 
u_št8_t
 
chª
)

2680 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2681 
›“80211_chªÃl
 *
c
;

2682 
æags
, 
äeq
;

2685 
æags
 = 
ic
->
ic_bsschª
->
ic_æags
 & 
IEEE80211_CHAN_ALL
;

2686 
äeq
 = 
	`›“80211_›“2mhz
(
chª
, 0);

2687 
c
 = 
	`›“80211_fšd_chªÃl
(
ic
, 
äeq
, 
æags
);

2688 ià(
c
 =ğ
NULL
)

2689 
c
 = 
	`›“80211_fšd_chªÃl
(
ic
, 
äeq
, 0);

2690  
c
;

2691 
	}
}

2694 
	$›“80211_dÙh_ÿnûl_cs
(
›“80211v­
 *
v­
)

2696 
	`d–_tim”
(&
v­
->
iv_c§_tim”
);

2697 ià(
v­
->
iv_c§_jiff›s
)

2698 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2701 
v­
->
iv_c§_chª
->
ic_›“
,

2702 
v­
->
iv_c§_chª
->
ic_äeq
,

2703 
v­
->
iv_c§_couÁ
, v­->
iv_c§_mode
);

2704 
v­
->
iv_c§_jiff›s
 = 0;

2705 
	}
}

2708 
	$›“80211_dÙh_sw™ch_chªÃl
(
›“80211v­
 *
v­
)

2710 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2712 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2714 
__func__
,

2715 
v­
->
iv_c§_chª
->
ic_›“
,

2716 
v­
->
iv_c§_chª
->
ic_äeq
);

2725 
	`Ãtif_¡İ_queue
(
ic
->
ic_dev
);

2728 
v­
->
iv_c§_jiff›s
 = 0;

2729 
	`›“80211_dÙh_ÿnûl_cs
(
v­
);

2731 
ic
->
ic_curchª
 = ic->
ic_bsschª
 = 
v­
->
iv_c§_chª
;

2732 
ic
->
	`ic_£t_chªÃl
(ic);

2733 
	}
}

2736 
	$›“80211_dÙh_sw™ch_chªÃl_tmr
(
¬g
)

2738 
›“80211v­
 *
v­
 = (›“80211v­ *)
¬g
;

2739 
	`›“80211_dÙh_sw™ch_chªÃl
(
v­
);

2740 
	}
}

2743 
	$›“80211_·r£_c§›
(
›“80211_node
 *
ni
, 
u_št8_t
 *
äm
,

2744 cÚ¡ 
›“80211_äame
 *
wh
)

2746 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2747 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2748 
›“80211_chªÃl
 *
c
;

2749 
›“80211_›_c§
 *
c§_›
 = (›“80211_›_c§ *)
äm
;

2751 ià(!
äm
) {

2755 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2757 "B—cÚ w™houˆCSA IE!\n", 
__func__
);

2759 
	`›“80211_dÙh_ÿnûl_cs
(
v­
);

2763 ià(
c§_›
->
c§_Ën
 != 3) {

2764 
	`IEEE80211_DISCARD_IE
(
v­
,

2765 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_DOTH
,

2766 
wh
, "channel switch", "invalid†ength %u",

2767 
c§_›
->
c§_Ën
);

2771 ià(
	`isşr
(
ic
->
ic_chª_ava
, 
c§_›
->
c§_chª
)) {

2772 
	`IEEE80211_DISCARD_IE
(
v­
,

2773 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_DOTH
,

2774 
wh
, "channel switch", "invalid channel %u",

2775 
c§_›
->
c§_chª
);

2779 ià((
c
 = 
	`›“80211_dÙh_fšdchª
(
v­
, 
c§_›
->
c§_chª
)è=ğ
NULL
) {

2781 
	`IEEE80211_DISCARD_IE
(
v­
,

2782 
IEEE80211_MSG_ELEMID
 | 
IEEE80211_MSG_DOTH
,

2783 
wh
, "channel switch",

2784 "chªÃÈ%u†ooku°çed", 
c§_›
->
c§_chª
);

2788 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2790 
__func__
, 
c§_›
->
c§_chª
, c§_›->
c§_couÁ
,

2791 
c§_›
->
c§_mode
);

2793 ià(
v­
->
iv_c§_jiff›s
) {

2795 ià(
c
 !ğ
v­
->
iv_c§_chª
) {

2797 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2800 
__func__
,

2801 
v­
->
iv_c§_chª
->
ic_›“
,

2802 
v­
->
iv_c§_chª
->
ic_äeq
,

2803 
c§_›
->
c§_chª
);

2805 ià(
v­
->
iv_c§_couÁ
 > 
IEEE80211_CSA_PROTECTION_PERIOD
)

2806 
	`›“80211_dÙh_ÿnûl_cs
(
v­
);

2810 ià(
c§_›
->
c§_mode
 !ğ
v­
->
iv_c§_mode
) {

2816 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2818 "%uØ%u!\n", 
__func__
,

2819 
v­
->
iv_c§_mode
, 
c§_›
->
c§_mode
);

2822 ià(
c§_›
->
c§_couÁ
 >ğ
v­
->
iv_c§_couÁ
) {

2824 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2826 "deü—£ (%u -> %u)!\n", 
__func__
,

2827 
v­
->
iv_c§_couÁ
, 
c§_›
->
c§_couÁ
);

2832 
u_št32_t
 
–­£d
 = 
	`IEEE80211_JIFFIES_TO_TU
(

2833 
jiff›s
 - 
v­
->
iv_c§_jiff›s
);

2834 
u_št32_t
 
út_diff
 = 
v­
->
iv_c§_couÁ
 -

2835 
c§_›
->
c§_couÁ
;

2836 
u_št32_t
 
ex³ùed
 = 
ni
->
ni_štv®
 * 
út_diff
;

2837 
št32_t
 
d–
 = 
–­£d
 - 
ex³ùed
;

2838 ià(
d–
 < 0)

2839 
d–
 = -delta;

2840 ià(
d–
 > 
IEEE80211_CSA_SANITY_THRESHOLD
) {

2843 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

2846 " = %u TUs)\n", 
__func__
,

2847 
–­£d
 / 
ni
->
ni_štv®
,

2848 
–­£d
 * 100 / 
ni
->
ni_štv®


2849 % 100, 
út_diff
, 
d–
);

2851 
	`›“80211_dÙh_ÿnûl_cs
(
v­
);

2856 
v­
->
iv_c§_couÁ
 = 
c§_›
->
c§_couÁ
;

2857 
	`mod_tim”
(&
v­
->
iv_c§_tim”
, 
jiff›s
 +

2858 
	`IEEE80211_TU_TO_JIFFIES
(
v­
->
iv_c§_couÁ


2859 * 
ni
->
ni_štv®
 + 10));

2867 ià(
c§_›
->
c§_couÁ
 < 
IEEE80211_CSA_PROTECTION_PERIOD
) {

2868 
	`IEEE80211_DISCARD_IE
(
v­
,

2869 
IEEE80211_MSG_ELEMID
 |

2870 
IEEE80211_MSG_DOTH
,

2871 
wh
, "channel switch",

2874 
c§_›
->
c§_couÁ
);

2879 
v­
->
iv_c§_mode
 = 
c§_›
->
c§_mode
;

2880 
v­
->
iv_c§_couÁ
 = 
c§_›
->
c§_couÁ
;

2881 
v­
->
iv_c§_chª
 = 
c
;

2883 
v­
->
iv_c§_tim”
.
funùiÚ
 = 
›“80211_dÙh_sw™ch_chªÃl_tmr
;

2884 
v­
->
iv_c§_tim”
.
d©a
 = ()vap;

2885 
	`mod_tim”
(&
v­
->
iv_c§_tim”
, 
jiff›s
 + 
	`IEEE80211_TU_TO_JIFFIES
(

2886 
v­
->
iv_c§_couÁ
 * 
ni
->
ni_štv®
 + 10));

2889 
v­
->
iv_c§_jiff›s
 = 
jiff›s
;

2891 ià(
v­
->
iv_c§_couÁ
 <= 1)

2892 
	`›“80211_dÙh_sw™ch_chªÃl
(
v­
);

2895 
	}
}

2898 
	sl2_upd©e_äame
 {

2899 
u8
 
	mda
[
ETH_ALEN
];

2900 
u8
 
	m§
[
ETH_ALEN
];

2901 
__be16
 
	mËn
;

2902 
u8
 
	md§p
;

2903 
u8
 
	ms§p
;

2904 
u8
 
	mcÚŒŞ
;

2905 
u8
 
	mxid_šfo
[3];

2906 } 
__©Œibu‹__
 ((
·cked
));

2910 
	$›“80211_d–iv”_l2_ºr
(
›“80211_node
 *
ni
)

2912 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2913 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

2914 
sk_buff
 *
skb
;

2915 
l2_upd©e_äame
 *
l2uf
;

2917 
skb
 = 
	`›“80211_dev_®loc_skb
((*
l2uf
));

2918 ià(
skb
 =ğ
NULL
) {

2921 
	`skb_put
(
skb
, (*
l2uf
));

2922 
l2uf
 = (
l2_upd©e_äame
 *)(
skb
->
d©a
);

2924 
	`memıy
(
l2uf
->
da
, 
dev
->
brßdÿ¡
, 
ETH_ALEN
);

2926 
	`memıy
(
l2uf
->
§
, 
ni
->
ni_maÿddr
, 
ETH_ALEN
);

2927 
l2uf
->
Ën
 = 
	`htÚs
(6);

2928 
l2uf
->
d§p
 = 0;

2929 
l2uf
->
s§p
 = 0;

2930 
l2uf
->
cÚŒŞ
 = 0xf5;

2931 
l2uf
->
xid_šfo
[0] = 0x81;

2932 
l2uf
->
xid_šfo
[1] = 0x80;

2933 
l2uf
->
xid_šfo
[2] = 0x00;

2935 
skb
->
dev
 = dev;

2938 
skb
->
pkt_ty³
 = 
PACKET_BROADCAST
;

2939 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_2
);

2940 
	`skb_»£t_mac_h—d”
(
skb
);

2942 
	`›“80211_d–iv”_d©a
(
ni
, 
skb
);

2944 
	}
}

2947 
	$›“80211_d–iv”_l2_xid
(
›“80211_node
 *
ni
)

2949 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2950 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

2951 
sk_buff
 *
skb
;

2952 
l2_upd©e_äame
 *
l2uf
;

2954 
skb
 = 
	`›“80211_dev_®loc_skb
((*
l2uf
));

2955 ià(
skb
 =ğ
NULL
) {

2959 
	`skb_put
(
skb
, (*
l2uf
));

2960 
l2uf
 = (
l2_upd©e_äame
 *)(
skb
->
d©a
);

2962 
	`memıy
(
l2uf
->
da
, 
dev
->
brßdÿ¡
, 
ETH_ALEN
);

2964 
	`memıy
(
l2uf
->
§
, 
ni
->
ni_maÿddr
, 
ETH_ALEN
);

2965 
l2uf
->
Ën
 = 
	`htÚs
(6);

2966 
l2uf
->
d§p
 = 0x00;

2967 
l2uf
->
s§p
 = 0x01;

2968 
l2uf
->
cÚŒŞ
 = 0xaf;

2970 
l2uf
->
xid_šfo
[0] = 0x81;

2971 
l2uf
->
xid_šfo
[1] = 1;

2972 
l2uf
->
xid_šfo
[2] = 1 << 1;

2974 
skb
->
dev
 = dev;

2977 
skb
->
pkt_ty³
 = 
PACKET_BROADCAST
;

2978 
skb
->
´ÙocŞ
 = 
	`htÚs
(
ETH_P_802_2
);

2979 
	`skb_»£t_mac_h—d”
(
skb
);

2981 
	`›“80211_d–iv”_d©a
(
ni
, 
skb
);

2983 
	}
}

2985 
__šlše
 

2986 
	$cÚtbgsÿn
(
›“80211v­
 *
v­
)

2988 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2990  ((
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_BGSCAN
) &&

2991 
	`time_aá”
(
jiff›s
, 
ic
->
ic_Ï¡d©a
 + 
v­
->
iv_bgsÿnidË
));

2992 
	}
}

2994 
__šlše
 

2995 
	$¡¬tbgsÿn
(
›“80211v­
 *
v­
)

2997 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2999  ((
v­
->
iv_æags
 & 
IEEE80211_F_BGSCAN
) &&

3000 !
	`IEEE80211_IS_CHAN_DTURBO
(
ic
->
ic_curchª
) &&

3001 
	`time_aá”
(
jiff›s
, 
ic
->
ic_Ï¡sÿn
 + 
v­
->
iv_bgsÿnštvl
) &&

3002 
	`time_aá”
(
jiff›s
, 
ic
->
ic_Ï¡d©a
 + 
v­
->
iv_bgsÿnidË
));

3003 
	}
}

3010 
	$›“80211_»cv_mgmt
(
›“80211v­
 *
v­
,

3011 
›“80211_node
 *
ni_Ü_nuÎ
, 
sk_buff
 *
skb
,

3012 
subty³
, 
rssi
, 
u_št64_t
 
¹sf
)

3014 
	#ISPROBE
(
_¡
è((_¡è=ğ
IEEE80211_FC0_SUBTYPE_PROBE_RESP
)

	)

3015 
	#ISREASSOC
(
_¡
è((_¡è=ğ
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
)

	)

3016 
›“80211_node
 * 
ni
 = 
ni_Ü_nuÎ
;

3017 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3018 
›“80211_äame
 *
wh
;

3019 
u_št8_t
 *
äm
, *
eäm
;

3020 
u_št8_t
 *
ssid
, *
¿‹s
, *
x¿‹s
, *
suµchª
, *
w·
, *
r¢
, *
wme
, *
©h
;

3021 
u_št8_t
 
¿‹
;

3022 
»assoc
, 
»¥
, 
®locbs
 = 0;

3023 
u_št8_t
 
qosšfo
;

3025 ià(
ni_Ü_nuÎ
 =ğ
NULL
)

3026 
ni
 = 
v­
->
iv_bss
;

3028 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

3029 
äm
 = (
u_št8_t
 *)&
wh
[1];

3030 
eäm
 = 
skb
->
d©a
 + skb->
Ën
;

3032 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

3033 "%s: v­:%p[" 
MAC_FMT
 "]‚i:%p[" MAC_FMT "]\n",

3034 
__func__
, 
v­
, 
	`MAC_ADDR
(v­->
iv_bssid
),

3035 
ni_Ü_nuÎ
, 
	`MAC_ADDR
(
wh
->
i_addr2
));

3038 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_MONITOR
)

3039 
	`fÜw¬d_mgmt_to_­p
(
v­
, 
subty³
, 
skb
, 
wh
);

3041 
subty³
) {

3042 
IEEE80211_FC0_SUBTYPE_PROBE_RESP
:

3043 
IEEE80211_FC0_SUBTYPE_BEACON
: {

3044 
›“80211_sÿÅ¬ams
 
sÿn
;

3054 ià(!((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) ||

3055 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 && 
ni
->
ni_associd
) ||

3056 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)) {

3057 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

3075 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, 12);

3076 
	`mem£t
(&
sÿn
, 0, (scan));

3077 
sÿn
.
t¡amp
 = 
äm
;

3078 
äm
 += 8;

3079 
sÿn
.
bštv®
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3080 
äm
 += 2;

3081 
sÿn
.
ÿpšfo
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3082 
äm
 += 2;

3083 
sÿn
.
bchª
 = 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
);

3084 
sÿn
.
chª
 = sÿn.
bchª
;

3086 
äm
 < 
eäm
) {

3088 ià((*
äm
 =ğ
IEEE80211_ELEMID_AGERE1
) ||

3089 (*
äm
 =ğ
IEEE80211_ELEMID_AGERE2
)) {

3090 
äm
 = 
eäm
;

3094 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, frm[1]);

3095 *
äm
) {

3096 
IEEE80211_ELEMID_SSID
:

3097 
sÿn
.
ssid
 = 
äm
;

3099 
IEEE80211_ELEMID_RATES
:

3100 
sÿn
.
¿‹s
 = 
äm
;

3102 
IEEE80211_ELEMID_COUNTRY
:

3103 
sÿn
.
couÁry
 = 
äm
;

3105 
IEEE80211_ELEMID_FHPARMS
:

3106 ià(
ic
->
ic_phyty³
 =ğ
IEEE80211_T_FH
) {

3107 
sÿn
.
fhdw–l
 = 
	`LE_READ_2
(&
äm
[2]);

3108 
sÿn
.
chª
 = 
	`IEEE80211_FH_CHAN
(
äm
[4],

3109 
äm
[5]);

3110 
sÿn
.
fhšdex
 = 
äm
[6];

3113 
IEEE80211_ELEMID_DSPARMS
:

3118 ià(
ic
->
ic_phyty³
 !ğ
IEEE80211_T_FH
)

3119 
sÿn
.
chª
 = 
äm
[2];

3121 
IEEE80211_ELEMID_TIM
:

3123 
sÿn
.
tim
 = 
äm
;

3124 
sÿn
.
timoff
 = 
äm
 - 
skb
->
d©a
;

3126 
IEEE80211_ELEMID_IBSSPARMS
:

3128 
IEEE80211_ELEMID_XRATES
:

3129 
sÿn
.
x¿‹s
 = 
äm
;

3131 
IEEE80211_ELEMID_ERP
:

3132 ià(
äm
[1] != 1) {

3133 
	`IEEE80211_DISCARD_IE
(
v­
,

3134 
IEEE80211_MSG_ELEMID
, 
wh
, "ERP",

3135 "bad†’ %u", 
äm
[1]);

3136 
v­
->
iv_¡©s
.
is_rx_–em_toobig
++;

3139 
sÿn
.
”p
 = 
äm
[2];

3141 
IEEE80211_ELEMID_RSN
:

3142 
sÿn
.
r¢
 = 
äm
;

3144 
IEEE80211_ELEMID_VENDOR
:

3145 ià(
	`isw·oui
(
äm
))

3146 
sÿn
.
w·
 = 
äm
;

3147 ià(
	`iswm•¬am
(
äm
è|| 
	`iswmešfo
(frm))

3148 
sÿn
.
wme
 = 
äm
;

3149 ià(
	`i§th”osoui
(
äm
))

3150 
sÿn
.
©h
 = 
äm
;

3152 
IEEE80211_ELEMID_CHANSWITCHANN
:

3153 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
)

3154 
sÿn
.
c§
 = 
äm
;

3157 
	`IEEE80211_DISCARD_IE
(
v­
, 
IEEE80211_MSG_ELEMID
,

3158 
wh
, "unhandled",

3159 "id %u,†’ %u", *
äm
, frm[1]);

3160 
v­
->
iv_¡©s
.
is_rx_–em_unknown
++;

3163 
äm
 += frm[1] + 2;

3165 ià(
äm
 > 
eäm
)

3167 
	`IEEE80211_VERIFY_ELEMENT
(
sÿn
.
¿‹s
, 
IEEE80211_RATE_MAXSIZE
);

3168 
	`IEEE80211_VERIFY_ELEMENT
(
sÿn
.
ssid
, 
IEEE80211_NWID_LEN
);

3169 #ià
IEEE80211_CHAN_MAX
 < 255

3170 ià(
sÿn
.
chª
 > 
IEEE80211_CHAN_MAX
) {

3171 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ELEMID
,

3172 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

3173 
IEEE80211_FC0_SUBTYPE_SHIFT
],

3174 "šv®id chªÃÈ%u", 
sÿn
.
chª
);

3175 
v­
->
iv_¡©s
.
is_rx_badchª
++;

3179 ià(
sÿn
.
chª
 !ğsÿn.
bchª
 &&

3180 
ic
->
ic_phyty³
 !ğ
IEEE80211_T_FH
) {

3191 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ELEMID
,

3192 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

3193 
IEEE80211_FC0_SUBTYPE_SHIFT
],

3194 "fÜ off-chªÃÈ%u", 
sÿn
.
chª
);

3195 
v­
->
iv_¡©s
.
is_rx_chªmism©ch
++;

3204 ià(!
	`IEEE80211_BINTVAL_VALID
(
sÿn
.
bštv®
)) {

3205 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_SCAN
,

3206 
wh
, "beacon", "invalid beacon interval (%u)",

3207 
sÿn
.
bštv®
);

3214 ià(
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_BEACON
)

3215 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_b—cÚs
);

3217 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_´ob”e¥
);

3224 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 &&

3225 
ni
->
ni_associd
 != 0 &&

3226 
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr2
, 
v­
->
iv_bssid
)) {

3228 
	`memıy
(
ni
->
ni_t¡amp
.
d©a
, 
sÿn
.
t¡amp
,

3229 (
ni
->
ni_t¡amp
));

3230 ià(
ni
->
ni_štv®
 !ğ
sÿn
.
bštv®
) {

3231 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

3234 
ni
->
ni_štv®
, 
sÿn
.
bštv®
);

3235 ià(!
ni
->
ni_štv®_’d
) {

3236 
m£cs
 = 0;

3237 
ni
->
ni_štv®_út
 = 0;

3238 
ni
->
ni_štv®_Şd
 =‚i->
ni_štv®
;

3239 
m£cs
 = (
ni
->
ni_štv®_Şd
 * 1024 * 10) /

3241 
ni
->
ni_štv®_’d
 = 
jiff›s
 +

3242 
	`m£cs_to_jiff›s
(
m£cs
);

3243 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
,

3244 
ni
, "scheduling beacon "

3247 
m£cs
);

3249 ià(
sÿn
.
bštv®
 > 
ni
->
ni_štv®
) {

3250 
ni
->
ni_štv®
 = 
sÿn
.
bštv®
;

3251 
v­
->
iv_æags_ext
 |=

3252 
IEEE80211_FEXT_APPIE_UPDATE
;

3256 ià(
ni
->
ni_štv®_’d
) {

3257 ià(
sÿn
.
bštv®
 =ğ
ni
->
ni_štv®_Şd
)

3258 
ni
->
ni_štv®_út
++;

3259 ià(!
	`time_befÜe
(
jiff›s
, 
ni
->
ni_štv®_’d
)) {

3260 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
,

3261 
ni
, "beacon interval "

3265 
ni
->
ni_štv®_út
);

3266 
ni
->
ni_štv®_’d
 = 0;

3267 ià(
ni
->
ni_štv®_út
 == 0) {

3268 
	`IEEE80211_NOTE
(
v­
,

3269 
IEEE80211_MSG_ASSOC
, 
ni
,

3272 
ni
->
ni_štv®_Şd
,

3273 
sÿn
.
bštv®
);

3274 
ni
->
ni_štv®
 = 
sÿn
.
bštv®
;

3275 
v­
->
iv_æags_ext
 |=

3276 
IEEE80211_FEXT_APPIE_UPDATE
;

3278 
	`IEEE80211_NOTE
(
v­
,

3279 
IEEE80211_MSG_ASSOC
, 
ni
,

3287 ià(
ni
->
ni_”p
 !ğ
sÿn
.
”p
) {

3288 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

3290 
ni
->
ni_”p
, 
sÿn
.
”p
);

3291 ià(
sÿn
.
”p
 & 
IEEE80211_ERP_USE_PROTECTION
)

3292 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEPROT
;

3294 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEPROT
;

3295 
ni
->
ni_”p
 = 
sÿn
.
”p
;

3298 ià((
ni
->
ni_ÿpšfo
 ^ 
sÿn
.
ÿpšfo
) &

3299 
IEEE80211_CAPINFO_SHORT_SLOTTIME
) {

3300 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

3302 
ni
->
ni_ÿpšfo
, 
sÿn
.
ÿpšfo
);

3307 
	`›“80211_£t_shÜt¦Ùtime
(
ic
,

3308 
	`IEEE80211_IS_CHAN_A
(
ic
->
ic_bsschª
) ||

3309 (
ni
->
ni_ÿpšfo
 &

3310 
IEEE80211_CAPINFO_SHORT_SLOTTIME
));

3311 
ni
->
ni_ÿpšfo
 = 
sÿn
.
ÿpšfo
;

3314 ià(
sÿn
.
wme
 !ğ
NULL
 &&

3315 (
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
)) {

3316 
_»tv®
;

3317 ià((
_»tv®
 = 
	`›“80211_·r£_wm•¬ams
(

3318 
v­
, 
sÿn
.
wme
,

3319 
wh
, &
qosšfo
)) >= 0) {

3320 ià(
qosšfo
 & 
WME_CAPINFO_UAPSD_EN
)

3321 
ni
->
ni_æags
 |=

3322 
IEEE80211_NODE_UAPSD
;

3323 ià(
_»tv®
 > 0)

3324 
	`›“80211_wme_upd©•¬ams
(
v­
);

3327 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_UAPSD
;

3328 ià(
sÿn
.
©h
 !ğ
NULL
)

3329 
	`›“80211_·r£_©hP¬ams
(
ni
, 
sÿn
.
©h
);

3330 ià(
sÿn
.
c§
 !ğ
NULL
 || 
v­
->
iv_c§_jiff›s
)

3331 
	`›“80211_·r£_c§›
(
ni
, 
sÿn
.
c§
, 
wh
);

3332 ià(
sÿn
.
tim
 !ğ
NULL
) {

3337 
›“80211_tim_›
 *
tim
 =

3338 (
›“80211_tim_›
 *)
sÿn
.
tim
;

3339 
aid
 = 
	`IEEE80211_AID
(
ni
->
ni_associd
);

3340 
ix
 = 
aid
 / 
NBBY
;

3341 
mš
 = 
tim
->
tim_b™ùl
 &~ 1;

3342 
max
 = 
tim
->
tim_Ën
 + 
mš
 - 4;

3343 ià((
tim
->
tim_b™ùl
&1) ||

3344 (
mš
 <ğ
ix
 && ix <ğ
max
 &&

3345 
	`is£t
(
tim
->
tim_b™m­
 - 
mš
, 
aid
)))

3346 
	`›“80211_¡a_pwr§ve
(
v­
, 0);

3347 
v­
->
iv_dtim_couÁ
 = 
tim
->
tim_couÁ
;

3352 ià((
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) &&

3353 (
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_SWBMISS
)) {

3354 
	`mod_tim”
(&
v­
->
iv_swbmiss
,

3355 
jiff›s
 + 
v­
->
iv_swbmiss_³riod
);

3370 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
)

3371 
	`›“80211_add_sÿn
(
v­
, &
sÿn
, 
wh
,

3372 
subty³
, 
rssi
, 
¹sf
);

3373 ià(
	`cÚtbgsÿn
(
v­
è|| 
	`¡¬tbgsÿn
(vap))

3374 
	`›“80211_bg_sÿn
(
v­
);

3380 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) {

3381 
	`›“80211_add_sÿn
(
v­
, &
sÿn
, 
wh
, 
subty³
, 
rssi
, 
¹sf
);

3384 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) &&

3385 (
sÿn
.
ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
)) {

3386 ià(
ni_Ü_nuÎ
 =ğ
NULL
) {

3388 
ni
 = 
	`›“80211_add_ÃighbÜ
(
v­
, 
wh
, &
sÿn
);

3389 ià(
ni
 =ğ
NULL
)

3398 
ni
->
ni_es¦’
 = 
sÿn
.
ssid
[1];

3399 
	`memıy
(
ni
->
ni_essid
, 
sÿn
.
ssid
 + 2, scan.ssid[1]);

3400 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
wh
->
i_addr3
);

3401 
	`memıy
(
ni
->
ni_t¡amp
.
d©a
, 
sÿn
.
t¡amp
,

3402 (
ni
->
ni_t¡amp
));

3403 
ni
->
ni_štv®
 =

3404 
	`IEEE80211_BINTVAL_SANITISE
(
sÿn
.
bštv®
);

3405 
ni
->
ni_ÿpšfo
 = 
sÿn
.
ÿpšfo
;

3406 
ni
->
ni_chª
 = 
ic
->
ic_curchª
;

3407 
ni
->
ni_fhdw–l
 = 
sÿn
.
fhdw–l
;

3408 
ni
->
ni_fhšdex
 = 
sÿn
.
fhšdex
;

3409 
ni
->
ni_”p
 = 
sÿn
.
”p
;

3410 
ni
->
ni_timoff
 = 
sÿn
.
timoff
;

3411 ià(
sÿn
.
wme
 !ğ
NULL
)

3412 
	`›“80211_§ve›
(&
ni
->
ni_wme_›
, 
sÿn
.
wme
);

3413 ià(
sÿn
.
w·
 !ğ
NULL
)

3414 
	`›“80211_§ve›
(&
ni
->
ni_w·_›
, 
sÿn
.
w·
);

3415 ià(
sÿn
.
r¢
 !ğ
NULL
)

3416 
	`›“80211_§ve›
(&
ni
->
ni_r¢_›
, 
sÿn
.
r¢
);

3417 ià(
sÿn
.
©h
 !ğ
NULL
)

3418 
	`›“80211_§v—th
(
ni
, 
sÿn
.
©h
);

3421 
	`›“80211_£tup_¿‹s
(
ni
, 
sÿn
.
¿‹s
,

3422 
sÿn
.
x¿‹s
, 
IEEE80211_F_DOSORT
);

3424 ià(
ni
 !ğ
NULL
) {

3425 
ni
->
ni_rssi
 = 
rssi
;

3426 
ni
->
ni_¹sf
 = 
¹sf
;

3427 
ni
->
ni_Ï¡_rx
 = 
jiff›s
;

3433 
IEEE80211_FC0_SUBTYPE_PROBE_REQ
:

3434 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ||

3435 
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
 ||

3436 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
) {

3437 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

3440 ià(
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr2
)) {

3442 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

3449 #ifdeà
ATH_SUPERG_XR


3450 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XR
)

3460 
ssid
 = 
¿‹s
 = 
x¿‹s
 = 
©h
 = 
NULL
;

3461 
äm
 < 
eäm
) {

3462 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, frm[1]);

3463 *
äm
) {

3464 
IEEE80211_ELEMID_SSID
:

3465 
ssid
 = 
äm
;

3467 
IEEE80211_ELEMID_RATES
:

3468 
¿‹s
 = 
äm
;

3470 
IEEE80211_ELEMID_XRATES
:

3471 
x¿‹s
 = 
äm
;

3473 
IEEE80211_ELEMID_VENDOR
:

3474 ià(
	`i§th”osoui
(
äm
))

3475 
©h
 = 
äm
;

3479 
äm
 += frm[1] + 2;

3481 ià(
äm
 > 
eäm
)

3483 
	`IEEE80211_VERIFY_ELEMENT
(
¿‹s
, 
IEEE80211_RATE_MAXSIZE
);

3484 
	`IEEE80211_VERIFY_ELEMENT
(
ssid
, 
IEEE80211_NWID_LEN
);

3485 
	`IEEE80211_VERIFY_SSID
(
v­
->
iv_bss
, 
ssid
);

3486 ià((
v­
->
iv_æags
 & 
IEEE80211_F_HIDESSID
è&& 
ssid
[1] == 0) {

3487 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_INPUT
,

3488 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

3489 
IEEE80211_FC0_SUBTYPE_SHIFT
],

3491 
v­
->
iv_¡©s
.
is_rx_ssidmism©ch
++;

3494 ià(
ni
 =ğ
v­
->
iv_bss
) {

3495 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

3502 
ni
 = 
	`›“80211_çkeup_adhoc_node
(
v­
,

3503 
wh
->
i_addr2
);

3505 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
wh
->
i_addr2
, 1);

3507 ià(
ni
 =ğ
NULL
)

3509 
®locbs
 = 1;

3512 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_INPUT
, 
wh
->
i_addr2
,

3514 
ni
->
ni_rssi
 = 
rssi
;

3515 
ni
->
ni_¹sf
 = 
¹sf
;

3516 
ni
->
ni_Ï¡_rx
 = 
jiff›s
;

3517 
¿‹
 = 
	`›“80211_£tup_¿‹s
(
ni
, 
¿‹s
, 
x¿‹s
,

3518 
IEEE80211_F_DOSORT
 | 
IEEE80211_F_DOFRATE
 |

3519 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DODEL
);

3520 ià(
¿‹
 & 
IEEE80211_RATE_BASIC
) {

3521 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_XRATE
,

3522 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

3523 
IEEE80211_FC0_SUBTYPE_SHIFT
],

3526 
	`IEEE80211_SEND_MGMT
(
ni
,

3527 
IEEE80211_FC0_SUBTYPE_PROBE_RESP
, 0);

3529 ià(
®locbs
) {

3534 
	`›“80211_uÄef_node
(&
ni
);

3535 } ià(
©h
 !ğ
NULL
)

3536 
	`›“80211_§v—th
(
ni
, 
©h
);

3539 
IEEE80211_FC0_SUBTYPE_AUTH
: {

3540 
u_št16_t
 
®go
, 
£q
, 
¡©us
;

3548 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, 6);

3549 
®go
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3550 
£q
 = 
	`Ë16toh
(*(
__Ë16
 *)(
äm
 + 2));

3551 
¡©us
 = 
	`Ë16toh
(*(
__Ë16
 *)(
äm
 + 4));

3552 #ifdeà
ATH_SUPERG_XR


3553 ià(!
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr3
, 
v­
->
iv_bssid
)) {

3559 ià(
v­
->
iv_xrv­
) {

3560 ià(
ni
 =ğ
v­
->
iv_bss
)

3561 
ni
 = 
v­
->
iv_xrv­
->
iv_bss
;

3563 
	`›“80211_node_Ëave
(
ni
);

3567 
	`›“80211_node_»£t
(
ni
, 
v­
->
iv_xrv­
);

3569 
v­
 = v­->
iv_xrv­
;

3571 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_AUTH
,

3572 
wh
, "auth", "%s", "noto…ier xr bssid");

3577 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_AUTH
, 
wh
->
i_addr2
,

3578 "»cv‡uth f¿mw™h‡lgÜ™hm %d seq %d", 
®go
, 
£q
);

3580 ià(
v­
->
iv_aş
 !ğ
NULL
 &&

3581 !
v­
->
iv_aş
->
	`Ÿc_check
(v­, 
wh
->
i_addr2
)) {

3582 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ACL
,

3583 
wh
, "auth", "%s", "disallowed by ACL");

3584 
v­
->
iv_¡©s
.
is_rx_aş
++;

3587 ià(
v­
->
iv_æags
 & 
IEEE80211_F_COUNTERM
) {

3588 
	`IEEE80211_DISCARD
(
v­
,

3589 
IEEE80211_MSG_AUTH
 | 
IEEE80211_MSG_CRYPTO
,

3590 
wh
, "auth", "%s", "TKIP countermeasuresƒnabled");

3591 
v­
->
iv_¡©s
.
is_rx_auth_couÁ”m—su»s
++;

3592 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

3593 
	`›“80211_£nd_”rÜ
(
ni
, 
wh
->
i_addr2
,

3594 
IEEE80211_FC0_SUBTYPE_AUTH
,

3595 
IEEE80211_REASON_MIC_FAILURE
);

3599 ià(
®go
 =ğ
IEEE80211_AUTH_ALG_SHARED
)

3600 
	`›“80211_auth_sh¬ed
(
ni
, 
wh
, 
äm
 + 6, 
eäm
, 
rssi
,

3601 
¹sf
, 
£q
, 
¡©us
);

3602 ià(
®go
 =ğ
IEEE80211_AUTH_ALG_OPEN
)

3603 
	`›“80211_auth_İ’
(
ni
, 
wh
, 
rssi
, 
¹sf
, 
£q
, 
¡©us
);

3605 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

3606 
wh
, "auth", "unsuµÜ‹d‡lg %d", 
®go
);

3607 
v­
->
iv_¡©s
.
is_rx_auth_unsuµÜ‹d
++;

3608 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

3610 
	`›“80211_£nd_”rÜ
(
ni
, 
wh
->
i_addr2
,

3611 
IEEE80211_FC0_SUBTYPE_AUTH
,

3612 (
£q
 + 1) |

3613 (
IEEE80211_STATUS_ALG
 << 16));

3620 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
:

3621 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
: {

3622 
u_št16_t
 
ÿpšfo
, 
bštv®
;

3623 
›“80211_r¢·rms
 
r¢_·rm
;

3624 
u_št8_t
 
»asÚ
;

3626 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
 ||

3627 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
) {

3628 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

3632 ià(
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
) {

3633 
»assoc
 = 1;

3634 
»¥
 = 
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
;

3636 
»assoc
 = 0;

3637 
»¥
 = 
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
;

3653 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, (
»assoc
 ? 10 : 4));

3654 ià(!
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr3
, 
v­
->
iv_bssid
)) {

3655 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

3656 
wh
, 
›“80211_mgt_subty³_Çme
[
subty³
 >>

3657 
IEEE80211_FC0_SUBTYPE_SHIFT
],

3659 
v­
->
iv_¡©s
.
is_rx_assoc_bss
++;

3662 
ÿpšfo
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3663 
äm
 += 2;

3664 
bštv®
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3665 
äm
 += 2;

3666 ià(
»assoc
)

3667 
äm
 += 6;

3668 
ssid
 = 
¿‹s
 = 
x¿‹s
 = 
suµchª
 = 
w·
 = 
r¢
 = 
wme
 = 
©h
 = 
NULL
;

3669 
äm
 < 
eäm
) {

3670 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, frm[1]);

3671 *
äm
) {

3672 
IEEE80211_ELEMID_SSID
:

3673 
ssid
 = 
äm
;

3675 
IEEE80211_ELEMID_RATES
:

3676 
¿‹s
 = 
äm
;

3678 
IEEE80211_ELEMID_XRATES
:

3679 
x¿‹s
 = 
äm
;

3682 
IEEE80211_ELEMID_RSN
:

3683 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA2
)

3684 
r¢
 = 
äm
;

3686 
	`IEEE80211_DPRINTF
(
v­
,

3687 
IEEE80211_MSG_ASSOC
 |

3688 
IEEE80211_MSG_WPA
,

3689 "[" 
MAC_FMT
 "] ignoring RSN IE "

3691 
	`MAC_ADDR
(
wh
->
i_addr2
));

3693 
IEEE80211_ELEMID_VENDOR
:

3696 ià(
	`isw·oui
(
äm
è&& !
w·
) {

3697 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA1
)

3698 
w·
 = 
äm
;

3700 
	`IEEE80211_DPRINTF
(
v­
,

3701 
IEEE80211_MSG_ASSOC
 |

3702 
IEEE80211_MSG_WPA
,

3703 "[" 
MAC_FMT
 "] "

3706 
	`MAC_ADDR
(
wh
->
i_addr2
));

3707 } ià(
	`iswmešfo
(
äm
))

3708 
wme
 = 
äm
;

3709 ià(
	`i§th”osoui
(
äm
))

3710 
©h
 = 
äm
;

3713 
äm
 += frm[1] + 2;

3715 ià(
äm
 > 
eäm
)

3718 
	`IEEE80211_VERIFY_ELEMENT
(
¿‹s
, 
IEEE80211_RATE_MAXSIZE
);

3719 
	`IEEE80211_VERIFY_ELEMENT
(
ssid
, 
IEEE80211_NWID_LEN
);

3720 
	`IEEE80211_VERIFY_SSID
(
v­
->
iv_bss
, 
ssid
);

3722 ià(
ni
 =ğ
v­
->
iv_bss
) {

3723 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ANY
, 
wh
->
i_addr2
,

3725 
»assoc
 ? "reassoc" : "assoc");

3726 
	`›“80211_£nd_”rÜ
(
ni
, 
wh
->
i_addr2
,

3727 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

3728 
IEEE80211_REASON_ASSOC_NOT_AUTHED
);

3729 
v­
->
iv_¡©s
.
is_rx_assoc_nÙauth
++;

3733 ià(
ni
->
ni_Ãeded_chªs
 !ğ
NULL
) {

3734 
	`FREE
(
ni
->
ni_Ãeded_chªs
, 
M_DEVBUF
);

3735 
ni
->
ni_Ãeded_chªs
 = 
NULL
;

3738 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) {

3739 
u_št8_t
 
¡©us
;

3740 
¡©us
 = 
	`›“80211_·r£_sc_›
(
ni
, 
suµchª
, 
wh
);

3741 ià(
¡©us
 !ğ
IEEE80211_STATUS_SUCCESS
) {

3743 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
, 
¡©us
);

3744 
	`›“80211_node_Ëave
(
ni
);

3745 
v­
->
iv_¡©s
.
is_rx_assoc_badsc›
++;

3752 ià(
w·
 =ğ
NULL
 && (
ic
->
ic_æags
 & 
IEEE80211_F_WPA
)) {

3753 
	`IEEE80211_DPRINTF
(
v­
,

3754 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_WPA
,

3755 "[" 
MAC_FMT
 "]‚o WPA/RSN IE in‡ssociation„equest\n",

3756 
	`MAC_ADDR
(
wh
->
i_addr2
));

3757 
	`IEEE80211_SEND_MGMT
(
ni
,

3758 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

3759 
IEEE80211_REASON_RSN_REQUIRED
);

3760 
	`›“80211_node_Ëave
(
ni
);

3762 
v­
->
iv_¡©s
.
is_rx_assoc_badw·›
++;

3766 ià(
r¢
 !ğ
NULL
) {

3770 
r¢_·rm
 = 
ni
->
ni_r¢
;

3771 ià(
r¢
[0] !ğ
IEEE80211_ELEMID_RSN
)

3772 
»asÚ
 = 
	`›“80211_·r£_w·
(
v­
, 
r¢
, &
r¢_·rm
, 
wh
);

3774 
»asÚ
 = 
	`›“80211_·r£_r¢
(
v­
, 
r¢
, &
r¢_·rm
, 
wh
);

3775 ià(
»asÚ
 != 0) {

3776 
	`IEEE80211_SEND_MGMT
(
ni
,

3777 
IEEE80211_FC0_SUBTYPE_DEAUTH
, 
»asÚ
);

3778 
	`›“80211_node_Ëave
(
ni
);

3780 
v­
->
iv_¡©s
.
is_rx_assoc_badw·›
++;

3783 
	`IEEE80211_NOTE_MAC
(
v­
,

3784 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_WPA
,

3785 
wh
->
i_addr2
,

3787 
r¢
[0] !ğ
IEEE80211_ELEMID_RSN
 ? "WPA" : "RSN",

3788 
r¢_·rm
.
r¢_mÿ¡ch”
,„¢_·rm.
r¢_mÿ¡keyËn
,

3789 
r¢_·rm
.
r¢_uÿ¡ch”
,„¢_·rm.
r¢_uÿ¡keyËn
,

3790 
r¢_·rm
.
r¢_keymgmt
,„¢_·rm.
r¢_ÿps
);

3793 ià(
ni
->
ni_ch®Ënge
 !ğ
NULL
) {

3794 
	`FREE
(
ni
->
ni_ch®Ënge
, 
M_DEVBUF
);

3795 
ni
->
ni_ch®Ënge
 = 
NULL
;

3798 ià((
ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) == 0) {

3799 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ANY
, 
wh
->
i_addr2
,

3801 
»assoc
 ? "»assoc" : "assoc", 
ÿpšfo
);

3802 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
, 
IEEE80211_STATUS_CAPINFO
);

3803 
	`›“80211_node_Ëave
(
ni
);

3804 
v­
->
iv_¡©s
.
is_rx_assoc_ÿpmism©ch
++;

3807 
¿‹
 = 
	`›“80211_£tup_¿‹s
(
ni
, 
¿‹s
, 
x¿‹s
,

3808 
IEEE80211_F_DOSORT
 | 
IEEE80211_F_DOFRATE
 |

3809 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DODEL
);

3816 ià((
¿‹
 & 
IEEE80211_RATE_BASIC
) ||

3817 ((
v­
->
iv_æags
 & 
IEEE80211_F_PUREG
è&& 
¿‹
 < 48)) {

3818 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ANY
, 
wh
->
i_addr2
,

3820 
»assoc
 ? "reassoc" : "assoc");

3821 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
,

3822 
IEEE80211_STATUS_BASIC_RATE
);

3823 
	`›“80211_node_Ëave
(
ni
);

3824 
v­
->
iv_¡©s
.
is_rx_assoc_nÜ©e
++;

3828 ià(
ni
->
ni_associd
 != 0 &&

3829 
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
)) {

3830 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
)

3831 !ğ(
ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
)) {

3832 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ANY
,

3833 
wh
->
i_addr2
,

3836 
»assoc
 ? "»assoc" : "assoc", 
ÿpšfo
);

3837 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
,

3838 
IEEE80211_STATUS_CAPINFO
);

3839 
	`›“80211_node_Ëave
(
ni
);

3840 
v­
->
iv_¡©s
.
is_rx_assoc_ÿpmism©ch
++;

3845 
ni
->
ni_rssi
 = 
rssi
;

3846 
ni
->
ni_¹sf
 = 
¹sf
;

3847 
ni
->
ni_Ï¡_rx
 = 
jiff›s
;

3848 
ni
->
ni_štv®
 = 
	`IEEE80211_BINTVAL_SANITISE
(
bštv®
);

3849 
ni
->
ni_ÿpšfo
 = 
ÿpšfo
;

3850 
ni
->
ni_chª
 = 
ic
->
ic_curchª
;

3851 
ni
->
ni_fhdw–l
 = 
v­
->
iv_bss
->ni_fhdwell;

3852 
ni
->
ni_fhšdex
 = 
v­
->
iv_bss
->ni_fhindex;

3855 
	`›“80211_§ve›
(&
ni
->
ni_w·_›
, 
w·
);

3857 
ni
->
ni_r¢
 = 
r¢_·rm
;

3858 
	`›“80211_§ve›
(&
ni
->
ni_r¢_›
, 
r¢
);

3860 
	`›“80211_§ve›
(&
ni
->
ni_wme_›
, 
wme
);

3861 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_QOS
;

3862 ià((
wme
 !ğ
NULL
è&& (
	`›“80211_·r£_wme›
(wme, 
wh
, 
ni
) > 0))

3863 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_QOS
;

3865 
	`›“80211_§v—th
(
ni
, 
©h
);

3869 
	`›“80211_d–iv”_l2_ºr
(
ni
);

3870 
	`›“80211_d–iv”_l2_xid
(
ni
);

3871 
	`›“80211_node_još
(
ni
, 
»¥
);

3872 #ifdeà
ATH_SUPERG_XR


3873 ià(
ni
->
ni_´ev_v­
 &&

3874 
ni
->
ni_v­
 !ğni->
ni_´ev_v­
 &&

3875 
ni
->
ni_v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
) {

3880 
ic
->
	`ic_node_move_d©a
(
ni
);

3881 
ni
->
ni_´ev_v­
 =‚i->
ni_v­
;

3887 
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
:

3888 
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
: {

3889 
u_št16_t
 
ÿpšfo
, 
associd
;

3890 
u_št16_t
 
¡©us
;

3892 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
 ||

3893 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_ASSOC
) {

3894 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

3907 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, 6);

3908 
ni
 = 
v­
->
iv_bss
;

3909 
ÿpšfo
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3910 
äm
 += 2;

3911 
¡©us
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3912 
äm
 += 2;

3913 ià(
¡©us
 != 0) {

3914 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
,

3915 
wh
->
i_addr2
,

3917 
	`ISREASSOC
(
subty³
è? "»" : "", 
¡©us
);

3918 
v­
->
iv_¡©s
.
is_rx_auth_ç
++;

3919 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
,

3920 
IEEE80211_SCAN_FAIL_STATUS
);

3923 
associd
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

3924 
äm
 += 2;

3926 
¿‹s
 = 
x¿‹s
 = 
wme
 = 
NULL
;

3927 
äm
 < 
eäm
) {

3935 ià((*
äm
 =ğ
IEEE80211_ELEMID_AGERE1
) ||

3936 (*
äm
 =ğ
IEEE80211_ELEMID_AGERE2
)) {

3937 
äm
 = 
eäm
;

3941 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, frm[1]);

3942 *
äm
) {

3943 
IEEE80211_ELEMID_RATES
:

3944 
¿‹s
 = 
äm
;

3946 
IEEE80211_ELEMID_XRATES
:

3947 
x¿‹s
 = 
äm
;

3949 
IEEE80211_ELEMID_VENDOR
:

3950 ià(
	`iswmeoui
(
äm
))

3951 
wme
 = 
äm
;

3954 
äm
 += frm[1] + 2;

3956 ià(
äm
 > 
eäm
)

3958 
	`IEEE80211_VERIFY_ELEMENT
(
¿‹s
, 
IEEE80211_RATE_MAXSIZE
);

3959 
¿‹
 = 
	`›“80211_£tup_¿‹s
(
ni
, 
¿‹s
, 
x¿‹s
,

3960 
IEEE80211_F_DOSORT
 | 
IEEE80211_F_DOFRATE
 |

3961 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DODEL
);

3962 ià(
¿‹
 & 
IEEE80211_RATE_BASIC
) {

3963 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
,

3964 
wh
->
i_addr2
,

3966 
	`ISREASSOC
(
subty³
) ? "re" : "");

3967 
v­
->
iv_¡©s
.
is_rx_assoc_nÜ©e
++;

3968 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
,

3969 
IEEE80211_SCAN_FAIL_STATUS
);

3973 
ni
->
ni_ÿpšfo
 = 
ÿpšfo
;

3974 
ni
->
ni_associd
 = 
associd
;

3975 ià(
wme
 !ğ
NULL
 &&

3976 
	`›“80211_·r£_wm•¬ams
(
v­
, 
wme
, 
wh
, &
qosšfo
) >= 0) {

3977 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_QOS
;

3978 
	`›“80211_wme_upd©•¬ams
(
v­
);

3980 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_QOS
;

3986 ià(
	`IEEE80211_IS_CHAN_A
(
ic
->
ic_curchª
) ||

3987 ((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_PREAMBLE
) &&

3988 (
ic
->
ic_ÿps
 & 
IEEE80211_C_SHPREAMBLE
))) {

3989 
ic
->
ic_æags
 |ğ
IEEE80211_F_SHPREAMBLE
;

3990 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEBARKER
;

3992 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SHPREAMBLE
;

3993 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEBARKER
;

3995 
	`›“80211_£t_shÜt¦Ùtime
(
ic
,

3996 
	`IEEE80211_IS_CHAN_A
(
ic
->
ic_curchª
) ||

3997 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
));

4005 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_curchª
) &&

4006 (
ni
->
ni_”p
 & 
IEEE80211_ERP_USE_PROTECTION
))

4007 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEPROT
;

4009 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEPROT
;

4010 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_ASSOC
, 
wh
->
i_addr2
,

4012 
	`ISREASSOC
(
subty³
) ? "re" : "",

4013 (
ic
->
ic_æags
&
IEEE80211_F_SHPREAMBLE
) &&

4014 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_PREAMBLE
) ? "short" : "long",

4015 
ic
->
ic_æags
&
IEEE80211_F_SHSLOT
 ? "short" : "long",

4016 
ic
->
ic_æags
&
IEEE80211_F_USEPROT
 ? ",…rotection" : "",

4017 
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
 ? ", QoS" : "",

4018 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_TURBOP
) ?

4020 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_COMP
) ?

4022 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_FF
) ?

4024 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_XR
) ?

4026 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_AR
) ?

4029 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_RUN
, 
subty³
);

4033 
IEEE80211_FC0_SUBTYPE_DEAUTH
: {

4034 
u_št16_t
 
»asÚ
;

4036 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_SCAN
) {

4037 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

4044 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, 2);

4045 
»asÚ
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

4046 
v­
->
iv_¡©s
.
is_rx_d—uth
++;

4047 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_d—uth
);

4049 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_AUTH
, 
ni
,

4050 "»cv d—uth’tiÿ‹ (»asÚ %d)", 
»asÚ
);

4051 
v­
->
iv_İmode
) {

4052 
IEEE80211_M_STA
:

4053 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_AUTH
,

4054 
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
);

4056 
IEEE80211_M_HOSTAP
:

4057 ià(
ni
 !ğ
v­
->
iv_bss
)

4058 
	`›“80211_node_Ëave
(
ni
);

4061 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

4067 
IEEE80211_FC0_SUBTYPE_DISASSOC
: {

4068 
u_št16_t
 
»asÚ
;

4070 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
 &&

4071 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_ASSOC
 &&

4072 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_AUTH
) {

4073 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

4080 
	`IEEE80211_VERIFY_LENGTH
(
eäm
 - 
äm
, 2);

4081 
»asÚ
 = 
	`Ë16toh
(*(
__Ë16
 *)
äm
);

4082 
v­
->
iv_¡©s
.
is_rx_di§ssoc
++;

4083 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_di§ssoc
);

4085 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

4086 "»cv di§ssocŸ‹ (»asÚ %d)", 
»asÚ
);

4087 
v­
->
iv_İmode
) {

4088 
IEEE80211_M_STA
:

4089 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_ASSOC
, 0);

4091 
IEEE80211_M_HOSTAP
:

4092 ià(
ni
 !ğ
v­
->
iv_bss
)

4093 
	`›“80211_node_Ëave
(
ni
);

4096 
v­
->
iv_¡©s
.
is_rx_mgtdisÿrd
++;

4102 
	`IEEE80211_DISCARD
(
v­
, 
IEEE80211_MSG_ANY
,

4103 
wh
, "mgt", "subty³ 0x%x‚Ù hªdËd", 
subty³
);

4104 
v­
->
iv_¡©s
.
is_rx_badsubty³
++;

4107 #undeà
ISREASSOC


4108 #undeà
ISPROBE


4110 
	}
}

4111 #undeà
IEEE80211_VERIFY_LENGTH


4112 #undeà
IEEE80211_VERIFY_ELEMENT


4118 
	$›“80211_»cv_p¥Şl
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb0
)

4120 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

4121 
›“80211_äame_mš
 *
wh
;

4122 
sk_buff
 *
skb
;

4123 
u_št16_t
 
aid
;

4124 
qËn
;

4126 
wh
 = (
›“80211_äame_mš
 *)
skb0
->
d©a
;

4127 ià(
ni
->
ni_associd
 == 0) {

4128 
	`IEEE80211_DISCARD
(
v­
,

4129 
IEEE80211_MSG_POWER
 | 
IEEE80211_MSG_DEBUG
,

4130 (
›“80211_äame
 *)
wh
, "ps-poll",

4132 
v­
->
iv_¡©s
.
is_ps_uÇssoc
++;

4133 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

4134 
IEEE80211_REASON_NOT_ASSOCED
);

4138 
aid
 = 
	`Ë16toh
(
wh
->
i_dur
);

4139 ià(
aid
 !ğ
ni
->
ni_associd
) {

4140 
	`IEEE80211_DISCARD
(
v­
,

4141 
IEEE80211_MSG_POWER
 | 
IEEE80211_MSG_DEBUG
,

4142 (
›“80211_äame
 *)
wh
, "ps-poll",

4144 
ni
->
ni_associd
, 
aid
);

4145 
v­
->
iv_¡©s
.
is_ps_badaid
++;

4146 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

4147 
IEEE80211_REASON_NOT_ASSOCED
);

4152 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

4153 
	`IEEE80211_NODE_SAVEQ_DEQUEUE
(
ni
, 
skb
, 
qËn
);

4154 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

4155 ià(
skb
 =ğ
NULL
) {

4156 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_POWER
, 
wh
->
i_addr2
,

4158 
	`›“80211_£nd_nuÎd©a
(
	`›“80211_»f_node
(
ni
));

4159 
v­
->
iv_¡©s
.
is_ps_qem±y
++;

4160 ià(
v­
->
iv_£t_tim
 !ğ
NULL
)

4161 
v­
->
	`iv_£t_tim
(
ni
, 0);

4169 ià(
qËn
 != 0) {

4170 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

4171 "»cv…s-pŞl, s’d…ack‘, %u stÈqueued", 
qËn
);

4176 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

4178 ià(
v­
->
iv_£t_tim
 !ğ
NULL
)

4179 
v­
->
	`iv_£t_tim
(
ni
, 0);

4181 
	`M_PWR_SAV_SET
(
skb
);

4183 
	`›“80211_·»Á_queue_xm™
(
skb
);

4184 
	}
}

4186 #ifdeà
ATH_SUPERG_FF


4188 
	$©hff_deÿp
(
sk_buff
 *
skb
)

4190 
‘h”_h—d”
 
eh_¤c
, *
eh_d¡
;

4191 
Îc
 *llc;

4193 ià(
skb
->
Ën
 < ((
‘h”_h—d”
è+ 
LLC_SNAPFRAMELEN
))

4196 
	`memıy
(&
eh_¤c
, 
skb
->
d©a
, (
‘h”_h—d”
));

4197 
Îc
 = (Îø*)
	`skb_puÎ
(
skb
, (
‘h”_h—d”
));

4198 
eh_¤c
.
‘h”_ty³
 = 
Îc
->
Îc_un
.
ty³_¢­
.ether_type;

4199 
	`skb_puÎ
(
skb
, 
LLC_SNAPFRAMELEN
);

4201 
eh_d¡
 = (
‘h”_h—d”
 *)
	`skb_push
(
skb
, (ether_header));

4202 
	`memıy
(
eh_d¡
, &
eh_¤c
, (
‘h”_h—d”
));

4205 
	}
}

4208 #ifdeà
USE_HEADERLEN_RESV


4214 
__be16


4215 
	$©h_‘h_ty³_Œªs
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
dev
)

4217 
‘hhdr
 *
‘h
;

4219 
	`skb_»£t_mac_h—d”
(
skb
);

4220 
	`skb_puÎ
(
skb
, 
ETH_HLEN
);

4221 
‘h
 = (
‘hhdr
 *)
	`skb_mac_h—d”
(
skb
);

4223 ià(*
‘h
->
h_de¡
 & 1)

4224 ià(
	`memcmp
(
‘h
->
h_de¡
, 
dev
->
brßdÿ¡
, 
ETH_ALEN
) == 0)

4225 
skb
->
pkt_ty³
 = 
PACKET_BROADCAST
;

4227 
skb
->
pkt_ty³
 = 
PACKET_MULTICAST
;

4229 ià(
	`memcmp
(
‘h
->
h_de¡
, 
dev
->
dev_addr
, 
ETH_ALEN
))

4230 
skb
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

4232  
‘h
->
h_´Ùo
;

4233 
	}
}

4239 
	$›“80211_check_mic
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
)

4241 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

4242 
›“80211_äame
 *
wh
;

4243 
›“80211_key
 *
key
;

4244 
hd¾’
;

4246 ià(
skb
->
Ën
 < (
›“80211_äame_mš
)) {

4247 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_ANY
,

4248 
ni
->
ni_maÿddr
, 
NULL
,

4249 "toØshÜˆ(1):†’ %u", 
skb
->
Ën
);

4250 
v­
->
iv_¡©s
.
is_rx_tooshÜt
++;

4254 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

4255 
hd¾’
 = 
	`›“80211_hdrsize
(
wh
);

4257 
key
 = 
	`›“80211_üy±o_deÿp
(
ni
, 
skb
, 
hd¾’
);

4258 ià(
key
 =ğ
NULL
) {

4260 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_w•ç
);

4261 } ià(!
	`›“80211_üy±o_demic
(
v­
, 
key
, 
skb
, 
hd¾’
, 1)) {

4262 
	`IEEE80211_DISCARD_MAC
(
v­
, 
IEEE80211_MSG_INPUT
,

4263 
ni
->
ni_maÿddr
, "data", "%s", "demicƒrror");

4264 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_demicç
);

4266 
	`IEEE80211_NODE_STAT
(
ni
, 
rx_hwdemiû¼
);

4269 
	}
}

4270 
EXPORT_SYMBOL
(
›“80211_check_mic
);

4272 #ifdeà
IEEE80211_DEBUG


4280 cÚ¡ 
u_št8_t
 *

4281 
	$›“80211_g‘bssid
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_äame
 *
wh
)

4283 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
)

4284  
wh
->
i_addr2
;

4285 ià((
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
è!ğ
IEEE80211_FC1_DIR_NODS
)

4286  
wh
->
i_addr1
;

4287 ià((
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
è=ğ
IEEE80211_FC0_SUBTYPE_PS_POLL
)

4288  
wh
->
i_addr1
;

4289  
wh
->
i_addr3
;

4290 
	}
}

4293 
	$›“80211_nÙe
(
›“80211v­
 *
v­
, cÚ¡ *
fmt
, ...)

4295 
buf
[
BUF_LEN
];

4296 
va_li¡
 
­
;

4298 
	`va_¡¬t
(
­
, 
fmt
);

4299 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4300 
	`va_’d
(
­
);

4302 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: %s",

4303 
v­
->
iv_ic
->
ic_dev
->
Çme
, v­->
iv_dev
->name,

4304 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4305 
buf
);

4306 
	}
}

4307 
EXPORT_SYMBOL
(
›“80211_nÙe
);

4310 
	$›“80211_nÙe_äame
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_äame
 *
wh
,

4311 cÚ¡ *
fmt
, ...)

4313 
buf
[
BUF_LEN
];

4314 
va_li¡
 
­
;

4316 
	`va_¡¬t
(
­
, 
fmt
);

4317 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4318 
	`va_’d
(
­
);

4319 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: " MAC_FMT " %s\n",

4320 
v­
->
iv_ic
->
ic_dev
->
Çme
, v­->
iv_dev
->name,

4321 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4322 
	`MAC_ADDR
(
	`›“80211_g‘bssid
(
v­
, 
wh
)), 
buf
);

4323 
	}
}

4324 
EXPORT_SYMBOL
(
›“80211_nÙe_äame
);

4327 
	$›“80211_nÙe_mac
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
],

4328 cÚ¡ *
fmt
, ...)

4330 
buf
[
BUF_LEN
];

4331 
va_li¡
 
­
;

4333 
	`va_¡¬t
(
­
, 
fmt
);

4334 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4335 
	`va_’d
(
­
);

4336 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: " MAC_FMT " %s\n",

4337 
v­
->
iv_ic
->
ic_dev
->
Çme
, v­->
iv_dev
->name,

4338 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4339 
	`MAC_ADDR
(
mac
), 
buf
);

4340 
	}
}

4341 
EXPORT_SYMBOL
(
›“80211_nÙe_mac
);

4344 
	$›“80211_disÿrd_äame
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_äame
 *
wh
,

4345 cÚ¡ *
ty³
, cÚ¡ *
fmt
, ...)

4347 
buf
[
BUF_LEN
];

4348 
va_li¡
 
­
;

4350 
	`va_¡¬t
(
­
, 
fmt
);

4351 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4352 
	`va_’d
(
­
);

4353 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: " MAC_FMT " discard %s%sframe, %s\n",

4354 
v­
->
iv_ic
->
ic_dev
->
Çme
, v­->
iv_dev
->name,

4355 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4356 
	`MAC_ADDR
(
wh
->
i_addr2
),

4357 (
ty³
 !ğ
NULL
) ?ype : "",

4358 (
ty³
 !ğ
NULL
) ? " " : "",

4359 
buf
);

4360 
	}
}

4363 
	$›“80211_disÿrd_›
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_äame
 *
wh
,

4364 cÚ¡ *
ty³
, cÚ¡ *
fmt
, ...)

4366 
buf
[
BUF_LEN
];

4367 
va_li¡
 
­
;

4369 
	`va_¡¬t
(
­
, 
fmt
);

4370 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4371 
	`va_’d
(
­
);

4372 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: "

4373 
MAC_FMT
 " discard %s%sinformationƒlement, %s\n",

4374 
v­
->
iv_ic
->
ic_dev
->
Çme
, v­->
iv_dev
->name,

4375 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4376 
	`MAC_ADDR
(
	`›“80211_g‘bssid
(
v­
, 
wh
)),

4377 (
ty³
 !ğ
NULL
) ?ype : "",

4378 (
ty³
 !ğ
NULL
) ? " " : "",

4379 
buf
);

4380 
	}
}

4383 
	$›“80211_disÿrd_mac
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
],

4384 cÚ¡ *
ty³
, cÚ¡ *
fmt
, ...)

4386 
buf
[
BUF_LEN
];

4387 
va_li¡
 
­
;

4389 
	`va_¡¬t
(
­
, 
fmt
);

4390 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

4391 
	`va_’d
(
­
);

4392 
	`´štk
(
KERN_DEBUG
 "%s/%s[" 
MAC_FMT
 "]: " MAC_FMT " discard %s%sframe, %s\n",

4393 
v­
->
iv_ic
->
ic_dev
->
Çme
,

4394 
v­
->
iv_dev
->
Çme
,

4395 
	`MAC_ADDR
(
v­
->
iv_myaddr
),

4396 
	`MAC_ADDR
(
mac
),

4397 (
ty³
 !ğ
NULL
) ?ype : "",

4398 (
ty³
 !ğ
NULL
) ? " " : "",

4399 
buf
);

4400 
	}
}

	@ieee80211_ioctl.h

34 #iâdeà
_NET80211_IEEE80211_IOCTL_H_


35 
	#_NET80211_IEEE80211_IOCTL_H_


	)

40 
	~<Ãt80211/_›“80211.h
>

41 
	~<Ãt80211/›“80211.h
>

42 
	~<Ãt80211/›“80211_üy±o.h
>

47 
	s›“80211_node¡©s
 {

48 
u_št32_t
 
	mns_rx_d©a
;

49 
u_št32_t
 
	mns_rx_mgmt
;

50 
u_št32_t
 
	mns_rx_ù¾
;

51 
u_št32_t
 
	mns_rx_uÿ¡
;

52 
u_št32_t
 
	mns_rx_mÿ¡
;

53 
u_št64_t
 
	mns_rx_by‹s
;

54 
u_št64_t
 
	mns_rx_b—cÚs
;

55 
u_št32_t
 
	mns_rx_´ob”e¥
;

57 
u_št32_t
 
	mns_rx_dup
;

58 
u_št32_t
 
	mns_rx_nİrivacy
;

59 
u_št32_t
 
	mns_rx_w•ç
;

60 
u_št32_t
 
	mns_rx_demicç
;

61 
u_št32_t
 
	mns_rx_hwdemiû¼
;

62 
u_št32_t
 
	mns_rx_deÿp
;

63 
u_št32_t
 
	mns_rx_deäag
;

64 
u_št32_t
 
	mns_rx_di§ssoc
;

65 
u_št32_t
 
	mns_rx_d—uth
;

66 
u_št32_t
 
	mns_rx_deüy±üc
;

67 
u_št32_t
 
	mns_rx_uÇuth
;

68 
u_št32_t
 
	mns_rx_uÃnüy±ed
;

70 
u_št32_t
 
	mns_tx_d©a
;

71 
u_št32_t
 
	mns_tx_mgmt
;

72 
u_št32_t
 
	mns_tx_uÿ¡
;

73 
u_št32_t
 
	mns_tx_mÿ¡
;

74 
u_št64_t
 
	mns_tx_by‹s
;

75 
u_št32_t
 
	mns_tx_´ob”eq
;

76 
u_št32_t
 
	mns_tx_u­sd
;

78 
u_št32_t
 
	mns_tx_novÏÁag
;

79 
u_št32_t
 
	mns_tx_vÏnmism©ch
;

81 
u_št32_t
 
	mns_tx_eo¥lo¡
;

83 
u_št32_t
 
	mns_ps_disÿrd
;

85 
u_št32_t
 
	mns_u­sd_Œigg”s
;

88 
u_št32_t
 
	mns_tx_assoc
;

89 
u_št32_t
 
	mns_tx_assoc_ç
;

90 
u_št32_t
 
	mns_tx_auth
;

91 
u_št32_t
 
	mns_tx_auth_ç
;

92 
u_št32_t
 
	mns_tx_d—uth
;

93 
u_št32_t
 
	mns_tx_d—uth_code
;

94 
u_št32_t
 
	mns_tx_di§ssoc
;

95 
u_št32_t
 
	mns_tx_di§ssoc_code
;

96 
u_št32_t
 
	mns_psq_drİs
;

102 
	s›“80211_¡©s
 {

103 
u_št32_t
 
	mis_rx_badv”siÚ
;

104 
u_št32_t
 
	mis_rx_tooshÜt
;

105 
u_št32_t
 
	mis_rx_wrÚgbss
;

106 
u_št32_t
 
	mis_rx_dup
;

107 
u_št32_t
 
	mis_rx_wrÚgdœ
;

108 
u_št32_t
 
	mis_rx_mÿ¡echo
;

109 
u_št32_t
 
	mis_rx_mÿ¡di§bËd
;

110 
u_št32_t
 
	mis_rx_nÙassoc
;

111 
u_št32_t
 
	mis_rx_nİrivacy
;

112 
u_št32_t
 
	mis_rx_uÃnüy±ed
;

113 
u_št32_t
 
	mis_rx_w•ç
;

114 
u_št32_t
 
	mis_rx_deÿp
;

115 
u_št32_t
 
	mis_rx_mgtdisÿrd
;

116 
u_št32_t
 
	mis_rx_ùl
;

117 
u_št32_t
 
	mis_rx_b—cÚ
;

118 
u_št32_t
 
	mis_rx_r¡oobig
;

119 
u_št32_t
 
	mis_rx_–em_missšg
;

120 
u_št32_t
 
	mis_rx_–em_toobig
;

121 
u_št32_t
 
	mis_rx_–em_toosm®l
;

122 
u_št32_t
 
	mis_rx_–em_unknown
;

123 
u_št32_t
 
	mis_rx_badchª
;

124 
u_št32_t
 
	mis_rx_chªmism©ch
;

125 
u_št32_t
 
	mis_rx_nod—Îoc
;

126 
u_št32_t
 
	mis_rx_ssidmism©ch
;

127 
u_št32_t
 
	mis_rx_auth_unsuµÜ‹d
;

128 
u_št32_t
 
	mis_rx_auth_ç
;

129 
u_št32_t
 
	mis_rx_auth_couÁ”m—su»s
;

130 
u_št32_t
 
	mis_rx_assoc_bss
;

131 
u_št32_t
 
	mis_rx_assoc_nÙauth
;

132 
u_št32_t
 
	mis_rx_assoc_ÿpmism©ch
;

133 
u_št32_t
 
	mis_rx_assoc_nÜ©e
;

134 
u_št32_t
 
	mis_rx_assoc_badw·›
;

135 
u_št32_t
 
	mis_rx_assoc_badsc›
;

136 
u_št32_t
 
	mis_rx_d—uth
;

137 
u_št32_t
 
	mis_rx_di§ssoc
;

138 
u_št32_t
 
	mis_rx_badsubty³
;

139 
u_št32_t
 
	mis_rx_nobuf
;

140 
u_št32_t
 
	mis_rx_deüy±üc
;

141 
u_št32_t
 
	mis_rx_ahdemo_mgt
;

142 
u_št32_t
 
	mis_rx_bad_auth
;

143 
u_št32_t
 
	mis_rx_uÇuth
;

144 
u_št32_t
 
	mis_rx_badkeyid
;

145 
u_št32_t
 
	mis_rx_ccm´•Ïy
;

146 
u_št32_t
 
	mis_rx_ccmpfÜm©
;

147 
u_št32_t
 
	mis_rx_ccmpmic
;

148 
u_št32_t
 
	mis_rx_tk»¶ay
;

149 
u_št32_t
 
	mis_rx_tkfÜm©
;

150 
u_št32_t
 
	mis_rx_tkmic
;

151 
u_št32_t
 
	mis_rx_tkicv
;

152 
u_št32_t
 
	mis_rx_badch”
;

153 
u_št32_t
 
	mis_rx_noch”ùx
;

154 
u_št32_t
 
	mis_rx_aş
;

155 
u_št32_t
 
	mis_rx_ffút
;

156 
u_št32_t
 
	mis_rx_bad©hŠl
;

157 
u_št32_t
 
	mis_tx_nobuf
;

158 
u_št32_t
 
	mis_tx_nÚode
;

159 
u_št32_t
 
	mis_tx_unknownmgt
;

160 
u_št32_t
 
	mis_tx_badch”
;

161 
u_št32_t
 
	mis_tx_nodefkey
;

162 
u_št32_t
 
	mis_tx_noh—droom
;

163 
u_št32_t
 
	mis_tx_ffokút
;

164 
u_št32_t
 
	mis_tx_fã¼út
;

165 
u_št32_t
 
	mis_sÿn_aùive
;

166 
u_št32_t
 
	mis_sÿn_·ssive
;

167 
u_št32_t
 
	mis_node_timeout
;

168 
u_št32_t
 
	mis_node_fdi§ssoc
;

169 
u_št32_t
 
	mis_üy±o_nomem
;

170 
u_št32_t
 
	mis_üy±o_tk
;

171 
u_št32_t
 
	mis_üy±o_tk’mic
;

172 
u_št32_t
 
	mis_üy±o_tkdemic
;

173 
u_št32_t
 
	mis_üy±o_tkcm
;

174 
u_št32_t
 
	mis_üy±o_ccmp
;

175 
u_št32_t
 
	mis_üy±o_w•
;

176 
u_št32_t
 
	mis_üy±o_£tkey_ch”
;

177 
u_št32_t
 
	mis_üy±o_£tkey_nokey
;

178 
u_št32_t
 
	mis_üy±o_d–key
;

179 
u_št32_t
 
	mis_üy±o_badch”
;

180 
u_št32_t
 
	mis_üy±o_noch”
;

181 
u_št32_t
 
	mis_üy±o_©chç
;

182 
u_št32_t
 
	mis_üy±o_swçÎback
;

183 
u_št32_t
 
	mis_üy±o_keyç
;

184 
u_št32_t
 
	mis_üy±o_’micç
;

185 
u_št32_t
 
	mis_ibss_ÿpmism©ch
;

186 
u_št32_t
 
	mis_ibss_nÜ©e
;

187 
u_št32_t
 
	mis_ps_uÇssoc
;

188 
u_št32_t
 
	mis_ps_badaid
;

189 
u_št32_t
 
	mis_ps_qem±y
;

197 
	#IEEE80211_MAX_OPT_IE
 256

	)

209 
	s›“80211»q_key
 {

210 
u_št8_t
 
	mik_ty³
;

211 
u_št8_t
 
	mik_·d
;

212 
›“80211_keyix_t
 
	mik_keyix
;

213 
u_št8_t
 
	mik_keyËn
;

214 
u_št8_t
 
	mik_æags
;

216 
	#IEEE80211_KEY_DEFAULT
 0x80

	)

217 
u_št8_t
 
	mik_maÿddr
[
IEEE80211_ADDR_LEN
];

218 
u_št64_t
 
	mik_keyrsc
;

219 
u_št64_t
 
	mik_keytsc
;

220 
u_št8_t
 
	mik_keyd©a
[
IEEE80211_KEYBUF_SIZE
+
IEEE80211_MICBUF_SIZE
];

227 
	s›“80211»q_d–_key
 {

230 
u_št8_t
 
	midk_keyix
;

231 
u_št8_t
 
	midk_maÿddr
[
IEEE80211_ADDR_LEN
];

240 
	s›“80211»q_mlme
 {

241 
u_št8_t
 
	mim_İ
;

242 
	#IEEE80211_MLME_ASSOC
 1

	)

243 
	#IEEE80211_MLME_DISASSOC
 2

	)

244 
	#IEEE80211_MLME_DEAUTH
 3

	)

245 
	#IEEE80211_MLME_AUTHORIZE
 4

	)

246 
	#IEEE80211_MLME_UNAUTHORIZE
 5

	)

247 
	#IEEE80211_MLME_CLEAR_STATS
 6

	)

248 
u_št8_t
 
	mim_ssid_Ën
;

249 
u_št16_t
 
	mim_»asÚ
;

250 
u_št8_t
 
	mim_maÿddr
[
IEEE80211_ADDR_LEN
];

251 
u_št8_t
 
	mim_ssid
[
IEEE80211_NWID_LEN
];

258 
	mIEEE80211_MACCMD_POLICY_OPEN
 = 0,

259 
	mIEEE80211_MACCMD_POLICY_ALLOW
 = 1,

260 
	mIEEE80211_MACCMD_POLICY_DENY
 = 2,

261 
	mIEEE80211_MACCMD_FLUSH
 = 3,

262 
	mIEEE80211_MACCMD_DETACH
 = 4,

271 
	s›“80211»q_chªli¡
 {

272 
u_št8_t
 
	mic_chªÃls
[
IEEE80211_CHAN_BYTES
];

278 
	s›“80211»q_chªšfo
 {

279 
u_št
 
	mic_nchªs
;

280 
›“80211_chªÃl
 
	mic_chªs
[
IEEE80211_CHAN_MAX
];

286 
	s›“80211»q_w·›
 {

287 
u_št8_t
 
	mw·_maÿddr
[
IEEE80211_ADDR_LEN
];

288 
u_št8_t
 
	mw·_›
[
IEEE80211_MAX_OPT_IE
];

289 
u_št8_t
 
	mr¢_›
[
IEEE80211_MAX_OPT_IE
];

295 
	s›“80211»q_¡a_¡©s
 {

298 
u_št8_t
 
	mmaÿddr
[
IEEE80211_ADDR_LEN
];

299 
u_št64_t
 
	m·d
;

300 } 
	mis_u
;

301 
›“80211_node¡©s
 
	mis_¡©s
;

308 
	s›“80211»q_¡a_šfo
 {

309 
u_št16_t
 
	misi_Ën
;

310 
u_št16_t
 
	misi_äeq
;

311 
u_št16_t
 
	misi_æags
;

312 
u_št16_t
 
	misi_¡©e
;

313 
u_št8_t
 
	misi_authmode
;

314 
u_št8_t
 
	misi_rssi
;

315 
u_št16_t
 
	misi_ÿpšfo
;

316 
u_št8_t
 
	misi_©hæags
;

317 
u_št8_t
 
	misi_”p
;

318 
u_št8_t
 
	misi_maÿddr
[
IEEE80211_ADDR_LEN
];

319 
u_št8_t
 
	misi_Ä©es
;

320 
u_št8_t
 
	misi_¿‹s
[
IEEE80211_RATE_MAXSIZE
];

321 
u_št8_t
 
	misi_tx¿‹
;

322 
u_št16_t
 
	misi_›_Ën
;

323 
u_št16_t
 
	misi_associd
;

324 
u_št16_t
 
	misi_txpow”
;

325 
u_št16_t
 
	misi_vÏn
;

326 
u_št16_t
 
	misi_tx£qs
[17];

327 
u_št16_t
 
	misi_rx£qs
[17];

328 
u_št16_t
 
	misi_šaù
;

329 
u_št8_t
 
	misi_u­sd
;

330 
u_št8_t
 
	misi_İmode
;

337 
	mIEEE80211_STA_OPMODE_NORMAL
,

338 
	mIEEE80211_STA_OPMODE_XR


345 
	s›“80211»q_¡a_»q
 {

348 
u_št8_t
 
	mmaÿddr
[
IEEE80211_ADDR_LEN
];

349 
u_št64_t
 
	m·d
;

350 } 
	mis_u
;

351 
›“80211»q_¡a_šfo
 
	mšfo
[1];

357 
	s›“80211»q_¡a_txpow
 {

358 
u_št8_t
 
	m™_maÿddr
[
IEEE80211_ADDR_LEN
];

359 
u_št8_t
 
	m™_txpow
;

368 
	#IEEE80211_WMEPARAM_SELF
 0x0000

	)

369 
	#IEEE80211_WMEPARAM_BSS
 0x8000

	)

370 
	#IEEE80211_WMEPARAM_VAL
 0x7ffà

	)

375 
	s›“80211»q_sÿn_»suÉ
 {

376 
u_št16_t
 
	mi¤_Ën
;

377 
u_št16_t
 
	mi¤_äeq
;

378 
u_št16_t
 
	mi¤_æags
;

379 
u_št8_t
 
	mi¤_noi£
;

380 
u_št8_t
 
	mi¤_rssi
;

381 
u_št8_t
 
	mi¤_štv®
;

382 
u_št16_t
 
	mi¤_ÿpšfo
;

383 
u_št8_t
 
	mi¤_”p
;

384 
u_št8_t
 
	mi¤_bssid
[
IEEE80211_ADDR_LEN
];

385 
u_št8_t
 
	mi¤_Ä©es
;

386 
u_št8_t
 
	mi¤_¿‹s
[
IEEE80211_RATE_MAXSIZE
];

387 
u_št8_t
 
	mi¤_ssid_Ën
;

388 
u_št8_t
 
	mi¤_›_Ën
;

389 
u_št8_t
 
	mi¤_·d
[5];

393 #ifdeà
__F»eBSD__


398 
	s›“80211»q
 {

399 
	mi_Çme
[
IFNAMSIZ
];

400 
u_št16_t
 
	mi_ty³
;

401 
št16_t
 
	mi_v®
;

402 
št16_t
 
	mi_Ën
;

403 *
	mi_d©a
;

405 
	#SIOCS80211
 
	`_IOW
('i', 234, 
›“80211»q
)

	)

406 
	#SIOCG80211
 
	`_IOWR
('i', 235, 
›“80211»q
)

	)

407 
	#SIOCG80211STATS
 
	`_IOWR
('i', 236, 
iäeq
)

	)

408 
	#SIOC80211IFCREATE
 
	`_IOWR
('i', 237, 
iäeq
)

	)

409 
	#SIOC80211IFDESTROY
 
	`_IOW
('i', 238, 
iäeq
)

	)

411 
	#IEEE80211_IOC_SSID
 1

	)

412 
	#IEEE80211_IOC_NUMSSIDS
 2

	)

413 
	#IEEE80211_IOC_WEP
 3

	)

414 
	#IEEE80211_WEP_NOSUP
 -1

	)

415 
	#IEEE80211_WEP_OFF
 0

	)

416 
	#IEEE80211_WEP_ON
 1

	)

417 
	#IEEE80211_WEP_MIXED
 2

	)

418 
	#IEEE80211_IOC_WEPKEY
 4

	)

419 
	#IEEE80211_IOC_NUMWEPKEYS
 5

	)

420 
	#IEEE80211_IOC_WEPTXKEY
 6

	)

421 
	#IEEE80211_IOC_AUTHMODE
 7

	)

422 
	#IEEE80211_IOC_STATIONNAME
 8

	)

423 
	#IEEE80211_IOC_CHANNEL
 9

	)

424 
	#IEEE80211_IOC_POWERSAVE
 10

	)

425 
	#IEEE80211_POWERSAVE_NOSUP
 -1

	)

426 
	#IEEE80211_POWERSAVE_OFF
 0

	)

427 
	#IEEE80211_POWERSAVE_CAM
 1

	)

428 
	#IEEE80211_POWERSAVE_PSP
 2

	)

429 
	#IEEE80211_POWERSAVE_PSP_CAM
 3

	)

430 
	#IEEE80211_POWERSAVE_ON
 
IEEE80211_POWERSAVE_CAM


	)

431 
	#IEEE80211_IOC_POWERSAVESLEEP
 11

	)

432 
	#IEEE80211_IOC_RTSTHRESHOLD
 12

	)

433 
	#IEEE80211_IOC_PROTMODE
 13

	)

434 
	#IEEE80211_PROTMODE_OFF
 0

	)

435 
	#IEEE80211_PROTMODE_CTS
 1

	)

436 
	#IEEE80211_PROTMODE_RTSCTS
 2

	)

437 
	#IEEE80211_IOC_TXPOWER
 14

	)

438 
	#IEEE80211_IOC_BSSID
 15

	)

439 
	#IEEE80211_IOC_ROAMING
 16

	)

440 
	#IEEE80211_IOC_PRIVACY
 17

	)

441 
	#IEEE80211_IOC_DROPUNENCRYPTED
 18

	)

442 
	#IEEE80211_IOC_WPAKEY
 19

	)

443 
	#IEEE80211_IOC_DELKEY
 20

	)

444 
	#IEEE80211_IOC_MLME
 21

	)

445 
	#IEEE80211_IOC_OPTIE
 22

	)

446 
	#IEEE80211_IOC_SCAN_REQ
 23

	)

447 
	#IEEE80211_IOC_SCAN_RESULTS
 24

	)

448 
	#IEEE80211_IOC_COUNTERMEASURES
 25

	)

449 
	#IEEE80211_IOC_WPA
 26

	)

450 
	#IEEE80211_IOC_CHANLIST
 27

	)

451 
	#IEEE80211_IOC_WME
 28

	)

452 
	#IEEE80211_IOC_HIDESSID
 29

	)

453 
	#IEEE80211_IOC_APBRIDGE
 30

	)

454 
	#IEEE80211_IOC_MCASTCIPHER
 31

	)

455 
	#IEEE80211_IOC_MCASTKEYLEN
 32

	)

456 
	#IEEE80211_IOC_UCASTCIPHERS
 33

	)

457 
	#IEEE80211_IOC_UCASTCIPHER
 34

	)

458 
	#IEEE80211_IOC_UCASTKEYLEN
 35

	)

459 
	#IEEE80211_IOC_DRIVER_CAPS
 36

	)

460 
	#IEEE80211_IOC_KEYMGTALGS
 37

	)

461 
	#IEEE80211_IOC_RSNCAPS
 38

	)

462 
	#IEEE80211_IOC_WPAIE
 39

	)

463 
	#IEEE80211_IOC_STA_STATS
 40

	)

464 
	#IEEE80211_IOC_MACCMD
 41

	)

465 
	#IEEE80211_IOC_TXPOWMAX
 43

	)

466 
	#IEEE80211_IOC_STA_TXPOW
 44

	)

467 
	#IEEE80211_IOC_STA_INFO
 45

	)

468 
	#IEEE80211_IOC_WME_CWMIN
 46

	)

469 
	#IEEE80211_IOC_WME_CWMAX
 47

	)

470 
	#IEEE80211_IOC_WME_AIFS
 48

	)

471 
	#IEEE80211_IOC_WME_TXOPLIMIT
 49

	)

472 
	#IEEE80211_IOC_WME_ACM
 50

	)

473 
	#IEEE80211_IOC_WME_ACKPOLICY
 51

	)

474 
	#IEEE80211_IOC_DTIM_PERIOD
 52

	)

475 
	#IEEE80211_IOC_BEACON_INTERVAL
 53

	)

476 
	#IEEE80211_IOC_ADDMAC
 54

	)

477 
	#IEEE80211_IOC_DELMAC
 55

	)

478 
	#IEEE80211_IOC_FF
 56

	)

479 
	#IEEE80211_IOC_TURBOP
 57

	)

480 
	#IEEE80211_IOC_APPIEBUF
 58

	)

481 
	#IEEE80211_IOC_FILTERFRAME
 59

	)

486 
	s›“80211»q_sÿn_»suÉ
 {

487 
u_št16_t
 
	mi¤_Ën
;

488 
u_št16_t
 
	mi¤_äeq
;

489 
u_št16_t
 
	mi¤_æags
;

490 
u_št8_t
 
	mi¤_noi£
;

491 
u_št8_t
 
	mi¤_rssi
;

492 
u_št8_t
 
	mi¤_štv®
;

493 
u_št16_t
 
	mi¤_ÿpšfo
;

494 
u_št8_t
 
	mi¤_”p
;

495 
u_št8_t
 
	mi¤_bssid
[
IEEE80211_ADDR_LEN
];

496 
u_št8_t
 
	mi¤_Ä©es
;

497 
u_št8_t
 
	mi¤_¿‹s
[
IEEE80211_RATE_MAXSIZE
];

498 
u_št8_t
 
	mi¤_ssid_Ën
;

499 
u_št8_t
 
	mi¤_›_Ën
;

500 
u_št8_t
 
	mi¤_·d
[5];

506 #ifdeà
__lšux__


513 #ifdeà
__KERNEL__


514 
	~<lšux/if.h
>

520 
	#IW_PRIV_BLOB_LENGTH_ENCODING
(
_SIZE
) \

521 (((
_SIZE
è=ğ((_SIZEè& 
IW_PRIV_SIZE_MASK
)) ? \

522 (
_SIZE
) : \

523 (((
_SIZE
è/ (
ušt32_t
)) + \

524 (((
_SIZE
è=ğ(((_SIZEè/ (
ušt32_t
)) * ())) ? \

525 0 : 1)))

	)

526 
	#IW_PRIV_BLOB_TYPE_ENCODING
(
_SIZE
) \

527 (((
_SIZE
è=ğ((_SIZEè& 
IW_PRIV_SIZE_MASK
)) ? \

528 (
IW_PRIV_TYPE_BYTE
 | (
_SIZE
)) : \

529 (
IW_PRIV_TYPE_INT
 | 
	`IW_PRIV_BLOB_LENGTH_ENCODING
((
_SIZE
))))

	)

531 
	#IEEE80211_IOCTL_SETPARAM
 (
SIOCIWFIRSTPRIV
+0)

	)

532 
	#IEEE80211_IOCTL_GETPARAM
 (
SIOCIWFIRSTPRIV
+1)

	)

533 
	#IEEE80211_IOCTL_SETMODE
 (
SIOCIWFIRSTPRIV
+2)

	)

534 
	#IEEE80211_IOCTL_GETMODE
 (
SIOCIWFIRSTPRIV
+3)

	)

535 
	#IEEE80211_IOCTL_SETWMMPARAMS
 (
SIOCIWFIRSTPRIV
+4)

	)

536 
	#IEEE80211_IOCTL_GETWMMPARAMS
 (
SIOCIWFIRSTPRIV
+5)

	)

537 
	#IEEE80211_IOCTL_SETCHANLIST
 (
SIOCIWFIRSTPRIV
+6)

	)

538 
	#IEEE80211_IOCTL_GETCHANLIST
 (
SIOCIWFIRSTPRIV
+7)

	)

539 
	#IEEE80211_IOCTL_CHANSWITCH
 (
SIOCIWFIRSTPRIV
+8)

	)

540 
	#IEEE80211_IOCTL_GET_APPIEBUF
 (
SIOCIWFIRSTPRIV
+9)

	)

541 
	#IEEE80211_IOCTL_SET_APPIEBUF
 (
SIOCIWFIRSTPRIV
+10)

	)

542 
	#IEEE80211_IOCTL_READREG
 (
SIOCIWFIRSTPRIV
+11)

	)

543 
	#IEEE80211_IOCTL_FILTERFRAME
 (
SIOCIWFIRSTPRIV
+12)

	)

544 
	#IEEE80211_IOCTL_GETCHANINFO
 (
SIOCIWFIRSTPRIV
+13)

	)

545 
	#IEEE80211_IOCTL_SETOPTIE
 (
SIOCIWFIRSTPRIV
+14)

	)

546 
	#IEEE80211_IOCTL_GETOPTIE
 (
SIOCIWFIRSTPRIV
+15)

	)

547 
	#IEEE80211_IOCTL_SETMLME
 (
SIOCIWFIRSTPRIV
+16)

	)

548 
	#IEEE80211_IOCTL_RADAR
 (
SIOCIWFIRSTPRIV
+17)

	)

549 
	#IEEE80211_IOCTL_SETKEY
 (
SIOCIWFIRSTPRIV
+18)

	)

550 
	#IEEE80211_IOCTL_WRITEREG
 (
SIOCIWFIRSTPRIV
+19)

	)

551 
	#IEEE80211_IOCTL_DELKEY
 (
SIOCIWFIRSTPRIV
+20)

	)

552 
	#IEEE80211_IOCTL_HALMAP
 (
SIOCIWFIRSTPRIV
+21)

	)

553 
	#IEEE80211_IOCTL_ADDMAC
 (
SIOCIWFIRSTPRIV
+22)

	)

554 
	#IEEE80211_IOCTL_DELMAC
 (
SIOCIWFIRSTPRIV
+24)

	)

555 
	#IEEE80211_IOCTL_WDSADDMAC
 (
SIOCIWFIRSTPRIV
+26)

	)

556 
	#IEEE80211_IOCTL_WDSDELMAC
 (
SIOCIWFIRSTPRIV
+28)

	)

557 
	#IEEE80211_IOCTL_KICKMAC
 (
SIOCIWFIRSTPRIV
+30)

	)

560 
	mIEEE80211_WMMPARAMS_CWMIN
 = 1,

561 
	mIEEE80211_WMMPARAMS_CWMAX
 = 2,

562 
	mIEEE80211_WMMPARAMS_AIFS
 = 3,

563 
	mIEEE80211_WMMPARAMS_TXOPLIMIT
 = 4,

564 
	mIEEE80211_WMMPARAMS_ACM
 = 5,

565 
	mIEEE80211_WMMPARAMS_NOACKPOLICY
 = 6,

568 
	mIEEE80211_PARAM_TURBO
 = 1,

569 
	mIEEE80211_PARAM_MODE
 = 2,

570 
	mIEEE80211_PARAM_AUTHMODE
 = 3,

571 
	mIEEE80211_PARAM_PROTMODE
 = 4,

572 
	mIEEE80211_PARAM_MCASTCIPHER
 = 5,

573 
	mIEEE80211_PARAM_MCASTKEYLEN
 = 6,

574 
	mIEEE80211_PARAM_UCASTCIPHERS
 = 7,

575 
	mIEEE80211_PARAM_UCASTCIPHER
 = 8,

576 
	mIEEE80211_PARAM_UCASTKEYLEN
 = 9,

577 
	mIEEE80211_PARAM_WPA
 = 10,

578 
	mIEEE80211_PARAM_ROAMING
 = 12,

579 
	mIEEE80211_PARAM_PRIVACY
 = 13,

580 
	mIEEE80211_PARAM_COUNTERMEASURES
 = 14,

581 
	mIEEE80211_PARAM_DROPUNENCRYPTED
 = 15,

582 
	mIEEE80211_PARAM_DRIVER_CAPS
 = 16,

583 
	mIEEE80211_PARAM_MACCMD
 = 17,

584 
	mIEEE80211_PARAM_WMM
 = 18,

585 
	mIEEE80211_PARAM_HIDESSID
 = 19,

586 
	mIEEE80211_PARAM_APBRIDGE
 = 20,

587 
	mIEEE80211_PARAM_KEYMGTALGS
 = 21,

588 
	mIEEE80211_PARAM_RSNCAPS
 = 22,

589 
	mIEEE80211_PARAM_INACT
 = 23,

590 
	mIEEE80211_PARAM_INACT_AUTH
 = 24,

591 
	mIEEE80211_PARAM_INACT_INIT
 = 25,

592 
	mIEEE80211_PARAM_ABOLT
 = 26,

593 
	mIEEE80211_PARAM_DTIM_PERIOD
 = 28,

594 
	mIEEE80211_PARAM_BEACON_INTERVAL
 = 29,

595 
	mIEEE80211_PARAM_DOTH
 = 30,

596 
	mIEEE80211_PARAM_PWRTARGET
 = 31,

597 
	mIEEE80211_PARAM_GENREASSOC
 = 32,

598 
	mIEEE80211_PARAM_COMPRESSION
 = 33,

599 
	mIEEE80211_PARAM_FF
 = 34,

600 
	mIEEE80211_PARAM_XR
 = 35,

601 
	mIEEE80211_PARAM_BURST
 = 36,

602 
	mIEEE80211_PARAM_PUREG
 = 37,

603 
	mIEEE80211_PARAM_AR
 = 38,

604 
	mIEEE80211_PARAM_WDS
 = 39,

605 
	mIEEE80211_PARAM_BGSCAN
 = 40,

606 
	mIEEE80211_PARAM_BGSCAN_IDLE
 = 41,

607 
	mIEEE80211_PARAM_BGSCAN_INTERVAL
 = 42,

608 
	mIEEE80211_PARAM_MCAST_RATE
 = 43,

609 
	mIEEE80211_PARAM_COVERAGE_CLASS
 = 44,

610 
	mIEEE80211_PARAM_COUNTRY_IE
 = 45,

611 
	mIEEE80211_PARAM_SCANVALID
 = 46,

612 
	mIEEE80211_PARAM_ROAM_RSSI_11A
 = 47,

613 
	mIEEE80211_PARAM_ROAM_RSSI_11B
 = 48,

614 
	mIEEE80211_PARAM_ROAM_RSSI_11G
 = 49,

615 
	mIEEE80211_PARAM_ROAM_RATE_11A
 = 50,

616 
	mIEEE80211_PARAM_ROAM_RATE_11B
 = 51,

617 
	mIEEE80211_PARAM_ROAM_RATE_11G
 = 52,

618 
	mIEEE80211_PARAM_UAPSDINFO
 = 53,

619 
	mIEEE80211_PARAM_SLEEP
 = 54,

620 
	mIEEE80211_PARAM_QOSNULL
 = 55,

621 
	mIEEE80211_PARAM_PSPOLL
 = 56,

622 
	mIEEE80211_PARAM_EOSPDROP
 = 57,

623 
	mIEEE80211_PARAM_MARKDFS
 = 58,

624 
	mIEEE80211_PARAM_REGCLASS
 = 59,

625 
	mIEEE80211_PARAM_DROPUNENC_EAPOL
 = 60,

626 
	mIEEE80211_PARAM_SHPREAMBLE
 = 61,

627 
	mIEEE80211_PARAM_DUMPREGS
 = 62,

628 
	mIEEE80211_PARAM_DOTH_ALGORITHM
 = 63,

629 
	mIEEE80211_PARAM_DOTH_MINCOM
 = 64,

630 
	mIEEE80211_PARAM_DOTH_SLCG
 = 65,

631 
	mIEEE80211_PARAM_DOTH_SLDG
 = 66,

632 
	mIEEE80211_PARAM_TXCONT
 = 67,

633 
	mIEEE80211_PARAM_TXCONT_RATE
 = 68,

634 
	mIEEE80211_PARAM_TXCONT_POWER
 = 69,

635 
	mIEEE80211_PARAM_DFS_TESTMODE
 = 70,

636 
	mIEEE80211_PARAM_DFS_CACTIME
 = 71,

639 
	mIEEE80211_PARAM_DFS_EXCLPERIOD
 = 72,

642 
	mIEEE80211_PARAM_BEACON_MISS_THRESH
 = 73,

643 
	mIEEE80211_PARAM_BEACON_MISS_THRESH_MS
 = 74,

644 
	mIEEE80211_PARAM_RSSI_EWMA
 = 75,

645 
	mIEEE80211_PARAM_DRAINTXQ
 = 76,

646 
	mIEEE80211_PARAM_STOP_QUEUE
 = 77,

647 
	mIEEE80211_PARAM_TXTIMEOUT
 = 78,

648 
	mIEEE80211_PARAM_ATHRESET
 = 79,

649 
	mIEEE80211_PARAM_RESETTXBUFS
 = 80,

650 
	mIEEE80211_PARAM_SCANBUFS
 = 81,

651 
	mIEEE80211_PARAM_LEAKTXBUFS
 = 82,

654 
	#SIOCG80211STATS
 (
SIOCDEVPRIVATE
+2)

	)

656 
	#IEEE80211_IOCTL_GETKEY
 (
SIOCDEVPRIVATE
+3)

	)

657 
	#IEEE80211_IOCTL_GETWPAIE
 (
SIOCDEVPRIVATE
+4)

	)

658 
	#IEEE80211_IOCTL_STA_STATS
 (
SIOCDEVPRIVATE
+5)

	)

659 
	#IEEE80211_IOCTL_STA_INFO
 (
SIOCDEVPRIVATE
+6)

	)

660 
	#SIOC80211IFCREATE
 (
SIOCDEVPRIVATE
+7)

	)

661 
	#SIOC80211IFDESTROY
 (
SIOCDEVPRIVATE
+8)

	)

662 
	#IEEE80211_IOCTL_SCAN_RESULTS
 (
SIOCDEVPRIVATE
+9)

	)

664 
	s›“80211_şÚe_·¿ms
 {

665 
	miı_Çme
[
IFNAMSIZ
];

666 
u_št16_t
 
	miı_İmode
;

667 
u_št16_t
 
	miı_æags
;

668 
	#IEEE80211_CLONE_BSSID
 0x0001

	)

669 
	#IEEE80211_USE_SW_BEACON_TIMERS
 0x0002

	)

676 
	mIEEE80211_APPIE_FRAME_BEACON
 = 0,

677 
	mIEEE80211_APPIE_FRAME_PROBE_REQ
 = 1,

678 
	mIEEE80211_APPIE_FRAME_PROBE_RESP
 = 2,

679 
	mIEEE80211_APPIE_FRAME_ASSOC_REQ
 = 3,

680 
	mIEEE80211_APPIE_FRAME_ASSOC_RESP
 = 4,

681 
	mIEEE80211_APPIE_NUM_OF_FRAME
 = 5

684 
	s›“80211»q_g‘£t_­p›buf
 {

685 
u_št32_t
 
	m­p_ämty³
;

686 
u_št32_t
 
	m­p_buæ’
;

687 
u_št8_t
 
	m­p_buf
[0];

692 
	mIEEE80211_FILTER_TYPE_BEACON
 = 1<<0,

693 
	mIEEE80211_FILTER_TYPE_PROBE_REQ
 = 1<<1,

694 
	mIEEE80211_FILTER_TYPE_PROBE_RESP
 = 1<<2,

695 
	mIEEE80211_FILTER_TYPE_ASSOC_REQ
 = 1<<3,

696 
	mIEEE80211_FILTER_TYPE_ASSOC_RESP
 = 1<<4,

697 
	mIEEE80211_FILTER_TYPE_AUTH
 = 1<<5,

698 
	mIEEE80211_FILTER_TYPE_DEAUTH
 = 1<<6,

699 
	mIEEE80211_FILTER_TYPE_DISASSOC
 = 1<<7,

700 
	mIEEE80211_FILTER_TYPE_ALL
 = 0xFF

703 
	s›“80211»q_£t_f‹r
 {

704 
u_št32_t
 
	m­p_f‹ry³
;

	@ieee80211_linux.c

29 #iâdeà
EXPORT_SYMTAB


30 
	#EXPORT_SYMTAB


	)

36 #iâdeà
AUTOCONF_INCLUDED


37 
	~<lšux/cÚfig.h
>

39 
	~<lšux/v”siÚ.h
>

40 
	~<lšux/moduË.h
>

41 
	~<lšux/kmod.h
>

42 
	~<lšux/š™.h
>

43 
	~<lšux/skbuff.h
>

44 
	~<lšux/sysùl.h
>

45 
	~<lšux/Ãtdeviû.h
>

46 
	~<lšux/‘h”deviû.h
>

47 
	~<lšux/if_vÏn.h
>

48 
	~<lšux/vm®loc.h
>

49 
	~<lšux/´oc_fs.h
>

51 
	~<Ãt/iw_hªdËr.h
>

52 
	~<lšux/wœ–ess.h
>

53 
	~<lšux/if_¬p.h
>

55 
	~<asm/uacûss.h
>

57 
	~"if_medŸ.h
"

58 
	~"if_‘h”subr.h
"

60 
	~<Ãt80211/›“80211_v¬.h
>

61 
	~<Ãt80211/›“80211_mÚ™Ü.h
>

63 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,17)

64 
	~<lšux/deviû.h
>

71 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,21)

72 
ssize_t
 
	$show_madwifi_Çme_ty³
(
deviû
 *
dev
,

73 
deviû_©Œibu‹
 *
©Œ
, *
buf
)

75 
ssize_t
 
	$show_madwifi_Çme_ty³
(
şass_deviû
 *
cdev
,

76 *
buf
)

79 
ssize_t
 
Ën
 = 0;

81 
Ën
 = 
	`¢´štf
(
buf
, 
PAGE_SIZE
, "1");

83  
Ën
;

84 
	}
}

86 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,21)

87 
DEVICE_ATTR
(
madwifi_Çme_ty³
, 
S_IRUGO
, 
show_madwifi_Çme_ty³
, 
NULL
);

89 
CLASS_DEVICE_ATTR
(
madwifi_Çme_ty³
, 
S_IRUGO
, 
show_madwifi_Çme_ty³
, 
NULL
);

92 
©Œibu‹
 *
	g›“80211_sysfs_©Œs
[] = {

93 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,21)

94 &
dev_©Œ_madwifi_Çme_ty³
.
©Œ
,

96 &
şass_deviû_©Œ_madwifi_Çme_ty³
.
©Œ
,

98 
NULL


101 
©Œibu‹_group
 
	g›“80211_©Œ_g½
 = {

102 .
Çme
 = 
NULL
,

103 .
	g©Œs
 = 
›“80211_sysfs_©Œs


107 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,24)

108 
	#´oc_Ãt
 
š™_Ãt
.
´oc_Ãt


	)

115 
	$if_´štf
(
Ãt_deviû
 *
dev
, cÚ¡ *
fmt
, ...)

117 
va_li¡
 
­
;

118 
buf
[512];

120 
	`va_¡¬t
(
­
, 
fmt
);

121 
	`v¢´štf
(
buf
, (buf), 
fmt
, 
­
);

122 
	`va_’d
(
­
);

124 
	`´štk
("%s: %s", 
dev
->
Çme
, 
buf
);

125 
	}
}

136 
	gsk_buff
 *

137 #ifdeà
IEEE80211_DEBUG_REFCNT


138 
	$›“80211_g‘mgtäame_debug
(
u_št8_t
 **
äm
, 
u_št
 
pk’
,

139 cÚ¡ *
func
, 
lše
)

141 
	$›“80211_g‘mgtäame
(
u_št8_t
 **
äm
, 
u_št
 
pk’
)

144 cÚ¡ 
u_št
 
®ign
 = (
u_št32_t
);

145 
sk_buff
 *
skb
;

146 
u_št
 
Ën
;

148 
Ën
 = 
	`roundup
((
›“80211_äame
è+ 
pk’
, 4);

149 #ifdeà
IEEE80211_DEBUG_REFCNT


150 
skb
 = 
	`›“80211_dev_®loc_skb_debug
(
Ën
 + 
®ign
 - 1, 
func
, 
lše
);

152 
skb
 = 
	`›“80211_dev_®loc_skb
(
Ën
 + 
®ign
 - 1);

154 ià(
skb
 !ğ
NULL
) {

155 
u_št
 
off
 = ((è
skb
->
d©a
è% 
®ign
;

156 ià(
off
 != 0)

157 
	`skb_»£rve
(
skb
, 
®ign
 - 
off
);

159 
	`SKB_NI
(
skb
èğ
NULL
;

160 
	`SKB_CB
(
skb
)->
æags
 = 0;

162 
	`skb_»£rve
(
skb
, (
›“80211_äame
));

163 *
äm
 = 
	`skb_put
(
skb
, 
pk’
);

165  
skb
;

166 
	}
}

167 #ifdeà
IEEE80211_DEBUG_REFCNT


168 
EXPORT_SYMBOL
(
›“80211_g‘mgtäame_debug
);

170 
EXPORT_SYMBOL
(
›“80211_g‘mgtäame
);

173 #ià
IEEE80211_VLAN_TAG_USED


182 
	$›“80211_vÏn_»gi¡”
(
Ãt_deviû
 *
dev
, 
vÏn_group
 *
g½
)

184 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

186 
v­
->
iv_vlg½
 = 
g½
;

187 
	}
}

193 
	$›“80211_vÏn_add_vid
(
Ãt_deviû
 *
dev
, 
vid
)

195 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

197 ià(
v­
->
iv_vlg½
 !ğ
NULL
)

198 
v­
->
iv_bss
->
ni_vÏn
 = 
vid
;

199 
	}
}

205 
	$›“80211_vÏn_kl_vid
(
Ãt_deviû
 *
dev
, 
vid
)

207 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

209 ià(
v­
->
iv_vlg½
 !ğ
NULL
)

210 
	`vÏn_group_£t_deviû
(
v­
->
iv_vlg½
, 
vid
, 
NULL
);

211 
	}
}

215 
	$›“80211_vÏn_v©ch
(
›“80211v­
 *
v­
)

217 #ià
IEEE80211_VLAN_TAG_USED


218 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

220 
dev
->
ã©u»s
 |ğ
NETIF_F_HW_VLAN_TX
 | 
NETIF_F_HW_VLAN_RX
 |

221 
NETIF_F_HW_VLAN_FILTER
;

222 
dev
->
vÏn_rx_»gi¡”
 = 
›“80211_vÏn_»gi¡”
;

223 
dev
->
vÏn_rx_add_vid
 = 
›“80211_vÏn_add_vid
;

224 
dev
->
vÏn_rx_kl_vid
 = 
›“80211_vÏn_kl_vid
;

226 
	}
}

229 
	$›“80211_vÏn_vd‘ach
(
›“80211v­
 *
v­
)

231 
	}
}

234 
	$›“80211_nÙify_node_još
(
›“80211_node
 *
ni
, 
Ãwassoc
)

236 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

237 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

238 
iw»q_d©a
 
w»q
;

240 ià(
ni
 =ğ
v­
->
iv_bss
) {

241 ià(
Ãwassoc
)

242 
	`Ãtif_ÿ¼›r_Ú
(
dev
);

243 
	`mem£t
(&
w»q
, 0, (wreq));

244 
	`IEEE80211_ADDR_COPY
(
w»q
.
addr
.
§_d©a
, 
v­
->
iv_bssid
);

245 
w»q
.
addr
.
§_çmy
 = 
ARPHRD_ETHER
;

246 #ifdeà
ATH_SUPERG_XR


247 ià(
v­
->
iv_xrv­
 && v­->
iv_æags
 & 
IEEE80211_F_XR
)

248 
dev
 = 
v­
->
iv_xrv­
->
iv_dev
;

250 
	`wœ–ess_£nd_ev’t
(
dev
, 
SIOCGIWAP
, &
w»q
, 
NULL
);

252 
	`mem£t
(&
w»q
, 0, (wreq));

253 
	`IEEE80211_ADDR_COPY
(
w»q
.
addr
.
§_d©a
, 
ni
->
ni_maÿddr
);

254 
w»q
.
addr
.
§_çmy
 = 
ARPHRD_ETHER
;

255 #ifdeà
ATH_SUPERG_XR


256 ià(
v­
->
iv_xrv­
 && v­->
iv_æags
 & 
IEEE80211_F_XR
)

257 
dev
 = 
v­
->
iv_xrv­
->
iv_dev
;

259 
	`wœ–ess_£nd_ev’t
(
dev
, 
IWEVREGISTERED
, &
w»q
, 
NULL
);

261 
	}
}

264 
	$›“80211_nÙify_node_Ëave
(
›“80211_node
 *
ni
)

266 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

267 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

268 
iw»q_d©a
 
w»q
;

270 ià(
ni
 =ğ
v­
->
iv_bss
) {

271 
	`Ãtif_ÿ¼›r_off
(
dev
);

272 
	`mem£t
(
w»q
.
­_addr
.
§_d©a
, 0, 
ETHER_ADDR_LEN
);

273 
w»q
.
­_addr
.
§_çmy
 = 
ARPHRD_ETHER
;

274 
	`wœ–ess_£nd_ev’t
(
dev
, 
SIOCGIWAP
, &
w»q
, 
NULL
);

277 
	`mem£t
(&
w»q
, 0, (wreq));

278 
	`IEEE80211_ADDR_COPY
(
w»q
.
addr
.
§_d©a
, 
ni
->
ni_maÿddr
);

279 
w»q
.
addr
.
§_çmy
 = 
ARPHRD_ETHER
;

280 
	`wœ–ess_£nd_ev’t
(
dev
, 
IWEVEXPIRED
, &
w»q
, 
NULL
);

282 
	}
}

285 
	$›“80211_nÙify_¡a_¡©s
(
›“80211_node
 *
ni
)

287 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

288 cÚ¡ *
g
 = "STA-TRAFFIC-STAT";

289 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

290 
iw»q_d©a
 
w»q
;

291 
buf
[1024];

293 
	`¢´štf
(
buf
, (buf), "%s\nmac=" 
MAC_FMT
 "\nrx_packets=%u\nrx_bytes=%llu\n"

294 "tx_·ck‘s=%u\Áx_by‹s=%Îu\n", 
g
,

295 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),‚i->
ni_¡©s
.
ns_rx_d©a
,

296 ()
ni
->
ni_¡©s
.
ns_rx_by‹s
,

297 
ni
->
ni_¡©s
.
ns_tx_d©a
,

298 ()
ni
->
ni_¡©s
.
ns_tx_by‹s
);

299 
	`mem£t
(&
w»q
, 0, (wreq));

300 
w»q
.
d©a
.
Ëngth
 = 
	`¡¾’
(
buf
);

301 
	`wœ–ess_£nd_ev’t
(
dev
, 
IWEVCUSTOM
, &
w»q
, 
buf
);

302 
	}
}

305 
	$›“80211_nÙify_sÿn_dÚe
(
›“80211v­
 *
v­
)

307 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

308 
iw»q_d©a
 
w»q
;

310 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
, "%s\n", "notify scan done");

313 
w»q
.
d©a
.
Ëngth
 = 0;

314 
w»q
.
d©a
.
æags
 = 0;

315 
	`wœ–ess_£nd_ev’t
(
dev
, 
SIOCGIWSCAN
, &
w»q
, 
NULL
);

316 
	}
}

319 
	$›“80211_nÙify_»¶ay_çu»
(
›“80211v­
 *
v­
,

320 cÚ¡ 
›“80211_äame
 *
wh
, cÚ¡ 
›“80211_key
 *
k
,

321 
u_št64_t
 
rsc
)

323 cÚ¡ *
g
 = "MLME-REPLAYFAILURE.indication";

324 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

325 
iw»q_d©a
 
wrqu
;

326 
buf
[128];

328 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

330 
k
->
wk_ch”
->
ic_Çme
, k->
wk_keyix
,

331 ()
rsc
);

334 
	`¢´štf
(
buf
, (buf), "%s(keyid=%d %sÿ¡‡ddr=" 
MAC_FMT
 ")", 
g
,

335 
k
->
wk_keyix
,

336 
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr2
) ? "broad" : "uni",

337 
	`MAC_ADDR
(
wh
->
i_addr2
));

338 
	`mem£t
(&
wrqu
, 0, (wrqu));

339 
wrqu
.
d©a
.
Ëngth
 = 
	`¡¾’
(
buf
);

340 
	`wœ–ess_£nd_ev’t
(
dev
, 
IWEVCUSTOM
, &
wrqu
, 
buf
);

341 
	}
}

342 
EXPORT_SYMBOL
(
›“80211_nÙify_»¶ay_çu»
);

345 
	$›“80211_nÙify_mich«l_çu»
(
›“80211v­
 *
v­
,

346 cÚ¡ 
›“80211_äame
 *
wh
, 
›“80211_keyix_t
 
keyix
)

348 cÚ¡ *
g
 = "MLME-MICHAELMICFAILURE.indication";

349 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

350 
iw»q_d©a
 
wrqu
;

351 
buf
[128];

353 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
, 
wh
->
i_addr2
,

354 "Mich«ÈMIC v”ifiÿtiÚ faed <keyix %d>", 
keyix
);

355 
v­
->
iv_¡©s
.
is_rx_tkmic
++;

358 
	`¢´štf
(
buf
, (buf), "%s(keyid=%d %sÿ¡‡ddr=" 
MAC_FMT
 ")", 
g
,

359 
keyix
, 
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr2
) ? "broad" : "uni",

360 
	`MAC_ADDR
(
wh
->
i_addr2
));

361 
	`mem£t
(&
wrqu
, 0, (wrqu));

362 
wrqu
.
d©a
.
Ëngth
 = 
	`¡¾’
(
buf
);

363 
	`wœ–ess_£nd_ev’t
(
dev
, 
IWEVCUSTOM
, &
wrqu
, 
buf
);

364 
	}
}

365 
EXPORT_SYMBOL
(
›“80211_nÙify_mich«l_çu»
);

379 
	$›“80211_lßd_moduË
(cÚ¡ *
modÇme
)

381 #ià
	`defšed
(
CONFIG_KMOD
è|| (
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,27))

382 
rv
;

383 
rv
 = 
	`»que¡_moduË
("%s", 
modÇme
);

384 ià(
rv
 < 0)

385 
	`´štk
(
KERN_ERR
 "failedo‡utomatically†oad module: %s; " \

386 "”ºo: %d\n", 
modÇme
, 
rv
);

387  
rv
;

389 
	`´štk
(
KERN_ERR
 "Unableo†oad‚eeded module: %s;‚o support for " \

390 "autom©iømoduË†ßdšg\n", 
modÇme
);

391  -
ENOSYS
;

393 
	}
}

396 
´oc_dœ_’Œy
 *
	g´oc_madwifi
;

397 
	g´oc_madwifi_couÁ
 = 0;

400 
	$´oc_»ad_nodes
(
›“80211v­
 *
v­
, *
buf
, 
¥aû
)

402 *
p
 = 
buf
;

403 
›“80211_node
 *
ni
;

404 
›“80211_node_bË
 *
Á
 =

405 (
›“80211_node_bË
 *)&
v­
->
iv_ic
->
ic_¡a
;

407 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

408 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

409 
time¥ec
 
t
;

412 ià(
buf
 + 
¥aû
 < 
p
 + 500)

414 ià((
ni
->
ni_v­
 =ğ
v­
è&& (
	`memcmp
(v­->
iv_myaddr
,

415 
ni
->
ni_maÿddr
, 
IEEE80211_ADDR_LEN
) != 0)) {

416 
	`jiff›s_to_time¥ec
(
jiff›s
 - 
ni
->
ni_Ï¡_rx
, &
t
);

417 
p
 +ğ
	`¥rštf
Õ, "maÿddr: <" 
MAC_FMT
 ">\n",

418 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

419 
p
 +ğ
	`¥rštf
Õ, " RSSI %d\n", 
ni
->
ni_rssi
);

420 
p
 +ğ
	`¥rštf
(p, "†ast_rx %ld.%06ld\n",

421 
t
.
tv_£c
,.
tv_n£c
 / 1000);

422 
p
 +ğ
	`¥rštf
(p, "‚i_tstamp %10llu‚i_rtsf %10llu\n",

423 
	`Ë64_to_ıu
(
ni
->
ni_t¡amp
.
tsf
),‚i->
ni_¹sf
);

426 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

428  (
p
 - 
buf
);

429 
	}
}

431 
ssize_t


432 
	$´oc_›“80211_»ad
(
fe
 *fe, 
__u£r
 *
buf
, 
size_t
 
Ën
, 
loff_t
 *
off£t
)

434 
loff_t
 
pos
 = *
off£t
;

435 
´oc_›“80211_´iv
 *
pv
 =

436 (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

438 ià(!
pv
->
rbuf
)

439  -
EINVAL
;

440 ià(
pos
 < 0)

441  -
EINVAL
;

442 ià(
pos
 > 
pv
->
¾’
)

443  -
EFAULT
;

444 ià(
Ën
 > 
pv
->
¾’
 - 
pos
)

445 
Ën
 = 
pv
->
¾’
 - 
pos
;

446 ià(
	`cİy_to_u£r
(
buf
, 
pv
->
rbuf
 + 
pos
, 
Ën
))

447  -
EFAULT
;

448 *
off£t
 = 
pos
 + 
Ën
;

449  
Ën
;

450 
	}
}

453 
	$´oc_›“80211_İ’
(
šode
 *šode, 
fe
 *file)

455 
´oc_›“80211_´iv
 *
pv
 = 
NULL
;

456 
´oc_dœ_’Œy
 *
dp
 = 
	`PDE
(
šode
);

457 
›“80211v­
 *
v­
 = 
dp
->
d©a
;

459 ià(!(
fe
->
´iv©e_d©a
 = 
	`kz®loc
((
´oc_›“80211_´iv
),

460 
GFP_KERNEL
)))

461  -
ENOMEM
;

463 
pv
 = (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

464 
pv
->
rbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

465 ià(!
pv
->
rbuf
) {

466 
	`kä“
(
pv
);

467  -
ENOMEM
;

469 
pv
->
wbuf
 = 
	`vm®loc
(
MAX_PROC_IEEE80211_SIZE
);

470 ià(!
pv
->
wbuf
) {

471 
	`vä“
(
pv
->
rbuf
);

472 
	`kä“
(
pv
);

473  -
ENOMEM
;

475 
	`mem£t
(
pv
->
wbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

476 
	`mem£t
(
pv
->
rbuf
, 0, 
MAX_PROC_IEEE80211_SIZE
);

477 
pv
->
max_wËn
 = 
MAX_PROC_IEEE80211_SIZE
;

478 
pv
->
max_¾’
 = 
MAX_PROC_IEEE80211_SIZE
;

480 
pv
->
¾’
 = 
	`´oc_»ad_nodes
(
v­
,…v->
rbuf
, 
MAX_PROC_IEEE80211_SIZE
);

482 
	}
}

484 
ssize_t


485 
	$´oc_›“80211_wr™e
(
fe
 *fe, cÚ¡ 
__u£r
 *
buf
, 
size_t
 
Ën
, 
loff_t
 *
off£t
)

487 
loff_t
 
pos
 = *
off£t
;

488 
´oc_›“80211_´iv
 *
pv
 =

489 (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

491 ià(!
pv
->
wbuf
)

492  -
EINVAL
;

493 ià(
pos
 < 0)

494  -
EINVAL
;

495 ià(
pos
 >ğ
pv
->
max_wËn
)

497 ià(
Ën
 > 
pv
->
max_wËn
 - 
pos
)

498 
Ën
 = 
pv
->
max_wËn
 - 
pos
;

499 ià(
	`cİy_äom_u£r
(
pv
->
wbuf
 + 
pos
, 
buf
, 
Ën
))

500  -
EFAULT
;

501 ià(
pos
 + 
Ën
 > 
pv
->
wËn
)

502 
pv
->
wËn
 = 
pos
 + 
Ën
;

503 *
off£t
 = 
pos
 + 
Ën
;

505  
Ën
;

506 
	}
}

509 
	$´oc_›“80211_şo£
(
šode
 *šode, 
fe
 *file)

511 
´oc_›“80211_´iv
 *
pv
 =

512 (
´oc_›“80211_´iv
 *)
fe
->
´iv©e_d©a
;

513 ià(
pv
->
rbuf
)

514 
	`vä“
(
pv
->
rbuf
);

515 ià(
pv
->
wbuf
)

516 
	`vä“
(
pv
->
wbuf
);

517 
	`kä“
(
pv
);

519 
	}
}

521 
fe_İ”©iÚs
 
	g´oc_›“80211_İs
 = {

522 .
»ad
 = 
´oc_›“80211_»ad
,

523 .
	gwr™e
 = 
´oc_›“80211_wr™e
,

524 .
	gİ’
 = 
´oc_›“80211_İ’
,

525 .
	g»Ëa£
 = 
´oc_›“80211_şo£
,

528 #ifdeà
IEEE80211_DEBUG


530 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_debug
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

531 
ËÅ
, 
µos
)

533 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

534 
u_št
 
v®
;

535 
»t
;

537 
ùl
->
d©a
 = &
v®
;

538 
ùl
->
maxËn
 = (
v®
);

539 ià(
wr™e
) {

540 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

541 
ËÅ
, 
µos
);

542 ià(
»t
 == 0) {

543 
v­
->
iv_debug
 = (
v®
 & ~
IEEE80211_MSG_IC
);

544 
v­
->
iv_ic
->
ic_debug
 = (
v®
 & 
IEEE80211_MSG_IC
);

545 
	`´štk
(
KERN_INFO
 "%s debug flags changedo 0x%08x.\n",

546 
v­
->
iv_dev
->
Çme
, 
v®
);

550 
v®
 = 
v­
->
iv_debug
 | v­->
iv_ic
->
ic_debug
;

551 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

552 
ËÅ
, 
µos
);

554  
»t
;

555 
	}
}

559 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_dev_ty³
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

560 
ËÅ
, 
µos
)

562 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

563 
u_št
 
v®
;

564 
»t
;

566 
ùl
->
d©a
 = &
v®
;

567 
ùl
->
maxËn
 = (
v®
);

568 ià(
wr™e
) {

569 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

570 
ËÅ
, 
µos
);

571 ià(
»t
 =ğ0 && 
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
) {

572 ià(
v®
 =ğ
ARPHRD_IEEE80211_RADIOTAP
 ||

573 
v®
 =ğ
ARPHRD_IEEE80211
 ||

574 
v®
 =ğ
ARPHRD_IEEE80211_PRISM
 ||

575 
v®
 =ğ
ARPHRD_IEEE80211_ATHDESC
) {

576 
v­
->
iv_dev
->
ty³
 = 
v®
;

580 
v®
 = 
v­
->
iv_dev
->
ty³
;

581 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

582 
ËÅ
, 
µos
);

584  
»t
;

585 
	}
}

588 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_mÚ™Ü_nods_Úly
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

589 
ËÅ
, 
µos
)

591 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

592 
u_št
 
v®
;

593 
»t
;

595 
ùl
->
d©a
 = &
v®
;

596 
ùl
->
maxËn
 = (
v®
);

597 ià(
wr™e
) {

598 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

599 
ËÅ
, 
µos
);

600 ià(
»t
 == 0)

601 
v­
->
iv_mÚ™Ü_nods_Úly
 = 
v®
;

603 
v®
 = 
v­
->
iv_mÚ™Ü_nods_Úly
;

604 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

605 
ËÅ
, 
µos
);

607  
»t
;

608 
	}
}

611 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_mÚ™Ü_txf_Ën
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

612 
ËÅ
, 
µos
)

614 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

615 
u_št
 
v®
;

616 
»t
;

618 
ùl
->
d©a
 = &
v®
;

619 
ùl
->
maxËn
 = (
v®
);

620 ià(
wr™e
) {

621 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

622 
ËÅ
, 
µos
);

623 ià(
»t
 == 0)

624 
v­
->
iv_mÚ™Ü_txf_Ën
 = 
v®
;

626 
v®
 = 
v­
->
iv_mÚ™Ü_txf_Ën
;

627 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

628 
ËÅ
, 
µos
);

630  
»t
;

631 
	}
}

634 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_mÚ™Ü_phy_”rÜs
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

635 
ËÅ
, 
µos
)

637 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

638 
u_št
 
v®
;

639 
»t
;

641 
ùl
->
d©a
 = &
v®
;

642 
ùl
->
maxËn
 = (
v®
);

643 ià(
wr™e
) {

644 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

645 
ËÅ
, 
µos
);

646 ià(
»t
 == 0)

647 
v­
->
iv_mÚ™Ü_phy_”rÜs
 = 
v®
;

649 
v®
 = 
v­
->
iv_mÚ™Ü_phy_”rÜs
;

650 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

651 
ËÅ
, 
µos
);

653  
»t
;

654 
	}
}

657 
	$IEEE80211_SYSCTL_DECL
(
›“80211_sysùl_mÚ™Ü_üc_”rÜs
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
,

658 
ËÅ
, 
µos
)

660 
›“80211v­
 *
v­
 = 
ùl
->
exŒa1
;

661 
u_št
 
v®
;

662 
»t
;

664 
ùl
->
d©a
 = &
v®
;

665 
ùl
->
maxËn
 = (
v®
);

666 ià(
wr™e
) {

667 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

668 
ËÅ
, 
µos
);

669 ià(
»t
 == 0)

670 
v­
->
iv_mÚ™Ü_üc_”rÜs
 = 
v®
;

672 
v®
 = 
v­
->
iv_mÚ™Ü_üc_”rÜs
;

673 
»t
 = 
	`IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
,

674 
ËÅ
, 
µos
);

676  
»t
;

677 
	}
}

679 cÚ¡ 
ùl_bË
 
	g›“80211_sysùl_‹m¶©e
[] = {

680 #ifdeà
IEEE80211_DEBUG


681 { .
ùl_Çme
 = 
CTL_AUTO
,

682 .
	g´oúame
 = "debug",

683 .
	gmode
 = 0644,

684 .
	g´oc_hªdËr
 = 
›“80211_sysùl_debug


687 { .
	gùl_Çme
 = 
CTL_AUTO
,

688 .
	g´oúame
 = "dev_type",

689 .
	gmode
 = 0644,

690 .
	g´oc_hªdËr
 = 
›“80211_sysùl_dev_ty³


692 { .
	gùl_Çme
 = 
CTL_AUTO
,

693 .
	g´oúame
 = "monitor_nods_only",

694 .
	gmode
 = 0644,

695 .
	g´oc_hªdËr
 = 
›“80211_sysùl_mÚ™Ü_nods_Úly


697 { .
	gùl_Çme
 = 
CTL_AUTO
,

698 .
	g´oúame
 = "monitor_txf_len",

699 .
	gmode
 = 0644,

700 .
	g´oc_hªdËr
 = 
›“80211_sysùl_mÚ™Ü_txf_Ën


702 { .
	gùl_Çme
 = 
CTL_AUTO
,

703 .
	g´oúame
 = "monitor_phy_errors",

704 .
	gmode
 = 0644,

705 .
	g´oc_hªdËr
 = 
›“80211_sysùl_mÚ™Ü_phy_”rÜs


707 { .
	gùl_Çme
 = 
CTL_AUTO
,

708 .
	g´oúame
 = "monitor_crc_errors",

709 .
	gmode
 = 0644,

710 .
	g´oc_hªdËr
 = 
›“80211_sysùl_mÚ™Ü_üc_”rÜs


713 { .
	gùl_Çme
 = 
CTL_AUTO
,

714 .
	g´oúame
 = "%parent",

715 .
	gmaxËn
 = 
IFNAMSIZ
,

716 .
	gmode
 = 0444,

717 .
	g´oc_hªdËr
 = 
´oc_do¡ršg


723 
	$›“80211_vœtfs_Ï‹v©ch
(
›“80211v­
 *
v­
)

725 
i
, 
¥aû
;

726 *
devÇme
 = 
NULL
;

727 
›“80211_´oc_’Œy
 *
tmp
 = 
NULL
;

728 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,17)

729 
»t
;

731 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,21)

732 
»t
 = 
	`sysfs_ü—‹_group
(&
v­
->
iv_dev
->
dev
.
kobj
, &
›“80211_©Œ_g½
);

734 
»t
 = 
	`sysfs_ü—‹_group
(&
v­
->
iv_dev
->
şass_dev
.
kobj
, &
›“80211_©Œ_g½
);

736 ià(
»t
) {

737 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,21)

738 
	`sysfs_»move_group
(&
v­
->
iv_dev
->
dev
.
kobj
, &
›“80211_©Œ_g½
);

740 
	`sysfs_»move_group
(&
v­
->
iv_dev
->
şass_dev
.
kobj
, &
›“80211_©Œ_g½
);

742 
	`´štk
("%s: %s - unableo create sysfs‡ttribute group\n",

743 
__func__
, 
v­
->
iv_dev
->
Çme
);

748 
¥aû
 = 5 * (
ùl_bË
è+ (
›“80211_sysùl_‹m¶©e
);

749 
v­
->
iv_sysùls
 = 
	`kz®loc
(
¥aû
, 
GFP_KERNEL
);

750 ià(
v­
->
iv_sysùls
 =ğ
NULL
) {

751 
	`´štk
("%s:‚ØmemÜy fÜ sysùÈbË!\n", 
__func__
);

759 
devÇme
 = 
	`km®loc
((
	`¡¾’
(
v­
->
iv_dev
->
Çme
è+ 1è* (), 
GFP_KERNEL
);

760 ià(
devÇme
 =ğ
NULL
) {

761 
	`´štk
("%s:‚ØmemÜy fÜ VAP‚ame!\n", 
__func__
);

764 
	`¡ºıy
(
devÇme
, 
v­
->
iv_dev
->
Çme
, 
	`¡¾’
(vap->iv_dev->name) + 1);

767 
v­
->
iv_sysùls
[0].
ùl_Çme
 = 
CTL_NET
;

768 
v­
->
iv_sysùls
[0].
´oúame
 = "net";

769 
v­
->
iv_sysùls
[0].
mode
 = 0555;

770 
v­
->
iv_sysùls
[0].
chd
 = &vap->iv_sysctls[2];

772 
v­
->
iv_sysùls
[2].
ùl_Çme
 = 
CTL_AUTO
;

773 
v­
->
iv_sysùls
[2].
´oúame
 = 
devÇme
;

774 
v­
->
iv_sysùls
[2].
mode
 = 0555;

775 
v­
->
iv_sysùls
[2].
chd
 = &vap->iv_sysctls[4];

778 
	`memıy
(&
v­
->
iv_sysùls
[4], 
›“80211_sysùl_‹m¶©e
,

779 (
›“80211_sysùl_‹m¶©e
));

782 
i
 = 4; 
v­
->
iv_sysùls
[i].
´oúame
; i++)

783 ià(
v­
->
iv_sysùls
[
i
].
exŒa1
 =ğ
NULL
)

784 
v­
->
iv_sysùls
[
i
].
exŒa1
 = vap;

787 
v­
->
iv_sysùls
[
i
-1].
d©a
 = v­->
iv_ic
->
ic_dev
->
Çme
;

790 
v­
->
iv_sysùl_h—d”
 = 
	`ATH_REGISTER_SYSCTL_TABLE
(v­->
iv_sysùls
);

791 ià(!
v­
->
iv_sysùl_h—d”
) {

792 
	`´štk
("%s: faedØ»gi¡” sysùls!\n", 
v­
->
iv_dev
->
Çme
);

793 
	`kä“
(
devÇme
);

794 
	`kä“
(
v­
->
iv_sysùls
);

795 
v­
->
iv_sysùls
 = 
NULL
;

799 ià(!
´oc_madwifi
 && 
´oc_Ãt
 !ğ
NULL
) {

800 
´oc_madwifi
 = 
	`´oc_mkdœ
("madwifi", 
´oc_Ãt
);

801 ià(!
´oc_madwifi
)

802 
	`´štk
(
KERN_WARNING
 "Failedo mkdir /proc/net/madwifi\n");

806 ià(
´oc_madwifi
) {

807 
´oc_madwifi_couÁ
++;

808 
v­
->
iv_´oc
 = 
	`´oc_mkdœ
(v­->
iv_dev
->
Çme
, 
´oc_madwifi
);

812 
	`›“80211_´oc_vü—‹
(
v­
, &
´oc_›“80211_İs
, "associated_sta");

815 ià(
v­
->
iv_´oc
) {

816 
tmp
 = 
v­
->
iv_´oc_’Œ›s
;

817 
tmp
) {

818 ià(!
tmp
->
’Œy
) {

819 
tmp
->
’Œy
 = 
	`ü—‹_´oc_’Œy
Ñmp->
Çme
,

820 
PROC_IEEE80211_PERM
, 
v­
->
iv_´oc
);

821 
tmp
->
’Œy
->
d©a
 = 
v­
;

822 
tmp
->
’Œy
->
´oc_fİs
 =mp->
feİs
;

824 
tmp
 =mp->
Ãxt
;

827 
	}
}

831 
	$›“80211_´oc_ş—nup
(
›“80211v­
 *
v­
)

833 
›“80211_´oc_’Œy
 *
tmp
 = 
v­
->
iv_´oc_’Œ›s
;

834 
›“80211_´oc_’Œy
 *
Ãxt
 = 
NULL
;

835 
tmp
) {

836 
Ãxt
 = 
tmp
->next;

837 
	`kä“
(
tmp
);

838 
tmp
 = 
Ãxt
;

840 
	}
}

844 
	$›“80211_´oc_vü—‹
(
›“80211v­
 *
v­
,

845 
fe_İ”©iÚs
 *
feİs
, *
Çme
)

847 
›“80211_´oc_’Œy
 *
’Œy
;

848 
›“80211_´oc_’Œy
 *
tmp
 = 
NULL
;

851 ià(
v­
->
iv_´oc_’Œ›s
) {

852 
tmp
 = 
v­
->
iv_´oc_’Œ›s
;

854 ià(
	`¡rcmp
(
tmp
->
Çme
,‚ame)==0)

857 ià(!
tmp
->
Ãxt
)

860 
tmp
 =mp->
Ãxt
;

865 
’Œy
 = 
	`km®loc
((
›“80211_´oc_’Œy
), 
GFP_KERNEL
);

866 ià(
’Œy
 =ğ
NULL
) {

867 
	`´štk
("%s:‚ØmemÜy fÜ‚ew…roø’Œy (%s)!\n", 
__func__
,

868 
Çme
);

873 ià(!
feİs
->
İ’
)

874 
feİs
->
İ’
 = 
´oc_›“80211_İ’
;

875 ià(!
feİs
->
»Ëa£
)

876 
feİs
->
»Ëa£
 = 
´oc_›“80211_şo£
;

877 ià(!
feİs
->
»ad
)

878 
feİs
->
»ad
 = 
´oc_›“80211_»ad
;

879 ià(!
feİs
->
wr™e
)

880 
feİs
->
wr™e
 = 
´oc_›“80211_wr™e
;

883 
’Œy
->
Çme
 =‚ame;

884 
’Œy
->
feİs
 = fileops;

885 
’Œy
->
Ãxt
 = 
NULL
;

886 
’Œy
->’Œy = 
NULL
;

889 ià(
v­
->
iv_´oc
) {

890 
’Œy
->’Œy = 
	`ü—‹_´oc_’Œy
ÓÁry->
Çme
,

891 
PROC_IEEE80211_PERM
, 
v­
->
iv_´oc
);

892 
’Œy
->’Œy->
d©a
 = 
v­
;

893 
’Œy
->’Œy->
´oc_fİs
 =ƒÁry->
feİs
;

897 ià(!
tmp
) {

899 
v­
->
iv_´oc_’Œ›s
 = 
’Œy
;

902 
tmp
->
Ãxt
 = 
’Œy
;

906 
	}
}

907 
EXPORT_SYMBOL
(
›“80211_´oc_vü—‹
);

910 
	$›“80211_vœtfs_vd‘ach
(
›“80211v­
 *
v­
)

912 
›“80211_´oc_’Œy
 *
tmp
=
NULL
;

914 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,21)

915 
	`sysfs_»move_group
(&
v­
->
iv_dev
->
dev
.
kobj
, &
›“80211_©Œ_g½
);

916 #–ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,17)

917 
	`sysfs_»move_group
(&
v­
->
iv_dev
->
şass_dev
.
kobj
, &
›“80211_©Œ_g½
);

920 ià(
v­
->
iv_sysùl_h—d”
) {

921 
	`uÄegi¡”_sysùl_bË
(
v­
->
iv_sysùl_h—d”
);

922 
v­
->
iv_sysùl_h—d”
 = 
NULL
;

925 ià(
v­
->
iv_´oc
) {

927 
tmp
 = 
v­
->
iv_´oc_’Œ›s
;

928 
tmp
) {

929 ià(
tmp
->
’Œy
) {

930 
	`»move_´oc_’Œy
(
tmp
->
Çme
, 
v­
->
iv_´oc
);

931 
tmp
->
’Œy
 = 
NULL
;

933 
tmp
 =mp->
Ãxt
;

935 
	`»move_´oc_’Œy
(
v­
->
iv_´oc
->
Çme
, 
´oc_madwifi
);

936 ià(
´oc_madwifi_couÁ
 == 1) {

937 
	`»move_´oc_’Œy
("madwifi", 
´oc_Ãt
);

938 
´oc_madwifi
 = 
NULL
;

940 
´oc_madwifi_couÁ
--;

943 ià(
v­
->
iv_sysùls
 && v­->iv_sysùls[2].
´oúame
) {

944 
	`kä“
(
v­
->
iv_sysùls
[2].
´oúame
);

945 
v­
->
iv_sysùls
[2].
´oúame
 = 
NULL
;

948 ià(
v­
->
iv_sysùls
) {

949 
	`kä“
(
v­
->
iv_sysùls
);

950 
v­
->
iv_sysùls
 = 
NULL
;

952 
	}
}

961 
	$›“80211_rcv_dev_ev’t
(
nÙif›r_block
 *
this
, 
ev’t
,

962 *
±r
)

964 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
±r
;

965 ià(!
dev
 || dev->
İ’
 !ğ&
›“80211_İ’
)

968 
ev’t
) {

969 
NETDEV_CHANGENAME
:

970 
	`›“80211_vœtfs_vd‘ach
(
	`Ãtdev_´iv
(
dev
));

971 
	`›“80211_vœtfs_Ï‹v©ch
(
	`Ãtdev_´iv
(
dev
));

972  
NOTIFY_DONE
;

977 
	}
}

979 
nÙif›r_block
 
	g›“80211_ev’t_block
 = {

980 .
nÙif›r_ÿÎ
 = 
›“80211_rcv_dev_ev’t


986 
	~"»Ëa£.h
"

988 *
	gv”siÚ
 = 
RELEASE_VERSION
;

989 *
	gdev_šfo
 = "wlan";

992 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

993 
MODULE_DESCRIPTION
("802.11 wireless LAN…rotocol support");

994 #ifdeà
MODULE_VERSION


995 
MODULE_VERSION
(
RELEASE_VERSION
);

997 #ifdeà
MODULE_LICENSE


998 
MODULE_LICENSE
("Dual BSD/GPL");

1001 
›“80211_auth_£tup
();

1003 
__š™


1004 
	$š™_wÏn
()

1006 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
›“80211_ev’t_block
);

1008 
	}
}

1009 
moduË_š™
(
š™_wÏn
);

1011 
__ex™


1012 
	$ex™_wÏn
()

1014 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
›“80211_ev’t_block
);

1015 
	}
}

1016 
moduË_ex™
(
ex™_wÏn
);

	@ieee80211_linux.h

29 #iâdeà
_NET80211_IEEE80211_LINUX_H_


30 
	#_NET80211_IEEE80211_LINUX_H_


	)

32 
	~<lšux/wœ–ess.h
>

33 
	~<lšux/fs.h
>

39 #iâdeà
IW_QUAL_QUAL_UPDATED


40 
	#IW_QUAL_QUAL_UPDATED
 0x01

	)

41 
	#IW_QUAL_LEVEL_UPDATED
 0x02

	)

42 
	#IW_QUAL_NOISE_UPDATED
 0x04

	)

43 
	#IW_QUAL_QUAL_INVALID
 0x10

	)

44 
	#IW_QUAL_LEVEL_INVALID
 0x20

	)

45 
	#IW_QUAL_NOISE_INVALID
 0x40

	)

48 #iâdeà
IW_QUAL_ALL_UPDATED


49 
	#IW_QUAL_ALL_UPDATED
 \

50 (
IW_QUAL_QUAL_UPDATED
 | 
IW_QUAL_LEVEL_UPDATED
 | 
IW_QUAL_NOISE_UPDATED
)

	)

52 #iâdeà
IW_QUAL_ALL_INVALID


53 
	#IW_QUAL_ALL_INVALID
 \

54 (
IW_QUAL_QUAL_INVALID
 | 
IW_QUAL_LEVEL_INVALID
 | 
IW_QUAL_NOISE_INVALID
)

	)

70 
__šlše
 

71 
	$£t_qu®™y
(
iw_qu®™y
 *
iq
, 
u_št
 
rssi
, 
noi£
)

73 
iq
->
qu®
 = 
rssi
;

74 
iq
->
noi£
 =‚oise;

75 
iq
->
Ëv–
 = (((()
rssi
 + 
noi£
) <= 0) ? (()rssi +‚oise) : 0);

76 
iq
->
upd©ed
 = 
IW_QUAL_ALL_UPDATED
;

77 #ià
WIRELESS_EXT
 >= 19

78 
iq
->
upd©ed
 |ğ
IW_QUAL_DBM
;

80 
	}
}

88 
	~<lšux/š‹¼u±.h
>

89 #ifdeà
DECLARE_TASKLET


90 
	#IEEE80211_TQ_STRUCT
 
skËt_¡ruù


	)

91 
	#IEEE80211_INIT_TQUEUE
(
a
,
b
,
c
è
	`skËt_š™
(×), (b), ()(c))

	)

92 
	#IEEE80211_SCHEDULE_TQUEUE
(
a
è
	`skËt_scheduË
(×))

	)

93 
	#IEEE80211_CANCEL_TQUEUE
(
a
èià(!
	`š_š‹¼u±
()è
	`skËt_kl
(×))

	)

94 
	tIEEE80211_TQUEUE_ARG
;

95 
	#m¬k_bh
(
a
èdØ{} 0)

	)

97 
	#IEEE80211_TQ_STRUCT
 
tq_¡ruù


	)

98 
	#IEEE80211_INIT_TQUEUE
(
a
,
b
,
c
è
	`INIT_TQUEUE
×,b,c)

	)

99 
	#IEEE80211_SCHEDULE_TQUEUE
(
a
) do { \

100 
__maüo_Ãedm¬k
; \

101 
__maüo_Ãedm¬k
 |ğ
	`queue_sk
((
a
), &
tq_immedŸ‹
); \

102 ià(
__maüo_Ãedm¬k
) \

103 
	`m¬k_bh
(
IMMEDIATE_BH
); \

104 } 0)

	)

105 *
	tIEEE80211_TQUEUE_ARG
;

106 
	#skËt_di§bË
(
t
èdØ{ (èt; 
	`loÿl_bh_di§bË
(); } 0)

	)

107 
	#skËt_’abË
(
t
èdØ{ (èt; 
	`loÿl_bh_’abË
(); } 0)

	)

109 
	#IEEE80211_CANCEL_TQUEUE
(
a
è(×), 0)

	)

112 
	#IEEE80211_RESCHEDULE
 
scheduË


	)

125 
¥šlock_t
 
	t›“80211com_lock_t
;

126 
	#IEEE80211_LOCK_INIT
(
_ic
, 
_Çme
) \

127 
	`¥š_lock_š™
(&(
_ic
)->
ic_comlock
)

	)

128 
	#IEEE80211_LOCK_DESTROY
(
_ic
)

	)

129 
	#IEEE80211_LOCK_IRQ
(
_ic
) do { \

130 
__ockæags
; \

131 
	`IEEE80211_LOCK_CHECK
(
_ic
); \

132 
	`¥š_lock_œq§ve
(&(
_ic
)->
ic_comlock
, 
__ockæags
);

	)

133 
	#IEEE80211_UNLOCK_IRQ
(
_ic
) \

134 
	`IEEE80211_LOCK_ASSERT
(
_ic
); \

135 
	`¥š_uÆock_œq»¡Üe
(&(
_ic
)->
ic_comlock
, 
__ockæags
); \

136 } 0)

	)

137 
	#IEEE80211_UNLOCK_IRQ_EARLY
(
_ic
) \

138 
	`IEEE80211_LOCK_ASSERT
(
_ic
); \

139 
	`¥š_uÆock_œq»¡Üe
(&(
_ic
)->
ic_comlock
, 
__ockæags
);

	)

141 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

142 
	#IEEE80211_LOCK_ASSERT
(
_ic
) \

143 
	`KASSERT
(
	`¥š_is_locked
(&(
_ic
)->
ic_comlock
), ("›“80211com‚Ù†ocked!"))

	)

144 #ià(
defšed
(
ATH_DEBUG_SPINLOCKS
))

145 
	#IEEE80211_LOCK_CHECK
(
_ic
) do { \

146 ià(
	`¥š_is_locked
(&(
_ic
)->
ic_comlock
)) \

147 
	`´štk
("%s:%d -‡bouˆtØblock oÀ›“80211com†ock!\n", 
__func__
, 
__LINE__
); \

148 } 0)

	)

150 
	#IEEE80211_LOCK_CHECK
(
_ic
)

	)

153 
	#IEEE80211_LOCK_ASSERT
(
_ic
)

	)

154 
	#IEEE80211_LOCK_CHECK
(
_ic
)

	)

158 
	#IEEE80211_VAPS_LOCK_INIT
(
_ic
, 
_Çme
) \

159 
	`¥š_lock_š™
(&(
_ic
)->
ic_v­¦ock
)

	)

160 
	#IEEE80211_VAPS_LOCK_DESTROY
(
_ic
)

	)

161 
	#IEEE80211_VAPS_LOCK_BH
(
_ic
) do { \

162 
	`IEEE80211_VAPS_LOCK_CHECK
(
_ic
); \

163 
	`¥š_lock_bh
(&(
_ic
)->
ic_v­¦ock
);

	)

164 
	#IEEE80211_VAPS_UNLOCK_BH
(
_ic
) \

165 
	`IEEE80211_VAPS_LOCK_ASSERT
(
_ic
); \

166 
	`¥š_uÆock_bh
(&(
_ic
)->
ic_v­¦ock
); \

167 } 0)

	)

169 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

170 
	#IEEE80211_VAPS_LOCK_ASSERT
(
_ic
) \

171 
	`KASSERT
(
	`¥š_is_locked
(&(
_ic
)->
ic_v­¦ock
), \

172 ("›“80211com_v­ nÙ†ocked!"))

	)

173 #ià(
defšed
(
ATH_DEBUG_SPINLOCKS
))

174 
	#IEEE80211_VAPS_LOCK_CHECK
(
_ic
) do { \

175 ià(
	`¥š_is_locked
(&(
_ic
)->
ic_v­¦ock
)) \

176 
	`´štk
("%s:%d -‡bouˆtØblock oÀ›“80211com_v­ lock!\n", 
__func__
, 
__LINE__
); \

177 } 0)

	)

179 
	#IEEE80211_VAPS_LOCK_CHECK
(
_ic
)

	)

182 
	#IEEE80211_VAPS_LOCK_ASSERT
(
_ic
)

	)

183 
	#IEEE80211_VAPS_LOCK_CHECK
(
_ic
)

	)

192 
¥šlock_t
 
	t›“80211_node_lock_t
;

193 
	#IEEE80211_NODE_LOCK_INIT
(
_ni
, 
_Çme
è
	`¥š_lock_š™
(&(_ni)->
ni_nod–ock
)

	)

194 
	#IEEE80211_NODE_LOCK_DESTROY
(
_ni
)

	)

195 
	#IEEE80211_NODE_LOCK_IRQ
(
_ni
) do { \

196 
__node_lockæags
; \

197 
	`IEEE80211_NODE_LOCK_CHECK
(
_ni
); \

198 
	`¥š_lock_œq§ve
(&(
_ni
)->
ni_nod–ock
, 
__node_lockæags
);

	)

199 
	#IEEE80211_NODE_UNLOCK_IRQ
(
_ni
) \

200 
	`IEEE80211_NODE_LOCK_ASSERT
(
_ni
); \

201 
	`¥š_uÆock_œq»¡Üe
(&(
_ni
)->
ni_nod–ock
, 
__node_lockæags
); \

202 } 0)

	)

203 
	#IEEE80211_NODE_LOCK_IRQ_INSIDE
(
_tq
) do { \

204 
	`IEEE80211_NODE_LOCK_CHECK
(
_ni
); \

205 
	`¥š_lock
(&(
_ni
)->
ni_nod–ock
);

	)

207 
	#IEEE80211_NODE_UNLOCK_IRQ_INSIDE
(
_tq
) do { \

208 
	`IEEE80211_NODE_LOCK_ASSERT
(
_ni
); \

209 
	`¥š_uÆock
(&(
_ni
)->
ni_nod–ock
); \

210 
	}

	`}whe
 (0)

	)

211 
	#IEEE80211_NODE_UNLOCK_IRQ_EARLY
(
_ni
) \

212 
	`IEEE80211_NODE_LOCK_ASSERT
(
_ni
); \

213 
	`¥š_uÆock_œq»¡Üe
(&(
_ni
)->
ni_nod–ock
, 
__node_lockæags
);

	)

215 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

216 
	#IEEE80211_NODE_LOCK_ASSERT
(
_ni
) \

217 
	`KASSERT
(
	`¥š_is_locked
(&(
_ni
)->
ni_nod–ock
), \

218 ("802.11‚odnÙ†ocked!"))

	)

219 #ià(
defšed
(
ATH_DEBUG_SPINLOCKS
))

220 
	#IEEE80211_NODE_LOCK_CHECK
(
_ni
) do { \

221 ià(
	`¥š_is_locked
(&(
_ni
)->
ni_nod–ock
)) \

222 
	`´štk
("%s:%d -‡bouˆtØblock oÀnodlock!\n", 
__func__
, 
__LINE__
); \

223 } 0)

	)

225 
	#IEEE80211_NODE_LOCK_CHECK
(
_ni
)

	)

228 
	#IEEE80211_NODE_LOCK_ASSERT
(
_ni
)

	)

229 
	#IEEE80211_NODE_LOCK_CHECK
(
_ni
)

	)

237 
¥šlock_t
 
	t›“80211_node_bË_lock_t
;

238 
	#IEEE80211_NODE_TABLE_LOCK_INIT
(
_Á
, 
_Çme
è
	`¥š_lock_š™
(&(_Á)->
Á_nod–ock
)

	)

239 
	#IEEE80211_NODE_TABLE_LOCK_DESTROY
(
_Á
)

	)

241 
	#IEEE80211_NODE_TABLE_LOCK
(
_Á
è
	`¥š_lock
(&(_Á)->
Á_nod–ock
)

	)

242 
	#IEEE80211_NODE_TABLE_UNLOCK
(
_Á
è
	`¥š_uÆock
(&(_Á)->
Á_nod–ock
)

	)

243 
	#IEEE80211_NODE_TABLE_LOCK_BH
(
_Á
è
	`¥š_lock_bh
(&(_Á)->
Á_nod–ock
)

	)

244 
	#IEEE80211_NODE_TABLE_UNLOCK_BH
(
_Á
è
	`¥š_uÆock_bh
(&(_Á)->
Á_nod–ock
)

	)

246 
	#IEEE80211_NODE_TABLE_LOCK_IRQ
(
_Á
) do { \

247 
__node_lockæags
; \

248 
	`¥š_lock_œq§ve
(&(
_Á
)->
Á_nod–ock
, 
__node_lockæags
);

	)

249 
	#IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
_Á
) \

250 
	`¥š_uÆock_œq»¡Üe
(&(
_Á
)->
Á_nod–ock
, 
__node_lockæags
); \

251 } 0)

	)

252 
	#IEEE80211_NODE_TABLE_UNLOCK_IRQ_EARLY
(
_Á
) \

253 
	`¥š_uÆock_œq»¡Üe
(&(
_Á
)->
Á_nod–ock
, 
__node_lockæags
);

	)

255 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

256 
	#IEEE80211_NODE_TABLE_LOCK_ASSERT
(
_Á
) \

257 
	`KASSERT
(
	`¥š_is_locked
(&(
_Á
)->
Á_nod–ock
), \

258 ("802.11‚odbË‚Ù†ocked!"))

	)

260 
	#IEEE80211_NODE_TABLE_LOCK_ASSERT
(
_Á
)

	)

266 
¥šlock_t
 
	t›“80211_sÿn_lock_t
;

267 
	#IEEE80211_SCAN_LOCK_INIT
(
_Á
, 
_Çme
è
	`¥š_lock_š™
(&(_Á)->
Á_sÿÆock
)

	)

268 
	#IEEE80211_SCAN_LOCK_DESTROY
(
_Á
)

	)

269 
	#IEEE80211_SCAN_LOCK_IRQ
(
_Á
) do { \

270 
__sÿn_lockæags
; \

271 
	`¥š_lock_œq§ve
(&(
_Á
)->
Á_sÿÆock
, 
__sÿn_lockæags
);

	)

272 
	#IEEE80211_SCAN_UNLOCK_IRQ
(
_Á
) \

273 
	`¥š_uÆock_œq»¡Üe
(&(
_Á
)->
Á_sÿÆock
, 
__sÿn_lockæags
); \

274 } 0)

	)

275 
	#IEEE80211_SCAN_UNLOCK_IRQ_EARLY
(
_Á
) \

276 
	`¥š_uÆock_œq»¡Üe
(&(
_Á
)->
Á_sÿÆock
, 
__sÿn_lockæags
);

	)

278 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

279 
	#IEEE80211_SCAN_LOCK_ASSERT
(
_Á
) \

280 
	`KASSERT
(
	`¥š_is_locked
(&(
_Á
)->
Á_sÿÆock
), ("sÿng’‚Ù†ocked!"))

	)

282 
	#IEEE80211_SCAN_LOCK_ASSERT
(
_Á
)

	)

288 
¥šlock_t
 
	taş_lock_t
;

289 
	#ACL_LOCK_INIT
(
_as
, 
_Çme
è
	`¥š_lock_š™
(&(_as)->
as_lock
)

	)

290 
	#ACL_LOCK_DESTROY
(
_as
)

	)

291 
	#ACL_LOCK
(
_as
) do { \

292 
	`ACL_LOCK_CHECK
(
_as
); \

293 
	`¥š_lock
(&(
_as
)->
as_lock
);

	)

294 
	#ACL_UNLOCK
(
_as
) \

295 
	`ACL_LOCK_ASSERT
(
_as
); \

296 
	`¥š_uÆock
(&(
_as
)->
as_lock
); \

297 } 0)

	)

298 
	#ACL_UNLOCK_EARLY
(
_as
) \

299 
	`ACL_LOCK_ASSERT
(
_as
); \

300 
	`¥š_uÆock
(&(
_as
)->
as_lock
);

	)

302 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

303 
	#ACL_LOCK_ASSERT
(
_as
) \

304 
	`KASSERT
(
	`¥š_is_locked
(&(
_as
)->
as_lock
), ("ACL‚Ù†ocked!"))

	)

305 #ià(
defšed
(
ATH_DEBUG_SPINLOCKS
))

306 
	#ACL_LOCK_CHECK
(
_as
) do { \

307 ià(
	`¥š_is_locked
(&(
_as
)->
as_lock
)) \

308 
	`´štk
("%s:%d -‡bouˆtØblock oÀACL†ock!\n", 
__func__
, 
__LINE__
); \

309 } 0)

	)

311 
	#ACL_LOCK_CHECK
(
_as
)

	)

314 
	#ACL_LOCK_ASSERT
(
_as
)

	)

315 
	#ACL_LOCK_CHECK
(
_as
)

	)

322 
	#IEEE80211_NODE_SAVEQ_INIT
(
_ni
, 
_Çme
) do { \

323 
	`skb_queue_h—d_š™
(&(
_ni
)->
ni_§vedq
); \

324 } 0)

	)

325 
	#IEEE80211_NODE_SAVEQ_DESTROY
(
_ni
)

	)

326 
	#IEEE80211_NODE_SAVEQ_QLEN
(
_ni
è
	`skb_queue_Ën
(&(_ni)->
ni_§vedq
)

	)

327 
	#IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
_ni
) do { \

328 
__qlockæags
; \

329 
	`IEEE80211_NODE_SAVEQ_LOCK_CHECK
(
_ni
); \

330 
	`¥š_lock_œq§ve
(&(
_ni
)->
ni_§vedq
.
lock
, 
__qlockæags
);

	)

331 
	#IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
_ni
) \

332 
	`IEEE80211_NODE_SAVEQ_LOCK_ASSERT
(
_ni
); \

333 
	`¥š_uÆock_œq»¡Üe
(&(
_ni
)->
ni_§vedq
.
lock
, 
__qlockæags
); \

334 } 0)

	)

335 
	#IEEE80211_NODE_SAVEQ_LOCK_IRQ_INSIDE
(
_ni
) do { \

336 
	`IEEE80211_NODE_SAVEQ_LOCK_CHECK
(
_ni
); \

337 
	`¥š_lock
(&(
_ni
)->
ni_§vedq
.
lock
); \

338 } 0)

	)

339 
	#IEEE80211_NODE_SAVEQ_UNLOCK_IRQ_INSIDE
(
_ni
) do { \

340 
	`IEEE80211_NODE_SAVEQ_LOCK_ASSERT
(
_ni
); \

341 
	`¥š_uÆock
(&(
_ni
)->
ni_§vedq
.
lock
); \

342 } 0)

	)

343 
	#IEEE80211_NODE_SAVEQ_UNLOCK_IRQ_EARLY
(
_ni
) \

344 
	`IEEE80211_NODE_SAVEQ_LOCK_ASSERT
(
_ni
); \

345 
	`¥š_uÆock_œq»¡Üe
(&(
_ni
)->
ni_§vedq
.
lock
, 
__qlockæags
);

	)

347 #ià(
defšed
(
CONFIG_SMP
è|| defšed(
CONFIG_DEBUG_SPINLOCK
)è&& defšed(
¥š_is_locked
)

348 
	#IEEE80211_NODE_SAVEQ_LOCK_ASSERT
(
_ni
) \

349 
	`KASSERT
(
	`¥š_is_locked
(&(
_ni
)->
ni_§vedq
.
lock
), \

350 ("nod§veq‚Ù†ocked!"))

	)

351 #ià(
defšed
(
ATH_DEBUG_SPINLOCKS
))

352 
	#IEEE80211_NODE_SAVEQ_LOCK_CHECK
(
_ni
) do { \

353 ià(
	`¥š_is_locked
(&(
_ni
)->
ni_§vedq
.
lock
)) \

354 
	`´štk
("%s:%d -‡bouˆtØblock oÀnod§veq†ock!\n", 
__func__
, 
__LINE__
); \

355 } 0)

	)

357 
	#IEEE80211_NODE_SAVEQ_LOCK_CHECK
(
_ni
)

	)

360 
	#IEEE80211_NODE_SAVEQ_LOCK_ASSERT
(
_ni
)

	)

361 
	#IEEE80211_NODE_SAVEQ_LOCK_CHECK
(
_ni
)

	)

365 
	#IEEE80211_NODE_SAVEQ_DEQUEUE
(
_ni
, 
_skb
, 
_qËn
) do { \

366 
_skb
 = 
	`__skb_dequeue
(&(
_ni
)->
ni_§vedq
); \

367 (
_qËn
èğ
	`skb_queue_Ën
(&(
_ni
)->
ni_§vedq
); \

368 } 0)

	)

369 
	#_IEEE80211_NODE_SAVEQ_ENQUEUE
(
_ni
, 
_skb
, 
_qËn
, 
_age
) do { \

370 
sk_buff
 *

 = 
	`skb_³ek_
(&(
_ni
)->
ni_§vedq
); \

371 ià(

 !ğ
NULL
) { \

372 
_age
 -ğ
	`M_AGE_GET
(

); \

373 
	`__skb_queue_aá”
(&(
_ni
)->
ni_§vedq
, 

, 
_skb
); \

375 
	`__skb_queue_h—d
(&(
_ni
)->
ni_§vedq
, 
_skb
); \

377 
	`M_AGE_SET
(
_skb
, 
_age
); \

378 (
_qËn
èğ
	`skb_queue_Ën
(&(
_ni
)->
ni_§vedq
); \

379 } 0)

	)

392 
	s›“80211_phy_·¿ms
 {

393 
u_št8_t
 
	m¿‹
[4];

394 
u_št8_t
 
	mŒy
[4];

396 
u_št8_t
 
	mpow”
;

397 
u_št32_t
 
	mæags
;

400 
	s›“80211_cb
 {

401 
u_št8_t
 
	m__»£rved_vÏn
[8];

402 
›“80211_phy_·¿ms
 
	mphy
;

403 
›“80211_node
 *
	mni
;

404 
u_št32_t
 
	mæags
;

405 
	#M_LINK0
 0x01

	)

406 
	#M_FF
 0x02

	)

407 
	#M_PWR_SAV
 0x04

	)

408 
	#M_UAPSD
 0x08

	)

409 
	#M_RAW
 0x10

	)

410 #ifdeà
IEEE80211_DEBUG_REFCNT


411 
	#M_SKB_TRACKED
 0x20

	)

412 (*
	mÃxt_de¡ruùÜ
)(
sk_buff
 *
	mskb
);

416 
	s__as£¹
 {

417 
	m__›“80211_cb_size
[(
›“80211_cb
) <= 48 ? 0 : -1];

420 
	g›“80211com
;

421 
	g›“80211v­
;

423 
›“80211_lßd_moduË
(const *);

425 
	#Ë16toh
(
_x
è
	`Ë16_to_ıu
(_x)

	)

426 
	#htŞe16
(
_x
è
	`ıu_to_Ë16
(_x)

	)

427 
	#Ë32toh
(
_x
è
	`Ë32_to_ıu
(_x)

	)

428 
	#htŞe32
(
_x
è
	`ıu_to_Ë32
(_x)

	)

429 
	#be32toh
(
_x
è
	`be32_to_ıu
(_x)

	)

430 
	#htobe32
(
_x
è
	`ıu_to_be32
(_x)

	)

435 
	#MALLOC_DEFINE
(
ty³
, 
shÜtdesc
, 
lÚgdesc
)

	)

436 
	#MALLOC_DECLARE
(
ty³
)

	)

441 
	#M_NOWAIT
 0x0001

	)

442 
	#M_WAITOK
 0x0002

	)

443 
	#M_ZERO
 0x0100

	)

445 
__šlše
 *

446 
	$›“80211_m®loc
(
size_t
 
size
, 
æags
)

448 *
p
 = 
	`km®loc
(
size
, 
æags
 & 
M_NOWAIT
 ? 
GFP_ATOMIC
 : 
GFP_KERNEL
);

449 ià(
p
 && (
æags
 & 
M_ZERO
))

450 
	`mem£t
(
p
, 0, 
size
);

451  
p
;

452 
	}
}

453 
	#MALLOC
(
_±r
, 
ÿ¡
, 
_size
, 
_ty³
, 
_æags
) \

454 ((
_±r
èğ(
ÿ¡
)
	`›“80211_m®loc
(
_size
, 
_æags
))

	)

455 
	#FREE
(
addr
, 
ty³
è
	`kä“
(×ddr))

	)

460 
	#´štf
(...è
	`´štk
(
__VA_ARGS__
)

	)

461 
	g›“80211com
;

462 
if_´štf
(
Ãt_deviû
 *, const *, ...);

467 #ifdeà
IEEE80211_DEBUG_REFCNT


468 
	#›“80211_g‘mgtäame
(
_µäm
, 
_pk’
) \

469 
	`›“80211_g‘mgtäame_debug
(
_µäm
, 
_pk’
, 
__func__
, 
__LINE__
)

	)

470 
sk_buff
 * 
›“80211_g‘mgtäame_debug
(
u_št8_t
 **
äm
, 
u_št
 
pk’
,

471 cÚ¡ *
func
, 
lše
);

473 
sk_buff
 * 
›“80211_g‘mgtäame
(
u_št8_t
 **
äm
, 
u_št
 
pk’
);

476 
	#IF_ENQUEUE
(
_q
,
_skb
è
	`skb_queue_
(_q, _skb)

	)

477 
	#IF_DEQUEUE
(
_q
,
_skb
è(_skb = 
	`skb_dequeue
(_q))

	)

478 
	#_IF_QLEN
(
_q
è
	`skb_queue_Ën
(_q)

	)

479 
	#IF_DRAIN
(
_q
è
	`skb_queue_d¿š
(_q)

	)

480 
skb_queue_d¿š
(
sk_buff_h—d
 *
q
);

482 #iâdeà
__MOD_INC_USE_COUNT


483 
	#_MOD_INC_USE
(
_m
, 
_”r
) \

484 ià(!
	`Œy_moduË_g‘
(
_m
)) { \

485 
	`´štk
(
KERN_WARNING
 "%s:ry_module_get failed\n", \

486 
__func__
); \

487 
_”r
; \

488 }

	)

489 
	#_MOD_DEC_USE
(
_m
è
	`moduË_put
(_m)

	)

491 
	#_MOD_INC_USE
(
_m
, 
_”r
è
MOD_INC_USE_COUNT


	)

492 
	#_MOD_DEC_USE
(
_m
è
MOD_DEC_USE_COUNT


	)

495 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0)

496 
__šlše
 
u_št64_t


497 
	$g‘_jiff›s_64
()

499  (
u_št64_t
è
jiff›s
;

500 
	}
}

504 
	~<lšux/d–ay.h
>

505 #ià(
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,0) && \

506 
	gLINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,7)) || \

507 
	gLINUX_VERSION_CODE
 < 
	$KERNEL_VERSION
(2,4,29)

512 #iâdeà
MSEC_PER_SEC


513 
	#MSEC_PER_SEC
 (1000L)

	)

516 #iâdeà
MAX_JIFFY_OFFSET


517 
	#MAX_JIFFY_OFFSET
 ((~0UL >> 1)-1)

	)

520 
__šlše
 
	$jiff›s_to_m£cs
(cÚ¡ 
j
)

522 #ià
HZ
 <ğ
MSEC_PER_SEC
 && !(MSEC_PER_SEC % HZ)

523  (
MSEC_PER_SEC
 / 
HZ
è* 
j
;

524 #–ià
HZ
 > 
MSEC_PER_SEC
 && !(HZ % MSEC_PER_SEC)

525  (
j
 + (
HZ
 / 
MSEC_PER_SEC
) - 1)/(HZ / MSEC_PER_SEC);

527  (
j
 * 
MSEC_PER_SEC
è/ 
HZ
;

529 
	}
}

531 
__šlše
 
	$m£cs_to_jiff›s
(cÚ¡ 
m
)

533 ià(
m
 > 
	`jiff›s_to_m£cs
(
MAX_JIFFY_OFFSET
))

534  
MAX_JIFFY_OFFSET
;

535 #ià
HZ
 <ğ
MSEC_PER_SEC
 && !(MSEC_PER_SEC % HZ)

536  (
m
 + (
MSEC_PER_SEC
 / 
HZ
) - 1) / (MSEC_PER_SEC / HZ);

537 #–ià
HZ
 > 
MSEC_PER_SEC
 && !(HZ % MSEC_PER_SEC)

538  
m
 * (
HZ
 / 
MSEC_PER_SEC
);

540  (
m
 * 
HZ
 + 
MSEC_PER_SEC
 - 1) / MSEC_PER_SEC;

542 
	}
}

546 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,7)

547 
	~<lšux/jiff›s.h
>

550 #iâdeà
CLONE_KERNEL


555 
	#CLONE_KERNEL
 (
CLONE_FS
 | 
CLONE_FILES
 | 
CLONE_SIGHAND
)

	)

558 
	~<lšux/mm.h
>

559 #iâdeà
off£t_š_·ge


560 
	#off£t_š_·ge
(
p
è((èÕè& ~
PAGE_MASK
)

	)

563 #iâdeà
moduË_put_ªd_ex™


564 
	#moduË_put_ªd_ex™
(
code
) do { \

565 
	`_MOD_DEC_USE
(
THIS_MODULE
); \

566 
	`do_ex™
(
code
); \

567 } 0)

	)

575 #undeà
_LITTLE_ENDIAN


576 
	#_LITTLE_ENDIAN
 1234

	)

577 #undeà
_BIG_ENDIAN


578 
	#_BIG_ENDIAN
 4321

	)

579 
	~<asm/by‹Üd”.h
>

580 #ià
defšed
(
__LITTLE_ENDIAN
)

581 
	#_BYTE_ORDER
 
_LITTLE_ENDIAN


	)

582 #–ià
defšed
(
__BIG_ENDIAN
)

583 
	#_BYTE_ORDER
 
_BIG_ENDIAN


	)

592 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,8)

593 
	#IEEE80211_SYSCTL_DECL
(
f
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
, 
µos
) \

594 
	`f
(
ùl_bË
 *
ùl
, 
wr™e
, 
fe
 *
fp
, \

595 
__u£r
 *
bufãr
, 
size_t
 *
ËÅ
)

	)

596 
	#IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
, 
µos
) \

597 
	`´oc_doštvec
(
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
)

	)

599 
	#IEEE80211_SYSCTL_DECL
(
f
, 
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
, 
µos
) \

600 
	`f
(
ùl_bË
 *
ùl
, 
wr™e
, 
fe
 *
fp
, \

601 
__u£r
 *
bufãr
, 
size_t
 *
ËÅ
, 
loff_t
 *
µos
)

	)

602 
	#IEEE80211_SYSCTL_PROC_DOINTVEC
(
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
, 
µos
) \

603 
	`´oc_doštvec
(
ùl
, 
wr™e
, 
fp
, 
bufãr
, 
ËÅ
, 
µos
)

	)

606 
›“80211_vœtfs_Ï‹v©ch
(
›“80211v­
 *);

607 
›“80211_vœtfs_vd‘ach
(
›“80211v­
 *);

608 
›“80211_´oc_vü—‹
(
›“80211v­
 *, 
fe_İ”©iÚs
 *,

610 
›“80211_´oc_ş—nup
(
›“80211v­
 *);

612 #ià
defšed
(
CONFIG_VLAN_8021Q
è|| defšed(
CONFIG_VLAN_8021Q_MODULE
)

613 
	#IEEE80211_VLAN_TAG_USED
 1

	)

615 #iâdeà
VLAN_GROUP_ARRAY_PART_LEN


616 
	#vÏn_group_£t_deviû
(
group
, 
vid
, 
dev
) do { \

617 
group
->
vÏn_deviûs
[
vid
] = 
dev
; \

618 } 0);

	)

622 
	#IEEE80211_VLAN_TAG_USED
 0

	)

624 
›“80211_vÏn_v©ch
(
›“80211v­
 *);

625 
›“80211_vÏn_vd‘ach
(
›“80211v­
 *);

627 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0)

628 
	#ä“_Ãtdev
(
dev
è
	`kä“
(dev)

	)

631 
›“80211_ioùl_v©ch
(
›“80211v­
 *);

632 
›“80211_ioùl_vd‘ach
(
›“80211v­
 *);

633 
	giäeq
;

634 
›“80211_ioùl_ü—‹_v­
(
›“80211com
 *, 
iäeq
 *,

635 
Ãt_deviû
 *);

636 
›“80211v­
 *
›“80211_ü—‹_v­
(
›“80211com
 *, *,

637 
Ãt_deviû
 *, , );

	@ieee80211_monitor.c

30 #iâdeà
EXPORT_SYMTAB


31 
	#EXPORT_SYMTAB


	)

37 #iâdeà
AUTOCONF_INCLUDED


38 
	~<lšux/cÚfig.h
>

40 
	~<lšux/v”siÚ.h
>

41 
	~<lšux/moduË.h
>

42 
	~<lšux/kmod.h
>

43 
	~<lšux/š™.h
>

44 
	~<lšux/skbuff.h
>

45 
	~<lšux/sysùl.h
>

46 
	~<lšux/Ãtdeviû.h
>

47 
	~<lšux/‘h”deviû.h
>

48 
	~<lšux/if_vÏn.h
>

50 
	~<Ãt/iw_hªdËr.h
>

51 
	~<lšux/wœ–ess.h
>

52 
	~<lšux/if_¬p.h
>

54 
	~<asm/uacûss.h
>

56 
	~"if_medŸ.h
"

57 
	~"if_‘h”subr.h
"

59 
	~<Ãt80211/›“80211_v¬.h
>

60 
	~<Ãt80211/›“80211_mÚ™Ü.h
>

61 
	~<©h/if_©hv¬.h
>

65 
	$¿‹code_to_dÙ11
(
¿‹code
)

67 
¿‹code
) {

87 
	}
}

89 
	s¬5212_İ’bsd_desc
 {

93 
u_št32_t
 
	mäame_Ën
:12;

94 
u_št32_t
 
	m»£rved_12_15
:4;

95 
u_št32_t
 
	mxm™_pow”
:6;

96 
u_št32_t
 
	m¹s_ùs_’abË
:1;

97 
u_št32_t
 
	mveŞ
:1;

98 
u_št32_t
 
	mş—r_de¡_mask
:1;

99 
u_št32_t
 
	mªt_mode_xm™
:4;

100 
u_št32_t
 
	mš‹r_»q
:1;

101 
u_št32_t
 
	m’üy±_key_v®id
:1;

102 
u_št32_t
 
	mùs_’abË
:1;

104 
u_št32_t
 
	mr1
;

109 
u_št32_t
 
	m¹s_du¿tiÚ
:15;

110 
u_št32_t
 
	mdu¿tiÚ_upd©e_’abË
:1;

111 
u_št32_t
 
	mxm™_Œ›s0
:4;

112 
u_št32_t
 
	mxm™_Œ›s1
:4;

113 
u_št32_t
 
	mxm™_Œ›s2
:4;

114 
u_št32_t
 
	mxm™_Œ›s3
:4;

119 
u_št32_t
 
	mxm™_¿‹0
:5;

120 
u_št32_t
 
	mxm™_¿‹1
:5;

121 
u_št32_t
 
	mxm™_¿‹2
:5;

122 
u_št32_t
 
	mxm™_¿‹3
:5;

123 
u_št32_t
 
	m¹s_ùs_¿‹
:5;

124 
u_št32_t
 
	m»£rved_25_31
:7;

128 
	$›“80211_mÚ™Ü_’ÿp
(
›“80211v­
 *
v­
, 
sk_buff
 *
skb
)

130 
›“80211_phy_·¿ms
 *
ph
 = &(
	`SKB_CB
(
skb
)->
phy
);

131 
	`SKB_CB
(
skb
)->
æags
 = 
M_RAW
;

132 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
v­
->
iv_bss
);

135 
ph
->
¿‹
[0] = 
v­
->
iv_fixed_¿‹
 > 0 ? vap->iv_fixed_rate : 2;

137 
ph
->
Œy
[0] = 11;

138 
ph
->
pow”
 = 60;

140 
skb
->
dev
->
ty³
) {

141 
ARPHRD_IEEE80211
: {

142 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb
->
d©a
;

143 ià((
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_CTL
)

144 
ph
->
Œy
[0] = 1;

147 
ARPHRD_IEEE80211_PRISM
: {

148 
›“80211_äame
 *
wh
 = 
NULL
;

149 
wÏn_ng_´ism2_h—d”
 *
p2h
 =

150 (
wÏn_ng_´ism2_h—d”
 *)
skb
->
d©a
;

152 ià(
skb
->
Ën
 > (
wÏn_ng_´ism2_h—d”
) &&

153 
p2h
->
msgcode
 =ğ
DIDmsg_Êxšd_wÏn¢ifäm
 &&

154 
p2h
->
¿‹
.
did
 =ğ
DIDmsg_Êxšd_wÏn¢ifäm_¿‹
) {

155 
ph
->
¿‹
[0] = 
p2h
->¿‹.
d©a
;

156 
	`skb_puÎ
(
skb
, (
wÏn_ng_´ism2_h—d”
));

158 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

159 ià((
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_CTL
)

160 
ph
->
Œy
[0] = 1;

163 
ARPHRD_IEEE80211_RADIOTAP
: {

164 
›“80211_äame
 *
wh
 = 
NULL
;

165 
›“80211_¿diÙ­_h—d”
 *
rh
 =

166 (
›“80211_¿diÙ­_h—d”
 *)
skb
->
d©a
;

167 
u_št32_t
 
´e£Á
, 
´e£Á_ext
;

168 
u_št16_t
 
Ën
;

169 
u_št8_t
 *
¡¬t
 = 
skb
->
d©a
 + (
›“80211_¿diÙ­_h—d”
);

170 
u_št8_t
 *
p
 = 
¡¬t
;

171 
u_št8_t
 *
’d
 = 
skb
->
d©a
 + skb->
Ën
;

172 
u_št8_t
 
b™
, 
æags
 = 0;

174 ià(
skb
->
Ën
 < (*
rh
è||„h->
™_v”siÚ
 != 0)

177 
´e£Á_ext
 = 
´e£Á
 = 
	`Ë32_to_ıu
(
rh
->
™_´e£Á
);

178 
Ën
 = 
	`Ë16_to_ıu
(
rh
->
™_Ën
);

180 ià(
skb
->
Ën
 <†en)

184 
´e£Á_ext
 & (1 << 
IEEE80211_RADIOTAP_EXT
)) {

185 ià(
p
 + 4 > 
’d
) {

188 
´e£Á
 = 0;

191 
´e£Á_ext
 = 
	`Ë32_to_ıu
(*(
__Ë32
 *)
p
);

192 
p
 += 4;

195 
b™
 = 0; 
´e£Á
 && 
p
 < 
’d
;…resent >>= 1, bit++) {

196 ià((
´e£Á
 & 1) == 0)

198 
b™
) {

199 
IEEE80211_RADIOTAP_RATE
:

200 
ph
->
¿‹
[0] = *
p
;

201 
p
++;

204 
IEEE80211_RADIOTAP_DBM_TX_POWER
:

205 
ph
->
pow”
 = *
p
;

206 
p
++;

209 
IEEE80211_RADIOTAP_FLAGS
:

210 
æags
 = *
p
;

211 
p
++;

214 
IEEE80211_RADIOTAP_DB_ANTSIGNAL
:

215 
IEEE80211_RADIOTAP_DB_ANTNOISE
:

216 
IEEE80211_RADIOTAP_ANTENNA
:

217 
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
:

218 
IEEE80211_RADIOTAP_DBM_ANTNOISE
:

220 
p
++;

223 
IEEE80211_RADIOTAP_FHSS
:

225 
p
 += 2;

228 
IEEE80211_RADIOTAP_LOCK_QUALITY
:

229 
IEEE80211_RADIOTAP_TX_ATTENUATION
:

230 
IEEE80211_RADIOTAP_DB_TX_ATTENUATION
:

232 
p
 = 
¡¬t
 + 
	`roundup
(p - start, 2) + 2;

235 
IEEE80211_RADIOTAP_CHANNEL
:

237 
p
 = 
¡¬t
 + 
	`roundup
(p - start, 2) + 4;

240 
IEEE80211_RADIOTAP_TSFT
:

242 
p
 = 
¡¬t
 + 
	`roundup
(p - start, 8) + 8;

245 
IEEE80211_RADIOTAP_DATA_RETRIES
:

246 
ph
->
Œy
[0] = *
p
 + 1;

247 
p
++;

251 
´e£Á
 = 0;

255 
	`skb_puÎ
(
skb
, 
Ën
);

256 ià(
æags
 & 
IEEE80211_RADIOTAP_F_FCS
)

258 
	`skb_Œim
(
skb
, skb->
Ën
 - 
IEEE80211_CRC_LEN
);

259 
wh
 = (
›“80211_äame
 *)
skb
->
d©a
;

260 ià(!
ph
->
Œy
[0] &&

261 (
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_CTL
)

262 
ph
->
Œy
[0] = 1;

265 
ARPHRD_IEEE80211_ATHDESC
: {

266 ià(
skb
->
Ën
 > 
ATHDESC_HEADER_SIZE
) {

267 
¬5212_İ’bsd_desc
 *
desc
 =

268 (
¬5212_İ’bsd_desc
 *)(
skb
->
d©a
 + 8);

269 
ph
->
pow”
 = 
desc
->
xm™_pow”
;

270 
ph
->
¿‹
[0] = 
	`¿‹code_to_dÙ11
(
desc
->
xm™_¿‹0
);

271 
ph
->
¿‹
[1] = 
	`¿‹code_to_dÙ11
(
desc
->
xm™_¿‹1
);

272 
ph
->
¿‹
[2] = 
	`¿‹code_to_dÙ11
(
desc
->
xm™_¿‹2
);

273 
ph
->
¿‹
[3] = 
	`¿‹code_to_dÙ11
(
desc
->
xm™_¿‹3
);

274 
ph
->
Œy
[0] = 
desc
->
xm™_Œ›s0
;

275 
ph
->
Œy
[1] = 
desc
->
xm™_Œ›s1
;

276 
ph
->
Œy
[2] = 
desc
->
xm™_Œ›s2
;

277 
ph
->
Œy
[3] = 
desc
->
xm™_Œ›s3
;

278 
	`skb_puÎ
(
skb
, 
ATHDESC_HEADER_SIZE
);

286 ià(!
ph
->
¿‹
[0]) {

287 
ph
->
¿‹
[0] = 0;

288 
ph
->
Œy
[0] = 11;

290 
	}
}

291 
EXPORT_SYMBOL
(
›“80211_mÚ™Ü_’ÿp
);

297 
	$›“80211_šput_mÚ™Ü
(
›“80211com
 *
ic
, 
sk_buff
 *
skb
,

298 cÚ¡ 
©h_buf
 *
bf
, 
tx
, 
u_št64_t
 
maùime
, 
©h_soác
 *
sc
)

300 
›“80211v­
 *
v­
, *
Ãxt
;

301 
©h_desc
 *
ds
 = 
bf
->
bf_desc
;

302 
noi£
 = 0, 
ª‹Âa
 = 0, 
›“¿‹
 = 0;

303 
u_št32_t
 
rssi
 = 0;

304 
u_št8_t
 
pk‰y³
 = 0;

306 ià(
tx
) {

307 
rssi
 = 
bf
->
bf_ds¡©us
.
ds_tx¡©
.
ts_rssi
;

308 
ª‹Âa
 = 
bf
->
bf_ds¡©us
.
ds_tx¡©
.
ts_ª‹Âa
;

309 
›“¿‹
 = 
sc
->
sc_hwm­
[
bf
->
bf_ds¡©us
.
ds_tx¡©
.
ts_¿‹
].ieeerate;

311 
rssi
 = 
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_rssi
;

312 
ª‹Âa
 = 
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_ª‹Âa
;

313 
›“¿‹
 = 
sc
->
sc_hwm­
[
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¿‹
].ieeerate;

316 
noi£
 = 
bf
->
bf_chªnoi£
;

319 
v­
 = 
	`TAILQ_FIRST
(&
ic
->
ic_v­s
); v­ !ğ
NULL
; v­ = 
Ãxt
) {

320 
sk_buff
 *
skb1
;

321 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

322 
›“80211_äame
 *
wh
 = (›“80211_äam*)
skb
->
d©a
;

323 
u_št8_t
 
dœ
 = 
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
;

325 
Ãxt
 = 
	`TAILQ_NEXT
(
v­
, 
iv_Ãxt
);

327 ià(!
tx
 && 
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¡©us
 != 0) {

330 ià(
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¡©us
 & 
HAL_RXERR_PHY
) {

331 ià(
v­
->
iv_mÚ™Ü_phy_”rÜs
 == 0) ;

335 ià(
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¡©us
 & 
HAL_RXERR_CRC
) {

336 ià(
v­
->
iv_mÚ™Ü_üc_”rÜs
 == 0) ;

340 ià(
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¡©us
 &~

341 (
HAL_RXERR_DECRYPT
 | 
HAL_RXERR_MIC
 |

342 
HAL_RXERR_PHY
 | 
HAL_RXERR_CRC
))

346 
pk‰y³
 = 
PACKET_HOST
;

352 ià(
tx
)

353 
pk‰y³
 = 
PACKET_OUTGOING
;

354 ià(
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
)) {

355 ià(
	`IEEE80211_ADDR_EQ
(
wh
->
i_addr1
, 
dev
->
brßdÿ¡
))

356 
pk‰y³
 = 
PACKET_BROADCAST
;

358 
pk‰y³
 = 
PACKET_MULTICAST
;

360 
pk‰y³
 = 
PACKET_HOST
;

363 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_MONITOR
 ||

364 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
)

366 ià(
v­
->
iv_mÚ™Ü_nods_Úly
 &&

367 
dœ
 !ğ
IEEE80211_FC1_DIR_NODS
) {

372 ià(
	`skb_h—droom
(
skb
è< 
IEEE80211_MON_MAXHDROOM
)

373 
skb1
 = 
	`skb_cİy_ex·nd
(
skb
, 
IEEE80211_MON_MAXHDROOM
,

374 0, 
GFP_ATOMIC
);

376 
skb1
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

377 ià(
skb1
 =ğ
NULL
) {

381 
	`›“80211_skb_cİy_nod”ef
(
skb
, 
skb1
);

383 ià(
v­
->
iv_mÚ™Ü_txf_Ën
 && 
tx
) {

385 
	`skb_Œim
(
skb1
, 
v­
->
iv_mÚ™Ü_txf_Ën
);

386 
	`skb_»£t_ÃtwÜk_h—d”
(
skb1
);

388 
v­
->
iv_dev
->
ty³
) {

389 
ARPHRD_IEEE80211
:

391 
ARPHRD_IEEE80211_PRISM
: {

392 
wÏn_ng_´ism2_h—d”
 *
ph
;

393 ià(
	`skb_h—droom
(
skb1
è< (
wÏn_ng_´ism2_h—d”
)) {

394 
	`›“80211_dev_kä“_skb
(&
skb1
);

398 
ph
 = (
wÏn_ng_´ism2_h—d”
 *)

399 
	`skb_push
(
skb1
, (
wÏn_ng_´ism2_h—d”
));

400 
	`mem£t
(
ph
, 0, (
wÏn_ng_´ism2_h—d”
));

402 
ph
->
msgcode
 = 
DIDmsg_Êxšd_wÏn¢ifäm
;

403 
ph
->
msgËn
 = (
wÏn_ng_´ism2_h—d”
);

404 
	`¡ºıy
(
ph
->
devÇme
, 
dev
->
Çme
, (ph->devname));

406 
ph
->
ho¡time
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_ho¡time
;

407 
ph
->
ho¡time
.
¡©us
 = 0;

408 
ph
->
ho¡time
.
Ën
 = 4;

409 
ph
->
ho¡time
.
d©a
 = 
jiff›s
;

413 
ph
->
maùime
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_maùime
;

414 
ph
->
maùime
.
¡©us
 = 0;

415 
ph
->
maùime
.
Ën
 = 4;

416 
ph
->
maùime
.
d©a
 = mactime;

418 
ph
->
i¡x
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_i¡x
;

419 
ph
->
i¡x
.
¡©us
 = 0;

420 
ph
->
i¡x
.
Ën
 = 4;

421 
ph
->
i¡x
.
d©a
 = 
tx
 ? 
P80211ENUM_Œuth_Œue
 : 
P80211ENUM_Œuth_çl£
;

423 
ph
->
ämËn
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_ämËn
;

424 
ph
->
ämËn
.
¡©us
 = 0;

425 
ph
->
ämËn
.
Ën
 = 4;

426 
ph
->
ämËn
.
d©a
 = 
skb
->
Ën
;

428 
ph
->
chªÃl
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_chªÃl
;

429 
ph
->
chªÃl
.
¡©us
 = 0;

430 
ph
->
chªÃl
.
Ën
 = 4;

431 
ph
->
chªÃl
.
d©a
 =

432 
	`›“80211_mhz2›“
(
ic
->
ic_curchª
->
ic_äeq
,

433 
ic
->
ic_curchª
->
ic_æags
);

435 
ph
->
rssi
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_rssi
;

436 
ph
->
rssi
.
¡©us
 = 0;

437 
ph
->
rssi
.
Ën
 = 4;

438 
ph
->
rssi
.
d©a
 =„ssi;

440 
ph
->
noi£
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_noi£
;

441 
ph
->
noi£
.
¡©us
 = 0;

442 
ph
->
noi£
.
Ën
 = 4;

443 
ph
->
noi£
.
d©a
 =‚oise;

445 
ph
->
sigÇl
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_sigÇl
;

446 
ph
->
sigÇl
.
¡©us
 = 0;

447 
ph
->
sigÇl
.
Ën
 = 4;

448 
ph
->
sigÇl
.
d©a
 = 
rssi
 + 
noi£
;

450 
ph
->
¿‹
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_¿‹
;

451 
ph
->
¿‹
.
¡©us
 = 0;

452 
ph
->
¿‹
.
Ën
 = 4;

453 
ph
->
¿‹
.
d©a
 = 
›“¿‹
;

456 
ARPHRD_IEEE80211_RADIOTAP
: {

457 ià(
tx
) {

458 
©h_tx_¿diÙ­_h—d”
 *
th
;

459 ià(
	`skb_h—droom
(
skb1
è< (
©h_tx_¿diÙ­_h—d”
)) {

460 
	`´štk
("%s:%d %s\n", 
__FILE__
, 
__LINE__
, 
__func__
);

461 
	`›“80211_dev_kä“_skb
(&
skb1
);

465 
th
 = (
©h_tx_¿diÙ­_h—d”
 *)
	`skb_push
(
skb1
,

466 (
©h_tx_¿diÙ­_h—d”
));

467 
	`mem£t
(
th
, 0, (
©h_tx_¿diÙ­_h—d”
));

468 
th
->
wt_ihdr
.
™_v”siÚ
 = 0;

469 
th
->
wt_ihdr
.
™_Ën
 = 
	`ıu_to_Ë16
((
©h_tx_¿diÙ­_h—d”
));

470 
th
->
wt_ihdr
.
™_´e£Á
 = 
	`ıu_to_Ë32
(
ATH_TX_RADIOTAP_PRESENT
);

474 
th
->
wt_tsá
 = 
	`ıu_to_Ë64
(
maùime
);

476 
th
->
wt_æags
 = 0;

477 
th
->
wt_¿‹
 = 
›“¿‹
;

478 
th
->
wt_ª‹Âa
 = 
ª‹Âa
;

479 
th
->
wt_·d
 = 0;

481 ià(
bf
->
bf_ds¡©us
.
ds_tx¡©
.
ts_¡©us
 & 
HAL_TXERR_XRETRY
)

482 
th
->
wt_txæags
 |ğ
	`ıu_to_Ë16
(
IEEE80211_RADIOTAP_F_TX_FAIL
);

484 
th
->
wt_d©¬‘r›s
 = 
bf
->
bf_ds¡©us
.
ds_tx¡©
.
ts_shÜŒ‘ry
 + bf->bf_ds¡©us.ds_tx¡©.
ts_lÚg»Œy
;

487 
©h_rx_¿diÙ­_h—d”
 *
th
;

488 ià(
	`skb_h—droom
(
skb1
è< (
©h_rx_¿diÙ­_h—d”
)) {

489 
	`´štk
("%s:%d %s\n", 
__FILE__
, 
__LINE__
, 
__func__
);

490 
	`›“80211_dev_kä“_skb
(&
skb1
);

494 
th
 = (
©h_rx_¿diÙ­_h—d”
 *)
	`skb_push
(
skb1
,

495 (
©h_rx_¿diÙ­_h—d”
));

496 
	`mem£t
(
th
, 0, (
©h_rx_¿diÙ­_h—d”
));

497 
th
->
wr_ihdr
.
™_v”siÚ
 = 0;

498 
th
->
wr_ihdr
.
™_Ën
 = 
	`ıu_to_Ë16
((
©h_rx_¿diÙ­_h—d”
));

499 
th
->
wr_ihdr
.
™_´e£Á
 = 
	`ıu_to_Ë32
(
ATH_RX_RADIOTAP_PRESENT
);

501 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
)

502 
th
->
wr_æags
 |ğ
IEEE80211_RADIOTAP_F_SHORTPRE
;

503 ià(
bf
->
bf_ds¡©us
.
ds_rx¡©
.
rs_¡©us
 & 
HAL_RXERR_CRC
)

504 
th
->
wr_æags
 |ğ
IEEE80211_RADIOTAP_F_BADFCS
;

505 ià(
skb
->
Ën
 >ğ
IEEE80211_CRC_LEN
)

506 
th
->
wr_æags
 |ğ
IEEE80211_RADIOTAP_F_FCS
;

508 
th
->
wr_¿‹
 = 
›“¿‹
;

509 
th
->
wr_chª_äeq
 = 
	`ıu_to_Ë16
(
ic
->
ic_curchª
->
ic_äeq
);

512 
sc
->
sc_curmode
) {

513 
IEEE80211_MODE_11A
:

514 
th
->
wr_chª_æags
 =

515 
	`ıu_to_Ë16
(
IEEE80211_CHAN_A
);

517 
IEEE80211_MODE_TURBO_A
:

518 
th
->
wr_chª_æags
 =

519 
	`ıu_to_Ë16
(
IEEE80211_CHAN_TA
);

521 
IEEE80211_MODE_11B
:

522 
th
->
wr_chª_æags
 =

523 
	`ıu_to_Ë16
(
IEEE80211_CHAN_B
);

525 
IEEE80211_MODE_11G
:

526 
th
->
wr_chª_æags
 =

527 
	`ıu_to_Ë16
(
IEEE80211_CHAN_G
);

529 
IEEE80211_MODE_TURBO_G
:

530 
th
->
wr_chª_æags
 =

531 
	`ıu_to_Ë16
(
IEEE80211_CHAN_TG
);

534 
th
->
wr_chª_æags
 = 0;

538 
th
->
wr_dbm_ªŠoi£
 = (
št8_t
è
noi£
;

539 
th
->
wr_dbm_ªtsigÇl
 =

540 
th
->
wr_dbm_ªŠoi£
 + 
rssi
;

541 
th
->
wr_ª‹Âa
 = 
ª‹Âa
;

542 
th
->
wr_ªtsigÇl
 = 
rssi
;

544 
th
->
wr_tsá
 = 
	`ıu_to_Ë64
(
maùime
);

548 
ARPHRD_IEEE80211_ATHDESC
: {

549 ià(
	`skb_h—droom
(
skb1
è< 
ATHDESC_HEADER_SIZE
) {

550 
	`´štk
("%s:%d %s\n", 
__FILE__
,

551 
__LINE__
, 
__func__
);

552 
	`›“80211_dev_kä“_skb
(&
skb1
);

555 
	`memıy
(
	`skb_push
(
skb1
, 
ATHDESC_HEADER_SIZE
),

556 
ds
, 
ATHDESC_HEADER_SIZE
);

562 ià(
skb1
 !ğ
NULL
) {

563 ià(!
tx
 && (
skb1
->
Ën
 >ğ
IEEE80211_CRC_LEN
) &&

564 (
v­
->
iv_dev
->
ty³
 !=

565 
ARPHRD_IEEE80211_RADIOTAP
)) {

568 
	`skb_Œim
(
skb1
, skb1->
Ën
 - 
IEEE80211_CRC_LEN
);

570 
skb1
->
dev
 = dev;

571 
	`skb_»£t_mac_h—d”
(
skb1
);

573 
skb1
->
_summed
 = 
CHECKSUM_NONE
;

574 
skb1
->
pkt_ty³
 = 
pk‰y³
;

575 
skb1
->
´ÙocŞ
 =

576 
	`__cÚ¡ªt_htÚs
(0x0019);

578 
v­
->
iv_dev¡©s
.
rx_·ck‘s
++;

579 
v­
->
iv_dev¡©s
.
rx_by‹s
 +ğ
skb1
->
Ën
;

581 ià(
	`SKB_NI
(
skb1
è!ğ
NULL
)

582 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb1
));

583 ià(
	`Ãtif_rx
(
skb1
è=ğ
NET_RX_DROP
)

584 
v­
->
iv_dev¡©s
.
rx_drİ³d
++;

585 
skb1
 = 
NULL
;

588 
	}
}

589 
EXPORT_SYMBOL
(
›“80211_šput_mÚ™Ü
);

	@ieee80211_monitor.h

29 #iâdeà
_NET80211_IEEE80211_MONITOR_H_


30 
	#_NET80211_IEEE80211_MONITOR_H_


	)

32 
	~<Ãt80211/›“80211_¿diÙ­.h
>

33 
	~<ah_desc.h
>

34 
	~<©h/if_©hv¬.h
>

36 #iâdeà
ARPHRD_IEEE80211_RADIOTAP


37 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

40 #iâdeà
ARPHRD_IEEE80211_ATHDESC


41 
	#ARPHRD_IEEE80211_ATHDESC
 804

	)

44 
	#ATHDESC_HEADER_SIZE
 32

	)

46 
	#IEEE80211_MON_MAXHDROOM
 (() \

47 
	`A_MAX
((
©h_tx_¿diÙ­_h—d”
), \

48 
	`A_MAX
((
wÏn_ng_´ism2_h—d”
), \

49 
ATHDESC_HEADER_SIZE
)))

	)

51 
	mDIDmsg_Êxšd_wÏn¢ifäm
 = 0x00000044,

52 
	mDIDmsg_Êxšd_wÏn¢ifäm_ho¡time
 = 0x00010044,

53 
	mDIDmsg_Êxšd_wÏn¢ifäm_maùime
 = 0x00020044,

54 
	mDIDmsg_Êxšd_wÏn¢ifäm_chªÃl
 = 0x00030044,

55 
	mDIDmsg_Êxšd_wÏn¢ifäm_rssi
 = 0x00040044,

56 
	mDIDmsg_Êxšd_wÏn¢ifäm_sq
 = 0x00050044,

57 
	mDIDmsg_Êxšd_wÏn¢ifäm_sigÇl
 = 0x00060044,

58 
	mDIDmsg_Êxšd_wÏn¢ifäm_noi£
 = 0x00070044,

59 
	mDIDmsg_Êxšd_wÏn¢ifäm_¿‹
 = 0x00080044,

60 
	mDIDmsg_Êxšd_wÏn¢ifäm_i¡x
 = 0x00090044,

61 
	mDIDmsg_Êxšd_wÏn¢ifäm_ämËn
 = 0x000A0044

64 
	mP80211ENUM_msg™em_¡©us_no_v®ue
 = 0x00

67 
	mP80211ENUM_Œuth_çl£
 = 0x00,

68 
	mP80211ENUM_Œuth_Œue
 = 0x01

71 
	sp80211™em_ušt32
 {

72 
u_št32_t
 
	mdid
;

73 
u_št16_t
 
	m¡©us
;

74 
u_št16_t
 
	mËn
;

75 
u_št32_t
 
	md©a
;

78 
	swÏn_ng_´ism2_h—d”
 {

79 
u_št32_t
 
	mmsgcode
;

80 
u_št32_t
 
	mmsgËn
;

81 
	#WLAN_DEVNAMELEN_MAX
 16

	)

82 
u_št8_t
 
	mdevÇme
[
WLAN_DEVNAMELEN_MAX
];

83 
p80211™em_ušt32
 
	mho¡time
;

84 
p80211™em_ušt32
 
	mmaùime
;

85 
p80211™em_ušt32
 
	mchªÃl
;

86 
p80211™em_ušt32
 
	mrssi
;

87 
p80211™em_ušt32
 
	msq
;

88 
p80211™em_ušt32
 
	msigÇl
;

89 
p80211™em_ušt32
 
	mnoi£
;

90 
p80211™em_ušt32
 
	m¿‹
;

91 
p80211™em_ušt32
 
	mi¡x
;

92 
p80211™em_ušt32
 
	mämËn
;

95 
	#ATH_RX_RADIOTAP_PRESENT
 ( \

96 (1 << 
IEEE80211_RADIOTAP_TSFT
) | \

97 (1 << 
IEEE80211_RADIOTAP_FLAGS
) | \

98 (1 << 
IEEE80211_RADIOTAP_RATE
) | \

99 (1 << 
IEEE80211_RADIOTAP_CHANNEL
) | \

100 (1 << 
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
) | \

101 (1 << 
IEEE80211_RADIOTAP_DBM_ANTNOISE
) | \

102 (1 << 
IEEE80211_RADIOTAP_ANTENNA
) | \

103 (1 << 
IEEE80211_RADIOTAP_DB_ANTSIGNAL
) | \

104 0)

	)

106 
	s©h_rx_¿diÙ­_h—d”
 {

107 
›“80211_¿diÙ­_h—d”
 
	mwr_ihdr
;

108 
__Ë64
 
	mwr_tsá
;

109 
u_št8_t
 
	mwr_æags
;

110 
u_št8_t
 
	mwr_¿‹
;

111 
__Ë16
 
	mwr_chª_äeq
;

112 
__Ë16
 
	mwr_chª_æags
;

113 
št8_t
 
	mwr_dbm_ªtsigÇl
;

114 
št8_t
 
	mwr_dbm_ªŠoi£
;

115 
u_št8_t
 
	mwr_ª‹Âa
;

116 
u_št8_t
 
	mwr_ªtsigÇl
;

117 }
__©Œibu‹__
((
__·cked__
));

119 
	#ATH_TX_RADIOTAP_PRESENT
 ( \

120 (1 << 
IEEE80211_RADIOTAP_TSFT
) | \

121 (1 << 
IEEE80211_RADIOTAP_FLAGS
) | \

122 (1 << 
IEEE80211_RADIOTAP_RATE
) | \

123 (1 << 
IEEE80211_RADIOTAP_ANTENNA
) | \

124 (1 << 
IEEE80211_RADIOTAP_TX_FLAGS
) | \

125 (1 << 
IEEE80211_RADIOTAP_DATA_RETRIES
) | \

126 0)

	)

128 
	s©h_tx_¿diÙ­_h—d”
 {

129 
›“80211_¿diÙ­_h—d”
 
	mwt_ihdr
;

130 
__Ë64
 
	mwt_tsá
;

131 
u_št8_t
 
	mwt_æags
;

132 
u_št8_t
 
	mwt_¿‹
;

133 
u_št8_t
 
	mwt_ª‹Âa
;

134 
u_št8_t
 
	mwt_·d
;

135 
__Ë16
 
	mwt_txæags
;

136 
u_št8_t
 
	mwt_d©¬‘r›s
;

137 }
__©Œibu‹__
((
__·cked__
));

143 
›“80211_šput_mÚ™Ü
(
›“80211com
 *, 
sk_buff
 *,

144 cÚ¡ 
©h_buf
 *, , 
u_št64_t
, 
©h_soác
 *);

147 
›“80211_mÚ™Ü_’ÿp
(
›“80211v­
 *, 
sk_buff
 *);

	@ieee80211_node.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/‘h”deviû.h
>

49 
	~<lšux/¿ndom.h
>

51 
	~"if_medŸ.h
"

53 
	~<Ãt80211/›“80211_v¬.h
>

54 
	~<Ãt80211/if_©h´Ùo.h
>

59 
	#IEEE80211_AID_SET
(
_v­
, 
_b
) \

60 ((
_v­
)->
iv_aid_b™m­
[
	`IEEE80211_AID
(
_b
) / 32] |= \

61 (1 << (
	`IEEE80211_AID
(
_b
è% 32)))

	)

62 
	#IEEE80211_AID_CLR
(
_v­
, 
_b
) \

63 ((
_v­
)->
iv_aid_b™m­
[
	`IEEE80211_AID
(
_b
) / 32] &= \

64 ~(1 << (
	`IEEE80211_AID
(
_b
è% 32)))

	)

65 
	#IEEE80211_AID_ISSET
(
_v­
, 
_b
) \

66 ((
_v­
)->
iv_aid_b™m­
[
	`IEEE80211_AID
(
_b
) / 32] & \

67 (1 << (
	`IEEE80211_AID
(
_b
è% 32)))

	)

69 
›“80211_node
 *
›“80211_®loc_node
(
›“80211v­
 *,

70 cÚ¡ 
u_št8_t
 *);

72 
›“80211_¡a_još1
(
›“80211_node
 *);

74 
›“80211_node
 *
node_®loc
(
›“80211v­
 *);

75 
node_ş—nup
(
›“80211_node
 *);

76 
node_ä“
(
›“80211_node
 *);

78 
št32_t
 
node_couÁ
(
›“80211com
 *
ic
);

79 
u_št8_t
 
node_g‘rssi
(cÚ¡ 
›“80211_node
 *);

81 
node_bË_Ëave_locked
(
›“80211_node_bË
 *,

82 
›“80211_node
 *);

83 
node_bË_još_locked
(
›“80211_node_bË
 *,

84 
›“80211_node
 *);

86 
›“80211_node_timeout
();

88 
›“80211_node_bË_š™
(
›“80211com
 *,

89 
›“80211_node_bË
 *, const *, );

90 
›“80211_node_bË_ş—nup
(
›“80211_node_bË
 *);

91 
›“80211_node_bË_»£t
(
›“80211_node_bË
 *,

92 
›“80211v­
 *);

93 
›“80211_node_wds_ageout
();

95 
MALLOC_DEFINE
(
M_80211_NODE
, "80211node", "802.11‚ode state");

98 
	$›“80211_node_©ch
(
›“80211com
 *
ic
)

100 
	`›“80211_node_bË_š™
(
ic
, &ic->
ic_¡a
, "station",

101 
IEEE80211_INACT_INIT
);

102 
	`š™_tim”
(&
ic
->
ic_šaù
);

103 
ic
->
ic_šaù
.
funùiÚ
 = 
›“80211_node_timeout
;

104 
ic
->
ic_šaù
.
d©a
 = () ic;

105 
	`mod_tim”
(&
ic
->
ic_šaù
, 
jiff›s
 + 
IEEE80211_INACT_WAIT
 * 
HZ
);

107 
ic
->
ic_node_®loc
 = 
node_®loc
;

108 
ic
->
ic_node_ä“
 = 
node_ä“
;

109 
ic
->
ic_node_ş—nup
 = 
node_ş—nup
;

111 
ic
->
ic_node_couÁ
 = 
node_couÁ
;

112 
ic
->
ic_node_g‘rssi
 = 
node_g‘rssi
;

113 
	}
}

116 
	$›“80211_node_d‘ach
(
›“80211com
 *
ic
)

118 
	`d–_tim”
(&
ic
->
ic_šaù
);

119 
	`›“80211_node_bË_ş—nup
(&
ic
->
ic_¡a
);

120 
	}
}

123 
	$›“80211_node_v©ch
(
›“80211v­
 *
v­
)

126 
v­
->
iv_šaù_š™
 = 
IEEE80211_INACT_INIT
;

127 
v­
->
iv_šaù_auth
 = 
IEEE80211_INACT_AUTH
;

128 
v­
->
iv_šaù_run
 = 
IEEE80211_INACT_RUN
;

129 
v­
->
iv_šaù_´obe
 = 
IEEE80211_INACT_PROBE
;

130 
	}
}

133 
	$›“80211_node_Ï‹v©ch
(
›“80211v­
 *
v­
)

135 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

136 
›“80211_r¢·rms
 *
r¢
;

142 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

143 ià(
v­
->
iv_max_aid
 == 0)

144 
v­
->
iv_max_aid
 = 
IEEE80211_AID_DEF
;

145 ià(
v­
->
iv_max_aid
 > 
IEEE80211_AID_MAX
)

146 
v­
->
iv_max_aid
 = 
IEEE80211_AID_MAX
;

147 
	`MALLOC
(
v­
->
iv_aid_b™m­
, 
u_št32_t
 *,

148 
	`howmªy
(
v­
->
iv_max_aid
, 32è* (
u_št32_t
),

149 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

150 ià(
v­
->
iv_aid_b™m­
 =ğ
NULL
) {

152 
	`´štk
(
KERN_ERR
 "%s:‚ØmemÜy fÜ AID b™m­!\n", 
__func__
);

153 
v­
->
iv_max_aid
 = 0;

157 
	`›“80211_»£t_bss
(
v­
);

162 
r¢
 = &
v­
->
iv_bss
->
ni_r¢
;

164 
r¢
->
r¢_uÿ¡ch”£t
 |ğ1 << 
IEEE80211_CIPHER_WEP
;

165 
r¢
->
r¢_uÿ¡ch”£t
 |ğ1 << 
IEEE80211_CIPHER_TKIP
;

166 
r¢
->
r¢_uÿ¡ch”£t
 |ğ1 << 
IEEE80211_CIPHER_AES_CCM
;

167 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_AES
)

168 
r¢
->
r¢_uÿ¡ch”£t
 |ğ1 << 
IEEE80211_CIPHER_AES_OCB
;

169 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_CKIP
)

170 
r¢
->
r¢_uÿ¡ch”£t
 |ğ1 << 
IEEE80211_CIPHER_CKIP
;

176 
r¢
->
r¢_uÿ¡ch”
 = 
IEEE80211_CIPHER_WEP
;

177 
r¢
->
r¢_uÿ¡keyËn
 = 104 / 
NBBY
;

183 
r¢
->
r¢_mÿ¡ch”
 = 
IEEE80211_CIPHER_TKIP
;

184 
r¢
->
r¢_mÿ¡keyËn
 = 128 / 
NBBY
;

191 
r¢
->
r¢_keymgmt£t
 = 
WPA_ASE_8021X_UNSPEC
 | 
WPA_ASE_8021X_PSK
;

192 
r¢
->
r¢_keymgmt
 = 
WPA_ASE_8021X_PSK
;

194 
v­
->
iv_auth
 = 
	`›“80211_auth’tiÿtÜ_g‘
(v­->
iv_bss
->
ni_authmode
);

195 
	}
}

198 
	$›“80211_node_vd‘ach
(
›“80211v­
 *
v­
)

200 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

202 
	`›“80211_node_bË_»£t
(&
ic
->
ic_¡a
, 
v­
);

203 ià(
v­
->
iv_bss
 !ğ
NULL
) {

204 
	`›“80211_uÄef_node
(&
v­
->
iv_bss
);

206 ià(
v­
->
iv_aid_b™m­
 !ğ
NULL
) {

207 
	`FREE
(
v­
->
iv_aid_b™m­
, 
M_DEVBUF
);

208 
v­
->
iv_aid_b™m­
 = 
NULL
;

210 
	}
}

215 
	$›“80211_node_authÜize
(
›“80211_node
 *
ni
)

217 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_AUTH
;

218 
ni
->
ni_šaù_»lßd
 =‚i->
ni_v­
->
iv_šaù_run
;

219 
	}
}

220 
EXPORT_SYMBOL
(
›“80211_node_authÜize
);

223 
	$›“80211_node_uÇuthÜize
(
›“80211_node
 *
ni
)

225 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_AUTH
;

226 
	}
}

227 
EXPORT_SYMBOL
(
›“80211_node_uÇuthÜize
);

233 
__šlše
 

234 
	$›“80211_node_£t_chª
(
›“80211com
 *
ic
, 
›“80211_node
 *
ni
)

236 
›“80211_chªÃl
 *
chª
 = 
ic
->
ic_bsschª
;

238 
	`KASSERT
(
chª
 !ğ
IEEE80211_CHAN_ANYC
, ("bss channel‚ot setup"));

239 
ni
->
ni_chª
 = 
chª
;

240 #ifdeà
ATH_SUPERG_XR


241 ià(
ni
->
ni_v­
->
iv_æags
 & 
IEEE80211_F_XR
)

242 
ni
->
ni_¿‹s
 = 
ic
->
ic_sup_xr_¿‹s
;

245 
ni
->
ni_¿‹s
 = 
ic
->
ic_sup_¿‹s
[
	`›“80211_chª2mode
(
chª
)];

246 
	}
}

248 
__šlše
 

249 
	$cİy_bss_¡©e
(
›“80211_node
 *
nbss
, cÚ¡ ›“80211_nod*
obss
)

252 
nbss
->
ni_authmode
 = 
obss
->ni_authmode;

253 
nbss
->
ni_©h_æags
 = 
obss
->ni_ath_flags;

254 
nbss
->
ni_txpow”
 = 
obss
->ni_txpower;

255 
nbss
->
ni_vÏn
 = 
obss
->ni_vlan;

256 
nbss
->
ni_r¢
 = 
obss
->ni_rsn;

257 
nbss
->
ni_¿‹s
 = 
obss
->ni_rates;

259 
	}
}

262 
	$›“80211_ü—‹_ibss
(
›“80211v­
 *
v­
, 
›“80211_chªÃl
 *
chª
)

264 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

265 
›“80211_node
 *
ni
;

267 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

268 "%s: c»©šg ibs Ú chªÃÈ%u\n", 
__func__
,

269 
	`›“80211_chª2›“
(
ic
, 
chª
));

274 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
v­
->
iv_myaddr
);

275 ià(
ni
 =ğ
NULL
) {

276 
ni
 = 
	`›“80211_®loc_node_bË
(
v­
, v­->
iv_myaddr
);

277 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

278 "%s:‚i:%°®loÿ‹d fÜ " 
MAC_FMT
 "\n",

279 
__func__
, 
ni
, 
	`MAC_ADDR
(
v­
->
iv_myaddr
));

280 ià(
ni
 =ğ
NULL
) {

286 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
v­
->
iv_myaddr
);

287 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_bssid
, v­->
iv_myaddr
);

288 
ni
->
ni_es¦’
 = 
v­
->
iv_des_ssid
[0].
Ën
;

289 
	`memıy
(
ni
->
ni_essid
, 
v­
->
iv_des_ssid
[0].
ssid
,‚i->
ni_es¦’
);

290 ià(
v­
->
iv_bss
 !ğ
NULL
)

291 
	`cİy_bss_¡©e
(
ni
, 
v­
->
iv_bss
);

292 
ni
->
ni_štv®
 = 
ic
->
ic_lštv®
;

293 #ifdeà
ATH_SUPERG_XR


294 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XR
) {

295 
ni
->
ni_štv®
 *ğ
IEEE80211_XR_BEACON_FACTOR
;

298 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

299 
ni
->
ni_ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

300 ià(
ic
->
ic_phyty³
 =ğ
IEEE80211_T_FH
) {

301 
ni
->
ni_fhdw–l
 = 200;

302 
ni
->
ni_fhšdex
 = 1;

304 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

305 
v­
->
iv_æags
 |ğ
IEEE80211_F_SIBSS
;

306 
ni
->
ni_ÿpšfo
 |ğ
IEEE80211_CAPINFO_IBSS
;

307 ià(
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
) {

308 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
v­
->
iv_des_bssid
);

309 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_bssid
, v­->
iv_des_bssid
);

311 
ni
->
ni_bssid
[0] |= 0x02;

312 
v­
->
iv_bssid
[0] |= 0x02;

314 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
) {

315 ià(
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
) {

316 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
v­
->
iv_des_bssid
);

317 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_bssid
, v­->
iv_des_bssid
);

319 
	`IEEE80211_ADDR_SET_NULL
(
ni
->
ni_bssid
);

320 
	`IEEE80211_ADDR_SET_NULL
(
v­
->
iv_bssid
);

323 #ifdeà
ATH_SUPERG_DYNTURBO


324 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

325 
ni
->
ni_©h_æags
 = 
v­
->
iv_©h_ÿp
;

331 ià(
	`IEEE80211_IS_CHAN_STURBO
(
chª
) ||

332 !
	`›“80211_fšd_chªÃl
(
ic
, 
chª
->
ic_äeq
, chª->
ic_æags
 | 
IEEE80211_CHAN_TURBO
))

333 
ni
->
ni_©h_æags
 &ğ~(
IEEE80211_ATHC_TURBOP
 | 
IEEE80211_ATHC_AR
);

334 ià(
	`IEEE80211_IS_CHAN_5GHZ
(
chª
))

335 
ni
->
ni_©h_æags
 &ğ~
IEEE80211_ATHC_AR
;

341 
ic
->
ic_bsschª
 = 
chª
;

342 
	`›“80211_node_£t_chª
(
ic
, 
ni
);

343 
ic
->
ic_curmode
 = 
	`›“80211_chª2mode
(
chª
);

346 
	`›“80211_bud_couÁry›
(
ic
);

348 ià(
	`IEEE80211_IS_CHAN_HALF
(
chª
))

349 
ni
->
ni_¿‹s
 = 
ic
->
ic_sup_h®f_¿‹s
;

350 ià(
	`IEEE80211_IS_CHAN_QUARTER
(
chª
))

351 
ni
->
ni_¿‹s
 = 
ic
->
ic_sup_qu¬‹r_¿‹s
;

353 (è
	`›“80211_¡a_još1
(
	`PASS_NODE
(
ni
));

354 
	}
}

355 
EXPORT_SYMBOL
(
›“80211_ü—‹_ibss
);

364 
	$›“80211_»£t_bss
(
›“80211v­
 *
v­
)

366 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

367 
›“80211_node
 *
ni
 = 
NULL
;

368 
›“80211_node
 *
obss
 = 
v­
->
iv_bss
;

371 
	`›“80211_node_bË_»£t
(&
ic
->
ic_¡a
, 
v­
);

373 
	`›“80211_»£t_”p
(
ic
, ic->
ic_curmode
);

375 
ni
 = 
	`›“80211_®loc_node_bË
(
v­
, v­->
iv_myaddr
);

376 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

377 "%s:‚i:%°®loÿ‹d fÜ " 
MAC_FMT
 "\n",

378 
__func__
, 
ni
, 
	`MAC_ADDR
(
v­
->
iv_myaddr
));

379 
	`KASSERT
(
ni
 !ğ
NULL
, ("unableo setup inital BSS‚ode"));

381 
v­
->
iv_bss
 = 
	`PASS_NODE
(
ni
);

382 
	`KASSERT
((
	`©omic_»ad
(&
v­
->
iv_bss
->
ni_»fút
) == 2),

385 ià(
obss
 !ğ
NULL
) {

386 
	`cİy_bss_¡©e
(
v­
->
iv_bss
, 
obss
);

387 
v­
->
iv_bss
->
ni_štv®
 = 
ic
->
ic_lštv®
;

389 
	`›“80211_uÄef_node
(&
obss
);

391 
	}
}

394 
	$m©ch_ssid
(cÚ¡ 
›“80211_node
 *
ni
,

395 
nssid
, cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[])

397 
i
;

399 
i
 = 0; i < 
nssid
; i++) {

400 ià(
ni
->
ni_es¦’
 =ğ
ssids
[
i
].
Ën
 &&

401 
	`memcmp
(
ni
->
ni_essid
, 
ssids
[
i
].
ssid
,‚i->
ni_es¦’
) == 0)

405 
	}
}

411 
	$check_bss
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
)

413 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

414 
u_št8_t
 
¿‹
;

416 ià(
	`isşr
(
ic
->
ic_chª_aùive
, 
	`›“80211_chª2›“
(ic, 
ni
->
ni_chª
)))

418 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

419 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) == 0)

422 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) == 0)

425 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) {

426 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) == 0)

435 ià(
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
)

438 
¿‹
 = 
	`›“80211_fix_¿‹
(
ni
, 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DOFRATE
);

439 ià(
¿‹
 & 
IEEE80211_RATE_BASIC
)

441 ià(
v­
->
iv_des_nssid
 != 0 &&

442 !
	`m©ch_ssid
(
ni
, 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
))

444 ià((
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
) &&

445 !
	`IEEE80211_ADDR_EQ
(
v­
->
iv_des_bssid
, 
ni
->
ni_bssid
))

448 
	}
}

450 #ifdeà
IEEE80211_DEBUG


455 
	$check_bss_debug
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
)

457 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

458 
u_št8_t
 
¿‹
;

459 
ç
;

461 
ç
 = 0;

462 ià(
	`isşr
(
ic
->
ic_chª_aùive
, 
	`›“80211_chª2›“
(ic, 
ni
->
ni_chª
)))

463 
ç
 |= 0x01;

464 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

465 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) == 0)

466 
ç
 |= 0x02;

468 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) == 0)

469 
ç
 |= 0x02;

471 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) {

472 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) == 0)

473 
ç
 |= 0x04;

478 ià(
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
)

479 
ç
 |= 0x04;

481 
¿‹
 = 
	`›“80211_fix_¿‹
(
ni
, 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DOFRATE
);

482 ià(
¿‹
 & 
IEEE80211_RATE_BASIC
)

483 
ç
 |= 0x08;

484 ià(
v­
->
iv_des_nssid
 != 0 &&

485 !
	`m©ch_ssid
(
ni
, 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
))

486 
ç
 |= 0x10;

487 ià((
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
) &&

488 !
	`IEEE80211_ADDR_EQ
(
v­
->
iv_des_bssid
, 
ni
->
ni_bssid
))

489 
ç
 |= 0x20;

491 
	`´štk
(" %ø" 
MAC_FMT
, 
ç
 ? '-' : '+', 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

492 
	`´štk
(" " 
MAC_FMT
 "%c", 
	`MAC_ADDR
(
ni
->
ni_bssid
), 
ç
 & 0x20 ? '!' : ' ');

493 
	`´štk
(" %3d%c",

494 
	`›“80211_chª2›“
(
ic
, 
ni
->
ni_chª
), 
ç
 & 0x01 ? '!' : ' ');

495 
	`´štk
(" %+4d", 
ni
->
ni_rssi
);

496 
	`´štk
(" %2dM%c", (
¿‹
 & 
IEEE80211_RATE_VAL
) / 2,

497 
ç
 & 0x08 ? '!' : ' ');

498 
	`´štk
(" %4s%c",

499 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) ? "ess" :

500 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) ? "ibss" :

502 
ç
 & 0x02 ? '!' : ' ');

503 
	`´štk
(" %3s%c ",

504 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) ? "wep" : "no",

505 
ç
 & 0x04 ? '!' : ' ');

506 
	`›“80211_´št_essid
(
ni
->
ni_essid
,‚i->
ni_es¦’
);

507 
	`´štk
("%s\n", 
ç
 & 0x10 ? "!" : "");

508 
	}
}

524 
	$›“80211_ibss_m”ge
(
›“80211_node
 *
ni
)

526 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

527 #ifdeà
IEEE80211_DEBUG


528 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

531 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

532 "%s:‚i:%p[" 
MAC_FMT
 "] iv_bss:%p[" MAC_FMT "]\n",

533 
__func__
, 
ni
, 
	`MAC_ADDR
Òi->
ni_maÿddr
),

534 
v­
->
iv_bss
, 
	`MAC_ADDR
(v­->iv_bss->
ni_maÿddr
));

536 ià(!
	`check_bss
(
v­
, 
ni
)) {

538 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

539 "%s: m”gçed, c­ab™› mism©ch\n", 
__func__
);

540 #ifdeà
IEEE80211_DEBUG


541 ià(
	`›“80211_msg_assoc
(
v­
))

542 
	`check_bss_debug
(
v­
, 
ni
);

544 
v­
->
iv_¡©s
.
is_ibss_ÿpmism©ch
++;

547 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

548 "%s:‚ew bssid " 
MAC_FMT
 ": % ´—mbË, % ¦Ùime%s\n", 
__func__
,

549 
	`MAC_ADDR
(
ni
->
ni_bssid
),

550 
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
 ? "short" : "long",

551 
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
 ? "short" : "long",

552 
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
 ? ",…rotection" : "");

553  
	`›“80211_¡a_još1
(
	`›“80211_»f_node
(
ni
));

554 
	}
}

555 
EXPORT_SYMBOL
(
›“80211_ibss_m”ge
);

557 
__šlše
 

558 
	$ssid_equ®
(cÚ¡ 
›“80211_node
 *
a
, cÚ¡ ›“80211_nod*
b
)

560  (
a
->
ni_es¦’
 =ğ
b
->ni_esslen &&

561 
	`memcmp
(
a
->
ni_essid
, 
b
->ni_essid,‡->
ni_es¦’
) == 0);

562 
	}
}

570 
	$›“80211_¡a_još1
(
›“80211_node
 *
£lbs
)

572 
›“80211v­
 *
v­
 = 
£lbs
->
ni_v­
;

573 
›“80211com
 *
ic
 = 
£lbs
->
ni_ic
;

574 
›“80211_node
 *
obss
;

575 
ÿÄ—ssoc
;

577 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

582 
	`›“80211_fix_¿‹
(
£lbs
, 
IEEE80211_F_DODEL
);

588 
obss
 = 
v­
->
iv_bss
;

593 
ÿÄ—ssoc
 = ((
obss
 !ğ
NULL
) &&

594 (
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
è&& 
	`ssid_equ®
(
obss
, 
£lbs
));

595 
v­
->
iv_bss
 = 
£lbs
;

596 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_bssid
, 
£lbs
->
ni_bssid
);

597 ià(
obss
 !ğ
NULL
)

598 
	`›“80211_uÄef_node
(&
obss
);

599 
ic
->
ic_bsschª
 = 
£lbs
->
ni_chª
;

600 
ic
->
ic_curchª
 = ic->
ic_bsschª
;

601 
ic
->
ic_curmode
 = 
	`›“80211_chª2mode
(ic->
ic_curchª
);

602 
ic
->
	`ic_£t_chªÃl
(ic);

608 
	`›“80211_»£t_”p
(
ic
, ic->
ic_curmode
);

609 
	`›“80211_wme_š™·¿ms
(
v­
);

611 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

617 ià(
ÿÄ—ssoc
) {

618 
v­
->
iv_n¥¬ams
.
Ãw¡©e
 = 
IEEE80211_S_ASSOC
;

619 
v­
->
iv_n¥¬ams
.
¬g
 = 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
;

620 
	`IEEE80211_SCHEDULE_TQUEUE
(&
v­
->
iv_¡ajoš1tq
);

622 
v­
->
iv_n¥¬ams
.
Ãw¡©e
 = 
IEEE80211_S_AUTH
;

623 
v­
->
iv_n¥¬ams
.
¬g
 = 
IEEE80211_FC0_SUBTYPE_DEAUTH
;

624 
	`IEEE80211_SCHEDULE_TQUEUE
(&
v­
->
iv_¡ajoš1tq
);

627 
v­
->
iv_n¥¬ams
.
Ãw¡©e
 = 
IEEE80211_S_RUN
;

628 
v­
->
iv_n¥¬ams
.
¬g
 = -1;

629 
	`IEEE80211_SCHEDULE_TQUEUE
(&
v­
->
iv_¡ajoš1tq
);

632 
	}
}

635 
	$›“80211_¡a_još1_skËt
(
IEEE80211_TQUEUE_ARG
 
d©a
)

637 
›“80211v­
 *
v­
ğ(›“80211v­ *)
d©a
;

638 
rc
;

640 
rc
 = 
	`›“80211_Ãw_¡©e
(
v­
, v­->
iv_n¥¬ams
.
Ãw¡©e
, v­->iv_n¥¬ams.
¬g
);

641 
v­
->
iv_n¥¬ams
.
»suÉ
 = 
rc
;

642 
v­
->
iv_nsdÚe
 = 1;

643 
	}
}

644 
EXPORT_SYMBOL
(
›“80211_¡a_još1_skËt
);

647 
	$›“80211_¡a_još
(
›“80211v­
 *
v­
,

648 cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

650 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

651 
›“80211_node
 *
ni
;

653 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
£
->
£_maÿddr
);

654 ià(
ni
 =ğ
NULL
) {

655 
ni
 = 
	`›“80211_®loc_node_bË
(
v­
, 
£
->
£_maÿddr
);

656 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

657 "%s:‚i:%°®loÿ‹d fÜ " 
MAC_FMT
 "\n",

658 
__func__
, 
ni
, 
	`MAC_ADDR
(
£
->
£_maÿddr
));

659 ià(
ni
 =ğ
NULL
) {

660 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_NODE
,

661 "%s: UÇbËØ®loÿ‹‚odfÜ BSS: " 
MAC_FMT
 "\n", 
__func__
,

662 
	`MAC_ADDR
(
ni
->
ni_maÿddr
));

671 
ni
->
ni_authmode
 = 
v­
->
iv_bss
->ni_authmode;

673 
ni
->
ni_r¢
 = 
v­
->
iv_bss
->ni_rsn;

674 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
£
->
£_bssid
);

675 
ni
->
ni_es¦’
 = 
£
->
£_ssid
[1];

676 
	`memıy
(
ni
->
ni_essid
, 
£
->
£_ssid
 + 2,‚i->
ni_es¦’
);

677 
ni
->
ni_¹sf
 = 
£
->
£_¹sf
;

678 
ni
->
ni_t¡amp
.
tsf
 = 
£
->
£_t¡amp
.tsf;

679 
ni
->
ni_štv®
 = 
	`IEEE80211_BINTVAL_SANITISE
(
£
->
£_štv®
);

680 
ni
->
ni_ÿpšfo
 = 
£
->
£_ÿpšfo
;

681 
ni
->
ni_chª
 = 
£
->
£_chª
;

682 
ni
->
ni_timoff
 = 
£
->
£_timoff
;

683 
ni
->
ni_fhdw–l
 = 
£
->
£_fhdw–l
;

684 
ni
->
ni_fhšdex
 = 
£
->
£_fhšdex
;

685 
ni
->
ni_”p
 = 
£
->
£_”p
;

686 
ni
->
ni_rssi
 = 
£
->
£_rssi
;

687 ià(
£
->
£_w·_›
 !ğ
NULL
)

688 
	`›“80211_§ve›
(&
ni
->
ni_w·_›
, 
£
->
£_w·_›
);

689 ià(
£
->
£_r¢_›
 !ğ
NULL
)

690 
	`›“80211_§ve›
(&
ni
->
ni_r¢_›
, 
£
->
£_r¢_›
);

691 ià(
£
->
£_wme_›
 !ğ
NULL
)

692 
	`›“80211_§ve›
(&
ni
->
ni_wme_›
, 
£
->
£_wme_›
);

693 ià(
£
->
£_©h_›
 !ğ
NULL
)

694 
	`›“80211_§v—th
(
ni
, 
£
->
£_©h_›
);

696 
v­
->
iv_dtim_³riod
 = 
£
->
£_dtim³riod
;

697 
v­
->
iv_dtim_couÁ
 = 0;

700 
	`›“80211_£tup_¿‹s
(
ni
, 
£
->
£_¿‹s
, se->
£_x¿‹s
,

701 
IEEE80211_F_DOSORT
 | 
IEEE80211_F_DONEGO
 | 
IEEE80211_F_DODEL
);

703  
	`›“80211_¡a_još1
(
	`PASS_NODE
(
ni
));

704 
	}
}

705 
EXPORT_SYMBOL
(
›“80211_¡a_još
);

712 
	$›“80211_¡a_Ëave
(
›“80211_node
 *
ni
)

714 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

717 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) &&

718 (
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_SWBMISS
)) {

719 
	`d–_tim”
(&
v­
->
iv_swbmiss
);

722 
	`›“80211_nÙify_node_Ëave
(
ni
);

723 
	}
}

730 
	$›“80211_node_bË_š™
(
›“80211com
 *
ic
,

731 
›“80211_node_bË
 *
Á
, cÚ¡ *
Çme
, 
šaù
)

733 
Á
->
Á_ic
 = 
ic
;

734 
	`IEEE80211_NODE_TABLE_LOCK_INIT
(
Á
, 
ic
->
ic_dev
->
Çme
);

735 
	`IEEE80211_SCAN_LOCK_INIT
(
Á
, 
ic
->
ic_dev
->
Çme
);

736 
	`TAILQ_INIT
(&
Á
->
Á_node
);

737 
Á
->
Á_Çme
 = 
Çme
;

738 
Á
->
Á_sÿng’
 = 1;

739 
Á
->
Á_šaù_š™
 = 
šaù
;

740 
	`š™_tim”
(&
Á
->
Á_wds_agšg_tim”
);

741 
Á
->
Á_wds_agšg_tim”
.
funùiÚ
 = 
›“80211_node_wds_ageout
;

742 
Á
->
Á_wds_agšg_tim”
.
d©a
 = ()‚t;

743 
	`mod_tim”
(&
Á
->
Á_wds_agšg_tim”
, 
jiff›s
 + 
HZ
 * 
WDS_AGING_TIMER_VAL
);

744 
	}
}

746 
__šlše
 

747 
	$node_bË_još_locked
(
›“80211_node_bË
 *
Á
,

748 
›“80211_node
 *
ni
)

750 
›“80211_node
 *
Ši
 = 
NULL
;

751 
	`IEEE80211_NODE_TABLE_LOCK_ASSERT
(
Á
);

753 
ni
->
ni_bË
 = 
Á
;

754 
Ši
 = 
	`›“80211_»f_node
(
ni
);

755 
	`TAILQ_INSERT_TAIL
(&
Á
->
Á_node
, 
Ši
, 
ni_li¡
);

756 
Ši
 = 
NULL
;

758 
	`LIST_INSERT_HEAD
(&
Á
->
Á_hash
[
	`IEEE80211_NODE_HASH
(
ni
->
ni_maÿddr
)],

759 
ni
, 
ni_hash
);

760 
	}
}

762 
__šlše
 

763 
	$node_bË_Ëave_locked
(
›“80211_node_bË
 *
Á
,

764 
›“80211_node
 *
ni
)

766 
›“80211_node
 *
hni
;

767 
	`IEEE80211_NODE_TABLE_LOCK_ASSERT
(
Á
);

769 
	`TAILQ_REMOVE
(&
Á
->
Á_node
, 
ni
, 
ni_li¡
);

770 
	`LIST_FOREACH
(
hni
, &
Á
->
Á_hash
[
	`IEEE80211_NODE_HASH
(
ni
->
ni_maÿddr
)],

771 
ni_hash
) {

772 
	`LIST_REMOVE
(
ni
, 
ni_hash
);

774 
ni
->
ni_bË
 = 
NULL
;

775 
	`›“80211_uÄef_node
(&
ni
);

777 
	}
}

781 
›“80211_node
 *

782 
	$node_®loc
(
›“80211v­
 *
v­
)

784 
›“80211_node
 *
ni
;

785 
	`MALLOC
(
ni
, 
›“80211_node
 *, (ieee80211_node),

786 
M_80211_NODE
, 
M_NOWAIT
 | 
M_ZERO
);

787 
	`´štk
(
KERN_ERR
 "%s: ERROR,his function should‚ever be called!",

788 
__func__
);

789 
	`dump_¡ack
();

790  
ni
;

791 
	}
}

802 
	$node_ş—nup
(
›“80211_node
 *
ni
)

804 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

807 ià(
ni
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
) {

808 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
)

809 
v­
->
iv_ps_¡a
--;

810 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_PWR_MGT
;

811 #ifdeà
IEEE80211_DEBUG_REFCNT


812 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

814 
v­
->
iv_ps_¡a
);

815 ià(
	`›“80211_msg_is_»pÜ‹d
(
v­
, 
IEEE80211_MSG_POWER
))

816 
	`dump_¡ack
();

818 ià(
ni
->
ni_æags
 & 
IEEE80211_NODE_UAPSD_TRIG
) {

819 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_UAPSD_TRIG
;

820 
	`IEEE80211_LOCK_IRQ
(
ni
->
ni_ic
);

821 
ni
->
ni_ic
->
ic_u­sdmaxŒigg”s
--;

822 
	`IEEE80211_UNLOCK_IRQ
(
ni
->
ni_ic
);

827 ià(
	`›“80211_node_§veq_d¿š
(
ni
è!ğ0 && 
v­
->
iv_£t_tim
 !ğ
NULL
)

828 
v­
->
	`iv_£t_tim
(
ni
, 0);

830 
ni
->
ni_associd
 = 0;

845 ià(
ni
->
ni_rxäag
 !ğ
NULL
)

846 
	`›“80211_dev_kä“_skb
(&
ni
->
ni_rxäag
);

847 
	`›“80211_üy±o_d–key
(
v­
, &
ni
->
ni_uÿ¡key
,‚i);

848 
ni
->
ni_rxkeyoff
 = 0;

849 
	}
}

851 #ifdeà
IEEE80211_DEBUG


853 
	$node_´št_mes§ge
(

854 
u_št32_t
 
æags
,

855 
show_couÁ”
,

856 
»fút_adju¡
,

857 cÚ¡ 
›“80211_node
 *
ni
,

858 cÚ¡ *
mes§ge
,

861 
va_li¡
 
¬gs
;

862 
adju¡ed_»fcouÁ
 = 
	`©omic_»ad
(&
ni
->
ni_»fút
è+ 
»fút_adju¡
;

863 
node_couÁ
[10] = { '\0' };

864 
ex·nded_mes§ge
[192] = { '\0' };

866 ià(0 =ğ(
ni
->
ni_ic
->
ic_debug
 & 
æags
))

869 ià(
adju¡ed_»fcouÁ
 == 0)

870 
show_couÁ”
 = 1;

872 ià(
show_couÁ”
) {

873 
	`¢´štf
(
node_couÁ
,

874 (
node_couÁ
),

876 
	`©omic_»ad
(&
ni
->
ni_ic
->
ic_node_couÁ”
));

878 
	`va_¡¬t
(
¬gs
, 
mes§ge
);

879 
	`v¢´štf
(
ex·nded_mes§ge
, Óx·nded_mes§ge), 
mes§ge
, 
¬gs
);

880 
	`´štk
(
KERN_DEBUG
 "%s/%s: % % [nod%p<" 
MAC_FMT
 ">%s%s%s%s,„efs=%02d]\n",

881 
ni
->
ni_ic
->
ic_dev
->
Çme
,

882 
ni
->
ni_v­
->
iv_dev
->
Çme
,

883 
node_couÁ
,

884 
ex·nded_mes§ge
,

885 
ni
, 
	`MAC_ADDR
Òi->
ni_maÿddr
),

886 
ni
->
ni_bË
 !ğ
NULL
 ? " in " : "",

887 
ni
->
ni_bË
 !ğ
NULL
 ?‚i->ni_bË->
Á_Çme
 : "",

888 
ni
->
ni_bË
 !ğ
NULL
 ? "able" : "",

889 
ni
->
ni_bË
 !ğ
NULL
 ? "" : " (not in‡nyables)",

890 
adju¡ed_»fcouÁ
);

891 
	`dump_¡ack
();

892 
	`va_’d
(
¬gs
);

893 
	}
}

895 
	#node_´št_mes§ge
(...)

	)

899 
	$node_ä“
(
›“80211_node
 *
ni
)

901 
	`KASSERT
(
	`©omic_»ad
(&
ni
->
ni_»fút
) == 0,

904 ià(
ni
->
ni_ch®Ënge
 !ğ
NULL
)

905 
	`FREE
(
ni
->
ni_ch®Ënge
, 
M_DEVBUF
);

906 ià(
ni
->
ni_w·_›
 !ğ
NULL
)

907 
	`FREE
(
ni
->
ni_w·_›
, 
M_DEVBUF
);

908 ià(
ni
->
ni_r¢_›
 !ğ
NULL
)

909 
	`FREE
(
ni
->
ni_r¢_›
, 
M_DEVBUF
);

910 ià(
ni
->
ni_wme_›
 !ğ
NULL
)

911 
	`FREE
(
ni
->
ni_wme_›
, 
M_DEVBUF
);

912 ià(
ni
->
ni_©h_›
 !ğ
NULL
)

913 
	`FREE
(
ni
->
ni_©h_›
, 
M_DEVBUF
);

914 ià(
ni
->
ni_suµchªs
 !ğ
NULL
)

915 
	`FREE
(
ni
->
ni_suµchªs
, 
M_DEVBUF
);

916 ià(
ni
->
ni_suµchªs_Ãw
 !ğ
NULL
)

917 
	`FREE
(
ni
->
ni_suµchªs_Ãw
, 
M_DEVBUF
);

918 ià(
ni
->
ni_Ãeded_chªs
 !ğ
NULL
)

919 
	`FREE
(
ni
->
ni_Ãeded_chªs
, 
M_DEVBUF
);

921 
	`IEEE80211_NODE_SAVEQ_DESTROY
(
ni
);

923 
	`FREE
(
ni
, 
M_80211_NODE
);

924 
	}
}

926 
št32_t


927 
	$node_couÁ
(
›“80211com
 *
ic
)

929  
	`©omic_»ad
(&
ic
->
ic_node_couÁ”
);

930 
	}
}

932 
u_št8_t


933 
	$node_g‘rssi
(cÚ¡ 
›“80211_node
 *
ni
)

935  
ni
->
ni_rssi
;

936 
	}
}

949 
›“80211_node
 *

950 
	$›“80211_®loc_node_bË
(
›“80211v­
 *
v­
,

951 cÚ¡ 
u_št8_t
 *
maÿddr
)

953 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

954 
›“80211_node_bË
 *
Á
 = &
ic
->
ic_¡a
;

955 
›“80211_node
 *
ni
;

957 
ni
 = 
	`›“80211_®loc_node
(
v­
, 
maÿddr
);

958 ià(
ni
 !ğ
NULL
) {

959 
ni
->
ni_šaù
 =‚i->
ni_šaù_»lßd
 = 
Á
->
Á_šaù_š™
;

961 
	`WME_UAPSD_NODE_TRIGSEQINIT
(
ni
);

962 
	`IEEE80211_NODE_SAVEQ_INIT
(
ni
, "unknown");

964 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

965 
	`node_bË_još_locked
(
Á
, 
ni
);

966 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

969 
	`´štk
(
KERN_ERR
 "FaedØ®loÿ‹‚odfÜ " 
MAC_FMT
 ".\n",

970 
	`MAC_ADDR
(
maÿddr
));

973  
ni
;

974 
	}
}

975 
EXPORT_SYMBOL
(
›“80211_®loc_node_bË
);

982 
›“80211_node
 *

983 
	$›“80211_®loc_node
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 *
maÿddr
)

985 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

986 
›“80211_node
 *
ni
;

989 
ni
 = 
ic
->
	`ic_node_®loc
(
v­
);

990 ià(
ni
 !ğ
NULL
) {

991 
	`©omic_£t
(&
ni
->
ni_»fút
, 1);

992 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_maÿddr
, 
maÿddr
);

994 
ni
->
ni_chª
 = 
IEEE80211_CHAN_ANYC
;

995 
ni
->
ni_authmode
 = 
IEEE80211_AUTH_OPEN
;

996 
ni
->
ni_txpow”
 = 
ic
->
ic_txpowlim™
;

998 
	`›“80211_üy±o_»£tkey
(
v­
, &
ni
->
ni_uÿ¡key
,

999 
IEEE80211_KEYIX_NONE
);

1000 
ni
->
ni_©h_defkeyšdex
 = 
IEEE80211_INVAL_DEFKEY
;

1002 
ni
->
ni_v­
 = 
v­
;

1003 
ni
->
ni_ic
 = 
ic
;

1004 
	`©omic_šc
(&
ni
->
ni_ic
->
ic_node_couÁ”
);

1006 
	`node_´št_mes§ge
(
IEEE80211_MSG_NODE
 | 
IEEE80211_MSG_NODE_REF
,

1009 
ni
,

1013 
v­
->
iv_¡©s
.
is_rx_nod—Îoc
++;

1016  
ni
;

1017 
	}
}

1021 
	$›“80211_add_wds_addr
(
›“80211_node_bË
 *
Á
,

1022 
›“80211_node
 *
ni
, cÚ¡ 
u_št8_t
 *
maÿddr
, u_št8_ˆ
wds_¡©ic
)

1024 
hash
;

1025 
›“80211_wds_addr
 *
wds
;

1027 
	`MALLOC
(
wds
, 
›“80211_wds_addr
 *,

1028 (
›“80211_wds_addr
),

1029 
M_80211_WDS
, 
M_NOWAIT
 | 
M_ZERO
);

1030 ià(
wds
 =ğ
NULL
) {

1034 ià(
wds_¡©ic
)

1035 
wds
->
wds_agšgcouÁ
 = 
WDS_AGING_STATIC
;

1037 
wds
->
wds_agšgcouÁ
 = 
WDS_AGING_COUNT
;

1038 
hash
 = 
	`IEEE80211_NODE_HASH
(
maÿddr
);

1039 
	`IEEE80211_ADDR_COPY
(
wds
->
wds_maÿddr
, 
maÿddr
);

1041 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1042 
wds
->
wds_ni
 = 
	`›“80211_»f_node
(
ni
);

1043 
	`LIST_INSERT_HEAD
(&
Á
->
Á_wds_hash
[
hash
], 
wds
, 
wds_hash
);

1044 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1046 
	}
}

1047 
EXPORT_SYMBOL
(
›“80211_add_wds_addr
);

1051 
	$›“80211_»move_wds_addr
(
›“80211_node_bË
 *
Á
,

1052 cÚ¡ 
u_št8_t
 *
maÿddr
)

1054 
hash
;

1055 
›“80211_wds_addr
 *
wds
, *
twds
;

1057 
hash
 = 
	`IEEE80211_NODE_HASH
(
maÿddr
);

1058 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1059 
	`LIST_FOREACH_SAFE
(
wds
, &
Á
->
Á_wds_hash
[
hash
], 
wds_hash
, 
twds
) {

1060 ià(
	`IEEE80211_ADDR_EQ
(
wds
->
wds_maÿddr
, 
maÿddr
)) {

1061 
	`LIST_REMOVE
(
wds
, 
wds_hash
);

1062 
	`›“80211_uÄef_node
(&
wds
->
wds_ni
);

1063 
	`FREE
(
wds
, 
M_80211_WDS
);

1067 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1068 
	}
}

1069 
EXPORT_SYMBOL
(
›“80211_»move_wds_addr
);

1073 
	$›“80211_d–_wds_node
(
›“80211_node_bË
 *
Á
,

1074 
›“80211_node
 *
ni
)

1076 
hash
;

1077 
›“80211_wds_addr
 *
wds
, *
twds
;

1079 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1080 
hash
 = 0; hash < 
IEEE80211_NODE_HASHSIZE
; hash++) {

1081 
	`LIST_FOREACH_SAFE
(
wds
, &
Á
->
Á_wds_hash
[
hash
], 
wds_hash
, 
twds
) {

1082 ià(
wds
->
wds_ni
 =ğ
ni
) {

1083 
	`LIST_REMOVE
(
wds
, 
wds_hash
);

1084 
	`›“80211_uÄef_node
(&
wds
->
wds_ni
);

1085 
	`FREE
(
wds
, 
M_80211_WDS
);

1089 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1090 
	}
}

1091 
EXPORT_SYMBOL
(
›“80211_d–_wds_node
);

1094 
	$›“80211_node_wds_ageout
(
d©a
)

1096 
›“80211_node_bË
 *
Á
 = (›“80211_node_bË *)
d©a
;

1097 
hash
;

1098 
›“80211_wds_addr
 *
wds
, *
twds
;

1100 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1101 
hash
 = 0; hash < 
IEEE80211_NODE_HASHSIZE
; hash++) {

1102 
	`LIST_FOREACH_SAFE
(
wds
, &
Á
->
Á_wds_hash
[
hash
], 
wds_hash
, 
twds
) {

1103 ià(
wds
->
wds_agšgcouÁ
 !ğ
WDS_AGING_STATIC
) {

1104 ià(!
wds
->
wds_agšgcouÁ
) {

1105 
	`LIST_REMOVE
(
wds
, 
wds_hash
);

1106 
	`›“80211_uÄef_node
(&
wds
->
wds_ni
);

1107 
	`FREE
(
wds
, 
M_80211_WDS
);

1109 
wds
->
wds_agšgcouÁ
--;

1113 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1114 
	`mod_tim”
(&
Á
->
Á_wds_agšg_tim”
, 
jiff›s
 + 
HZ
 * 
WDS_AGING_TIMER_VAL
);

1115 
	}
}

1122 
›“80211_node
 *

1123 
	$›“80211_dup_bss
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 *
maÿddr
,

1124 
tmp
)

1126 
›“80211_node
 *
ni
;

1129 ià(
tmp
) {

1130 
ni
 = 
	`›“80211_®loc_node
(
v­
, 
maÿddr
);

1133 
ni
 = 
	`›“80211_®loc_node_bË
(
v­
, 
maÿddr
);

1134 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

1135 "%s:‚i:%°®loÿ‹d fÜ " 
MAC_FMT
 "\n",

1136 
__func__
, 
ni
, 
	`MAC_ADDR
(
maÿddr
));

1139 ià(
ni
 !ğ
NULL
) {

1140 
	`cİy_bss_¡©e
(
ni
, 
v­
->
iv_bss
);

1141 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
v­
->
iv_bssid
);

1145 
	`›“80211_node_£t_chª
(
v­
->
iv_ic
, 
ni
);

1147  
ni
;

1148 
	}
}

1150 
›“80211_node
 *

1151 
	$›“80211_fšd_wds_node_locked
(
›“80211_node_bË
 *
Á
,

1152 cÚ¡ 
u_št8_t
 *
maÿddr
)

1154 
›“80211_wds_addr
 *
wds
;

1155 
hash
;

1156 
	`IEEE80211_NODE_TABLE_LOCK_ASSERT
(
Á
);

1158 
hash
 = 
	`IEEE80211_NODE_HASH
(
maÿddr
);

1159 
	`LIST_FOREACH
(
wds
, &
Á
->
Á_wds_hash
[
hash
], 
wds_hash
) {

1160 ià(
	`IEEE80211_ADDR_EQ
(
wds
->
wds_maÿddr
, 
maÿddr
)) {

1162 ià(
wds
->
wds_agšgcouÁ
 !ğ
WDS_AGING_STATIC
)

1163 
wds
->
wds_agšgcouÁ
 = 
WDS_AGING_COUNT
;

1164  
	`›“80211_»f_node
(
wds
->
wds_ni
);

1167  
NULL
;

1168 
	}
}

1171 
›“80211_node
 *

1172 
	$›“80211_fšd_node_locked
(
›“80211_node_bË
 *
Á
,

1173 cÚ¡ 
u_št8_t
 *
maÿddr
)

1175 
›“80211_node
 *
ni
;

1176 
hash
;

1177 
›“80211_wds_addr
 *
wds
;

1179 
	`IEEE80211_NODE_TABLE_LOCK_ASSERT
(
Á
);

1181 
hash
 = 
	`IEEE80211_NODE_HASH
(
maÿddr
);

1182 
	`LIST_FOREACH
(
ni
, &
Á
->
Á_hash
[
hash
], 
ni_hash
) {

1183 ià(
	`IEEE80211_ADDR_EQ
(
ni
->
ni_maÿddr
, 
maÿddr
)) {

1184 
	`›“80211_»f_node
(
ni
);

1185  
ni
;

1191 
	`LIST_FOREACH
(
wds
, &
Á
->
Á_wds_hash
[
hash
], 
wds_hash
) {

1192 ià(
	`IEEE80211_ADDR_EQ
(
wds
->
wds_maÿddr
, 
maÿddr
))

1193  
	`›“80211_»f_node
(
wds
->
wds_ni
);

1195  
NULL
;

1196 
	}
}

1198 
›“80211_node
 *

1199 
	$›“80211_fšd_wds_node
(
›“80211_node_bË
 *
Á
,

1200 cÚ¡ 
u_št8_t
 *
maÿddr
)

1202 
›“80211_node
 *
ni
;

1204 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1205 
ni
 = 
	`›“80211_fšd_wds_node_locked
(
Á
, 
maÿddr
);

1206 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1207  
ni
;

1208 
	}
}

1209 
EXPORT_SYMBOL
(
›“80211_fšd_wds_node
);

1211 
›“80211_node
 *

1212 
	$›“80211_fšd_node
(
›“80211_node_bË
 *
Á
, cÚ¡ 
u_št8_t
 *
maÿddr
)

1214 
›“80211_node
 *
ni
;

1216 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1217 
ni
 = 
	`›“80211_fšd_node_locked
(
Á
, 
maÿddr
);

1218 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1219  
ni
;

1220 
	}
}

1221 
EXPORT_SYMBOL
(
›“80211_fšd_node
);

1231 
›“80211_node
 *

1232 
	$›“80211_çkeup_adhoc_node
(
›“80211v­
 *
v­
,

1233 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
])

1235 
›“80211_node
 *
ni
;

1237 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
maÿddr
, 0);

1238 ià(
ni
 !ğ
NULL
) {

1240 
ni
->
ni_¿‹s
 = 
v­
->
iv_bss
->ni_rates;

1241 ià(
v­
->
iv_ic
->
ic_Ãwassoc
 !ğ
NULL
)

1242 
v­
->
iv_ic
->
	`ic_Ãwassoc
(
ni
, 1);

1244 
	`›“80211_node_authÜize
(
ni
);

1246  
ni
;

1247 
	}
}

1255 
›“80211_node
 *

1256 
	$›“80211_add_ÃighbÜ
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_äame
 *
wh
,

1257 cÚ¡ 
›“80211_sÿÅ¬ams
 *
¥
)

1259 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1260 
›“80211_node
 *
ni
;

1262 
ni
 = 
	`›“80211_dup_bss
(
v­
, 
wh
->
i_addr2
, 0);

1263 ià(
ni
 !ğ
NULL
) {

1264 
ni
->
ni_es¦’
 = 
¥
->
ssid
[1];

1265 
	`memıy
(
ni
->
ni_essid
, 
¥
->
ssid
 + 2, sp->ssid[1]);

1266 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
wh
->
i_addr3
);

1267 
	`memıy
(
ni
->
ni_t¡amp
.
d©a
, 
¥
->
t¡amp
, (ni->ni_tstamp));

1268 
ni
->
ni_štv®
 = 
	`IEEE80211_BINTVAL_SANITISE
(
¥
->
bštv®
);

1269 
ni
->
ni_ÿpšfo
 = 
¥
->
ÿpšfo
;

1270 
ni
->
ni_chª
 = 
ic
->
ic_curchª
;

1271 
ni
->
ni_fhdw–l
 = 
¥
->
fhdw–l
;

1272 
ni
->
ni_fhšdex
 = 
¥
->
fhšdex
;

1273 
ni
->
ni_”p
 = 
¥
->
”p
;

1274 
ni
->
ni_timoff
 = 
¥
->
timoff
;

1275 ià(
¥
->
wme
 !ğ
NULL
)

1276 
	`›“80211_§ve›
(&
ni
->
ni_wme_›
, 
¥
->
wme
);

1277 ià(
¥
->
w·
 !ğ
NULL
)

1278 
	`›“80211_§ve›
(&
ni
->
ni_w·_›
, 
¥
->
w·
);

1279 ià(
¥
->
r¢
 !ğ
NULL
)

1280 
	`›“80211_§ve›
(&
ni
->
ni_r¢_›
, 
¥
->
r¢
);

1281 ià(
¥
->
©h
 !ğ
NULL
)

1282 
	`›“80211_§v—th
(
ni
, 
¥
->
©h
);

1285 
	`›“80211_£tup_¿‹s
(
ni
, 
¥
->
¿‹s
, sp->
x¿‹s
, 
IEEE80211_F_DOSORT
);

1287 ià(
ic
->
ic_Ãwassoc
 !ğ
NULL
)

1288 
ic
->
	`ic_Ãwassoc
(
ni
, 1);

1290 
	`›“80211_node_authÜize
(
ni
);

1291 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
) {

1298 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WME
)

1299 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_QOS
;

1300 ià(
v­
->
iv_æags
 & 
IEEE80211_F_SHPREAMBLE
)

1301 
ni
->
ni_ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

1304  
ni
;

1305 
	}
}

1314 
›“80211_node
 *

1315 
	$›“80211_fšd_rxnode
(
›“80211com
 *
ic
,

1316 cÚ¡ 
›“80211_äame_mš
 *
wh
)

1318 
	#IS_CTL
(
wh
) \

1319 ((
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_CTL
)

	)

1320 
	#IS_PSPOLL
(
wh
) \

1321 ((
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
è=ğ
IEEE80211_FC0_SUBTYPE_PS_POLL
)

	)

1322 
	#IS_RTS
(
wh
) \

1323 ((
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
è=ğ
IEEE80211_FC0_SUBTYPE_RTS
)

	)

1324 
›“80211_node_bË
 *
Á
;

1325 
›“80211_node
 *
ni
;

1329 
Á
 = &
ic
->
ic_¡a
;

1330 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1333 ià(
	`IS_CTL
(
wh
è&& !
	`IS_PSPOLL
(whè&& !
	`IS_RTS
(wh))

1334 
ni
 = 
	`›“80211_fšd_node_locked
(
Á
, 
wh
->
i_addr1
);

1336 
ni
 = 
	`›“80211_fšd_node_locked
(
Á
, 
wh
->
i_addr2
);

1337 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1339  
ni
;

1340 #undeà
IS_PSPOLL


1341 #undeà
IS_CTL


1342 #undeà
IS_RTS


1343 
	}
}

1344 
EXPORT_SYMBOL
(
›“80211_fšd_rxnode
);

1352 
›“80211_node
 *

1353 
	$›“80211_fšd_txnode
(
›“80211v­
 *
v­
, cÚ¡ 
u_št8_t
 *
mac
)

1355 
›“80211_node_bË
 *
Á
;

1356 
›“80211_node
 *
ni
 = 
NULL
;

1361 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 || 
	`IEEE80211_IS_MULTICAST
(
mac
))

1362  
	`›“80211_»f_node
(
v­
->
iv_bss
);

1365 
Á
 = &
v­
->
iv_ic
->
ic_¡a
;

1366 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1367 
ni
 = 
	`›“80211_fšd_node_locked
(
Á
, 
mac
);

1368 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1370 ià(
ni
 =ğ
NULL
) {

1371 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
 ||

1372 
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
) {

1376 
ni
 = 
	`›“80211_çkeup_adhoc_node
(
v­
, 
mac
);

1377 ià(
ni
 !ğ
NULL
)

1378 
	`›“80211_»f_node
(
ni
);

1380 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_OUTPUT
, 
mac
,

1381 "nØnode, disÿrd f¿m(%s)", 
__func__
);

1382 
v­
->
iv_¡©s
.
is_tx_nÚode
++;

1385  
ni
;

1386 
	}
}

1387 
EXPORT_SYMBOL
(
›“80211_fšd_txnode
);

1391 
	$›“80211_ä“_node
(
›“80211_node
 *
ni
)

1393 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1395 
	`©omic_dec
(&
ni
->
ni_ic
->
ic_node_couÁ”
);

1397 
	`node_´št_mes§ge
(
IEEE80211_MSG_NODE
 | 
IEEE80211_MSG_NODE_REF
,

1400 
ni
,

1403 ià(
v­
->
iv_aid_b™m­
 !ğ
NULL
)

1404 
	`IEEE80211_AID_CLR
(
v­
, 
ni
->
ni_associd
);

1406 
v­
->
iv_ic
->
	`ic_node_ä“
(
ni
);

1407 
	}
}

1408 
EXPORT_SYMBOL
(
›“80211_ä“_node
);

1410 
	$_»£t_node
(*
¬g
, 
›“80211_node
 *
ni
)

1412 ià(
ni
->
ni_associd
 != 0) {

1413 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1415 ià(
v­
->
iv_auth
->
Ÿ_node_Ëave
 !ğ
NULL
)

1416 
v­
->
iv_auth
->
	`Ÿ_node_Ëave
(
ni
);

1417 ià(
v­
->
iv_aid_b™m­
 !ğ
NULL
)

1418 
	`IEEE80211_AID_CLR
(
v­
, 
ni
->
ni_associd
);

1421 
	`›“80211_node_Ëave
(
ni
);

1422 
	}
}

1425 
	$›“80211_node_bË_»£t
(
›“80211_node_bË
 *
Á
,

1426 
›“80211v­
 *
v­
)

1428 
	`›“80211_™”©e_dev_nodes
(
v­
->
iv_dev
, 
Á
, 
_»£t_node
, 
NULL
);

1429 
	}
}

1432 
	$›“80211_node_bË_ş—nup
(
›“80211_node_bË
 *
Á
)

1434 
›“80211com
 *
ic
 = 
Á
->
Á_ic
;

1435 
›“80211_node
 *
ni
, *
Ãxt
;

1437 
	`TAILQ_FOREACH_SAFE
(
ni
, &
Á
->
Á_node
, 
ni_li¡
, 
Ãxt
) {

1438 ià(
ni
->
ni_associd
 != 0) {

1439 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1441 ià(
v­
->
iv_auth
->
Ÿ_node_Ëave
 !ğ
NULL
)

1442 
v­
->
iv_auth
->
	`Ÿ_node_Ëave
(
ni
);

1443 ià(
v­
->
iv_aid_b™m­
 !ğ
NULL
)

1444 
	`IEEE80211_AID_CLR
(
v­
, 
ni
->
ni_associd
);

1446 
ic
->
	`ic_node_ş—nup
(
ni
);

1448 
	`d–_tim”
(&
Á
->
Á_wds_agšg_tim”
);

1449 
	`IEEE80211_SCAN_LOCK_DESTROY
(
Á
);

1450 
	`IEEE80211_NODE_TABLE_LOCK_DESTROY
(
Á
);

1451 
	}
}

1466 
	$›“80211_timeout_¡©iÚs
(
›“80211_node_bË
 *
Á
)

1468 
›“80211com
 *
ic
 = 
Á
->
Á_ic
;

1469 
›“80211_node
 *
ni
;

1470 
u_št
 
g’
;

1471 
i§dhoc
;

1473 
i§dhoc
 = (
ic
->
ic_İmode
 =ğ
IEEE80211_M_IBSS
 ||

1474 
ic
->
ic_İmode
 =ğ
IEEE80211_M_AHDEMO
);

1475 
	`IEEE80211_SCAN_LOCK_IRQ
(
Á
);

1476 
g’
 = ++
Á
->
Á_sÿng’
;

1477 
»¡¬t
:

1478 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1479 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

1480 ià(
ni
->
ni_sÿng’
 =ğ
g’
)

1482 
ni
->
ni_sÿng’
 = 
g’
;

1489 ià(
ni
->
ni_rxäag
 !ğ
NULL
 &&

1490 
	`time_aá”
(
jiff›s
, 
ni
->
ni_rxäag¡amp
 + 
HZ
)) {

1491 
	`›“80211_dev_kä“_skb
(&
ni
->
ni_rxäag
);

1500 ià((
ni
 =ğni->
ni_v­
->
iv_bss
) ||

1501 (
ni
->
ni_v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
 &&

1502 !
	`memcmp
(
ni
->
ni_maÿddr
,‚i->
ni_v­
->
wds_mac
, 
ETH_ALEN
)))

1505 ià(
ni
->
ni_šaù
 > 0)

1506 
ni
->
ni_šaù
--;

1509 
ni
->
ni_šaù
--;

1510 ià(
ni
->
ni_associd
 !ğ0 || 
i§dhoc
) {

1511 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1515 ià(
	`›“80211_node_§veq_age
(
ni
) != 0 &&

1516 
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
) == 0 &&

1517 
v­
->
iv_£t_tim
 !ğ
NULL
)

1518 
v­
->
	`iv_£t_tim
(
ni
, 0);

1525 ià(0 < 
ni
->
ni_šaù
 &&

1526 
ni
->
ni_šaù
 <ğ
v­
->
iv_šaù_´obe
) {

1527 
	`IEEE80211_NOTE
(
v­
,

1528 
IEEE80211_MSG_INACT
 | 
IEEE80211_MSG_NODE
,

1529 
ni
, "%s",

1538 
	`›“80211_»f_node
(
ni
);

1539 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ_EARLY
(
Á
);

1540 
	`›“80211_£nd_nuÎd©a
(
ni
);

1542 
»¡¬t
;

1545 ià(
ni
->
ni_šaù
 <= 0) {

1546 
	`IEEE80211_NOTE
(
ni
->
ni_v­
,

1547 
IEEE80211_MSG_INACT
 | 
IEEE80211_MSG_NODE
, 
ni
,

1549 
	`©omic_»ad
(&
ni
->
ni_»fút
));

1560 
ni
->
ni_v­
->
iv_¡©s
.
is_node_timeout
++;

1561 
	`›“80211_»f_node
(
ni
);

1562 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ_EARLY
(
Á
);

1563 ià(
ni
->
ni_associd
 != 0) {

1564 
	`IEEE80211_SEND_MGMT
(
ni
,

1565 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

1566 
IEEE80211_REASON_AUTH_EXPIRE
);

1568 
	`›“80211_node_Ëave
(
ni
);

1569 
	`›“80211_uÄef_node
(&
ni
);

1570 
»¡¬t
;

1573 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1575 
	`IEEE80211_SCAN_UNLOCK_IRQ
(
Á
);

1576 
	}
}

1582 
	$›“80211_node_timeout
(
¬g
)

1584 
›“80211com
 *
ic
 = (›“80211com *)
¬g
;

1586 
	`›“80211_sÿn_timeout
(
ic
);

1587 
	`›“80211_timeout_¡©iÚs
(&
ic
->
ic_¡a
);

1589 
	`mod_tim”
(&
ic
->
ic_šaù
, 
jiff›s
 + 
IEEE80211_INACT_WAIT
 * 
HZ
);

1590 
	}
}

1593 
	$›“80211_™”©e_nodes
(
›“80211_node_bË
 *
Á
,

1594 
›“80211_™”_func
 *
f
, *
¬g
)

1596 
	`›“80211_™”©e_dev_nodes
(
NULL
, 
Á
, 
f
, 
¬g
);

1597 
	}
}

1598 
EXPORT_SYMBOL
(
›“80211_™”©e_nodes
);

1601 
	$›“80211_™”©e_dev_nodes
(
Ãt_deviû
 *
dev
,

1602 
›“80211_node_bË
 *
Á
,

1603 
›“80211_™”_func
 *
f
, *
¬g
)

1605 
›“80211_node
 *
ni
;

1606 
u_št
 
g’
;

1608 
	`IEEE80211_SCAN_LOCK_IRQ
(
Á
);

1609 
g’
 = ++
Á
->
Á_sÿng’
;

1611 
»¡¬t
:

1612 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1613 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

1614 ià(
dev
 !ğ
NULL
 && 
ni
->
ni_v­
->
iv_dev
 != dev)

1616 ià(
ni
->
ni_sÿng’
 !ğ
g’
) {

1617 
ni
->
ni_sÿng’
 = 
g’
;

1618 ()
	`›“80211_»f_node
(
ni
);

1619 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ_EARLY
(
Á
);

1620 (*
f
)(
¬g
, 
ni
);

1622 
	`›“80211_uÄef_node
(&
ni
);

1623 
»¡¬t
;

1626 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1628 
	`IEEE80211_SCAN_UNLOCK_IRQ
(
Á
);

1629 
	}
}

1630 
EXPORT_SYMBOL
(
›“80211_™”©e_dev_nodes
);

1633 
	$›“80211_dump_node
(
›“80211_node_bË
 *
Á
, 
›“80211_node
 *
ni
)

1635 
i
;

1637 
	`´štk
("0x%p: maø" 
MAC_FMT
 " (»fúˆ%d)\n", 
ni
,

1638 
	`MAC_ADDR
(
ni
->
ni_maÿddr
), 
	`©omic_»ad
(&ni->
ni_»fút
));

1639 
	`´štk
("\tscangen %u‡uthmode %u flags 0x%x\n",

1640 
ni
->
ni_sÿng’
,‚i->
ni_authmode
,‚i->
ni_æags
);

1641 
	`´štk
("\tassocid 0x%xxpower %u vlan %u\n",

1642 
ni
->
ni_associd
,‚i->
ni_txpow”
,‚i->
ni_vÏn
);

1643 
	`´štk
 ("rxäag¡am°%lu\n", 
ni
->
ni_rxäag¡amp
);

1644 
i
 = 0; i < 17; i++) {

1645 
	`´štk
("\t%d:x£q %u„x£q %u f¿gnØ%u\n", 
i
,

1646 
ni
->
ni_tx£qs
[
i
],

1647 
ni
->
ni_rx£qs
[
i
] >> 
IEEE80211_SEQ_SEQ_SHIFT
,

1648 
ni
->
ni_rx£qs
[
i
] & 
IEEE80211_SEQ_FRAG_MASK
);

1650 
	`´štk
("\trtsf %10llu„ssi %u intval %u capinfo 0x%x\n",

1651 
ni
->
ni_¹sf
,‚i->
ni_rssi
,‚i->
ni_štv®
,‚i->
ni_ÿpšfo
);

1652 
	`´štk
("\tbssid " 
MAC_FMT
 "ƒssid \"%.*s\" channel %u:0x%x\n",

1653 
	`MAC_ADDR
(
ni
->
ni_bssid
),

1654 
ni
->
ni_es¦’
,‚i->
ni_essid
,

1655 
ni
->
ni_chª
 !ğ
IEEE80211_CHAN_ANYC
 ?

1656 
ni
->
ni_chª
->
ic_äeq
 : 
IEEE80211_CHAN_ANY
,

1657 
ni
->
ni_chª
 !ğ
IEEE80211_CHAN_ANYC
 ?‚i->ni_chª->
ic_æags
 : 0);

1658 
	`´štk
("\tinact %uxrate %u\n",

1659 
ni
->
ni_šaù
,‚i->
ni_tx¿‹
);

1660 
	}
}

1663 
	$›“80211_dump_nodes
(
›“80211_node_bË
 *
Á
)

1665 
	`›“80211_™”©e_nodes
(
Á
,

1666 (
›“80211_™”_func
 *)
›“80211_dump_node
, 
Á
);

1667 
	}
}

1673 
	$›“80211_node_još_11g
(
›“80211_node
 *
ni
)

1675 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1676 #ifdeà
IEEE80211_DEBUG


1677 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1680 
	`IEEE80211_LOCK_ASSERT
(
ic
);

1682 
	`KASSERT
(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
),

1683 ("nÙ iÀ11g, bs %u:0x%x, curmod%u", 
ic
->
ic_bsschª
->
ic_äeq
,

1684 
ic
->
ic_bsschª
->
ic_æags
, ic->
ic_curmode
));

1693 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
) == 0) {

1694 
ic
->
ic_lÚg¦Ù¡a
++;

1695 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

1697 
ic
->
ic_lÚg¦Ù¡a
);

1699 ià(!
	`IEEE80211_IS_CHAN_108G
(
ic
->
ic_bsschª
)) {

1705 
	`›“80211_£t_shÜt¦Ùtime
(
ic
, 0);

1713 ià(!
	`›“80211_i£½_¿‹£t
(
ic
, &
ni
->
ni_¿‹s
)) {

1714 
ic
->
ic_nÚ”p¡a
++;

1715 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

1717 
ic
->
ic_nÚ”p¡a
);

1721 ià(
ic
->
ic_´Ùmode
 !ğ
IEEE80211_PROT_NONE
) {

1722 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

1723 "%s:ƒÇbË u£ oà´ÙeùiÚ\n", 
__func__
);

1724 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEPROT
;

1730 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_PREAMBLE
) == 0) {

1731 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

1733 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEBARKER
;

1734 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SHPREAMBLE
;

1738 ià(
ic
->
ic_nÚ”p¡a
 == 1)

1739 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_ERPUPDATE
;

1741 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_ERP
;

1742 
	}
}

1745 
	$couÁ_suµchªs
(
›“80211com
 *
ic
, 
›“80211_node
 *
ni
, 
šc
)

1747 
i
, 
tmp1
, 
tmp2
 = 0;

1749 ià(
ni
->
ni_suµchªs
 =ğ
NULL
)

1752 
	`CHANNEL_FOREACH
(
i
, 
ic
, 
tmp1
, 
tmp2
)

1753 ià(
	`is£t
(
ni
->
ni_suµchªs
, 
i
))

1754 
ic
->
ic_chª_nodes
[
i
] +ğ
šc
;

1755 
ic
->
ic_ú_tÙ®
 +ğ
šc
;

1756 
	}
}

1759 
	$»move_wÜ£_nodes
(*
¬g
, 
›“80211_node
 *
ni
)

1761 
›“80211_node
 *
b‘‹r
 = (›“80211_nod*)
¬g
;

1762 
i
;

1764 ià(
ni
->
ni_suµchªs
 =ğ
NULL
)

1767 ià(
ni
 =ğ
b‘‹r
)

1770 
i
 = 0; i < 
b‘‹r
->
ni_n_Ãeded_chªs
; i++)

1771 ià(
	`isşr
(
ni
->
ni_suµchªs
, 
b‘‹r
->
ni_Ãeded_chªs
[
i
])) {

1773 
	`IEEE80211_NOTE_MAC
(
ni
->
ni_v­
, 
IEEE80211_MSG_ASSOC
|
IEEE80211_MSG_DOTH
, 
b‘‹r
->
ni_maÿddr
,

1774 "fÜcšg [" 
MAC_FMT
 "] (aid %dètØËave", 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

1775 
	`IEEE80211_NODE_AID
(
ni
));

1776 
	`IEEE80211_SEND_MGMT
(
ni
,

1777 
IEEE80211_FC0_SUBTYPE_DISASSOC
,

1778 
IEEE80211_REASON_SUPPCHAN_UNACCEPTABLE
);

1779 
ni
->
ni_v­
->
iv_¡©s
.
is_node_fdi§ssoc
++;

1780 
	`›“80211_node_Ëave
(
ni
);

1783 
	}
}

1786 
	$›“80211_node_još
(
›“80211_node
 *
ni
, 
»¥
)

1788 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1789 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1790 
Ãwassoc
;

1792 ià(
ni
->
ni_associd
 == 0) {

1793 
u_št16_t
 
aid
;

1795 
	`KASSERT
(
v­
->
iv_aid_b™m­
 !ğ
NULL
, ("no‡id bitmap"));

1800 
aid
 = 1;‡id < 
v­
->
iv_max_aid
;‡id++)

1801 ià(!
	`IEEE80211_AID_ISSET
(
v­
, 
aid
))

1803 ià(
aid
 >ğ
v­
->
iv_max_aid
) {

1804 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
,

1805 
IEEE80211_REASON_ASSOC_TOOMANY
);

1806 
	`›“80211_node_Ëave
(
ni
);

1809 
ni
->
ni_associd
 = 
aid
 | 0xc000;

1811 
	`IEEE80211_LOCK_IRQ
(
ic
);

1812 
	`IEEE80211_AID_SET
(
v­
, 
ni
->
ni_associd
);

1813 
v­
->
iv_¡a_assoc
++;

1814 
ic
->
ic_¡a_assoc
++;

1815 #ifdeà
ATH_SUPERG_XR


1816 ià(
ni
->
ni_v­
->
iv_æags
 & 
IEEE80211_F_XR
)

1817 
ic
->
ic_xr_¡a_assoc
++;

1819 ià(
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_ATHC_TURBOP
))

1820 
ic
->
ic_dt_¡a_assoc
++;

1822 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
))

1823 
	`›“80211_node_još_11g
(
ni
);

1825 
	`KASSERT
(
ni
->
ni_suµchªs
 =ğ
NULL
, ("not‡„eassociation, but suppchans bitmap‚ot NULL"));

1827 
ni
->
ni_suµchªs
 =‚i->
ni_suµchªs_Ãw
;

1828 
ni
->
ni_suµchªs_Ãw
 = 
NULL
;

1830 
	`couÁ_suµchªs
(
ic
, 
ni
, 1);

1832 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

1834 
Ãwassoc
 = 1;

1836 
	`IEEE80211_LOCK_IRQ
(
ic
);

1838 
	`couÁ_suµchªs
(
ic
, 
ni
, -1);

1839 ià(
ni
->
ni_suµchªs
 !ğ
NULL
) {

1840 
	`FREE
(
ni
->
ni_suµchªs
, 
M_DEVBUF
);

1841 
ni
->
ni_suµchªs
 = 
NULL
;

1844 
ni
->
ni_suµchªs
 =‚i->
ni_suµchªs_Ãw
;

1845 
ni
->
ni_suµchªs_Ãw
 = 
NULL
;

1847 
	`couÁ_suµchªs
(
ic
, 
ni
, 1);

1848 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

1849 
Ãwassoc
 = 0;

1852 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DEBUG
, 
ni
,

1855 
Ãwassoc
 ? "" : "re",

1856 
	`IEEE80211_NODE_AID
(
ni
),

1857 (
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

1858 (
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_PREAMBLE
) ? "short" : "long",

1859 
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
 ? "short" : "long",

1860 
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
 ? ",…rotection" : "",

1861 
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
 ? ", QoS" : "",

1862 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_TURBOP
) ?

1864 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_COMP
) ?

1866 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_FF
) ?

1868 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_XR
) ? ", XR" : "",

1869 
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_NODE_AR
) ? ", AR" : ""

1873 ià(
ic
->
ic_Ãwassoc
 !ğ
NULL
)

1874 
ic
->
	`ic_Ãwassoc
(
ni
, 
Ãwassoc
);

1875 
ni
->
ni_šaù_»lßd
 = 
v­
->
iv_šaù_auth
;

1876 
ni
->
ni_šaù
 =‚i->
ni_šaù_»lßd
;

1877 
	`IEEE80211_SEND_MGMT
(
ni
, 
»¥
, 
IEEE80211_STATUS_SUCCESS
);

1879 ià(
ni
->
ni_Ãeded_chªs
 !ğ
NULL
) {

1881 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, &
»move_wÜ£_nodes
, (*)
ni
);

1882 
	`FREE
(
ni
->
ni_Ãeded_chªs
, 
M_DEVBUF
);

1883 
ni
->
ni_Ãeded_chªs
 = 
NULL
;

1887 ià(
v­
->
iv_auth
->
Ÿ_node_još
 !ğ
NULL
)

1888 
v­
->
iv_auth
->
	`Ÿ_node_još
(
ni
);

1889 
	`›“80211_nÙify_node_još
(
ni
, 
Ãwassoc
);

1890 
	}
}

1896 
	$›“80211_node_Ëave_11g
(
›“80211_node
 *
ni
)

1898 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1899 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1901 
	`IEEE80211_LOCK_ASSERT
(
ic
);

1903 
	`KASSERT
(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
),

1905 
ic
->
ic_bsschª
->
ic_äeq
, ic->ic_bsschª->
ic_æags
,

1906 
ic
->
ic_curmode
));

1911 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
) == 0) {

1913 ià(
ic
->
ic_lÚg¦Ù¡a
 > 0)

1914 
ic
->
ic_lÚg¦Ù¡a
--;

1915 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

1917 
ic
->
ic_lÚg¦Ù¡a
);

1918 ià(
ic
->
ic_lÚg¦Ù¡a
 == 0) {

1923 ià((
ic
->
ic_ÿps
 & 
IEEE80211_C_SHSLOT
) &&

1924 
v­
->
iv_İmode
 !ğ
IEEE80211_M_IBSS
) {

1925 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

1927 
__func__
);

1928 
	`›“80211_£t_shÜt¦Ùtime
(
ic
, 1);

1935 ià((
ni
->
ni_æags
 & 
IEEE80211_NODE_ERP
) == 0) {

1937 ià(
ic
->
ic_nÚ”p¡a
 > 0)

1938 
ic
->
ic_nÚ”p¡a
--;

1939 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

1940 "nÚ-ERP stiÚ†—ves, couÁ‚ow %d", 
ic
->
ic_nÚ”p¡a
);

1941 ià(
ic
->
ic_nÚ”p¡a
 == 0) {

1942 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

1943 "%s: di§bË u£ oà´ÙeùiÚ\n", 
__func__
);

1944 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEPROT
;

1946 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_SHPREAMBLE
) {

1947 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ASSOC
,

1949 
__func__
);

1950 
ic
->
ic_æags
 |ğ
IEEE80211_F_SHPREAMBLE
;

1951 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEBARKER
;

1953 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_ERPUPDATE
;

1956 
	}
}

1963 
	$›“80211_node_Ëave
(
›“80211_node
 *
ni
)

1965 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1966 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1967 
›“80211_node_bË
 *
Á
 = 
ni
->
ni_bË
;

1969 ià(
	`IEEE80211_NODE_AID
(
ni
) != 0)

1970 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
 | 
IEEE80211_MSG_DEBUG
,

1971 
ni
, "station with‡id %d†eaves (refcnt %u)",

1972 
	`IEEE80211_NODE_AID
(
ni
), 
	`©omic_»ad
(&ni->
ni_»fút
));

1977 
	`›“80211_»move_wds_addr
(
Á
, 
ni
->
ni_maÿddr
);

1978 
	`›“80211_d–_wds_node
(
Á
, 
ni
);

1979 
	`IEEE80211_NODE_TABLE_LOCK_IRQ
(
Á
);

1980 
	`node_bË_Ëave_locked
(
Á
, 
ni
);

1981 
	`IEEE80211_NODE_TABLE_UNLOCK_IRQ
(
Á
);

1990 ià(
ni
->
ni_associd
 == 0)

1991 
dÚe
;

1998 ià(
v­
->
iv_auth
->
Ÿ_node_Ëave
 !ğ
NULL
)

1999 
v­
->
iv_auth
->
	`Ÿ_node_Ëave
(
ni
);

2000 
	`›“80211_nÙify_¡a_¡©s
(
ni
);

2002 
	`IEEE80211_LOCK_IRQ
(
ic
);

2003 ià(
v­
->
iv_aid_b™m­
 !ğ
NULL
)

2004 
	`IEEE80211_AID_CLR
(
v­
, 
ni
->
ni_associd
);

2006 
ni
->
ni_associd
 = 0;

2007 
v­
->
iv_¡a_assoc
--;

2008 
ic
->
ic_¡a_assoc
--;

2010 #ifdeà
ATH_SUPERG_XR


2011 ià(
ni
->
ni_v­
->
iv_æags
 & 
IEEE80211_F_XR
)

2012 
ic
->
ic_xr_¡a_assoc
--;

2014 ià(
	`IEEE80211_ATH_CAP
(
v­
, 
ni
, 
IEEE80211_ATHC_TURBOP
))

2015 
ic
->
ic_dt_¡a_assoc
--;

2017 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
))

2018 
	`›“80211_node_Ëave_11g
(
ni
);

2021 ià(
ni
->
ni_suµchªs
 !ğ
NULL
)

2022 
	`couÁ_suµchªs
(
ic
, 
ni
, -1);

2023 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

2031 
	`›“80211_¡a_Ëave
(
ni
);

2032 
dÚe
:

2034 
ic
->
	`ic_node_ş—nup
(
ni
);

2035 
	}
}

2036 
EXPORT_SYMBOL
(
›“80211_node_Ëave
);

2038 
u_št8_t


2039 
	$›“80211_g‘rssi
(
›“80211com
 *
ic
)

2041 
	#NZ
(
x
è((xè=ğ0 ? 1 : (x))

	)

2042 
›“80211_node_bË
 *
Á
 = &
ic
->
ic_¡a
;

2043 
›“80211v­
 *
v­
;

2044 
u_št32_t
 
rssi_§m¶es
, 
rssi_tÙ®
;

2045 
›“80211_node
 *
ni
;

2047 
rssi_tÙ®
 = 0;

2048 
rssi_§m¶es
 = 0;

2049 
ic
->
ic_İmode
) {

2050 
IEEE80211_M_IBSS
:

2052 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
)

2053 ià(
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) {

2054 
rssi_§m¶es
++;

2055 
rssi_tÙ®
 +ğ
ic
->
	`ic_node_g‘rssi
(
ni
);

2058 
IEEE80211_M_AHDEMO
:

2060 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
) {

2061 ià(
	`memcmp
(
ni
->
ni_v­
->
iv_myaddr
,‚i->
ni_maÿddr
,

2062 
IEEE80211_ADDR_LEN
)!=0) {

2063 
rssi_§m¶es
++;

2064 
rssi_tÙ®
 +ğ
ic
->
	`ic_node_g‘rssi
(
ni
);

2068 
IEEE80211_M_HOSTAP
:

2070 
	`TAILQ_FOREACH
(
ni
, &
Á
->
Á_node
, 
ni_li¡
)

2071 ià(
	`IEEE80211_AID
(
ni
->
ni_associd
) != 0) {

2072 
rssi_§m¶es
++;

2073 
rssi_tÙ®
 +ğ
ic
->
	`ic_node_g‘rssi
(
ni
);

2076 
IEEE80211_M_MONITOR
:

2077 
IEEE80211_M_STA
:

2079 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
)

2080 ià(
v­
->
iv_bss
 !ğ
NULL
) {

2081 
rssi_§m¶es
++;

2082 
rssi_tÙ®
 +ğ
ic
->
	`ic_node_g‘rssi
(
v­
->
iv_bss
);

2086  
rssi_tÙ®
 / 
	`NZ
(
rssi_§m¶es
);

2087 #undeà
NZ


2088 
	}
}

2089 
EXPORT_SYMBOL
(
›“80211_g‘rssi
);

2092 
	$›“80211_node_»£t
(
›“80211_node
 *
ni
, 
›“80211v­
 *
v­
)

2095 
	`IEEE80211_ADDR_COPY
(
ni
->
ni_bssid
, 
v­
->
iv_bssid
);

2096 
ni
->
ni_´ev_v­
 =‚i->
ni_v­
;

2097 
ni
->
ni_v­
 = 
v­
;

2098 
ni
->
ni_ic
 = 
v­
->
iv_ic
;

2099 
	}
}

2100 
EXPORT_SYMBOL
(
›“80211_node_»£t
);

2102 
›“80211_node
 *

2103 
	$›“80211_»f_node
(
›“80211_node
 *
ni
)

2105 ià(
ni
 =ğ
NULL
) {

2106 
	`´štk
(
KERN_ERR
 "%s: NULL‚ode.\n", 
__func__
);

2107 
	`dump_¡ack
();

2108 }ià(
	`©omic_»ad
(&
ni
->
ni_»fút
) < 1) {

2109 
	`node_´št_mes§ge
(
IEEE80211_MSG_ANY
,

2112 
ni
,

2115 
	`©omic_»ad
(&
ni
->
ni_»fút
));

2117 
	`©omic_šc
(&
ni
->
ni_»fút
);

2118 
	`node_´št_mes§ge
(
IEEE80211_MSG_NODE_REF
,

2121 
ni
, "ref");

2123  
ni
;

2124 
	}
}

2125 
EXPORT_SYMBOL
(
›“80211_»f_node
);

2128 
	$›“80211_uÄef_node
(
›“80211_node
 **
²i
)

2130 
›“80211_node
 *
ni
 = 
NULL
;

2131 ià(
²i
 =ğ
NULL
) {

2132 
	`´štk
(
KERN_ERR
 "%s: NULL i“e80211_nod**\n", 
__func__
);

2133 
	`dump_¡ack
();

2136 
ni
 = *
²i
;

2137 ià(
ni
 =ğ
NULL
) {

2138 
	`´štk
(
KERN_ERR
 "%s: NULL i“e80211_nod*\n", 
__func__
);

2139 
	`dump_¡ack
();

2142 ià(
	`©omic_»ad
(&
ni
->
ni_»fút
) < 1) {

2143 
	`node_´št_mes§ge
(
IEEE80211_MSG_ANY
,

2146 
ni
,

2149 
	`©omic_»ad
(&
ni
->
ni_»fút
));

2150 
	`dump_¡ack
();

2153 
	`node_´št_mes§ge
(
IEEE80211_MSG_NODE_REF
,

2156 
ni
,

2159 ià(
	`©omic_dec_ªd_‹¡
(&
ni
->
ni_»fút
))

2160 
	`›“80211_ä“_node
(
ni
);

2161 *
²i
 = 
NULL
;

2162 
	}
}

2163 
EXPORT_SYMBOL
(
›“80211_uÄef_node
);

2165 
št32_t


2166 
	$›“80211_g‘_node_couÁ
(
›“80211com
 *
ic
)

2168  
	`node_couÁ
(
ic
);

2169 
	}
}

2170 
EXPORT_SYMBOL
(
›“80211_g‘_node_couÁ
);

	@ieee80211_node.h

34 #iâdeà
_NET80211_IEEE80211_NODE_H_


35 
	#_NET80211_IEEE80211_NODE_H_


	)

37 
	~<Ãt80211/›“80211_v¬.h
>

38 
	~<Ãt80211/›“80211_ioùl.h
>

39 
	~<Ãt80211/›“80211_´Ùo.h
>

56 
	#IEEE80211_INACT_WAIT
 15

	)

57 
	#IEEE80211_INACT_INIT
 (30/
IEEE80211_INACT_WAIT
è

	)

58 
	#IEEE80211_INACT_AUTH
 (180/
IEEE80211_INACT_WAIT
è

	)

59 
	#IEEE80211_INACT_RUN
 (300/
IEEE80211_INACT_WAIT
è

	)

60 
	#IEEE80211_INACT_PROBE
 (30/
IEEE80211_INACT_WAIT
è

	)

61 
	#IEEE80211_INACT_SCAN
 (300/
IEEE80211_INACT_WAIT
è

	)

63 
	#IEEE80211_TRANS_WAIT
 5

	)

65 
	#IEEE80211_NODE_HASHSIZE
 32

	)

67 
	#IEEE80211_NODE_HASH
(
addr
) \

68 (((cÚ¡ 
u_št8_t
 *)(
addr
))[
IEEE80211_ADDR_LEN
 - 1] % \

69 
IEEE80211_NODE_HASHSIZE
)

	)

71 
	s›“80211_r¢·rms
 {

72 
u_št8_t
 
	mr¢_mÿ¡ch”
;

73 
u_št8_t
 
	mr¢_mÿ¡keyËn
;

74 
u_št8_t
 
	mr¢_uÿ¡ch”£t
;

75 
u_št8_t
 
	mr¢_uÿ¡ch”
;

76 
u_št8_t
 
	mr¢_uÿ¡keyËn
;

77 
u_št8_t
 
	mr¢_keymgmt£t
;

78 
u_št8_t
 
	mr¢_keymgmt
;

79 
u_št16_t
 
	mr¢_ÿps
;

82 
	g›“80211_node_bË
;

83 
	g›“80211com
;

84 
	g›“80211v­
;

85 
	g©h_buf
;

86 
	g©h_soác
;

94 
	s›“80211_node
 {

95 
›“80211v­
 *
	mni_v­
;

96 
›“80211com
 *
	mni_ic
;

97 
›“80211_node_bË
 *
	mni_bË
;

98 
TAILQ_ENTRY
(
›“80211_node
è
	mni_li¡
;

99 
LIST_ENTRY
(
›“80211_node
è
	mni_hash
;

100 
©omic_t
 
	mni_»fút
;

101 
u_št
 
	mni_sÿng’
;

102 
u_št8_t
 
	mni_authmode
;

103 
u_št16_t
 
	mni_æags
;

104 
	#IEEE80211_NODE_AUTH
 0x0001

	)

105 
	#IEEE80211_NODE_QOS
 0x0002

	)

106 
	#IEEE80211_NODE_ERP
 0x0004

	)

108 
	#IEEE80211_NODE_PWR_MGT
 0x0010

	)

109 
	#IEEE80211_NODE_AREF
 0x0020

	)

110 
	#IEEE80211_NODE_UAPSD
 0x0040

	)

111 
	#IEEE80211_NODE_UAPSD_TRIG
 0x0080

	)

112 
	#IEEE80211_NODE_UAPSD_SP
 0x0100

	)

113 
	#IEEE80211_NODE_PS_CHANGED
 0x0200

	)

114 
u_št8_t
 
	mni_©h_æags
;

116 
	#IEEE80211_NODE_TURBOP
 0x0001

	)

117 
	#IEEE80211_NODE_COMP
 0x0002

	)

118 
	#IEEE80211_NODE_FF
 0x0004

	)

119 
	#IEEE80211_NODE_XR
 0x0008

	)

120 
	#IEEE80211_NODE_AR
 0x0010

	)

121 
	#IEEE80211_NODE_BOOST
 0x0080

	)

122 
u_št16_t
 
	mni_©h_defkeyšdex
;

123 
	#IEEE80211_INVAL_DEFKEY
 0x7FFF

	)

124 
u_št16_t
 
	mni_associd
;

125 
u_št16_t
 
	mni_txpow”
;

126 
u_št16_t
 
	mni_vÏn
;

127 
u_št32_t
 *
	mni_ch®Ënge
;

128 
u_št8_t
 *
	mni_w·_›
;

129 
u_št8_t
 *
	mni_r¢_›
;

130 
u_št8_t
 *
	mni_wme_›
;

131 
u_št8_t
 *
	mni_©h_›
;

132 
u_št8_t
 *
	mni_suµchªs
;

133 
u_št8_t
 *
	mni_suµchªs_Ãw
;

134 
u_št8_t
 *
	mni_Ãeded_chªs
;

135 
u_št8_t
 
	mni_n_Ãeded_chªs
;

136 
u_št16_t
 
	mni_tx£qs
[17];

137 
u_št16_t
 
	mni_rx£qs
[17];

138 
	mni_rxäag¡amp
;

139 
sk_buff
 *
	mni_rxäag
;

140 
›“80211_r¢·rms
 
	mni_r¢
;

141 
›“80211_key
 
	mni_uÿ¡key
;

142 
	mni_rxkeyoff
;

145 
u_št64_t
 
	mni_¹sf
;

146 
	mni_Ï¡_rx
;

147 
u_št8_t
 
	mni_rssi
;

150 
u_št8_t
 
	mni_maÿddr
[
IEEE80211_ADDR_LEN
];

151 
u_št8_t
 
	mni_bssid
[
IEEE80211_ADDR_LEN
];

155 
u_št8_t
 
	md©a
[8];

156 
__Ë64
 
	mtsf
;

157 } 
	mni_t¡amp
;

159 
u_št16_t
 
	mni_štv®
;

160 
u_št16_t
 
	mni_štv®_Şd
;

161 
u_št16_t
 
	mni_štv®_út
;

162 
	mni_štv®_’d
;

164 
u_št16_t
 
	mni_ÿpšfo
;

165 
u_št8_t
 
	mni_es¦’
;

166 
u_št8_t
 
	mni_essid
[
IEEE80211_NWID_LEN
];

167 
›“80211_¿‹£t
 
	mni_¿‹s
;

168 
›“80211_chªÃl
 *
	mni_chª
;

169 
u_št16_t
 
	mni_fhdw–l
;

170 
u_št8_t
 
	mni_fhšdex
;

171 
u_št8_t
 
	mni_”p
;

172 
u_št16_t
 
	mni_timoff
;

175 
sk_buff_h—d
 
	mni_§vedq
;

176 
	mni_šaù
;

177 
	mni_šaù_»lßd
;

178 
	mni_tx¿‹
;

179 
›“80211_node¡©s
 
	mni_¡©s
;

180 
›“80211v­
 *
	mni_´ev_v­
;

181 
u_št8_t
 
	mni_u­sd
;

182 
u_št8_t
 
	mni_u­sd_max¥
;

183 
u_št16_t
 
	mni_u­sd_Œig£q
[
WME_NUM_AC
];

184 
__Ë16
 
	mni_pschªge£q
;

186 
MALLOC_DECLARE
(
M_80211_NODE
);

188 
	#IEEE80211_NODE_AID
(
ni
è
	`IEEE80211_AID
Òi->
ni_associd
)

	)

190 
	#IEEE80211_NODE_STAT
(
ni
,
¡©
èÒi->
ni_¡©s
.
ns_
##¡©++)

	)

191 
	#IEEE80211_NODE_STAT_ADD
(
ni
,
¡©
,
v
èÒi->
ni_¡©s
.
ns_
##¡© +ğv)

	)

192 
	#IEEE80211_NODE_STAT_SET
(
ni
,
¡©
,
v
èÒi->
ni_¡©s
.
ns_
##¡© = v)

	)

194 
	#WME_UAPSD_AC_CAN_TRIGGER
(
_ac
, 
_ni
) ( \

195 ((
_ni
)->
ni_æags
 & 
IEEE80211_NODE_UAPSD_TRIG
) && \

196 
	`WME_UAPSD_AC_ENABLED
((
_ac
), (
_ni
)->
ni_u­sd
))

	)

197 
	#WME_UAPSD_NODE_MAXQDEPTH
 8

	)

198 
	#IEEE80211_NODE_UAPSD_USETIM
(
_ni
è(((_ni)->
ni_u­sd
 & 0xFè=ğ0xF)

	)

199 
	#WME_UAPSD_NODE_INVALIDSEQ
 0xffff

	)

200 
	#WME_UAPSD_NODE_TRIGSEQINIT
(
_ni
) \

201 (
	`mem£t
(&(
_ni
)->
ni_u­sd_Œig£q
[0], \

202 0xff, ((
_ni
)->
ni_u­sd_Œig£q
)))

	)

204 
›“80211_node_©ch
(
›“80211com
 *);

205 
›“80211_node_d‘ach
(
›“80211com
 *);

206 
›“80211_node_v©ch
(
›“80211v­
 *);

207 
›“80211_node_Ï‹v©ch
(
›“80211v­
 *);

208 
›“80211_node_vd‘ach
(
›“80211v­
 *);

210 
__šlše
 

211 
	$›“80211_node_is_authÜized
(cÚ¡ 
›“80211_node
 *
ni
)

213  (
ni
->
ni_æags
 & 
IEEE80211_NODE_AUTH
);

214 
	}
}

216 
›“80211_node_authÜize
(
›“80211_node
 *);

217 
›“80211_node_uÇuthÜize
(
›“80211_node
 *);

219 
›“80211_ü—‹_ibss
(
›“80211v­
 *, 
›“80211_chªÃl
 *);

220 
›“80211_»£t_bss
(
›“80211v­
 *);

221 
›“80211_ibss_m”ge
(
›“80211_node
 *);

222 
	g›“80211_sÿn_’Œy
;

223 
›“80211_¡a_još
(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *);

224 
›“80211_¡a_još1_skËt
(
IEEE80211_TQUEUE_ARG
);

225 
›“80211_¡a_Ëave
(
›“80211_node
 *);

227 
	#WDS_AGING_TIME
 600

	)

228 
	#WDS_AGING_COUNT
 2

	)

229 
	#WDS_AGING_STATIC
 0xffff

	)

230 
	#WDS_AGING_TIMER_VAL
 (
WDS_AGING_TIME
 / 2)

	)

232 
	s›“80211_wds_addr
 {

233 
LIST_ENTRY
(
›“80211_wds_addr
è
	mwds_hash
;

234 
u_št8_t
 
	mwds_maÿddr
[
IEEE80211_ADDR_LEN
];

235 
›“80211_node
 *
	mwds_ni
;

236 
u_št16_t
 
	mwds_agšgcouÁ
;

245 
	s›“80211_node_bË
 {

246 cÚ¡ *
	mÁ_Çme
;

247 
›“80211com
 *
	mÁ_ic
;

248 
›“80211_node_bË_lock_t
 
	mÁ_nod–ock
;

249 
TAILQ_HEAD
(, 
›“80211_node
è
	mÁ_node
;

250 
ATH_LIST_HEAD
(, 
›“80211_node
è
	mÁ_hash
[
IEEE80211_NODE_HASHSIZE
];

251 
ATH_LIST_HEAD
(, 
›“80211_wds_addr
è
	mÁ_wds_hash
[
IEEE80211_NODE_HASHSIZE
];

252 
›“80211_sÿn_lock_t
 
	mÁ_sÿÆock
;

253 
u_št
 
	mÁ_sÿng’
;

254 
	mÁ_šaù_š™
;

255 
tim”_li¡
 
	mÁ_wds_agšg_tim”
;

260 
›“80211_node
 *
›“80211_®loc_node_bË
(
›“80211v­
 *,

261 cÚ¡ 
u_št8_t
 *);

266 
›“80211_node
 *
›“80211_dup_bss
(
›“80211v­
 *,

267 cÚ¡ 
u_št8_t
 *, 
tmp
);

269 
›“80211_node_»£t
(
›“80211_node
 *, 
›“80211v­
 *);

272 
›“80211_node
 *
›“80211_fšd_node
(
›“80211_node_bË
 *,

273 cÚ¡ 
u_št8_t
 *);

274 
›“80211_node
 *
›“80211_fšd_rxnode
(
›“80211com
 *,

275 cÚ¡ 
›“80211_äame_mš
 *);

276 
›“80211_node
 *
›“80211_fšd_txnode
(
›“80211v­
 *,

277 cÚ¡ 
u_št8_t
 *);

279 
›“80211_ä“_node
(
›“80211_node
 *
ni
);

287 
›“80211_node
 *
›“80211_»f_node
(›“80211_nod*
ni
);

289 
	#PASS_NODE
(
_ni
) \

290 
	`›“80211_·ss_node
(&
_ni
)

	)

292 
__šlše
 
›“80211_node
 *

293 
	$›“80211_·ss_node
(
›“80211_node
 **
²i
) {

294 
›“80211_node
 *
tmp
 = *
²i
;

295 *
²i
 = 
NULL
;

296  (
tmp
);

297 
	}
}

299 
›“80211_uÄef_node
(
›“80211_node
 **
²i
);

302 
›“80211_add_wds_addr
(
›“80211_node_bË
 *, 
›“80211_node
 *,

303 cÚ¡ 
u_št8_t
 *, u_int8_t);

306 
›“80211_»move_wds_addr
(
›“80211_node_bË
 *, cÚ¡ 
u_št8_t
 *);

309 
›“80211_d–_wds_node
(
›“80211_node_bË
 *, 
›“80211_node
 *);

312 
›“80211_node
 *
›“80211_fšd_wds_node
(
›“80211_node_bË
 *,

313 cÚ¡ 
u_št8_t
 *);

314 
	t›“80211_™”_func
(*, 
	t›“80211_node
 *);

315 
›“80211_™”©e_nodes
(
›“80211_node_bË
 *,

316 
›“80211_™”_func
 *, *);

317 
›“80211_™”©e_dev_nodes
(
Ãt_deviû
 *,

318 
›“80211_node_bË
 *, 
›“80211_™”_func
 *, *);

319 
›“80211_dump_node
(
›“80211_node_bË
 *,

320 
›“80211_node
 *);

321 
›“80211_dump_nodes
(
›“80211_node_bË
 *);

323 
›“80211_node
 *
›“80211_çkeup_adhoc_node
(
›“80211v­
 *,

324 cÚ¡ 
u_št8_t
 
maÿddr
[]);

325 
	g›“80211_sÿÅ¬ams
;

327 
›“80211_node
 *
›“80211_add_ÃighbÜ
(
›“80211v­
 *,

328 cÚ¡ 
›“80211_äame
 *, cÚ¡ 
›“80211_sÿÅ¬ams
 *);

330 
›“80211_node_još
(
›“80211_node
 *, );

332 
›“80211_node_Ëave
(
›“80211_node
 *);

333 
u_št8_t
 
›“80211_g‘rssi
(
›“80211com
 *);

334 
št32_t
 
›“80211_g‘_node_couÁ
(
›“80211com
 *);

	@ieee80211_output.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/if_vÏn.h
>

50 
	~<lšux/.h
>

52 
	~"if_Îc.h
"

53 
	~"if_‘h”subr.h
"

54 
	~"if_medŸ.h
"

56 
	~<Ãt80211/›“80211_v¬.h
>

57 
	~<Ãt80211/›“80211_mÚ™Ü.h
>

58 
	~<Ãt80211/if_©h´Ùo.h
>

60 #ifdeà
IEEE80211_DEBUG


67 
__šlše
 

68 
	$dİršt
(
›“80211v­
 *
v­
, 
subty³
)

70 ià(
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_PROBE_RESP
)

71  (
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
);

73 
	}
}

83 
	$›“80211_şassify
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
)

85 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

86 
‘h”_h—d”
 *
eh
 = (‘h”_h—d” *)
skb
->
d©a
;

87 
v_wme_ac
 = 0, 
d_wme_ac
 = 0;

90 
skb
->
´iÜ™y
 = 
WME_AC_BE
;

92 ià(!(
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
))

99 ià(
ni
->
ni_vÏn
 !ğ0 && 
	`vÏn_tx_g_´e£Á
(
skb
)) {

100 
u_št32_t
 
g
=0;

101 
v_´i
;

103 ià(
v­
->
iv_vlg½
 =ğ
NULL
) {

104 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_novÏÁag
);

105 
ni
->
ni_¡©s
.
ns_tx_novÏÁag
++;

108 ià(((
g
 = 
	`vÏn_tx_g_g‘
(
skb
)è& 
VLAN_VID_MASK
) !=

109 (
ni
->
ni_vÏn
 & 
VLAN_VID_MASK
)) {

110 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_vÏnmism©ch
);

111 
ni
->
ni_¡©s
.
ns_tx_vÏnmism©ch
++;

114 ià(
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
) {

115 
v_´i
 = (
g
 >> 
VLAN_PRI_SHIFT
è& 
VLAN_PRI_MASK
;

116 
v_´i
) {

119 
v_wme_ac
 = 
WME_AC_BK
;

123 
v_wme_ac
 = 
WME_AC_BE
;

127 
v_wme_ac
 = 
WME_AC_VI
;

131 
v_wme_ac
 = 
WME_AC_VO
;

137 ià(
eh
->
‘h”_ty³
 =ğ
	`__cÚ¡ªt_htÚs
(
ETHERTYPE_IP
)) {

138 cÚ¡ 
hdr
 *

 = (iphdr *)

139 (
skb
->
d©a
 +  (
‘h”_h—d”
));

145 

->
tos
) {

148 
d_wme_ac
 = 
WME_AC_BK
;

152 
d_wme_ac
 = 
WME_AC_VI
;

158 
d_wme_ac
 = 
WME_AC_VO
;

161 
d_wme_ac
 = 
WME_AC_BE
;

165 
d_wme_ac
 = 
WME_AC_BE
;

167 
skb
->
´iÜ™y
 = 
d_wme_ac
;

168 ià(
v_wme_ac
 > 
d_wme_ac
)

169 
skb
->
´iÜ™y
 = 
v_wme_ac
;

172 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

173 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

175 
skb
->
´iÜ™y
 !ğ
WME_AC_BK
 &&

176 
ic
->
ic_wme
.
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
skb
->
´iÜ™y
].
wm•_acm
) {

177 
skb
->
´iÜ™y
) {

178 
WME_AC_BE
:

179 
skb
->
´iÜ™y
 = 
WME_AC_BK
;

181 
WME_AC_VI
:

182 
skb
->
´iÜ™y
 = 
WME_AC_BE
;

184 
WME_AC_VO
:

185 
skb
->
´iÜ™y
 = 
WME_AC_VI
;

188 
skb
->
´iÜ™y
 = 
WME_AC_BK
;

195 
	}
}

202 
	$›“80211_h¬d¡¬t
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
dev
)

204 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

205 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

206 
Ãt_deviû
 *
·»Á
 = 
ic
->
ic_dev
;

207 
›“80211_node
 *
ni
 = 
NULL
;

208 
‘h”_h—d”
 *
eh
;

212 
	`mem£t
(
	`SKB_CB
(
skb
), 0, (
›“80211_cb
));

216 
	`›“80211_skb_Œack
(
skb
);

219 ià((
·»Á
->
æags
 & (
IFF_RUNNING
|
IFF_UP
)) != (IFF_RUNNING|IFF_UP))

220 
bad
;

223 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
) {

224 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

226 
__func__
, 
v­
->
iv_¡©e
);

228 
v­
->
iv_¡©s
.
i¡_tx_disÿrd
++;

230 
bad
;

233 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
) {

234 
	`›“80211_mÚ™Ü_’ÿp
(
v­
, 
skb
);

235 
	`›“80211_·»Á_queue_xm™
(
skb
);

236  
NETDEV_TX_OK
;

240 
	`›“80211_ÿnûl_sÿn
(
v­
);

244 
eh
 = (
‘h”_h—d”
 *)
skb
->
d©a
;

245 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
)

246 
ni
 = 
	`›“80211_fšd_txnode
(
v­
, v­->
wds_mac
);

248 
ni
 = 
	`›“80211_fšd_txnode
(
v­
, 
eh
->
‘h”_dho¡
);

249 ià(
ni
 =ğ
NULL
) {

251 
bad
;

255 ià(
	`›“80211_şassify
(
ni
, 
skb
)) {

256 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_OUTPUT
, 
ni
,

257 "%s: disÿrd, cÏssifiÿtiÚ fau»", 
__func__
);

258 
bad
;

261 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
ni
);

264 ià(
	`WME_UAPSD_AC_CAN_TRIGGER
(
skb
->
´iÜ™y
, 
ni
)) {

267 
	`M_FLAG_SET
(
skb
, 
M_UAPSD
);

268 } ià((
ni
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
)) {

272 
	`›“80211_uÄef_node
(&
ni
);

273  
	`›“80211_pwr§ve
(
skb
);

276 
dev
->
Œªs_¡¬t
 = 
jiff›s
;

278 #ifdeà
ATH_SUPERG_XR


281 ià(
v­
->
iv_xrv­
 && (
ni
 =ğv­->
iv_bss
) &&

282 
v­
->
iv_xrv­
->
iv_¡a_assoc
) {

283 
sk_buff
 *
skb1
 = 
	`skb_cİy
(
skb
, 
GFP_ATOMIC
);

284 ià(
skb1
) {

285 
	`mem£t
(
	`SKB_CB
(
skb1
), 0, (
›“80211_cb
));

286 #ifdeà
IEEE80211_DEBUG_REFCNT


287 
	`M_FLAG_SET
(
skb1
, 
M_SKB_TRACKED
);

289 
	`SKB_NI
(
skb1
èğ
	`›“80211_fšd_txnode
(
v­
->
iv_xrv­
,

290 
eh
->
‘h”_dho¡
);

292 
	`›“80211_·»Á_queue_xm™
(
skb1
);

296 
	`›“80211_uÄef_node
(&
ni
);

297 
	`›“80211_·»Á_queue_xm™
(
skb
);

298  
NETDEV_TX_OK
;

300 
bad
:

301 ià(
skb
 !ğ
NULL
)

302 
	`›“80211_dev_kä“_skb
(&
skb
);

303 ià(
ni
 !ğ
NULL
)

304 
	`›“80211_uÄef_node
(&
ni
);

305  
NETDEV_TX_OK
;

306 
	}
}

311 
	$›“80211_·»Á_queue_xm™
(
sk_buff
 *
skb
) {

312 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
skb
->
dev
);

314 
v­
->
iv_dev¡©s
.
tx_·ck‘s
++;

315 
v­
->
iv_dev¡©s
.
tx_by‹s
 +ğ
skb
->
Ën
;

316 
v­
->
iv_ic
->
ic_Ï¡d©a
 = 
jiff›s
;

319 
skb
->
dev
 = 
v­
->
iv_ic
->
ic_dev
;

321 ià(
	`dev_queue_xm™
(
skb
è=ğ
NET_XMIT_DROP
)

322 
v­
->
iv_dev¡©s
.
tx_drİ³d
++;

323 
	}
}

332 
	$›“80211_£nd_£tup
(
›“80211v­
 *
v­
,

333 
›“80211_node
 *
ni
,

334 
›“80211_äame
 *
wh
,

335 
ty³
,

336 cÚ¡ 
u_št8_t
 
§
[
IEEE80211_ADDR_LEN
],

337 cÚ¡ 
u_št8_t
 
da
[
IEEE80211_ADDR_LEN
],

338 cÚ¡ 
u_št8_t
 
bssid
[
IEEE80211_ADDR_LEN
])

340 
	#WH4
(
wh
è((
›“80211_äame_addr4
 *)wh)

	)

342 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
ty³
;

343 ià((
ty³
 & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_DATA
) {

344 
v­
->
iv_İmode
) {

345 
IEEE80211_M_STA
:

346 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_TODS
;

347 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
bssid
);

348 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
§
);

349 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
da
);

351 
IEEE80211_M_IBSS
:

352 
IEEE80211_M_AHDEMO
:

353 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_NODS
;

354 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
da
);

355 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
§
);

356 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
bssid
);

358 
IEEE80211_M_HOSTAP
:

359 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_FROMDS
;

360 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
da
);

361 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
bssid
);

362 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
§
);

364 
IEEE80211_M_WDS
:

365 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_DSTODS
;

367 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
bssid
);

368 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

369 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
da
);

370 
	`IEEE80211_ADDR_COPY
(
	`WH4
(
wh
)->
i_addr4
, 
§
);

372 
IEEE80211_M_MONITOR
:

376 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_NODS
;

377 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
da
);

378 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
§
);

379 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
bssid
);

381 
wh
->
i_dur
 = 0;

383 *(
__Ë16
 *)&
wh
->
i_£q
[0] =

384 
	`htŞe16
(
ni
->
ni_tx£qs
[0] << 
IEEE80211_SEQ_SEQ_SHIFT
);

385 
ni
->
ni_tx£qs
[0]++;

386 #undeà
WH4


387 
	}
}

397 
	$›“80211_mgmt_ouut
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
, 
ty³
)

399 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

400 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

401 
›“80211_äame
 *
wh
;

403 
	`KASSERT
(
ni
 !ğ
NULL
, ("null‚ode"));

405 
	`SKB_NI
(
skb
èğ
ni
;

407 
wh
 = (
›“80211_äame
 *)

408 
	`skb_push
(
skb
, (
›“80211_äame
));

409 
	`›“80211_£nd_£tup
(
v­
, 
ni
, 
wh
,

410 
IEEE80211_FC0_TYPE_MGT
 | 
ty³
,

411 
v­
->
iv_myaddr
, 
ni
->
ni_maÿddr
, v­->
iv_bssid
);

414 ià((
	`SKB_CB
(
skb
)->
æags
 & 
M_LINK0
è!ğ0 && 
ni
->
ni_ch®Ënge
 !ğ
NULL
) {

415 
	`SKB_CB
(
skb
)->
æags
 &ğ~
M_LINK0
;

416 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_AUTH
, 
wh
->
i_addr1
,

417 "’üy±šg f¿m(%s)", 
__func__
);

418 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PROT
;

421 ià(
	`IEEE80211_VAP_IS_SLEEPING
(
ni
->
ni_v­
))

422 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PWR_MGT
;

424 #ifdeà
IEEE80211_DEBUG


426 ià((
	`›“80211_msg_debug
(
v­
è&& 
	`dİršt
(v­, 
ty³
)) ||

427 
	`›“80211_msg_dumµkts
(
v­
)) {

428 
	`´štk
(
KERN_DEBUG
 "[" 
MAC_FMT
 "] send %s on channel %u\n",

429 
	`MAC_ADDR
(
wh
->
i_addr1
),

430 
›“80211_mgt_subty³_Çme
[

431 (
ty³
 & 
IEEE80211_FC0_SUBTYPE_MASK
) >>

432 
IEEE80211_FC0_SUBTYPE_SHIFT
],

433 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
));

436 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_mgmt
);

438 (è
ic
->
	`ic_mgt¡¬t
(ic, 
skb
);

439 
	}
}

447 
	$›“80211_£nd_nuÎd©a
(
›“80211_node
 *
ni
)

449 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

450 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

451 
sk_buff
 *
skb
;

452 
›“80211_äame
 *
wh
;

453 
u_št8_t
 *
äm
;

455 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 0);

456 ià(
skb
 =ğ
NULL
) {

458 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

459 
	`›“80211_uÄef_node
(&
ni
);

460  -
ENOMEM
;

463 
wh
 = (
›“80211_äame
 *)

464 
	`skb_push
(
skb
, (
›“80211_äame
));

465 
	`›“80211_£nd_£tup
(
v­
, 
ni
, 
wh
,

466 
IEEE80211_FC0_TYPE_DATA
 | 
IEEE80211_FC0_SUBTYPE_NULL
,

467 
v­
->
iv_myaddr
, 
ni
->
ni_maÿddr
, v­->
iv_bssid
);

469 ià((
	`IEEE80211_VAP_IS_SLEEPING
(
ni
->
ni_v­
)) &&

470 
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
 &&

471 
v­
->
iv_İmode
 !ğ
IEEE80211_M_WDS
)

472 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PWR_MGT
;

474 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

476 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_DUMPPKTS
,

477 "[" 
MAC_FMT
 "] send‚ull data frame on channel %u,…wr mgt %s\n",

478 
	`MAC_ADDR
(
ni
->
ni_maÿddr
),

479 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
),

480 
wh
->
i_fc
[1] & 
IEEE80211_FC1_PWR_MGT
 ? "ena" : "dis");

483 
skb
->
´iÜ™y
 = 
WME_AC_BE
;

484 
	`SKB_NI
(
skb
èğ
	`PASS_NODE
(
ni
);

486 (è
ic
->
	`ic_mgt¡¬t
(ic, 
skb
);

489 
	}
}

496 
	$›“80211_£nd_qo¢uÎd©a
(
›“80211_node
 *
ni
, 
ac
)

498 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

499 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

500 
sk_buff
 *
skb
;

501 
›“80211_qosäame
 *
qwh
;

502 
u_št8_t
 *
äm
;

503 
tid
;

505 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 2);

506 ià(
skb
 =ğ
NULL
) {

508 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

509  -
ENOMEM
;

511 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
ni
);

513 
skb
->
´iÜ™y
 = 
ac
;

514 
qwh
 = (
›“80211_qosäame
 *)
	`skb_push
(
skb
, (ieee80211_qosframe));

516 
qwh
 = (
›“80211_qosäame
 *)
skb
->
d©a
;

518 
	`›“80211_£nd_£tup
(
v­
, 
ni
, (
›“80211_äame
 *)
qwh
,

519 
IEEE80211_FC0_TYPE_DATA
,

520 
v­
->
iv_myaddr
,

521 
ni
->
ni_maÿddr
,

522 
v­
->
iv_bssid
);

524 
qwh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_DATA
 |

525 
IEEE80211_FC0_SUBTYPE_QOS_NULL
;

527 ià(
	`IEEE80211_VAP_IS_SLEEPING
(
ni
->
ni_v­
))

528 
qwh
->
i_fc
[1] |ğ
IEEE80211_FC1_PWR_MGT
;

531 
tid
 = 
	`WME_AC_TO_TID
(
ac
);

532 
qwh
->
i_qos
[0] = 
tid
 & 
IEEE80211_QOS_TID
;

533 ià(
ic
->
ic_wme
.
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_nßckPŞicy
)

534 
qwh
->
i_qos
[0] |ğ(1 << 
IEEE80211_QOS_ACKPOLICY_S
è& 
IEEE80211_QOS_ACKPOLICY
;

535 
qwh
->
i_qos
[1] = 0;

537 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

539 ià(
	`WME_UAPSD_AC_CAN_TRIGGER
(
skb
->
´iÜ™y
, 
ni
)) {

542 
	`M_FLAG_SET
(
skb
, 
M_UAPSD
);

545 (è
ic
->
	`ic_mgt¡¬t
(ic, 
skb
);

548 
	}
}

549 
EXPORT_SYMBOL
(
›“80211_£nd_qo¢uÎd©a
);

559 
sk_buff
 *

560 
	$›“80211_skbhdr_adju¡
(
›“80211v­
 *
v­
, 
hdrsize
,

561 
›“80211_key
 *
key
, 
sk_buff
 *
skb
, 
ismuÉiÿ¡
)

564 
Ãed_h—droom
 = 
LLC_SNAPFRAMELEN
 + 
hdrsize
 + 
IEEE80211_ADDR_LEN
;

565 
Ãed_room
 = 0;

566 #ifdeà
ATH_SUPERG_FF


567 
isff
 = 
	`ATH_FF_MAGIC_PRESENT
(
skb
);

568 
š‹r_h—droom
 = (
‘h”_h—d”
è+ 
LLC_SNAPFRAMELEN
 + 
ATH_FF_MAX_HDR_PAD
;

569 
sk_buff
 *
skb2
 = 
NULL
;

571 ià(
isff
) {

572 
Ãed_h—droom
 +ğ(
©hl2p_tuÂ–_hdr
è+ 
ATH_FF_MAX_HDR_PAD
 +

573 
š‹r_h—droom
;

574 
skb2
 = 
skb
->
Ãxt
;

578 ià(
key
 !ğ
NULL
) {

579 cÚ¡ 
›“80211_ch”
 *
c
 = 
key
->
wk_ch”
;

589 
Ãed_h—droom
 +ğ
c
->
ic_h—d”
;

591 ià(
key
->
wk_æags
 & 
IEEE80211_KEY_SWCRYPT
)

592 
Ãed_room
 +ğ
c
->
ic_Œa”
;

597 ià(
skb
->
Ën
 > 
v­
->
iv_äagth»shŞd
 &&

598 !
ismuÉiÿ¡
 &&

599 
c
->
ic_ch”
 =ğ
IEEE80211_CIPHER_TKIP
)

600 
Ãed_room
 +ğ
c
->
ic_miş’
;

602 ià(
key
->
wk_æags
 & 
IEEE80211_KEY_SWMIC
)

603 
Ãed_room
 +ğ
c
->
ic_miş’
;

606 ià(
	`skb_sh¬ed
(
skb
)) {

608 
	`›“80211_»f_node
(
	`SKB_NI
(
skb
));

610 
skb
 = 
	`skb_unsh¬e
(skb, 
GFP_ATOMIC
);

613 #ifdeà
ATH_SUPERG_FF


614 ià(
isff
) {

615 ià(
skb
 =ğ
NULL
) {

616 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

618 
__func__
);

619 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

620 
	`›“80211_dev_kä“_skb
(&
skb2
);

622  
NULL
;

626 ià(
	`skb_h—droom
(
skb
è< 
Ãed_h—droom
) {

627 
sk_buff
 *
tmp
 = 
skb
;

628 
skb
 = 
	`skb_»®loc_h—droom
(skb, 
Ãed_h—droom
);

629 ià(
skb
 =ğ
NULL
) {

630 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

632 
__func__
);

633 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

634 
	`›“80211_dev_kä“_skb
(&
skb2
);

635  
NULL
;

637 
	`›“80211_skb_cİy_nod”ef
(
tmp
, 
skb
);

638 
	`›“80211_dev_kä“_skb
(&
tmp
);

644 ià(
	`skb_room
(
skb2
è< 
Ãed_room
) {

645 
n
 = 0;

646 ià(
š‹r_h—droom
 > 
	`skb_h—droom
(
skb2
))

647 
n
 = 
š‹r_h—droom
 - 
	`skb_h—droom
(
skb2
);

648 ià(
	`pskb_ex·nd_h—d
(
skb2
, 
n
,

649 
Ãed_room
 - 
	`skb_room
(
skb2
), 
GFP_ATOMIC
)) {

650 
	`›“80211_dev_kä“_skb
(&
skb2
);

651 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

653 
__func__
);

654 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

656 
	`›“80211_dev_kä“_skb
(&
skb
);

658 } ià(
	`skb_h—droom
(
skb2
è< 
š‹r_h—droom
) {

659 
sk_buff
 *
tmp
 = 
skb2
;

661 
skb2
 = 
	`skb_»®loc_h—droom
(skb2, 
š‹r_h—droom
);

662 ià(
skb2
 =ğ
NULL
) {

663 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

665 
__func__
);

666 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

668 
	`›“80211_dev_kä“_skb
(&
skb
);

669 
skb
 = 
NULL
;

671 
	`›“80211_skb_cİy_nod”ef
(
tmp
, 
skb
);

672 
	`›“80211_dev_kä“_skb
(&
tmp
);

674 ià(
skb
) {

675 
skb
->
Ãxt
 = 
skb2
;

677  
skb
;

680 ià(
skb
 =ğ
NULL
) {

681 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

682 "%s: cªnÙ unsh¬fÜƒnÿpsuÏtiÚ\n", 
__func__
);

683 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

684 } ià(
	`skb_room
(
skb
è< 
Ãed_room
) {

685 
n
 = 0;

686 ià(
Ãed_h—droom
 > 
	`skb_h—droom
(
skb
))

687 
n
 = 
Ãed_h—droom
 - 
	`skb_h—droom
(
skb
);

688 ià(
	`pskb_ex·nd_h—d
(
skb
, 
n
, 
Ãed_room
 -

689 
	`skb_room
(
skb
), 
GFP_ATOMIC
)) {

690 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

691 "%s: cªnÙƒx·nd stÜagÑa)\n", 
__func__
);

692 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

693 
	`›“80211_dev_kä“_skb
(&
skb
);

695 } ià(
	`skb_h—droom
(
skb
è< 
Ãed_h—droom
) {

696 
sk_buff
 *
tmp
 = 
skb
;

697 
skb
 = 
	`skb_»®loc_h—droom
(skb, 
Ãed_h—droom
);

699 ià(
skb
 =ğ
NULL
) {

700 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_OUTPUT
,

701 "%s: cªnÙƒx·nd stÜag(h—d)\n", 
__func__
);

702 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

704 
	`›“80211_skb_cİy_nod”ef
(
tmp
, 
skb
);

705 
	`›“80211_dev_kä“_skb
(&
tmp
);

708  
skb
;

709 
	}
}

711 
	#KEY_UNDEFINED
(
k
è((k).
wk_ch”
 =ğ&
›“80211_ch”_nÚe
)

	)

717 
__šlše
 
›“80211_key
 *

718 
	$›“80211_üy±o_g‘uÿ¡key
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
)

720 ià(
	`KEY_UNDEFINED
(
ni
->
ni_uÿ¡key
)) {

721 ià(
v­
->
iv_def_txkey
 =ğ
IEEE80211_KEYIX_NONE
 ||

722 
	`KEY_UNDEFINED
(
v­
->
iv_nw_keys
[v­->
iv_def_txkey
]))

723  
NULL
;

724  &
v­
->
iv_nw_keys
[v­->
iv_def_txkey
];

726  &
ni
->
ni_uÿ¡key
;

727 
	}
}

734 
__šlše
 
›“80211_key
 *

735 
	$›“80211_üy±o_g‘mÿ¡key
(
›“80211v­
 *
v­
, 
›“80211_node
 *
ni
)

737 ià(
v­
->
iv_def_txkey
 =ğ
IEEE80211_KEYIX_NONE
 ||

738 
	`KEY_UNDEFINED
(
v­
->
iv_nw_keys
[v­->
iv_def_txkey
]))

739  
NULL
;

740  &
v­
->
iv_nw_keys
[v­->
iv_def_txkey
];

741 
	}
}

752 
sk_buff
 *

753 
	$›“80211_’ÿp
(
›“80211_node
 *
ni
, 
sk_buff
 *
skb
, *
äameút
)

755 
	#WH4
(
wh
è((
›“80211_äame_addr4
 *)wh)

	)

756 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

757 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

758 
‘h”_h—d”
 
eh
;

759 
›“80211_äame
 *
wh
, *
twh
;

760 
›“80211_key
 *
key
;

761 
Îc
 *llc;

762 
hdrsize
, 
d©®’
, 
addqos
;

763 
hdrsize_nİad
;

764 
sk_buff
 *
äam–i¡
 = 
NULL
;

765 
sk_buff
 *
tskb
;

766 
äagút
 = 1;

767 
pdusize
 = 0;

768 
ismuÉiÿ¡
 = 0;

769 
u£4addr
 = 0;

770 #ifdeà
ATH_SUPERG_FF


771 
sk_buff
 *
skb2
 = 
NULL
;

772 
‘h”_h—d”
 
eh2
;

773 
isff
 = 
	`ATH_FF_MAGIC_PRESENT
(
skb
);

775 ià(
isff
) {

777 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

778 "%s: hªdlšg fa¡-äamskb (%p)\n", 
__func__
, 
skb
);

780 
skb2
 = 
skb
->
Ãxt
;

781 ià(
skb2
 =ğ
NULL
) {

782 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

783 "%s: fa¡-äam”rÜ, oÆy 1 skb\n", 
__func__
);

784 
bad
;

786 
	`memıy
(&
eh2
, 
skb2
->
d©a
, (
‘h”_h—d”
));

787 
	`skb_puÎ
(
skb2
, (
‘h”_h—d”
));

790 
	`memıy
(&
eh
, 
skb
->
d©a
, (
‘h”_h—d”
));

791 
	`skb_puÎ
(
skb
, (
‘h”_h—d”
));

805 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) {

806 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ||

807 !
	`IEEE80211_IS_MULTICAST
(
eh
.
‘h”_dho¡
))

808 
key
 = 
	`›“80211_üy±o_g‘uÿ¡key
(
v­
, 
ni
);

810 
key
 = 
	`›“80211_üy±o_g‘mÿ¡key
(
v­
, 
ni
);

811 ià((
key
 =ğ
NULL
è&& (
eh
.
‘h”_ty³
 !ğ
	`htÚs
(
ETHERTYPE_PAE
))) {

812 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_CRYPTO
,

813 
eh
.
‘h”_dho¡
,

815 
__func__
, 
v­
->
iv_def_txkey
);

816 
v­
->
iv_¡©s
.
is_tx_nodefkey
++;

817 
bad
;

820 
key
 = 
NULL
;

822 
addqos
 = (
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
) &&

823 (
eh
.
‘h”_ty³
 !ğ
	`htÚs
(
ETHERTYPE_PAE
));

824 ià(
addqos
)

825 
hdrsize
 = (
›“80211_qosäame
);

827 
hdrsize
 = (
›“80211_äame
);

829 
v­
->
iv_İmode
) {

830 
IEEE80211_M_IBSS
:

831 
IEEE80211_M_AHDEMO
:

832 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
eh
.
‘h”_dho¡
);

834 
IEEE80211_M_WDS
:

835 
u£4addr
 = 1;

836 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
ni
->
ni_maÿddr
);

838 
IEEE80211_M_HOSTAP
:

839 ià(!
	`IEEE80211_IS_MULTICAST
(
eh
.
‘h”_dho¡
) &&

840 !
	`IEEE80211_ADDR_EQ
(
eh
.
‘h”_dho¡
, 
ni
->
ni_maÿddr
)) {

841 
u£4addr
 = 1;

842 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
ni
->
ni_maÿddr
);

844 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
eh
.
‘h”_dho¡
);

846 
IEEE80211_M_STA
:

847 ià((
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_WDS
) &&

848 !
	`IEEE80211_ADDR_EQ
(
eh
.
‘h”_sho¡
, 
v­
->
iv_myaddr
)) {

849 
u£4addr
 = 1;

850 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
ni
->
ni_maÿddr
);

852 ià(
	`IEEE80211_IS_MULTICAST
(
eh
.
‘h”_dho¡
)) {

853 
›“80211_node_bË
 *
Á
 = &
ic
->
ic_¡a
;

854 
›“80211_node
 *
ni_wds


855 ğ
	`›“80211_fšd_wds_node
(
Á
, 
eh
.
‘h”_sho¡
);

856 ià(
ni_wds
)

857 
	`›“80211_uÄef_node
(&
ni_wds
);

859 
	`›“80211_add_wds_addr
(
Á
, 
ni
, 
eh
.
‘h”_sho¡
, 0);

862 
ismuÉiÿ¡
 = 
	`IEEE80211_IS_MULTICAST
(
v­
->
iv_bssid
);

868 ià(
u£4addr
)

869 
hdrsize
 +ğ
IEEE80211_ADDR_LEN
;

871 
hdrsize_nİad
 = 
hdrsize
;

872 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DATAPAD
)

873 
hdrsize
 = 
	`roundup
(hdrsize, (
u_št32_t
));

875 
skb
 = 
	`›“80211_skbhdr_adju¡
(
v­
, 
hdrsize
, 
key
, skb, 
ismuÉiÿ¡
);

876 ià(
skb
 =ğ
NULL
) {

878 
bad
;

881 #ifdeà
ATH_SUPERG_FF


882 ià(
isff
) {

883 
‘h”_h—d”
 *
eh_š‹r
;

884 
©hl2p_tuÂ–_hdr
 *
ffhdr
;

885 
u_št16_t
 
·ylßd
 = 
skb
->
Ën
 + 
LLC_SNAPFRAMELEN
;

886 
·dded_Ën
 = 
·ylßd
 + 
LLC_SNAPFRAMELEN
 + (
‘h”_h—d”
);

889 
skb2
 = 
skb
->
Ãxt
;

890 ià(
skb2
 =ğ
NULL
) {

891 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

893 
__func__
, 
skb
);

894 
bad
;

901 
Îc
 = (Îø*)
	`skb_push
(
skb
, 
LLC_SNAPFRAMELEN
);

902 
Îc
->
Îc_d§p
 =†lc->
Îc_s§p
 = 
LLC_SNAP_LSAP
;

903 
Îc
->
Îc_cÚŒŞ
 = 
LLC_UI
;

904 
Îc
->
Îc_¢­
.
Üg_code
[0] = 0;

905 
Îc
->
Îc_¢­
.
Üg_code
[1] = 0;

906 
Îc
->
Îc_¢­
.
Üg_code
[2] = 0;

907 
Îc
->
Îc_¢­
.
‘h”_ty³
 = 
eh
.ether_type;

909 
eh_š‹r
 = (
‘h”_h—d”
 *)
	`skb_push
(
skb
, (ether_header));

910 
	`memıy
(
eh_š‹r
, &
eh
, (
‘h”_h—d”
è- ƒh.
‘h”_ty³
);

911 
eh_š‹r
->
‘h”_ty³
 = 
	`htÚs
(
·ylßd
);

917 
ffhdr
 = (
©hl2p_tuÂ–_hdr
 *)
	`skb_push
(
skb
, (athl2p_tunnel_hdr) + 2);

918 
	`mem£t
(
ffhdr
, 0, (
©hl2p_tuÂ–_hdr
) + 2);

924 
·ylßd
 = 
skb2
->
Ën
 + 
LLC_SNAPFRAMELEN
;

926 
Îc
 = (Îø*)
	`skb_push
(
skb2
, 
LLC_SNAPFRAMELEN
);

927 ià(
Îc
 =ğ
NULL
) {

928 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

930 
__func__
, 
skb
);

931  
NULL
;

933 
Îc
->
Îc_d§p
 =†lc->
Îc_s§p
 = 
LLC_SNAP_LSAP
;

934 
Îc
->
Îc_cÚŒŞ
 = 
LLC_UI
;

935 
Îc
->
Îc_¢­
.
Üg_code
[0] = 0;

936 
Îc
->
Îc_¢­
.
Üg_code
[1] = 0;

937 
Îc
->
Îc_¢­
.
Üg_code
[2] = 0;

938 
Îc
->
Îc_¢­
.
‘h”_ty³
 = 
eh2
.ether_type;

940 
eh_š‹r
 = (
‘h”_h—d”
 *)
	`skb_push
(
skb2
, (ether_header));

941 ià(
eh_š‹r
 =ğ
NULL
) {

942 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

944 
__func__
, 
skb
);

945  
NULL
;

948 
	`memıy
(
eh_š‹r
, &
eh2
, (
‘h”_h—d”
è- ƒh2.
‘h”_ty³
);

949 
eh_š‹r
->
‘h”_ty³
 = 
	`htÚs
(
·ylßd
);

952 
	`skb_push
(
skb2
, 
	`roundup
(
·dded_Ën
, 4) -…added_len);

956 
Îc
 = (Îø*)
	`skb_push
(
skb
, 
LLC_SNAPFRAMELEN
);

957 
Îc
->
Îc_d§p
 =†lc->
Îc_s§p
 = 
LLC_SNAP_LSAP
;

958 
Îc
->
Îc_cÚŒŞ
 = 
LLC_UI
;

959 #iâdeà
ATH_SUPERG_FF


960 
Îc
->
Îc_¢­
.
Üg_code
[0] = 0;

961 
Îc
->
Îc_¢­
.
Üg_code
[1] = 0;

962 
Îc
->
Îc_¢­
.
Üg_code
[2] = 0;

963 
Îc
->
Îc_¢­
.
‘h”_ty³
 = 
eh
.ether_type;

965 ià(
isff
) {

966 
Îc
->
Îc_¢­
.
Üg_code
[0] = 
ATH_SNAP_ORGCODE_0
;

967 
Îc
->
Îc_¢­
.
Üg_code
[1] = 
ATH_SNAP_ORGCODE_1
;

968 
Îc
->
Îc_¢­
.
Üg_code
[2] = 
ATH_SNAP_ORGCODE_2
;

969 
Îc
->
Îc_¢­
.
‘h”_ty³
 = 
	`htÚs
(
ATH_ETH_TYPE
);

971 
Îc
->
Îc_¢­
.
Üg_code
[0] = 0;

972 
Îc
->
Îc_¢­
.
Üg_code
[1] = 0;

973 
Îc
->
Îc_¢­
.
Üg_code
[2] = 0;

974 
Îc
->
Îc_¢­
.
‘h”_ty³
 = 
eh
.ether_type;

977 
d©®’
 = 
skb
->
Ën
;

979 
wh
 = (
›“80211_äame
 *)
	`skb_push
(
skb
, 
hdrsize
);

980 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_DATA
;

981 
wh
->
i_dur
 = 0;

982 ià(
u£4addr
) {

983 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_DSTODS
;

984 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
ni
->
ni_maÿddr
);

985 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

986 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
eh
.
‘h”_dho¡
);

987 
	`IEEE80211_ADDR_COPY
(
	`WH4
(
wh
)->
i_addr4
, 
eh
.
‘h”_sho¡
);

989 
v­
->
iv_İmode
) {

990 
IEEE80211_M_IBSS
:

991 
IEEE80211_M_AHDEMO
:

992 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_NODS
;

993 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
eh
.
‘h”_dho¡
);

994 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
eh
.
‘h”_sho¡
);

999 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
v­
->
iv_bssid
);

1001 
IEEE80211_M_STA
:

1002 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_TODS
;

1003 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
v­
->
iv_bssid
);

1004 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
eh
.
‘h”_sho¡
);

1005 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
eh
.
‘h”_dho¡
);

1007 
IEEE80211_M_HOSTAP
:

1008 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_FROMDS
;

1009 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
eh
.
‘h”_dho¡
);

1010 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_bssid
);

1011 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
eh
.
‘h”_sho¡
);

1012 ià(
	`M_PWR_SAV_GET
(
skb
)) {

1013 ià(
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
)) {

1014 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_MORE_DATA
;

1015 
	`M_PWR_SAV_CLR
(
skb
);

1019 
IEEE80211_M_WDS
:

1020 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_DSTODS
;

1021 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
ni
->
ni_maÿddr
);

1022 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

1023 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
eh
.
‘h”_dho¡
);

1024 
	`IEEE80211_ADDR_COPY
(
	`WH4
(
wh
)->
i_addr4
, 
eh
.
‘h”_sho¡
);

1026 
IEEE80211_M_MONITOR
:

1027 
bad
;

1030 ià(
	`IEEE80211_VAP_IS_SLEEPING
(
v­
))

1031 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PWR_MGT
;

1032 ià(
addqos
) {

1033 
›“80211_qosäame
 *
qwh
 =

1034 (
›“80211_qosäame
 *)
wh
;

1035 
u_št8_t
 *
qos
;

1036 
tid
;

1038 
qos
 = &
qwh
->
i_qos
[0];

1039 ià(
u£4addr
)

1040 
qos
 +ğ
IEEE80211_ADDR_LEN
;

1042 
tid
 = 
	`WME_AC_TO_TID
(
skb
->
´iÜ™y
);

1043 
qos
[0] = 
tid
 & 
IEEE80211_QOS_TID
;

1044 ià(
ic
->
ic_wme
.
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
skb
->
´iÜ™y
].
wm•_nßckPŞicy
)

1045 
qos
[0] |ğ(1 << 
IEEE80211_QOS_ACKPOLICY_S
è& 
IEEE80211_QOS_ACKPOLICY
;

1046 
qos
[1] = 0;

1047 
qwh
->
i_fc
[0] |ğ
IEEE80211_FC0_SUBTYPE_QOS
;

1049 *(
__Ë16
 *)&
wh
->
i_£q
[0] =

1050 
	`htŞe16
(
ni
->
ni_tx£qs
[
tid
] << 
IEEE80211_SEQ_SEQ_SHIFT
);

1051 
ni
->
ni_tx£qs
[
tid
]++;

1053 *(
__Ë16
 *)
wh
->
i_£q
 =

1054 
	`htŞe16
(
ni
->
ni_tx£qs
[0] << 
IEEE80211_SEQ_SEQ_SHIFT
);

1055 
ni
->
ni_tx£qs
[0]++;

1059 ià(
skb
->
Ën
 > 
v­
->
iv_äagth»shŞd
 &&

1060 !
	`IEEE80211_IS_MULTICAST
(
wh
->
i_addr1
)) {

1061 
pk’
, 
skbút
, 
size
, 
chdrsize
;

1062 
›“80211_ch”
 *
c
;

1064 
pk’
 = 
skb
->
Ën
;

1065 
chdrsize
 = 0;

1066 
size
 = 
IEEE80211_CRC_LEN
;

1068 ià(
key
 !ğ
NULL
) {

1069 
c
 = (
›“80211_ch”
 *)
key
->
wk_ch”
;

1070 
chdrsize
 = 
c
->
ic_h—d”
;

1071 
size
 +ğ(
c
->
ic_Œa”
 + c->
ic_miş’
);

1074 ià(
c
->
ic_ch”
 =ğ
IEEE80211_CIPHER_TKIP
)

1075 
pk’
 +ğ
IEEE80211_WEP_MICLEN
;

1078 
pdusize
 = 
v­
->
iv_äagth»shŞd
 - (
hdrsize_nİad
 + 
chdrsize
);

1079 
äagút
 = *
äameút
 =

1080 ((
pk’
 - 
hdrsize_nİad
è/ 
pdusize
) +

1081 (((
pk’
 - 
hdrsize_nİad
è% 
pdusize
 == 0) ? 0 : 1);

1087 
skbút
 = 1; skbúˆ< 
äagút
; skbcnt++) {

1088 
tskb
 = 
	`›“80211_dev_®loc_skb
(
hdrsize
 + 
chdrsize
 + 
pdusize
 + 
size
);

1089 ià(
tskb
 =ğ
NULL
)

1092 
tskb
->
Ãxt
 = 
äam–i¡
;

1093 
äam–i¡
 = 
tskb
;

1096 ià(
skbút
 !ğ
äagút
)

1097 
bad
;

1100 *
äameút
 = 
äagút
;

1102 ià(
key
 !ğ
NULL
) {

1107 ià(
eh
.
‘h”_ty³
 !ğ
	`__cÚ¡ªt_htÚs
(
ETHERTYPE_PAE
) ||

1108 ((
v­
->
iv_æags
 & 
IEEE80211_F_WPA
) &&

1109 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ?

1110 !
	`KEY_UNDEFINED
(*
key
è: !KEY_UNDEFINED(
ni
->
ni_uÿ¡key
)))) {

1111 
fÜû_swmic
 = (
äagút
 > 1) ? 1 : 0;

1113 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PROT
;

1115 ià(!
	`›“80211_üy±o_’mic
(
v­
, 
key
, 
skb
, 
fÜû_swmic
)) {

1116 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_OUTPUT
,

1117 
eh
.
‘h”_dho¡
,

1119 
v­
->
iv_¡©s
.
is_üy±o_’micç
++;

1120 
bad
;

1125 ià(
äagút
 > 1) {

1126 
äagnum
, 
off£t
, 
pduËn
;

1127 *
pdu
;

1129 
äagnum
 = 0;

1130 
wh
 = 
twh
 = (
›“80211_äame
 *)
skb
->
d©a
;

1135 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_MORE_FRAG
;

1137 *(
__Ë16
 *)&
wh
->
i_£q
[0] |=

1138 
	`htŞe16
((
äagnum
 & 
IEEE80211_SEQ_FRAG_MASK
) <<

1139 
IEEE80211_SEQ_FRAG_SHIFT
);

1140 
äagnum
++;

1142 
off£t
 = 
hdrsize
 + 
pdusize
;

1143 
d©®’
 = (
skb
->
Ën
 - 
hdrsize
è- 
pdusize
;

1145 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

1146 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
tx_by‹s
, 
pdusize
);

1148 
tskb
 = 
äam–i¡
;skb !ğ
NULL
;skb =skb->
Ãxt
) {

1152 
twh
 = (
›“80211_äame
 *)
	`skb_put
(
tskb
, 
hdrsize
);

1153 
	`memıy
((*)
twh
, (*)
wh
, 
hdrsize
);

1155 *(
__Ë16
 *)&
twh
->
i_£q
[0] |=

1156 
	`htŞe16
((
äagnum
 & 
IEEE80211_SEQ_FRAG_MASK
) <<

1157 
IEEE80211_SEQ_FRAG_SHIFT
);

1158 
äagnum
++;

1160 ià(
pdusize
 <ğ
d©®’
)

1161 
pduËn
 = 
pdusize
;

1163 
pduËn
 = 
d©®’
;

1172 
pdu
 = 
	`skb_put
(
tskb
, 
pduËn
);

1173 
	`memıy
(
pdu
, (*)
skb
->
d©a
 + 
off£t
, 
pduËn
);

1175 
off£t
 +ğ
pdusize
;

1176 
d©®’
 -ğ
pdusize
;

1178 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

1179 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
tx_by‹s
, 
pduËn
);

1182 
twh
->
i_fc
[1] &ğ~
IEEE80211_FC1_MORE_FRAG
;

1183 
	`skb_Œim
(
skb
, 
hdrsize
 + 
pdusize
);

1184 
skb
->
Ãxt
 = 
äam–i¡
;

1186 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

1187 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
tx_by‹s
, 
d©®’
);

1189 #ifdeà
ATH_SUPERG_FF


1191 ià(
skb
->
Ãxt
) {

1192 
d©®’
 = 
skb
->
Ãxt
->
Ën
;

1193 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d©a
);

1194 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
tx_by‹s
, 
d©®’
);

1199  
skb
;

1200 
bad
:

1201 ià(
äam–i¡
 !ğ
NULL
) {

1202 
	`›“80211_dev_kä“_skb_li¡
(&
äam–i¡
);

1205 ià(
skb
 !ğ
NULL
) {

1206 
	`›“80211_dev_kä“_skb_li¡
(&
skb
);

1208  
NULL
;

1209 #undeà
WH4


1210 
	}
}

1211 
EXPORT_SYMBOL
(
›“80211_’ÿp
);

1212 #undeà
KEY_UNDEFINED


1217 
u_št8_t
 *

1218 
	$›“80211_add_¿‹s
(
u_št8_t
 *
äm
, cÚ¡ 
›“80211_¿‹£t
 *
rs
)

1220 
Ä©es
;

1222 *
äm
++ = 
IEEE80211_ELEMID_RATES
;

1223 
Ä©es
 = 
rs
->
rs_Ä©es
;

1224 ià(
Ä©es
 > 
IEEE80211_RATE_SIZE
)

1225 
Ä©es
 = 
IEEE80211_RATE_SIZE
;

1226 *
äm
++ = 
Ä©es
;

1227 
	`memıy
(
äm
, 
rs
->
rs_¿‹s
, 
Ä©es
);

1228  
äm
 + 
Ä©es
;

1229 
	}
}

1234 
u_št8_t
 *

1235 
	$›“80211_add_x¿‹s
(
u_št8_t
 *
äm
, cÚ¡ 
›“80211_¿‹£t
 *
rs
)

1240 ià(
rs
->
rs_Ä©es
 > 
IEEE80211_RATE_SIZE
) {

1241 
Ä©es
 = 
rs
->
rs_Ä©es
 - 
IEEE80211_RATE_SIZE
;

1242 *
äm
++ = 
IEEE80211_ELEMID_XRATES
;

1243 *
äm
++ = 
Ä©es
;

1244 
	`memıy
(
äm
, 
rs
->
rs_¿‹s
 + 
IEEE80211_RATE_SIZE
, 
Ä©es
);

1245 
äm
 +ğ
Ä©es
;

1247  
äm
;

1248 
	}
}

1253 
u_št8_t
 *

1254 
	$›“80211_add_ssid
(
u_št8_t
 *
äm
, cÚ¡ u_št8_ˆ*
ssid
, 
u_št
 
Ën
)

1256 *
äm
++ = 
IEEE80211_ELEMID_SSID
;

1257 *
äm
++ = 
Ën
;

1258 
	`memıy
(
äm
, 
ssid
, 
Ën
);

1259  
äm
 + 
Ën
;

1260 
	}
}

1265 
u_št8_t
 *

1266 
	$›“80211_add_”p
(
u_št8_t
 *
äm
, 
›“80211com
 *
ic
)

1268 
u_št8_t
 
”p
;

1270 *
äm
++ = 
IEEE80211_ELEMID_ERP
;

1271 *
äm
++ = 1;

1272 
”p
 = 0;

1273 ià(
ic
->
ic_nÚ”p¡a
 != 0)

1274 
”p
 |ğ
IEEE80211_ERP_NON_ERP_PRESENT
;

1275 ià(
ic
->
ic_æags
 & 
IEEE80211_F_USEPROT
)

1276 
”p
 |ğ
IEEE80211_ERP_USE_PROTECTION
;

1277 ià((
ic
->
ic_æags
 & 
IEEE80211_F_USEBARKER
è|| (ic->
ic_nÚ”p¡a
 > 0))

1278 
”p
 |ğ
IEEE80211_ERP_LONG_PREAMBLE
;

1279 *
äm
++ = 
”p
;

1280  
äm
;

1281 
	}
}

1286 
u_št8_t
 *

1287 
	$›“80211_add_couÁry
(
u_št8_t
 *
äm
, 
›“80211com
 *
ic
)

1290 
	`memıy
(
äm
, (
u_št8_t
 *)&
ic
->
ic_couÁry_›
,

1291 
ic
->
ic_couÁry_›
.
couÁry_Ën
 + 2);

1292 
äm
 +ğ
ic
->
ic_couÁry_›
.
couÁry_Ën
 + 2;

1293  
äm
;

1294 
	}
}

1299 
u_št8_t
 *

1300 
	$›“80211_add_pwrú¡r
(
u_št8_t
 *
äm
, 
›“80211com
 *
ic
)

1302 
›“80211_›_pwrú¡r
 *
›
 =

1303 (
›“80211_›_pwrú¡r
 *)
äm
;

1304 
›
->
pc_id
 = 
IEEE80211_ELEMID_PWRCNSTR
;

1305 
›
->
pc_Ën
 = 1;

1306 
›
->
pc_Íc
 = 
	`IEEE80211_PWRCONSTRAINT_VAL
(
ic
);

1307 
äm
 +ğ(*
›
);

1308  
äm
;

1309 
	}
}

1314 
u_št8_t
 *

1315 
	$›“80211_add_pwrÿp
(
u_št8_t
 *
äm
, 
›“80211com
 *
ic
)

1317 
›“80211_›_pwrÿp
 *
›
 =

1318 (
›“80211_›_pwrÿp
 *)
äm
;

1319 
›
->
pc_id
 = 
IEEE80211_ELEMID_PWRCAP
;

1320 
›
->
pc_Ën
 = 2;

1321 
›
->
pc_mštxpow
 = 
ic
->
ic_bsschª
->
ic_mšpow”
;

1322 
›
->
pc_maxtxpow
 = 
ic
->
ic_bsschª
->
ic_maxpow”
;

1323 
äm
 +ğ(*
›
);

1324  
äm
;

1325 
	}
}

1330 
u_št8_t
 *

1331 
	$›“80211_add_suµchª
(
u_št8_t
 *
äm
, 
›“80211com
 *
ic
)

1333 
	`memıy
(
äm
, (
u_št8_t
 *)&
ic
->
ic_sc_›
,

1334 
ic
->
ic_sc_›
.
sc_Ën
 + 2);

1335 
äm
 +ğ
ic
->
ic_sc_›
.
sc_Ën
 + 2;

1336  
äm
;

1337 
	}
}

1339 
u_št8_t
 *

1340 
	$›“80211_£tup_w·_›
(
›“80211v­
 *
v­
, 
u_št8_t
 *
›
)

1342 
	#WPA_OUI_BYTES
 0x00, 0x50, 0xf2

	)

1343 
	#ADDSHORT
(
äm
, 
v
) do { \

1344 
äm
[0] = (
v
) & 0xff; \

1345 
äm
[1] = (
v
) >> 8; \

1346 
äm
 += 2; \

1347 } 0)

	)

1348 
	#ADDSELECTOR
(
äm
, 
£l
) do { \

1349 
	`memıy
(
äm
, 
£l
, 4); \

1350 
äm
 += 4; \

1351 } 0)

	)

1352 cÚ¡ 
u_št8_t
 
oui
[4] = { 
WPA_OUI_BYTES
, 
WPA_OUI_TYPE
 };

1353 cÚ¡ 
u_št8_t
 
ch”_su™e
[][4] = {

1354 { 
WPA_OUI_BYTES
, 
WPA_CSE_WEP40
 },

1355 { 
WPA_OUI_BYTES
, 
WPA_CSE_TKIP
 },

1357 { 
WPA_OUI_BYTES
, 
WPA_CSE_CCMP
 },

1359 { 
WPA_OUI_BYTES
, 
WPA_CSE_NULL
 },

1361 cÚ¡ 
u_št8_t
 
w•104_su™e
[4] =

1362 { 
WPA_OUI_BYTES
, 
WPA_CSE_WEP104
 };

1363 cÚ¡ 
u_št8_t
 
key_mgt_un¥ec
[4] =

1364 { 
WPA_OUI_BYTES
, 
WPA_ASE_8021X_UNSPEC
 };

1365 cÚ¡ 
u_št8_t
 
key_mgt_psk
[4] =

1366 { 
WPA_OUI_BYTES
, 
WPA_ASE_8021X_PSK
 };

1367 cÚ¡ 
›“80211_r¢·rms
 *
r¢
 = &
v­
->
iv_bss
->
ni_r¢
;

1368 
u_št8_t
 *
äm
 = 
›
;

1369 
u_št8_t
 *
£lút
;

1371 *
äm
++ = 
IEEE80211_ELEMID_VENDOR
;

1372 *
äm
++ = 0;

1373 
	`memıy
(
äm
, 
oui
, (oui));

1374 
äm
 +ğ(
oui
);

1375 
	`ADDSHORT
(
äm
, 
WPA_VERSION
);

1380 ià(
r¢
->
r¢_mÿ¡ch”
 =ğ
IEEE80211_CIPHER_WEP
 &&

1381 
r¢
->
r¢_mÿ¡keyËn
 >= 13)

1382 
	`ADDSELECTOR
(
äm
, 
w•104_su™e
);

1384 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
r¢
->
r¢_mÿ¡ch”
]);

1387 
£lút
 = 
äm
;

1388 
	`ADDSHORT
(
äm
, 0);

1389 ià(
r¢
->
r¢_uÿ¡ch”£t
 & (1 << 
IEEE80211_CIPHER_AES_CCM
)) {

1390 
£lút
[0]++;

1391 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
IEEE80211_CIPHER_AES_CCM
]);

1393 ià(
r¢
->
r¢_uÿ¡ch”£t
 & (1 << 
IEEE80211_CIPHER_TKIP
)) {

1394 
£lút
[0]++;

1395 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
IEEE80211_CIPHER_TKIP
]);

1399 
£lút
 = 
äm
;

1400 
	`ADDSHORT
(
äm
, 0);

1401 ià(
r¢
->
r¢_keymgmt£t
 & 
WPA_ASE_8021X_UNSPEC
) {

1402 
£lút
[0]++;

1403 
	`ADDSELECTOR
(
äm
, 
key_mgt_un¥ec
);

1405 ià(
r¢
->
r¢_keymgmt£t
 & 
WPA_ASE_8021X_PSK
) {

1406 
£lút
[0]++;

1407 
	`ADDSELECTOR
(
äm
, 
key_mgt_psk
);

1411 ià((
r¢
->
r¢_ÿps
 !ğ0è&& (r¢->r¢_ÿp !ğ
RSN_CAP_PREAUTH
))

1412 
	`ADDSHORT
(
äm
, 
r¢
->
r¢_ÿps
);

1415 
›
[1] = 
äm
 - ie - 2;

1416 
	`KASSERT
(
›
[1] + 2 <ğ(
›“80211_›_w·
),

1418 
›
[1] + 2, ()(
›“80211_›_w·
)));

1419  
äm
;

1420 #undeà
ADDSHORT


1421 #undeà
ADDSELECTOR


1422 #undeà
WPA_OUI_BYTES


1423 
	}
}

1425 
u_št8_t
 *

1426 
	$›“80211_£tup_r¢_›
(
›“80211v­
 *
v­
, 
u_št8_t
 *
›
)

1428 
	#RSN_OUI_BYTES
 0x00, 0x0f, 0xac

	)

1429 
	#ADDSHORT
(
äm
, 
v
) do { \

1430 
äm
[0] = (
v
) & 0xff; \

1431 
äm
[1] = (
v
) >> 8; \

1432 
äm
 += 2; \

1433 } 0)

	)

1434 
	#ADDSELECTOR
(
äm
, 
£l
) do { \

1435 
	`memıy
(
äm
, 
£l
, 4); \

1436 
äm
 += 4; \

1437 } 0)

	)

1438 cÚ¡ 
u_št8_t
 
ch”_su™e
[][4] = {

1439 { 
RSN_OUI_BYTES
, 
RSN_CSE_WEP40
 },

1440 { 
RSN_OUI_BYTES
, 
RSN_CSE_TKIP
 },

1441 { 
RSN_OUI_BYTES
, 
RSN_CSE_WRAP
 },

1442 { 
RSN_OUI_BYTES
, 
RSN_CSE_CCMP
 },

1444 { 
RSN_OUI_BYTES
, 
RSN_CSE_NULL
 },

1446 cÚ¡ 
u_št8_t
 
w•104_su™e
[4] =

1447 { 
RSN_OUI_BYTES
, 
RSN_CSE_WEP104
 };

1448 cÚ¡ 
u_št8_t
 
key_mgt_un¥ec
[4] =

1449 { 
RSN_OUI_BYTES
, 
RSN_ASE_8021X_UNSPEC
 };

1450 cÚ¡ 
u_št8_t
 
key_mgt_psk
[4] =

1451 { 
RSN_OUI_BYTES
, 
RSN_ASE_8021X_PSK
 };

1452 cÚ¡ 
›“80211_r¢·rms
 *
r¢
 = &
v­
->
iv_bss
->
ni_r¢
;

1453 
u_št8_t
 *
äm
 = 
›
;

1454 
u_št8_t
 *
£lút
;

1456 *
äm
++ = 
IEEE80211_ELEMID_RSN
;

1457 *
äm
++ = 0;

1458 
	`ADDSHORT
(
äm
, 
RSN_VERSION
);

1463 ià(
r¢
->
r¢_mÿ¡ch”
 =ğ
IEEE80211_CIPHER_WEP
 &&

1464 
r¢
->
r¢_mÿ¡keyËn
 >= 13)

1465 
	`ADDSELECTOR
(
äm
, 
w•104_su™e
);

1467 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
r¢
->
r¢_mÿ¡ch”
]);

1470 
£lút
 = 
äm
;

1471 
	`ADDSHORT
(
äm
, 0);

1472 ià(
r¢
->
r¢_uÿ¡ch”£t
 & (1 << 
IEEE80211_CIPHER_AES_CCM
)) {

1473 
£lút
[0]++;

1474 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
IEEE80211_CIPHER_AES_CCM
]);

1476 ià(
r¢
->
r¢_uÿ¡ch”£t
 & (1 << 
IEEE80211_CIPHER_TKIP
)) {

1477 
£lút
[0]++;

1478 
	`ADDSELECTOR
(
äm
, 
ch”_su™e
[
IEEE80211_CIPHER_TKIP
]);

1482 
£lút
 = 
äm
;

1483 
	`ADDSHORT
(
äm
, 0);

1484 ià(
r¢
->
r¢_keymgmt£t
 & 
WPA_ASE_8021X_UNSPEC
) {

1485 
£lút
[0]++;

1486 
	`ADDSELECTOR
(
äm
, 
key_mgt_un¥ec
);

1488 ià(
r¢
->
r¢_keymgmt£t
 & 
WPA_ASE_8021X_PSK
) {

1489 
£lút
[0]++;

1490 
	`ADDSELECTOR
(
äm
, 
key_mgt_psk
);

1494 
	`ADDSHORT
(
äm
, 
r¢
->
r¢_ÿps
);

1498 
›
[1] = 
äm
 - ie - 2;

1499 
	`KASSERT
(
›
[1] + 2 <ğ(
›“80211_›_w·
),

1501 
›
[1] + 2, ()(
›“80211_›_w·
)));

1502  
äm
;

1503 #undeà
ADDSELECTOR


1504 #undeà
ADDSHORT


1505 #undeà
RSN_OUI_BYTES


1506 
	}
}

1511 
u_št8_t
 *

1512 
	$›“80211_add_w·
(
u_št8_t
 *
äm
, 
›“80211v­
 *
v­
)

1515 
	`KASSERT
(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
, ("no WPA/RSN!"));

1516 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA2
)

1517 
äm
 = 
	`›“80211_£tup_r¢_›
(
v­
, frm);

1518 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA1
)

1519 
äm
 = 
	`›“80211_£tup_w·_›
(
v­
, frm);

1520  
äm
;

1521 
	}
}

1523 
	#WME_OUI_BYTES
 0x00, 0x50, 0xf2

	)

1527 
u_št8_t
 *

1528 
	$›“80211_add_wme
(
u_št8_t
 *
äm
, 
›“80211_node
 *
ni
)

1530 cÚ¡ 
u_št8_t
 
oui
[4] = { 
WME_OUI_BYTES
, 
WME_OUI_TYPE
 };

1531 
›“80211_›_wme
 *
›
 = (›“80211_›_wm*)
äm
;

1532 
›“80211_wme_¡©e
 *
wme
 = &
ni
->
ni_ic
->
ic_wme
;

1533 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1535 *
äm
++ = 
IEEE80211_ELEMID_VENDOR
;

1536 *
äm
++ = 0;

1537 
	`memıy
(
äm
, 
oui
, (oui));

1538 
äm
 +ğ(
oui
);

1539 *
äm
++ = 
WME_INFO_OUI_SUBTYPE
;

1540 *
äm
++ = 
WME_VERSION
;

1542 
v­
->
iv_İmode
) {

1543 
IEEE80211_M_HOSTAP
:

1544 *
äm
 = 
wme
->
wme_bssChªP¬ams
.
ÿp_šfo_couÁ
;

1545 ià(
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
))

1546 *
äm
 |ğ
WME_CAPINFO_UAPSD_EN
;

1547 
äm
++;

1549 
IEEE80211_M_STA
:

1550 *
äm
++ = 
v­
->
iv_u­sdšfo
;

1553 *
äm
++ = 0;

1556 
›
->
wme_Ën
 = 
äm
 - &›->
wme_oui
[0];

1558  
äm
;

1559 
	}
}

1564 
u_št8_t
 *

1565 
	$›“80211_add_wme_·¿m
(
u_št8_t
 *
äm
, 
›“80211_wme_¡©e
 *
wme
,

1566 
u­sd_’abË
)

1568 
	#SM
(
_v
, 
_f
è(((_vè<< _f##
_S
è& _f)

	)

1569 
	#ADDSHORT
(
äm
, 
v
) do { \

1570 
äm
[0] = (
v
) & 0xff; \

1571 
äm
[1] = (
v
) >> 8; \

1572 
äm
 += 2; \

1573 } 0)

	)

1574 cÚ¡ 
u_št8_t
 
oui
[4] = { 
WME_OUI_BYTES
, 
WME_OUI_TYPE
 };

1575 
›“80211_wme_·¿m
 *
›
 = (›“80211_wme_·¿m *)
äm
;

1576 
i
;

1578 *
äm
++ = 
IEEE80211_ELEMID_VENDOR
;

1579 *
äm
++ = 0;

1580 
	`memıy
(
äm
, 
oui
, (oui));

1581 
äm
 +ğ(
oui
);

1582 *
äm
++ = 
WME_PARAM_OUI_SUBTYPE
;

1583 *
äm
++ = 
WME_VERSION
;

1584 *
äm
 = 
wme
->
wme_bssChªP¬ams
.
ÿp_šfo_couÁ
;

1585 ià(
u­sd_’abË
)

1586 *
äm
 |ğ
WME_CAPINFO_UAPSD_EN
;

1587 
äm
++;

1588 *
äm
++ = 0;

1589 
i
 = 0; i < 
WME_NUM_AC
; i++) {

1590 cÚ¡ 
wmeP¬ams
 *
ac
 =

1591 &
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
i
];

1592 *
äm
++ = 
	`SM
(
i
, 
WME_PARAM_ACI
) |

1593 
	`SM
(
ac
->
wm•_acm
, 
WME_PARAM_ACM
) |

1594 
	`SM
(
ac
->
wm•_aif¢
, 
WME_PARAM_AIFSN
);

1595 *
äm
++ = 
	`SM
(
ac
->
wm•_logcwmax
, 
WME_PARAM_LOGCWMAX
) |

1596 
	`SM
(
ac
->
wm•_logcwmš
, 
WME_PARAM_LOGCWMIN
);

1597 
	`ADDSHORT
(
äm
, 
ac
->
wm•_txİLim™
);

1600 
›
->
·¿m_Ën
 = 
äm
 - &›->
·¿m_oui
[0];

1602  
äm
;

1603 #undeà
ADDSHORT


1604 
	}
}

1605 #undeà
WME_OUI_BYTES


1610 
u_št8_t
 *

1611 
	$›“80211_add_©hAdvC­
(
u_št8_t
 *
äm
, u_št8_ˆ
ÿ·b™y
, 
u_št16_t
 
deçuÉKey
)

1613 cÚ¡ 
u_št8_t
 
oui
[6] = {(
ATH_OUI
 & 0xff), ((ATH_OUI >>8) & 0xff),

1614 ((
ATH_OUI
 >> 16è& 0xff), 
ATH_OUI_TYPE
,

1615 
ATH_OUI_SUBTYPE
, 
ATH_OUI_VERSION
};

1616 
›“80211_›_©hAdvC­
 *
›
 = (›“80211_›_©hAdvC­ *)
äm
;

1618 *
äm
++ = 
IEEE80211_ELEMID_VENDOR
;

1619 *
äm
++ = 0;

1620 
	`memıy
(
äm
, 
oui
, (oui));

1621 
äm
 +ğ(
oui
);

1622 *
äm
++ = 
ÿ·b™y
;

1625 *
äm
++ = (
deçuÉKey
 & 0xff);

1626 *
äm
++ = ((
deçuÉKey
 >> 8) & 0xff);

1627 
›
->
©hAdvC­_Ën
 = 
äm
 - &›->
©hAdvC­_oui
[0];

1629  
äm
;

1630 
	}
}

1635 #ifdeà
ATH_SUPERG_XR


1636 
u_št8_t
 *

1637 
	$›“80211_add_xr_·¿m
(
u_št8_t
 *
äm
, 
›“80211v­
 *
v­
)

1639 cÚ¡ 
u_št8_t
 
oui
[6] = {(
ATH_OUI
 & 0xff), ((ATH_OUI >>8) & 0xff),

1640 ((
ATH_OUI
 >> 16è& 0xff), 
ATH_OUI_TYPE_XR
,

1641 
ATH_OUI_SUBTYPE_XR
, 
ATH_OUI_VER_XR
};

1642 
›“80211_xr_·¿m
 *
›
 = (›“80211_xr_·¿m *)
äm
;

1644 *
äm
++ = 
IEEE80211_ELEMID_VENDOR
;

1645 *
äm
++ = 0;

1646 
	`memıy
(
äm
, 
oui
, (oui));

1647 
äm
 +ğ(
oui
);

1648 *
äm
++ = 0;

1651 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XR
) {

1652 
	`IEEE80211_ADDR_COPY
(
äm
, 
v­
->
iv_xrv­
->
iv_bssid
);

1653 
äm
 +ğ
IEEE80211_ADDR_LEN
;

1654 
	`IEEE80211_ADDR_COPY
(
äm
, 
v­
->
iv_bssid
);

1655 
äm
 +ğ
IEEE80211_ADDR_LEN
;

1656 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
v­
->
iv_bss
->
ni_štv®
);

1657 
äm
 += 2;

1658 *
äm
++ = 
v­
->
iv_xrv­
->
iv_©h_ÿp
;

1659 *
äm
++ = 
v­
->
iv_©h_ÿp
;

1661 
	`IEEE80211_ADDR_COPY
(
äm
, 
v­
->
iv_bssid
);

1662 
äm
 +ğ
IEEE80211_ADDR_LEN
;

1663 
	`IEEE80211_ADDR_COPY
(
äm
, 
v­
->
iv_xrv­
->
iv_bssid
);

1664 
äm
 +ğ
IEEE80211_ADDR_LEN
;

1665 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
v­
->
iv_bss
->
ni_štv®
);

1666 
äm
 += 2;

1667 *
äm
++ = 
v­
->
iv_©h_ÿp
;

1668 *
äm
++ = 
v­
->
iv_xrv­
->
iv_©h_ÿp
;

1670 
›
->
·¿m_Ën
 = 
äm
 - &›->
·¿m_oui
[0];

1671  
äm
;

1672 
	}
}

1679 
	$›“80211_£nd_´ob”eq
(
›“80211_node
 *
ni
,

1680 cÚ¡ 
u_št8_t
 
§
[
IEEE80211_ADDR_LEN
],

1681 cÚ¡ 
u_št8_t
 
da
[
IEEE80211_ADDR_LEN
],

1682 cÚ¡ 
u_št8_t
 
bssid
[
IEEE80211_ADDR_LEN
],

1683 cÚ¡ 
u_št8_t
 *
ssid
, 
size_t
 
ssidËn
,

1684 cÚ¡ *
İt›
, 
size_t
 
İt›Ën
)

1686 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1687 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1688 
›“80211_phymode
 
mode
;

1689 
›“80211_äame
 *
wh
;

1690 
sk_buff
 *
skb
;

1691 
u_št8_t
 *
äm
;

1700 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 2 + 
IEEE80211_NWID_LEN
 +

1701 2 + 
IEEE80211_RATE_SIZE
 +

1702 2 + (
IEEE80211_RATE_MAXSIZE
 - 
IEEE80211_RATE_SIZE
) +

1703 (
İt›
 !ğ
NULL
 ? 
İt›Ën
 : 0) +

1704 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_REQ
].
Ëngth
);

1705 ià(
skb
 =ğ
NULL
) {

1706 
v­
->
iv_¡©s
.
is_tx_nobuf
++;

1707  -
ENOMEM
;

1710 
äm
 = 
	`›“80211_add_ssid
(äm, 
ssid
, 
ssidËn
);

1711 
mode
 = 
	`›“80211_chª2mode
(
ic
->
ic_curchª
);

1712 
äm
 = 
	`›“80211_add_¿‹s
(äm, &
ic
->
ic_sup_¿‹s
[
mode
]);

1713 
äm
 = 
	`›“80211_add_x¿‹s
(äm, &
ic
->
ic_sup_¿‹s
[
mode
]);

1715 ià(
İt›
 !ğ
NULL
) {

1716 
	`memıy
(
äm
, 
İt›
, 
İt›Ën
);

1717 
äm
 +ğ
İt›Ën
;

1720 ià(
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_REQ
].
›
) {

1721 
	`memıy
(
äm
, 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_REQ
].
›
,

1722 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_REQ
].
Ëngth
);

1723 
äm
 +ğ
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_REQ
].
Ëngth
;

1726 
	`skb_Œim
(
skb
, 
äm
 - skb->
d©a
);

1728 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
ni
);

1730 
wh
 = (
›“80211_äame
 *)

1731 
	`skb_push
(
skb
, (
›“80211_äame
));

1732 
	`›“80211_£nd_£tup
(
v­
, 
ni
, 
wh
,

1733 
IEEE80211_FC0_TYPE_MGT
 | 
IEEE80211_FC0_SUBTYPE_PROBE_REQ
,

1734 
§
, 
da
, 
bssid
);

1737 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_´ob”eq
);

1738 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_mgmt
);

1740 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
 | 
IEEE80211_MSG_DUMPPKTS
,

1741 "[" 
MAC_FMT
 "] send…robe„eq on channel %u\n",

1742 
	`MAC_ADDR
(
wh
->
i_addr1
),

1743 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
));

1745 ()
ic
->
	`ic_mgt¡¬t
(ic, 
skb
);

1747 
	}
}

1755 
	$›“80211_£nd_mgmt
(
›“80211_node
 *
ni
, 
ty³
, 
¬g
)

1757 
	#£nd”r
(
_x
, 
_v
èdØ{ 
v­
->
iv_¡©s
._v++; 
»t
 = _x; 
bad
; } 0)

	)

1758 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

1759 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

1760 
sk_buff
 *
skb
;

1761 
u_št8_t
 *
äm
;

1762 
äm_Ën
;

1763 
u_št16_t
 
ÿpšfo
;

1764 
›“80211_keyix_t
 
def_keyšdex
;

1765 
has_ch®Ënge
, 
is_sh¬ed_key
, 
»t
, 
tim”
, 
¡©us
;

1767 
	`KASSERT
(
ni
 !ğ
NULL
, ("null‚ode"));

1769 
tim”
 = 0;

1770 
ty³
) {

1771 
IEEE80211_FC0_SUBTYPE_PROBE_RESP
:

1790 
äm_Ën
 = 8

1791 + (
u_št16_t
)

1792 + (
u_št16_t
)

1793 + 2 + 
IEEE80211_NWID_LEN


1794 + 2 + 
IEEE80211_RATE_SIZE


1797 + 2 + 
ic
->
ic_couÁry_›
.
couÁry_Ën


1800 + 2 + (
IEEE80211_RATE_MAXSIZE
 - 
IEEE80211_RATE_SIZE
)

1801 + (
›“80211_wme_·¿m
)

1803 + (
v­
->
iv_æags
 & 
IEEE80211_F_WPA
 ?

1804 2 * (
›“80211_›_w·
) : 0)

1805 + (
›“80211_›_©hAdvC­
)

1806 + 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_RESP
].
Ëngth
;

1807 #ifdeà
ATH_SUPERG_XR


1808 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
)

1809 
äm_Ën
 +ğ(
›“80211_xr_·¿m
);

1811 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 
äm_Ën
);

1812 ià(
skb
 =ğ
NULL
)

1813 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

1816 
	`mem£t
(
äm
, 0, 8);

1817 
äm
 += 8;

1820 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
v­
->
iv_bss
->
ni_štv®
);

1821 
äm
 += 2;

1824 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)

1825 
ÿpšfo
 = 
IEEE80211_CAPINFO_IBSS
;

1827 
ÿpšfo
 = 
IEEE80211_CAPINFO_ESS
;

1828 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

1829 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

1830 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

1831 
	`IEEE80211_IS_CHAN_2GHZ
(
ic
->
ic_curchª
))

1832 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

1833 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
)

1834 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_SLOTTIME
;

1835 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ÿpšfo
);

1836 
äm
 += 2;

1839 
äm
 = 
	`›“80211_add_ssid
(äm, 
v­
->
iv_bss
->
ni_essid
,

1840 
v­
->
iv_bss
->
ni_es¦’
);

1843 
äm
 = 
	`›“80211_add_¿‹s
(äm, &
ni
->
ni_¿‹s
);

1846 ià(
ic
->
ic_phyty³
 =ğ
IEEE80211_T_FH
) {

1847 *
äm
++ = 
IEEE80211_ELEMID_FHPARMS
;

1848 *
äm
++ = 5;

1849 *
äm
++ = 
ni
->
ni_fhdw–l
 & 0x00ff;

1850 *
äm
++ = (
ni
->
ni_fhdw–l
 >> 8) & 0x00ff;

1851 *
äm
++ = 
	`IEEE80211_FH_CHANSET
(

1852 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
));

1853 *
äm
++ = 
	`IEEE80211_FH_CHANPAT
(

1854 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
));

1855 *
äm
++ = 
ni
->
ni_fhšdex
;

1857 *
äm
++ = 
IEEE80211_ELEMID_DSPARMS
;

1858 *
äm
++ = 1;

1859 *
äm
++ = 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
);

1862 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

1863 *
äm
++ = 
IEEE80211_ELEMID_IBSSPARMS
;

1864 *
äm
++ = 2;

1865 *
äm
++ = 0;

1866 *
äm
++ = 0;

1870 ià((
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) ||

1871 (
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_COUNTRYIE
))

1872 
äm
 = 
	`›“80211_add_couÁry
(äm, 
ic
);

1875 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
)

1876 
äm
 = 
	`›“80211_add_pwrú¡r
(äm, 
ic
);

1879 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_curchª
))

1880 
äm
 = 
	`›“80211_add_”p
(äm, 
ic
);

1883 
äm
 = 
	`›“80211_add_x¿‹s
(äm, &
ni
->
ni_¿‹s
);

1886 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WME
)

1887 
äm
 = 
	`›“80211_add_wme_·¿m
(äm, &
ic
->
ic_wme
,

1888 
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
));

1891 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

1892 
äm
 = 
	`›“80211_add_w·
(äm, 
v­
);

1895 ià(
v­
->
iv_bss
 && v­->iv_bss->
ni_©h_æags
)

1896 
äm
 = 
	`›“80211_add_©hAdvC­
(äm, 
v­
->
iv_bss
->
ni_©h_æags
,

1897 
v­
->
iv_bss
->
ni_©h_defkeyšdex
);

1898 #ifdeà
ATH_SUPERG_XR


1900 ià(
v­
->
iv_xrv­
 && v­->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
)

1901 
äm
 = 
	`›“80211_add_xr_·¿m
(äm, 
v­
);

1903 ià(
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_RESP
].
›
) {

1904 
	`memıy
(
äm
, 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_RESP
].
›
,

1905 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_RESP
].
Ëngth
);

1906 
äm
 +ğ
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_PROBE_RESP
].
Ëngth
;

1909 
	`skb_Œim
(
skb
, 
äm
 - skb->
d©a
);

1912 
IEEE80211_FC0_SUBTYPE_AUTH
:

1913 
¡©us
 = 
¬g
 >> 16;

1914 
¬g
 &= 0xffff;

1915 
has_ch®Ënge
 = ((
¬g
 =ğ
IEEE80211_AUTH_SHARED_CHALLENGE
 ||

1916 
¬g
 =ğ
IEEE80211_AUTH_SHARED_RESPONSE
) &&

1917 
ni
->
ni_ch®Ënge
 !ğ
NULL
);

1926 
is_sh¬ed_key
 = 
has_ch®Ënge
 ||

1927 
¬g
 >ğ
IEEE80211_AUTH_SHARED_RESPONSE
 ||

1928 (
¬g
 =ğ
IEEE80211_AUTH_SHARED_REQUEST
 &&

1929 
v­
->
iv_bss
->
ni_authmode
 =ğ
IEEE80211_AUTH_SHARED
);

1931 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
,

1932 3 * (
u_št16_t
)

1933 + (
has_ch®Ënge
 && 
¡©us
 =ğ
IEEE80211_STATUS_SUCCESS
 ?

1934 (
u_št16_t
)+
IEEE80211_CHALLENGE_LEN
 : 0));

1935 ià(
skb
 =ğ
NULL
)

1936 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

1938 ((
__Ë16
 *)
äm
)[0] =

1939 (
is_sh¬ed_key
è? 
	`htŞe16
(
IEEE80211_AUTH_ALG_SHARED
)

1940 : 
	`htŞe16
(
IEEE80211_AUTH_ALG_OPEN
);

1941 ((
__Ë16
 *)
äm
)[1] = 
	`htŞe16
(
¬g
);

1942 ((
__Ë16
 *)
äm
)[2] = 
	`htŞe16
(
¡©us
);

1944 ià(
has_ch®Ënge
 && 
¡©us
 =ğ
IEEE80211_STATUS_SUCCESS
) {

1945 ((
__Ë16
 *)
äm
)[3] =

1946 
	`htŞe16
((
IEEE80211_CHALLENGE_LEN
 << 8) |

1947 
IEEE80211_ELEMID_CHALLENGE
);

1948 
	`memıy
(&((
__Ë16
 *)
äm
)[4], 
ni
->
ni_ch®Ënge
,

1949 
IEEE80211_CHALLENGE_LEN
);

1950 ià(
¬g
 =ğ
IEEE80211_AUTH_SHARED_RESPONSE
) {

1951 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_AUTH
, 
ni
,

1952 "»que¡ƒnüy± f¿m(%s)", 
__func__
);

1953 
	`SKB_CB
(
skb
)->
æags
 |ğ
M_LINK0
;

1958 ià(
¡©us
 =ğ
IEEE80211_STATUS_SUCCESS
)

1959 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_auth
);

1961 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_auth_ç
);

1963 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
)

1964 
tim”
 = 
IEEE80211_TRANS_WAIT
;

1967 
IEEE80211_FC0_SUBTYPE_DEAUTH
:

1968 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_AUTH
, 
ni
,

1969 "£nd stiÚ d—uth’tiÿ‹ (»asÚ %d)", 
¬g
);

1970 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, (
u_št16_t
));

1971 ià(
skb
 =ğ
NULL
)

1972 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

1973 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
¬g
);

1975 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_d—uth
);

1976 
	`IEEE80211_NODE_STAT_SET
(
ni
, 
tx_d—uth_code
, 
¬g
);

1978 
	`›“80211_node_uÇuthÜize
(
ni
);

1981 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
:

1982 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
:

1997 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
,

1998 (
u_št16_t
) +

1999 (
u_št16_t
) +

2000 
IEEE80211_ADDR_LEN
 +

2001 2 + 
IEEE80211_NWID_LEN
 +

2002 2 + 
IEEE80211_RATE_SIZE
 +

2003 4 + (2 + 
ic
->
ic_sc_›
.
sc_Ën
) +

2004 2 + (
IEEE80211_RATE_MAXSIZE
 - 
IEEE80211_RATE_SIZE
) +

2005 (
›“80211_›_wme
) +

2006 (
›“80211_›_©hAdvC­
) +

2007 (
v­
->
iv_İt_›
 !ğ
NULL
 ? v­->
iv_İt_›_Ën
 : 0) +

2008 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_REQ
].
Ëngth
);

2009 ià(
skb
 =ğ
NULL
)

2010 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

2012 
ÿpšfo
 = 0;

2013 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
)

2014 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_IBSS
;

2016 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_ESS
;

2017 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

2018 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

2024 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

2025 
	`IEEE80211_IS_CHAN_2GHZ
(
ic
->
ic_curchª
))

2026 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

2027 ià((
ni
->
ni_ÿpšfo
 & 
IEEE80211_CAPINFO_SHORT_SLOTTIME
) &&

2028 (
ic
->
ic_ÿps
 & 
IEEE80211_C_SHSLOT
))

2029 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_SLOTTIME
;

2030 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ÿpšfo
);

2031 
äm
 += 2;

2034 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ic
->
ic_lštv®
);

2035 
äm
 += 2;

2038 ià(
ty³
 =ğ
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
) {

2039 
	`IEEE80211_ADDR_COPY
(
äm
, 
v­
->
iv_bssid
);

2040 
äm
 +ğ
IEEE80211_ADDR_LEN
;

2043 
äm
 = 
	`›“80211_add_ssid
(äm, 
ni
->
ni_essid
,‚i->
ni_es¦’
);

2045 
äm
 = 
	`›“80211_add_¿‹s
(äm, &
ni
->
ni_¿‹s
);

2047 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) {

2048 
äm
 = 
	`›“80211_add_pwrÿp
(äm, 
ic
);

2049 
äm
 = 
	`›“80211_add_suµchª
(äm, 
ic
);

2052 
äm
 = 
	`›“80211_add_x¿‹s
(äm, &
ni
->
ni_¿‹s
);

2055 ià((
v­
->
iv_æags
 & 
IEEE80211_F_WME
è&& 
ni
->
ni_wme_›
 !ğ
NULL
)

2056 
äm
 = 
	`›“80211_add_wme
(äm, 
ni
);

2058 ià(
ni
->
ni_©h_æags
 & 
v­
->
iv_©h_ÿp
) {

2059 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

2061 "iv_©h_ÿ°ğ%02x", 
ni
->
ni_©h_æags
,

2062 
v­
->
iv_©h_ÿp
);

2065 
def_keyšdex
 = 
IEEE80211_INVAL_DEFKEY
;

2066 ià(((
v­
->
iv_æags
 & 
IEEE80211_F_WPA
) == 0) &&

2067 (
ni
->
ni_authmode
 !ğ
IEEE80211_AUTH_8021X
) &&

2068 (
v­
->
iv_def_txkey
 !ğ
IEEE80211_KEYIX_NONE
))

2069 
def_keyšdex
 = 
v­
->
iv_def_txkey
;

2071 
äm
 = 
	`›“80211_add_©hAdvC­
(frm,

2072 
ni
->
ni_©h_æags
 & 
v­
->
iv_©h_ÿp
,

2073 
def_keyšdex
);

2077 ià(
v­
->
iv_İt_›
 !ğ
NULL
) {

2078 
	`memıy
(
äm
, 
v­
->
iv_İt_›
, v­->
iv_İt_›_Ën
);

2079 
äm
 +ğ
v­
->
iv_İt_›_Ën
;

2082 ià(
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_REQ
].
›
) {

2083 
	`memıy
(
äm
, 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_REQ
].
›
,

2084 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_REQ
].
Ëngth
);

2085 
äm
 +ğ
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_REQ
].
Ëngth
;

2088 
	`skb_Œim
(
skb
, 
äm
 - skb->
d©a
);

2090 
tim”
 = 
IEEE80211_TRANS_WAIT
;

2093 
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
:

2094 
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
:

2105 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
,

2106 3 * (
u_št16_t
) +

2107 2 + 
IEEE80211_RATE_SIZE
 +

2108 2 + (
IEEE80211_RATE_MAXSIZE
 - 
IEEE80211_RATE_SIZE
) +

2109 (
›“80211_wme_·¿m
) +

2110 (
v­
->
iv_©h_ÿp
 ? (
›“80211_›_©hAdvC­
):0) +

2111 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_RESP
].
Ëngth
);

2112 ià(
skb
 =ğ
NULL
)

2113 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

2116 
ÿpšfo
 = 
IEEE80211_CAPINFO_ESS
;

2117 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

2118 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_PRIVACY
;

2119 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SHPREAMBLE
) &&

2120 
	`IEEE80211_IS_CHAN_2GHZ
(
ic
->
ic_curchª
))

2121 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_PREAMBLE
;

2122 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SHSLOT
)

2123 
ÿpšfo
 |ğ
IEEE80211_CAPINFO_SHORT_SLOTTIME
;

2124 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ÿpšfo
);

2125 
äm
 += 2;

2128 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
¬g
);

2129 
äm
 += 2;

2132 ià(
¬g
 =ğ
IEEE80211_STATUS_SUCCESS
) {

2133 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
ni
->
ni_associd
);

2134 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_assoc
);

2136 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_assoc_ç
);

2137 
äm
 += 2;

2140 
äm
 = 
	`›“80211_add_¿‹s
(äm, &
ni
->
ni_¿‹s
);

2143 
äm
 = 
	`›“80211_add_x¿‹s
(äm, &
ni
->
ni_¿‹s
);

2146 ià((
v­
->
iv_æags
 & 
IEEE80211_F_WME
è&& 
ni
->
ni_wme_›
 !ğ
NULL
)

2147 
äm
 = 
	`›“80211_add_wme_·¿m
(äm, &
ic
->
ic_wme
,

2148 
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
));

2151 ià(
v­
->
iv_©h_ÿp
)

2152 
äm
 = 
	`›“80211_add_©hAdvC­
(frm,

2153 
v­
->
iv_©h_ÿp
 & 
ni
->
ni_©h_æags
,

2154 
ni
->
ni_©h_defkeyšdex
);

2156 ià(
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_RESP
].
›
) {

2157 
	`memıy
(
äm
, 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_RESP
].
›
,

2158 
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_RESP
].
Ëngth
);

2159 
äm
 +ğ
v­
->
­p_›
[
IEEE80211_APPIE_FRAME_ASSOC_RESP
].
Ëngth
;

2162 
	`skb_Œim
(
skb
, 
äm
 - skb->
d©a
);

2165 
IEEE80211_FC0_SUBTYPE_DISASSOC
:

2166 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ASSOC
, 
ni
,

2167 "£nd stiÚ di§ssocŸ‹ (»asÚ %d)", 
¬g
);

2168 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, (
u_št16_t
));

2169 ià(
skb
 =ğ
NULL
)

2170 
	`£nd”r
(
ENOMEM
, 
is_tx_nobuf
);

2171 *(
__Ë16
 *)
äm
 = 
	`htŞe16
(
¬g
);

2173 
	`IEEE80211_NODE_STAT
(
ni
, 
tx_di§ssoc
);

2174 
	`IEEE80211_NODE_STAT_SET
(
ni
, 
tx_di§ssoc_code
, 
¬g
);

2178 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ANY
, 
ni
,

2179 "šv®id mgmˆäamty³ %u", 
ty³
);

2180 
	`£nd”r
(
EINVAL
, 
is_tx_unknownmgt
);

2184 
	`›“80211_mgmt_ouut
(
	`›“80211_»f_node
(
ni
), 
skb
, 
ty³
);

2185 ià(
tim”
)

2186 
	`mod_tim”
(&
v­
->
iv_mgt£nd
, 
jiff›s
 + 
tim”
 * 
HZ
);

2188 
bad
:

2189  
»t
;

2190 #undeà
£nd”r


2191 
	}
}

2197 
	$›“80211_£nd_p¥Şl
(
›“80211_node
 *
ni
)

2199 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

2200 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

2201 
sk_buff
 *
skb
;

2202 
›“80211_ùläame_addr2
 *
wh
;

2204 
skb
 = 
	`›“80211_dev_®loc_skb
((
›“80211_ùläame_addr2
));

2205 ià(
skb
 =ğ
NULL
) ;

2207 
	`SKB_NI
(
skb
èğ
	`›“80211_»f_node
(
ni
);

2208 
skb
->
´iÜ™y
 = 
WME_AC_VO
;

2210 
wh
 = (
›“80211_ùläame_addr2
 *)
	`skb_put
(
skb
, (ieee80211_ctlframe_addr2));

2212 
wh
->
i_aidÜdur
 = 
	`htŞe16
(0xc000 | 
	`IEEE80211_NODE_AID
(
ni
));

2213 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
v­
->
iv_bssid
);

2214 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

2215 
wh
->
i_fc
[0] = 0;

2216 
wh
->
i_fc
[1] = 0;

2217 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_CTL
 |

2218 
IEEE80211_FC0_SUBTYPE_PS_POLL
;

2219 ià(
	`IEEE80211_VAP_IS_SLEEPING
(
ni
->
ni_v­
))

2220 
wh
->
i_fc
[1] |ğ
IEEE80211_FC1_PWR_MGT
;

2222 (è
ic
->
	`ic_mgt¡¬t
(ic, 
skb
);

2223 
	}
}

2226 #ifdeà
ATH_SUPERG_XR


2231 
sk_buff
 *

2232 
	$›“80211_g‘cfäame
(
›“80211v­
 *
v­
, 
ty³
)

2234 
u_št8_t
 *
äm
;

2235 
sk_buff
 *
skb
;

2236 
›“80211_äame
 *
wh
;

2237 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2240 
skb
 = 
	`›“80211_g‘mgtäame
(&
äm
, 0);

2241 ià(
skb
 =ğ
NULL
)

2242  
NULL
;

2243 
wh
 = (
›“80211_äame
 *)

2244 
	`skb_push
(
skb
, (
›“80211_äame
));

2245 ià(
ty³
 =ğ
IEEE80211_FC0_SUBTYPE_CFPOLL
) {

2246 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_FROMDS
;

2247 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_DATA
 | 
ty³
;

2248 
wh
->
i_dur
 = 
	`htŞe16
(0x8000);

2249 } ià(
ty³
 =ğ
IEEE80211_FC0_SUBTYPE_CF_END
) {

2250 
wh
->
i_fc
[1] = 
IEEE80211_FC1_DIR_NODS
;

2251 
wh
->
i_fc
[0] = 
IEEE80211_FC0_VERSION_0
 | 
IEEE80211_FC0_TYPE_CTL
 | 
ty³
;

2252 
wh
->
i_dur
 = 0;

2254 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr1
, 
ic
->
ic_dev
->
brßdÿ¡
);

2255 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr2
, 
v­
->
iv_myaddr
);

2256 
	`IEEE80211_ADDR_COPY
(
wh
->
i_addr3
, 
v­
->
iv_bssid
);

2257  
skb
;

2258 
	}
}

2259 
EXPORT_SYMBOL
(
›“80211_g‘cfäame
);

	@ieee80211_power.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/‘h”deviû.h
>

50 
	~"if_medŸ.h
"

52 
	~<Ãt80211/›“80211_v¬.h
>

53 
	~<Ãt80211/›“80211_´Ùo.h
>

55 
›“80211_£t_tim
(
›“80211_node
 *
ni
, 
£t
);

58 
	$›“80211_pow”_©ch
(
›“80211com
 *
ic
)

60 
	}
}

63 
	$›“80211_pow”_d‘ach
(
›“80211com
 *
ic
)

65 
	}
}

68 
	$›“80211_pow”_v©ch
(
›“80211v­
 *
v­
)

70 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

71 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

73 
v­
->
iv_£t_tim
 = 
›“80211_£t_tim
;

75 
	}
}

78 
	$›“80211_pow”_Ï‹v©ch
(
›“80211v­
 *
v­
)

84 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

85 
v­
->
iv_tim_Ën
 = 
	`howmªy
(v­->
iv_max_aid
, 8è* (
u_št8_t
);

86 
	`MALLOC
(
v­
->
iv_tim_b™m­
, 
u_št8_t
 *, v­->
iv_tim_Ën
,

87 
M_DEVBUF
, 
M_NOWAIT
 | 
M_ZERO
);

88 ià(
v­
->
iv_tim_b™m­
 =ğ
NULL
) {

89 
	`´štk
(
KERN_ERR
 "%s:‚ØmemÜy fÜ TIM b™m­!\n", 
__func__
);

91 
v­
->
iv_tim_Ën
 = 0;

94 
	}
}

97 
	$›“80211_pow”_vd‘ach
(
›“80211v­
 *
v­
)

99 ià(
v­
->
iv_tim_b™m­
 !ğ
NULL
) {

100 
	`FREE
(
v­
->
iv_tim_b™m­
, 
M_DEVBUF
);

101 
v­
->
iv_tim_b™m­
 = 
NULL
;

103 
	}
}

110 
	$›“80211_node_§veq_d¿š
(
›“80211_node
 *
ni
)

112 
sk_buff
 *
skb
;

113 
qËn
;

115 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

116 
qËn
 = 
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
);

117 (
skb
 = 
	`__skb_dequeue
(&
ni
->
ni_§vedq
)è!ğ
NULL
) {

118 ià(
	`SKB_NI
(
skb
è!ğ
NULL
)

119 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb
));

120 
	`›“80211_dev_kä“_skb
(&
skb
);

122 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

124  
qËn
;

125 
	}
}

138 
	$›“80211_node_§veq_age
(
›“80211_node
 *
ni
)

140 
disÿrd
 = 0;

143 ià(
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
) != 0) {

144 #ifdeà
IEEE80211_DEBUG


145 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

147 
sk_buff
 *
skb
;

149 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

150 (
skb
 = 
	`skb_³ek
(&
ni
->
ni_§vedq
)è!ğ
NULL
 &&

151 
	`M_AGE_GET
(
skb
è< 
IEEE80211_INACT_WAIT
) {

152 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

153 "disÿrd f¿me,‡g%u", 
	`M_AGE_GET
(
skb
));

155 
skb
 = 
	`__skb_dequeue
(&
ni
->
ni_§vedq
);

156 ià(
	`SKB_NI
(
skb
è!ğ
NULL
)

157 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb
));

158 
	`›“80211_dev_kä“_skb
(&
skb
);

159 
disÿrd
++;

161 ià(
skb
 !ğ
NULL
)

162 
	`M_AGE_SUB
(
skb
, 
IEEE80211_INACT_WAIT
);

163 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

165 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

166 "disÿrd %u f¿me fÜ‡ge", 
disÿrd
);

167 
	`IEEE80211_NODE_STAT_ADD
(
ni
, 
ps_disÿrd
, 
disÿrd
);

169  
disÿrd
;

170 
	}
}

176 
	$›“80211_£t_tim
(
›“80211_node
 *
ni
, 
£t
)

178 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

179 
u_št16_t
 
aid
;

181 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

182 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
,

183 ("İ”©šg mod%u", 
v­
->
iv_İmode
));

185 
aid
 = 
	`IEEE80211_AID
(
ni
->
ni_associd
);

186 
	`KASSERT
(
aid
 < 
v­
->
iv_max_aid
,

187 ("bogu aid %u, max %u", 
aid
, 
v­
->
iv_max_aid
));

189 
	`IEEE80211_LOCK_IRQ
(
ni
->
ni_ic
);

190 ià(
£t
 !ğ(
	`is£t
(
v­
->
iv_tim_b™m­
, 
aid
) != 0)) {

191 ià(
£t
) {

192 
	`£tb™
(
v­
->
iv_tim_b™m­
, 
aid
);

193 
v­
->
iv_ps_³ndšg
++;

195 
	`şrb™
(
v­
->
iv_tim_b™m­
, 
aid
);

196 
v­
->
iv_ps_³ndšg
--;

198 
v­
->
iv_æags
 |ğ
IEEE80211_F_TIMUPDATE
;

200 
	`IEEE80211_UNLOCK_IRQ
(
ni
->
ni_ic
);

201 
	}
}

210 
	$›“80211_pwr§ve
(
sk_buff
 *
skb
)

212 
›“80211_node
 *
ni
 = 
	`SKB_NI
(
skb
);

213 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

214 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

215 
sk_buff
 *

;

216 
qËn
, 
age
;

218 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

219 ià(
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
è>ğ
IEEE80211_PS_MAX_QUEUE
) {

220 
	`IEEE80211_NODE_STAT
(
ni
, 
psq_drİs
);

221 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ_EARLY
(
ni
);

222 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_ANY
, 
ni
,

224 
ni
->
ni_¡©s
.
ns_psq_drİs
, 
IEEE80211_PS_MAX_QUEUE
);

225 #ifdeà
IEEE80211_DEBUG


226 ià(
	`›“80211_msg_dumµkts
(
v­
))

227 
	`›“80211_dump_pkt
(
ni
->
ni_ic
, 
skb
->
d©a
,

228 
skb
->
Ën
, -1, -1, 1);

230 ià(
	`SKB_NI
(
skb
è!ğ
NULL
)

231 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb
));

232 
	`›“80211_dev_kä“_skb
(&
skb
);

233  
NETDEV_TX_OK
;

244 
age
 = ((
ni
->
ni_štv®
 * 
ic
->
ic_lštv®
) << 2) / 1024;

245 

 = 
	`skb_³ek_
(&
ni
->
ni_§vedq
);

246 ià(

 !ğ
NULL
) {

247 
age
 -ğ
	`M_AGE_GET
(

);

248 
	`__skb_queue_aá”
(&
ni
->
ni_§vedq
, 

, 
skb
);

250 
	`__skb_queue_h—d
(&
ni
->
ni_§vedq
, 
skb
);

251 
	`M_AGE_SET
(
skb
, 
age
);

252 
qËn
 = 
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
);

253 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

255 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

256 "§väame, %u‚ow queued", 
qËn
);

258 ià(
qËn
 =ğ1 && 
v­
->
iv_£t_tim
 !ğ
NULL
)

259 
v­
->
	`iv_£t_tim
(
ni
, 1);

261  
NETDEV_TX_OK
;

262 
	}
}

268 
	$›“80211_node_pwr§ve
(
›“80211_node
 *
ni
, 
’abË
)

270 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

272 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

273 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
,

274 ("uÃx³ùed o³¿tšg mod%u", 
v­
->
iv_İmode
));

276 ià(
’abË
) {

277 ià((
ni
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
) == 0)

278 
v­
->
iv_ps_¡a
++;

279 
ni
->
ni_æags
 |ğ
IEEE80211_NODE_PWR_MGT
;

280 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

282 
v­
->
iv_ps_¡a
);

284 ià((
ni
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
))

285 
v­
->
iv_ps_¡a
--;

286 
ni
->
ni_æags
 &ğ~
IEEE80211_NODE_PWR_MGT
;

287 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

289 
v­
->
iv_ps_¡a
);

295 ià(
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
) == 0) {

296 ià(
v­
->
iv_£t_tim
 !ğ
NULL
)

297 
v­
->
	`iv_£t_tim
(
ni
, 0);

301 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

303 
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
));

306 
sk_buff
 *
skb
;

307 
qËn
;

309 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

310 
	`IEEE80211_NODE_SAVEQ_DEQUEUE
(
ni
, 
skb
, 
qËn
);

311 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

312 ià(
skb
 =ğ
NULL
)

325 
	`M_PWR_SAV_SET
(
skb
);

328 #ifdeà
ATH_SUPERG_XR


334 ià(
v­
->
iv_xrv­
 && v­->
iv_æags
 & 
IEEE80211_F_XR
)

335 
skb
->
dev
 = 
v­
->
iv_xrv­
->
iv_dev
;

337 
skb
->
dev
 = 
v­
->
iv_dev
;

340 
	`›“80211_·»Á_queue_xm™
(
skb
);

342 
v­
->
	`iv_£t_tim
(
ni
, 0);

344 
	}
}

350 
	$›“80211_¡a_pwr§ve
(
›“80211v­
 *
v­
, 
’abË
)

352 
›“80211_node
 *
ni
 = 
v­
->
iv_bss
;

353 
qËn
;

355 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
)

358 ià(!!
’abË
 =ğ!!
	`IEEE80211_VAP_IS_SLEEPING
(
v­
))

361 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

362 "STA…ow” savmod%s", 
’abË
 ? "on" : "off");

363 ià(!
’abË
) {

364 
	`IEEE80211_VAP_WAKEUP
(
v­
);

365 
	`›“80211_£nd_nuÎd©a
(
	`›“80211_»f_node
(
ni
));

372 
qËn
 = 
	`IEEE80211_NODE_SAVEQ_QLEN
(
ni
);

373 ià(
qËn
 != 0) {

374 
	`IEEE80211_NOTE
(
v­
, 
IEEE80211_MSG_POWER
, 
ni
,

375 "æush PS queue, %u…ack‘ queued", 
qËn
);

377 
sk_buff
 *
skb
;

379 
	`IEEE80211_NODE_SAVEQ_LOCK_IRQ
(
ni
);

380 
skb
 = 
	`__skb_dequeue
(&
ni
->
ni_§vedq
);

381 
	`IEEE80211_NODE_SAVEQ_UNLOCK_IRQ
(
ni
);

382 ià(
skb
 =ğ
NULL
)

384 
	`›“80211_·»Á_queue_xm™
(
skb
);

388 
	`IEEE80211_VAP_GOTOSLEEP
(
v­
);

389 
	`›“80211_£nd_nuÎd©a
(
	`›“80211_»f_node
(
ni
));

391 
	}
}

	@ieee80211_power.h

34 #iâdeà
_NET80211_IEEE80211_POWER_H_


35 
	#_NET80211_IEEE80211_POWER_H_


	)

37 
	g›“80211com
;

38 
	g›“80211v­
;

40 
›“80211_pow”_©ch
(
›“80211com
 *);

41 
›“80211_pow”_d‘ach
(
›“80211com
 *);

42 
›“80211_pow”_v©ch
(
›“80211v­
 *);

43 
›“80211_pow”_Ï‹v©ch
(
›“80211v­
 *);

44 
›“80211_pow”_vd‘ach
(
›“80211v­
 *);

46 
	g›“80211_node
;

48 
›“80211_node_§veq_d¿š
(
›“80211_node
 *);

49 
›“80211_node_§veq_age
(
›“80211_node
 *);

50 
›“80211_pwr§ve
(
sk_buff
 *);

51 
›“80211_node_pwr§ve
(
›“80211_node
 *, );

52 
›“80211_¡a_pwr§ve
(
›“80211v­
 *, );

	@ieee80211_proto.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/kmod.h
>

46 
	~<lšux/moduË.h
>

47 
	~<lšux/skbuff.h
>

48 
	~<lšux/Ãtdeviû.h
>

50 
	~"if_medŸ.h
"

52 
	~<Ãt80211/›“80211_v¬.h
>

55 
	#AGGRESSIVE_MODE_SWITCH_HYSTERESIS
 3

	)

56 
	#HIGH_PRI_SWITCH_THRESH
 10

	)

58 
	#IEEE80211_RATE2MBS
(
r
è((Ôè& 
IEEE80211_RATE_VAL
è/ 2)

	)

60 cÚ¡ *
	g›“80211_mgt_subty³_Çme
[] = {

66 
EXPORT_SYMBOL
(
›“80211_mgt_subty³_Çme
);

67 cÚ¡ *
	g›“80211_ùl_subty³_Çme
[] = {

73 
EXPORT_SYMBOL
(
›“80211_ùl_subty³_Çme
);

74 cÚ¡ *
	g›“80211_¡©e_Çme
[
IEEE80211_S_MAX
] = {

81 
EXPORT_SYMBOL
(
›“80211_¡©e_Çme
);

82 cÚ¡ *
	g›“80211_wme_aúames
[] = {

89 
EXPORT_SYMBOL
(
›“80211_wme_aúames
);

91 
›“80211_Ãw¡©e
(
›“80211v­
 *, 
›“80211_¡©e
, );

92 
›“80211_tx_timeout
();

93 #ifdeà
ATH_SUPERG_XR


94 
›“80211_¡¬t_xrv­
();

96 
›“80211_auth_£tup
();

99 
	$›“80211_´Ùo_©ch
(
›“80211com
 *
ic
)

102 
ic
->
ic_´Ùmode
 = 
IEEE80211_PROT_CTSONLY
;

103 
ic
->
ic_rssi_ewma
 = 0;

105 
ic
->
ic_wme
.
wme_hri_sw™ch_hy¡”esis
 =

106 
AGGRESSIVE_MODE_SWITCH_HYSTERESIS
;

109 
ic
->
ic_»cv_mgmt
 = 
›“80211_»cv_mgmt
;

110 
ic
->
ic_£nd_mgmt
 = 
›“80211_£nd_mgmt
;

112 
	`›“80211_auth_£tup
();

113 
	}
}

116 
	$›“80211_´Ùo_d‘ach
(
›“80211com
 *
ic
)

118 
	}
}

121 
	$›“80211_´Ùo_v©ch
(
›“80211v­
 *
v­
)

123 #ifdeà
nÙdef


124 
v­
->
iv_¹¡h»shŞd
 = 
IEEE80211_RTS_DEFAULT
;

126 
v­
->
iv_¹¡h»shŞd
 = 
IEEE80211_RTS_MAX
;

128 
v­
->
iv_äagth»shŞd
 = 2346;

129 
v­
->
iv_fixed_¿‹
 = 
IEEE80211_FIXED_RATE_NONE
;

130 
	`š™_tim”
(&
v­
->
iv_mgt£nd
);

131 
	`š™_tim”
(&
v­
->
iv_xrv­¡¬t
);

132 
	`š™_tim”
(&
v­
->
iv_swbmiss
);

133 
	`š™_tim”
(&
v­
->
iv_c§_tim”
);

134 
v­
->
iv_mgt£nd
.
funùiÚ
 = 
›“80211_tx_timeout
;

135 
v­
->
iv_mgt£nd
.
d©a
 = () vap;

138 
v­
->
iv_Ãw¡©e
 = 
›“80211_Ãw¡©e
;

139 
	}
}

142 
	$›“80211_´Ùo_vd‘ach
(
›“80211v­
 *
v­
)

149 ià(
v­
->
iv_auth
->
Ÿ_d‘ach
)

150 
v­
->
iv_auth
->
	`Ÿ_d‘ach
(vap);

155 ià(
v­
->
iv_aş
 !ğ
NULL
)

156 
v­
->
iv_aş
->
	`Ÿc_d‘ach
(vap);

157 
	}
}

163 
	#IEEE80211_AUTH_MAX
 (
IEEE80211_AUTH_WPA
+1)

	)

165 cÚ¡ *
	gauth_modÇmes
[
IEEE80211_AUTH_MAX
] = {

173 cÚ¡ 
›“80211_auth’tiÿtÜ
 *
	gauth’tiÿtÜs
[
IEEE80211_AUTH_MAX
];

175 cÚ¡ 
›“80211_auth’tiÿtÜ
 
	gauth_š‹º®
 = {

176 .
Ÿ_Çme
 = "wlan_internal",

177 .
	gŸ_©ch
 = 
NULL
,

178 .
	gŸ_d‘ach
 = 
NULL
,

179 .
	gŸ_node_još
 = 
NULL
,

180 .
	gŸ_node_Ëave
 = 
NULL
,

187 
	$›“80211_auth_£tup
()

189 
	`›“80211_auth’tiÿtÜ_»gi¡”
(
IEEE80211_AUTH_OPEN
, &
auth_š‹º®
);

190 
	`›“80211_auth’tiÿtÜ_»gi¡”
(
IEEE80211_AUTH_SHARED
, &
auth_š‹º®
);

191 
	`›“80211_auth’tiÿtÜ_»gi¡”
(
IEEE80211_AUTH_AUTO
, &
auth_š‹º®
);

192 
	}
}

194 cÚ¡ 
›“80211_auth’tiÿtÜ
 *

195 
	$›“80211_auth’tiÿtÜ_g‘
(
auth
)

197 ià(
auth
 >ğ
IEEE80211_AUTH_MAX
)

198  
NULL
;

199 ià(
auth’tiÿtÜs
[
auth
] =ğ
NULL
)

200 
	`›“80211_lßd_moduË
(
auth_modÇmes
[
auth
]);

201  
auth’tiÿtÜs
[
auth
];

202 
	}
}

205 
	$›“80211_auth’tiÿtÜ_»gi¡”
(
ty³
,

206 cÚ¡ 
›“80211_auth’tiÿtÜ
 *
auth
)

208 ià(
ty³
 >ğ
IEEE80211_AUTH_MAX
)

210 
auth’tiÿtÜs
[
ty³
] = 
auth
;

211 
	}
}

212 
EXPORT_SYMBOL
(
›“80211_auth’tiÿtÜ_»gi¡”
);

215 
	$›“80211_auth’tiÿtÜ_uÄegi¡”
(
ty³
)

217 ià(
ty³
 >ğ
IEEE80211_AUTH_MAX
)

219 
auth’tiÿtÜs
[
ty³
] = 
NULL
;

220 
	}
}

221 
EXPORT_SYMBOL
(
›“80211_auth’tiÿtÜ_uÄegi¡”
);

227 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *
	gback’d
 = 
NULL
;

230 
	$›“80211_auth’tiÿtÜ_back’d_»gi¡”
(

231 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *
be
)

233 
	`´štk
(
KERN_INFO
 "wÏn: % back’d„egi¡”ed\n", 
be
->
Ÿb_Çme
);

234 
back’d
 = 
be
;

235 
	}
}

236 
EXPORT_SYMBOL
(
›“80211_auth’tiÿtÜ_back’d_»gi¡”
);

239 
	$›“80211_auth’tiÿtÜ_back’d_uÄegi¡”
(

240 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 * 
be
)

242 ià(
back’d
 =ğ
be
)

243 
back’d
 = 
NULL
;

244 
	`´štk
(
KERN_INFO
 "wlan: %s backend unregistered\n",

245 
be
->
Ÿb_Çme
);

246 
	}
}

247 
EXPORT_SYMBOL
(
›“80211_auth’tiÿtÜ_back’d_uÄegi¡”
);

249 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *

250 
	$›“80211_auth’tiÿtÜ_back’d_g‘
(cÚ¡ *
Çme
)

252  
back’d
 && 
	`¡rcmp
(back’d->
Ÿb_Çme
, 
Çme
è=ğ0 ? back’d : 
NULL
;

253 
	}
}

254 
EXPORT_SYMBOL
(
›“80211_auth’tiÿtÜ_back’d_g‘
);

260 cÚ¡ 
›“80211_aş©Ü
 *
	gaş
 = 
NULL
;

263 
	$›“80211_aş©Ü_»gi¡”
(cÚ¡ 
›“80211_aş©Ü
 *
Ÿc
)

265 
	`´štk
(
KERN_INFO
 "wÏn: % aş…Şicy„egi¡”ed\n", 
Ÿc
->
Ÿc_Çme
);

266 
aş
 = 
Ÿc
;

267 
	}
}

268 
EXPORT_SYMBOL
(
›“80211_aş©Ü_»gi¡”
);

271 
	$›“80211_aş©Ü_uÄegi¡”
(cÚ¡ 
›“80211_aş©Ü
 *
Ÿc
)

273 ià(
aş
 =ğ
Ÿc
)

274 
aş
 = 
NULL
;

275 
	`´štk
(
KERN_INFO
 "wÏn: % aş…Şicy uÄegi¡”ed\n", 
Ÿc
->
Ÿc_Çme
);

276 
	}
}

277 
EXPORT_SYMBOL
(
›“80211_aş©Ü_uÄegi¡”
);

279 cÚ¡ 
›“80211_aş©Ü
 *

280 
	$›“80211_aş©Ü_g‘
(cÚ¡ *
Çme
)

282 ià(
aş
 =ğ
NULL
)

283 
	`›“80211_lßd_moduË
("wlan_acl");

284  
aş
 && 
	`¡rcmp
×ş->
Ÿc_Çme
, 
Çme
è=ğ0 ?‡ş : 
NULL
;

285 
	}
}

286 
EXPORT_SYMBOL
(
›“80211_aş©Ü_g‘
);

288 #ifdeà
IEEE80211_DEBUG


290 
	$›“80211_´št_essid
(cÚ¡ 
u_št8_t
 *
essid
, 
Ën
)

292 
i
;

293 cÚ¡ 
u_št8_t
 *
p
;

295 ià(
Ën
 > 
IEEE80211_NWID_LEN
)

296 
Ën
 = 
IEEE80211_NWID_LEN
;

298 
i
 = 0, 
p
 = 
essid
; i < 
Ën
; i++,…++) {

299 ià(*
p
 < ' ' || *p > 0x7e)

302 ià(
i
 =ğ
Ën
) {

303 
	`´štk
("\"");

304 
i
 = 0, 
p
 = 
essid
; i < 
Ën
; i++,…++)

305 
	`´štk
("%c", *
p
);

306 
	`´štk
("\"");

308 
	`´štk
("0x");

309 
i
 = 0, 
p
 = 
essid
; i < 
Ën
; i++,…++)

310 
	`´štk
("%02x", *
p
);

312 
	}
}

313 
EXPORT_SYMBOL
(
›“80211_´št_essid
);

316 
	$›“80211_dump_pkt
(
›“80211com
 *
ic
, cÚ¡ 
u_št8_t
 *
buf
,

317 
Ën
, 
¿‹
, 
rssi
, 
tx
)

319 cÚ¡ 
›“80211_äame
 *
wh
;

320 
i
;

322 
wh
 = (cÚ¡ 
›“80211_äame
 *)
buf
;

323 
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
) {

324 
IEEE80211_FC1_DIR_NODS
:

325 
	`´štk
("NoDS " 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr2
));

326 
	`´štk
("->" 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr1
));

327 
	`´štk
("(" 
MAC_FMT
 ")", 
	`MAC_ADDR
(
wh
->
i_addr3
));

329 
IEEE80211_FC1_DIR_TODS
:

330 
	`´štk
("ToDS " 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr2
));

331 
	`´štk
("->" 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr3
));

332 
	`´štk
("(" 
MAC_FMT
 ")", 
	`MAC_ADDR
(
wh
->
i_addr1
));

334 
IEEE80211_FC1_DIR_FROMDS
:

335 
	`´štk
("FrDS " 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr3
));

336 
	`´štk
("->" 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr1
));

337 
	`´štk
("(" 
MAC_FMT
 ")", 
	`MAC_ADDR
(
wh
->
i_addr2
));

339 
IEEE80211_FC1_DIR_DSTODS
:

340 
	`´štk
("InDS " 
MAC_FMT
, 
	`MAC_ADDR
((
u_št8_t
 *)&
wh
[1]));

341 
	`´štk
("->" 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr3
));

342 
	`´štk
("(" 
MAC_FMT
, 
	`MAC_ADDR
(
wh
->
i_addr2
));

343 
	`´štk
("->" 
MAC_FMT
 ")", 
	`MAC_ADDR
(
wh
->
i_addr1
));

346 
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
) {

347 
IEEE80211_FC0_TYPE_DATA
:

348 
	`´štk
(" data");

350 
IEEE80211_FC0_TYPE_MGT
:

351 
	`´štk
(" %s", 
›“80211_mgt_subty³_Çme
[

352 (
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
)

353 >> 
IEEE80211_FC0_SUBTYPE_SHIFT
]);

356 
	`´štk
("y³#%d", 
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
);

359 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
)) {

360 cÚ¡ 
›“80211_qosäame
 *
qwh
 =

361 (cÚ¡ 
›“80211_qosäame
 *)
buf
;

362 
	`´štk
(" QoS [TID %u%s]", 
qwh
->
i_qos
[0] & 
IEEE80211_QOS_TID
,

363 
qwh
->
i_qos
[0] & 
IEEE80211_QOS_ACKPOLICY
 ? " ACM" : "");

365 ià(
wh
->
i_fc
[1] & 
IEEE80211_FC1_PROT
) {

366 
off
;

368 ià(
tx
)

369 
off
 = 
	`›“80211_ªyhdr¥aû
(
ic
, 
wh
);

371 
off
 = 
	`›“80211_ªyhdrsize
(
wh
);

372 
	`´štk
(" Prot. [IV %.02x %.02x %.02x",

373 
buf
[
off
 + 0], buf[off + 1], buf[off + 2]);

374 ià(
buf
[
off
 + 
IEEE80211_WEP_IVLEN
] & 
IEEE80211_WEP_EXTIV
)

375 
	`´štk
(" %.02x %.02x %.02x",

376 
buf
[
off
 + 4], buf[off + 5], buf[off + 6]);

377 
	`´štk
(" KID %u]", 
buf
[
off
 + 
IEEE80211_WEP_IVLEN
] >> 6);

379 ià(
¿‹
 >= 0)

380 
	`´štk
(" %dM", 
¿‹
 / 2);

381 ià(
rssi
 >= 0)

382 
	`´štk
(" +%d", 
rssi
);

383 
	`´štk
("\n");

384 ià(
Ën
 > 0) {

385 
i
 = 0; i < 
Ën
; i++) {

386 ià((
i
 % 8) == 0)

387 
	`´štk
(" ");

388 ià((
i
 % 16) == 0)

389 
	`´štk
("\n");

390 
	`´štk
("%02x ", 
buf
[
i
]);

392 
	`´štk
("\n\n");

394 
	}
}

395 
EXPORT_SYMBOL
(
›“80211_dump_pkt
);

399 
	$›“80211_fix_¿‹
(
›“80211_node
 *
ni
, 
æags
)

401 
	#RV
(
v
è((vè& 
IEEE80211_RATE_VAL
)

	)

402 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

403 
›“80211com
 *
ic
 = 
ni
->
ni_ic
;

404 
i
, 
j
, 
ignÜe
, 
”rÜ
;

405 
ok¿‹
, 
bad¿‹
, 
fixed¿‹
;

406 
›“80211_¿‹£t
 *
¤s
, *
Äs
;

407 
u_št8_t
 
r
;

409 
”rÜ
 = 0;

410 
ok¿‹
 = 
bad¿‹
 = 
fixed¿‹
 = 0;

411 
¤s
 = &
ic
->
ic_sup_¿‹s
[
	`›“80211_chª2mode
(
ni
->
ni_chª
)];

412 
Äs
 = &
ni
->
ni_¿‹s
;

413 
fixed¿‹
 = 
IEEE80211_FIXED_RATE_NONE
;

414 
i
 = 0; i < 
Äs
->
rs_Ä©es
;) {

415 
ignÜe
 = 0;

416 ià(
æags
 & 
IEEE80211_F_DOSORT
) {

420 
j
 = 
i
 + 1; j < 
Äs
->
rs_Ä©es
; j++) {

421 ià(
	`RV
(
Äs
->
rs_¿‹s
[
i
]è> RVÒrs->rs_¿‹s[
j
])) {

422 
r
 = 
Äs
->
rs_¿‹s
[
i
];

423 
Äs
->
rs_¿‹s
[
i
] =‚rs->rs_¿‹s[
j
];

424 
Äs
->
rs_¿‹s
[
j
] = 
r
;

428 
r
 = 
Äs
->
rs_¿‹s
[
i
] & 
IEEE80211_RATE_VAL
;

429 
bad¿‹
 = 
r
;

435 ià(
r
 == 0) {

436 
Äs
->
rs_Ä©es
--;

437 
j
 = 
i
; j < 
Äs
->
rs_Ä©es
; j++)

438 
Äs
->
rs_¿‹s
[
j
] =‚rs->rs_rates[j + 1];

439 
Äs
->
rs_¿‹s
[
j
] = 0;

446 ià(
r
 =ğ
v­
->
iv_fixed_¿‹
)

447 
fixed¿‹
 = 
r
;

448 ià(
æags
 & 
IEEE80211_F_DONEGO
) {

452 
j
 = 0; j < 
¤s
->
rs_Ä©es
; j++) {

453 ià(
r
 =ğ
	`RV
(
¤s
->
rs_¿‹s
[
j
])) {

461 
Äs
->
rs_¿‹s
[
i
] = 
¤s
->rs_¿‹s[
j
];

465 ià(
j
 =ğ
¤s
->
rs_Ä©es
) {

474 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

475 (
Äs
->
rs_¿‹s
[
i
] & 
IEEE80211_RATE_BASIC
))

476 
”rÜ
++;

477 
ignÜe
++;

480 ià(
æags
 & 
IEEE80211_F_DODEL
) {

484 ià(
ignÜe
) {

485 
Äs
->
rs_Ä©es
--;

486 
j
 = 
i
; j < 
Äs
->
rs_Ä©es
; j++)

487 
Äs
->
rs_¿‹s
[
j
] =‚rs->rs_rates[j + 1];

488 
Äs
->
rs_¿‹s
[
j
] = 0;

492 ià(!
ignÜe
)

493 
ok¿‹
 = 
Äs
->
rs_¿‹s
[
i
];

494 
i
++;

496 ià(
ok¿‹
 =ğ0 || 
”rÜ
 != 0 ||

497 ((
æags
 & 
IEEE80211_F_DOFRATE
è&& 
fixed¿‹
 !ğ
v­
->
iv_fixed_¿‹
))

498  
bad¿‹
 | 
IEEE80211_RATE_BASIC
;

500  
	`RV
(
ok¿‹
);

501 #undeà
RV


502 
	}
}

508 
	$›“80211_»£t_”p
(
›“80211com
 *
ic
, 
›“80211_phymode
 
mode
)

510 
	#IS_11G
(
m
) \

511 ((
m
è=ğ
IEEE80211_MODE_11G
 || (mè=ğ
IEEE80211_MODE_TURBO_G
)

	)

513 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEPROT
;

521 ià(
	`IS_11G
(
mode
è^ IS_11G(
ic
->
ic_curmode
)) {

522 
ic
->
ic_nÚ”p¡a
 = 0;

523 
ic
->
ic_lÚg¦Ù¡a
 = 0;

531 
	`›“80211_£t_shÜt¦Ùtime
(
ic
,

532 
	`IEEE80211_IS_CHAN_A
(
ic
->
ic_curchª
) ||

533 (
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_curchª
) &&

534 
ic
->
ic_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

535 (
ic
->
ic_ÿps
 & 
IEEE80211_C_SHSLOT
)));

539 ià(
	`IEEE80211_IS_CHAN_A
(
ic
->
ic_curchª
) ||

540 (
ic
->
ic_ÿps
 & 
IEEE80211_C_SHPREAMBLE
)) {

541 
ic
->
ic_æags
 |ğ
IEEE80211_F_SHPREAMBLE
;

542 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEBARKER
;

544 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SHPREAMBLE
;

545 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEBARKER
;

547 #undeà
IS_11G


548 
	}
}

554 
	$›“80211_£t_shÜt¦Ùtime
(
›“80211com
 *
ic
, 
Úoff
)

556 ià(
Úoff
)

557 
ic
->
ic_æags
 |ğ
IEEE80211_F_SHSLOT
;

559 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SHSLOT
;

561 ià(
ic
->
ic_upd©e¦Ù
 !ğ
NULL
)

562 
ic
->
	`ic_upd©e¦Ù
(ic->
ic_dev
);

563 
	}
}

570 
	$›“80211_i£½_¿‹£t
(
›“80211com
 *
ic
, 
›“80211_¿‹£t
 *
rs
)

572 cÚ¡ 
¿‹s
[] = { 2, 4, 11, 22, 12, 24, 48 };

573 
i
, 
j
;

575 ià(
rs
->
rs_Ä©es
 < 
	`ARRAY_SIZE
(
¿‹s
))

577 
i
 = 0; i < 
	`ARRAY_SIZE
(
¿‹s
); i++) {

578 
j
 = 0; j < 
rs
->
rs_Ä©es
; j++) {

579 
r
 = 
rs
->
rs_¿‹s
[
j
] & 
IEEE80211_RATE_VAL
;

580 ià(
¿‹s
[
i
] =ğ
r
)

581 
Ãxt
;

582 ià(
r
 > 
¿‹s
[
i
])

586 
Ãxt
:

590 
	}
}

592 cÚ¡ 
›“80211_¿‹£t
 
	gbasic11g
[
IEEE80211_MODE_MAX
] = {

610 
	$›“80211_£t11gbasiü©es
(
›“80211_¿‹£t
 *
rs
, 
›“80211_phymode
 
mode
)

612 
i
, 
j
;

614 
	`KASSERT
(
mode
 < 
IEEE80211_MODE_MAX
, ("invalid mode %u", mode));

615 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++) {

616 
rs
->
rs_¿‹s
[
i
] &ğ
IEEE80211_RATE_VAL
;

617 
j
 = 0; j < 
basic11g
[
mode
].
rs_Ä©es
; j++)

618 ià(
basic11g
[
mode
].
rs_¿‹s
[
j
] =ğ
rs
->rs_¿‹s[
i
]) {

619 
rs
->
rs_¿‹s
[
i
] |ğ
IEEE80211_RATE_BASIC
;

623 
	}
}

629 
›“80211_phymode


630 
	$›“80211_g‘11gbasiü©es
(
›“80211_¿‹£t
 *
rs
)

632 
›“80211_¿‹£t
 
basic
;

633 
i
;

635 
	`mem£t
(&
basic
, 0, (basic));

636 
i
 = 0; i < 
rs
->
rs_Ä©es
; i++)

637 ià(
rs
->
rs_¿‹s
[
i
] & 
IEEE80211_RATE_BASIC
)

638 
basic
.
rs_¿‹s
[basic.
rs_Ä©es
++] =

639 
rs
->
rs_¿‹s
[
i
] & 
IEEE80211_RATE_VAL
;

640 
i
 = 0; i < 
IEEE80211_MODE_MAX
; i++)

641 ià(
	`memcmp
(&
basic
, &
basic11g
[
i
], (basic)) == 0)

642  
i
;

643  
IEEE80211_MODE_AUTO
;

644 
	}
}

647 
	$›“80211_wme_š™·¿ms
(
›“80211v­
 *
v­
)

649 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

651 
	`IEEE80211_LOCK_IRQ
(
ic
);

652 
	`›“80211_wme_š™·¿ms_locked
(
v­
);

653 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

654 
	}
}

657 
	$›“80211_wme_š™·¿ms_locked
(
›“80211v­
 *
v­
)

659 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

660 
›“80211_wme_¡©e
 *
wme
 = &
ic
->
ic_wme
;

661 
	sphyP¬amTy³
 {

662 
u_št8_t
 
aif¢
;

663 
u_št8_t
 
logcwmš
;

664 
u_št8_t
 
logcwmax
;

665 
u_št16_t
 
txİLim™
;

666 
u_št8_t
 
acm
;

668 
›“80211_phymode
 
mode
;

670 
phyP¬amTy³
 *
pPhyP¬am
, *
pBssPhyP¬am
;

672 
phyP¬amTy³
 
phyP¬amFÜAC_BE
[
IEEE80211_MODE_MAX
] = {

680 
phyP¬amTy³
 
phyP¬amFÜAC_BK
[
IEEE80211_MODE_MAX
] = {

688 
phyP¬amTy³
 
phyP¬amFÜAC_VI
[
IEEE80211_MODE_MAX
] = {

696 
phyP¬amTy³
 
phyP¬amFÜAC_VO
[
IEEE80211_MODE_MAX
] = {

705 
phyP¬amTy³
 
bssPhyP¬amFÜAC_BE
[
IEEE80211_MODE_MAX
] = {

713 
phyP¬amTy³
 
bssPhyP¬amFÜAC_VI
[
IEEE80211_MODE_MAX
] = {

721 
phyP¬amTy³
 
bssPhyP¬amFÜAC_VO
[
IEEE80211_MODE_MAX
] = {

730 
i
;

732 
	`IEEE80211_LOCK_ASSERT
(
ic
);

734 ià((
ic
->
ic_ÿps
 & 
IEEE80211_C_WME
) == 0)

742 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
)

743 
mode
 = 
	`›“80211_chª2mode
(
ic
->
ic_bsschª
);

745 
mode
 = 
IEEE80211_MODE_AUTO
;

746 
i
 = 0; i < 
WME_NUM_AC
; i++) {

747 
i
) {

748 
WME_AC_BK
:

749 
pPhyP¬am
 = &
phyP¬amFÜAC_BK
[
mode
];

750 
pBssPhyP¬am
 = &
phyP¬amFÜAC_BK
[
mode
];

752 
WME_AC_VI
:

753 
pPhyP¬am
 = &
phyP¬amFÜAC_VI
[
mode
];

754 
pBssPhyP¬am
 = &
bssPhyP¬amFÜAC_VI
[
mode
];

756 
WME_AC_VO
:

757 
pPhyP¬am
 = &
phyP¬amFÜAC_VO
[
mode
];

758 
pBssPhyP¬am
 = &
bssPhyP¬amFÜAC_VO
[
mode
];

760 
WME_AC_BE
:

762 
pPhyP¬am
 = &
phyP¬amFÜAC_BE
[
mode
];

763 
pBssPhyP¬am
 = &
bssPhyP¬amFÜAC_BE
[
mode
];

767 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

768 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_acm
 =

769 
pPhyP¬am
->
acm
;

770 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
 =

771 
pPhyP¬am
->
aif¢
;

772 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
 =

773 
pPhyP¬am
->
logcwmš
;

774 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
 =

775 
pPhyP¬am
->
logcwmax
;

776 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
 =

777 
pPhyP¬am
->
txİLim™
;

779 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_acm
 =

780 
pBssPhyP¬am
->
acm
;

781 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
 =

782 
pBssPhyP¬am
->
aif¢
;

783 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
 =

784 
pBssPhyP¬am
->
logcwmš
;

785 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
 =

786 
pBssPhyP¬am
->
logcwmax
;

787 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
 =

788 
pBssPhyP¬am
->
txİLim™
;

790 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_acm
 =

791 
pBssPhyP¬am
->
acm
;

792 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
 =

793 
pBssPhyP¬am
->
aif¢
;

794 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
 =

795 
pBssPhyP¬am
->
logcwmš
;

796 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
 =

797 
pBssPhyP¬am
->
logcwmax
;

798 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
 =

799 
pBssPhyP¬am
->
txİLim™
;

802 ià(
v­
->
iv_bss
 !ğ
NULL
) {

807 
wme
->
wme_hri_sw™ch_th»sh
 =

808 (
HIGH_PRI_SWITCH_THRESH
 * 
v­
->
iv_bss
->
ni_štv®
) / 100;

809 
	`›“80211_wme_upd©•¬ams_locked
(
v­
);

811 
	}
}

817 
	$›“80211_wme_upd©•¬ams_locked
(
›“80211v­
 *
v­
)

819 cÚ¡ sŒuù { 
u_št8_t
 
aif¢
; u_št8_ˆ
logcwmš
; u_št8_ˆ
logcwmax
; 
u_št16_t
 
txİLim™
;}

820 
phyP¬am
[
IEEE80211_MODE_MAX
] = {

827 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

828 
›“80211_wme_¡©e
 *
wme
 = &
ic
->
ic_wme
;

829 
›“80211_phymode
 
mode
;

830 
i
;

832 
	`IEEE80211_LOCK_ASSERT
(
v­
->
iv_ic
);

836 
i
 = 0; i < 
WME_NUM_AC
; i++) {

837 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
 =

838 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
;

839 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
 =

840 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
;

841 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
 =

842 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
;

843 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
 =

844 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
;

845 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
 =

846 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_aif¢
;

847 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
 =

848 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmš
;

849 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
 =

850 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_logcwmax
;

851 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
 =

852 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
i
].
wm•_txİLim™
;

861 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
)

862 
mode
 = 
	`›“80211_chª2mode
(
ic
->
ic_bsschª
);

864 
mode
 = 
IEEE80211_MODE_AUTO
;

865 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

866 (
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) != 0) ||

867 (
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
 &&

868 (
v­
->
iv_bss
->
ni_æags
 & 
IEEE80211_NODE_QOS
) == 0) ||

869 (
v­
->
iv_æags
 & 
IEEE80211_F_WME
) == 0) {

870 
›“80211v­
 *
tmpv­
;

871 
u_št8_t
 
bur¡EÇbËd
 = 0;

873 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

874 ià(
tmpv­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_BURST
) {

875 
bur¡EÇbËd
 = 1;

879 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_aif¢
 =

880 
phyP¬am
[
mode
].
aif¢
;

881 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmš
 =

882 
phyP¬am
[
mode
].
logcwmš
;

883 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmax
 =

884 
phyP¬am
[
mode
].
logcwmax
;

885 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_txİLim™
 =

886 
bur¡EÇbËd
 ? 
phyP¬am
[
mode
].
txİLim™
 : 0;

887 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_aif¢
 =

888 
phyP¬am
[
mode
].
aif¢
;

889 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmš
 =

890 
phyP¬am
[
mode
].
logcwmš
;

891 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmax
 =

892 
phyP¬am
[
mode
].
logcwmax
;

893 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_txİLim™
 =

894 
bur¡EÇbËd
 ? 
phyP¬am
[
mode
].
txİLim™
 : 0;

897 ià(
ic
->
ic_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

898 
ic
->
ic_¡a_assoc
 < 2 && (
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) != 0) {

899 cÚ¡ 
u_št8_t
 
logCwMš
[
IEEE80211_MODE_MAX
] = {

909 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmš
 =

910 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
WME_AC_BE
].
wm•_logcwmš
 =

911 
logCwMš
[
mode
];

913 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

918 
wme
->
wme_bssChªP¬ams
.
ÿp_šfo_couÁ
 =

919 (
wme
->
wme_bssChªP¬ams
.
ÿp_šfo_couÁ
 + 1è& 
WME_QOSINFO_COUNT
;

920 
v­
->
iv_æags
 |ğ
IEEE80211_F_WMEUPDATE
;

923 
wme
->
	`wme_upd©e
(
ic
);

925 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_WME
,

926 "%s: WME…¬am upd©ed, c­_šfØ0x%x\n", 
__func__
,

927 
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ?

928 
wme
->
wme_wmeChªP¬ams
.
ÿp_šfo_couÁ
 :

929 
wme
->
wme_bssChªP¬ams
.
ÿp_šfo_couÁ
);

930 
	}
}

932 
EXPORT_SYMBOL
(
›“80211_wme_upd©•¬ams
);

935 
	$›“80211_wme_upd©•¬ams
(
›“80211v­
 *
v­
)

937 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

939 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_WME
) {

940 
	`IEEE80211_LOCK_IRQ
(
ic
);

941 
	`›“80211_wme_upd©•¬ams_locked
(
v­
);

942 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

944 
	}
}

951 
	$›“80211_š™
(
Ãt_deviû
 *
dev
, 
fÜûsÿn
)

953 
	#IS_RUNNING
(
_dev
) \

954 ((
_dev
->
æags
 & (
IFF_RUNNING
|
IFF_UP
)è=ğ(IFF_RUNNING|IFF_UP))

	)

955 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

956 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

957 
Ãt_deviû
 *
·»Á
 = 
ic
->
ic_dev
;

959 
	`IEEE80211_DPRINTF
(
v­
,

960 
IEEE80211_MSG_STATE
 | 
IEEE80211_MSG_DEBUG
,

961 "¡¬ˆruÂšg (¡©e=%d)\n", 
v­
->
iv_¡©e
);

964 ià((
dev
->
æags
 & 
IFF_RUNNING
) == 0) {

965 ià(
ic
->
ic_nİ’ed
++ == 0 &&

966 (
·»Á
->
æags
 & 
IFF_RUNNING
) == 0)

967 
	`dev_İ’
(
·»Á
);

972 
dev
->
æags
 |ğ
IFF_RUNNING
;

979 ià(
	`IS_RUNNING
(
ic
->
ic_dev
)) {

980 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

981 ià(
ic
->
ic_rßmšg
 !ğ
IEEE80211_ROAMING_MANUAL
) {

988 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
 ||

989 
fÜûsÿn
) {

990 
	`IEEE80211_DPRINTF
(
v­
,

991 
IEEE80211_MSG_STATE
 |

992 
IEEE80211_MSG_DEBUG
,

995 
v­
, v­->
iv_nickÇme
,

996 
›“80211_¡©e_Çme


997 [
IEEE80211_S_SCAN
]);

998 
	`›“80211_Ãw_¡©e
(
v­
,

999 
IEEE80211_S_SCAN
, 0);

1001 
	`IEEE80211_DPRINTF
(
v­
,

1002 
IEEE80211_MSG_STATE
 |

1003 
IEEE80211_MSG_DEBUG
,

1006 
v­
, v­->
iv_nickÇme
,

1007 
›“80211_¡©e_Çme


1008 [
IEEE80211_S_ASSOC
]);

1009 
	`›“80211_Ãw_¡©e
(
v­
,

1010 
IEEE80211_S_ASSOC
, 1);

1018 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

1019 
	`IEEE80211_DPRINTF
(
v­
,

1020 
IEEE80211_MSG_STATE
 |

1021 
IEEE80211_MSG_DEBUG
,

1023 
v­
, v­->
iv_nickÇme
,

1024 
›“80211_¡©e_Çme


1025 [
IEEE80211_S_INIT
]);

1026 
	`›“80211_Ãw_¡©e
(
v­
,

1027 
IEEE80211_S_INIT
, -1);

1036 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
 ||

1037 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) {

1038 
	`IEEE80211_DPRINTF
(
v­
,

1039 
IEEE80211_MSG_STATE
 |

1040 
IEEE80211_MSG_DEBUG
,

1042 
v­
, v­->
iv_nickÇme
,

1043 
›“80211_¡©e_Çme


1044 [
IEEE80211_S_RUN
]);

1045 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_RUN
, -1);

1047 
	`IEEE80211_DPRINTF
(
v­
,

1048 
IEEE80211_MSG_STATE
 |

1049 
IEEE80211_MSG_DEBUG
,

1051 
v­
, v­->
iv_nickÇme
,

1052 
›“80211_¡©e_Çme


1053 [
IEEE80211_S_SCAN
]);

1054 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

1060 #undeà
IS_RUNNING


1061 
	}
}

1064 
	$›“80211_İ’
(
Ãt_deviû
 *
dev
)

1066  
	`›“80211_š™
(
dev
, 0);

1067 
	}
}

1073 
	$›“80211_¡¬t_ruÂšg
(
›“80211com
 *
ic
)

1075 
›“80211v­
 *
v­
;

1076 
Ãt_deviû
 *
dev
;

1079 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1080 
dev
 = 
v­
->
iv_dev
;

1082 ià((
dev
->
æags
 & 
IFF_UP
è&& !(dev->æag & 
IFF_RUNNING
))

1083 
	`›“80211_İ’
(
dev
);

1085 
	}
}

1086 
EXPORT_SYMBOL
(
›“80211_¡¬t_ruÂšg
);

1096 
	$›“80211_¡İ
(
Ãt_deviû
 *
dev
)

1098 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1099 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1100 
Ãt_deviû
 *
·»Á
 = 
ic
->
ic_dev
;

1102 
	`IEEE80211_DPRINTF
(
v­
,

1103 
IEEE80211_MSG_STATE
 | 
IEEE80211_MSG_DEBUG
,

1106 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_INIT
, -1);

1107 ià(
dev
->
æags
 & 
IFF_RUNNING
) {

1108 
dev
->
æags
 &ğ~
IFF_RUNNING
;

1109 
	`d–_tim”
(&
v­
->
iv_mgt£nd
);

1110 ià(--
ic
->
ic_nİ’ed
 =ğ0 && (
·»Á
->
æags
 & 
IFF_RUNNING
))

1111 
	`dev_şo£
(
·»Á
);

1113 #ifdeà
ATH_SUPERG_XR


1117 ià(
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
)) {

1118 
	`›“80211_¡İ
(
v­
->
iv_xrv­
->
iv_dev
);

1119 
	`d–_tim”
(&
v­
->
iv_xrv­¡¬t
);

1120 
v­
->
iv_xrv­
->
iv_dev
->
æags
 = 
dev
->flags;

1124 
	}
}

1125 
EXPORT_SYMBOL
(
›“80211_¡İ
);

1131 
	$›“80211_¡İ_ruÂšg
(
›“80211com
 *
ic
)

1133 
›“80211v­
 *
v­
;

1134 
Ãt_deviû
 *
dev
;

1137 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1138 
dev
 = 
v­
->
iv_dev
;

1139 ià(
dev
->
æags
 & 
IFF_RUNNING
)

1140 
	`›“80211_¡İ
(
dev
);

1142 
	}
}

1143 
EXPORT_SYMBOL
(
›“80211_¡İ_ruÂšg
);

1145 #ifdeà
ATH_SUPERG_DYNTURBO


1153 
	$›“80211_dturbo_sw™ch
(
›“80211com
 *
ic
, 
Ãwæags
)

1155 #ifdeà
IEEE80211_DEBUG


1157 
›“80211v­
 *
v­
 = 
	`TAILQ_FIRST
(&
ic
->
ic_v­s
);

1159 
›“80211_chªÃl
 *
chª
;

1161 
chª
 = 
	`›“80211_fšd_chªÃl
(
ic
, ic->
ic_bsschª
->
ic_äeq
, 
Ãwæags
);

1162 ià(
chª
 =ğ
NULL
) {

1163 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

1165 
__func__
, 
ic
->
ic_bsschª
->
ic_äeq
, 
Ãwæags
);

1169 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SUPG
,

1170 "%s: % -> % (äeq %u fÏg 0x%x)\n", 
__func__
,

1171 
›“80211_phymode_Çme
[
	`›“80211_chª2mode
(
ic
->
ic_bsschª
)],

1172 
›“80211_phymode_Çme
[
	`›“80211_chª2mode
(
chª
)],

1173 
chª
->
ic_äeq
, chª->
ic_æags
);

1175 
ic
->
ic_bsschª
 = 
chª
;

1176 
ic
->
ic_curchª
 = 
chª
;

1177 
ic
->
	`ic_£t_chªÃl
(ic);

1179 
	}
}

1180 
EXPORT_SYMBOL
(
›“80211_dturbo_sw™ch
);

1184 
	$›“80211_b—cÚ_miss
(
›“80211com
 *
ic
)

1186 
›“80211v­
 *
v­
;

1188 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) {

1193 
	`TAILQ_FOREACH
(
v­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1194 
	`IEEE80211_DPRINTF
(
v­
,

1195 
IEEE80211_MSG_STATE
 | 
IEEE80211_MSG_DEBUG
,

1203 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
 ||

1204 
v­
->
iv_¡©e
 !ğ
IEEE80211_S_RUN
)

1206 ià(
ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
) {

1207 #ifdeà
ATH_SUPERG_DYNTURBO


1213 ià(
	`IEEE80211_ATH_CAP
(
v­
, v­->
iv_bss
, 
IEEE80211_ATHC_TURBOP
))

1214 
	`›“80211_dturbo_sw™ch
(
ic
,

1215 
ic
->
ic_bsschª
->
ic_æags
 ^

1216 
IEEE80211_CHAN_TURBO
);

1221 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_ASSOC
, 1);

1229 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

1232 
	}
}

1233 
EXPORT_SYMBOL
(
›“80211_b—cÚ_miss
);

1240 
	$›“80211_¡a_swbmiss
(
¬g
)

1242 
›“80211v­
 *
v­
 = (›“80211v­ *)
¬g
;

1243 
	`›“80211_b—cÚ_miss
(
v­
->
iv_ic
);

1244 
	}
}

1251 
	$›“80211_tx_timeout
(
¬g
)

1253 
›“80211v­
 *
v­
 = (›“80211v­ *)
¬g
;

1255 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_STATE
,

1256 "%s: s‹ %s%s\n", 
__func__
,

1257 
›“80211_¡©e_Çme
[
v­
->
iv_¡©e
],

1258 
v­
->
iv_ic
->
ic_æags
 & 
IEEE80211_F_SCAN
 ? ", scan‡ctive" : "");

1260 ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_INIT
 &&

1261 (
v­
->
iv_ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0) {

1266 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
,

1267 
IEEE80211_SCAN_FAIL_TIMEOUT
);

1269 
	}
}

1272 
	$¡a_di§ssoc
(*
¬g
, 
›“80211_node
 *
ni
)

1274 
›“80211v­
 *
v­
 = 
¬g
;

1276 ià(
ni
->
ni_v­
 =ğ
v­
 &&‚i->
ni_associd
 != 0) {

1277 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_DISASSOC
,

1278 
IEEE80211_REASON_ASSOC_LEAVE
);

1279 
	`›“80211_node_Ëave
(
ni
);

1281 
	}
}

1284 
	$¡a_d—uth
(*
¬g
, 
›“80211_node
 *
ni
)

1286 
›“80211v­
 *
v­
 = 
¬g
;

1288 ià(
ni
->
ni_v­
 =ğ
v­
)

1289 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

1290 
IEEE80211_REASON_ASSOC_LEAVE
);

1291 
	}
}

1297 
	$›“80211_Ãw_¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
n¡©e
, 
¬g
)

1299 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1300 
rc
;

1302 
	`IEEE80211_VAPS_LOCK_BH
(
ic
);

1303 
rc
 = 
v­
->
	`iv_Ãw¡©e
(v­, 
n¡©e
, 
¬g
);

1304 
	`IEEE80211_VAPS_UNLOCK_BH
(
ic
);

1305  
rc
;

1306 
	}
}

1309 
	$__›“80211_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
n¡©e
, 
¬g
)

1311 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1312 
›“80211_node
 *
ni
;

1313 
›“80211_¡©e
 
o¡©e
;

1315 
o¡©e
 = 
v­
->
iv_¡©e
;

1316 
v­
->
iv_¡©e
 = 
n¡©e
;

1317 
	`d–_tim”
(&
v­
->
iv_mgt£nd
);

1318 ià((
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
) &&

1319 (
o¡©e
 !ğ
IEEE80211_S_SCAN
))

1320 
	`›“80211_ÿnûl_sÿn
(
v­
);

1321 
ni
 = 
v­
->
iv_bss
;

1322 
n¡©e
) {

1323 
IEEE80211_S_INIT
:

1324 
o¡©e
) {

1325 
IEEE80211_S_INIT
:

1327 
IEEE80211_S_RUN
:

1328 
v­
->
iv_İmode
) {

1329 
IEEE80211_M_STA
:

1330 
	`IEEE80211_SEND_MGMT
(
ni
,

1331 
IEEE80211_FC0_SUBTYPE_DISASSOC
,

1332 
IEEE80211_REASON_ASSOC_LEAVE
);

1333 
	`›“80211_¡a_Ëave
(
ni
);

1335 
IEEE80211_M_HOSTAP
:

1336 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
,

1337 
¡a_di§ssoc
, 
v­
);

1342 
»£t
;

1343 
IEEE80211_S_ASSOC
:

1344 
v­
->
iv_İmode
) {

1345 
IEEE80211_M_STA
:

1346 
	`IEEE80211_SEND_MGMT
(
ni
,

1347 
IEEE80211_FC0_SUBTYPE_DEAUTH
,

1348 
IEEE80211_REASON_AUTH_LEAVE
);

1350 
IEEE80211_M_HOSTAP
:

1351 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
,

1352 
¡a_d—uth
, 
v­
);

1357 
»£t
;

1358 
IEEE80211_S_SCAN
:

1359 
	`›“80211_ÿnûl_sÿn
(
v­
);

1360 
»£t
;

1361 
IEEE80211_S_AUTH
:

1362 
»£t
:

1363 
	`›“80211_»£t_bss
(
v­
);

1366 ià(
v­
->
iv_auth
 !ğ
NULL
 && v­->iv_auth->
Ÿ_d‘ach
 != NULL)

1367 
v­
->
iv_auth
->
	`Ÿ_d‘ach
(vap);

1369 
IEEE80211_S_SCAN
:

1370 
o¡©e
) {

1371 
IEEE80211_S_INIT
:

1372 
ü—‹ibss
:

1373 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

1374 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
 ||

1375 
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
) &&

1376 
v­
->
iv_des_chª
 !ğ
IEEE80211_CHAN_ANYC
) {

1381 
	`›“80211_ü—‹_ibss
(
v­
, v­->
iv_des_chª
);

1383 
	`›“80211_check_sÿn
(
v­
,

1384 
IEEE80211_SCAN_ACTIVE
 |

1385 
IEEE80211_SCAN_FLUSH
,

1386 
IEEE80211_SCAN_FOREVER
,

1387 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
,

1388 
NULL
);

1391 
IEEE80211_S_SCAN
:

1392 
IEEE80211_S_AUTH
:

1393 
IEEE80211_S_ASSOC
:

1405 ià(
¬g
 != 0)

1406 
	`›“80211_sÿn_assoc_ç
(
ic
,

1407 
v­
->
iv_bss
->
ni_maÿddr
, 
¬g
);

1408 ià(
ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
)

1409 
	`›“80211_check_sÿn
(
v­
,

1410 
IEEE80211_SCAN_ACTIVE
,

1411 
IEEE80211_SCAN_FOREVER
,

1412 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
,

1413 
NULL
);

1415 
IEEE80211_S_RUN
:

1416 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

1417 
	`›“80211_¡a_Ëave
(
ni
);

1418 
v­
->
iv_æags
 &ğ~
IEEE80211_F_SIBSS
;

1419 ià(
ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
)

1420 
	`›“80211_check_sÿn
(
v­
,

1421 
IEEE80211_SCAN_ACTIVE
,

1422 
IEEE80211_SCAN_FOREVER
,

1423 
v­
->
iv_des_nssid
,

1424 
v­
->
iv_des_ssid
,

1425 
NULL
);

1427 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
,

1428 
¡a_di§ssoc
, 
v­
);

1429 
ü—‹ibss
;

1434 
IEEE80211_S_AUTH
:

1437 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ||

1438 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
,

1440 
›“80211_¡©e_Çme
[
n¡©e
], 
v­
->
iv_İmode
));

1441 
o¡©e
) {

1442 
IEEE80211_S_INIT
:

1443 
IEEE80211_S_SCAN
:

1444 
	`IEEE80211_SEND_MGMT
(
ni
, 
IEEE80211_FC0_SUBTYPE_AUTH
, 1);

1446 
IEEE80211_S_AUTH
:

1447 
IEEE80211_S_ASSOC
:

1448 
¬g
) {

1449 
IEEE80211_FC0_SUBTYPE_AUTH
:

1451 
	`IEEE80211_SEND_MGMT
(
ni
,

1452 
IEEE80211_FC0_SUBTYPE_AUTH
, 2);

1454 
IEEE80211_FC0_SUBTYPE_DEAUTH
:

1455 
	`IEEE80211_SEND_MGMT
(
ni
,

1456 
IEEE80211_FC0_SUBTYPE_AUTH
, 1);

1460 
IEEE80211_S_RUN
:

1461 
¬g
) {

1462 
IEEE80211_FC0_SUBTYPE_AUTH
:

1463 
	`IEEE80211_SEND_MGMT
(
ni
,

1464 
IEEE80211_FC0_SUBTYPE_AUTH
, 2);

1465 
v­
->
iv_¡©e
 = 
o¡©e
;

1467 
IEEE80211_FC0_SUBTYPE_DEAUTH
:

1468 
	`›“80211_¡a_Ëave
(
ni
);

1469 ià(
ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
) {

1471 
	`IEEE80211_SEND_MGMT
(
ni
,

1472 
IEEE80211_FC0_SUBTYPE_AUTH
, 1);

1479 
IEEE80211_S_ASSOC
:

1480 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
,

1482 
›“80211_¡©e_Çme
[
n¡©e
], 
v­
->
iv_İmode
));

1483 
o¡©e
) {

1484 
IEEE80211_S_INIT
:

1485 
IEEE80211_S_SCAN
:

1486 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ANY
,

1487 "%s: inv®id¿ns™iÚ\n", 
__func__
);

1489 
IEEE80211_S_AUTH
:

1490 
IEEE80211_S_ASSOC
:

1491 
	`IEEE80211_SEND_MGMT
(
ni
,

1492 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
, 0);

1494 
IEEE80211_S_RUN
:

1495 
	`›“80211_¡a_Ëave
(
ni
);

1496 ià(
ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
) {

1498 
	`IEEE80211_SEND_MGMT
(
ni
, 
¬g
 ?

1499 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
 :

1500 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
, 0);

1505 
IEEE80211_S_RUN
:

1506 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
) {

1510 
o¡©e
) {

1511 
IEEE80211_S_INIT
:

1512 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
 ||

1513 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
 ||

1514 
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

1519 
	`›“80211_ü—‹_ibss
(
v­
, 
ic
->
ic_curchª
);

1522 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) {

1524 
›“80211_node
 *
wds_ni
 =

1525 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
,

1526 
v­
->
wds_mac
);

1528 ià(
wds_ni
 =ğ
NULL
) {

1529 
wds_ni
 = 
	`›“80211_®loc_node_bË
(

1530 
v­
,

1531 
v­
->
wds_mac
);

1532 ià(
wds_ni
 !ğ
NULL
) {

1533 
	`›“80211_add_wds_addr
(

1534 &
ic
->
ic_¡a
,

1535 
wds_ni
,

1536 
v­
->
wds_mac
,

1538 
	`›“80211_»f_node
(
wds_ni
);

1541 
	`IEEE80211_DPRINTF
(

1542 
v­
,

1543 
IEEE80211_MSG_NODE
,

1546 "WDS: " 
MAC_FMT
 "\n",

1547 
__func__
,

1548 
	`MAC_ADDR
(

1549 
v­
->
wds_mac
)

1553 ià(
wds_ni
 !ğ
NULL
) {

1554 
	`›“80211_node_authÜize
(
wds_ni
);

1555 
wds_ni
->
ni_chª
 =

1556 
v­
->
iv_bss
->
ni_chª
;

1557 
wds_ni
->
ni_ÿpšfo
 =

1558 
ni
->
ni_ÿpšfo
;

1559 
wds_ni
->
ni_associd
 = 1;

1560 
wds_ni
->
ni_©h_æags
 =

1561 
v­
->
iv_©h_ÿp
;

1567 
IEEE80211_S_AUTH
:

1568 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ANY
,

1569 "%s: inv®id¿ns™iÚ\n", 
__func__
);

1571 
IEEE80211_S_RUN
:

1573 
IEEE80211_S_SCAN
:

1574 
IEEE80211_S_ASSOC
:

1575 
	`KASSERT
(
ni
->
ni_tx¿‹
 <‚i->
ni_¿‹s
.
rs_Ä©es
,

1576 ("%s: bogu xm™„©%u s‘up", 
__func__
,

1577 
ni
->
ni_tx¿‹
));

1578 #ifdeà
IEEE80211_DEBUG


1579 ià(
	`›“80211_msg_debug
(
v­
)) {

1580 
	`›“80211_nÙe
(
v­
, "% w™h " 
MAC_FMT
 " ssid ",

1581 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ?

1583 
	`MAC_ADDR
(
v­
->
iv_bssid
));

1584 
	`›“80211_´št_essid
(
v­
->
iv_bss
->
ni_essid
,

1585 
ni
->
ni_es¦’
);

1586 
	`´štk
(" channel %d start %uMb\n",

1587 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
),

1588 
	`IEEE80211_RATE2MBS
(
ni
->
ni_¿‹s
.
rs_¿‹s
[ni->
ni_tx¿‹
]));

1591 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

1592 
	`›“80211_sÿn_assoc_sucûss
(
ic
,

1593 
ni
->
ni_maÿddr
);

1594 
	`›“80211_nÙify_node_još
(
ni
,

1595 (
¬g
 =ğ
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
) | \

1596 (
¬g
 =ğ
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
));

1602 ià(
o¡©e
 !ğ
IEEE80211_S_RUN
 &&

1603 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 &&

1604 
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_SWBMISS
)) {

1605 
v­
->
iv_swbmiss
.
funùiÚ
 = 
›“80211_¡a_swbmiss
;

1606 
v­
->
iv_swbmiss
.
d©a
 = () vap;

1607 
v­
->
iv_swbmiss_³riod
 = 
	`IEEE80211_TU_TO_JIFFIES
(

1608 
v­
->
iv_ic
->
ic_bmis¡h»shŞd
 * 
ni
->
ni_štv®
);

1610 
	`mod_tim”
(&
v­
->
iv_swbmiss
, 
jiff›s
 + v­->
iv_swbmiss_³riod
);

1619 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 &&

1620 
v­
->
iv_auth
->
Ÿ_©ch
 !ğ
NULL
) {

1622 
v­
->
iv_auth
->
	`Ÿ_©ch
(vap);

1623 } ià(
v­
->
iv_auth
->
Ÿ_d‘ach
 !ğ
NULL
)

1624 
v­
->
iv_auth
->
	`Ÿ_d‘ach
(vap);

1629 ià(
ni
->
ni_authmode
 !ğ
IEEE80211_AUTH_8021X
)

1630 
	`›“80211_node_authÜize
(
ni
);

1631 #ifdeà
ATH_SUPERG_XR


1635 ià(
o¡©e
 !ğ
IEEE80211_S_RUN
 &&

1636 
v­
->
iv_xrv­
 &&

1637 !(
v­
->
iv_æags
 & 
IEEE80211_F_XR
)) {

1638 
v­
->
iv_xrv­¡¬t
.
funùiÚ
 = 
›“80211_¡¬t_xrv­
;

1639 
v­
->
iv_xrv­¡¬t
.
d©a
 = (èv­->
iv_xrv­
;

1640 
	`mod_tim”
(&
v­
->
iv_xrv­¡¬t
, 
jiff›s
 + 
HZ
);

1648 ià(
v­
->
iv_xrv­
->
iv_æags_ext
 & 
IEEE80211_FEXT_SCAN_PENDING
)

1649 
v­
->
iv_xrv­
->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_SCAN_PENDING
;

1656 ià(
v­
->
iv_æags
 & 
IEEE80211_F_XR
)

1657 
v­
->
iv_xrv­
->
iv_æags
 |ğ
IEEE80211_F_XRUPDATE
;

1662 
	}
}

1666 
	$g‘_domšªt_¡©e
(
›“80211com
 *
ic
) {

1667 
nsÿÂšg
 = 0;

1668 
ÄuÂšg
 = 0;

1669 
›“80211v­
 *
tmpv­
;

1671 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1672 ià(
tmpv­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
)

1678 ià(
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
)

1679 
ÄuÂšg
++;

1680 ià(
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_SCAN
 ||

1681 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_AUTH
 ||

1682 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_ASSOC
) {

1683 
	`KASSERT
((
nsÿÂšg
 <= 1), ("Two VAPs cannot scan‡t "

1685 
nsÿÂšg
++;

1688 
	`KASSERT
(!(
nsÿÂšg
 && 
ÄuÂšg
), ("SCAN‡nd RUN can't happen‡the "

1690 
	`KASSERT
((
nsÿÂšg
 <= 1), ("Two VAPs must‚ot SCAN‡the "

1693 ià(
ÄuÂšg
 > 0)

1694  
IEEE80211_S_RUN
;

1695 ià(
nsÿÂšg
 > 0)

1696  
IEEE80211_S_SCAN
;

1698  
IEEE80211_S_INIT
;

1699 
	}
}

1702 
	$dump_v­_¡©es
(
›“80211com
 *
ic
, 
›“80211v­
 *
highlighed
)

1705 
ÄuÂšg
 = 0;

1706 
nsÿÂšg
 = 0;

1707 
›“80211v­
 *
tmpv­
;

1708 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1709 
	`IEEE80211_DPRINTF
(
tmpv­
, 
IEEE80211_MSG_STATE
,

1710 "%s: VAP %s%p[%24s]% ğ%s%s%s.\n", 
__func__
,

1711 (
highlighed
 =ğ
tmpv­
 ? "*" : " "),

1712 
tmpv­
,mpv­->
iv_nickÇme
,

1713 (
highlighed
 =ğ
tmpv­
 ? "*" : " "),

1714 
›“80211_¡©e_Çme
[
tmpv­
->
iv_¡©e
],

1715 (
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) ?

1717 (
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_SCAN
 ||

1718 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_AUTH
 ||

1719 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_ASSOC
) ?

1723 ià(
tmpv­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
) {

1726 ià(
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

1727 
	`KASSERT
((
nsÿÂšg
 == 0), ("SCAN‡nd RUN can't happen "

1729 
ÄuÂšg
++;

1731 ià(
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_SCAN
 ||

1733 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_AUTH
 ||

1734 
tmpv­
->
iv_¡©e
 =ğ
IEEE80211_S_ASSOC
) {

1735 
	`KASSERT
((
nsÿÂšg
 == 0), ("Two VAPs cannot scan‡t "

1737 
	`KASSERT
((
ÄuÂšg
 == 0), ("SCAN‡nd RUN can't happen "

1739 
nsÿÂšg
++;

1742 
	}
}

1745 
	$›“80211_Ãw¡©e
(
›“80211v­
 *
v­
, 
›“80211_¡©e
 
n¡©e
, 
¬g
)

1747 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1748 
›“80211_¡©e
 
o¡©e
;

1749 
›“80211_¡©e
 
d¡©e
;

1750 
blocked
 = 0;

1751 
›“80211v­
 *
tmpv­
;

1753 
o¡©e
 = 
v­
->
iv_¡©e
;

1754 
d¡©e
 = 
	`g‘_domšªt_¡©e
(
ic
);

1756 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_STATE
,

1758 
__func__
, 
v­
, v­->
iv_nickÇme
,

1759 
›“80211_¡©e_Çme
[
o¡©e
],

1760 
›“80211_¡©e_Çme
[
n¡©e
],

1761 
›“80211_¡©e_Çme
[
d¡©e
]);

1763 
n¡©e
) {

1764 
IEEE80211_S_AUTH
:

1765 
IEEE80211_S_ASSOC
:

1766 
IEEE80211_S_SCAN
:

1767 
d¡©e
) {

1768 
IEEE80211_S_RUN
:

1769 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
 ||

1770 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
 ||

1771 
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

1772 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_STATE
,

1775 
__func__
, 
v­
,

1776 
v­
->
iv_nickÇme
);

1780 
	`__›“80211_Ãw¡©e
(
v­
, 
IEEE80211_S_RUN
, 
¬g
);

1784 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_SCAN_PENDING
;

1789 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1790 ià((
v­
 !ğ
tmpv­
) &&

1791 (
tmpv­
->
iv_İmode
 !=

1792 
IEEE80211_M_MONITOR
)) {

1793 
	`IEEE80211_DPRINTF
(
v­
,

1794 
IEEE80211_MSG_STATE
,

1800 
__func__
,

1801 
tmpv­
,

1802 
tmpv­
->

1803 
iv_nickÇme
);

1804 
tmpv­
->
iv_æags_ext
 |=

1805 
IEEE80211_FEXT_SCAN_PENDING
;

1806 ià(
tmpv­
->
iv_¡©e
 !=

1807 
IEEE80211_S_INIT
) {

1808 
	`IEEE80211_DPRINTF
(
v­
,

1809 
IEEE80211_MSG_STATE
,

1818 
__func__
,

1819 
tmpv­
,

1820 
tmpv­
->

1821 
iv_nickÇme
);

1822 
tmpv­
->
	`iv_Ãw¡©e
(tmpvap,

1823 
IEEE80211_S_INIT
,

1826 
	`IEEE80211_DPRINTF
(
v­
,

1827 
IEEE80211_MSG_STATE
,

1837 
__func__
,

1838 
tmpv­
,

1839 
tmpv­
->

1840 
iv_nickÇme
);

1845 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_SCAN_PENDING
;

1847 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1851 
IEEE80211_S_SCAN
:

1852 
IEEE80211_S_AUTH
:

1853 
IEEE80211_S_ASSOC
:

1856 ià(
o¡©e
 =ğ
IEEE80211_S_SCAN
 ||

1857 
o¡©e
 =ğ
IEEE80211_S_AUTH
 ||

1858 
o¡©e
 =ğ
IEEE80211_S_ASSOC
) {

1861 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1865 
v­
->
iv_æags_ext
 |=

1866 
IEEE80211_FEXT_SCAN_PENDING
;

1867 
	`__›“80211_Ãw¡©e
(
v­
, 
IEEE80211_S_INIT
,

1868 
¬g
);

1869 
blocked
 = 1;

1872 
IEEE80211_S_INIT
:

1874 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1879 
IEEE80211_S_RUN
:

1882 ià(
o¡©e
 =ğ
IEEE80211_S_SCAN
 ||

1883 
o¡©e
 =ğ
IEEE80211_S_AUTH
 ||

1884 
o¡©e
 =ğ
IEEE80211_S_ASSOC
) {

1886 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1888 
d¡©e
 = 
	`g‘_domšªt_¡©e
(
ic
);

1889 ià(
d¡©e
 =ğ
IEEE80211_S_RUN
) {

1890 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
) {

1891 ià((
v­
 !ğ
tmpv­
) &&

1892 (
tmpv­
->
iv_İmode
 !=

1893 
IEEE80211_M_MONITOR
) &&

1894 (
tmpv­
->
iv_æags_ext
 &

1895 
IEEE80211_FEXT_SCAN_PENDING
)) {

1896 
	`IEEE80211_DPRINTF
(
v­
,

1897 
IEEE80211_MSG_STATE
,

1904 
__func__
, 
tmpv­
,

1905 
tmpv­
->
iv_nickÇme
);

1906 
tmpv­
->
iv_æags_ext
 &=

1907 ~
IEEE80211_FEXT_SCAN_PENDING
;

1908 ià(
tmpv­
->
iv_¡©e
 !=

1909 
IEEE80211_S_RUN
) {

1910 
tmpv­
->
	`iv_Ãw¡©e
(tmpvap,

1911 
IEEE80211_S_RUN
, 0);

1912 } ià(
tmpv­
->
iv_İmode
 ==

1913 
IEEE80211_M_HOSTAP
) {

1918 
tmpv­
->
	`iv_Ãw¡©e
(tmpvap,

1919 
IEEE80211_S_INIT
, 0);

1920 
tmpv­
->
	`iv_Ãw¡©e
(tmpvap,

1921 
IEEE80211_S_RUN
, 0);

1926 } ià(
d¡©e
 =ğ
IEEE80211_S_SCAN
) {

1928 
v­
->
iv_æags_ext
 |ğ
IEEE80211_FEXT_SCAN_PENDING
;

1929 
	`__›“80211_Ãw¡©e
(
v­
, 
IEEE80211_S_INIT
, 
¬g
);

1930 
blocked
 = 1;

1932 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1936 
	`__›“80211_Ãw¡©e
(
v­
, 
n¡©e
, 
¬g
);

1939 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_STATE
,

1942 
__func__
,

1943 (
blocked
 ? "BLOCKED" : "ALLOWED"),

1944 
›“80211_¡©e_Çme
[
o¡©e
],

1945 
›“80211_¡©e_Çme
[
n¡©e
],

1946 
v­
,

1947 
v­
->
iv_nickÇme
,

1948 
›“80211_¡©e_Çme
[
d¡©e
]);

1950 
	`dump_v­_¡©es
(
ic
, 
v­
);

1952 
	}
}

1954 #ifdeà
ATH_SUPERG_XR


1960 
	$›“80211_¡¬t_xrv­
(
d©a
)

1962 
›“80211v­
 *
v­
 = (›“80211v­ *)
d©a
;

1964 ià(
v­
->
iv_xrv­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
)

1965 
	`›“80211_š™
(
v­
->
iv_dev
, 0);

1966 
	}
}

	@ieee80211_proto.h

34 #iâdeà
_NET80211_IEEE80211_PROTO_H_


35 
	#_NET80211_IEEE80211_PROTO_H_


	)

41 
	e›“80211_¡©e
 {

42 
	mIEEE80211_S_INIT
 = 0,

43 
	mIEEE80211_S_SCAN
 = 1,

44 
	mIEEE80211_S_AUTH
 = 2,

45 
	mIEEE80211_S_ASSOC
 = 3,

46 
	mIEEE80211_S_RUN
 = 4,

48 
	#IEEE80211_S_MAX
 (
IEEE80211_S_RUN
 + 1)

	)

50 
	#IEEE80211_SEND_MGMT
(
_ni
,
_ty³
,
_¬g
) \

51 ((*(
_ni
)->
ni_ic
->
ic_£nd_mgmt
)(_ni, 
_ty³
, 
_¬g
))

	)

53 cÚ¡ *
›“80211_mgt_subty³_Çme
[];

54 cÚ¡ *
›“80211_ùl_subty³_Çme
[];

55 cÚ¡ *
›“80211_¡©e_Çme
[
IEEE80211_S_MAX
];

56 cÚ¡ *
›“80211_wme_aúames
[];

57 cÚ¡ *
›“80211_phymode_Çme
[];

58 cÚ¡ *
›“80211_İmode_Çme
[];

60 
›“80211_´Ùo_©ch
(
›“80211com
 *);

61 
›“80211_´Ùo_d‘ach
(
›“80211com
 *);

62 
›“80211_´Ùo_v©ch
(
›“80211v­
 *);

63 
›“80211_´Ùo_vd‘ach
(
›“80211v­
 *);

65 
	g›“80211_node
;

66 
›“80211_chªÃl
 *
›“80211_dÙh_fšdchª
(
›“80211v­
 *, 
u_št8_t
);

67 
›“80211_šput
(
›“80211v­
 *, 
›“80211_node
 *, 
sk_buff
 *, , 
u_št64_t
);

68 
›“80211_šput_®l
(
›“80211com
 *, 
sk_buff
 *, , 
u_št64_t
);

69 
›“80211_£tup_¿‹s
(
›“80211_node
 *, cÚ¡ 
u_št8_t
 *,

70 cÚ¡ 
u_št8_t
 *, );

71 
›“80211_§ve›
(
u_št8_t
 **, const u_int8_t *);

72 
›“80211_§v—th
(
›“80211_node
 *, 
u_št8_t
 *);

73 
›“80211_»cv_mgmt
(
›“80211v­
 *, 
›“80211_node
 *,

74 
sk_buff
 *, , , 
u_št64_t
);

75 
›“80211_¡a_pwr§ve
(
›“80211v­
 *, );

76 
›“80211_h¬d¡¬t
(
sk_buff
 *, 
Ãt_deviû
 *);

77 
›“80211_·»Á_queue_xm™
(
sk_buff
 *);

78 
›“80211_£nd_nuÎd©a
(
›“80211_node
 *);

79 
›“80211_£nd_qo¢uÎd©a
(
›“80211_node
 *, );

80 
›“80211_£nd_mgmt
(
›“80211_node
 *, , );

81 
›“80211_£nd_´ob”eq
(
›“80211_node
 *,

82 cÚ¡ 
u_št8_t
 
§
[
IEEE80211_ADDR_LEN
],

83 cÚ¡ 
u_št8_t
 
da
[
IEEE80211_ADDR_LEN
],

84 cÚ¡ 
u_št8_t
 
bssid
[
IEEE80211_ADDR_LEN
],

85 cÚ¡ 
u_št8_t
 *, 
size_t
, const *, size_t);

86 
sk_buff
 *
›“80211_’ÿp
(
›“80211_node
 *, sk_buff *, *);

88 
›“80211_»£t_”p
(
›“80211com
 *, 
›“80211_phymode
);

89 
›“80211_£t_shÜt¦Ùtime
(
›“80211com
 *, );

90 
›“80211_i£½_¿‹£t
(
›“80211com
 *, 
›“80211_¿‹£t
 *);

91 
›“80211_£t11gbasiü©es
(
›“80211_¿‹£t
 *, 
›“80211_phymode
);

92 
›“80211_phymode
 
›“80211_g‘11gbasiü©es
(
›“80211_¿‹£t
 *);

93 
›“80211_£nd_p¥Şl
(
›“80211_node
 *);

94 
›“80211_check_mic
(
›“80211_node
 *, 
sk_buff
 *);

99 
__šlše
 

100 
	$›“80211_hdrsize
(cÚ¡ *
d©a
)

102 cÚ¡ 
›“80211_äame
 *
wh
 = 
d©a
;

103 
size
 = (
›“80211_äame
);

106 
	`KASSERT
((
wh
->
i_fc
[0]&
IEEE80211_FC0_TYPE_MASK
è!ğ
IEEE80211_FC0_TYPE_CTL
,

107 ("%s: cÚŒŞ f¿me", 
__func__
));

108 ià((
wh
->
i_fc
[1] & 
IEEE80211_FC1_DIR_MASK
è=ğ
IEEE80211_FC1_DIR_DSTODS
)

109 
size
 +ğ
IEEE80211_ADDR_LEN
;

110 ià(
	`IEEE80211_QOS_HAS_SEQ
(
wh
))

111 
size
 +ğ(
u_št16_t
);

112  
size
;

113 
	}
}

118 
__šlše
 

119 
	$›“80211_ªyhdrsize
(cÚ¡ *
d©a
)

121 cÚ¡ 
›“80211_äame
 *
wh
 = 
d©a
;

123 ià((
wh
->
i_fc
[0] & 
IEEE80211_FC0_TYPE_MASK
è=ğ
IEEE80211_FC0_TYPE_CTL
) {

124 
wh
->
i_fc
[0] & 
IEEE80211_FC0_SUBTYPE_MASK
) {

125 
IEEE80211_FC0_SUBTYPE_CTS
:

126 
IEEE80211_FC0_SUBTYPE_ACK
:

127  (
›“80211_äame_ack
);

130  (
›“80211_äame_mš
);

134  
	`›“80211_hdrsize
(
d©a
);

135 
	}
}

142 
	s›“80211_auth’tiÿtÜ
 {

143 cÚ¡ *
	mŸ_Çme
;

144 (*
	mŸ_©ch
)(
	m›“80211v­
 *);

145 (*
	mŸ_d‘ach
)(
	m›“80211v­
 *);

146 (*
	mŸ_node_još
)(
	m›“80211_node
 *);

147 (*
	mŸ_node_Ëave
)(
	m›“80211_node
 *);

149 
›“80211_auth’tiÿtÜ_»gi¡”
(, cÚ¡ 
›“80211_auth’tiÿtÜ
 *);

150 
›“80211_auth’tiÿtÜ_uÄegi¡”
();

151 cÚ¡ 
›“80211_auth’tiÿtÜ
 *
›“80211_auth’tiÿtÜ_g‘
();

153 
	g—pŞcom
;

159 
	s›“80211_auth’tiÿtÜ_back’d
 {

160 cÚ¡ *
	mŸb_Çme
;

161 (*
	mŸb_©ch
)(
	m—pŞcom
 *);

162 (*
	mŸb_d‘ach
)(
	m—pŞcom
 *);

164 
›“80211_auth’tiÿtÜ_back’d_»gi¡”
(

165 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *);

166 
›“80211_auth’tiÿtÜ_back’d_uÄegi¡”
(

167 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *);

168 cÚ¡ 
›“80211_auth’tiÿtÜ_back’d
 *

169 
›“80211_auth’tiÿtÜ_back’d_g‘
(const *);

176 
	s›“80211_aş©Ü
 {

177 cÚ¡ *
	mŸc_Çme
;

178 (*
	mŸc_©ch
)(
	m›“80211v­
 *);

179 (*
	mŸc_d‘ach
)(
	m›“80211v­
 *);

180 (*
	mŸc_check
)(
	m›“80211v­
 *,

181 cÚ¡ 
u_št8_t
 
	mmac
[
IEEE80211_ADDR_LEN
]);

182 (*
	mŸc_add
)(
	m›“80211v­
 *,

183 cÚ¡ 
u_št8_t
 
	mmac
[
IEEE80211_ADDR_LEN
]);

184 (*
	mŸc_»move
)(
	m›“80211v­
 *,

185 cÚ¡ 
u_št8_t
 
	mmac
[
IEEE80211_ADDR_LEN
]);

186 (*
	mŸc_æush
)(
	m›“80211v­
 *);

187 (*
	mŸc_£Şicy
)(
	m›“80211v­
 *, );

188 (*
	mŸc_g‘pŞicy
)(
	m›“80211v­
 *);

190 
›“80211_aş©Ü_»gi¡”
(cÚ¡ 
›“80211_aş©Ü
 *);

191 
›“80211_aş©Ü_uÄegi¡”
(cÚ¡ 
›“80211_aş©Ü
 *);

192 cÚ¡ 
›“80211_aş©Ü
 *
›“80211_aş©Ü_g‘
(cÚ¡ *
Çme
);

195 
	#IEEE80211_F_DOSORT
 0x00000001

	)

196 
	#IEEE80211_F_DOFRATE
 0x00000002

	)

197 
	#IEEE80211_F_DONEGO
 0x00000004

	)

198 
	#IEEE80211_F_DODEL
 0x00000008

	)

199 
›“80211_fix_¿‹
(
›“80211_node
 *, );

201 
	swmeP¬ams
 {

202 
u_št8_t
 
	mwm•_acm
;

203 
u_št8_t
 
	mwm•_aif¢
;

204 
u_št8_t
 
	mwm•_logcwmš
;

205 
u_št8_t
 
	mwm•_logcwmax
;

206 
u_št16_t
 
	mwm•_txİLim™
;

207 
u_št8_t
 
	mwm•_nßckPŞicy
;

210 
	#IEEE80211_EXPONENT_TO_VALUE
(
_exp
è(1 << (
u_št32_t
)(_exp)è- 1

	)

211 
	#IEEE80211_TXOP_TO_US
(
_txİ
è(
u_št32_t
)(_txİè<< 5

	)

212 
	#IEEE80211_US_TO_TXOP
(
_us
è(
u_št16_t
)((
u_št32_t
)(_us)è>> 5

	)

214 
	schªAccP¬ams
{

216 
u_št8_t
 
	mÿp_šfo_couÁ
;

217 
wmeP¬ams
 
	mÿp_wmeP¬ams
[
WME_NUM_AC
];

220 
	s›“80211_wme_¡©e
 {

221 
u_št32_t
 
	mwme_æags
;

222 
	#WME_F_AGGRMODE
 0x00000001

	)

224 
u_št
 
	mwme_hri_Œaffic
;

225 
u_št
 
	mwme_hri_sw™ch_th»sh
;

226 
u_št
 
	mwme_hri_sw™ch_hy¡”esis
;

228 
chªAccP¬ams
 
	mwme_wmeChªP¬ams
;

229 
chªAccP¬ams
 
	mwme_wmeBssChªP¬ams
;

230 
chªAccP¬ams
 
	mwme_chªP¬ams
;

231 
chªAccP¬ams
 
	mwme_bssChªP¬ams
;

232 
u_št8_t
 
	mwme_nÚAgg»ssiveMode
;

235 (*
	mwme_upd©e
)(
	m›“80211com
 *);

238 
›“80211_wme_š™·¿ms
(
›“80211v­
 *);

239 
›“80211_wme_š™·¿ms_locked
(
›“80211v­
 *);

240 
›“80211_wme_upd©•¬ams
(
›“80211v­
 *);

241 
›“80211_wme_upd©•¬ams_locked
(
›“80211v­
 *);

243 
›“80211_İ’
(
Ãt_deviû
 *);

244 
›“80211_š™
(
Ãt_deviû
 *, );

245 
›“80211_¡¬t_ruÂšg
(
›“80211com
 *);

246 
›“80211_¡İ
(
Ãt_deviû
 *);

247 
›“80211_¡İ_ruÂšg
(
›“80211com
 *);

248 
›“80211_b—cÚ_miss
(
›“80211com
 *);

249 #ifdeà
ATH_SUPERG_DYNTURBO


250 
›“80211_dturbo_sw™ch
(
›“80211com
 *, );

252 
›“80211_Ãw_¡©e
(
›“80211v­
 *, 
›“80211_¡©e
, );

253 
›“80211_´št_essid
(cÚ¡ 
u_št8_t
 *, );

254 #ifdeà
IEEE80211_DEBUG


255 
›“80211_dump_pkt
(
›“80211com
 *, cÚ¡ 
u_št8_t
 *,

258 
	#›“80211_dump_pkt
(...)

	)

260 
sk_buff
 *
›“80211_g‘cfäame
(
›“80211v­
 *, );

267 
	s›“80211_b—cÚ_off£ts
 {

268 
__Ë16
 *
	mbo_ÿps
;

269 
u_št8_t
 *
	mbo_tim
;

270 
u_št8_t
 *
	mbo_wme
;

271 
u_št8_t
 *
	mbo_tim_Œa”
;

272 
u_št16_t
 
	mbo_tim_Ën
;

273 
u_št16_t
 
	mbo_tim_Œa”Ën
;

274 
u_št8_t
 *
	mbo_chªsw™ch
;

275 
u_št8_t
 *
	mbo_©h_ÿps
;

276 
u_št8_t
 *
	mbo_xr
;

277 
u_št8_t
 *
	mbo_”p
;

278 
u_št8_t
 *
	mbo_­p›_buf
;

279 
u_št16_t
 
	mbo_­p›_buf_Ën
;

280 
u_št16_t
 
	mbo_chªsw™ch_Œa”Ën
;

282 
sk_buff
 *
›“80211_b—cÚ_®loc
(
›“80211_node
 *,

283 
›“80211_b—cÚ_off£ts
 *);

284 
›“80211_b—cÚ_upd©e
(
›“80211_node
 *,

285 
›“80211_b—cÚ_off£ts
 *, 
sk_buff
 *, , *);

288 
u_št8_t
 *
›“80211_add_¿‹s
(u_št8_ˆ*, cÚ¡ 
›“80211_¿‹£t
 *);

289 
u_št8_t
 *
›“80211_add_x¿‹s
(u_št8_ˆ*, cÚ¡ 
›“80211_¿‹£t
 *);

290 
u_št8_t
 *
›“80211_add_w·
(u_št8_ˆ*, 
›“80211v­
 *);

291 
u_št8_t
 *
›“80211_add_”p
(u_št8_ˆ*, 
›“80211com
 *);

292 
u_št8_t
 *
›“80211_add_©hAdvC­
(u_št8_ˆ*, u_št8_t, 
u_št16_t
);

293 
u_št8_t
 *
›“80211_add_xr_·¿m
(u_št8_ˆ*, 
›“80211v­
 *);

294 
u_št8_t
 *
›“80211_add_xr_·¿m
(u_št8_ˆ*, 
›“80211v­
 *);

295 
u_št8_t
 *
›“80211_add_wme_·¿m
(u_št8_ˆ*, 
›“80211_wme_¡©e
 *, );

296 
u_št8_t
 *
›“80211_add_couÁry
(u_št8_ˆ*, 
›“80211com
 *);

297 
u_št8_t
 *
›“80211_add_pwrú¡r
(u_št8_ˆ*
äm
, 
›“80211com
 *
ic
);

298 
u_št8_t
 *
›“80211_add_©hAdvC­
(u_št8_ˆ*, u_št8_t, 
u_št16_t
);

305 
›“80211_nÙify_node_još
(
›“80211_node
 *, );

306 
›“80211_nÙify_node_Ëave
(
›“80211_node
 *);

307 
›“80211_nÙify_sÿn_dÚe
(
›“80211v­
 *);

308 
›“80211_nÙify_¡a_¡©s
(
›“80211_node
 *
ni
);

	@ieee80211_radiotap.h

34 #iâdeà
_NET_IF_IEEE80211RADIOTAP_H_


35 
	#_NET_IF_IEEE80211RADIOTAP_H_


	)

51 #ià
defšed
(
__KERNEL__
è|| defšed(
_KERNEL
)

52 #iâdeà
DLT_IEEE802_11_RADIO


53 
	#DLT_IEEE802_11_RADIO
 127

	)

58 
	s›“80211_¿diÙ­_h—d”
 {

59 
u_št8_t
 
	m™_v”siÚ
;

64 
u_št8_t
 
	m™_·d
;

65 
__Ë16
 
	m™_Ën
;

70 
__Ë32
 
	m™_´e£Á
;

77 } 
__©Œibu‹__
((
__·cked__
));

175 
	e›“80211_¿diÙ­_ty³
 {

176 
	mIEEE80211_RADIOTAP_TSFT
 = 0,

177 
	mIEEE80211_RADIOTAP_FLAGS
 = 1,

178 
	mIEEE80211_RADIOTAP_RATE
 = 2,

179 
	mIEEE80211_RADIOTAP_CHANNEL
 = 3,

180 
	mIEEE80211_RADIOTAP_FHSS
 = 4,

181 
	mIEEE80211_RADIOTAP_DBM_ANTSIGNAL
 = 5,

182 
	mIEEE80211_RADIOTAP_DBM_ANTNOISE
 = 6,

183 
	mIEEE80211_RADIOTAP_LOCK_QUALITY
 = 7,

184 
	mIEEE80211_RADIOTAP_TX_ATTENUATION
 = 8,

185 
	mIEEE80211_RADIOTAP_DB_TX_ATTENUATION
 = 9,

186 
	mIEEE80211_RADIOTAP_DBM_TX_POWER
 = 10,

187 
	mIEEE80211_RADIOTAP_ANTENNA
 = 11,

188 
	mIEEE80211_RADIOTAP_DB_ANTSIGNAL
 = 12,

189 
	mIEEE80211_RADIOTAP_DB_ANTNOISE
 = 13,

190 
	mIEEE80211_RADIOTAP_RX_FLAGS
 = 14,

191 
	mIEEE80211_RADIOTAP_TX_FLAGS
 = 15,

192 
	mIEEE80211_RADIOTAP_RTS_RETRIES
 = 16,

193 
	mIEEE80211_RADIOTAP_DATA_RETRIES
 = 17,

194 
	mIEEE80211_RADIOTAP_EXT
 = 31,

197 #iâdeà
_KERNEL


199 
	#IEEE80211_CHAN_TURBO
 0x0010

	)

200 
	#IEEE80211_CHAN_CCK
 0x0020

	)

201 
	#IEEE80211_CHAN_OFDM
 0x0040

	)

202 
	#IEEE80211_CHAN_2GHZ
 0x0080

	)

203 
	#IEEE80211_CHAN_5GHZ
 0x0100

	)

204 
	#IEEE80211_CHAN_PASSIVE
 0x0200

	)

205 
	#IEEE80211_CHAN_DYN
 0x0400

	)

206 
	#IEEE80211_CHAN_GFSK
 0x0800

	)

209 
	#IEEE80211_CHAN_A
 \

210 (
IEEE80211_CHAN_5GHZ
 | 
IEEE80211_CHAN_OFDM
)

	)

211 
	#IEEE80211_CHAN_B
 \

212 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_CCK
)

	)

213 
	#IEEE80211_CHAN_G
 \

214 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_DYN
)

	)

215 
	#IEEE80211_CHAN_TA
 \

216 (
IEEE80211_CHAN_5GHZ
 | 
IEEE80211_CHAN_OFDM
 | 
IEEE80211_CHAN_TURBO
)

	)

217 
	#IEEE80211_CHAN_TG
 \

218 (
IEEE80211_CHAN_2GHZ
 | 
IEEE80211_CHAN_DYN
 | 
IEEE80211_CHAN_TURBO
)

	)

223 
	#IEEE80211_RADIOTAP_F_CFP
 0x01

	)

226 
	#IEEE80211_RADIOTAP_F_SHORTPRE
 0x02

	)

230 
	#IEEE80211_RADIOTAP_F_WEP
 0x04

	)

233 
	#IEEE80211_RADIOTAP_F_FRAG
 0x08

	)

236 
	#IEEE80211_RADIOTAP_F_FCS
 0x10

	)

237 
	#IEEE80211_RADIOTAP_F_DATAPAD
 0x20

	)

241 
	#IEEE80211_RADIOTAP_F_BADFCS
 0x40

	)

244 
	#IEEE80211_RADIOTAP_F_RX_BADFCS
 0x0001

	)

253 
	#IEEE80211_RADIOTAP_F_TX_FAIL
 0x0001

	)

256 
	#IEEE80211_RADIOTAP_F_TX_CTS
 0x0002

	)

257 
	#IEEE80211_RADIOTAP_F_TX_RTS
 0x0004

	)

	@ieee80211_rate.c

30 #iâdeà
EXPORT_SYMTAB


31 
	#EXPORT_SYMTAB


	)

37 #iâdeà
AUTOCONF_INCLUDED


38 
	~<lšux/cÚfig.h
>

41 
	~<lšux/v”siÚ.h
>

42 
	~<lšux/moduË.h
>

43 
	~<lšux/Ãtdeviû.h
>

44 
	~<Ãt80211/if_medŸ.h
>

45 
	~<Ãt80211/›“80211_v¬.h
>

46 
	~<Ãt80211/›“80211_¿‹.h
>

48 cÚ¡ *
	gmoduË_Çmes
[] = {

49 [
IEEE80211_RATE_AMRR
] = "ath_rate_amrr",

50 [
IEEE80211_RATE_MINSTREL
] = "ath_rate_minstrel",

51 [
IEEE80211_RATE_ONOE
] = "ath_rate_onoe",

52 [
IEEE80211_RATE_SAMPLE
] = "ath_rate_sample"

58 
›“80211_¿‹_İs
 
	g¿‹ùls
[
IEEE80211_RATE_MAX
];

60 
	$›“80211_¿‹_»gi¡”
(
›“80211_¿‹_İs
 *
İs
)

62 
id
 = 
İs
->
¿‹ùl_id
;

64 ià((0 <ğ
id
è&& (id < 
IEEE80211_RATE_MAX
)) {

65 
	`memıy
(&
¿‹ùls
[
id
], 
İs
, (*ops));

68  -
EINVAL
;

69 
	}
}

70 
EXPORT_SYMBOL
(
›“80211_¿‹_»gi¡”
);

72 
	$›“80211_¿‹_uÄegi¡”
(
›“80211_¿‹_İs
 *
İs
)

74 
id
 = 
İs
->
¿‹ùl_id
;

76 ià((0 <ğ
id
è&& (id < 
IEEE80211_RATE_MAX
))

77 
	`mem£t
(&
¿‹ùls
[
id
], 0, (ratectls[0]));

78 
	}
}

79 
EXPORT_SYMBOL
(
›“80211_¿‹_uÄegi¡”
);

81 
©h_¿‹ù¾
 *
	$›“80211_¿‹_©ch
(
©h_soác
 *
sc
,

82 cÚ¡ *
Çme
)

84 
id
;

85 
buf
[64];

86 
©h_¿‹ù¾
 *
ùl
;

88 
	`¢´štf
(
buf
, (buf), "©h_¿‹_%s", 
Çme
);

89 
id
 = 0; id < 
IEEE80211_RATE_MAX
; id++) {

90 ià(
	`¡rcmp
(
buf
, 
moduË_Çmes
[
id
]) == 0)

94 ià(
id
 >ğ
IEEE80211_RATE_MAX
) {

95 
	`´štk
(
KERN_ERR
 "ModuË \"%s\" i nÙ known\n", 
buf
);

96  
NULL
;

99 ià(!
¿‹ùls
[
id
].
©ch
)

100 
	`›“80211_lßd_moduË
(
buf
);

102 ià(!
¿‹ùls
[
id
].
©ch
) {

103 
	`´štk
(
KERN_ERR
 "E¼Ü†ßdšg moduË \"%s\"\n", 
buf
);

104  
NULL
;

107 
ùl
 = 
¿‹ùls
[
id
].
	`©ch
(
sc
);

108 ià(!
ùl
) {

109 
	`´štk
(
KERN_ERR
 "ModuË \"%s\" faedØš™Ÿlize\n", 
buf
);

110  
NULL
;

113 
ùl
->
İs
 = &
¿‹ùls
[
id
];

114  
ùl
;

115 
	}
}

116 
EXPORT_SYMBOL
(
›“80211_¿‹_©ch
);

118 
	$›“80211_¿‹_d‘ach
(
©h_¿‹ù¾
 *
ùl
) {

119 
ùl
->
İs
->
	`d‘ach
(ctl);

120 
	}
}

121 
EXPORT_SYMBOL
(
›“80211_¿‹_d‘ach
);

	@ieee80211_rate.h

39 #iâdeà
_ATH_RATECTRL_H_


40 
	#_ATH_RATECTRL_H_


	)

70 
	mIEEE80211_RATE_AMRR
,

71 
	mIEEE80211_RATE_MINSTREL
,

72 
	mIEEE80211_RATE_ONOE
,

73 
	mIEEE80211_RATE_SAMPLE
,

74 
	mIEEE80211_RATE_MAX


77 
	g©h_soác
;

78 
	g©h_node
;

79 
	g©h_buf
;

80 
	g›“80211v­
;

83 
	s›“80211_m¼
 {

84 
	m¿‹1
;

85 
	m»Œ›s1
;

86 
	m¿‹2
;

87 
	m»Œ›s2
;

88 
	m¿‹3
;

89 
	m»Œ›s3
;

92 
	s›“80211_¿‹_İs
 {

93 
	m¿‹ùl_id
;

96 
	m©h_¿‹ù¾
 *(*
	m©ch
)(
©h_soác
 *
	msc
);

97 (*
	md‘ach
)(
©h_¿‹ù¾
 *
	m¬c
);

100 (*
	mdyÇmic_´oc_»gi¡”
)(
›“80211v­
 *
	mv­
);

106 (*
	mnode_š™
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
);

109 (*
	mnode_ş—nup
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
);

114 (*
	mÃwassoc
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
,

115 
	mi¢ew
);

120 (*
	mÃw¡©e
)(
›“80211v­
 *
	mv­
,

121 
›“80211_¡©e
 
	m¡©e
);

129 (*
	mfšd¿‹
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
,

130 
	mshÜtP»ambË
, 
size_t
 
	mäameL’
,

131 
u_št8_t
 *
	mrix
, *
	mŒy0
, u_št8_ˆ*
	mtx¿‹
);

135 (*
	mg‘_m¼
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
,

136 
	mshÜtP»ambË
, 
size_t
 
	mäame_size
, 
u_št8_t
 
	mrix
,

137 
›“80211_m¼
 *
	mm¼
);

143 (*
	mtx_com¶‘e
)(
©h_soác
 *
	msc
, 
©h_node
 *
	mª
,

144 cÚ¡ 
©h_buf
 *
	mbf
);

147 
	s©h_¿‹ù¾
 {

148 
›“80211_¿‹_İs
 *
	mİs
;

149 
size_t
 
	m¬c_¥aû
;

150 
size_t
 
	m¬c_v­_¥aû
;

153 
›“80211_¿‹_»gi¡”
(
›“80211_¿‹_İs
 *
İs
);

154 
›“80211_¿‹_uÄegi¡”
(
›“80211_¿‹_İs
 *
İs
);

156 
©h_¿‹ù¾
 *
›“80211_¿‹_©ch
(
©h_soác
 *
sc
, cÚ¡ *
Çme
);

157 
›“80211_¿‹_d‘ach
(
©h_¿‹ù¾
 *);

	@ieee80211_scan.c

33 #iâdeà
EXPORT_SYMTAB


34 
	#EXPORT_SYMTAB


	)

40 #iâdeà
AUTOCONF_INCLUDED


41 
	~<lšux/cÚfig.h
>

43 
	~<lšux/v”siÚ.h
>

44 
	~<lšux/moduË.h
>

45 
	~<lšux/skbuff.h
>

46 
	~<lšux/Ãtdeviû.h
>

47 
	~<lšux/‘h”deviû.h
>

48 
	~<lšux/¿ndom.h
>

49 
	~<lšux/š‹¼u±.h
>

50 
	~<lšux/d–ay.h
>

52 
	~"if_medŸ.h
"

54 
	~<Ãt80211/›“80211_v¬.h
>

55 
	~<Ãt80211/if_©h´Ùo.h
>

57 
	ssÿn_¡©e
 {

58 
›“80211_sÿn_¡©e
 
	mba£
;

60 
u_št
 
	mss_iæags
;

61 
	#ISCAN_MINDWELL
 0x0001

	)

62 
	#ISCAN_DISCARD
 0x0002

	)

63 
	#ISCAN_CANCEL
 0x0004

	)

64 
	#ISCAN_START
 0x0008

	)

65 
	mss_chªmšdw–l
;

66 
	mss_sÿÃnd
;

67 
u_št
 
	mss_du¿tiÚ
;

68 
skËt_¡ruù
 
	mss_pwr§v
;

69 
tim”_li¡
 
	mss_sÿn_tim”
;

71 
	#SCAN_PRIVATE
(
_ss
è((
sÿn_¡©e
 *)(_ss))

	)

82 
	#IEEE80211_SCAN_OFFCHANNEL
 
	`m£cs_to_jiff›s
(150)

	)

89 
	#SCAN_VALID_DEFAULT
 60

	)

90 
	#ROAM_RSSI_11A_DEFAULT
 9

	)

91 
	#ROAM_RSSI_11G_DEFAULT
 9

	)

92 
	#ROAM_RSSI_11BONLY_DEFAULT
 9

	)

93 
	#ROAM_RATE_11A_DEFAULT
 2 * 24

	)

94 
	#ROAM_RATE_11G_DEFAULT
 2 * 9

	)

95 
	#ROAM_RATE_11BONLY_DEFAULT
 2 * 5

	)

97 
sÿn_»¡¬t_pwr§v
();

98 
sÿn_Ãxt
();

101 
	$›“80211_sÿn_©ch
(
›“80211com
 *
ic
)

103 
sÿn_¡©e
 *
ss
;

105 
ic
->
ic_rßmšg
 = 
IEEE80211_ROAMING_AUTO
;

107 
	`MALLOC
(
ss
, 
sÿn_¡©e
 *, (scan_state),

108 
M_80211_SCAN
, 
M_NOWAIT
 | 
M_ZERO
);

109 ià(
ss
 !ğ
NULL
) {

110 
	`š™_tim”
(&
ss
->
ss_sÿn_tim”
);

111 
ss
->
ss_sÿn_tim”
.
funùiÚ
 = 
sÿn_Ãxt
;

112 
ss
->
ss_sÿn_tim”
.
d©a
 = () ss;

113 
	`skËt_š™
(&
ss
->
ss_pwr§v
, 
sÿn_»¡¬t_pwr§v
,

114 (è
ss
);

115 
ic
->
ic_sÿn
 = &
ss
->
ba£
;

117 
ic
->
ic_sÿn
 = 
NULL
;

118 
	}
}

121 
	$›“80211_sÿn_d‘ach
(
›“80211com
 *
ic
)

123 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

125 ià(
ss
 !ğ
NULL
) {

126 
	`d–_tim”
(&
	`SCAN_PRIVATE
(
ss
)->
ss_sÿn_tim”
);

127 
	`skËt_kl
(&
	`SCAN_PRIVATE
(
ss
)->
ss_pwr§v
);

128 ià(
ss
->
ss_İs
 !ğ
NULL
) {

129 
ss
->
ss_İs
->
	`sÿn_d‘ach
(ss);

130 
ss
->
ss_İs
 = 
NULL
;

132 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

133 
ic
->
ic_sÿn
 = 
NULL
;

134 
	`FREE
(
	`SCAN_PRIVATE
(
ss
), 
M_80211_SCAN
);

136 
	}
}

139 
	$›“80211_sÿn_v©ch
(
›“80211v­
 *
v­
)

141 
v­
->
iv_bgsÿnidË
 = 
	`m£cs_to_jiff›s
(
IEEE80211_BGSCAN_IDLE_DEFAULT
);

142 
v­
->
iv_bgsÿnštvl
 = 
IEEE80211_BGSCAN_INTVAL_DEFAULT
 * 
HZ
;

143 
v­
->
iv_sÿnv®id
 = 
SCAN_VALID_DEFAULT
 * 
HZ
;

144 
v­
->
iv_rßm
.
rssi11a
 = 
ROAM_RSSI_11A_DEFAULT
;

145 
v­
->
iv_rßm
.
rssi11g
 = 
ROAM_RSSI_11G_DEFAULT
;

146 
v­
->
iv_rßm
.
rssi11bOÆy
 = 
ROAM_RSSI_11BONLY_DEFAULT
;

147 
v­
->
iv_rßm
.
¿‹11a
 = 
ROAM_RATE_11A_DEFAULT
;

148 
v­
->
iv_rßm
.
¿‹11g
 = 
ROAM_RATE_11G_DEFAULT
;

149 
v­
->
iv_rßm
.
¿‹11bOÆy
 = 
ROAM_RATE_11BONLY_DEFAULT
;

150 
	}
}

153 
	$›“80211_sÿn_vd‘ach
(
›“80211v­
 *
v­
)

155 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

156 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

158 
	`IEEE80211_LOCK_IRQ
(
ic
);

159 ià(
ss
->
ss_v­
 =ğ
v­
) {

160 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) {

161 
	`d–_tim”
(&
	`SCAN_PRIVATE
(
ss
)->
ss_sÿn_tim”
);

162 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

164 ià(
ss
->
ss_İs
 !ğ
NULL
) {

165 
ss
->
ss_İs
->
	`sÿn_d‘ach
(ss);

166 
ss
->
ss_İs
 = 
NULL
;

169 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

170 
	}
}

175 
	#IEEE80211_SCANNER_MAX
 (
IEEE80211_M_MONITOR
+1)

	)

177 cÚ¡ *
	gsÿn_modÇmes
[
IEEE80211_SCANNER_MAX
] = {

178 [
IEEE80211_M_IBSS
] = "wlan_scan_sta",

179 [
IEEE80211_M_STA
] = "wlan_scan_sta",

180 [
IEEE80211_M_AHDEMO
] = "wlan_scan_sta",

181 [
IEEE80211_M_HOSTAP
] = "wlan_scan_ap",

183 cÚ¡ 
›“80211_sÿÂ”
 *
	gsÿÂ”s
[
IEEE80211_SCANNER_MAX
];

190 cÚ¡ 
›“80211_sÿÂ”
 *

191 
	$›“80211_sÿÂ”_g‘
(
›“80211_İmode
 
mode
, 
Œylßd
)

193 
”r
;

194 ià(
mode
 >ğ
IEEE80211_SCANNER_MAX
)

195  
NULL
;

196 ià(
sÿn_modÇmes
[
mode
] =ğ
NULL
)

197  
NULL
;

198 ià(
sÿÂ”s
[
mode
] =ğ
NULL
 && 
Œylßd
) {

199 
”r
 = 
	`›“80211_lßd_moduË
(
sÿn_modÇmes
[
mode
]);

200 ià(
sÿÂ”s
[
mode
] =ğ
NULL
 || 
”r
)

201 
	`´štk
(
KERN_WARNING
 "uÇbËØlßd %s\n", 
sÿn_modÇmes
[
mode
]);

203  
sÿÂ”s
[
mode
];

204 
	}
}

205 
EXPORT_SYMBOL
(
›“80211_sÿÂ”_g‘
);

208 
	$›“80211_sÿÂ”_»gi¡”
(
›“80211_İmode
 
mode
,

209 cÚ¡ 
›“80211_sÿÂ”
 *
sÿn
)

211 ià(
mode
 >ğ
IEEE80211_SCANNER_MAX
)

213 
sÿÂ”s
[
mode
] = 
sÿn
;

214 
	}
}

215 
EXPORT_SYMBOL
(
›“80211_sÿÂ”_»gi¡”
);

218 
	$›“80211_sÿÂ”_uÄegi¡”
(
›“80211_İmode
 
mode
,

219 cÚ¡ 
›“80211_sÿÂ”
 *
sÿn
)

221 ià(
mode
 >ğ
IEEE80211_SCANNER_MAX
)

223 ià(
sÿÂ”s
[
mode
] =ğ
sÿn
)

224 
sÿÂ”s
[
mode
] = 
NULL
;

225 
	}
}

226 
EXPORT_SYMBOL
(
›“80211_sÿÂ”_uÄegi¡”
);

229 
	$›“80211_sÿÂ”_uÄegi¡”_®l
(cÚ¡ 
›“80211_sÿÂ”
 *
sÿn
)

231 
m
;

233 
m
 = 0; m < 
IEEE80211_SCANNER_MAX
; m++)

234 ià(
sÿÂ”s
[
m
] =ğ
sÿn
)

235 
sÿÂ”s
[
m
] = 
NULL
;

236 
	}
}

237 
EXPORT_SYMBOL
(
›“80211_sÿÂ”_uÄegi¡”_®l
);

240 
	$chªge_chªÃl
(
›“80211com
 *
ic
,

241 
›“80211_chªÃl
 *
chª
)

243 
ic
->
ic_curchª
 = 
chª
;

244 
ic
->
	`ic_£t_chªÃl
(ic);

245 
	}
}

248 
	$chªÃl_ty³
(cÚ¡ 
›“80211_chªÃl
 *
c
)

250 ià(
	`IEEE80211_IS_CHAN_ST
(
c
))

252 ià(
	`IEEE80211_IS_CHAN_108A
(
c
))

254 ià(
	`IEEE80211_IS_CHAN_108G
(
c
))

256 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

258 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
))

260 ià(
	`IEEE80211_IS_CHAN_B
(
c
))

263 
	}
}

266 
	$›“80211_sÿn_dump_chªÃls
(cÚ¡ 
›“80211_sÿn_¡©e
 *
ss
)

268 
›“80211com
 *
ic
 = 
ss
->
ss_v­
->
iv_ic
;

269 cÚ¡ *
£p
;

270 
i
;

272 
£p
 = "";

273 
i
 = 
ss
->
ss_Ãxt
; i < ss->
ss_Ï¡
; i++) {

274 cÚ¡ 
›“80211_chªÃl
 *
c
 = 
ss
->
ss_chªs
[
i
];

276 
	`´štk
("%s%u%c", 
£p
, 
	`›“80211_chª2›“
(
ic
, 
c
),

277 
	`chªÃl_ty³
(
c
));

278 
£p
 = ", ";

280 
	}
}

281 
EXPORT_SYMBOL
(
›“80211_sÿn_dump_chªÃls
);

287 
	$sÿn_»¡¬t_pwr§v
(
¬g
)

289 
sÿn_¡©e
 *
ss
 = (sÿn_¡©*)
¬g
;

290 
›“80211v­
 *
v­
 = 
ss
->
ba£
.
ss_v­
;

291 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

292 
d–ay
;

294 
	`›“80211_¡a_pwr§ve
(
v­
, 1);

301 
d–ay
 = 
	`m£cs_to_jiff›s
(1);

302 ià(
d–ay
 < 1)

303 
d–ay
 = 1;

304 
ic
->
	`ic_sÿn_¡¬t
(ic);

305 
ss
->
ss_sÿÃnd
 = 
jiff›s
 + 
d–ay
 + ss->
ss_du¿tiÚ
;

306 
ss
->
ss_iæags
 |ğ
ISCAN_START
;

307 
	`mod_tim”
(&
ss
->
ss_sÿn_tim”
, 
jiff›s
 + 
d–ay
);

308 
	}
}

318 
	$sÿn_»¡¬t
(
sÿn_¡©e
 *
ss
, 
u_št
 
du¿tiÚ
)

320 
›“80211v­
 *
v­
 = 
ss
->
ba£
.
ss_v­
;

321 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

323 ià(
ss
->
ba£
.
ss_Ãxt
 =ğss->ba£.
ss_Ï¡
) {

324 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

325 "%s:‚ØchªÃl tØsÿn\n", 
__func__
);

328 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) &&

329 (
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) &&

330 !(
	`IEEE80211_VAP_IS_SLEEPING
(
v­
))) {

337 
ss
->
ss_du¿tiÚ
 = 
du¿tiÚ
;

338 
	`skËt_scheduË
(&
ss
->
ss_pwr§v
);

340 
ic
->
	`ic_sÿn_¡¬t
(ic);

341 
ss
->
ss_sÿÃnd
 = 
jiff›s
 + 
du¿tiÚ
;

342 
ss
->
ss_iæags
 |ğ
ISCAN_START
;

343 
	`mod_tim”
(&
ss
->
ss_sÿn_tim”
, 
jiff›s
);

347 
	}
}

350 
	$cİy_ssid
(
›“80211v­
 *
v­
, 
›“80211_sÿn_¡©e
 *
ss
,

351 
nssid
, cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[])

353 ià(
nssid
 > 
IEEE80211_SCAN_MAX_SSID
) {

355 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

357 
__func__
, 
nssid
);

360 
	`memıy
(
ss
->
ss_ssid
, 
ssids
, 
nssid
 * (ssids[0]));

361 
ss
->
ss_nssid
 = 
nssid
;

362 
	}
}

368 
	$›“80211_¡¬t_sÿn
(
›“80211v­
 *
v­
, 
æags
, 
u_št
 
du¿tiÚ
,

369 
u_št
 
nssid
, cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[])

371 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

372 cÚ¡ 
›“80211_sÿÂ”
 *
sÿn
;

373 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

374 
sÿÂšg
;

376 
sÿn
 = 
	`›“80211_sÿÂ”_g‘
(
v­
->
iv_İmode
, 0);

377 ià(
sÿn
 =ğ
NULL
) {

378 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

380 
__func__
, 
v­
->
iv_İmode
);

385 
	`IEEE80211_LOCK_IRQ
(
ic
);

386 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0) {

387 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

389 
__func__
,

390 
æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive",

391 
du¿tiÚ
,

392 
›“80211_phymode_Çme
[
v­
->
iv_des_mode
],

393 
æags
 & 
IEEE80211_SCAN_FLUSH
 ? "flush" : "append",

394 
æags
 & 
IEEE80211_SCAN_NOPICK
 ? ",‚opick" : "",

395 
æags
 & 
IEEE80211_SCAN_PICK1ST
 ? ",…ick1st" : "",

396 
æags
 & 
IEEE80211_SCAN_ONCE
 ? ", once" : "");

398 
ss
->
ss_v­
 = 
v­
;

399 ià(
ss
->
ss_İs
 !ğ
sÿn
) {

401 ià(
ss
->
ss_İs
 !ğ
NULL
)

402 
ss
->
ss_İs
->
	`sÿn_d‘ach
(ss);

403 ià(!
sÿn
->
	`sÿn_©ch
(
ss
)) {

406 
ss
->
ss_İs
 = 
NULL
;

408 
ss
->
ss_İs
 = 
sÿn
;

410 ià(
ss
->
ss_İs
 !ğ
NULL
) {

411 ià((
æags
 & 
IEEE80211_SCAN_NOSSID
) == 0)

412 
	`cİy_ssid
(
v­
, 
ss
, 
nssid
, 
ssids
);

415 
ss
->
ss_æags
 = 
æags
 & 0xfff;

416 ià(
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
)

417 
v­
->
iv_¡©s
.
is_sÿn_aùive
++;

419 
v­
->
iv_¡©s
.
is_sÿn_·ssive
++;

420 ià(
æags
 & 
IEEE80211_SCAN_FLUSH
)

421 
ss
->
ss_İs
->
	`sÿn_æush
(ss);

424 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_DISCARD
;

425 
ss
->
ss_İs
->
	`sÿn_¡¬t
(ss, 
v­
);

426 ià(
	`sÿn_»¡¬t
(
	`SCAN_PRIVATE
(
ss
), 
du¿tiÚ
))

427 
ic
->
ic_æags
 |ğ
IEEE80211_F_SCAN
;

430 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

431 "%s: % sÿÀ®»ady iÀ´og»ss\n", 
__func__
,

432 
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive");

438 ià(((
æags
 & 
IEEE80211_SCAN_NOPICK
) == 0) &&

439 (
ss
->
ss_æags
 & 
IEEE80211_SCAN_NOPICK
)) {

440 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

442 
__func__
);

443 
ss
->
ss_æags
 &ğ~
IEEE80211_SCAN_NOPICK
;

447 
sÿÂšg
 = (
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
);

448 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

450  
sÿÂšg
;

451 
	}
}

452 
EXPORT_SYMBOL
(
›“80211_¡¬t_sÿn
);

459 
›“80211_check_sÿn
(
›“80211v­
 *
v­
, 
æags
, 
u_št
 
du¿tiÚ
,

460 
u_št
 
nssid
, cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[],

461 (*
aùiÚ
)(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *))

463 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

464 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

465 
checksÿÆi¡
 = 0;

471 
	`IEEE80211_LOCK_IRQ
(
ic
);

472 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

474 
__func__
,

475 
æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive",

476 
du¿tiÚ
,

477 
›“80211_phymode_Çme
[
v­
->
iv_des_mode
],

478 
æags
 & 
IEEE80211_SCAN_FLUSH
 ? "flush" : "append",

479 
æags
 & 
IEEE80211_SCAN_NOPICK
 ? ",‚opick" : "",

480 
æags
 & 
IEEE80211_SCAN_PICK1ST
 ? ",…ick1st" : "",

481 
æags
 & 
IEEE80211_SCAN_ONCE
 ? ", once" : "",

482 
æags
 & 
IEEE80211_SCAN_USECACHE
 ? ", usecache" : "");

484 ià(
ss
->
ss_İs
 !ğ
NULL
) {

486 ià((
æags
 & 
IEEE80211_SCAN_NOSSID
) == 0) {

491 
	`cİy_ssid
(
v­
, 
ss
, 
nssid
, 
ssids
);

492 
æags
 |ğ
IEEE80211_SCAN_NOSSID
;

494 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0 &&

495 
	`time_befÜe
(
jiff›s
, 
ic
->
ic_Ï¡sÿn
 + 
v­
->
iv_sÿnv®id
)) {

504 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_DISCARD
;

505 
ic
->
ic_æags
 |ğ
IEEE80211_F_SCAN
;

506 
checksÿÆi¡
 = 1;

509 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

510 ià(
checksÿÆi¡
) {

515 
ss
->
ss_æags
 = 
æags
;

516 
ss
->
ss_du¿tiÚ
 = 
du¿tiÚ
;

517 ià(
ss
->
ss_İs
->
	`sÿn_’d
(ss, ss->
ss_v­
, 
aùiÚ
, 
æags
 & 
IEEE80211_SCAN_KEEPMODE
)) {

519 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

523 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

525 ià((
æags
 & 
IEEE80211_SCAN_USECACHE
) == 0)

526  
	`›“80211_¡¬t_sÿn
(
v­
, 
æags
, 
du¿tiÚ
, 
nssid
, 
ssids
);

531 
	}
}

538 
	$›“80211_bg_sÿn
(
›“80211v­
 *
v­
)

540 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

541 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

542 
sÿÂšg
;

544 
	`IEEE80211_LOCK_IRQ
(
ic
);

545 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0) {

546 
u_št
 
du¿tiÚ
;

553 
du¿tiÚ
 = 
IEEE80211_SCAN_OFFCHANNEL
;

555 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

556 "%s: % sÿn, jiff› %lu du¿tiÚ %lu\n", 
__func__
,

557 
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive",

558 
jiff›s
, 
du¿tiÚ
);

560 ià(
ss
->
ss_İs
 !ğ
NULL
) {

561 
ss
->
ss_v­
 = 
v­
;

576 
ss
->
ss_æags
 |ğ
IEEE80211_SCAN_NOPICK
 |

577 
IEEE80211_SCAN_BGSCAN
;

580 ià(
ss
->
ss_Ãxt
 >ğss->
ss_Ï¡
) {

581 
ss
->
ss_Ãxt
 = 0;

582 ià(
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
)

583 
v­
->
iv_¡©s
.
is_sÿn_aùive
++;

585 
v­
->
iv_¡©s
.
is_sÿn_·ssive
++;

586 
ss
->
ss_İs
->
	`sÿn_»¡¬t
(ss, 
v­
);

590 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_DISCARD
;

591 
ss
->
ss_mšdw–l
 = 
du¿tiÚ
;

592 ià(
	`sÿn_»¡¬t
(
	`SCAN_PRIVATE
(
ss
), 
du¿tiÚ
)) {

593 
ic
->
ic_æags
 |ğ
IEEE80211_F_SCAN
;

594 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_BGSCAN
;

600 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

601 "%s: % sÿÀ®»ady iÀ´og»ss\n", 
__func__
,

602 
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive");

605 
sÿÂšg
 = (
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
);

606 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

608  
sÿÂšg
;

609 
	}
}

610 
EXPORT_SYMBOL
(
›“80211_bg_sÿn
);

611 
EXPORT_SYMBOL
(
›“80211_ÿnûl_sÿn
);

617 
	$›“80211_ÿnûl_sÿn
(
›“80211v­
 *
v­
)

619 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

620 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

622 
	`IEEE80211_LOCK_IRQ
(
ic
);

623 ià(
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) {

624 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

625 "%s: cªûÈ% sÿn\n", 
__func__
,

626 
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
 ? "active" : "passive");

629 
ss
->
ss_æags
 &ğ~
IEEE80211_SCAN_NOPICK
;

630 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_CANCEL
;

631 
ss
->
ss_İs
->
	`sÿn_ÿnûl
(ss, 
v­
);

633 
	`mod_tim”
(&
	`SCAN_PRIVATE
(
ss
)->
ss_sÿn_tim”
, 
jiff›s
);

635 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

636 
	}
}

642 
	$sÿn_Ãxt
(
¬g
)

644 
	#ISCAN_REP
 (
ISCAN_MINDWELL
 | 
ISCAN_START
 | 
ISCAN_DISCARD
)

	)

645 
›“80211_sÿn_¡©e
 *
ss
 = (›“80211_sÿn_¡©*)
¬g
;

646 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

647 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

648 
›“80211_chªÃl
 *
chª
;

649 
maxdw–l
, 
sÿÃnd
;

650 
sÿÂšg
, 
sÿndÚe
, 
i
;

652 
	`IEEE80211_LOCK_IRQ
(
ic
);

653 
sÿÂšg
 = (
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) != 0;

654 
	`IEEE80211_UNLOCK_IRQ
(
ic
);

655 ià(!
sÿÂšg
)

658 
agaš
:

659 
sÿndÚe
 = (
ss
->
ss_Ãxt
 >ğss->
ss_Ï¡
) ||

660 ((
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 & 
ISCAN_CANCEL
) != 0);

661 
sÿÃnd
 = 
	`SCAN_PRIVATE
(
ss
)->
ss_sÿÃnd
;

662 ià(!
sÿndÚe
 &&

663 (
ss
->
ss_æags
 & 
IEEE80211_SCAN_GOTPICK
) == 0 &&

664 ((
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 & 
ISCAN_START
) ||

665 
	`time_befÜe
(
jiff›s
 + 
ss
->
ss_mšdw–l
, 
sÿÃnd
))) {

666 
chª
 = 
ss
->
ss_chªs
[ss->
ss_Ãxt
++];

671 ià(
	`time_aá”
(
jiff›s
 + 
ss
->
ss_maxdw–l
, 
sÿÃnd
))

672 
maxdw–l
 = 
sÿÃnd
 - 
jiff›s
;

674 
maxdw–l
 = 
ss
->
ss_maxdw–l
;

676 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

678 
__func__
,

679 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
),

680 
	`chªÃl_ty³
(
ic
->
ic_curchª
),

681 
	`›“80211_chª2›“
(
ic
, 
chª
), 
	`chªÃl_ty³
(chan),

682 (
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
) &&

683 (
chª
->
ic_æags
 & 
IEEE80211_CHAN_PASSIVE
) == 0 ?

685 
ss
->
ss_mšdw–l
, 
maxdw–l
);

690 
	`chªge_chªÃl
(
ic
, 
chª
);

697 ià((
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
) &&

698 (
chª
->
ic_æags
 & 
IEEE80211_CHAN_PASSIVE
) == 0) {

699 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

707 
	`›“80211_£nd_´ob”eq
(
v­
->
iv_bss
,

708 
v­
->
iv_myaddr
, 
dev
->
brßdÿ¡
,

709 
dev
->
brßdÿ¡
,

711 
v­
->
iv_İt_›
, v­->
iv_İt_›_Ën
);

712 
i
 = 0; i < 
ss
->
ss_nssid
; i++)

713 
	`›“80211_£nd_´ob”eq
(
v­
->
iv_bss
,

714 
v­
->
iv_myaddr
, 
dev
->
brßdÿ¡
,

715 
dev
->
brßdÿ¡
,

716 
ss
->
ss_ssid
[
i
].
ssid
,

717 
ss
->
ss_ssid
[
i
].
Ën
,

718 
v­
->
iv_İt_›
, v­->
iv_İt_›_Ën
);

720 
	`SCAN_PRIVATE
(
ss
)->
ss_chªmšdw–l
 = 
jiff›s
 + ss->
ss_mšdw–l
;

721 
	`mod_tim”
(&
	`SCAN_PRIVATE
(
ss
)->
ss_sÿn_tim”
, 
jiff›s
 + 
maxdw–l
);

723 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 &ğ~
ISCAN_REP
;

725 
ic
->
	`ic_sÿn_’d
(ic);

731 ià(
sÿndÚe
)

732 
ic
->
ic_Ï¡sÿn
 = 
jiff›s
;

734 ià((
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
) &&

735 (
ic
->
ic_curchª
 !ğic->
ic_bsschª
))

736 
	`chªge_chªÃl
(
ic
, ic->
ic_bsschª
);

738 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 &ğ~
ISCAN_REP
;

739 
ss
->
ss_æags
 &ğ~
IEEE80211_SCAN_GOTPICK
;

748 ià(((
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 & 
ISCAN_CANCEL
) == 0) &&

749 !
ss
->
ss_İs
->
	`sÿn_’d
(ss, 
v­
, 
NULL
, 0) &&

750 ((
ss
->
ss_æags
 & 
IEEE80211_SCAN_ONCE
) == 0) &&

751 
	`time_befÜe
(
jiff›s
 + 
ss
->
ss_mšdw–l
, 
sÿÃnd
)) {

752 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

755 
__func__
,

756 
jiff›s
, 
ss
->
ss_mšdw–l
, 
sÿÃnd
);

757 
ss
->
ss_Ãxt
 = 0;

758 ià(
ss
->
ss_æags
 & 
IEEE80211_SCAN_ACTIVE
)

759 
v­
->
iv_¡©s
.
is_sÿn_aùive
++;

761 
v­
->
iv_¡©s
.
is_sÿn_·ssive
++;

763 
ic
->
	`ic_sÿn_¡¬t
(ic);

764 
agaš
;

766 ià((
ss
->
ss_æags
 & 
IEEE80211_SCAN_BGSCAN
) == 0)

767 
sÿndÚe
 = 1;

769 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

772 
__func__
, 
sÿndÚe
 ? "done" : "stopped",

773 
jiff›s
, 
ss
->
ss_mšdw–l
, 
sÿÃnd
);

781 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

792 ià(
sÿndÚe
) {

793 
	`›“80211_¡a_pwr§ve
(
v­
, 0);

794 ià(
ss
->
ss_Ãxt
 >ğss->
ss_Ï¡
) {

795 
	`›“80211_nÙify_sÿn_dÚe
(
v­
);

796 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_BGSCAN
;

799 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 &ğ~
ISCAN_CANCEL
;

800 
ss
->
ss_æags
 &=

801 ~(
IEEE80211_SCAN_ONCE
 | 
IEEE80211_SCAN_PICK1ST
);

804 #undeà
ISCAN_REP


805 
	}
}

807 #ifdeà
IEEE80211_DEBUG


809 
	$dump_´obe_b—cÚ
(
u_št8_t
 
subty³
, 
i¢ew
,

810 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
],

811 cÚ¡ 
›“80211_sÿÅ¬ams
 *
¥
)

814 
	`´štk
("[" 
MAC_FMT
 "] %s%s on chan %u (bss chan %u) ",

815 
	`MAC_ADDR
(
mac
), 
i¢ew
 ? "new " : "",

816 
›“80211_mgt_subty³_Çme
[
subty³
 >> 
IEEE80211_FC0_SUBTYPE_SHIFT
],

817 
¥
->
chª
, sp->
bchª
);

818 
	`›“80211_´št_essid
(
¥
->
ssid
 + 2, sp->ssid[1]);

819 
	`´štk
("\n");

821 ià(
i¢ew
) {

822 
	`´štk
("[" 
MAC_FMT
 "] caps 0x%x bintval %uƒrp 0x%x",

823 
	`MAC_ADDR
(
mac
), 
¥
->
ÿpšfo
, sp->
bštv®
, sp->
”p
);

824 ià(
¥
->
couÁry
 !ğ
NULL
) {

825 #ifdeà
__F»eBSD__


826 
	`´štk
(" country info %*D",

827 
¥
->
couÁry
[1], sp->country + 2, " ");

829 
i
;

830 
	`´štk
(" country info");

831 
i
 = 0; i < 
¥
->
couÁry
[1]; i++)

832 
	`´štk
(" %02x", 
¥
->
couÁry
[
i
 + 2]);

835 
	`´štk
("\n");

837 
	}
}

844 
	$›“80211_add_sÿn
(
›“80211v­
 *
v­
,

845 cÚ¡ 
›“80211_sÿÅ¬ams
 *
¥
,

846 cÚ¡ 
›“80211_äame
 *
wh
,

847 
subty³
, 
rssi
, 
u_št64_t
 
¹sf
)

849 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

850 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

860 ià(
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 & 
ISCAN_DISCARD
)

862 #ifdeà
IEEE80211_DEBUG


863 ià(
	`›“80211_msg_sÿn
(
v­
è&& (
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
))

864 
	`dump_´obe_b—cÚ
(
subty³
, 1, 
wh
->
i_addr2
, 
¥
);

866 ià(
ss
->
ss_İs
 !ğ
NULL
 &&

867 
ss
->
ss_İs
->
	`sÿn_add
(ss, 
¥
, 
wh
, 
subty³
, 
rssi
, 
¹sf
)) {

872 ià((
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 & 
ISCAN_MINDWELL
) == 0 &&

873 
	`time_aá”_eq
(
jiff›s
, 
	`SCAN_PRIVATE
(
ss
)->
ss_chªmšdw–l
)) {

874 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

876 
__func__
,

877 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
),

878 
	`chªÃl_ty³
(
ic
->
ic_curchª
),

879 
jiff›s
, 
	`SCAN_PRIVATE
(
ss
)->
ss_chªmšdw–l
);

887 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_MINDWELL
;

889 
	`SCAN_PRIVATE
(
ss
)->
ss_iæags
 |ğ
ISCAN_DISCARD
;

892 
	`mod_tim”
(&
	`SCAN_PRIVATE
(
ss
)->
ss_sÿn_tim”
, 
jiff›s
);

895 
	}
}

902 
	$›“80211_sÿn_timeout
(
›“80211com
 *
ic
)

904 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

906 ià(
ss
->
ss_İs
 !ğ
NULL
)

907 
ss
->
ss_İs
->
	`sÿn_age
(ss);

908 
	}
}

914 
	$›“80211_sÿn_assoc_sucûss
(
›“80211com
 *
ic
, cÚ¡ 
u_št8_t
 
mac
[])

916 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

918 ià(
ss
->
ss_İs
 !ğ
NULL
) {

919 
	`IEEE80211_NOTE_MAC
(
ss
->
ss_v­
, 
IEEE80211_MSG_SCAN
,

920 
mac
, "%s", 
__func__
);

921 
ss
->
ss_İs
->
	`sÿn_assoc_sucûss
(ss, 
mac
);

923 
	}
}

929 
	$›“80211_sÿn_assoc_ç
(
›“80211com
 *
ic
,

930 cÚ¡ 
u_št8_t
 
mac
[], 
»asÚ
)

932 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

934 ià(
ss
->
ss_İs
 !ğ
NULL
) {

935 
	`IEEE80211_NOTE_MAC
(
ss
->
ss_v­
, 
IEEE80211_MSG_SCAN
, 
mac
,

936 "%s:„—sÚ %u", 
__func__
, 
»asÚ
);

937 
ss
->
ss_İs
->
	`sÿn_assoc_ç
(ss, 
mac
, 
»asÚ
);

939 
	}
}

945 
	$›“80211_sÿn_™”©e
(
›“80211com
 *
ic
,

946 
›“80211_sÿn_™”_func
 *
f
, *
¬g
)

948 
»s
 = 0;

949 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

951 ià(
ss
->
ss_İs
 !ğ
NULL
) {

952 
»s
 = 
ss
->
ss_İs
->
	`sÿn_™”©e
(ss, 
f
, 
¬g
);

954  
»s
;

955 
	}
}

961 
	$›“80211_sÿn_æush
(
›“80211com
 *
ic
)

963 
›“80211_sÿn_¡©e
 *
ss
 = 
ic
->
ic_sÿn
;

965 ià(
ss
->
ss_İs
 !ğ
NULL
) {

966 
	`IEEE80211_DPRINTF
(
ss
->
ss_v­
, 
IEEE80211_MSG_SCAN
,

967 "%s\n", 
__func__
);

968 
ss
->
ss_İs
->
	`sÿn_æush
(ss);

970 
	}
}

978 
	$›“80211_sÿn_dfs_aùiÚ
(
›“80211v­
 *
v­
,

979 cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

981 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

982 
›“80211_chªÃl
 *
Ãw_chªÃl
 = 
NULL
;

984 ià(!
	`IEEE80211_IS_MODE_DFS_MASTER
(
v­
->
iv_İmode
))

986 ià(
£
 !ğ
NULL
) {

987 
Ãw_chªÃl
 = 
£
->
£_chª
;

988 ià(
Ãw_chªÃl
 !ğ
NULL
) {

989 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

991 
__func__
);

996 
chªS¹
, 
i
, 
couÁ
;

997 
u_št32_t
 
curChªFÏgs
;

999 ià((
ic
->
ic_curchª
 !ğ
NULL
) &&

1000 (
ic
->
ic_curchª
 !ğ
IEEE80211_CHAN_ANYC
)) {

1001 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1003 
__func__
, 
ic
->
ic_curchª
->
ic_›“
,

1004 
ic
->
ic_curchª
->
ic_äeq
);

1007 ià((
ic
->
ic_bsschª
 !ğ
NULL
) &&

1008 (
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
)) {

1009 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1011 
__func__
, 
ic
->
ic_bsschª
->
ic_›“
,

1012 
ic
->
ic_bsschª
->
ic_äeq
);

1021 
couÁ
 = 0;

1022 
curChªFÏgs
 = (
ic
->
ic_bsschª
->
ic_æags
) &

1023 ~(
IEEE80211_CHAN_RADAR
);

1024 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1025 ià((
ic
->
ic_chªÃls
[
i
].
ic_›“
 !=

1026 
ic
->
ic_bsschª
->
ic_›“
) &&

1027 (
ic
->
ic_chªÃls
[
i
].
ic_æags
 =ğ
curChªFÏgs
)) {

1028 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1031 
__func__
,

1032 
ic
->
ic_chªÃls
[
i
].
ic_›“
,

1033 
ic
->
ic_chªÃls
[
i
].
ic_äeq
);

1034 
couÁ
 ++;

1038 ià(
couÁ
 != 0) {

1040 
chªS¹
 = 
jiff›s
 % 
couÁ
;

1042 
couÁ
 = 0;

1043 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

1044 ià((
ic
->
ic_chªÃls
[
i
].
ic_›“
 !=

1045 
ic
->
ic_bsschª
->
ic_›“
) &&

1046 (
ic
->
ic_chªÃls
[
i
].
ic_æags
 ==

1047 
curChªFÏgs
)) {

1048 ià(
couÁ
++ =ğ
chªS¹
) {

1049 
Ãw_chªÃl
 =

1050 &
ic
->
ic_chªÃls
[
i
];

1057 ià(
Ãw_chªÃl
 !ğ
NULL
)

1058 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1060 "(%4d MHz)\n", 
__func__
,

1061 
Ãw_chªÃl
->
ic_›“
,

1062 
Ãw_chªÃl
->
ic_äeq
);

1065 ià(!
Ãw_chªÃl
) {

1067 
n
 = 0;

1068 
n
 = 0;‚ < 
ic
->
ic_nchªs
;‚++) {

1069 ià(0 =ğ(
ic
->
ic_chªÃls
[
n
].
ic_æags
 &

1070 
IEEE80211_CHAN_RADAR
)) {

1071 
Ãw_chªÃl
 = &
ic
->
ic_chªÃls
[
n
];

1075 ià(
Ãw_chªÃl
 !ğ
NULL
)

1076 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1078 
__func__
);

1080 ià(
Ãw_chªÃl
 !ğ
NULL
) {

1082 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

1083 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1085 
__func__
,

1086 
Ãw_chªÃl
->
ic_›“
,

1087 
Ãw_chªÃl
->
ic_äeq
);

1089 
ic
->
ic_chªchªge_chª
 = 
Ãw_chªÃl
->
ic_›“
;

1090 
ic
->
ic_chªchªge_tb‰
 =

1091 
IEEE80211_RADAR_CHANCHANGE_TBTT_COUNT
;

1092 
ic
->
ic_æags
 |ğ
IEEE80211_F_CHANSWITCH
;

1095 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1097 "%3d (%4d MHz)\n", 
__func__
,

1098 
Ãw_chªÃl
->
ic_›“
,

1099 
Ãw_chªÃl
->
ic_äeq
);

1103 
	`chªge_chªÃl
(
ic
, 
Ãw_chªÃl
);

1104 
ic
->
ic_bsschª
 = 
Ãw_chªÃl
;

1105 ià(
v­
->
iv_bss
)

1106 
v­
->
iv_bss
->
ni_chª
 = 
Ãw_chªÃl
;

1110 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DOTH
,

1111 "%s:‚ew chªÃÈnÙ found\n", 
__func__
);

1116 
	}
}

1117 
EXPORT_SYMBOL
(
›“80211_sÿn_dfs_aùiÚ
);

	@ieee80211_scan.h

33 #iâdeà
_NET80211_IEEE80211_SCAN_H_


34 
	#_NET80211_IEEE80211_SCAN_H_


	)

36 
	#IEEE80211_SCAN_MAX
 
IEEE80211_CHAN_MAX


	)

38 
	g›“80211_sÿÂ”
;

39 
	g›“80211_sÿn_’Œy
;

41 
	s›“80211_sÿn_ssid
 {

42 
	mËn
;

43 
u_št8_t
 
	mssid
[
IEEE80211_NWID_LEN
];

45 
	#IEEE80211_SCAN_MAX_SSID
 1

	)

47 
	s›“80211_sÿn_¡©e
 {

48 
›“80211v­
 *
	mss_v­
;

49 cÚ¡ 
›“80211_sÿÂ”
 *
	mss_İs
;

50 *
	mss_´iv
;

51 
u_št16_t
 
	mss_æags
;

52 
	#IEEE80211_SCAN_NOPICK
 0x0001

	)

53 
	#IEEE80211_SCAN_ACTIVE
 0x0002

	)

54 
	#IEEE80211_SCAN_PICK1ST
 0x0004

	)

55 
	#IEEE80211_SCAN_BGSCAN
 0x0008

	)

56 
	#IEEE80211_SCAN_ONCE
 0x0010

	)

57 
	#IEEE80211_SCAN_GOTPICK
 0x1000

	)

59 
u_št8_t
 
	mss_nssid
;

60 
›“80211_sÿn_ssid
 
	mss_ssid
[
IEEE80211_SCAN_MAX_SSID
];

63 
›“80211_chªÃl
 *
	mss_chªs
[
IEEE80211_SCAN_MAX
];

64 
u_št16_t
 
	mss_Ãxt
;

65 
u_št16_t
 
	mss_Ï¡
;

66 
	mss_mšdw–l
;

67 
	mss_maxdw–l
;

68 
u_št
 
	mss_du¿tiÚ
;

77 
	#IEEE80211_SCAN_FLUSH
 0x10000

	)

78 
	#IEEE80211_SCAN_NOSSID
 0x20000

	)

79 
	#IEEE80211_SCAN_USECACHE
 0x40000

	)

80 
	#IEEE80211_SCAN_KEEPMODE
 0x80000

	)

82 
	g›“80211com
;

83 
›“80211_sÿn_©ch
(
›“80211com
 *);

84 
›“80211_sÿn_d‘ach
(
›“80211com
 *);

85 
›“80211_sÿn_v©ch
(
›“80211v­
 *);

86 
›“80211_sÿn_vd‘ach
(
›“80211v­
 *);

88 
›“80211_sÿn_dump_chªÃls
(cÚ¡ 
›“80211_sÿn_¡©e
 *);

90 
	#IEEE80211_SCAN_FOREVER
 0x7fffffff

	)

91 
›“80211_¡¬t_sÿn
(
›“80211v­
 *, , 
u_št
, u_int,

92 cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[]);

93 
›“80211_check_sÿn
(
›“80211v­
 *, , 
u_št
, u_int,

94 cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[],

95 (*
aùiÚ
)(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *));

96 
	`›“80211_bg_sÿn
(
›“80211v­
 *);

97 
	`›“80211_ÿnûl_sÿn
(
›“80211v­
 *);

99 
	`›“80211_sÿn_dfs_aùiÚ
(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *);

101 
›“80211_sÿÅ¬ams
;

102 
	`›“80211_add_sÿn
(
›“80211v­
 *, cÚ¡ 
›“80211_sÿÅ¬ams
 *,

103 cÚ¡ 
›“80211_äame
 *, , , 
u_št64_t
);

104 
	`›“80211_sÿn_timeout
(
›“80211com
 *);

106 
	`›“80211_sÿn_assoc_sucûss
(
›“80211com
 *,

107 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
]);

109 
IEEE80211_SCAN_FAIL_TIMEOUT
 = 1,

110 
IEEE80211_SCAN_FAIL_STATUS
 = 2

112 
	`›“80211_sÿn_assoc_ç
(
›“80211com
 *,

113 cÚ¡ 
u_št8_t
 
mac
[
IEEE80211_ADDR_LEN
], );

114 
	`›“80211_sÿn_æush
(
›“80211com
 *);

116 
›“80211_sÿn_’Œy
;

117 
	t›“80211_sÿn_™”_func
(*, cÚ¡ 
	t›“80211_sÿn_’Œy
 *);

118 
	`›“80211_sÿn_™”©e
(
›“80211com
 *, 
›“80211_sÿn_™”_func
 *, *);

127 
	s›“80211_sÿÅ¬ams
 {

128 
u_št16_t
 
ÿpšfo
;

129 
u_št16_t
 
fhdw–l
;

130 
u_št8_t
 
chª
;

131 
u_št8_t
 
bchª
;

132 
u_št8_t
 
fhšdex
;

133 
u_št8_t
 
”p
;

134 
u_št16_t
 
bštv®
;

135 
u_št8_t
 
timoff
;

136 
u_št8_t
 *
tim
;

137 
u_št8_t
 *
t¡amp
;

138 
u_št8_t
 *
couÁry
;

139 
u_št8_t
 *
ssid
;

140 
u_št8_t
 *
¿‹s
;

141 
u_št8_t
 *
x¿‹s
;

142 
u_št8_t
 *
c§
;

143 
u_št8_t
 *
w·
;

144 
u_št8_t
 *
r¢
;

145 
u_št8_t
 *
wme
;

146 
u_št8_t
 *
©h
;

153 
	s›“80211_sÿn_’Œy
 {

154 
u_št8_t
 
£_maÿddr
[
IEEE80211_ADDR_LEN
];

155 
u_št8_t
 
£_bssid
[
IEEE80211_ADDR_LEN
];

156 
u_št8_t
 
£_ssid
[2 + 
IEEE80211_NWID_LEN
];

157 
u_št8_t
 
£_¿‹s
[2 + 
IEEE80211_RATE_MAXSIZE
];

158 
u_št8_t
 
£_x¿‹s
[2 + 
IEEE80211_RATE_MAXSIZE
];

159 
u_št64_t
 
£_¹sf
;

161 
u_št8_t
 
d©a
[8];

162 
__Ë64
 
tsf
;

163 } 
£_t¡amp
;

164 
u_št16_t
 
£_štv®
;

165 
u_št16_t
 
£_ÿpšfo
;

166 
›“80211_chªÃl
 *
£_chª
;

167 
u_št16_t
 
£_timoff
;

168 
u_št16_t
 
£_fhdw–l
;

169 
u_št8_t
 
£_fhšdex
;

170 
u_št8_t
 
£_”p
;

171 
št8_t
 
£_rssi
;

172 
u_št8_t
 
£_dtim³riod
;

173 
u_št8_t
 *
£_w·_›
;

174 
u_št8_t
 *
£_r¢_›
;

175 
u_št8_t
 *
£_wme_›
;

176 
u_št8_t
 *
£_©h_›
;

177 
u_št
 
£_age
;

185 
	s›“80211_sÿÂ”
 {

186 cÚ¡ *
sÿn_Çme
;

187 (*
sÿn_©ch
)(
›“80211_sÿn_¡©e
 *);

188 (*
sÿn_d‘ach
)(
›“80211_sÿn_¡©e
 *);

189 (*
sÿn_¡¬t
)(
›“80211_sÿn_¡©e
 *, 
›“80211v­
 *);

190 (*
sÿn_»¡¬t
)(
›“80211_sÿn_¡©e
 *, 
›“80211v­
 *);

191 (*
sÿn_ÿnûl
)(
›“80211_sÿn_¡©e
 *, 
›“80211v­
 *);

192 (*
sÿn_’d
)(
›“80211_sÿn_¡©e
 *, 
›“80211v­
 *,

193 (*
aùiÚ
)(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *),

194 
u_št32_t
);

195 (*
sÿn_æush
)(
›“80211_sÿn_¡©e
 *);

197 (*
sÿn_add
)(
›“80211_sÿn_¡©e
 *,

198 cÚ¡ 
›“80211_sÿÅ¬ams
 *,

199 cÚ¡ 
›“80211_äame
 *, , , 
u_št64_t
);

201 (*
sÿn_age
)(
›“80211_sÿn_¡©e
 *);

203 (*
sÿn_assoc_ç
)(
›“80211_sÿn_¡©e
 *,

204 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
], );

206 (*
sÿn_assoc_sucûss
)(
›“80211_sÿn_¡©e
 *,

207 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
]);

209 (*
sÿn_™”©e
)(
›“80211_sÿn_¡©e
 *,

210 
›“80211_sÿn_™”_func
 *, *);

212 (*
sÿn_deçuÉ
)(
›“80211v­
 *,

213 cÚ¡ 
›“80211_sÿn_’Œy
 *);

215 cÚ¡ 
›“80211_sÿÂ”
 *
	`›“80211_sÿÂ”_g‘
(
›“80211_İmode
,

217 
	`›“80211_sÿÂ”_»gi¡”
(
›“80211_İmode
,

218 cÚ¡ 
›“80211_sÿÂ”
 *);

219 
	`›“80211_sÿÂ”_uÄegi¡”
(
›“80211_İmode
,

220 cÚ¡ 
›“80211_sÿÂ”
 *);

221 
	`›“80211_sÿÂ”_uÄegi¡”_®l
(cÚ¡ 
›“80211_sÿÂ”
 *);

	@ieee80211_scan_ap.c

34 #iâdeà
EXPORT_SYMTAB


35 
	#EXPORT_SYMTAB


	)

41 #iâdeà
AUTOCONF_INCLUDED


42 
	~<lšux/cÚfig.h
>

44 
	~<lšux/v”siÚ.h
>

45 
	~<lšux/moduË.h
>

46 
	~<lšux/skbuff.h
>

47 
	~<lšux/Ãtdeviû.h
>

48 
	~<lšux/š™.h
>

49 
	~<lšux/d–ay.h
>

51 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,11)

53 
	$u32_sw­
(*
a
, *
b
, 
size
)

55 
u32
 
t
 = *(u32 *)
a
;

56 *(
u32
 *)
a
 = *(u32 *)
b
;

57 *(
u32
 *)
b
 = 
t
;

58 
	}
}

60 
	$g’”ic_sw­
(*
a
, *
b
, 
size
)

62 
t
;

65 
t
 = *(*)
a
;

66 *(*)
a
++ = *(*)
b
;

67 *(*)
b
++ = 
t
;

68 } --
size
 > 0);

69 
	}
}

88 
sÜt
(*
ba£
, 
size_t
 
num
, size_ˆ
size
,

89 (*
cmp
)(const *, const *),

90 (*
sw­
)(*, *, 
size
))

93 
i
 = (
num
/2 - 1è* 
size
, 
n
 =‚um * size, 
c
, 
r
;

95 ià(!
sw­
)

96 
sw­
 = (
size
 =ğ4 ? 
u32_sw­
 : 
g’”ic_sw­
);

99  ; 
i
 >ğ0; i -ğ
size
) {

100 
r
 = 
i
;„ * 2 + 
size
 < 
n
;„ = 
c
) {

101 
c
 = 
r
 * 2 + 
size
;

102 ià(
c
 < 
n
 - 
size
 && 
	`cmp
(
ba£
 + c, base + c + size) < 0)

103 
c
 +ğ
size
;

104 ià(
	`cmp
(
ba£
 + 
r
, ba£ + 
c
) >= 0)

106 
	`sw­
(
ba£
 + 
r
, ba£ + 
c
, 
size
);

111 
i
 = 
n
 - 
size
; i > 0; i -= size) {

112 
	`sw­
(
ba£
, ba£ + 
i
, 
size
);

113 
r
 = 0;„ * 2 + 
size
 < 
i
;„ = 
c
) {

114 
c
 = 
r
 * 2 + 
size
;

115 ià(
c
 < 
i
 - 
size
 && 
	`cmp
(
ba£
 + c, base + c + size) < 0)

116 
c
 +ğ
size
;

117 ià(
	`cmp
(
ba£
 + 
r
, ba£ + 
c
) >= 0)

119 
	`sw­
(
ba£
 + 
r
, ba£ + 
c
, 
size
);

122 
	}
}

124 
	~<lšux/sÜt.h
>

127 
	~"if_medŸ.h
"

129 
	~<Ãt80211/›“80211_v¬.h
>

131 
	#AP_PURGE_SCANS
 2

	)

132 
	#RSSI_LPF_LEN
 10

	)

133 
	#RSSI_EP_MULTIPLIER
 (1 << 7è

	)

134 
	#RSSI_IN
(
x
è((xè* 
RSSI_EP_MULTIPLIER
)

	)

135 
	#LPF_RSSI
(
x
, 
y
, 
Ën
è(((xè* (Ö’è- 1è+ (y)è/ (Ën))

	)

136 
	#RSSI_LPF
(
x
, 
y
) do { \

137 ià((
y
) >= -20) \

138 
x
 = 
	`LPF_RSSI
((x), 
	`RSSI_IN
((
y
)), 
RSSI_LPF_LEN
); \

139 } 0)

	)

140 
	#EP_RND
(
x
, 
mul
) \

141 ((((
x
)%(
mul
)è>ğ((mul)/2)è? 
	`howmªy
(x, mulè: (x)/(mul))

	)

142 
	#RSSI_GET
(
x
è
	`EP_RND
(x, 
RSSI_EP_MULTIPLIER
)

	)

143 
	#AP_HASHSIZE
 32

	)

145 
	#AP_HASH
(
addr
) \

146 (((cÚ¡ 
u_št8_t
 *)(
addr
))[
IEEE80211_ADDR_LEN
 - 1] % 
AP_HASHSIZE
)

	)

147 
	#SCAN_AP_LOCK_INIT
(
_¡
, 
_Çme
) \

148 
	`¥š_lock_š™
(&(
_¡
)->
as_lock
)

	)

149 
	#SCAN_AP_LOCK_DESTROY
(
_¡
)

	)

150 
	#SCAN_AP_LOCK_IRQ
(
_¡
) do { \

151 
__¡lockæags
; \

152 
	`¥š_lock_œq§ve
(&(
_¡
)->
as_lock
, 
__¡lockæags
);

	)

153 
	#SCAN_AP_UNLOCK_IRQ
(
_¡
) \

154 
	`¥š_uÆock_œq»¡Üe
(&(
_¡
)->
as_lock
, 
__¡lockæags
); \

155 } 0)

	)

156 
	#SCAN_AP_UNLOCK_IRQ_EARLY
(
_¡
) \

157 
	`¥š_uÆock_œq»¡Üe
(&(
_¡
)->
as_lock
, 
__¡lockæags
);

	)

159 
	#SCAN_AP_GEN_LOCK_INIT
(
_¡
, 
_Çme
) \

160 
	`¥š_lock_š™
(&(
_¡
)->
as_sÿÆock
)

	)

161 
	#SCAN_AP_GEN_LOCK_DESTROY
(
_¡
)

	)

162 
	#SCAN_AP_GEN_LOCK
(
_¡
è
	`¥š_lock
(&(_¡)->
as_sÿÆock
);

	)

163 
	#SCAN_AP_GEN_UNLOCK
(
_¡
è
	`¥š_uÆock
(&(_¡)->
as_sÿÆock
);

	)

165 
	ssÿn_’Œy
 {

166 
›“80211_sÿn_’Œy
 
	mba£
;

167 
TAILQ_ENTRY
(
sÿn_’Œy
è
	m£_li¡
;

168 
LIST_ENTRY
(
sÿn_’Œy
è
	m£_hash
;

169 
u_št8_t
 
	m£_£’
;

170 
u_št8_t
 
	m£_nÙ£’
;

171 
u_št32_t
 
	m£_avgrssi
;

172 
	m£_Ï¡upd©e
;

173 
	m£_Ï¡ç
;

174 
	m£_Ï¡assoc
;

175 
u_št
 
	m£_sÿng’
;

178 
	s­_¡©e
 {

179 
	mas_v­_desœed_mode
;

181 
	mas_»quœed_mode
;

184 
	mas_maxrssi
[
IEEE80211_CHAN_MAX
];

188 
¥šlock_t
 
	mas_lock
;

189 
	mas_Ãwsÿn
;

191 
TAILQ_HEAD
(, 
sÿn_’Œy
è
	mas_’Œy
;

192 
ATH_LIST_HEAD
(, 
sÿn_’Œy
è
	mas_hash
[
AP_HASHSIZE
];

193 
¥šlock_t
 
	mas_sÿÆock
;

194 
u_št
 
	mas_sÿng’
;

196 
IEEE80211_TQ_STRUCT
 
	mas_aùiÚtq
;

197 
›“80211_sÿn_’Œy
 
	mas_£lbss
;

198 (*
	mas_aùiÚ
)(
	m›“80211v­
 *, cÚ¡ 
	m›“80211_sÿn_’Œy
 *);

201 
­_æush
(
›“80211_sÿn_¡©e
 *);

202 
aùiÚ_skËt
(
IEEE80211_TQUEUE_ARG
);

203 
›“80211_chªÃl
 *
fšd11gchªÃl
(
›“80211com
 *
ic
,

204 
i
, 
äeq
);

206 cÚ¡ 
u_št
 
	gchªæags
[] = {

207 
IEEE80211_CHAN_B
,

208 
IEEE80211_CHAN_A
,

209 
IEEE80211_CHAN_B
,

210 
IEEE80211_CHAN_PUREG
,

211 
IEEE80211_CHAN_FHSS
,

212 
IEEE80211_CHAN_A
,

216 
IEEE80211_CHAN_PUREG
,

217 
IEEE80211_CHAN_ST
,

220 cÚ¡ 
u_št16_t
 
	grş1
[] =

223 cÚ¡ 
u_št16_t
 
	grş2
[] =

225 cÚ¡ 
u_št16_t
 
	grş3
[] =

227 cÚ¡ 
u_št16_t
 
	grş4
[] =

229 cÚ¡ 
u_št16_t
 
	grş7
[] =

233 cÚ¡ 
u_št16_t
 
	grş8
[] =

235 cÚ¡ 
u_št16_t
 
	grş9
[] =

237 cÚ¡ 
u_št16_t
 
	grş10
[] =

239 cÚ¡ 
u_št16_t
 
	grş11
[] =

241 #ifdeà
ATH_TURBO_SCAN


242 cÚ¡ 
u_št16_t
 
	grş5
[] =

244 cÚ¡ 
u_št16_t
 
	grş6
[] =

246 cÚ¡ 
u_št16_t
 
	grş6x
[] =

248 cÚ¡ 
u_št16_t
 
	grş12
[] =

250 cÚ¡ 
u_št16_t
 
	grş13
[] =

254 
	ssÿÆi¡
 {

255 
u_št16_t
 
	mmode
;

256 
u_št16_t
 
	mcouÁ
;

257 cÚ¡ 
u_št16_t
 *
	mli¡
;

260 
	#IEEE80211_MODE_TURBO_STATIC_A
 
IEEE80211_MODE_MAX


	)

261 
	#X
(
a
è.
couÁ
 = 
	`ARRAY_SIZE
×), .
li¡
 = 
	)
a

263 cÚ¡ 
sÿÆi¡
 
	g¡aSÿnTabË
[] = {

264 { 
IEEE80211_MODE_11B
, 
X
(
rş3
) },

265 { 
IEEE80211_MODE_11A
, 
X
(
rş1
) },

266 { 
IEEE80211_MODE_11A
, 
X
(
rş2
) },

267 { 
IEEE80211_MODE_11B
, 
X
(
rş8
) },

268 { 
IEEE80211_MODE_11B
, 
X
(
rş9
) },

269 { 
IEEE80211_MODE_11A
, 
X
(
rş4
) },

270 #ifdeà
ATH_TURBO_SCAN


271 { 
IEEE80211_MODE_TURBO_STATIC_A
, 
X
(
rş5
) },

272 { 
IEEE80211_MODE_TURBO_STATIC_A
, 
X
(
rş6
) },

273 { 
IEEE80211_MODE_TURBO_A
, 
X
(
rş6x
) },

274 { 
IEEE80211_MODE_TURBO_A
, 
X
(
rş13
) },

276 { 
IEEE80211_MODE_11A
, 
X
(
rş7
) },

277 { 
IEEE80211_MODE_11B
, 
X
(
rş10
) },

278 { 
IEEE80211_MODE_11A
, 
X
(
rş11
) },

279 #ifdeà
ATH_TURBO_SCAN


280 { 
IEEE80211_MODE_TURBO_G
, 
X
(
rş12
) },

282 { .
li¡
 = 
NULL
 }

285 #undeà
X


288 
	$add_chªÃls
(
›“80211com
 *
ic
,

289 
›“80211_sÿn_¡©e
 *
ss
,

290 
›“80211_phymode
 
mode
, cÚ¡ 
u_št16_t
 
äeq
[], 
näeq
)

292 
›“80211_chªÃl
 *
c
, *
cg
;

293 
u_št
 
modeæags
;

294 
i
;

296 
	`KASSERT
(
mode
 < 
	`ARRAY_SIZE
(
chªæags
), ("Unexpected mode %u", mode));

297 
modeæags
 = 
chªæags
[
mode
];

298 
i
 = 0; i < 
näeq
; i++) {

299 
c
 = 
	`›“80211_fšd_chªÃl
(
ic
, 
äeq
[
i
], 
modeæags
);

300 ià((
c
 =ğ
NULL
è|| 
	`isşr
(
ic
->
ic_chª_aùive
, c->
ic_›“
))

302 ià(
mode
 =ğ
IEEE80211_MODE_AUTO
) {

305 ià(
	`IEEE80211_IS_CHAN_B
(
c
) &&

306 (
cg
 = 
	`fšd11gchªÃl
(
ic
, 
i
, 
c
->
ic_äeq
)è!ğ
NULL
)

307 
c
 = 
cg
;

309 ià(
ss
->
ss_Ï¡
 >ğ
IEEE80211_SCAN_MAX
)

311 
ss
->
ss_chªs
[ss->
ss_Ï¡
++] = 
c
;

313 
	}
}

317 
	$checkbË
(cÚ¡ 
sÿÆi¡
 *
sÿn
, cÚ¡ 
›“80211_chªÃl
 *
c
)

319 
i
;

321 ; 
sÿn
->
li¡
 !ğ
NULL
; scan++) {

322 
i
 = 0; i < 
sÿn
->
couÁ
; i++)

323 ià(
sÿn
->
li¡
[
i
] =ğ
c
->
ic_äeq
)

327 
	}
}

333 
	$­_©ch
(
›“80211_sÿn_¡©e
 *
ss
)

335 
­_¡©e
 *
as
;

337 
	`_MOD_INC_USE
(
THIS_MODULE
,  0);

339 
	`MALLOC
(
as
, 
­_¡©e
 *, (ap_state),

340 
M_80211_SCAN
, 
M_NOWAIT
 | 
M_ZERO
);

341 ià(
as
 =ğ
NULL
)

343 
	`SCAN_AP_LOCK_INIT
(
as
, "scan_ap");

344 
	`SCAN_AP_GEN_LOCK_INIT
(
as
, "scan_ap_gen");

345 
	`TAILQ_INIT
(&
as
->
as_’Œy
);

346 
	`IEEE80211_INIT_TQUEUE
(&
as
->
as_aùiÚtq
, 
aùiÚ_skËt
, 
ss
);

347 
ss
->
ss_´iv
 = 
as
;

348 
	`­_æush
(
ss
);

350 
	}
}

356 
	$­_d‘ach
(
›“80211_sÿn_¡©e
 *
ss
)

358 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

360 ià(
as
 !ğ
NULL
) {

361 
	`­_æush
(
ss
);

362 
	`IEEE80211_CANCEL_TQUEUE
(&
as
->
as_aùiÚtq
);

363 
	`FREE
(
as
, 
M_80211_SCAN
);

366 
	`_MOD_DEC_USE
(
THIS_MODULE
);

368 
	}
}

374 
	$­_æush
(
›“80211_sÿn_¡©e
 *
ss
)

376 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

377 
sÿn_’Œy
 *
£
, *
Ãxt
;

379 
	`SCAN_AP_LOCK_IRQ
(
as
);

380 
	`mem£t
(
as
->
as_maxrssi
, 0, (as->as_maxrssi));

381 
	`TAILQ_FOREACH_SAFE
(
£
, &
as
->
as_’Œy
, 
£_li¡
, 
Ãxt
) {

382 
	`TAILQ_REMOVE
(&
as
->
as_’Œy
, 
£
, 
£_li¡
);

383 
	`LIST_REMOVE
(
£
, 
£_hash
);

384 
	`FREE
(
£
, 
M_80211_SCAN
);

386 
ss
->
ss_Ï¡
 = 0;

387 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

389 
	}
}

393 
	$§ve›
(
u_št8_t
 **
›p
, cÚ¡ u_št8_ˆ*
›
)

395 ià(
›
 =ğ
NULL
)

396 *
›p
 = 
NULL
;

398 
	`›“80211_§ve›
(
›p
, 
›
);

399 
	}
}

402 
›“80211_chªÃl
 *

403 
	$fšd11gchªÃl
(
›“80211com
 *
ic
, 
i
, 
äeq
)

405 
›“80211_chªÃl
 *
c
;

406 
j
;

411 
j
 = 
i
 + 1; j < 
ic
->
ic_nchªs
; j++) {

412 
c
 = &
ic
->
ic_chªÃls
[
j
];

413 ià((
c
->
ic_äeq
 =ğ
äeq
è&& 
	`IEEE80211_IS_CHAN_ANYG
(c))

414  
c
;

416 
j
 = 0; j < 
i
; j++) {

417 
c
 = &
ic
->
ic_chªÃls
[
j
];

418 ià((
c
->
ic_äeq
 =ğ
äeq
è&& 
	`IEEE80211_IS_CHAN_ANYG
(c))

419  
c
;

421  
NULL
;

422 
	}
}

428 
	$­_¡¬t
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

430 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

431 
›“80211com
 *
ic
 = 
NULL
;

432 cÚ¡ 
sÿÆi¡
 *
¦
 = 
NULL
;

433 
›“80211_chªÃl
 *
c
 = 
NULL
;

434 
i
;

435 
mode
 = 0;

437 
	`SCAN_AP_LOCK_IRQ
(
as
);

438 
ic
 = 
v­
->
iv_ic
;

440 
as
->
as_v­_desœed_mode
 = 
v­
->
iv_des_mode
;

441 
as
->
as_»quœed_mode
 = 0;

442 ià(
as
->
as_v­_desœed_mode
 !ğ
IEEE80211_MODE_AUTO
) {

443 
as
->
as_»quœed_mode
 = 
chªæags
[as->
as_v­_desœed_mode
];

444 ià((
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
) &&

445 (
as
->
as_»quœed_mode
 !ğ
IEEE80211_CHAN_ST
)) {

447 ià(
as
->
as_v­_desœed_mode
 =ğ
IEEE80211_MODE_11G
)

448 
as
->
as_»quœed_mode
 = 
IEEE80211_CHAN_108G
;

450 
as
->
as_»quœed_mode
 = 
IEEE80211_CHAN_108A
;

454 
ss
->
ss_Ï¡
 = 0;

458 
¦
 = 
¡aSÿnTabË
; sl->
li¡
 !ğ
NULL
; sl++) {

459 
mode
 = 
¦
->mode;

464 ià(
as
->
as_v­_desœed_mode
 &&

465 (
as
->
as_v­_desœed_mode
 !ğ
mode
) &&

466 (
as
->
as_v­_desœed_mode
 =ğ
IEEE80211_MODE_11G
) &&

467 (
mode
 =ğ
IEEE80211_MODE_11B
))

468 
mode
 = 
IEEE80211_MODE_11G
;

473 ià(!
as
->
as_v­_desœed_mode
 && (
mode
 =ğ
IEEE80211_MODE_11B
))

474 
mode
 = 
IEEE80211_MODE_AUTO
;

478 
	`add_chªÃls
(
ic
, 
ss
, 
mode
, 
¦
->
li¡
, sl->
couÁ
);

483 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

484 
c
 = &
ic
->
ic_chªÃls
[
i
];

487 ià(
	`IEEE80211_IS_CHAN_TURBO
(
c
è&& 
v­
->
iv_æags
 & 
IEEE80211_F_XR
)

491 ià(!
as
->
as_»quœed_mode
 && !
	`IEEE80211_IS_CHAN_ST
(
c
))

495 ià(
v­
->
iv_des_mode
 =ğ
IEEE80211_MODE_AUTO
 &&

496 
	`IEEE80211_IS_CHAN_B
(
c
) &&

497 
	`fšd11gchªÃl
(
ic
, 
i
, 
c
->
ic_äeq
))

503 ià(
	`checkbË
(
¡aSÿnTabË
, 
c
))

507 ià((
c
 =ğ
NULL
è|| 
	`isşr
(
ic
->
ic_chª_aùive
, c->
ic_›“
))

511 ià(
ss
->
ss_Ï¡
 >ğ
IEEE80211_SCAN_MAX
)

514 
ss
->
ss_chªs
[ss->
ss_Ï¡
++] = 
c
;

516 
ss
->
ss_Ãxt
 = 0;

518 
ss
->
ss_mšdw–l
 = 
	`m£cs_to_jiff›s
(200);

519 
ss
->
ss_maxdw–l
 = 
	`m£cs_to_jiff›s
(300);

521 #ifdeà
IEEE80211_DEBUG


522 ià(
	`›“80211_msg_sÿn
(
v­
)) {

523 
	`´štk
("%s: sÿÀ£ˆ", 
v­
->
iv_dev
->
Çme
);

524 
	`›“80211_sÿn_dump_chªÃls
(
ss
);

525 
	`´štk
(" dwell min %ld max %ld\n",

526 
ss
->
ss_mšdw–l
, ss->
ss_maxdw–l
);

530 
as
->
as_Ãwsÿn
 = 1;

531 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

533 
	}
}

539 
	$­_»¡¬t
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

541 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

542 
as
->
as_Ãwsÿn
 = 1;

544 
	}
}

550 
	$­_ÿnûl
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

552 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

553 
	`IEEE80211_CANCEL_TQUEUE
(&
as
->
as_aùiÚtq
);

555 
	}
}

561 
	$­_add
(
›“80211_sÿn_¡©e
 *
ss
, cÚ¡ 
›“80211_sÿÅ¬ams
 *
¥
,

562 cÚ¡ 
›“80211_äame
 *
wh
, 
subty³
, 
rssi
, 
u_št64_t
 
¹sf
)

564 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

565 cÚ¡ 
u_št8_t
 *
maÿddr
 = 
wh
->
i_addr2
;

566 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

567 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

568 
sÿn_’Œy
 *
£
 = 
NULL
;

569 
›“80211_sÿn_’Œy
 *
i£
 = 
NULL
;

570 
hash
 = 
	`AP_HASH
(
maÿddr
);

571 
chª
;

574 
	`SCAN_AP_LOCK_IRQ
(
as
);

576 
chª
 = 
	`›“80211_chª2›“
(
ic
, ic->
ic_curchª
);

578 ià(
rssi
 > 
as
->
as_maxrssi
[
chª
])

579 
as
->
as_maxrssi
[
chª
] = 
rssi
;

580 
	`LIST_FOREACH
(
£
, &
as
->
as_hash
[
hash
], 
£_hash
)

581 ià(
	`IEEE80211_ADDR_EQ
(
£
->
ba£
.
£_maÿddr
, 
maÿddr
) &&

582 (
¥
->
ssid
[1] =ğ
£
->
ba£
.
£_ssid
[1]) &&

583 !
	`memcmp
(
£
->
ba£
.
£_ssid
 + 2, 
¥
->
ssid
 + 2,

584 
£
->
ba£
.
£_ssid
[1]))

585 
found
;

587 
	`MALLOC
(
£
, 
sÿn_’Œy
 *, (scan_entry),

588 
M_80211_SCAN
, 
M_NOWAIT
 | 
M_ZERO
);

590 ià(
£
 =ğ
NULL
) {

591 
	`SCAN_AP_UNLOCK_IRQ_EARLY
(
as
);

595 
£
->
£_sÿng’
 = 
as
->
as_sÿng’
-1;

596 
	`IEEE80211_ADDR_COPY
(
£
->
ba£
.
£_maÿddr
, 
maÿddr
);

597 
	`TAILQ_INSERT_TAIL
(&
as
->
as_’Œy
, 
£
, 
£_li¡
);

598 
	`LIST_INSERT_HEAD
(&
as
->
as_hash
[
hash
], 
£
, 
£_hash
);

600 
found
:

601 
i£
 = &
£
->
ba£
;

604 ià((
¥
->
ssid
[1] != 0) &&

605 ((
subty³
 =ğ
IEEE80211_FC0_SUBTYPE_PROBE_RESP
) ||

606 (
i£
->
£_ssid
[1] == 0)))

607 
	`memıy
(
i£
->
£_ssid
, 
¥
->
ssid
, 2 + sp->ssid[1]);

609 
	`memıy
(
i£
->
£_¿‹s
, 
¥
->
¿‹s
,

610 
	`IEEE80211_SANITISE_RATESIZE
(2 + 
¥
->
¿‹s
[1]));

611 ià(
¥
->
x¿‹s
 !ğ
NULL
) {

612 
	`memıy
(
i£
->
£_x¿‹s
, 
¥
->
x¿‹s
,

613 
	`IEEE80211_SANITISE_RATESIZE
(2 + 
¥
->
x¿‹s
[1]));

615 
i£
->
£_x¿‹s
[1] = 0;

617 
	`IEEE80211_ADDR_COPY
(
i£
->
£_bssid
, 
wh
->
i_addr3
);

620 ià(
£
->
£_Ï¡upd©e
 == 0)

621 
£
->
£_avgrssi
 = 
	`RSSI_IN
(
rssi
);

623 
	`RSSI_LPF
(
£
->
£_avgrssi
, 
rssi
);

624 
£
->
ba£
.
£_rssi
 = 
	`RSSI_GET
(£->
£_avgrssi
);

626 
i£
->
£_¹sf
 = 
¹sf
;

627 
	`memıy
(
i£
->
£_t¡amp
.
d©a
, 
¥
->
t¡amp
, (ise->se_tstamp));

628 
i£
->
£_štv®
 = 
¥
->
bštv®
;

629 
i£
->
£_ÿpšfo
 = 
¥
->
ÿpšfo
;

630 
i£
->
£_chª
 = 
ic
->
ic_curchª
;

631 
i£
->
£_fhdw–l
 = 
¥
->
fhdw–l
;

632 
i£
->
£_fhšdex
 = 
¥
->
fhšdex
;

633 
i£
->
£_”p
 = 
¥
->
”p
;

634 
i£
->
£_timoff
 = 
¥
->
timoff
;

636 ià(
¥
->
tim
 !ğ
NULL
) {

637 cÚ¡ 
›“80211_tim_›
 *
tim
 =

638 (cÚ¡ 
›“80211_tim_›
 *)
¥
->
tim
;

639 
i£
->
£_dtim³riod
 = 
tim
->
tim_³riod
;

642 
	`§ve›
(&
i£
->
£_wme_›
, 
¥
->
wme
);

643 
	`§ve›
(&
i£
->
£_w·_›
, 
¥
->
w·
);

644 
	`§ve›
(&
i£
->
£_r¢_›
, 
¥
->
r¢
);

645 
	`§ve›
(&
i£
->
£_©h_›
, 
¥
->
©h
);

647 
£
->
£_Ï¡upd©e
 = 
jiff›s
;

648 
£
->
£_£’
 = 1;

649 
£
->
£_nÙ£’
 = 0;

651 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

654 
	}
}

656 
	spc_·¿ms
 {

657 
›“80211v­
 *
	mv­
;

658 
›“80211_sÿn_¡©e
 *
	mss
;

659 
	mæags
;

662 
	schªÃl
 {

663 
›“80211_chªÃl
 *
	mchª
;

664 
	mÜig
;

665 
pc_·¿ms
 *
	m·¿ms
;

670 
	$pc_cmp_¿d¬
(
›“80211_chªÃl
 *
a
, ›“80211_chªÃÈ*
b
)

673  !!
	`IEEE80211_IS_CHAN_RADAR
(
a
è- !!IEEE80211_IS_CHAN_RADAR(
b
);

674 
	}
}

678 
	$pc_cmp_k“pmode
(
pc_·¿ms
 *
·¿ms
, 
›“80211_chªÃl
 *
a
,

679 
›“80211_chªÃl
 *
b
)

681 
›“80211com
 *
ic
 = 
·¿ms
->
v­
->
iv_ic
;

682 
›“80211_chªÃl
 *
cur
 = 
ic
->
ic_bsschª
;

684 ià(!(
·¿ms
->
æags
 & 
IEEE80211_SCAN_KEEPMODE
))

690 !!
	`IEEE80211_ARE_CHANS_SAME_MODE
(
b
, 
cur
) -

691 !!
	`IEEE80211_ARE_CHANS_SAME_MODE
(
a
, 
cur
);

692 
	}
}

696 
	$pc_cmp_sc
(
›“80211com
 *
ic
, 
›“80211_chªÃl
 *
a
,

697 
›“80211_chªÃl
 *
b
)

701 
ic
->
ic_chª_nodes
[
b
->
ic_›“
] -

702 
ic
->
ic_chª_nodes
[
a
->
ic_›“
];

703 
	}
}

707 
	$pc_cmp_rssi
(
­_¡©e
 *
as
, 
›“80211_chªÃl
 *
a
,

708 
›“80211_chªÃl
 *
b
)

712 
as
->
as_maxrssi
[
a
->
ic_›“
] -

713 
as
->
as_maxrssi
[
b
->
ic_›“
];

714 
	}
}

718 
	$pc_cmp_§mechª
(
›“80211com
 *
ic
, 
›“80211_chªÃl
 *
a
,

719 
›“80211_chªÃl
 *
b
)

721 
›“80211_chªÃl
 *
ic_bsschª
 = 
ic
->ic_bsschan;

722 ià(
ic_bsschª
 =ğ
IEEE80211_CHAN_ANYC
)

725  (
b
 =ğ
ic_bsschª
è- (
a
 == ic_bsschan);

726 
	}
}

730 
	$pc_cmp_Üig
(
chªÃl
 *
a
, chªÃÈ*
b
)

732  
a
->
Üig
 - 
b
->orig;

733 
	}
}

737 
	$pc_cmp
(cÚ¡ *
_a
, cÚ¡ *
_b
)

739 
›“80211_chªÃl
 *
a
 = ((
chªÃl
 *)
_a
)->
chª
;

740 
›“80211_chªÃl
 *
b
 = ((
chªÃl
 *)
_b
)->
chª
;

741 
pc_·¿ms
 *
·¿ms
 = ((
chªÃl
 *)
_a
)->params;

742 
›“80211com
 *
ic
 = 
·¿ms
->
v­
->
iv_ic
;

743 
»s
;

745 
	#EVALUATE_CRITERION
(
Çme
, ...) do { \

746 ià((
»s
 = 
pc_cmp_
##
	`Çme
(
__VA_ARGS__
)) != 0) \

747  
»s
; \

748 } 0)

	)

750 
	`EVALUATE_CRITERION
(
¿d¬
, 
a
, 
b
);

751 
	`EVALUATE_CRITERION
(
k“pmode
, 
·¿ms
, 
a
, 
b
);

752 
	`EVALUATE_CRITERION
(
sc
, 
ic
, 
a
, 
b
);

754 
	`EVALUATE_CRITERION
(
rssi
, 
·¿ms
->
ss
->
ss_´iv
, 
a
, 
b
);

755 
	`EVALUATE_CRITERION
(
§mechª
, 
ic
, 
a
, 
b
);

756 
	`EVALUATE_CRITERION
(
Üig
, (
chªÃl
 *)
_a
, (chªÃÈ*)
_b
);

758 #undeà
EVALUATE_CRITERION


759  
»s
;

760 
	}
}

764 
	$pc_sw­
(*
a
, *
b
, 
n
)

766 
›“80211_chªÃl
 *
t
 = ((
chªÃl
 *)
a
)->
chª
;

767 
i
;

769 ((
chªÃl
 *)
a
)->
chª
 = ((chªÃÈ*)
b
)->chan;

770 ((
chªÃl
 *)
b
)->
chª
 = 
t
;

772 
i
 = ((
chªÃl
 *)
a
)->
Üig
;

773 ((
chªÃl
 *)
a
)->
Üig
 = ((chªÃÈ*)
b
)->orig;

774 ((
chªÃl
 *)
b
)->
Üig
 = 
i
;

778 
	}
}

782 
›“80211_chªÃl
 *

783 
	$pick_chªÃl
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
,

784 
u_št32_t
 
æags
)

786 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

787 
i
, 
be¡_rssi
;

788 
ss_Ï¡
 = 
ss
->ss_last;

789 
›“80211_chªÃl
 *
be¡
;

790 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

791 
chªÃl
 
chªs
[
ss_Ï¡
];

792 
chªÃl
 *
c
 = 
NULL
;

793 
pc_·¿ms
 
·¿ms
 = { 
v­
, 
ss
, 
æags
 };

794 
b’ef™
 = 0;

795 
¡a_assoc
 = 0;

797 
i
 = 0; i < 
ss_Ï¡
; i++) {

798 
chªs
[
i
].
chª
 = 
ss
->
ss_chªs
[i];

799 
chªs
[
i
].
Üig
 = i;

800 
chªs
[
i
].
·¿ms
 = &params;

803 
	`sÜt
(
chªs
, 
ss_Ï¡
, (*chªs), 
pc_cmp
, 
pc_sw­
);

805 #ifdeà
IEEE80211_DEBUG


806 
i
 = 0; i < 
ss_Ï¡
; i++) {

807 
chª
 = 
	`›“80211_chª2›“
(
ic
, 
chªs
[
i
].chan);

808 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
, "%s: channel %u, "

810 
__func__
, 
chª
, 
as
->
as_maxrssi
[chan],

811 
	`IEEE80211_IS_CHAN_RADAR
(
chªs
[
i
].
chª
),

812 
ic
->
ic_chª_nodes
[
chªs
[
i
].
chª
->
ic_›“
],

813 !!
	`IEEE80211_ARE_CHANS_SAME_MODE
(
chªs
[
i
].
chª
,

814 
ic
->
ic_bsschª
));

818 
be¡
 = 
NULL
;

819 
be¡_rssi
 = 0xff;

821 
i
 = 0; i < 
ss_Ï¡
; i++) {

822 
c
 = &
chªs
[
i
];

823 
b’ef™
 = 
be¡_rssi
 - 
as
->
as_maxrssi
[
c
->
chª
->
ic_›“
];

824 
¡a_assoc
 = 
ic
->
ic_¡a_assoc
;

827 ià(
b’ef™
 <= 0)

831 ià(
	`IEEE80211_IS_CHAN_RADAR
(
c
->
chª
))

836 ià(
as
->
as_»quœed_mode
 &&

837 
	`IEEE80211_IS_CHAN_STURBO
(
c
->
chª
) &&

838 (
as
->
as_v­_desœed_mode
 !ğ
IEEE80211_MODE_TURBO_STATIC_A
))

842 ià((
c
->
chª
->
ic_æags
 & 
as
->
as_»quœed_mode
) !=

843 
as
->
as_»quœed_mode
)

846 ià((
ic
->
ic_bsschª
 !ğ
NULL
) &&

847 (
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
)) {

850 ià((
æags
 & 
IEEE80211_SCAN_KEEPMODE
) &&

851 !
	`IEEE80211_ARE_CHANS_SAME_MODE
(
c
->
chª
,

852 
ic
->
ic_bsschª
))

858 ià(
¡a_assoc
 != 0) {

859 
¦
 = 
ic
->
ic_ú_tÙ®
 -

860 
ic
->
ic_chª_nodes
[
c
->
chª
->
ic_›“
];

861 ià(
ic
->
ic_sc_®gÜ™hm
 =ğ
IEEE80211_SC_LOOSE
) {

862 
¦_max
 = 
ic
->
ic_sc_¦dg
 * 
b’ef™
;

863 
¦
 = 1000 * sÈ/ 
¡a_assoc
;

864 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

867 
__func__
, 
c
->
chª
->
ic_›“
,

868 
b’ef™
, 
¦
, 
¦_max
);

869 ià(
¦
 > 
¦_max
)

871 } ià(((
ic
->
ic_sc_®gÜ™hm
 ==

872 
IEEE80211_SC_TIGHT
) ||

873 (
ic
->
ic_sc_®gÜ™hm
 ==

874 
IEEE80211_SC_STRICT
)) &&

875 (
¦
 > 0)) {

881 
be¡
 = 
c
->
chª
;

882 
be¡_rssi
 = 
as
->
as_maxrssi
[
be¡
->
ic_›“
];

885 ià(
be¡
 !ğ
NULL
) {

886 
i
 = 
be¡
->
ic_›“
;

887 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

889 
__func__
, 
i
, 
as
->
as_maxrssi
[i]);

891  
be¡
;

892 
	}
}

895 
­_’d
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
,

896 (*
aùiÚ
)(
›“80211v­
 *,

897 cÚ¡ 
›“80211_sÿn_’Œy
 *),

898 
u_št32_t
 
æags
)

900 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

901 
›“80211_chªÃl
 *
be¡chª
 = 
NULL
;

902 
›“80211com
 *
ic
 = 
NULL
;

903 
»s
 = 1;

905 
	`SCAN_AP_LOCK_IRQ
(
as
);

907 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
,

908 ("wrÚg opmod%u", 
v­
->
iv_İmode
));

910 
ic
 = 
v­
->
iv_ic
;

911 
be¡chª
 = 
	`pick_chªÃl
(
ss
, 
v­
, 
æags
);

912 ià(
be¡chª
 =ğ
NULL
) {

913 ià(
ss
->
ss_Ï¡
 > 0) {

915 
	`´štk
(
KERN_ERR
 "%s: %s:‚o suitable channel! "

917 
	`DEV_NAME
(
v­
->
iv_dev
), 
__func__
);

919 
»s
 = 1;

921 
›“80211_sÿn_’Œy
 
£
;

925 ià(
	`IEEE80211_IS_CHAN_TURBO
(
be¡chª
) &&

926 !
	`IEEE80211_IS_CHAN_STURBO
(
be¡chª
)) {

927 ià((
be¡chª
 = 
	`›“80211_fšd_chªÃl
(
ic
,

928 
be¡chª
->
ic_äeq
, be¡chª->
ic_æags
 &

929 ~
IEEE80211_CHAN_TURBO
)è=ğ
NULL
) {

931 
	`SCAN_AP_UNLOCK_IRQ_EARLY
(
as
);

935 
	`mem£t
(&
£
, 0, (se));

936 
£
.
£_chª
 = 
be¡chª
;

938 
as
->
as_aùiÚ
 = 
ss
->
ss_İs
->
sÿn_deçuÉ
;

939 ià(
aùiÚ
)

940 
as
->
as_aùiÚ
 = 
aùiÚ
;

941 
as
->
as_£lbss
 = 
£
;

946 
	`IEEE80211_SCHEDULE_TQUEUE
(&
as
->
as_aùiÚtq
);

947 
»s
 = 1;

949 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

950  
»s
;

951 
	}
}

954 
	$­_age
(
›“80211_sÿn_¡©e
 *
ss
)

956 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

957 
sÿn_’Œy
 *
£
, *
Ãxt
;

959 
	`SCAN_AP_LOCK_IRQ
(
as
);

960 
	`TAILQ_FOREACH_SAFE
(
£
, &
as
->
as_’Œy
, 
£_li¡
, 
Ãxt
) {

961 ià(
£
->
£_nÙ£’
 > 
AP_PURGE_SCANS
) {

962 
	`TAILQ_REMOVE
(&
as
->
as_’Œy
, 
£
, 
£_li¡
);

963 
	`LIST_REMOVE
(
£
, 
£_hash
);

964 
	`FREE
(
£
, 
M_80211_SCAN
);

967 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

968 
	}
}

971 
	$­_™”©e
(
›“80211_sÿn_¡©e
 *
ss
,

972 
›“80211_sÿn_™”_func
 *
f
, *
¬g
)

974 
­_¡©e
 *
as
 = 
ss
->
ss_´iv
;

975 
sÿn_’Œy
 *
£
;

976 
u_št
 
g’
;

977 
»s
 = 0;

979 
	`SCAN_AP_GEN_LOCK
(
as
);

980 
g’
 = 
as
->
as_sÿng’
++;

981 
»¡¬t
:

982 
	`SCAN_AP_LOCK_IRQ
(
as
);

983 
	`TAILQ_FOREACH
(
£
, &
as
->
as_’Œy
, 
£_li¡
) {

984 ià(
£
->
£_sÿng’
 !ğ
g’
) {

985 
£
->
£_sÿng’
 = 
g’
;

987 
£
->
ba£
.
£_age
 = 
jiff›s
 - se->
£_Ï¡upd©e
;

988 
	`SCAN_AP_UNLOCK_IRQ_EARLY
(
as
);

990 
»s
 = (*
f
)(
¬g
, &
£
->
ba£
);

993 ià(
»s
 != 0)

994 
dÚe
;

996 
»¡¬t
;

1000 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

1002 
dÚe
:

1003 
	`SCAN_AP_GEN_UNLOCK
(
as
);

1005  
»s
;

1006 
	}
}

1009 
	$­_assoc_sucûss
(
›“80211_sÿn_¡©e
 *
ss
,

1010 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
])

1013 
	}
}

1016 
	$­_assoc_ç
(
›“80211_sÿn_¡©e
 *
ss
,

1017 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
], 
»asÚ
)

1020 
	}
}

1027 
	$­_deçuÉ_aùiÚ
(
›“80211v­
 *
v­
,

1028 cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

1030 
	`›“80211_ü—‹_ibss
(
v­
, 
£
->
£_chª
);

1033 
	}
}

1036 
	$aùiÚ_skËt
(
IEEE80211_TQUEUE_ARG
 
d©a
)

1038 
›“80211_sÿn_¡©e
 *
ss
 = (›“80211_sÿn_¡©*)
d©a
;

1039 
­_¡©e
 *
as
 = (­_¡©*)
ss
->
ss_´iv
;

1040 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

1041 
	`SCAN_AP_LOCK_IRQ
(
as
);

1042 ià(
as
->
as_Ãwsÿn
) {

1043 
sÿn_’Œy
 *
£
;

1044 
	`TAILQ_FOREACH
(
£
, &
as
->
as_’Œy
, 
£_li¡
) {

1052 ià(
£
->
£_£’
)

1053 
£
->
£_£’
 = 0;

1055 
£
->
£_nÙ£’
++;

1057 
as
->
as_Ãwsÿn
 = 0;

1059 
	`SCAN_AP_UNLOCK_IRQ
(
as
);

1061 (*
ss
->
ss_İs
->
sÿn_deçuÉ
)(
v­
, &
as
->
as_£lbss
);

1062 
	}
}

1067 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

1068 
MODULE_DESCRIPTION
("802.11 wireless support: default‡p scanner");

1069 #ifdeà
MODULE_LICENSE


1070 
MODULE_LICENSE
("Dual BSD/GPL");

1073 cÚ¡ 
›“80211_sÿÂ”
 
	g­_deçuÉ
 = {

1074 .
sÿn_Çme
 = "default",

1075 .
	gsÿn_©ch
 = 
­_©ch
,

1076 .
	gsÿn_d‘ach
 = 
­_d‘ach
,

1077 .
	gsÿn_¡¬t
 = 
­_¡¬t
,

1078 .
	gsÿn_»¡¬t
 = 
­_»¡¬t
,

1079 .
	gsÿn_ÿnûl
 = 
­_ÿnûl
,

1080 .
	gsÿn_’d
 = 
­_’d
,

1081 .
	gsÿn_æush
 = 
­_æush
,

1082 .
	gsÿn_add
 = 
­_add
,

1083 .
	gsÿn_age
 = 
­_age
,

1084 .
	gsÿn_™”©e
 = 
­_™”©e
,

1085 .
	gsÿn_assoc_sucûss
 = 
­_assoc_sucûss
,

1086 .
	gsÿn_assoc_ç
 = 
­_assoc_ç
,

1087 .
	gsÿn_deçuÉ
 = 
­_deçuÉ_aùiÚ
,

1091 
__š™


1092 
	$š™_sÿÂ”_­
()

1094 
	`›“80211_sÿÂ”_»gi¡”
(
IEEE80211_M_HOSTAP
, &
­_deçuÉ
);

1096 
	}
}

1097 
moduË_š™
(
š™_sÿÂ”_­
);

1099 
__ex™


1100 
	$ex™_sÿÂ”_­
()

1102 
	`›“80211_sÿÂ”_uÄegi¡”_®l
(&
­_deçuÉ
);

1103 
	}
}

1104 
moduË_ex™
(
ex™_sÿÂ”_­
);

	@ieee80211_scan_sta.c

33 #iâdeà
EXPORT_SYMTAB


34 
	#EXPORT_SYMTAB


	)

40 #iâdeà
AUTOCONF_INCLUDED


41 
	~<lšux/cÚfig.h
>

43 
	~<lšux/v”siÚ.h
>

44 
	~<lšux/moduË.h
>

45 
	~<lšux/skbuff.h
>

46 
	~<lšux/Ãtdeviû.h
>

47 
	~<lšux/š™.h
>

48 
	~<lšux/d–ay.h
>

50 
	~"if_medŸ.h
"

52 
	~<Ãt80211/›“80211_v¬.h
>

63 
	#STA_FAILS_MAX
 2

	)

64 
	#STA_FAILS_AGE
 (2 * 60è

	)

65 
	#STA_PURGE_SCANS
 2

	)

67 
	#RSSI_LPF_LEN
 10

	)

68 
	#RSSI_EP_MULTIPLIER
 (1<<7è

	)

69 
	#RSSI_IN
(
x
è((xè* 
RSSI_EP_MULTIPLIER
)

	)

70 
	#LPF_RSSI
(
x
, 
y
, 
Ën
è(((xè* (Ö’è- 1è+ (y)è/ (Ën))

	)

71 
	#RSSI_LPF
(
x
, 
y
) do { \

72 ià((
y
) >= -20) \

73 
x
 = 
	`LPF_RSSI
((x), 
	`RSSI_IN
((
y
)), 
RSSI_LPF_LEN
); \

74 } 0)

	)

75 
	#EP_RND
(
x
, 
mul
) \

76 ((((
x
)%(
mul
)è>ğ((mul)/2)è? 
	`howmªy
(x, mulè: (x)/(mul))

	)

77 
	#RSSI_GET
(
x
è
	`EP_RND
(x, 
RSSI_EP_MULTIPLIER
)

	)

79 
	s¡a_’Œy
 {

80 
›“80211_sÿn_’Œy
 
	mba£
;

81 
TAILQ_ENTRY
(
¡a_’Œy
è
	m£_li¡
;

82 
LIST_ENTRY
(
¡a_’Œy
è
	m£_hash
;

83 
u_št8_t
 
	m£_çs
;

84 
u_št8_t
 
	m£_£’
;

85 
u_št8_t
 
	m£_nÙ£’
;

86 
u_št32_t
 
	m£_avgrssi
;

87 
	m£_Ï¡upd©e
;

88 
	m£_Ï¡ç
;

89 
	m£_Ï¡assoc
;

90 
u_št
 
	m£_sÿng’
;

93 
	#STA_HASHSIZE
 32

	)

95 
	#STA_HASH
(
addr
) \

96 (((cÚ¡ 
u_št8_t
 *)(
addr
))[
IEEE80211_ADDR_LEN
 - 1] % 
STA_HASHSIZE
)

	)

98 
	s¡a_bË
 {

99 
¥šlock_t
 
	m¡_lock
;

100 
TAILQ_HEAD
(, 
¡a_’Œy
è
	m¡_’Œy
;

101 
ATH_LIST_HEAD
(, 
¡a_’Œy
è
	m¡_hash
[
STA_HASHSIZE
];

102 
¥šlock_t
 
	m¡_sÿÆock
;

103 
u_št
 
	m¡_sÿng’
;

104 
	m¡_Ãwsÿn
;

105 
IEEE80211_TQ_STRUCT
 
	m¡_aùiÚtq
;

106 
›“80211_sÿn_’Œy
 
	m¡_£lbss
;

107 (*
	m¡_aùiÚ
)(
	m›“80211v­
 *, cÚ¡ 
	m›“80211_sÿn_’Œy
 *);

110 
	#SCAN_STA_LOCK_INIT
(
_¡
, 
_Çme
) \

111 
	`¥š_lock_š™
(&(
_¡
)->
¡_lock
)

	)

112 
	#SCAN_STA_LOCK_DESTROY
(
_¡
)

	)

113 
	#SCAN_STA_LOCK_IRQ
(
_¡
) do { \

114 
__¡lockæags
; \

115 
	`¥š_lock_œq§ve
(&(
_¡
)->
¡_lock
, 
__¡lockæags
);

	)

116 
	#SCAN_STA_UNLOCK_IRQ
(
_¡
) \

117 
	`¥š_uÆock_œq»¡Üe
(&(
_¡
)->
¡_lock
, 
__¡lockæags
); \

118 } 0)

	)

119 
	#SCAN_STA_UNLOCK_IRQ_EARLY
(
_¡
) \

120 
	`¥š_uÆock_œq»¡Üe
(&(
_¡
)->
¡_lock
, 
__¡lockæags
);

	)

122 
	#SCAN_STA_GEN_LOCK_INIT
(
_¡
, 
_Çme
) \

123 
	`¥š_lock_š™
(&(
_¡
)->
¡_sÿÆock
)

	)

124 
	#SCAN_STA_GEN_LOCK_DESTROY
(
_¡
)

	)

125 
	#SCAN_STA_GEN_LOCK
(
_¡
è
	`¥š_lock
(&(_¡)->
¡_sÿÆock
);

	)

126 
	#SCAN_STA_GEN_UNLOCK
(
_¡
è
	`¥š_uÆock
(&(_¡)->
¡_sÿÆock
);

	)

128 
¡a_æush_bË
(
¡a_bË
 *);

129 
m©ch_bss
(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_¡©e
 *,

130 cÚ¡ 
¡a_’Œy
 *);

131 
aùiÚ_skËt
(
IEEE80211_TQUEUE_ARG
);

137 
	$¡a_©ch
(
›“80211_sÿn_¡©e
 *
ss
)

139 
¡a_bË
 *
¡
;

141 
	`_MOD_INC_USE
(
THIS_MODULE
,  0);

143 
	`MALLOC
(
¡
, 
¡a_bË
 *, (sta_table),

144 
M_80211_SCAN
, 
M_NOWAIT
 | 
M_ZERO
);

145 ià(
¡
 =ğ
NULL
)

147 
	`SCAN_STA_LOCK_INIT
(
¡
, "scan_sta");

148 
	`SCAN_STA_GEN_LOCK_INIT
(
¡
, "scan_sta_gen");

149 
	`TAILQ_INIT
(&
¡
->
¡_’Œy
);

150 
	`IEEE80211_INIT_TQUEUE
(&
¡
->
¡_aùiÚtq
, 
aùiÚ_skËt
, 
ss
);

151 
ss
->
ss_´iv
 = 
¡
;

153 
	}
}

159 
	$¡a_d‘ach
(
›“80211_sÿn_¡©e
 *
ss
)

161 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

163 ià(
¡
 !ğ
NULL
) {

164 
	`IEEE80211_CANCEL_TQUEUE
(&
¡
->
¡_aùiÚtq
);

165 
	`¡a_æush_bË
(
¡
);

166 
	`FREE
(
¡
, 
M_80211_SCAN
);

169 
	`_MOD_DEC_USE
(
THIS_MODULE
);

171 
	}
}

177 
	$¡a_æush
(
›“80211_sÿn_¡©e
 *
ss
)

179 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

181 
	`SCAN_STA_LOCK_IRQ
(
¡
);

182 
	`¡a_æush_bË
(
¡
);

183 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

184 
ss
->
ss_Ï¡
 = 0;

186 
	}
}

192 
	$¡a_æush_bË
(
¡a_bË
 *
¡
)

194 
¡a_’Œy
 *
£
, *
Ãxt
;

196 
	`TAILQ_FOREACH_SAFE
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
, 
Ãxt
) {

197 
	`TAILQ_REMOVE
(&
¡
->
¡_’Œy
, 
£
, 
£_li¡
);

198 
	`LIST_REMOVE
(
£
, 
£_hash
);

199 
	`FREE
(
£
, 
M_80211_SCAN
);

201 
	}
}

204 
	$§ve›
(
u_št8_t
 **
›p
, cÚ¡ u_št8_ˆ*
›
)

206 ià(
›
 =ğ
NULL
)

207 *
›p
 = 
NULL
;

209 
	`›“80211_§ve›
(
›p
, 
›
);

210 
	}
}

217 
	$¡a_add
(
›“80211_sÿn_¡©e
 *
ss
, cÚ¡ 
›“80211_sÿÅ¬ams
 *
¥
,

218 cÚ¡ 
›“80211_äame
 *
wh
, 
subty³
, 
rssi
, 
u_št64_t
 
¹sf
)

220 
	#ISPROBE
(
_¡
è((_¡è=ğ
IEEE80211_FC0_SUBTYPE_PROBE_RESP
)

	)

221 
	#PICK1ST
(
_ss
) \

222 ((
ss
->
ss_æags
 & (
IEEE80211_SCAN_PICK1ST
 | 
IEEE80211_SCAN_GOTPICK
)) == \

223 
IEEE80211_SCAN_PICK1ST
)

	)

224 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

225 cÚ¡ 
u_št8_t
 *
maÿddr
 = 
wh
->
i_addr2
;

226 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

227 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

228 
¡a_’Œy
 *
£
;

229 
›“80211_sÿn_’Œy
 *
i£
;

230 
hash
;

232 
hash
 = 
	`STA_HASH
(
maÿddr
);

233 
	`SCAN_STA_LOCK_IRQ
(
¡
);

234 
	`LIST_FOREACH
(
£
, &
¡
->
¡_hash
[
hash
], 
£_hash
)

235 ià(
	`IEEE80211_ADDR_EQ
(
£
->
ba£
.
£_maÿddr
, 
maÿddr
) &&

236 
¥
->
ssid
[1] =ğ
£
->
ba£
.
£_ssid
[1] &&

237 !
	`memcmp
(
£
->
ba£
.
£_ssid
+2, 
¥
->
ssid
+2, se->base.se_ssid[1]))

238 
found
;

240 
	`MALLOC
(
£
, 
¡a_’Œy
 *, (sta_entry),

241 
M_80211_SCAN
, 
M_NOWAIT
 | 
M_ZERO
);

242 ià(
£
 =ğ
NULL
) {

243 
	`SCAN_STA_UNLOCK_IRQ_EARLY
(
¡
);

246 
£
->
£_sÿng’
 = 
¡
->
¡_sÿng’
-1;

247 
	`IEEE80211_ADDR_COPY
(
£
->
ba£
.
£_maÿddr
, 
maÿddr
);

248 
	`TAILQ_INSERT_TAIL
(&
¡
->
¡_’Œy
, 
£
, 
£_li¡
);

249 
	`LIST_INSERT_HEAD
(&
¡
->
¡_hash
[
hash
], 
£
, 
£_hash
);

251 
found
:

252 
i£
 = &
£
->
ba£
;

255 ià(
¥
->
ssid
[1] != 0 &&

256 (
	`ISPROBE
(
subty³
è|| 
i£
->
£_ssid
[1] == 0))

257 
	`memıy
(
i£
->
£_ssid
, 
¥
->
ssid
, 2 + sp->ssid[1]);

259 
	`memıy
(
i£
->
£_¿‹s
, 
¥
->
¿‹s
,

260 2 + 
	`IEEE80211_SANITISE_RATESIZE
(
¥
->
¿‹s
[1]));

261 ià(
¥
->
x¿‹s
 !ğ
NULL
) {

262 
	`memıy
(
i£
->
£_x¿‹s
, 
¥
->
x¿‹s
,

263 2 + 
	`IEEE80211_SANITISE_RATESIZE
(
¥
->
x¿‹s
[1]));

265 
i£
->
£_x¿‹s
[1] = 0;

267 
	`IEEE80211_ADDR_COPY
(
i£
->
£_bssid
, 
wh
->
i_addr3
);

271 ià(
£
->
£_Ï¡upd©e
 == 0)

272 
£
->
£_avgrssi
 = 
	`RSSI_IN
(
rssi
);

274 
	`RSSI_LPF
(
£
->
£_avgrssi
, 
rssi
);

275 
£
->
ba£
.
£_rssi
 = 
	`RSSI_GET
(£->
£_avgrssi
);

276 
i£
->
£_¹sf
 = 
¹sf
;

277 
	`memıy
(
i£
->
£_t¡amp
.
d©a
, 
¥
->
t¡amp
, (ise->se_tstamp));

278 
i£
->
£_štv®
 = 
¥
->
bštv®
;

279 
i£
->
£_ÿpšfo
 = 
¥
->
ÿpšfo
;

280 
i£
->
£_chª
 = 
ic
->
ic_curchª
;

281 
i£
->
£_fhdw–l
 = 
¥
->
fhdw–l
;

282 
i£
->
£_fhšdex
 = 
¥
->
fhšdex
;

283 
i£
->
£_”p
 = 
¥
->
”p
;

284 
i£
->
£_timoff
 = 
¥
->
timoff
;

285 ià(
¥
->
tim
 !ğ
NULL
) {

286 cÚ¡ 
›“80211_tim_›
 *
tim
 =

287 (cÚ¡ 
›“80211_tim_›
 *)
¥
->
tim
;

288 
i£
->
£_dtim³riod
 = 
tim
->
tim_³riod
;

290 
	`§ve›
(&
i£
->
£_wme_›
, 
¥
->
wme
);

291 
	`§ve›
(&
i£
->
£_w·_›
, 
¥
->
w·
);

292 
	`§ve›
(&
i£
->
£_r¢_›
, 
¥
->
r¢
);

293 
	`§ve›
(&
i£
->
£_©h_›
, 
¥
->
©h
);

296 ià(
£
->
£_çs
 &&

297 
	`time_aá”
(
jiff›s
, 
£
->
£_Ï¡ç
 + (
STA_FAILS_AGE
 * 
HZ
))) {

298 
£
->
£_çs
 = 0;

299 
	`IEEE80211_NOTE_MAC
(
v­
, 
IEEE80211_MSG_SCAN
, 
maÿddr
,

300 "%s: fa %u", 
__func__
, 
£
->
£_çs
);

303 
£
->
£_Ï¡upd©e
 = 
jiff›s
;

304 
£
->
£_£’
 = 1;

305 
£
->
£_nÙ£’
 = 0;

307 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

313 ià(
	`PICK1ST
(
ss
è&& 
	`m©ch_bss
(
v­
, ss, 
£
) == 0)

314 
ss
->
ss_æags
 |ğ
IEEE80211_SCAN_GOTPICK
;

317 #undeà
PICK1ST


318 #undeà
ISPROBE


319 
	}
}

321 
›“80211_chªÃl
 *

322 
	$fšd11gchªÃl
(
›“80211com
 *
ic
, 
i
, 
äeq
)

324 
›“80211_chªÃl
 *
c
;

325 
j
;

332 
j
 = 
i
+1; j < 
ic
->
ic_nchªs
; j++) {

333 
c
 = &
ic
->
ic_chªÃls
[
j
];

334 ià(
c
->
ic_äeq
 =ğ
äeq
 && 
	`IEEE80211_IS_CHAN_ANYG
(c))

335  
c
;

337 
j
 = 0; j < 
i
; j++) {

338 
c
 = &
ic
->
ic_chªÃls
[
j
];

339 ià(
c
->
ic_äeq
 =ğ
äeq
 && 
	`IEEE80211_IS_CHAN_ANYG
(c))

340  
c
;

342  
NULL
;

343 
	}
}

344 cÚ¡ 
u_št
 
	gchªæags
[] = {

345 
IEEE80211_CHAN_B
,

346 
IEEE80211_CHAN_A
,

347 
IEEE80211_CHAN_B
,

348 
IEEE80211_CHAN_PUREG
,

349 
IEEE80211_CHAN_FHSS
,

350 
IEEE80211_CHAN_A
,

351 
IEEE80211_CHAN_PUREG
,

352 
IEEE80211_CHAN_ST
,

356 
	$add_chªÃls
(
›“80211com
 *
ic
,

357 
›“80211_sÿn_¡©e
 *
ss
,

358 
›“80211_phymode
 
mode
, cÚ¡ 
u_št16_t
 
äeq
[], 
näeq
)

360 
›“80211_chªÃl
 *
c
, *
cg
;

361 
u_št
 
modeæags
;

362 
i
;

364 
	`KASSERT
(
mode
 < 
	`ARRAY_SIZE
(
chªæags
), ("Unexpected mode %u", mode));

365 
modeæags
 = 
chªæags
[
mode
];

366 
i
 = 0; i < 
näeq
; i++) {

367 
c
 = 
	`›“80211_fšd_chªÃl
(
ic
, 
äeq
[
i
], 
modeæags
);

368 ià(
c
 =ğ
NULL
 || 
	`isşr
(
ic
->
ic_chª_aùive
, c->
ic_›“
))

370 ià(
mode
 =ğ
IEEE80211_MODE_AUTO
) {

375 ià(
	`IEEE80211_IS_CHAN_B
(
c
) &&

376 (
cg
 = 
	`fšd11gchªÃl
(
ic
, 
i
, 
c
->
ic_äeq
)è!ğ
NULL
)

377 
c
 = 
cg
;

379 ià(
ss
->
ss_Ï¡
 >ğ
IEEE80211_SCAN_MAX
)

381 
ss
->
ss_chªs
[ss->
ss_Ï¡
++] = 
c
;

383 
	}
}

385 cÚ¡ 
u_št16_t
 
	grş1
[] =

387 cÚ¡ 
u_št16_t
 
	grş2
[] =

389 cÚ¡ 
u_št16_t
 
	grş3
[] =

391 cÚ¡ 
u_št16_t
 
	grş4
[] =

393 cÚ¡ 
u_št16_t
 
	grş7
[] =

395 cÚ¡ 
u_št16_t
 
	grş8
[] =

397 cÚ¡ 
u_št16_t
 
	grş9
[] =

399 cÚ¡ 
u_št16_t
 
	grş10
[] =

401 cÚ¡ 
u_št16_t
 
	grş11
[] =

403 #ifdeà
ATH_TURBO_SCAN


404 cÚ¡ 
u_št16_t
 
	grş5
[] =

406 cÚ¡ 
u_št16_t
 
	grş6
[] =

408 cÚ¡ 
u_št16_t
 
	grş6x
[] =

410 cÚ¡ 
u_št16_t
 
	grş12
[] =

412 cÚ¡ 
u_št16_t
 
	grş13
[] =

416 
	ssÿÆi¡
 {

417 
u_št16_t
 
	mmode
;

418 
u_št16_t
 
	mcouÁ
;

419 cÚ¡ 
u_št16_t
 *
	mli¡
;

422 
	#IEEE80211_MODE_TURBO_STATIC_A
 
IEEE80211_MODE_MAX


	)

423 
	#X
(
a
è.
couÁ
 = ×)/×[0]), .
li¡
 = 
	)
a

425 cÚ¡ 
sÿÆi¡
 
	g¡aSÿnTabË
[] = {

426 { 
IEEE80211_MODE_11B
, 
X
(
rş3
) },

427 { 
IEEE80211_MODE_11A
, 
X
(
rş1
) },

428 { 
IEEE80211_MODE_11A
, 
X
(
rş2
) },

429 { 
IEEE80211_MODE_11B
, 
X
(
rş8
) },

430 { 
IEEE80211_MODE_11B
, 
X
(
rş9
) },

431 { 
IEEE80211_MODE_11A
, 
X
(
rş4
) },

432 #ifdeà
ATH_TURBO_SCAN


433 { 
IEEE80211_MODE_TURBO_STATIC_A
, 
X
(
rş5
) },

434 { 
IEEE80211_MODE_TURBO_STATIC_A
, 
X
(
rş6
) },

435 { 
IEEE80211_MODE_TURBO_A
, 
X
(
rş6x
) },

436 { 
IEEE80211_MODE_TURBO_A
, 
X
(
rş13
) },

438 { 
IEEE80211_MODE_11A
, 
X
(
rş7
) },

439 { 
IEEE80211_MODE_11B
, 
X
(
rş10
) },

440 { 
IEEE80211_MODE_11A
, 
X
(
rş11
) },

441 #ifdeà
ATH_TURBO_SCAN


442 { 
IEEE80211_MODE_TURBO_G
, 
X
(
rş12
) },

444 { .
li¡
 = 
NULL
 }

447 #undeà
X


450 
	$checkbË
(cÚ¡ 
sÿÆi¡
 *
sÿn
, cÚ¡ 
›“80211_chªÃl
 *
c
)

452 
i
;

454 ; 
sÿn
->
li¡
 !ğ
NULL
; scan++) {

455 
i
 = 0; i < 
sÿn
->
couÁ
; i++)

456 ià(
sÿn
->
li¡
[
i
] =ğ
c
->
ic_äeq
)

460 
	}
}

466 
	$¡a_¡¬t
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

468 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

469 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

470 cÚ¡ 
sÿÆi¡
 *
sÿn
;

471 
›“80211_phymode
 
mode
;

472 
›“80211_chªÃl
 *
c
;

473 
i
;

475 
ss
->
ss_Ï¡
 = 0;

481 
sÿn
 = 
¡aSÿnTabË
; sÿn->
li¡
 !ğ
NULL
; scan++) {

482 
mode
 = 
sÿn
->mode;

483 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_AUTO
) {

488 ià(
v­
->
iv_des_mode
 !ğ
mode
) {

494 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_11G
 ||

495 
mode
 !ğ
IEEE80211_MODE_11B
)

497 
mode
 = 
IEEE80211_MODE_11G
;

504 ià(
mode
 =ğ
IEEE80211_MODE_11B
)

505 
mode
 = 
IEEE80211_MODE_AUTO
;

508 ià((
v­
->
iv_æags
 & 
IEEE80211_F_XR
) &&

509 (
mode
 =ğ
IEEE80211_MODE_TURBO_A
 ||

510 
mode
 =ğ
IEEE80211_MODE_TURBO_G
))

516 
	`add_chªÃls
(
ic
, 
ss
, 
mode
, 
sÿn
->
li¡
, sÿn->
couÁ
);

523 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

524 
c
 = &
ic
->
ic_chªÃls
[
i
];

528 ià(
	`IEEE80211_IS_CHAN_DTURBO
(
c
))

530 
mode
 = 
	`›“80211_chª2mode
(
c
);

531 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_AUTO
) {

536 ià(
v­
->
iv_des_mode
 !ğ
mode
)

540 ià(!
	`checkbË
(
¡aSÿnTabË
, 
c
))

541 
ss
->
ss_chªs
[ss->
ss_Ï¡
++] = 
c
;

544 
ss
->
ss_Ãxt
 = 0;

563 
ss
->
ss_mšdw–l
 = 
	`m£cs_to_jiff›s
(60);

564 
ss
->
ss_maxdw–l
 = 
	`m£cs_to_jiff›s
(200);

566 #ifdeà
IEEE80211_DEBUG


567 ià(
	`›“80211_msg_sÿn
(
v­
)) {

568 
	`´štk
("%s: sÿÀ£ˆ", 
v­
->
iv_dev
->
Çme
);

569 
	`›“80211_sÿn_dump_chªÃls
(
ss
);

570 
	`´štk
(" dwell min %ld max %ld\n",

571 
ss
->
ss_mšdw–l
, ss->
ss_maxdw–l
);

575 
¡
->
¡_Ãwsÿn
 = 1;

578 
	}
}

584 
	$¡a_»¡¬t
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

586 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

588 
¡
->
¡_Ãwsÿn
 = 1;

590 
	}
}

596 
	$¡a_ÿnûl
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

598 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

600 
	`IEEE80211_CANCEL_TQUEUE
(&
¡
->
¡_aùiÚtq
);

602 
	}
}

604 
u_št8_t


605 
	$max¿‹
(cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

607 
u_št8_t
 
max
, 
r
;

608 
i
;

610 
max
 = 0;

611 
i
 = 0; i < 
£
->
£_¿‹s
[1]; i++) {

612 
r
 = 
£
->
£_¿‹s
[2+
i
] & 
IEEE80211_RATE_VAL
;

613 ià(
r
 > 
max
)

614 
max
 = 
r
;

616 
i
 = 0; i < 
£
->
£_x¿‹s
[1]; i++) {

617 
r
 = 
£
->
£_x¿‹s
[2+
i
] & 
IEEE80211_RATE_VAL
;

618 ià(
r
 > 
max
)

619 
max
 = 
r
;

621  
max
;

622 
	}
}

632 
	$¡a_com·»
(cÚ¡ 
¡a_’Œy
 *
a
, cÚ¡ ¡a_’Œy *
b
)

634 
u_št8_t
 
maxa
, 
maxb
;

635 
weight
;

638 ià((
a
->
ba£
.
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) &&

639 (
b
->
ba£
.
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) == 0)

641 ià((
a
->
ba£
.
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) == 0 &&

642 (
b
->
ba£
.
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
))

646 
weight
 = 
b
->
£_çs
 - 
a
->se_fails;

647 ià(
	`abs
(
weight
) > 1)

648  
weight
;

650 ià(
	`abs
(
b
->
ba£
.
£_rssi
 - 
a
->base.se_rssi) < 5) {

652 
maxa
 = 
	`max¿‹
(&
a
->
ba£
);

653 
maxb
 = 
	`max¿‹
(&
b
->
ba£
);

654 ià(
maxa
 !ğ
maxb
)

655  
maxa
 - 
maxb
;

658 ià(
	`IEEE80211_IS_CHAN_5GHZ
(
a
->
ba£
.
£_chª
) &&

659 !
	`IEEE80211_IS_CHAN_5GHZ
(
b
->
ba£
.
£_chª
))

661 ià(!
	`IEEE80211_IS_CHAN_5GHZ
(
a
->
ba£
.
£_chª
) &&

662 
	`IEEE80211_IS_CHAN_5GHZ
(
b
->
ba£
.
£_chª
))

666  
a
->
ba£
.
£_rssi
 - 
b
->base.se_rssi;

667 
	}
}

673 
	$check_¿‹
(
›“80211v­
 *
v­
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

675 
	#RV
(
v
è((vè& 
IEEE80211_RATE_VAL
)

	)

676 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

677 cÚ¡ 
›“80211_¿‹£t
 *
¤s
;

678 
i
, 
j
, 
Äs
, 
r
, 
ok¿‹
, 
bad¿‹
, 
fixed¿‹
;

679 cÚ¡ 
u_št8_t
 *
rs
;

681 
ok¿‹
 = 
bad¿‹
 = 
fixed¿‹
 = 0;

683 ià(
	`IEEE80211_IS_CHAN_HALF
(
£
->
£_chª
))

684 
¤s
 = &
ic
->
ic_sup_h®f_¿‹s
;

685 ià(
	`IEEE80211_IS_CHAN_QUARTER
(
£
->
£_chª
))

686 
¤s
 = &
ic
->
ic_sup_qu¬‹r_¿‹s
;

688 
¤s
 = &
ic
->
ic_sup_¿‹s
[
	`›“80211_chª2mode
(
£
->
£_chª
)];

689 
Äs
 = 
£
->
£_¿‹s
[1];

690 
rs
 = 
£
->
£_¿‹s
 + 2;

691 
fixed¿‹
 = 
IEEE80211_FIXED_RATE_NONE
;

692 
agaš
:

693 
i
 = 0; i < 
Äs
; i++) {

694 
r
 = 
	`RV
(
rs
[
i
]);

695 
bad¿‹
 = 
r
;

699 ià(
r
 =ğ
v­
->
iv_fixed_¿‹
)

700 
fixed¿‹
 = 
r
;

704 
j
 = 0; j < 
¤s
->
rs_Ä©es
; j++)

705 ià(
r
 =ğ
	`RV
(
¤s
->
rs_¿‹s
[
j
])) {

706 ià(
r
 > 
ok¿‹
)

707 
ok¿‹
 = 
r
;

711 ià(
rs
 =ğ
£
->
£_¿‹s
+2) {

713 
Äs
 = 
£
->
£_x¿‹s
[1];

714 
rs
 = 
£
->
£_x¿‹s
 + 2;

715 
agaš
;

717 ià(
ok¿‹
 =ğ0 || 
v­
->
iv_fixed_¿‹
 !ğ
fixed¿‹
)

718  
bad¿‹
 | 
IEEE80211_RATE_BASIC
;

720  
	`RV
(
ok¿‹
);

721 #undeà
RV


722 
	}
}

725 
	$m©ch_ssid
(cÚ¡ 
u_št8_t
 *
›
,

726 
nssid
, cÚ¡ 
›“80211_sÿn_ssid
 
ssids
[])

728 
i
;

730 
i
 = 0; i < 
nssid
; i++) {

731 ià(
›
[1] =ğ
ssids
[
i
].
Ën
 &&

732 
	`memcmp
(
›
 + 2, 
ssids
[
i
].
ssid
, ie[1]) == 0)

736 
	}
}

742 
	$m©ch_bss
(
›“80211v­
 *
v­
,

743 cÚ¡ 
›“80211_sÿn_¡©e
 *
ss
, cÚ¡ 
¡a_’Œy
 *
£0
)

745 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

746 cÚ¡ 
›“80211_sÿn_’Œy
 *
£
 = &
£0
->
ba£
;

747 
u_št8_t
 
¿‹
;

748 
ç
;

750 
ç
 = 0;

751 ià(
	`isşr
(
ic
->
ic_chª_aùive
, 
	`›“80211_chª2›“
(ic, 
£
->
£_chª
)))

752 
ç
 |= 0x01;

760 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_AUTO
 &&

761 (
£
->
£_chª
->
ic_æags
 & 
IEEE80211_CHAN_ALLTURBO
) !=

762 
chªæags
[
v­
->
iv_des_mode
])

763 
ç
 |= 0x01;

764 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

765 ià((
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) == 0)

766 
ç
 |= 0x02;

768 ià((
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) == 0)

769 
ç
 |= 0x02;

771 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) {

772 ià((
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) == 0)

773 
ç
 |= 0x04;

776 ià(
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
)

777 
ç
 |= 0x04;

779 
¿‹
 = 
	`check_¿‹
(
v­
, 
£
);

780 ià(
¿‹
 & 
IEEE80211_RATE_BASIC
)

781 
ç
 |= 0x08;

782 ià(
ss
->
ss_nssid
 != 0 &&

783 !
	`m©ch_ssid
(
£
->
£_ssid
, 
ss
->
ss_nssid
, ss->
ss_ssid
))

784 
ç
 |= 0x10;

785 ià((
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
) &&

786 !
	`IEEE80211_ADDR_EQ
(
v­
->
iv_des_bssid
, 
£
->
£_bssid
))

787 
ç
 |= 0x20;

788 ià(
£0
->
£_çs
 >ğ
STA_FAILS_MAX
)

789 
ç
 |= 0x40;

790 ià(
£0
->
£_nÙ£’
 >ğ
STA_PURGE_SCANS
)

791 
ç
 |= 0x80;

792 #ifdeà
IEEE80211_DEBUG


793 ià(
	`›“80211_msg_is_»pÜ‹d
(
v­
, 
IEEE80211_MSG_SCAN
 | 
IEEE80211_MSG_ROAM
)) {

794 
	`´štk
(" %03x", 
ç
);

795 
	`´štk
(" %ø" 
MAC_FMT
,

796 
ç
 & 0x40 ? '=' : fail & 0x80 ? '^' : fail ? '-' : '+',

797 
	`MAC_ADDR
(
£
->
£_maÿddr
));

798 
	`´štk
(" " 
MAC_FMT
 "%c", 
	`MAC_ADDR
(
£
->
£_bssid
),

799 
ç
 & 0x20 ? '!' : ' ');

800 
	`´štk
(" %3d%c", 
	`›“80211_chª2›“
(
ic
, 
£
->
£_chª
),

801 
ç
 & 0x01 ? '!' : ' ');

802 
	`´štk
(" %+4d", 
£
->
£_rssi
);

803 
	`´štk
(" %2dM%c", (
¿‹
 & 
IEEE80211_RATE_VAL
) / 2,

804 
ç
 & 0x08 ? '!' : ' ');

805 
	`´štk
(" %4s%c",

806 (
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
) ? "ess" :

807 (
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_IBSS
) ? "ibss" : "????",

808 
ç
 & 0x02 ? '!' : ' ');

809 
	`´štk
(" %3s%c ",

810 (
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
) ? "wep" : "no",

811 
ç
 & 0x04 ? '!' : ' ');

812 
	`›“80211_´št_essid
(
£
->
£_ssid
 + 2, se->se_ssid[1]);

813 
	`´štk
("%s\n", 
ç
 & 0x10 ? "!" : "");

816  
ç
;

817 
	}
}

820 
	$¡a_upd©e_nÙ£’
(
¡a_bË
 *
¡
)

822 
¡a_’Œy
 *
£
;

824 
	`SCAN_STA_LOCK_IRQ
(
¡
);

825 
	`TAILQ_FOREACH
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
) {

833 ià(
£
->
£_£’
)

834 
£
->
£_£’
 = 0;

836 
£
->
£_nÙ£’
++;

838 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

839 
	}
}

842 
	$¡a_dec_çs
(
¡a_bË
 *
¡
)

844 
¡a_’Œy
 *
£
;

846 
	`SCAN_STA_LOCK_IRQ
(
¡
);

847 
	`TAILQ_FOREACH
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
)

848 ià(
£
->
£_çs
)

849 
£
->
£_çs
--;

850 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

851 
	}
}

853 
¡a_’Œy
 *

854 
	$£Ëù_bss
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

856 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

857 
¡a_’Œy
 *
£
, *
£lbs
 = 
NULL
;

859 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
 | 
IEEE80211_MSG_ROAM
, " %s\n",

861 
	`SCAN_STA_LOCK_IRQ
(
¡
);

862 
	`TAILQ_FOREACH
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
) {

863 ià(
	`m©ch_bss
(
v­
, 
ss
, 
£
) == 0) {

864 ià(
£lbs
 =ğ
NULL
)

865 
£lbs
 = 
£
;

866 ià(
	`¡a_com·»
(
£
, 
£lbs
) > 0)

867 
£lbs
 = 
£
;

870 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

872  
£lbs
;

873 
	}
}

880 
¡a_pick_bss
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
,

881 (*
aùiÚ
)(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *),

882 
u_št32_t
 
æags
)

884 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

885 
¡a_’Œy
 *
£lbss
;

887 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
, "%s Checking scan„esults\n",

888 
__func__
);

890 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
,

891 ("wrÚg mod%u", 
v­
->
iv_İmode
));

893 ià(
¡
->
¡_Ãwsÿn
) {

894 
	`¡a_upd©e_nÙ£’
(
¡
);

895 
¡
->
¡_Ãwsÿn
 = 0;

897 ià(
ss
->
ss_æags
 & 
IEEE80211_SCAN_NOPICK
) {

903 
ss
->
ss_æags
 &ğ~
IEEE80211_SCAN_NOPICK
;

911 ià(
	`TAILQ_FIRST
(&
¡
->
¡_’Œy
è=ğ
NULL
) {

912 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

913 "%s:‚ØsÿÀÿndid©e\n", 
__func__
);

914 
nÙfound
:

922 
	`¡a_dec_çs
(
¡
);

923 
¡
->
¡_Ãwsÿn
 = 1;

926 
¡
->
¡_aùiÚ
 = 
ss
->
ss_İs
->
sÿn_deçuÉ
;

927 ià(
aùiÚ
)

928 
¡
->
¡_aùiÚ
 = 
aùiÚ
;

929 ià((
£lbss
 = 
	`£Ëù_bss
(
ss
, 
v­
)è=ğ
NULL
) {

930 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

931 "%s: s–eù_bs çed\n", 
__func__
);

932 
nÙfound
;

934 
¡
->
¡_£lbss
 = 
£lbss
->
ba£
;

940 
	`IEEE80211_SCHEDULE_TQUEUE
(&
¡
->
¡_aùiÚtq
);

943 
	}
}

952 
¡a_’Œy
 *

953 
	$¡a_lookup
(
¡a_bË
 *
¡
, cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
],

954 
›“80211_sÿn_ssid
 *
essid
)

956 
¡a_’Œy
 *
£
;

957 
hash
 = 
	`STA_HASH
(
maÿddr
);

959 
	`SCAN_STA_LOCK_IRQ
(
¡
);

960 
	`LIST_FOREACH
(
£
, &
¡
->
¡_hash
[
hash
], 
£_hash
)

961 ià(
	`IEEE80211_ADDR_EQ
(
£
->
ba£
.
£_maÿddr
, 
maÿddr
) &&

962 (
essid
->
Ën
 =ğ
£
->
ba£
.
£_ssid
[1] &&

963 !
	`memcmp
(
£
->
ba£
.
£_ssid
+2, 
essid
->
ssid
,

964 
£
->
ba£
.
£_ssid
[1])))

966 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

968  
£
;

969 
	}
}

972 
	$¡a_rßm_check
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

974 
›“80211_node
 *
ni
 = 
v­
->
iv_bss
;

975 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

976 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

977 
¡a_’Œy
 *
£
, *
£lbs
;

978 
u_št8_t
 
rßmR©e
, 
curR©e
;

979 
št8_t
 
rßmRssi
, 
curRssi
;

981 
£
 = 
	`¡a_lookup
(
¡
, 
ni
->
ni_maÿddr
, 
ss
->
ss_ssid
);

982 ià(
£
 =ğ
NULL
) {

987 ià(
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
)) {

988 
rßmR©e
 = 
v­
->
iv_rßm
.
¿‹11g
;

989 
rßmRssi
 = 
v­
->
iv_rßm
.
rssi11g
;

990 } ià(
	`IEEE80211_IS_CHAN_B
(
ic
->
ic_bsschª
)) {

991 
rßmR©e
 = 
v­
->
iv_rßm
.
¿‹11bOÆy
;

992 
rßmRssi
 = 
v­
->
iv_rßm
.
rssi11bOÆy
;

994 
rßmR©e
 = 
v­
->
iv_rßm
.
¿‹11a
;

995 
rßmRssi
 = 
v­
->
iv_rßm
.
rssi11a
;

998 
curRssi
 = 
ic
->
	`ic_node_g‘rssi
(
ni
);

999 ià(
v­
->
iv_fixed_¿‹
 =ğ
IEEE80211_FIXED_RATE_NONE
) {

1000 
curR©e
 = 
ni
->
ni_¿‹s
.
rs_¿‹s
[ni->
ni_tx¿‹
] & 
IEEE80211_RATE_VAL
;

1001 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ROAM
,

1003 
__func__
, 
curRssi
, 
curR©e
, 
rßmRssi
, 
rßmR©e
);

1005 
curR©e
 = 
rßmR©e
;

1006 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_ROAM
,

1008 
__func__
, 
curRssi
, 
rßmRssi
);

1010 ià((
v­
->
iv_æags
 & 
IEEE80211_F_BGSCAN
) &&

1011 
	`time_aá”
(
jiff›s
, 
ic
->
ic_Ï¡sÿn
 + 
v­
->
iv_sÿnv®id
)) {

1015 ià(
curR©e
 < 
rßmR©e
 || 
curRssi
 < 
rßmRssi
) {

1020 
	`›“80211_bg_sÿn
(
v­
);

1021 } ià(
	`time_aá”
(
jiff›s
,

1022 
ic
->
ic_Ï¡d©a
 + 
v­
->
iv_bgsÿnidË
)) {

1027 
	`›“80211_bg_sÿn
(
v­
);

1035 ià(
curR©e
 < 
rßmR©e
 || 
curRssi
 < 
rßmRssi
) {

1036 
£
->
ba£
.
£_rssi
 = 
curRssi
;

1037 
£lbs
 = 
	`£Ëù_bss
(
ss
, 
v­
);

1038 ià(
£lbs
 !ğ
NULL
 && s–b !ğ
£
)

1039 
	`›“80211_¡a_još
(
v­
, &
£lbs
->
ba£
);

1042 
	}
}

1049 
	$¡a_age
(
›“80211_sÿn_¡©e
 *
ss
)

1051 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

1052 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1053 
¡a_’Œy
 *
£
, *
Ãxt
;

1055 
	`SCAN_STA_LOCK_IRQ
(
¡
);

1056 
	`TAILQ_FOREACH_SAFE
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
, 
Ãxt
) {

1057 ià(
£
->
£_nÙ£’
 > 
STA_PURGE_SCANS
) {

1058 
	`TAILQ_REMOVE
(&
¡
->
¡_’Œy
, 
£
, 
£_li¡
);

1059 
	`LIST_REMOVE
(
£
, 
£_hash
);

1060 
	`FREE
(
£
, 
M_80211_SCAN
);

1063 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

1072 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
,

1073 ("wrÚg mod%u", 
v­
->
iv_İmode
));

1074 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 &&

1075 
v­
->
iv_ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
 &&

1076 
v­
->
iv_¡©e
 >ğ
IEEE80211_S_RUN
)

1078 
	`¡a_rßm_check
(
ss
, 
v­
);

1079 
	}
}

1086 
	$¡a_™”©e
(
›“80211_sÿn_¡©e
 *
ss
,

1087 
›“80211_sÿn_™”_func
 *
f
, *
¬g
)

1089 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1090 
¡a_’Œy
 *
£
;

1091 
u_št
 
g’
;

1092 
»s
 = 0;

1094 
	`SCAN_STA_GEN_LOCK
(
¡
);

1095 
g’
 = 
¡
->
¡_sÿng’
++;

1096 
»¡¬t
:

1097 
	`SCAN_STA_LOCK_IRQ
(
¡
);

1098 
	`TAILQ_FOREACH
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
) {

1099 ià(
£
->
£_sÿng’
 !ğ
g’
) {

1100 
£
->
£_sÿng’
 = 
g’
;

1102 
£
->
ba£
.
£_age
 = 
jiff›s
 - se->
£_Ï¡upd©e
;

1103 
	`SCAN_STA_UNLOCK_IRQ_EARLY
(
¡
);

1105 
»s
 = (*
f
)(
¬g
, &
£
->
ba£
);

1107 ià(
»s
 != 0)

1109 
dÚe
;

1111 
»¡¬t
;

1115 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

1117 
dÚe
:

1118 
	`SCAN_STA_GEN_UNLOCK
(
¡
);

1120  
»s
;

1121 
	}
}

1124 
	$¡a_assoc_ç
(
›“80211_sÿn_¡©e
 *
ss
,

1125 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
], 
»asÚ
)

1127 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1128 
¡a_’Œy
 *
£
;

1130 ià(
ss
->
ss_v­
->
iv_ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_MANUAL
)

1133 
£
 = 
	`¡a_lookup
(
¡
, 
maÿddr
, 
ss
->
ss_ssid
);

1134 ià(
£
 !ğ
NULL
) {

1135 
£
->
£_çs
++;

1136 
£
->
£_Ï¡ç
 = 
jiff›s
;

1137 
	`IEEE80211_NOTE_MAC
(
ss
->
ss_v­
, 
IEEE80211_MSG_SCAN
,

1138 
maÿddr
, "%s:„eason %u fails %u",

1139 
__func__
, 
»asÚ
, 
£
->
£_çs
);

1141 
	}
}

1144 
	$¡a_assoc_sucûss
(
›“80211_sÿn_¡©e
 *
ss
,

1145 cÚ¡ 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
])

1147 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1148 
¡a_’Œy
 *
£
;

1150 
£
 = 
	`¡a_lookup
(
¡
, 
maÿddr
, 
ss
->
ss_ssid
);

1151 ià(
£
 !ğ
NULL
) {

1153 
£
->
£_çs
 = 0;

1154 
	`IEEE80211_NOTE_MAC
(
ss
->
ss_v­
, 
IEEE80211_MSG_SCAN
,

1155 
maÿddr
, "%s: fa %u", 
__func__
, 
£
->
£_çs
);

1157 
£
->
£_Ï¡assoc
 = 
jiff›s
;

1159 
	}
}

1161 cÚ¡ 
›“80211_sÿÂ”
 
	g¡a_deçuÉ
 = {

1162 .
sÿn_Çme
 = "default",

1163 .
	gsÿn_©ch
 = 
¡a_©ch
,

1164 .
	gsÿn_d‘ach
 = 
¡a_d‘ach
,

1165 .
	gsÿn_¡¬t
 = 
¡a_¡¬t
,

1166 .
	gsÿn_»¡¬t
 = 
¡a_»¡¬t
,

1167 .
	gsÿn_ÿnûl
 = 
¡a_ÿnûl
,

1168 .
	gsÿn_’d
 = 
¡a_pick_bss
,

1169 .
	gsÿn_æush
 = 
¡a_æush
,

1170 .
	gsÿn_add
 = 
¡a_add
,

1171 .
	gsÿn_age
 = 
¡a_age
,

1172 .
	gsÿn_™”©e
 = 
¡a_™”©e
,

1173 .
	gsÿn_assoc_ç
 = 
¡a_assoc_ç
,

1174 .
	gsÿn_assoc_sucûss
 = 
¡a_assoc_sucûss
,

1175 .
	gsÿn_deçuÉ
 = 
›“80211_¡a_još
,

1182 
	$adhoc_¡¬t
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
)

1184 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1185 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1186 cÚ¡ 
sÿÆi¡
 *
sÿn
;

1187 
›“80211_phymode
 
mode
;

1189 
ss
->
ss_Ï¡
 = 0;

1195 
sÿn
 = 
¡aSÿnTabË
; sÿn->
li¡
 !ğ
NULL
; scan++) {

1196 
mode
 = 
sÿn
->mode;

1197 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_AUTO
) {

1202 ià(
v­
->
iv_des_mode
 !ğ
mode
) {

1208 ià(
v­
->
iv_des_mode
 !ğ
IEEE80211_MODE_11G
 ||

1209 
mode
 !ğ
IEEE80211_MODE_11B
)

1211 
mode
 = 
IEEE80211_MODE_11G
;

1218 ià(
mode
 =ğ
IEEE80211_MODE_11B
)

1219 
mode
 = 
IEEE80211_MODE_AUTO
;

1222 ià((
v­
->
iv_æags
 & 
IEEE80211_F_XR
) &&

1223 (
mode
 =ğ
IEEE80211_MODE_TURBO_A
 ||

1224 
mode
 =ğ
IEEE80211_MODE_TURBO_G
))

1230 
	`add_chªÃls
(
ic
, 
ss
, 
mode
, 
sÿn
->
li¡
, sÿn->
couÁ
);

1232 
ss
->
ss_Ãxt
 = 0;

1234 
ss
->
ss_mšdw–l
 = 
	`m£cs_to_jiff›s
(200);

1235 
ss
->
ss_maxdw–l
 = 
	`m£cs_to_jiff›s
(200);

1237 #ifdeà
IEEE80211_DEBUG


1238 ià(
	`›“80211_msg_sÿn
(
v­
)) {

1239 
	`´štk
("%s: sÿÀ£ˆ", 
v­
->
iv_dev
->
Çme
);

1240 
	`›“80211_sÿn_dump_chªÃls
(
ss
);

1241 
	`´štk
(" dwell min %ld max %ld\n",

1242 
ss
->
ss_mšdw–l
, ss->
ss_maxdw–l
);

1246 
¡
->
¡_Ãwsÿn
 = 1;

1249 
	}
}

1257 
›“80211_chªÃl
 *

1258 
	$adhoc_pick_chªÃl
(
›“80211_sÿn_¡©e
 *
ss
)

1260 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1261 
¡a_’Œy
 *
£
;

1262 
›“80211_chªÃl
 *
c
, *
be¡chª
;

1263 
i
, 
be¡rssi
, 
maxrssi
;

1265 
be¡chª
 = 
NULL
;

1266 
be¡rssi
 = -1;

1268 
	`SCAN_STA_LOCK_IRQ
(
¡
);

1269 
i
 = 0; i < 
ss
->
ss_Ï¡
; i++) {

1270 
c
 = 
ss
->
ss_chªs
[
i
];

1271 
maxrssi
 = 0;

1272 
	`TAILQ_FOREACH
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
) {

1273 ià(
£
->
ba£
.
£_chª
 !ğ
c
)

1275 ià(
£
->
ba£
.
£_rssi
 > 
maxrssi
)

1276 
maxrssi
 = 
£
->
ba£
.
£_rssi
;

1278 ià(
be¡chª
 =ğ
NULL
 || 
maxrssi
 < 
be¡rssi
)

1279 
be¡chª
 = 
c
;

1281 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

1283  
be¡chª
;

1284 
	}
}

1291 
adhoc_pick_bss
(
›“80211_sÿn_¡©e
 *
ss
, 
›“80211v­
 *
v­
,

1292 (*
aùiÚ
)(
›“80211v­
 *, cÚ¡ 
›“80211_sÿn_’Œy
 *),

1293 
u_št32_t
 
æags
)

1295 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1296 
¡a_’Œy
 *
£lbs
;

1297 
›“80211_chªÃl
 *
chª
;

1299 
	`KASSERT
(
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
 ||

1300 
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
,

1301 ("wrÚg opmod%u", 
v­
->
iv_İmode
));

1303 ià(
¡
->
¡_Ãwsÿn
) {

1304 
	`¡a_upd©e_nÙ£’
(
¡
);

1305 
¡
->
¡_Ãwsÿn
 = 0;

1307 ià(
ss
->
ss_æags
 & 
IEEE80211_SCAN_NOPICK
) {

1313 
ss
->
ss_æags
 &ğ~
IEEE80211_SCAN_NOPICK
;

1317 
¡
->
¡_aùiÚ
 = 
ss
->
ss_İs
->
sÿn_deçuÉ
;

1318 ià(
aùiÚ
)

1319 
¡
->
¡_aùiÚ
 = 
aùiÚ
;

1326 ià(
	`TAILQ_FIRST
(&
¡
->
¡_’Œy
è=ğ
NULL
 ||

1327 (
£lbs
 = 
	`£Ëù_bss
(
ss
, 
v­
)è=ğ
NULL
) {

1328 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

1329 "%s:‚ØsÿÀÿndid©e\n", 
__func__
);

1330 ià(
v­
->
iv_des_nssid
) {

1336 ià(
v­
->
iv_des_chª
 =ğ
IEEE80211_CHAN_ANYC
)

1337 
chª
 = 
	`adhoc_pick_chªÃl
(
ss
);

1339 
chª
 = 
v­
->
iv_des_chª
;

1340 ià(
chª
 !ğ
NULL
) {

1341 
›“80211_sÿn_’Œy
 
£
;

1343 
	`mem£t
(&
£
, 0, (se));

1344 
£
.
£_chª
 = 
chª
;

1345 
¡
->
¡_£lbss
 = 
£
;

1347 
	`IEEE80211_SCHEDULE_TQUEUE
(&
¡
->
¡_aùiÚtq
);

1358 
	`¡a_dec_çs
(
¡
);

1359 
¡
->
¡_Ãwsÿn
 = 1;

1367 
¡
->
¡_£lbss
 = 
£lbs
->
ba£
;

1368 
	`IEEE80211_SCHEDULE_TQUEUE
(&
¡
->
¡_aùiÚtq
);

1371 
	}
}

1377 
	$adhoc_age
(
›“80211_sÿn_¡©e
 *
ss
)

1379 
¡a_bË
 *
¡
 = 
ss
->
ss_´iv
;

1380 
¡a_’Œy
 *
£
, *
Ãxt
;

1382 
	`SCAN_STA_LOCK_IRQ
(
¡
);

1383 
	`TAILQ_FOREACH_SAFE
(
£
, &
¡
->
¡_’Œy
, 
£_li¡
, 
Ãxt
) {

1384 ià(
£
->
£_nÙ£’
 > 
STA_PURGE_SCANS
) {

1385 
	`TAILQ_REMOVE
(&
¡
->
¡_’Œy
, 
£
, 
£_li¡
);

1386 
	`LIST_REMOVE
(
£
, 
£_hash
);

1387 
	`FREE
(
£
, 
M_80211_SCAN
);

1390 
	`SCAN_STA_UNLOCK_IRQ
(
¡
);

1391 
	}
}

1398 
	$adhoc_deçuÉ_aùiÚ
(
›“80211v­
 *
v­
,

1399 cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

1401 
u_št8_t
 
z”oMacAddr
[
IEEE80211_ADDR_LEN
];

1403 
	`mem£t
(&
z”oMacAddr
, 0, 
IEEE80211_ADDR_LEN
);

1404 ià(
	`IEEE80211_ADDR_EQ
(
£
->
£_bssid
, &
z”oMacAddr
[0])) {

1405 
	`›“80211_ü—‹_ibss
(
v­
, 
£
->
£_chª
);

1408  
	`›“80211_¡a_još
(
v­
, 
£
);

1409 
	}
}

1411 cÚ¡ 
›“80211_sÿÂ”
 
	gadhoc_deçuÉ
 = {

1412 .
sÿn_Çme
 = "default",

1413 .
	gsÿn_©ch
 = 
¡a_©ch
,

1414 .
	gsÿn_d‘ach
 = 
¡a_d‘ach
,

1415 .
	gsÿn_¡¬t
 = 
adhoc_¡¬t
,

1416 .
	gsÿn_»¡¬t
 = 
¡a_»¡¬t
,

1417 .
	gsÿn_ÿnûl
 = 
¡a_ÿnûl
,

1418 .
	gsÿn_’d
 = 
adhoc_pick_bss
,

1419 .
	gsÿn_æush
 = 
¡a_æush
,

1420 .
	gsÿn_add
 = 
¡a_add
,

1421 .
	gsÿn_age
 = 
adhoc_age
,

1422 .
	gsÿn_™”©e
 = 
¡a_™”©e
,

1423 .
	gsÿn_assoc_ç
 = 
¡a_assoc_ç
,

1424 .
	gsÿn_assoc_sucûss
 = 
¡a_assoc_sucûss
,

1425 .
	gsÿn_deçuÉ
 = 
adhoc_deçuÉ_aùiÚ
,

1429 
	$aùiÚ_skËt
(
IEEE80211_TQUEUE_ARG
 
d©a
)

1431 
›“80211_sÿn_¡©e
 *
ss
 = (›“80211_sÿn_¡©*)
d©a
;

1432 
¡a_bË
 *
¡
 = (¡a_bË *)
ss
->
ss_´iv
;

1433 
›“80211v­
 *
v­
 = 
ss
->
ss_v­
;

1434 
›“80211_chªÃl
 *
chª
;

1436 ià((*
ss
->
ss_İs
->
sÿn_deçuÉ
)(
v­
, &
¡
->
¡_£lbss
))

1439 
v­
->
iv_İmode
) {

1440 
IEEE80211_M_STA
:

1441 
	`¡a_dec_çs
(
¡
);

1442 
¡
->
¡_Ãwsÿn
 = 1;

1446 ià(
v­
->
iv_des_nssid
) {

1452 ià(
v­
->
iv_des_chª
 =ğ
IEEE80211_CHAN_ANYC
)

1453 
chª
 = 
	`adhoc_pick_chªÃl
(
ss
);

1455 
chª
 = 
v­
->
iv_des_chª
;

1456 ià(
chª
 !ğ
NULL
) {

1457 
›“80211_sÿn_’Œy
 
£
;

1459 
	`mem£t
(&
£
, 0, (se));

1460 
£
.
£_chª
 = 
chª
;

1461 ià((*
ss
->
ss_İs
->
sÿn_deçuÉ
)(
v­
, &
£
))

1472 
	`¡a_dec_çs
(
¡
);

1473 
¡
->
¡_Ãwsÿn
 = 1;

1482 
v­
->
iv_ic
->
ic_æags
 &ğ~
IEEE80211_F_SCAN
;

1483 ià((
ss
->
ss_æags
 & 
IEEE80211_SCAN_USECACHE
) == 0)

1484 
	`›“80211_¡¬t_sÿn
(
v­
, 
ss
->
ss_æags
, ss->
ss_du¿tiÚ
, ss->
ss_nssid
, ss->
ss_ssid
);

1485 
	}
}

1490 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

1491 
MODULE_DESCRIPTION
("802.11 wireless support: default station scanner");

1492 #ifdeà
MODULE_LICENSE


1493 
MODULE_LICENSE
("Dual BSD/GPL");

1496 
__š™


1497 
	$š™_sÿÂ”_¡a
()

1499 
	`›“80211_sÿÂ”_»gi¡”
(
IEEE80211_M_STA
, &
¡a_deçuÉ
);

1500 
	`›“80211_sÿÂ”_»gi¡”
(
IEEE80211_M_IBSS
, &
adhoc_deçuÉ
);

1501 
	`›“80211_sÿÂ”_»gi¡”
(
IEEE80211_M_AHDEMO
, &
adhoc_deçuÉ
);

1503 
	}
}

1504 
moduË_š™
(
š™_sÿÂ”_¡a
);

1506 
__ex™


1507 
	$ex™_sÿÂ”_¡a
()

1509 
	`›“80211_sÿÂ”_uÄegi¡”_®l
(&
¡a_deçuÉ
);

1510 
	`›“80211_sÿÂ”_uÄegi¡”_®l
(&
adhoc_deçuÉ
);

1511 
	}
}

1512 
moduË_ex™
(
ex™_sÿÂ”_¡a
);

	@ieee80211_skb.c

30 #iâdeà
EXPORT_SYMTAB


31 
	#EXPORT_SYMTAB


	)

37 #iâdeà
AUTOCONF_INCLUDED


38 
	~<lšux/cÚfig.h
>

40 
	~<lšux/v”siÚ.h
>

41 
	~<lšux/moduË.h
>

42 
	~<lšux/kmod.h
>

43 
	~<lšux/š™.h
>

44 
	~<lšux/skbuff.h
>

45 
	~<lšux/sysùl.h
>

46 
	~<lšux/Ãtdeviû.h
>

47 
	~<lšux/‘h”deviû.h
>

48 
	~<lšux/if_vÏn.h
>

49 
	~<lšux/vm®loc.h
>

50 
	~<lšux/´oc_fs.h
>

52 
	~<Ãt/iw_hªdËr.h
>

53 
	~<lšux/wœ–ess.h
>

54 
	~<lšux/if_¬p.h
>

56 
	~<asm/uacûss.h
>

58 
	~"if_medŸ.h
"

59 
	~"if_‘h”subr.h
"

61 
	~<Ãt80211/›“80211_v¬.h
>

62 
	~<Ãt80211/›“80211_mÚ™Ü.h
>

64 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,17)

65 
	~<lšux/deviû.h
>

68 #undeà
®loc_skb


69 #undeà
dev_®loc_skb


70 #undeà
dev_kä“_skb


71 #undeà
dev_kä“_skb_ªy


72 #undeà
dev_kä“_skb_œq


73 #undeà
dev_queue_xm™


74 #undeà
kä“_skb


75 #undeà
kä“_skb_ç¡


76 #undeà
Ãtif_rx


77 #undeà
pskb_cİy


78 #undeà
skb_şÚe


79 #undeà
skb_cİy


80 #undeà
skb_cİy_ex·nd


81 #undeà
skb_g‘


82 #undeà
skb_»®loc_h—droom


83 #undeà
skb_sh¬e_check


84 #undeà
skb_unsh¬e


85 #undeà
vÏn_hwacûl_rx


87 
©omic_t
 
	gskb_tÙ®_couÁ”
 = 
ATOMIC_INIT
(0);

88 
EXPORT_SYMBOL
(
skb_tÙ®_couÁ”
);

90 #ifdeà
IEEE80211_DEBUG_REFCNT


91 
©omic_t
 
	gskb_»fs_couÁ”
 = 
ATOMIC_INIT
(0);

92 
EXPORT_SYMBOL
(
skb_»fs_couÁ”
);

99 
	$skb_´št_mes§ge
(

100 
show_couÁ”
,

101 cÚ¡ 
sk_buff
 *
skb
,

102 cÚ¡ *
func
, 
lše
,

103 cÚ¡ *
mes§ge
,

106 
va_li¡
 
¬gs
;

107 
skb_couÁ
[32] = { '\0' };

108 
ex·nded_mes§ge
[1024] = { '\0' };

109 ià(
show_couÁ”
) {

110 #ifdeà
IEEE80211_DEBUG_REFCNT


111 
	`¢´štf
(
skb_couÁ
,

112 (
skb_couÁ
),

114 
	`©omic_»ad
(&
skb_tÙ®_couÁ”
),

115 
	`©omic_»ad
(&
skb_»fs_couÁ”
));

117 
	`¢´štf
(
skb_couÁ
,

118 (
skb_couÁ
),

120 
	`©omic_»ad
(&
skb_tÙ®_couÁ”
));

124 
	`va_¡¬t
(
¬gs
, 
mes§ge
);

125 
	`v¢´štf
(
ex·nded_mes§ge
, Óx·nded_mes§ge), 
mes§ge
, 
¬gs
);

126 
	`´štk
(
KERN_DEBUG
 "%s: %s%s:%d %s\n",

127 ((
skb
 !ğ
NULL
è? 
	`DEV_NAME
(skb->
dev
) : "none"),

128 
skb_couÁ
,

129 
func
, 
lše
,

130 
ex·nded_mes§ge
);

131 
	`va_’d
(
¬gs
);

132 #ifdeà
IEEE80211_DEBUG_REFCNT


133 
	`dump_¡ack
();

135 
	}
}

137 #ifdeà
IEEE80211_DEBUG_REFCNT


140 
´št_skb_»fchªge_mes§ge
(

141 cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

142 cÚ¡ *
func
, 
lše
);

144 
´št_skb_Œackchªge_mes§ge
(

145 cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

146 cÚ¡ *
func
, 
lše
,

147 *
mes§ge
);

151 #ifdeà
IEEE80211_DEBUG_REFCNT_SKBDEST


152 
skb_de¡ruùÜ
(
sk_buff
 *
skb
);

154 
g‘_skb_desütiÚ
(*
d¡
, 
d¡_size
, cÚ¡ *
Ïb–
,

155 cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
);

157 
sk_buff
 *

158 
ş—n_şÚe_Ü_cİy
(
sk_buff
 *
skb
);

160 
sk_buff
 *

161 
Œack_skb
(
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

162 cÚ¡ *
func
, 
lše
);

164 
sk_buff
 *

165 
uÁ¿ck_skb
(
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

166 cÚ¡ *
func
, 
lše
);

168 
	#UNREF_USE_KFREE_SKB
 0

	)

169 
	#UNREF_USE_DEV_KFREE_SKB_ANY
 1

	)

170 
	#UNREF_USE_DEV_KFREE_SKB
 2

	)

171 
	#UNREF_USE_DEV_KFREE_SKB_IRQ
 3

	)

175 
uÄef_skb
(
sk_buff
 *
skb
, 
ty³
,

176 cÚ¡ *
func
, 
lše
);

180 
sk_buff
 *

181 
»f_skb
(
sk_buff
 *
skb
,

182 cÚ¡ *
func
, 
lše
);

185 #ifdeà
IEEE80211_DEBUG_REFCNT_SKBDEST


187 
	$skb_de¡ruùÜ
(
sk_buff
 *
skb
) {

190 ià(
	`SKB_NI
(
skb
è!ğ
NULL
) {

191 
	`´štk
(
KERN_ERR
 "%s:%d - ERROR:‚Ú-NULL‚odpoš‹¸š %p, %p<" 
MAC_FMT
 ">! "

193 
__func__
, 
__LINE__
,

194 
skb
, 
	`SKB_NI
(skb), 
	`MAC_ADDR
(SKB_NI(skb)->
ni_maÿddr
));

195 
	`dump_¡ack
();

197 ià(
	`SKB_CB
(
skb
)->
Ãxt_de¡ruùÜ
 !ğ
NULL
) {

198 
	`SKB_CB
(
skb
)->
	`Ãxt_de¡ruùÜ
(skb);

200 
	}
}

201 
EXPORT_SYMBOL
(
skb_de¡ruùÜ
);

204 
	$g‘_skb_desütiÚ
(*
d¡
, 
d¡_size
, cÚ¡ *
Ïb–
, cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
) {

205 
d¡
[0] = '\0';

206 ià(
NULL
 !ğ
skb
) {

207 
adj_u£rs
 = 
	`©omic_»ad
(&
skb
->
u£rs
è+ 
u£rs_adju¡m’t
;

208 ià(
	`SKB_NI
(
skb
è!ğ
NULL
) {

209 
	`¢´štf
(
d¡
, 
d¡_size
,

210 " [%s%s%p,u£rs=%d,node=%p<" 
MAC_FMT
 ">,aid=%d%s%s]",

211 
Ïb–
,

212 (
Ïb–
 !ğ
NULL
 ? ": " : ""),

213 
skb
,

214 
adj_u£rs
,

215 
	`SKB_NI
(
skb
),

216 
	`MAC_ADDR
(
	`SKB_NI
(
skb
)->
ni_maÿddr
),

217 
	`SKB_NI
(
skb
)->
ni_associd
,

218 ((
adj_u£rs
 < 0) ? " ** CORRUPTED **" : ""),

219 ((
adj_u£rs
 == 0) ? " ** RELEASED **" : "")

223 
	`¢´štf
(
d¡
, 
d¡_size
,

225 
Ïb–
,

226 (
Ïb–
 !ğ
NULL
 ? ": " : ""),

227 
skb
,

228 
adj_u£rs
,

229 ((
adj_u£rs
 < 0) ? " ** CORRUPTED **" : ""),

230 ((
adj_u£rs
 == 0) ? " ** RELEASED **" : "")

233 
d¡
[
d¡_size
-1] = '\0';

235 
	}
}

237 
	$´št_skb_»fchªge_mes§ge
(

238 cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

239 cÚ¡ *
func
, 
lše
)

241 
skb_desc
[128] = { '\0' };

242 ià(0 =ğ(
©h_debug_glob®
 & 
GLOBAL_DEBUG_SKB_REF
))

244 
	`g‘_skb_desütiÚ
(
skb_desc
, (skb_desc),

245 "skb", 
skb
, 
u£rs_adju¡m’t
);

246 
	`skb_´št_mes§ge
(0 , 
skb
,

247 
func
, 
lše
,

248 
skb_desc
);

249 
	}
}

251 
	$´št_skb_Œackchªge_mes§ge
(

252 cÚ¡ 
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

253 cÚ¡ *
func
, 
lše
,

254 *
mes§ge
)

256 
skb_desc
[128] = { '\0' };

257 ià(0 =ğ(
©h_debug_glob®
 & 
GLOBAL_DEBUG_SKB
))

259 
	`g‘_skb_desütiÚ
(
skb_desc
, (skb_desc),

260 "skb", 
skb
, 
u£rs_adju¡m’t
);

261 
	`skb_´št_mes§ge
(1 , 
skb
,

262 
func
, 
lše
,

263 "%s%s", 
skb_desc
, 
mes§ge
);

264 
	}
}

266 
sk_buff
 *

267 
	$ş—n_şÚe_Ü_cİy
(
sk_buff
 *
skb
) {

268 ià(
skb
 !ğ
NULL
)

269 
	`M_FLAG_CLR
(
skb
, 
M_SKB_TRACKED
);

270  
skb
;

271 
	}
}

273 
sk_buff
 *

274 
	$Œack_skb
(
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

275 cÚ¡ *
func
, 
lše
)

277 ià(
NULL
 =ğ
skb
) {

278 
	`skb_´št_mes§ge
(0 ,

279 
skb
, 
func2
, 
lše2
,

281  
NULL
;

283 ià(
	`M_FLAG_GET
(
skb
, 
M_SKB_TRACKED
)) {

284 
	`skb_´št_mes§ge
(0 ,

285 
skb
, 
func2
, 
lše2
,

287 
	`dump_¡ack
();

288  
skb
;

290 ià(
	`skb_sh¬ed
(
skb
)) {

291 
	`skb_´št_mes§ge
(0 ,

292 
skb
, 
func2
, 
lše2
,

294 
	`dump_¡ack
();

296 
	`©omic_šc
(&
skb_tÙ®_couÁ”
);

297 
	`©omic_šc
(&
skb_»fs_couÁ”
);

298 
	`M_FLAG_SET
(
skb
, 
M_SKB_TRACKED
);

299 
	`´št_skb_Œackchªge_mes§ge
(
skb
, 
u£rs_adju¡m’t
,

300 
func2
, 
lše2
,

302 #ifdeà
IEEE80211_DEBUG_REFCNT_SKBDEST


304 ià(
skb
->
de¡ruùÜ
 !ğ
skb_de¡ruùÜ
) {

305 
	`SKB_CB
(
skb
)->
Ãxt_de¡ruùÜ
 = skb->
de¡ruùÜ
;

306 
skb
->
de¡ruùÜ
 = 
skb_de¡ruùÜ
;

309  
skb
;

310 
	}
}

312 
sk_buff
 *

313 
	$uÁ¿ck_skb
(
sk_buff
 *
skb
, 
u£rs_adju¡m’t
,

314 cÚ¡ *
func
, 
lše
)

316 ià(
NULL
 =ğ
skb
) {

317 
	`skb_´št_mes§ge
(0 ,

318 
skb
, 
func
, 
lše
,

320  
NULL
;

322 ià(!
	`M_FLAG_GET
(
skb
, 
M_SKB_TRACKED
)) {

323 
	`skb_´št_mes§ge
(0 ,

324 
skb
, 
func
, 
lše
,

326  
skb
;

328 ià(
	`skb_sh¬ed
(
skb
)) {

329 
	`skb_´št_mes§ge
(0 ,

330 
skb
, 
func
, 
lše
,

333 
	`©omic_dec
(&
skb_tÙ®_couÁ”
);

334 
	`©omic_dec
(&
skb_»fs_couÁ”
);

335 
	`M_FLAG_CLR
(
skb
, 
M_SKB_TRACKED
);

336 #ifdeà
IEEE80211_DEBUG_REFCNT_SKBDEST


338 ià(
skb
->
de¡ruùÜ
 =ğ
skb_de¡ruùÜ
) {

339 
skb
->
de¡ruùÜ
 = 
	`SKB_CB
(skb)->
Ãxt_de¡ruùÜ
;

340 
	`SKB_CB
(
skb
)->
Ãxt_de¡ruùÜ
 = 
NULL
;

343 
	`´št_skb_Œackchªge_mes§ge
(
skb
, 
u£rs_adju¡m’t
,

344 
func
, 
lše
,

346  
skb
;

347 
	}
}

349 
	#UNREF_USE_KFREE_SKB
 0

	)

350 
	#UNREF_USE_DEV_KFREE_SKB_ANY
 1

	)

351 
	#UNREF_USE_DEV_KFREE_SKB
 2

	)

352 
	#UNREF_USE_DEV_KFREE_SKB_IRQ
 3

	)

357 
	$uÄef_skb
(
sk_buff
 *
skb
, 
ty³
,

358 cÚ¡ *
func
, 
lše
)

360 ià(
NULL
 =ğ
skb
) {

361 
	`skb_´št_mes§ge
(0 ,

362 
skb
, 
func
, 
lše
,

364 
	`dump_¡ack
();

367 ià(!
	`M_FLAG_GET
(
skb
, 
M_SKB_TRACKED
)) {

368 
	`skb_´št_mes§ge
(0 ,

369 
skb
, 
func
, 
lše
,

371 
	`dump_¡ack
();

375 ià(
	`©omic_»ad
(&
skb
->
u£rs
) < 1) {

376 
	`skb_´št_mes§ge
(0 ,

377 
skb
, 
func
, 
lše
,

379 
	`©omic_»ad
(&
skb
->
u£rs
));

380 
	`dump_¡ack
();

384 ià(
	`skb_sh¬ed
(
skb
)) {

385 
	`©omic_dec
(&
skb_»fs_couÁ”
);

386 
	`´št_skb_»fchªge_mes§ge
(
skb
, -1, 
func2
, 
lše2
);

389 ià(
	`SKB_NI
(
skb
è!ğ
NULL
) {

390 
	`´štk
(
KERN_ERR
 "%s:%d - ERROR:‚Ú-NULL‚odpoš‹¸š %p, %p<" 
MAC_FMT
 ">! "

392 
__func__
, 
__LINE__
,

393 
skb
, 
	`SKB_NI
(skb), 
	`MAC_ADDR
(SKB_NI(skb)->
ni_maÿddr
));

394 
	`dump_¡ack
();

397 
	`SKB_NI
(
skb
èğ
NULL
;

399 
	`uÁ¿ck_skb
(
skb
, -1, 
func
, 
lše
);

402 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,0)

403 ià((
	`š_œq
(è|| 
	`œqs_di§bËd
()) &&

404 (
ty³
 =ğ
UNREF_USE_KFREE_SKB
 ||

405 
ty³
 =ğ
UNREF_USE_DEV_KFREE_SKB
)) {

406 
	`skb_´št_mes§ge
(0 ,

407 
skb
, 
func
, 
lše
,

410 
ty³
 = 
UNREF_USE_DEV_KFREE_SKB_ANY
;

411 
	`dump_¡ack
();

415 
ty³
) {

416 
UNREF_USE_DEV_KFREE_SKB_ANY
:

417 
	`dev_kä“_skb_ªy
(
skb
);

419 
UNREF_USE_DEV_KFREE_SKB_IRQ
:

420 
	`dev_kä“_skb_œq
(
skb
);

422 
UNREF_USE_DEV_KFREE_SKB
:

425 
UNREF_USE_KFREE_SKB
:

428 
	`kä“_skb
(
skb
);

431 
	}
}

435 
sk_buff
 *

436 
	$»f_skb
(
sk_buff
 *
skb
,

437 cÚ¡ *
func
, 
lše
)

439 ià(
NULL
 =ğ
skb
) {

440 
	`skb_´št_mes§ge
(0 ,

441 
skb
, 
func
, 
lše
,

443 
	`dump_¡ack
();

444  
NULL
;

446 ià(!
	`M_FLAG_GET
(
skb
, 
M_SKB_TRACKED
)) {

447 
	`skb_´št_mes§ge
(0 ,

448 
skb
, 
func
, 
lše
,

451 
	`dump_¡ack
();

452  
skb
;

454 
	`´št_skb_»fchªge_mes§ge
(
skb
, 0, 
func
, 
lše
);

455  
skb
;

456 
	}
}

468 
	$›“80211_dev_kä“_skb
(
sk_buff
 **
pskb
)

470 
sk_buff
 *
skb
;

473 ià(!
pskb
 || !(
skb
 = *pskb))

478 ià(
skb
->
´ev
 =ğ
NULL
) {

479 ià(
skb
->
Ãxt
 !ğ
NULL
)

480 
skb
->
Ãxt
->
´ev
 = 
NULL
;

481 
skb
->
Ãxt
 = 
NULL
;

484 ià(
	`SKB_NI
(
skb
è!ğ
NULL
)

485 
	`›“80211_uÄef_node
(&
	`SKB_NI
(
skb
));

487 #ifdeà
IEEE80211_DEBUG_REFCNT


488 
	`uÄef_skb
(
skb
, 
UNREF_USE_DEV_KFREE_SKB_ANY
,

489 
__func__
, 
__LINE__
);

491 
	`dev_kä“_skb_ªy
(
skb
);

494 *
pskb
 = 
NULL
;

495 
	}
}

500 
	$›“80211_dev_kä“_skb_li¡
(
sk_buff
 **
pskb
)

502 
sk_buff
 *
skb
, *
tskb
;

505 ià(!
pskb
 || !(
skb
 = *pskb))

508 
skb
) {

509 
tskb
 = 
skb
->
Ãxt
;

511 
	`›“80211_dev_kä“_skb
(&
skb
);

512 
skb
 = 
tskb
;

515 *
pskb
 = 
NULL
;

516 
	}
}

518 
sk_buff
 *

519 
	$›“80211_dev_®loc_skb
(
size
)

521 
sk_buff
 *
skb
 = 
	`dev_®loc_skb
(
size
);

522 ià(
skb
 =ğ
NULL
) {

523 
	`skb_´št_mes§ge
(

525 
NULL
 ,

526 
__func__
, 
__LINE__
,

528 
size
);

529  
NULL
;

532 #ifdeà
IEEE80211_DEBUG_REFCNT


533  
	`Œack_skb
(
skb
, 0, 
__func__
, 
__LINE__
);

535  
skb
;

537 
	}
}

540 
	$›“80211_skb_Œack
(
sk_buff
 *
skb
) {

541 #ifdeà
IEEE80211_DEBUG_REFCNT


542 
	`Œack_skb
(
skb
, 0 ,

543 
__func__
, 
__LINE__
);

546 
	`©omic_šc
(&
skb_tÙ®_couÁ”
);

548 
	}
}

551 
	$›“80211_skb_uÁ¿ck
(
sk_buff
 *
skb
) {

553 
	`©omic_dec
(&
skb_tÙ®_couÁ”
);

554 
	}
}

556 #ifdeà
IEEE80211_DEBUG_REFCNT


558 
	$›“80211_skb_couÁ”
() {

559  
	`©omic_»ad
(&
skb_tÙ®_couÁ”
);

560 
	}
}

563 
	$›“80211_skb_»ã»nûs
() {

564  
	`©omic_»ad
(&
skb_»fs_couÁ”
);

565 
	}
}

574 #ifdeà
IEEE80211_DEBUG_REFCNT


576 
	$vÏn_hwacûl_rx_debug
(
sk_buff
 *
skb
,

577 
vÏn_group
 *
g½
, 
vÏn_g
,

578 cÚ¡ *
func
, 
lše
) {

579  
	`vÏn_hwacûl_rx
(

580 
	`uÁ¿ck_skb
(
skb
, 0, 
__func__
, 
__LINE__
),

581 
g½
, 
vÏn_g
);

582 
	}
}

584 
	$Ãtif_rx_debug
(
sk_buff
 *
skb
, cÚ¡ *
func
, 
lše
) {

585  
	`Ãtif_rx
(
	`uÁ¿ck_skb
(
skb
, 0, 
__func__
, 
__LINE__
));

586 
	}
}

588 
sk_buff
 *
	$®loc_skb_debug
(
Ëngth
, 
gå_t
 
gå_mask
,

589 cÚ¡ *
func
, 
lše
) {

590  
	`Œack_skb
(
	`®loc_skb
(
Ëngth
, 
gå_mask
),

592 
__func__
, 
__LINE__
);

593 
	}
}

595 
sk_buff
 *
	$dev_®loc_skb_debug
(
Ëngth
,

596 cÚ¡ *
func
, 
lše
)

598  
	`Œack_skb
(
	`dev_®loc_skb
(
Ëngth
),

600 
__func__
, 
__LINE__
);

601 
	}
}

605 
sk_buff
 *
	$skb_şÚe_debug
(
sk_buff
 *
skb
, 
gå_t
 
´i
,

606 cÚ¡ *
func
, 
lše
)

608  
	`Œack_skb
(

609 
	`ş—n_şÚe_Ü_cİy
(
	`skb_şÚe
(
skb
, 
´i
)),

611 
__func__
, 
__LINE__
);

612 
	}
}

614 
sk_buff
 *
	$skb_cİy_debug
(
sk_buff
 *
skb
, 
gå_t
 
´i
,

615 cÚ¡ *
func
, 
lše
)

617  
	`Œack_skb
(

618 
	`ş—n_şÚe_Ü_cİy
(
	`skb_cİy
(
skb
, 
´i
)), 0 ,

619 
__func__
, 
__LINE__
);

620 
	}
}

622 
sk_buff
 *
	$skb_g‘_debug
(
sk_buff
 *
skb
,

623 cÚ¡ *
func
, 
lše
)

625  
	`»f_skb
(
	`skb_g‘
(
skb
),

626 
__func__
, 
__LINE__
);

627 
	}
}

629 
sk_buff
 *
	$skb_»®loc_h—droom_debug
(
sk_buff
 *
skb
, 
h—droom
,

630 cÚ¡ *
func
, 
lše
)

634  
	`Œack_skb
(

635 
	`ş—n_şÚe_Ü_cİy
(

636 
	`skb_»®loc_h—droom
(
skb
, 
h—droom
)),

638 
__func__
, 
__LINE__
);

639 
	}
}

641 
sk_buff
 *
	$pskb_cİy_debug
(
sk_buff
 *
skb
, 
gå_t
 
´i
,

642 cÚ¡ *
func
, 
lše
)

644  
	`Œack_skb
(

645 
	`ş—n_şÚe_Ü_cİy
(
	`pskb_cİy
(
skb
, 
´i
)),

647 
__func__
, 
__LINE__
);

648 
	}
}

650 
	$dev_queue_xm™_debug
(
sk_buff
 *
skb
,

651 cÚ¡ *
func
, 
lše
)

653  
	`dev_queue_xm™
(
	`uÁ¿ck_skb
(
skb
, 0, 
__func__
, 
__LINE__
));

654 
	}
}

656 
sk_buff
 *
	$skb_sh¬e_check_debug
(
sk_buff
 *
skb
, 
gå_t
 
´i
,

657 cÚ¡ *
func
, 
lše
)

659 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,0)

660 
	`might_¦“p_if
(
´i
 & 
__GFP_WAIT
);

662 ià(
	`skb_sh¬ed
(
skb
)) {

663 
sk_buff
 *
nskb
 = 
	`Œack_skb
(

664 
	`ş—n_şÚe_Ü_cİy
(
	`skb_şÚe
(
skb
, 
´i
)),

666 
__func__
, 
__LINE__
);

667 
	`uÄef_skb
(
skb
, 
UNREF_USE_DEV_KFREE_SKB_ANY
,

668 
__func__
, 
__LINE__
);

669 
skb
 = 
nskb
;

671  
skb
;

672 
	}
}

674 
	$kä“_skb_ç¡_debug
(
sk_buff
 *
skb
,

675 cÚ¡ *
func
, 
lše
)

678 
	`uÄef_skb
(
skb
, 
UNREF_USE_DEV_KFREE_SKB_ANY
, 
func
, 
lše
, 
__func__
, 
__LINE__
);

679 
	}
}

681 
sk_buff
 *
	$skb_unsh¬e_debug
(
sk_buff
 *
skb
, 
gå_t
 
´i
,

682 cÚ¡ *
func
, 
lše
)

684 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2,6,0)

685 
	`might_¦“p_if
(
´i
 & 
__GFP_WAIT
);

687 ià(
	`skb_şÚed
(
skb
)) {

688 
sk_buff
 *
nskb
 = 
	`Œack_skb
(

689 
	`ş—n_şÚe_Ü_cİy
(
	`skb_cİy
(
skb
, 
´i
)), 0,

690 
__func__
, 
__LINE__
);

691 
	`uÄef_skb
(
skb
, 
UNREF_USE_DEV_KFREE_SKB_ANY
,

692 
__func__
, 
__LINE__
);

693 
skb
 = 
nskb
;

695  
skb
;

696 
	}
}

698 
sk_buff
 *
	$skb_cİy_ex·nd_debug
(cÚ¡ 
sk_buff
 *
skb
, 
Ãwh—droom
,

699 
Ãwroom
, 
gå_t
 
gå_mask
,

700 cÚ¡ *
func
, 
lše
)

702  
	`Œack_skb
(

703 
	`ş—n_şÚe_Ü_cİy
(

704 
	`skb_cİy_ex·nd
(
skb
, 
Ãwh—droom
, 
Ãwroom
, 
gå_mask
)),

706 
__func__
, 
__LINE__
);

707 
	}
}

709 
EXPORT_SYMBOL
(
vÏn_hwacûl_rx_debug
);

710 
EXPORT_SYMBOL
(
Ãtif_rx_debug
);

711 
EXPORT_SYMBOL
(
®loc_skb_debug
);

712 
EXPORT_SYMBOL
(
dev_®loc_skb_debug
);

713 
EXPORT_SYMBOL
(
skb_şÚe_debug
);

714 
EXPORT_SYMBOL
(
skb_cİy_debug
);

715 
EXPORT_SYMBOL
(
skb_g‘_debug
);

716 
EXPORT_SYMBOL
(
skb_»®loc_h—droom_debug
);

717 
EXPORT_SYMBOL
(
pskb_cİy_debug
);

718 
EXPORT_SYMBOL
(
dev_queue_xm™_debug
);

719 
EXPORT_SYMBOL
(
skb_sh¬e_check_debug
);

720 
EXPORT_SYMBOL
(
kä“_skb_ç¡_debug
);

721 
EXPORT_SYMBOL
(
skb_unsh¬e_debug
);

722 
EXPORT_SYMBOL
(
skb_cİy_ex·nd_debug
);

724 
EXPORT_SYMBOL
(
›“80211_skb_couÁ”
);

725 
EXPORT_SYMBOL
(
›“80211_skb_»ã»nûs
);

728 
EXPORT_SYMBOL
(
›“80211_dev_®loc_skb
);

729 
EXPORT_SYMBOL
(
›“80211_skb_uÁ¿ck
);

730 
EXPORT_SYMBOL
(
›“80211_dev_kä“_skb_li¡
);

731 
EXPORT_SYMBOL
(
›“80211_dev_kä“_skb
);

732 
EXPORT_SYMBOL
(
›“80211_skb_Œack
);

	@ieee80211_skb.h

29 #iâdeà
_NET80211_IEEE80211_SKB_H_


30 
	#_NET80211_IEEE80211_SKB_H_


	)

36 #ifdeà
IEEE80211_DEBUG_REFCNT


39 
©omic_t
 
skb_tÙ®_couÁ”
;

41 
©omic_t
 
skb_»fs_couÁ”
;

50 
	#SKB_CB
(
_skb
è((
›“80211_cb
 *)(_skb)->
cb
)

	)

51 
	#SKB_NI
(
_skb
è(
	`SKB_CB
(_skb)->
ni
)

	)

53 
	#M_FLAG_SET
(
_skb
, 
_æag
) \

54 (
	`SKB_CB
(
_skb
)->
æags
 |ğ(
_æag
))

	)

55 
	#M_FLAG_CLR
(
_skb
, 
_æag
) \

56 (
	`SKB_CB
(
_skb
)->
æags
 &ğ~(
_æag
))

	)

57 
	#M_FLAG_GET
(
_skb
, 
_æag
) \

58 (
	`SKB_CB
(
_skb
)->
æags
 & (
_æag
))

	)

59 
	#M_FLAG_KEEP_ONLY
(
_skb
, 
_æag
) \

60 (
	`SKB_CB
(
_skb
)->
æags
 &ğ(
_æag
))

	)

62 
	#M_PWR_SAV_SET
(
skb
è
	`M_FLAG_SET
((skb), 
M_PWR_SAV
)

	)

63 
	#M_PWR_SAV_CLR
(
skb
è
	`M_FLAG_CLR
((skb), 
M_PWR_SAV
)

	)

64 
	#M_PWR_SAV_GET
(
skb
è
	`M_FLAG_GET
((skb), 
M_PWR_SAV
)

	)

70 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2,6,20)

71 
	#skb_age
 
csum_off£t


	)

73 
	#skb_age
 
csum


	)

76 
	#M_AGE_SET
(
_skb
,
_v
è((_skb)->
skb_age
 = (_v))

	)

77 
	#M_AGE_GET
(
_skb
è((_skb)->
skb_age
)

	)

78 
	#M_AGE_SUB
(
_skb
,
_adj
è((_skb)->
skb_age
 -ğ(_adj))

	)

84 
›“80211_dev_kä“_skb
(
sk_buff
 **
pskb
);

86 
šlše
 
	$›“80211_skb_cİy_nod”ef
(
sk_buff
 *
¤c
,

87 
sk_buff
 *
d¡
)

89 ià(
	`SKB_NI
(
¤c
è!ğ
NULL
)

90 
	`SKB_NI
(
d¡
èğ
	`›“80211_»f_node
(SKB_NI(
¤c
));

91 
	}
}

95 
›“80211_dev_kä“_skb_li¡
(
sk_buff
 **
pskb
);

97 
sk_buff
 *
›“80211_dev_®loc_skb
(
size
);

99 
›“80211_skb_Œack
(
sk_buff
 *
skb
);

100 
›“80211_skb_uÁ¿ck
(
sk_buff
 *
skb
);

102 #ifdeà
IEEE80211_DEBUG_REFCNT


103 
›“80211_skb_couÁ”
();

104 
›“80211_skb_»ã»nûs
();

106 
	#›“80211_skb_couÁ”
(è(0)

	)

107 
	#›“80211_skb_»ã»nûs
(è(0)

	)

114 #ifdeà
IEEE80211_DEBUG_REFCNT


116 
vÏn_hwacûl_rx_debug
(
sk_buff
 *
skb
, 
vÏn_group
 *
g½
,

117 
vÏn_g
, cÚ¡ *
func
, 
lše
);

118 
Ãtif_rx_debug
(
sk_buff
 *
skb
, cÚ¡ *
func
, 
lše
);

119 
sk_buff
 *
®loc_skb_debug
(
Ëngth
, 
gå_t
 
gå_mask
,

120 cÚ¡ *
func
, 
lše
);

121 
sk_buff
 *
dev_®loc_skb_debug
(
Ëngth
,

122 cÚ¡ *
func
, 
lše
);

123 
sk_buff
 *
skb_şÚe_debug
(sk_bufà*
skb
, 
gå_t
 
´i
,

124 cÚ¡ *
func
, 
lše
);

125 
sk_buff
 *
skb_cİy_debug
(sk_bufà*
skb
, 
gå_t
 
´i
,

126 cÚ¡ *
func
, 
lše
);

127 
sk_buff
 *
skb_g‘_debug
(sk_bufà*
skb
,

128 cÚ¡ *
func
, 
lše
);

129 
sk_buff
 *
skb_»®loc_h—droom_debug
(sk_bufà*
skb
, 
h—droom
,

130 cÚ¡ *
func
, 
lše
);

131 
sk_buff
 *
pskb_cİy_debug
(sk_bufà*
skb
, 
gå_t
 
´i
,

132 cÚ¡ *
func
, 
lše
);

133 
dev_queue_xm™_debug
(
sk_buff
 *
skb
,

134 cÚ¡ *
func
, 
lše
);

135 
sk_buff
 *
skb_sh¬e_check_debug
(sk_bufà*
skb
, 
gå_t
 
´i
,

136 cÚ¡ *
func
, 
lše
);

137 
kä“_skb_ç¡_debug
(
sk_buff
 *
skb
,

138 cÚ¡ *
func
, 
lše
);

139 
sk_buff
 *
skb_unsh¬e_debug
(sk_bufà*
skb
, 
gå_t
 
´i
,

140 cÚ¡ *
func
, 
lše
);

141 
sk_buff
 *
skb_cİy_ex·nd_debug
(cÚ¡ sk_bufà*
skb
, 
Ãwh—droom
,

142 
Ãwroom
, 
gå_t
 
gå_mask
,

143 cÚ¡ *
func
, 
lše
);

145 #undeà
®loc_skb


146 #undeà
dev_®loc_skb


147 #undeà
dev_kä“_skb


148 #undeà
dev_kä“_skb_ªy


149 #undeà
dev_kä“_skb_œq


150 #undeà
dev_queue_xm™


151 #undeà
kä“_skb


152 #undeà
kä“_skb_ç¡


153 #undeà
Ãtif_rx


154 #undeà
pskb_cİy


155 #undeà
skb_şÚe


156 #undeà
skb_cİy


157 #undeà
skb_cİy_ex·nd


158 #undeà
skb_g‘


159 #undeà
skb_»®loc_h—droom


160 #undeà
skb_sh¬e_check


161 #undeà
skb_unsh¬e


162 #undeà
vÏn_hwacûl_rx


164 
	#skb_unsh¬e
(
_skb
, 
_´i
) \

165 
	`skb_unsh¬e_debug
(
_skb
, 
_´i
, 
__func__
, 
__LINE__
)

	)

166 
	#skb_cİy_ex·nd
(
_skb
, 
_Ãwh—droom
, 
_Ãwroom
, 
_gå_mask
) \

167 
	`skb_cİy_ex·nd_debug
(
_skb
, 
_Ãwh—droom
, 
_Ãwroom
, 
_gå_mask
, 
__func__
, 
__LINE__
)

	)

168 
	#vÏn_hwacûl_rx
(
_skb
, 
_g½
, 
_g
) \

169 
	`vÏn_hwacûl_rx_debug
(
_skb
, 
_g½
, 
_g
, 
__func__
, 
__LINE__
)

	)

170 
	#Ãtif_rx
(
_skb
) \

171 
	`Ãtif_rx_debug
(
_skb
, 
__func__
, 
__LINE__
)

	)

172 
	#®loc_skb
(
_Ëngth
, 
_gå_mask
) \

173 
	`®loc_skb_debug
(
_Ëngth
, 
_gå_mask
, 
__func__
, 
__LINE__
)

	)

174 
	#dev_®loc_skb
(
_Ëngth
) \

175 
	`dev_®loc_skb_debug
(
_Ëngth
, 
__func__
, 
__LINE__
)

	)

176 
	#dev_kä“_skb_œq
(
_skb
) \

177 
	`uÄef_skb
(
_skb
, 
UNREF_USE_DEV_KFREE_SKB_IRQ
, 
__func__
, 
__LINE__
)

	)

178 
	#dev_kä“_skb_ªy
(
_skb
) \

179 
	`uÄef_skb
(
_skb
, 
UNREF_USE_DEV_KFREE_SKB_ANY
, 
__func__
, 
__LINE__
)

	)

180 
	#dev_kä“_skb
(
_skb
) \

181 
	`uÄef_skb
(
_skb
, 
UNREF_USE_DEV_KFREE_SKB
, 
__func__
, 
__LINE__
)

	)

182 
	#kä“_skb
(
_skb
) \

183 
	`uÄef_skb
(
_skb
, 
UNREF_USE_KFREE_SKB
, 
__func__
, 
__LINE__
)

	)

184 
	#skb_şÚe
(
_skb
, 
_´i
) \

185 
	`skb_şÚe_debug
(
_skb
, 
_´i
, 
__func__
, 
__LINE__
)

	)

186 
	#skb_sh¬e_check
(
_skb
, 
_´i
) \

187 
	`skb_sh¬e_check_debug
(
_skb
, 
_´i
, 
__func__
, 
__LINE__
)

	)

188 
	#kä“_skb_ç¡
(
_skb
) \

189 
	`kä“_skb_ç¡_debug
(
_skb
, 
__func__
, 
__LINE__
)

	)

190 
	#skb_»®loc_h—droom
(
_skb
, 
_h—droom
) \

191 
	`skb_»®loc_h—droom_debug
(
_skb
, 
_h—droom
, 
__func__
, 
__LINE__
)

	)

192 
	#pskb_cİy
(
_skb
, 
_´i
) \

193 
	`pskb_cİy_debug
(
_skb
, 
_´i
, 
__func__
, 
__LINE__
)

	)

194 
	#skb_g‘
(
_skb
) \

195 
	`skb_g‘_debug
(
_skb
, 
__func__
, 
__LINE__
)

	)

196 
	#skb_cİy
(
_skb
, 
_´i
) \

197 
	`skb_cİy_debug
(
_skb
, 
_´i
, 
__func__
, 
__LINE__
)

	)

198 
	#dev_queue_xm™
(
_skb
) \

199 
	`dev_queue_xm™_debug
(
_skb
, 
__func__
, 
__LINE__
)

	)

	@ieee80211_var.h

35 #iâdeà
_NET80211_IEEE80211_VAR_H_


36 
	#_NET80211_IEEE80211_VAR_H_


	)

39 
	~<Ãt80211/›“80211_lšux.h
>

41 
	~<sys/queue.h
>

43 
	~<Ãt80211/_›“80211.h
>

44 
	~<Ãt80211/›“80211.h
>

45 
	~<Ãt80211/›“80211_üy±o.h
>

46 
	~<Ãt80211/›“80211_ioùl.h
>

47 
	~<Ãt80211/›“80211_pow”.h
>

48 
	~<Ãt80211/›“80211_´Ùo.h
>

49 
	~<Ãt80211/›“80211_sÿn.h
>

57 
	#IEEE80211_TXPOWER_MAX
 127

	)

58 
	#IEEE80211_TXPOWER_MIN
 0

	)

60 
	#IEEE80211_DTIM_MAX
 15

	)

61 
	#IEEE80211_DTIM_MIN
 1

	)

62 
	#IEEE80211_DTIM_DEFAULT
 1

	)

64 
	#IEEE80211_BINTVAL_MAX
 1000

	)

65 
	#IEEE80211_BINTVAL_MIN
 25

	)

66 
	#IEEE80211_BINTVAL_DEFAULT
 100

	)

67 
	#IEEE80211_BINTVAL_VALID
(
_bi
) \

68 ((
IEEE80211_BINTVAL_MIN
 <ğ(
_bi
)) && \

69 ((
_bi
è<ğ
IEEE80211_BINTVAL_MAX
))

	)

70 
	#IEEE80211_BINTVAL_SANITISE
(
_bi
) \

71 (
	`IEEE80211_BINTVAL_VALID
(
_bi
) ? \

72 (
_bi
è: 
IEEE80211_BINTVAL_DEFAULT
)

	)

74 
	#IEEE80211_BMISSTHRESH_BMIN
 2

	)

81 
	#IEEE80211_BMISSTHRESH_DEFAULT_MS
 850

	)

83 
	#IEEE80211_BMISSTHRESH_VALID
(
_bmt
) \

84 (
IEEE80211_BMISSTHRESH_BMIN
 <ğ(
_bmt
))

	)

85 
	#IEEE80211_BMISSTHRESH_SANITISE
(
_bmt
) \

86 ((
IEEE80211_BMISSTHRESH_BMIN
 > (
_bmt
)) ? \

87 
IEEE80211_BMISSTHRESH_BMIN
 : (
_bmt
))

	)

89 
	#IEEE80211_BGSCAN_INTVAL_MIN
 15

	)

90 
	#IEEE80211_BGSCAN_INTVAL_DEFAULT
 (5 * 60è

	)

92 
	#IEEE80211_BGSCAN_IDLE_MIN
 100

	)

93 
	#IEEE80211_BGSCAN_IDLE_DEFAULT
 250

	)

95 
	#IEEE80211_COVERAGE_CLASS_MAX
 31

	)

96 
	#IEEE80211_REGCLASSIDS_MAX
 10

	)

98 
	#IEEE80211_PS_SLEEP
 0x1

	)

99 
	#IEEE80211_PS_MAX_QUEUE
 50

	)

101 
	#IEEE80211_XR_BEACON_FACTOR
 3

	)

102 
	#IEEE80211_XR_DEFAULT_RATE_INDEX
 0

	)

103 
	#IEEE80211_XR_FRAG_THRESHOLD
 540

	)

105 
	#IEEE80211_FIXED_RATE_NONE
 -1

	)

107 
	#DEV_NAME
(
_d
) \

108 ((
NULL
 =ğ
_d
 || NULL =ğ_d->
Çme
 || 0 =ğ
	`¡ºcmp
(_d->name, "wifi%d", 6)) ? \

110 
_d
->
Çme
)

	)

111 
	#VAP_DEV_NAME
(
_v
) \

112 ((
NULL
 =ğ
_v
) ? \

114 
	`DEV_NAME
(
_v
->
iv_dev
))

	)

115 
	#SC_DEV_NAME
(
_sc
) \

116 ((
NULL
 =ğ
_sc
) ? \

118 
	`DEV_NAME
(
_sc
->
sc_dev
))

	)

119 
	#VAP_IC_DEV_NAME
(
_v
) \

120 ((
NULL
 =ğ
_v
 || NULL =ğ_v->
iv_ic
) ? \

122 
	`DEV_NAME
(
_v
->
iv_ic
->
ic_dev
))

	)

133 
	#IEEE80211_TSF_TO_TU
(
_tsf
è((
u_št32_t
)((_tsfè>> 10))

	)

134 
	#IEEE80211_MS_TO_TU
(
x
è(((xè* 1000è/ 1024)

	)

135 
	#IEEE80211_TU_TO_MS
(
x
è(((xè* 1024è/ 1000)

	)

136 
	#IEEE80211_TU_TO_JIFFIES
(
x
è((
	`IEEE80211_TU_TO_MS
(xè* 
HZ
è/ 1000)

	)

137 
	#IEEE80211_JIFFIES_TO_TU
(
x
è
	`IEEE80211_MS_TO_TU
((xè* 1000 / 
HZ
)

	)

139 
	#IEEE80211_APPIE_MAX
 1024

	)

141 
	#IEEE80211_PWRCONSTRAINT_VAL
(
ic
) \

142 (((
ic
)->
ic_bsschª
->
ic_max»gpow”
 > (ic)->
ic_curchªmaxpwr
) ? \

143 (
ic
)->
ic_bsschª
->
ic_max»gpow”
 - (ic)->
ic_curchªmaxpwr
 : 0)

	)

158 
	g›“80211com
;

159 
	g›“80211_´oc_’Œy
;

160 
	gvÏn_group
;

161 
	g—pŞcom
;

162 
	g›“80211_aş©Ü
;

164 
	s›“80211_n¥¬ams
 {

165 
›“80211_¡©e
 
	mÃw¡©e
;

166 
	m¬g
;

167 
	m»suÉ
;

170 
	#IW_MAX_SPY
 8

	)

171 
	s›“80211_¥y
 {

172 
u_št8_t
 
	mmac
[
IW_MAX_SPY
 * 
IEEE80211_ADDR_LEN
];

173 
u_št64_t
 
	mts_rssi
[
IW_MAX_SPY
];

174 
u_št8_t
 
	mthr_low
;

175 
u_št8_t
 
	mthr_high
;

176 
u_št8_t
 
	mnum
;

179 
	s›“80211_­p_›
 {

180 
u_št32_t
 
	mËngth
;

181 
›“80211_›
 *
	m›
;

184 
	s›“80211v­
 {

185 
Ãt_deviû
 *
	miv_dev
;

186 
Ãt_deviû_¡©s
 
	miv_dev¡©s
;

187 
ifmedŸ
 
	miv_medŸ
;

188 
iw_¡©i¡ics
 
	miv_iw¡©s
;

189 
ùl_bË_h—d”
 *
	miv_sysùl_h—d”
;

190 
ùl_bË
 *
	miv_sysùls
;

191 
´oc_dœ_’Œy
 *
	miv_´oc
;

192 
›“80211_´oc_’Œy
 *
	miv_´oc_’Œ›s
;

193 
vÏn_group
 *
	miv_vlg½
;

195 
TAILQ_ENTRY
(
›“80211v­
è
	miv_Ãxt
;

196 
›“80211com
 *
	miv_ic
;

197 
u_št32_t
 
	miv_debug
;

198 
›“80211_¡©s
 
	miv_¡©s
;

200 
	miv_mÚ™Ü_nods_Úly
;

201 
	miv_mÚ™Ü_txf_Ën
;

202 
	miv_mÚ™Ü_phy_”rÜs
;

203 
	miv_mÚ™Ü_üc_”rÜs
;

205 (*
	miv_Ãw¡©e
)(
	m›“80211v­
 *, 
	m›“80211_¡©e
, );

206 
u_št8_t
 
	miv_myaddr
[
IEEE80211_ADDR_LEN
];

207 
u_št32_t
 
	miv_æags
;

208 
u_št32_t
 
	miv_æags_ext
;

209 
u_št32_t
 
	miv_ÿps
;

210 
u_št8_t
 
	miv_©h_ÿp
;

211 
›“80211_İmode
 
	miv_İmode
;

212 
›“80211_¡©e
 
	miv_¡©e
;

213 
tim”_li¡
 
	miv_mgt£nd
;

215 
	miv_šaù_š™
;

216 
	miv_šaù_auth
;

217 
	miv_šaù_run
;

218 
	miv_šaù_´obe
;

220 
	miv_des_nssid
;

221 
›“80211_sÿn_ssid
 
	miv_des_ssid
[1];

222 
u_št8_t
 
	miv_des_bssid
[
IEEE80211_ADDR_LEN
];

223 
›“80211_chªÃl
 *
	miv_des_chª
;

224 
u_št16_t
 
	miv_des_mode
;

225 
	miv_nickÇm–’
;

226 
u_št8_t
 
	miv_nickÇme
[
IEEE80211_NWID_LEN
];

227 
u_št
 
	miv_bgsÿnidË
;

228 
u_št
 
	miv_bgsÿnštvl
;

229 
u_št
 
	miv_sÿnv®id
;

230 
›“80211_rßm
 
	miv_rßm
;

232 
	miv_c§_jiff›s
;

233 
u_št8_t
 
	miv_c§_couÁ
;

234 
›“80211_chªÃl
 *
	miv_c§_chª
;

235 
u_št8_t
 
	miv_c§_mode
;

236 
tim”_li¡
 
	miv_c§_tim”
;

237 
u_št32_t
 *
	miv_aid_b™m­
;

238 
u_št16_t
 
	miv_max_aid
;

239 
u_št16_t
 
	miv_¡a_assoc
;

240 
u_št16_t
 
	miv_ps_¡a
;

241 
u_št16_t
 
	miv_ps_³ndšg
;

242 
u_št8_t
 *
	miv_tim_b™m­
;

243 
u_št16_t
 
	miv_tim_Ën
;

244 
u_št8_t
 
	miv_dtim_³riod
;

245 
u_št8_t
 
	miv_dtim_couÁ
;

247 (*
	miv_£t_tim
)(
	m›“80211_node
 *, );

248 
u_št8_t
 
	miv_u­sdšfo
;

249 
›“80211_node
 *
	miv_bss
;

251 
u_št8_t
 
	miv_bssid
[
IEEE80211_ADDR_LEN
];

253 
	miv_fixed_¿‹
;

254 
u_št16_t
 
	miv_¹¡h»shŞd
;

255 
u_št16_t
 
	miv_äagth»shŞd
;

256 
u_št16_t
 
	miv_txmš
;

257 
u_št16_t
 
	miv_txmax
;

258 
u_št16_t
 
	miv_txliãtime
;

259 
	miv_šaù_tim”
;

260 *
	miv_İt_›
;

261 
u_št16_t
 
	miv_İt_›_Ën
;

262 
›“80211_keyix_t
 
	miv_def_txkey
;

263 
›“80211_key
 
	miv_nw_keys
[
IEEE80211_WEP_NKID
];

264 
›“80211_keyix_t
 (*
iv_key_®loc
)(
	m›“80211v­
 *, cÚ¡ 
	m›“80211_key
 *);

265 (*
	miv_key_d–‘e
)(
	m›“80211v­
 *, cÚ¡ 
	m›“80211_key
 *,

266 
	m›“80211_node
 *);

267 (*
	miv_key_£t
)(
	m›“80211v­
 *, cÚ¡ 
	m›“80211_key
 *,

268 cÚ¡ 
u_št8_t
 
	mmac
[
IEEE80211_ADDR_LEN
]);

269 (*
	miv_key_upd©e_begš
)(
	m›“80211v­
 *);

270 (*
	miv_key_upd©e_’d
)(
	m›“80211v­
 *);

271 #ifdeà
ATH_SUPERG_COMP


272 (*
	miv_comp_£t
)(
	m›“80211v­
 *, 
	m›“80211_node
 *, );

274 cÚ¡ 
›“80211_auth’tiÿtÜ
 *
	miv_auth
;

275 *
	miv_ec
;

276 
›“80211v­
 *
	miv_xrv­
;

277 
u_št16_t
 
	miv_xrbúwa™
;

278 
tim”_li¡
 
	miv_xrv­¡¬t
;

279 
u_št8_t
 
	miv_chªchªge_couÁ
;

280 
	miv_mÿ¡_¿‹
;

282 cÚ¡ 
›“80211_aş©Ü
 *
	miv_aş
;

283 *
	miv_as
;

285 
tim”_li¡
 
	miv_swbmiss
;

286 
u_št16_t
 
	miv_swbmiss_³riod
;

287 
›“80211_n¥¬ams
 
	miv_n¥¬ams
;

288 
IEEE80211_TQ_STRUCT
 
	miv_¡ajoš1tq
;

289 
	miv_nsdÚe
;

290 
ušt8_t
 
	mwds_mac
[
IEEE80211_ADDR_LEN
];

291 
›“80211_¥y
 
	miv_¥y
;

292 
›“80211_­p_›
 
	m­p_›
[
IEEE80211_APPIE_NUM_OF_FRAME
];

293 
u_št32_t
 
	m­p_f‹r
;

299 
	~<Ãt80211/›“80211_debug.h
>

300 
	~<Ãt80211/›“80211_node.h
>

301 
	~<Ãt80211/›“80211_skb.h
>

303 
	s›“80211com
 {

304 
Ãt_deviû
 *
	mic_dev
;

305 
›“80211com_lock_t
 
	mic_comlock
;

306 
›“80211com_lock_t
 
	mic_v­¦ock
;

307 
TAILQ_HEAD
(
›“80211v­_h—dty³
,

308 
›“80211v­
è
	mic_v­s
;

309 
›“80211_phyty³
 
	mic_phyty³
;

310 
›“80211_İmode
 
	mic_İmode
;

311 
ifmedŸ
 
	mic_medŸ
;

312 
u_št8_t
 
	mic_myaddr
[
IEEE80211_ADDR_LEN
];

313 
tim”_li¡
 
	mic_šaù
;

315 
u_št32_t
 
	mic_æags
;

316 
u_št32_t
 
	mic_æags_ext
;

317 
u_št32_t
 
	mic_ÿps
;

318 
u_št8_t
 
	mic_©h_ÿp
;

319 
u_št8_t
 
	mic_´omisc
;

320 
u_št8_t
 
	mic_®lmuÉi
;

321 
u_št8_t
 
	mic_nİ’ed
;

322 
›“80211_¿‹£t
 
	mic_sup_¿‹s
[
IEEE80211_MODE_MAX
];

323 
›“80211_¿‹£t
 
	mic_sup_xr_¿‹s
;

324 
›“80211_¿‹£t
 
	mic_sup_h®f_¿‹s
;

325 
›“80211_¿‹£t
 
	mic_sup_qu¬‹r_¿‹s
;

326 
u_št16_t
 
	mic_modeÿps
;

327 
u_št16_t
 
	mic_curmode
;

328 
u_št16_t
 
	mic_lštv®
;

329 
u_št16_t
 
	mic_hŞdov”
;

330 
u_št16_t
 
	mic_bmis¡h»shŞd
;

331 
	mic_bmiss_gu¬d
;

332 
u_št16_t
 
	mic_txpowlim™
;

333 
u_št16_t
 
	mic_Ãwtxpowlim™
;

334 
u_št16_t
 
	mic_u­sdmaxŒigg”s
;

335 
u_št8_t
 
	mic_cov”ageşass
;

353 
	mic_nchªs
;

354 
›“80211_chªÃl
 
	mic_chªÃls
[
IEEE80211_CHAN_MAX
+1];

355 
timev®
 
	mic_chª_nÚ_occupy
[
IEEE80211_CHAN_MAX
];

356 
u_št8_t
 
	mic_chª_ava
[
IEEE80211_CHAN_BYTES
];

357 
u_št8_t
 
	mic_chª_aùive
[
IEEE80211_CHAN_BYTES
];

358 
›“80211_chªÃl
 *
	mic_curchª
;

359 
›“80211_chªÃl
 *
	mic_bsschª
;

360 
št16_t
 
	mic_chªnoi£
;

361 
tim”_li¡
 
	mic_dfs_exş_tim”
;

389 
u_št16_t
 
	mic_chª_nodes
[
IEEE80211_CHAN_MAX
+1];

390 
u_št16_t
 
	mic_ú_tÙ®
;

391 
u_št16_t
 
	mic_sc_mšcom
;

392 
›“80211_sc_®gÜ™hm
 
	mic_sc_®gÜ™hm
;

393 
u_št16_t
 
	mic_sc_¦cg
;

394 
u_št16_t
 
	mic_sc_¦dg
;

395 
›“80211_›_sc
 
	mic_sc_›
;

398 
u_št
 
	mic_Äegşass
;

399 
u_št8_t
 
	mic_»gşassids
[
IEEE80211_REGCLASSIDS_MAX
];

402 
›“80211_sÿn_¡©e
 *
	mic_sÿn
;

403 
›“80211_rßmšgmode
 
	mic_rßmšg
;

404 
	mic_Ï¡d©a
;

405 
	mic_Ï¡sÿn
;

408 
›“80211_node_bË
 
	mic_¡a
;

411 
›“80211_wme_¡©e
 
	mic_wme
;

414 
›“80211_´Ùmode
 
	mic_´Ùmode
;

415 
	mic_rssi_ewma
;

416 
u_št16_t
 
	mic_nÚ”p¡a
;

417 
u_št16_t
 
	mic_lÚg¦Ù¡a
;

418 
u_št16_t
 
	mic_¡a_assoc
;

419 
u_št16_t
 
	mic_dt_¡a_assoc
;

420 
u_št16_t
 
	mic_xr_¡a_assoc
;

423 
u_št16_t
 
	mic_couÁry_code
;

424 
	mic_couÁry_outdoÜ
;

425 
›“80211_›_couÁry
 
	mic_couÁry_›
;

433 
u_št8_t
 
	mic_curchªmaxpwr
;

434 
u_št8_t
 
	mic_chªchªge_tb‰
;

435 
u_št8_t
 
	mic_chªchªge_chª
;

438 
	mic_debug
;

441 
©omic_t
 
	mic_node_couÁ”
;

443 
	m›“80211v­
 *(*
	mic_v­_ü—‹
)(
	m›“80211com
 *,

444 cÚ¡ *, , , 
	mÃt_deviû
 *);

445 (*
	mic_v­_d–‘e
)(
	m›“80211v­
 *);

448 (*
	mic_£nd_mgmt
)(
	m›“80211_node
 *, , );

449 (*
	mic_»cv_mgmt
)(
	m›“80211v­
 *, 
	m›“80211_node
 *,

450 
	msk_buff
 *, , , 
	mu_št64_t
);

453 (*
	mic_mgt¡¬t
)(
	m›“80211com
 *, 
	msk_buff
 *);

456 (*
	mic_š™
)(
	mÃt_deviû
 *);

457 (*
	mic_»£t
)(
	mÃt_deviû
 *);

460 (*
	mic_upd©e¦Ù
)(
	mÃt_deviû
 *);

463 (*
	mic_Ãwassoc
)(
	m›“80211_node
 *, );

466 
št32_t
 (*
ic_node_couÁ
)(
	m›“80211com
 *);

467 
	m›“80211_node
 *(*
	mic_node_®loc
)(
	m›“80211v­
 *);

468 (*
	mic_node_ş—nup
)(
	m›“80211_node
 *);

469 (*
	mic_node_ä“
)(
	m›“80211_node
 *);

471 
u_št8_t
 (*
ic_node_g‘rssi
)(cÚ¡ 
	m›“80211_node
 *);

472 
u_št8_t
 (*
ic_node_move_d©a
)(cÚ¡ 
	m›“80211_node
 *);

475 (*
	mic_sÿn_¡¬t
)(
	m›“80211com
 *);

476 (*
	mic_sÿn_’d
)(
	m›“80211com
 *);

477 (*
	mic_£t_chªÃl
)(
	m›“80211com
 *);

480 (*
	mic_u­sd_æush
)(
	m›“80211_node
 *);

483 (*
	mic_£t_txcÚt
)(
	m›“80211com
 *, );

484 (*
	mic_g‘_txcÚt
)(
	m›“80211com
 *);

485 (*
	mic_£t_txcÚt_pow”
)(
	m›“80211com
 *, 
	mu_št
);

486 (*
	mic_g‘_txcÚt_pow”
)(
	m›“80211com
 *);

487 (*
	mic_£t_txcÚt_¿‹
)(
	m›“80211com
 *, 
	mu_št
);

488 
u_št
 (*
ic_g‘_txcÚt_¿‹
)(
	m›“80211com
 *);

492 (*
	mic_£t_dfs_‹¡mode
)(
	m›“80211com
 *, );

493 (*
	mic_g‘_dfs_‹¡mode
)(
	m›“80211com
 *);

496 (*
	mic_‹¡_¿d¬
)(
	m›“80211com
 *);

499 (*
	mic_dump_h®_m­
)(
	m›“80211com
 *);

502 (*
	mic_£t_dfs_ÿc_time
)(
	m›“80211com
 *, );

503 (*
	mic_g‘_dfs_ÿc_time
)(
	m›“80211com
 *);

506 (*
	mic_£t_dfs_exş_³riod
)(
	m›“80211com
 *, );

507 (*
	mic_g‘_dfs_exş_³riod
)(
	m›“80211com
 *);

510 (*
	mic_£t_cov”ageşass
)(
	m›“80211com
 *);

513 
u_št
 (*
ic_mhz2›“
)(
	m›“80211com
 *, 
	mu_št
, u_int);

515 #ifdeà
ATH_REVERSE_ENGINEERING


517 (*
	mic_»gi¡”s_dump
)(
	m›“80211com
 *);

518 (*
	mic_»gi¡”s_m¬k
)(
	m›“80211com
 *);

519 (*
	mic_»gi¡”s_dump_d–
)(
	m›“80211com
 *);

520 (*
	mic_wr™e_»gi¡”
)(
	m›“80211com
 *, , );

521 (*
	mic_»ad_»gi¡”
)(
	m›“80211com
 *, , *);

523 (*
	mic_debug_©h_iw´iv
)(
	m›“80211com
 *, 
	m·¿m
, 
	mv®ue
);

526 
	#MAX_PROC_IEEE80211_SIZE
 16383

	)

527 
	#PROC_IEEE80211_PERM
 0644

	)

529 
	s´oc_›“80211_´iv
 {

530 
	m¾’
;

531 
	mmax_¾’
;

532 *
	mrbuf
;

534 
	mwËn
;

535 
	mmax_wËn
;

536 *
	mwbuf
;

539 
	s›“80211_´oc_’Œy
 {

540 *
	mÇme
;

541 
fe_İ”©iÚs
 *
	mfeİs
;

542 
´oc_dœ_’Œy
 *
	m’Œy
;

543 
›“80211_´oc_’Œy
 *
	mÃxt
;

546 
MALLOC_DECLARE
(
M_80211_VAP
);

548 
	#IEEE80211_ADDR_NULL
(
a1
è(
	`memcmp
(a1, "\x00\x00\x00\x00\x00\x00", \

549 
IEEE80211_ADDR_LEN
è=ğ0)

	)

550 
	#IEEE80211_ADDR_EQ
(
a1
, 
a2
è(
	`memcmp
×1,‡2, 
IEEE80211_ADDR_LEN
è=ğ0)

	)

551 
	#IEEE80211_ADDR_COPY
(
d¡
, 
¤c
è
	`memıy
(d¡, src, 
IEEE80211_ADDR_LEN
)

	)

552 
	#IEEE80211_ADDR_SET_NULL
(
d¡
è
	`mem£t
(d¡, 0, 
IEEE80211_ADDR_LEN
)

	)

555 
	#IEEE80211_F_FF
 0x00000001

	)

556 
	#IEEE80211_F_TURBOP
 0x00000002

	)

557 
	#IEEE80211_F_PROMISC
 0x00000004

	)

558 
	#IEEE80211_F_ALLMULTI
 0x00000008

	)

560 
	#IEEE80211_F_PRIVACY
 0x00000010

	)

561 
	#IEEE80211_F_PUREG
 0x00000020

	)

562 
	#IEEE80211_F_XRUPDATE
 0x00000040

	)

563 
	#IEEE80211_F_SCAN
 0x00000080

	)

564 
	#IEEE80211_F_XR
 0x00000100

	)

565 
	#IEEE80211_F_SIBSS
 0x00000200

	)

567 
	#IEEE80211_F_SHSLOT
 0x00000400

	)

568 
	#IEEE80211_F_PMGTON
 0x00000800

	)

569 
	#IEEE80211_F_DESBSSID
 0x00001000

	)

570 
	#IEEE80211_F_WME
 0x00002000

	)

571 
	#IEEE80211_F_BGSCAN
 0x00004000

	)

572 
	#IEEE80211_F_SWRETRY
 0x00008000

	)

573 
	#IEEE80211_F_TXPOW_FIXED
 0x00010000

	)

574 
	#IEEE80211_F_IBSSON
 0x00020000

	)

575 
	#IEEE80211_F_SHPREAMBLE
 0x00040000

	)

576 
	#IEEE80211_F_DATAPAD
 0x00080000

	)

577 
	#IEEE80211_F_USEPROT
 0x00100000

	)

578 
	#IEEE80211_F_USEBARKER
 0x00200000

	)

579 
	#IEEE80211_F_TIMUPDATE
 0x00400000

	)

580 
	#IEEE80211_F_WPA1
 0x00800000

	)

581 
	#IEEE80211_F_WPA2
 0x01000000

	)

582 
	#IEEE80211_F_WPA
 0x01800000

	)

583 
	#IEEE80211_F_DROPUNENC
 0x02000000

	)

584 
	#IEEE80211_F_COUNTERM
 0x04000000

	)

585 
	#IEEE80211_F_HIDESSID
 0x08000000

	)

586 
	#IEEE80211_F_NOBRIDGE
 0x10000000

	)

588 
	#IEEE80211_F_WMEUPDATE
 0x20000000

	)

589 
	#IEEE80211_F_DOTH
 0x40000000

	)

590 
	#IEEE80211_F_CHANSWITCH
 0x80000000

	)

593 
	#IEEE80211_FEXT_WDS
 0x00000001

	)

594 
	#IEEE80211_FEXT_COUNTRYIE
 0x00000002

	)

595 
	#IEEE80211_FEXT_SCAN_PENDING
 0x00000004

	)

596 
	#IEEE80211_FEXT_BGSCAN
 0x00000008

	)

597 
	#IEEE80211_FEXT_UAPSD
 0x00000010

	)

598 
	#IEEE80211_FEXT_SLEEP
 0x00000020

	)

599 
	#IEEE80211_FEXT_EOSPDROP
 0x00000040

	)

600 
	#IEEE80211_FEXT_MARKDFS
 0x00000080

	)

601 
	#IEEE80211_FEXT_REGCLASS
 0x00000100

	)

602 
	#IEEE80211_FEXT_ERPUPDATE
 0x00000200

	)

603 
	#IEEE80211_FEXT_SWBMISS
 0x00000400

	)

604 
	#IEEE80211_FEXT_DROPUNENC_EAPOL
 0x00000800

	)

605 
	#IEEE80211_FEXT_APPIE_UPDATE
 0x00001000

	)

607 
	#IEEE80211_COM_UAPSD_ENABLE
(
_ic
è((_ic)->
ic_æags_ext
 |ğ
IEEE80211_FEXT_UAPSD
)

	)

608 
	#IEEE80211_COM_UAPSD_DISABLE
(
_ic
è((_ic)->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_UAPSD
)

	)

609 
	#IEEE80211_COM_UAPSD_ENABLED
(
_ic
è((_ic)->
ic_æags_ext
 & 
IEEE80211_FEXT_UAPSD
)

	)

610 
	#IEEE80211_COM_GOTOSLEEP
(
_ic
è((_ic)->
ic_æags_ext
 |ğ
IEEE80211_FEXT_GOTOSLEEP
)

	)

611 
	#IEEE80211_COM_WAKEUP
(
_ic
è((_ic)->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_SLEEP
)

	)

612 
	#IEEE80211_COM_IS_SLEEPING
(
_ic
è((_ic)->
ic_æags_ext
 & 
IEEE80211_FEXT_SLEEP
)

	)

614 
	#IEEE80211_VAP_UAPSD_ENABLE
(
_v
è((_v)->
iv_æags_ext
 |ğ
IEEE80211_FEXT_UAPSD
)

	)

615 
	#IEEE80211_VAP_UAPSD_DISABLE
(
_v
è((_v)->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_UAPSD
)

	)

616 
	#IEEE80211_VAP_UAPSD_ENABLED
(
_v
è((_v)->
iv_æags_ext
 & 
IEEE80211_FEXT_UAPSD
)

	)

617 
	#IEEE80211_VAP_GOTOSLEEP
(
_v
è((_v)->
iv_æags_ext
 |ğ
IEEE80211_FEXT_SLEEP
)

	)

618 
	#IEEE80211_VAP_WAKEUP
(
_v
è((_v)->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_SLEEP
)

	)

619 
	#IEEE80211_VAP_IS_SLEEPING
(
_v
è((_v)->
iv_æags_ext
 & 
IEEE80211_FEXT_SLEEP
)

	)

620 
	#IEEE80211_VAP_EOSPDROP_ENABLE
(
_v
è((_v)->
iv_æags_ext
 |ğ
IEEE80211_FEXT_EOSPDROP
)

	)

621 
	#IEEE80211_VAP_EOSPDROP_DISABLE
(
_v
è((_v)->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_EOSPDROP
)

	)

622 
	#IEEE80211_VAP_EOSPDROP_ENABLED
(
_v
è((_v)->
iv_æags_ext
 & 
IEEE80211_FEXT_EOSPDROP
)

	)

623 
	#IEEE80211_VAP_DROPUNENC_EAPOL_ENABLE
(
_v
) \

624 ((
_v
)->
iv_æags_ext
 |ğ
IEEE80211_FEXT_DROPUNENC_EAPOL
)

	)

625 
	#IEEE80211_VAP_DROPUNENC_EAPOL_DISABLE
(
_v
) \

626 ((
_v
)->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_DROPUNENC_EAPOL
)

	)

627 
	#IEEE80211_VAP_DROPUNENC_EAPOL
(
_v
è((_v)->
iv_æags_ext
 & 
IEEE80211_FEXT_DROPUNENC_EAPOL
)

	)

631 
	#IEEE80211_C_WEP
 0x00000001

	)

632 
	#IEEE80211_C_TKIP
 0x00000002

	)

633 
	#IEEE80211_C_AES
 0x00000004

	)

634 
	#IEEE80211_C_AES_CCM
 0x00000008

	)

635 
	#IEEE80211_C_CKIP
 0x00000020

	)

636 
	#IEEE80211_C_FF
 0x00000040

	)

637 
	#IEEE80211_C_TURBOP
 0x00000080

	)

638 
	#IEEE80211_C_IBSS
 0x00000100

	)

639 
	#IEEE80211_C_PMGT
 0x00000200

	)

640 
	#IEEE80211_C_HOSTAP
 0x00000400

	)

641 
	#IEEE80211_C_AHDEMO
 0x00000800

	)

642 
	#IEEE80211_C_SWRETRY
 0x00001000

	)

643 
	#IEEE80211_C_TXPMGT
 0x00002000

	)

644 
	#IEEE80211_C_SHSLOT
 0x00004000

	)

645 
	#IEEE80211_C_SHPREAMBLE
 0x00008000

	)

646 
	#IEEE80211_C_MONITOR
 0x00010000

	)

647 
	#IEEE80211_C_TKIPMIC
 0x00020000

	)

648 
	#IEEE80211_C_WPA1
 0x00800000

	)

649 
	#IEEE80211_C_WPA2
 0x01000000

	)

650 
	#IEEE80211_C_WPA
 0x01800000

	)

651 
	#IEEE80211_C_BURST
 0x02000000

	)

652 
	#IEEE80211_C_WME
 0x04000000

	)

653 
	#IEEE80211_C_WDS
 0x08000000

	)

654 
	#IEEE80211_C_WME_TKIPMIC
 0x10000000

	)

655 
	#IEEE80211_C_BGSCAN
 0x20000000

	)

656 
	#IEEE80211_C_UAPSD
 0x40000000

	)

659 
	#IEEE80211_C_CRYPTO
 0x0000002à

	)

662 
	#IEEE80211_ABOLT_TURBO_G
 0x01

	)

663 
	#IEEE80211_ABOLT_TURBO_PRIME
 0x02

	)

664 
	#IEEE80211_ABOLT_COMPRESSION
 0x04

	)

665 
	#IEEE80211_ABOLT_FAST_FRAME
 0x08

	)

666 
	#IEEE80211_ABOLT_BURST
 0x10

	)

667 
	#IEEE80211_ABOLT_WME_ELE
 0x20

	)

668 
	#IEEE80211_ABOLT_XR
 0x40

	)

669 
	#IEEE80211_ABOLT_AR
 0x80

	)

672 
	#IEEE80211_ABOLT_ADVCAP
 (
IEEE80211_ABOLT_TURBO_PRIME
 | \

673 
IEEE80211_ABOLT_COMPRESSION
 | \

674 
IEEE80211_ABOLT_FAST_FRAME
 | \

675 
IEEE80211_ABOLT_XR
 | \

676 
IEEE80211_ABOLT_AR
 | \

677 
IEEE80211_ABOLT_BURST
 | \

678 
IEEE80211_ABOLT_WME_ELE
)

	)

681 
	#IEEE80211_ATH_CAP
(
v­
, 
ni
, 
b™
) \

682 ((
ni
)->
ni_©h_æags
 & (
v­
)->
iv_©h_ÿp
 & (
b™
))

	)

685 
	#IEEE80211_VAP_XR
 0x10000

	)

687 
›“80211_iç‰ach
(
›“80211com
 *);

688 
›“80211_ifd‘ach
(
›“80211com
 *);

689 
›“80211_v­_£tup
(
›“80211com
 *, 
Ãt_deviû
 *,

691 
›“80211_v­_©ch
(
›“80211v­
 *, 
ifm_chªge_cb_t
, 
ifm_¡©_cb_t
);

692 
›“80211_v­_d‘ach
(
›“80211v­
 *);

693 
›“80211_m¬k_dfs
(
›“80211com
 *, 
›“80211_chªÃl
 *);

694 
›“80211_ªnounû
(
›“80211com
 *);

695 
›“80211_ªnounû_chªÃls
(
›“80211com
 *);

696 
›“80211_medŸ_chªge
(
Ãt_deviû
 *);

697 
›“80211_medŸ_¡©us
(
Ãt_deviû
 *, 
ifmedŸ»q
 *);

698 
›“80211_¿‹2medŸ
(
›“80211com
*, , 
›“80211_phymode
);

699 
›“80211_medŸ2¿‹
();

700 
u_št
 
›“80211_mhz2›“
(u_int, u_int);

701 
u_št
 
›“80211_chª2›“
(
›“80211com
 *, cÚ¡ 
›“80211_chªÃl
 *);

702 
u_št
 
›“80211_›“2mhz
(u_int, u_int);

703 
›“80211_chªÃl
 *
›“80211_fšd_chªÃl
(
›“80211com
 *, , );

704 
›“80211_£tmode
(
›“80211com
 *, 
›“80211_phymode
);

705 
›“80211_»£t_”p
(
›“80211com
 *, 
›“80211_phymode
);

706 
›“80211_phymode
 
›“80211_chª2mode
(cÚ¡ 
›“80211_chªÃl
 *);

707 
›“80211_bud_couÁry›
(
›“80211com
 *);

708 
›“80211_medŸ_£tup
(
›“80211com
 *, 
ifmedŸ
 *, 
u_št32_t
,

709 
ifm_chªge_cb_t
, 
ifm_¡©_cb_t
);

710 
›“80211_bud_sc_›
(
›“80211com
 *);

711 
›“80211_dfs_aùiÚ
(
›“80211com
 *);

712 
›“80211_expœe_chªÃl_exş_»¡riùiÚs
(
›“80211com
 *);

721 
	#CHANNEL_FOREACH
(
_chª
, 
_ic
, 
_i
, 
_´evchª
) \

722 (
_i
èğ0, (
_´evchª
) = 0; \

723 (
_i
è< (
_ic
)->
ic_nchªs
 && ((
_chª
) = \

724 (
_ic
)->
ic_chªÃls
[(
_i
)].
ic_›“
); \

725 (
_´evchª
èğ(
_chª
), (
_i
)++ \

726 èià((
_chª
è!ğ(
_´evchª
))

	)

729 
__šlše
 

730 
	$›“80211_key_upd©e_begš
(
›“80211v­
 *
v­
)

732 
v­
->
	`iv_key_upd©e_begš
(vap);

733 
	}
}

734 
__šlše
 

735 
	$›“80211_key_upd©e_’d
(
›“80211v­
 *
v­
)

737 
v­
->
	`iv_key_upd©e_’d
(vap);

738 
	}
}

747 
__šlše
 

748 
	$›“80211_hdr¥aû
(
›“80211com
 *
ic
, cÚ¡ *
d©a
)

750 
size
 = 
	`›“80211_hdrsize
(
d©a
);

751 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DATAPAD
)

752 
size
 = 
	`roundup
(size, (
u_št32_t
));

753  
size
;

754 
	}
}

757 
__šlše
 

758 
	$›“80211_ªyhdr¥aû
(
›“80211com
 *
ic
, cÚ¡ *
d©a
)

760 
size
 = 
	`›“80211_ªyhdrsize
(
d©a
);

761 ià(
ic
->
ic_æags
 & 
IEEE80211_F_DATAPAD
)

762 
size
 = 
	`roundup
(size, (
u_št32_t
));

763  
size
;

764 
	}
}

768 
	#MAC_FMT
 "%02x:%02x:%02x:%02x:%02x:%02x"

	)

769 
	#MAC_ADDR
(
addr
) \

770 ((*)(
addr
)) [0], \

771 ((*)(
addr
)) [1], \

772 ((*)(
addr
)) [2], \

773 ((*)(
addr
)) [3], \

774 ((*)(
addr
)) [4], \

775 ((*)(
addr
)è[5]

	)

	@ieee80211_wireless.c

42 #iâdeà
AUTOCONF_INCLUDED


43 
	~<lšux/cÚfig.h
>

46 
	~<lšux/v”siÚ.h
>

47 
	~<lšux/moduË.h
>

48 
	~<lšux/Ãtdeviû.h
>

49 
	~<lšux/ut¢ame.h
>

50 
	~<lšux/if_¬p.h
>

51 
	~<lšux/d–ay.h
>

53 
	~<lšux/wœ–ess.h
>

54 
	~<Ãt/iw_hªdËr.h
>

56 #ià
WIRELESS_EXT
 < 15

60 
	~<asm/uacûss.h
>

62 
	~<Ãt80211/if_medŸ.h
>

63 
	~<Ãt80211/if_©h´Ùo.h
>

65 
	~<Ãt80211/›“80211_v¬.h
>

66 
	~<Ãt80211/›“80211_lšux.h
>

67 
	~"ah.h
"

69 
	#IS_UP
(
_dev
) \

70 (((
_dev
)->
æags
 & (
IFF_RUNNING
|
IFF_UP
)è=ğ(IFF_RUNNING|IFF_UP))

	)

71 
	#IS_UP_AUTO
(
_v­
) \

72 (
	`IS_UP
((
_v­
)->
iv_dev
) && \

73 (
_v­
)->
iv_ic
->
ic_rßmšg
 =ğ
IEEE80211_ROAMING_AUTO
)

	)

74 
	#RESCAN
 1

	)

77 
´e_ªnounûd_chªsw™ch
(
Ãt_deviû
 *
dev
, 
u_št32_t
 
chªÃl
, u_št32_ˆ
tb‰
);

80 
	$´“m±_sÿn
(
Ãt_deviû
 *
dev
, 
max_g¿û
, 
max_wa™
)

82 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

83 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

84 
tÙ®_d–ay
 = 0;

85 
ÿnûËd
 = 0, 
»ady
 = 0;

87 !
»ady
 && 
tÙ®_d–ay
 < 
max_g¿û
 + 
max_wa™
) {

88 ià((
ic
->
ic_æags
 & 
IEEE80211_F_SCAN
) == 0) {

89 
»ady
 = 1;

91 ià(!
ÿnûËd
 && (
tÙ®_d–ay
 > 
max_g¿û
)) {

95 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

96 "%s: cªûÈ³ndšg sÿÀ»que¡\n", 
__func__
);

97 (è
	`›“80211_ÿnûl_sÿn
(
v­
);

98 
ÿnûËd
 = 1;

100 
	`md–ay
 (1);

101 
tÙ®_d–ay
 += 1;

105 ià(!
»ady
) {

106 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

108 
__func__
);

111  
»ady
;

112 
	}
}

114 
iw_¡©i¡ics
 *

115 
	$›“80211_iw_g‘¡©s
(
Ãt_deviû
 *
dev
)

117 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

118 
iw_¡©i¡ics
 *
is
 = &
v­
->
iv_iw¡©s
;

119 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

121 
	`£t_qu®™y
(&
is
->
qu®
, 
	`›“80211_g‘rssi
(
v­
->
iv_ic
),

122 
ic
->
ic_chªnoi£
);

123 
is
->
¡©us
 = 
v­
->
iv_¡©e
;

124 
is
->
disÿrd
.
nwid
 = 
v­
->
iv_¡©s
.
is_rx_wrÚgbss
 +

125 
v­
->
iv_¡©s
.
is_rx_ssidmism©ch
;

126 
is
->
disÿrd
.
code
 = 
v­
->
iv_¡©s
.
is_rx_w•ç
 +

127 
v­
->
iv_¡©s
.
is_rx_deüy±üc
;

128 
is
->
disÿrd
.
äagm’t
 = 0;

129 
is
->
disÿrd
.
»Œ›s
 = 0;

130 
is
->
disÿrd
.
misc
 = 0;

132 
is
->
miss
.
b—cÚ
 = 0;

134  
is
;

135 
	}
}

138 
	$›“80211_ioùl_giwÇme
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

139 *
Çme
, *
exŒa
)

141 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

142 
›“80211_chªÃl
 *
c
 = 
v­
->
iv_ic
->
ic_curchª
;

144 ià(
	`IEEE80211_IS_CHAN_108G
(
c
))

145 
	`¡ºıy
(
Çme
, "IEEE 802.11Tg", 
IFNAMSIZ
);

146 ià(
	`IEEE80211_IS_CHAN_108A
(
c
))

147 
	`¡ºıy
(
Çme
, "IEEE 802.11Ta", 
IFNAMSIZ
);

148 ià(
	`IEEE80211_IS_CHAN_TURBO
(
c
))

149 
	`¡ºıy
(
Çme
, "IEEE 802.11T", 
IFNAMSIZ
);

150 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
))

151 
	`¡ºıy
(
Çme
, "IEEE 802.11g", 
IFNAMSIZ
);

152 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

153 
	`¡ºıy
(
Çme
, "IEEE 802.11a", 
IFNAMSIZ
);

154 ià(
	`IEEE80211_IS_CHAN_B
(
c
))

155 
	`¡ºıy
(
Çme
, "IEEE 802.11b", 
IFNAMSIZ
);

157 
	`¡ºıy
(
Çme
, "IEEE 802.11", 
IFNAMSIZ
);

160 
	}
}

169 
	$g‘iwkeyix
(
›“80211v­
 *
v­
, cÚ¡ 
iw_pošt
 *
”q
, 
›“80211_keyix_t
 *
rkix
)

171 
›“80211_keyix_t
 
kix
;

173 
kix
 = 
”q
->
æags
 & 
IW_ENCODE_INDEX
;

174 ià((
”q
->
æags
 & 
IW_ENCODE_INDEX
è=ğ(
u_št8_t
)
IEEE80211_KEYIX_NONE
)

175 
kix
 = 
IEEE80211_KEYIX_NONE
;

176 ià(
kix
 < 1 || kix > 
IEEE80211_WEP_NKID
) {

177 
kix
 = 
v­
->
iv_def_txkey
;

178 ià(
kix
 =ğ
IEEE80211_KEYIX_NONE
)

179 
kix
 = 0;

181 --
kix
;

182 ià(
kix
 < 
IEEE80211_WEP_NKID
) {

183 *
rkix
 = 
kix
;

186  -
EINVAL
;

187 
	}
}

190 
	$›“80211_ioùl_siw’code
(
Ãt_deviû
 *
dev
,

191 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
”q
, *
keybuf
)

193 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

194 
”rÜ
;

195 
w•chªge
 = 0;

196 
›“80211_keyix_t
 
kix
;

198 ià((
”q
->
æags
 & 
IW_ENCODE_DISABLED
) == 0) {

200 ià(!
	`›“80211_üy±o_avaabË
(
v­
, 
IEEE80211_CIPHER_WEP
))

201  -
EOPNOTSUPP
;

207 
”rÜ
 = 
	`g‘iwkeyix
(
v­
, 
”q
, &
kix
);

208 ià(
”rÜ
 < 0)

209  
”rÜ
;

210 ià(
”q
->
Ëngth
 > 
IEEE80211_KEYBUF_SIZE
)

211  -
E2BIG
;

213 
	`›“80211_key_upd©e_begš
(
v­
);

214 ià(
”q
->
Ëngth
 > 0) {

215 
›“80211_key
 *
k
 = &
v­
->
iv_nw_keys
[
kix
];

221 
k
->
wk_keyix
 = 
kix
;

222 ià(
	`›“80211_üy±o_Ãwkey
(
v­
, 
IEEE80211_CIPHER_WEP
,

223 
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
, 
k
)) {

224 
k
->
wk_keyËn
 = 
”q
->
Ëngth
;

225 
	`memıy
(
k
->
wk_key
, 
keybuf
, 
”q
->
Ëngth
);

226 
	`mem£t
(
k
->
wk_key
 + 
”q
->
Ëngth
, 0,

227 
IEEE80211_KEYBUF_SIZE
 - 
”q
->
Ëngth
);

228 ià(!
	`›“80211_üy±o_£tkey
(
v­
, 
k
, v­->
iv_myaddr
, 
NULL
))

229 
”rÜ
 = -
EINVAL
;

231 
”rÜ
 = -
EINVAL
;

238 ià(
v­
->
iv_nw_keys
[
kix
].
wk_keyËn
 == 0)

239 
”rÜ
 = -
EINVAL
;

241 ià(
”rÜ
 == 0) {

249 ià(
”q
->
Ëngth
 == 0 ||

250 (
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0)

251 
v­
->
iv_def_txkey
 = 
kix
;

252 
w•chªge
 = (
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0;

253 
v­
->
iv_æags
 |ğ
IEEE80211_F_PRIVACY
;

255 
	`›“80211_key_upd©e_’d
(
v­
);

257 ià((
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) == 0)

259 
v­
->
iv_æags
 &ğ~
IEEE80211_F_PRIVACY
;

260 
w•chªge
 = 1;

261 
”rÜ
 = 0;

263 ià(
”rÜ
 == 0) {

265 ià((
”q
->
æags
 & 
IW_ENCODE_OPEN
) &&

266 (!(
”q
->
æags
 & 
IW_ENCODE_RESTRICTED
))) {

267 
v­
->
iv_æags
 &ğ~
IEEE80211_F_DROPUNENC
;

268 } ià(!(
”q
->
æags
 & 
IW_ENCODE_OPEN
) &&

269 (
”q
->
æags
 & 
IW_ENCODE_RESTRICTED
)) {

270 
v­
->
iv_æags
 |ğ
IEEE80211_F_DROPUNENC
;

273 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
)

274 
v­
->
iv_æags
 |ğ
IEEE80211_F_DROPUNENC
;

276 
v­
->
iv_æags
 &ğ~
IEEE80211_F_DROPUNENC
;

279 ià((
”rÜ
 =ğ0è&& 
	`IS_UP
(
v­
->
iv_dev
)) {

287 ià(
w•chªge
 && 
	`IS_UP_AUTO
(
v­
))

288 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

290 #ifdeà
ATH_SUPERG_XR


292 ià(!
”rÜ
 && 
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
))

293 
	`›“80211_ioùl_siw’code
(
v­
->
iv_xrv­
->
iv_dev
, 
šfo
, 
”q
, 
keybuf
);

295  
”rÜ
;

296 
	}
}

299 
	$›“80211_ioùl_giw’code
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

300 
iw_pošt
 *
”q
, *
key
)

302 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

303 
›“80211_key
 *
k
;

304 
”rÜ
;

305 
›“80211_keyix_t
 
kix
;

307 ià(
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) {

308 
”rÜ
 = 
	`g‘iwkeyix
(
v­
, 
”q
, &
kix
);

309 ià(
”rÜ
 < 0)

310  
”rÜ
;

311 
k
 = &
v­
->
iv_nw_keys
[
kix
];

314 
”q
->
æags
 = 
kix
 + 1;

315 ià(
”q
->
Ëngth
 > 
k
->
wk_keyËn
)

316 
”q
->
Ëngth
 = 
k
->
wk_keyËn
;

317 
	`memıy
(
key
, 
k
->
wk_key
, 
”q
->
Ëngth
);

318 
”q
->
æags
 |ğ
IW_ENCODE_ENABLED
;

320 
”q
->
Ëngth
 = 0;

321 
”q
->
æags
 = 
IW_ENCODE_DISABLED
;

323 ià(
v­
->
iv_æags
 & 
IEEE80211_F_DROPUNENC
)

324 
”q
->
æags
 |ğ
IW_ENCODE_RESTRICTED
;

326 
”q
->
æags
 |ğ
IW_ENCODE_OPEN
;

328 
	}
}

330 #iâdeà
iä_medŸ


331 
	#iä_medŸ
 
iä_iäu
.
iäu_iv®ue


	)

335 
	$›“80211_ioùl_siw¿‹
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

336 
iw_·¿m
 *
¼q
, *
exŒa
)

338 cÚ¡ 
u_št
 
mİts
[] = {

339 
IFM_AUTO
,

340 
IFM_IEEE80211_11A
,

341 
IFM_IEEE80211_11B
,

342 
IFM_IEEE80211_11G
,

343 
IFM_IEEE80211_FH
,

344 
IFM_IEEE80211_11A
 | 
IFM_IEEE80211_TURBO
,

345 
IFM_IEEE80211_11G
 | 
IFM_IEEE80211_TURBO
,

347 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

348 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

349 
iäeq
 
iä
;

350 
¿‹
, 
»tv
;

352 ià(
v­
->
iv_medŸ
.
ifm_cur
 =ğ
NULL
)

353  -
EINVAL
;

354 
	`mem£t
(&
iä
, 0, (ifr));

355 
iä
.
iä_medŸ
 = 
v­
->
iv_medŸ
.
ifm_cur
->
ifm_medŸ
 &~ (
IFM_MMASK
|
IFM_TMASK
);

356 
iä
.
iä_medŸ
 |ğ
mİts
[
v­
->
iv_des_mode
];

357 ià(
¼q
->
fixed
) {

359 
¿‹
 = 
	`›“80211_¿‹2medŸ
(
ic
, 2 * 
¼q
->
v®ue
 / 1000000,

360 
v­
->
iv_des_mode
);

361 ià(
¿‹
 =ğ
IFM_AUTO
)

362  -
EINVAL
;

364 
¿‹
 = 
IFM_AUTO
;

365 
iä
.
iä_medŸ
 |ğ
	`IFM_SUBTYPE
(
¿‹
);

368 
	`ifmedŸ_»mov—Î
(&
v­
->
iv_medŸ
);

369 (è
	`›“80211_medŸ_£tup
(
ic
, &
v­
->
iv_medŸ
,

370 
v­
->
iv_ÿps
, v­->
iv_medŸ
.
ifm_chªge
, v­->iv_medŸ.
ifm_¡©us
);

372 
»tv
 = 
	`ifmedŸ_ioùl
(
v­
->
iv_dev
, &
iä
, &v­->
iv_medŸ
, 
SIOCSIFMEDIA
);

373 ià(
»tv
 =ğ-
ENETRESET
)

374 
»tv
 = 
	`IS_UP_AUTO
(
v­
è? 
	`›“80211_İ’
(v­->
iv_dev
) : 0;

375 ià(
»tv
)

376 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
, "%s„eturns %d\n",

377 
__func__
, 
»tv
);

378  
»tv
;

379 
	}
}

382 
	$›“80211_ioùl_giw¿‹
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

383 
iw_·¿m
 *
¼q
, *
exŒa
)

385 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

386 
ifmedŸ»q
 
imr
;

387 
¿‹
;

389 
	`mem£t
(&
imr
, 0, (imr));

390 
v­
->
iv_medŸ
.
	`ifm_¡©us
(v­->
iv_dev
, &
imr
);

392 
¼q
->
fixed
 = 
	`IFM_SUBTYPE
(
v­
->
iv_medŸ
.
ifm_medŸ
è!ğ
IFM_AUTO
;

394 
¿‹
 = 
	`›“80211_medŸ2¿‹
(
imr
.
ifm_aùive
);

395 ià(
¿‹
 == -1)

396 
¿‹
 = 0;

397 
¼q
->
v®ue
 = 1000000 * (
¿‹
 / 2);

400 
	}
}

403 
	$›“80211_ioùl_siw£ns
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

404 
iw_·¿m
 *
£ns
, *
exŒa
)

406  -
EOPNOTSUPP
;

407 
	}
}

410 
	$›“80211_ioùl_giw£ns
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

411 
iw_·¿m
 *
£ns
, *
exŒa
)

413 
£ns
->
v®ue
 = 1;

414 
£ns
->
fixed
 = 1;

417 
	}
}

420 
	$›“80211_ioùl_siw¹s
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

421 
iw_·¿m
 *
¹s
, *
exŒa
)

423 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

424 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

425 
u16
 
v®
;

427 ià(
¹s
->
di§bËd
)

428 
v®
 = 
IEEE80211_RTS_MAX
;

429 ià((
IEEE80211_RTS_MIN
 <ğ
¹s
->
v®ue
) &&

430 (
¹s
->
v®ue
 <ğ
IEEE80211_RTS_MAX
))

431 
v®
 = 
¹s
->
v®ue
;

433  -
EINVAL
;

434 ià(
v®
 !ğ
v­
->
iv_¹¡h»shŞd
) {

435 
v­
->
iv_¹¡h»shŞd
 = 
v®
;

436 ià(
	`IS_UP
(
v­
->
iv_dev
))

437  
ic
->
	`ic_»£t
(ic->
ic_dev
);

440 
	}
}

443 
	$›“80211_ioùl_giw¹s
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

444 
iw_·¿m
 *
¹s
, *
exŒa
)

446 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

448 
¹s
->
v®ue
 = 
v­
->
iv_¹¡h»shŞd
;

449 
¹s
->
di§bËd
 = (¹s->
v®ue
 =ğ
IEEE80211_RTS_MAX
);

450 
¹s
->
fixed
 = 1;

453 
	}
}

456 
	$›“80211_ioùl_siwäag
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

457 
iw_·¿m
 *
¹s
, *
exŒa
)

459 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

460 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

461 
u16
 
v®
;

463 ià(
¹s
->
di§bËd
)

464 
v®
 = 2346;

465 ià((
¹s
->
v®ue
 < 256) || (rts->value > 2346))

466  -
EINVAL
;

468 
v®
 = (
¹s
->
v®ue
 & ~0x1);

470 ià(
v®
 !ğ
v­
->
iv_äagth»shŞd
) {

471 
v­
->
iv_äagth»shŞd
 = 
v®
;

472 ià(
	`IS_UP
(
ic
->
ic_dev
))

473  
ic
->
	`ic_»£t
(ic->
ic_dev
);

476 
	}
}

479 
	$›“80211_ioùl_giwäag
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

480 
iw_·¿m
 *
¹s
, *
exŒa
)

482 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

484 
¹s
->
v®ue
 = 
v­
->
iv_äagth»shŞd
;

485 
¹s
->
di§bËd
 = (¹s->
v®ue
 == 2346);

486 
¹s
->
fixed
 = 1;

489 
	}
}

492 
	$›“80211_ioùl_siw­
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

493 
sockaddr
 *
­_addr
, *
exŒa
)

495 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

498 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

499  -
EOPNOTSUPP
;

501 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
)

502 
	`IEEE80211_ADDR_COPY
(
v­
->
wds_mac
, &
­_addr
->
§_d©a
);

514 
v­
->
iv_æags
 &ğ~
IEEE80211_F_DESBSSID
;

515 ià(!
	`IEEE80211_ADDR_NULL
(&
­_addr
->
§_d©a
)) {

516 ià(!
	`IEEE80211_ADDR_EQ
(&
­_addr
->
§_d©a
,

517 
v­
->
iv_dev
->
brßdÿ¡
))

518 
v­
->
iv_æags
 |ğ
IEEE80211_F_DESBSSID
;

520 
	`IEEE80211_ADDR_COPY
(
v­
->
iv_des_bssid
, &
­_addr
->
§_d©a
);

521 ià(
	`IS_UP_AUTO
(
v­
))

522 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

525 
	}
}

528 
	$›“80211_ioùl_giw­
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

529 
sockaddr
 *
­_addr
, *
exŒa
)

531 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

533 ià(
v­
->
iv_æags
 & 
IEEE80211_F_DESBSSID
)

534 
	`IEEE80211_ADDR_COPY
(&
­_addr
->
§_d©a
, 
v­
->
iv_des_bssid
);

536 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
)

537 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_WDS
)

538 
	`IEEE80211_ADDR_COPY
(&
­_addr
->
§_d©a
, 
v­
->
iv_bssid
);

540 
	`IEEE80211_ADDR_COPY
(&
­_addr
->
§_d©a
, 
v­
->
wds_mac
);

542 
	`IEEE80211_ADDR_SET_NULL
(&
­_addr
->
§_d©a
);

544 
­_addr
->
§_çmy
 = 
ARPHRD_ETHER
;

546 
	}
}

549 
	$›“80211_ioùl_siwnickn
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

550 
iw_pošt
 *
d©a
, *
nickÇme
)

552 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

554 ià(
d©a
->
Ëngth
 > 
IEEE80211_NWID_LEN
)

555  -
E2BIG
;

557 
	`mem£t
(
v­
->
iv_nickÇme
, 0, 
IEEE80211_NWID_LEN
);

558 
	`memıy
(
v­
->
iv_nickÇme
, 
nickÇme
, 
d©a
->
Ëngth
);

559 
v­
->
iv_nickÇm–’
 = 
d©a
->
Ëngth
;

562 
	}
}

565 
	$›“80211_ioùl_giwnickn
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

566 
iw_pošt
 *
d©a
, *
nickÇme
)

568 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

570 ià(
d©a
->
Ëngth
 > 
v­
->
iv_nickÇm–’
 + 1)

571 
d©a
->
Ëngth
 = 
v­
->
iv_nickÇm–’
 + 1;

572 ià(
d©a
->
Ëngth
 > 0) {

573 
	`memıy
(
nickÇme
, 
v­
->
iv_nickÇme
, 
d©a
->
Ëngth
 - 1);

574 
nickÇme
[
d©a
->
Ëngth
-1] = '\0';

577 
	}
}

580 
	$fšd11gchªÃl
(
›“80211com
 *
ic
, 
i
, 
äeq
)

582 ; 
i
 < 
ic
->
ic_nchªs
; i++) {

583 cÚ¡ 
›“80211_chªÃl
 *
c
 = &
ic
->
ic_chªÃls
[
i
];

584 ià(
c
->
ic_äeq
 =ğ
äeq
 && 
	`IEEE80211_IS_CHAN_ANYG
(c))

588 
	}
}

590 
›“80211_chªÃl
 *

591 
	$fšdchªÃl
(
›“80211com
 *
ic
, 
›“
, 
mode
)

593 cÚ¡ 
u_št
 
chªæags
[] = {

595 
IEEE80211_CHAN_A
,

596 
IEEE80211_CHAN_B
,

597 
IEEE80211_CHAN_PUREG
,

598 
IEEE80211_CHAN_FHSS
,

599 
IEEE80211_CHAN_108A
,

600 
IEEE80211_CHAN_108G
,

601 
IEEE80211_CHAN_ST
,

603 
u_št
 
modeæags
;

604 
i
;

606 
modeæags
 = 
chªæags
[
mode
];

607 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

608 
›“80211_chªÃl
 *
c
 = &
ic
->
ic_chªÃls
[
i
];

610 ià(
c
->
ic_›“
 !ğ
›“
)

612 ià(
mode
 =ğ
IEEE80211_MODE_AUTO
) {

614 ià(!(
ic
->
ic_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
) &&

615 
	`IEEE80211_IS_CHAN_TURBO
(
c
))

622 ià(!
	`IEEE80211_IS_CHAN_B
(
c
) ||

623 !
	`fšd11gchªÃl
(
ic
, 
i
 + 1, 
c
->
ic_äeq
))

624  
c
;

626 ià((
c
->
ic_æags
 & 
modeæags
) == modeflags)

627  
c
;

630  
NULL
;

631 
	}
}

633 
	#IEEE80211_MODE_TURBO_STATIC_A
 
IEEE80211_MODE_MAX


	)

635 
	$›“80211_check_mode_cÚsi¡’cy
(
›“80211com
 *
ic
, 
mode
,

636 
›“80211_chªÃl
 *
c
)

638 ià(
c
 =ğ
IEEE80211_CHAN_ANYC
)

640 
mode
) {

641 
IEEE80211_MODE_11B
:

642 ià(
	`IEEE80211_IS_CHAN_B
(
c
))

647 
IEEE80211_MODE_11G
:

648 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
))

653 
IEEE80211_MODE_11A
:

654 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

659 
IEEE80211_MODE_TURBO_STATIC_A
:

660 ià(
	`IEEE80211_IS_CHAN_A
(
c
è&& 
	`IEEE80211_IS_CHAN_STURBO
(c))

665 
IEEE80211_MODE_AUTO
:

670 
	}
}

671 #undeà
IEEE80211_MODE_TURBO_STATIC_A


674 
	$›“80211_ioùl_siwäeq
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

675 
iw_äeq
 *
äeq
, *
exŒa
)

677 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

678 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

679 
›“80211_chªÃl
 *
c
, *
c2
;

680 
i
;

682 ià(
äeq
->
e
 > 1)

683  -
EINVAL
;

684 ià(
äeq
->
e
 == 1)

685 
i
 = (
ic
->
ic_mhz2›“
)(ic, 
äeq
->
m
 / 100000, 0);

687 
i
 = 
äeq
->
m
;

689 ià((
i
 != 0) && (i != -1)) {

690 ià(
i
 > 
IEEE80211_CHAN_MAX
)

691  -
EINVAL
;

692 
c
 = 
	`fšdchªÃl
(
ic
, 
i
, 
v­
->
iv_des_mode
);

693 ià(
c
 =ğ
NULL
) {

694 
c
 = 
	`fšdchªÃl
(
ic
, 
i
, 
IEEE80211_MODE_AUTO
);

695 ià(
c
 =ğ
NULL
)

696  -
EINVAL
;

706 
v­
->
iv_des_mode
) {

707 
IEEE80211_MODE_11B
:

708 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
)) {

709 
c2
 = 
	`fšdchªÃl
(
ic
, 
i
, 
IEEE80211_MODE_11B
);

711 ià(
c2
 !ğ
NULL
)

712 
c
 = 
c2
;

715 
IEEE80211_MODE_TURBO_A
:

716 ià(
	`IEEE80211_IS_CHAN_A
(
c
)) {

717 
c2
 = 
	`fšdchªÃl
(
ic
, 
i
, 
IEEE80211_MODE_TURBO_A
);

718 ià(
c2
 !ğ
NULL
)

719 
c
 = 
c2
;

725 ià(
	`›“80211_check_mode_cÚsi¡’cy
(
ic
, 
v­
->
iv_des_mode
, 
c
)) {

726 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

727  -
EINVAL
;

729 ià((
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
è&& (
c
 =ğv­->
iv_des_chª
))

733 ià(
c
->
ic_æags
 & 
IEEE80211_CHAN_RADAR
)

734  -
EINVAL
;

740 
v­
->
iv_des_chª
 = 
c
;

747 ià(
v­
->
iv_des_chª
 =ğ
IEEE80211_CHAN_ANYC
)

749 
v­
->
iv_des_chª
 = 
IEEE80211_CHAN_ANYC
;

752 ià(
v­
->
iv_des_chª
 !ğ
IEEE80211_CHAN_ANYC
) {

753 
mode
 = 
	`›“80211_chª2mode
(
v­
->
iv_des_chª
);

754 ià(
mode
 !ğ
ic
->
ic_curmode
)

755 
	`›“80211_£tmode
(
ic
, 
mode
);

758 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_MONITOR
 ||

759 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) &&

760 
v­
->
iv_des_chª
 !ğ
IEEE80211_CHAN_ANYC
) {

762 
ic
->
ic_curchª
 = 
v­
->
iv_des_chª
;

763 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

764 
ic
->
	`ic_£t_chªÃl
(ic);

766 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

771 ià(
	`IS_UP
(
v­
->
iv_dev
) &&

772 (0 =ğ(
v­
->
iv_des_chª
->
ic_æags
 & 
CHANNEL_DFS
))) {

773 
	`´e_ªnounûd_chªsw™ch
(
dev
,

774 
	`›“80211_chª2›“
(
ic
, 
v­
->
iv_des_chª
),

775 
IEEE80211_DEFAULT_CHANCHANGE_TBTT_COUNT
);

777 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
) {

778 
ic
->
ic_curchª
 = 
v­
->
iv_des_chª
;

779 
ic
->
	`ic_£t_chªÃl
(ic);

785 ià(
	`IS_UP_AUTO
(
v­
))

786 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

789 
	}
}

792 
	$›“80211_ioùl_giwäeq
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

793 
iw_äeq
 *
äeq
, *
exŒa
)

795 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

796 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

798 ià(
v­
->
iv_¡©e
 =ğ
IEEE80211_S_RUN
 &&

799 
v­
->
iv_İmode
 !ğ
IEEE80211_M_MONITOR
) {

804 
	`KASSERT
(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
,

806 
äeq
->
m
 = 
ic
->
ic_bsschª
->
ic_äeq
;

807 } ià(
v­
->
iv_¡©e
 !ğ
IEEE80211_S_INIT
)

808 
äeq
->
m
 = 
ic
->
ic_curchª
->
ic_äeq
;

809 ià(
v­
->
iv_des_chª
 !ğ
IEEE80211_CHAN_ANYC
)

810 
äeq
->
m
 = 
v­
->
iv_des_chª
->
ic_äeq
;

812 
äeq
->
m
 = 0;

813 
äeq
->
m
 *= 100000;

814 
äeq
->
e
 = 1;

817 
	}
}

819 #ifdeà
ATH_SUPERG_XR


824 
	$cİy_des_ssid
(
›“80211v­
 *
d¡
, cÚ¡ ›“80211v­ *
¤c
)

826 
d¡
->
iv_des_nssid
 = 
¤c
->iv_des_nssid;

827 
	`memıy
(
d¡
->
iv_des_ssid
, 
¤c
->iv_des_ssid,

828 
¤c
->
iv_des_nssid
 * (¤c->
iv_des_ssid
[0]));

829 
	}
}

833 
	$›“80211_ioùl_siwessid
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

834 
iw_pošt
 *
d©a
, *
ssid
)

836 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

838 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
)

839  -
EOPNOTSUPP
;

841 ià(
d©a
->
æags
 == 0)

842 
v­
->
iv_des_nssid
 = 0;

844 ià(
d©a
->
Ëngth
 > 
IEEE80211_NWID_LEN
)

845 
d©a
->
Ëngth
 = 
IEEE80211_NWID_LEN
;

847 
	`memıy
(
v­
->
iv_des_ssid
[0].
ssid
, ssid, 
d©a
->
Ëngth
);

848 
v­
->
iv_des_ssid
[0].
Ën
 = 
d©a
->
Ëngth
;

849 
v­
->
iv_des_nssid
 = 1;

850 #ià
WIRELESS_EXT
 < 21

861 ià(
d©a
->
Ëngth
 > 0 &&

862 
v­
->
iv_des_ssid
[0].
ssid
[
d©a
->
Ëngth
 - 1] == '\0')

863 
v­
->
iv_des_ssid
[0].
Ën
--;

866 #ifdeà
ATH_SUPERG_XR


867 ià(
v­
->
iv_xrv­
 !ğ
NULL
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
)) {

868 ià(
d©a
->
æags
 == 0)

869 
v­
->
iv_des_nssid
 = 0;

871 
	`cİy_des_ssid
(
v­
->
iv_xrv­
, vap);

874  
	`IS_UP_AUTO
(
v­
è? 
	`›“80211_š™
(v­->
iv_dev
, 
RESCAN
) : 0;

875 
	}
}

878 
	$›“80211_ioùl_giwessid
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

879 
iw_pošt
 *
d©a
, *
essid
)

881 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

883 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
)

884  -
EOPNOTSUPP
;

886 
d©a
->
æags
 = 1;

887 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

888 ià(
v­
->
iv_des_nssid
 > 0) {

889 ià(
d©a
->
Ëngth
 > 
v­
->
iv_des_ssid
[0].
Ën
)

890 
d©a
->
Ëngth
 = 
v­
->
iv_des_ssid
[0].
Ën
;

891 
	`memıy
(
essid
, 
v­
->
iv_des_ssid
[0].
ssid
, 
d©a
->
Ëngth
);

893 
d©a
->
Ëngth
 = 0;

895 ià(
v­
->
iv_des_nssid
 == 0) {

896 ià(
d©a
->
Ëngth
 > 
v­
->
iv_bss
->
ni_es¦’
)

897 
d©a
->
Ëngth
 = 
v­
->
iv_bss
->
ni_es¦’
;

898 
	`memıy
(
essid
, 
v­
->
iv_bss
->
ni_essid
, 
d©a
->
Ëngth
);

900 ià(
d©a
->
Ëngth
 > 
v­
->
iv_des_ssid
[0].
Ën
)

901 
d©a
->
Ëngth
 = 
v­
->
iv_des_ssid
[0].
Ën
;

902 
	`memıy
(
essid
, 
v­
->
iv_des_ssid
[0].
ssid
, 
d©a
->
Ëngth
);

906 
	}
}

909 
	$›“80211_ioùl_giw¿nge
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

910 
iw_pošt
 *
d©a
, *
exŒa
)

912 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

913 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

914 
›“80211_node
 *
ni
 = 
v­
->
iv_bss
;

915 
iw_¿nge
 *
¿nge
 = (iw_¿ng*)
exŒa
;

916 
›“80211_¿‹£t
 *
rs
;

917 
u_št8_t
 
»pÜ‹d
[
IEEE80211_CHAN_BYTES
];

918 
i
, 
r
;

919 
¡•
 = 0;

921 
d©a
->
Ëngth
 = (
iw_¿nge
);

922 
	`mem£t
(
¿nge
, 0, (
iw_¿nge
));

925 
¿nge
->
num_txpow”
 = (
ic
->
ic_txpowlim™
 >ğ8è? 
IW_MAX_TXPOWER
 : ic->ic_txpowlimit;

926 
¡•
 = 
ic
->
ic_txpowlim™
 / (2 * (
IW_MAX_TXPOWER
 - 1));

928 
¿nge
->
txpow”
[0] = 0;

929 
i
 = 1; i < 
IW_MAX_TXPOWER
; i++)

930 
¿nge
->
txpow”
[
i
] = (
ic
->
ic_txpowlim™
/2)

931 - (
IW_MAX_TXPOWER
 - 
i
 - 1è* 
¡•
;

933 
¿nge
->
txpow”_ÿ·
 = 
IW_TXPOW_DBM
;

935 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ||

936 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) {

937 
¿nge
->
mš_pmp
 = 1 * 1024;

938 
¿nge
->
max_pmp
 = 65535 * 1024;

939 
¿nge
->
mš_pmt
 = 1 * 1024;

940 
¿nge
->
max_pmt
 = 1000 * 1024;

941 
¿nge
->
pmp_æags
 = 
IW_POWER_PERIOD
;

942 
¿nge
->
pmt_æags
 = 
IW_POWER_TIMEOUT
;

943 
¿nge
->
pm_ÿ·
 = 
IW_POWER_PERIOD
 | 
IW_POWER_TIMEOUT
 |

944 
IW_POWER_UNICAST_R
 | 
IW_POWER_ALL_R
;

947 
¿nge
->
we_v”siÚ_comped
 = 
WIRELESS_EXT
;

948 
¿nge
->
we_v”siÚ_sourû
 = 18;

950 
¿nge
->
»Œy_ÿ·
 = 
IW_RETRY_LIMIT
;

951 
¿nge
->
»Œy_æags
 = 
IW_RETRY_LIMIT
;

952 
¿nge
->
mš_»Œy
 = 0;

953 
¿nge
->
max_»Œy
 = 255;

955 
¿nge
->
num_chªÃls
 = 
ic
->
ic_nchªs
;

957 
¿nge
->
num_äequ’cy
 = 0;

958 
	`mem£t
(
»pÜ‹d
, 0, (reported));

959 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

960 cÚ¡ 
›“80211_chªÃl
 *
c
 = &
ic
->
ic_chªÃls
[
i
];

963 ià(
	`isşr
(
»pÜ‹d
, 
c
->
ic_›“
)) {

964 
	`£tb™
(
»pÜ‹d
, 
c
->
ic_›“
);

965 
¿nge
->
äeq
[¿nge->
num_äequ’cy
].
i
 = 
c
->
ic_›“
;

966 
¿nge
->
äeq
[¿nge->
num_äequ’cy
].
m
 =

967 
ic
->
ic_chªÃls
[
i
].
ic_äeq
 * 100000;

968 
¿nge
->
äeq
[¿nge->
num_äequ’cy
].
e
 = 1;

969 ià(++
¿nge
->
num_äequ’cy
 =ğ
IW_MAX_FREQUENCIES
)

978 
¿nge
->
max_qu®
.
qu®
 = 70;

979 #ià
WIRELESS_EXT
 >= 19

983 
¿nge
->
max_qu®
.
upd©ed
 |ğ
IW_QUAL_DBM
;

984 
¿nge
->
max_qu®
.
Ëv–
 = 
ATH_DEFAULT_NOISE
 + 1;

985 
¿nge
->
max_qu®
.
noi£
 = 
ATH_DEFAULT_NOISE
;

988 
¿nge
->
max_qu®
.
Ëv–
 = 0;

989 
¿nge
->
max_qu®
.
noi£
 = 0;

992 
¿nge
->
£ns™iv™y
 = 1;

994 
¿nge
->
max_’codšg_tok’s
 = 
IEEE80211_WEP_NKID
;

996 
¿nge
->
num_’codšg_sizes
 = 3;

997 
¿nge
->
’codšg_size
[0] = 5;

998 
¿nge
->
’codšg_size
[1] = 13;

999 
¿nge
->
’codšg_size
[2] = 16;

1002 
rs
 = &
ni
->
ni_¿‹s
;

1003 
¿nge
->
num_b™¿‹s
 = 
rs
->
rs_Ä©es
;

1004 ià(
¿nge
->
num_b™¿‹s
 > 
IW_MAX_BITRATES
)

1005 
¿nge
->
num_b™¿‹s
 = 
IW_MAX_BITRATES
;

1006 
i
 = 0; i < 
¿nge
->
num_b™¿‹s
; i++) {

1007 
r
 = 
rs
->
rs_¿‹s
[
i
] & 
IEEE80211_RATE_VAL
;

1008 
¿nge
->
b™¿‹
[
i
] = (
r
 * 1000000) / 2;

1012 
¿nge
->
throughput
 = 5500000;

1014 
¿nge
->
mš_¹s
 = 0;

1015 
¿nge
->
max_¹s
 = 2347;

1016 
¿nge
->
mš_äag
 = 256;

1017 
¿nge
->
max_äag
 = 2346;

1019 #ià
WIRELESS_EXT
 >= 17

1021 
	`IW_EVENT_CAPA_SET_KERNEL
(
¿nge
->
ev’t_ÿ·
);

1024 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
 ||

1025 
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
 ||

1026 
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
) {

1028 
	`IW_EVENT_CAPA_SET
(
¿nge
->
ev’t_ÿ·
, 
SIOCGIWSCAN
);

1031 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

1033 
	`IW_EVENT_CAPA_SET
(
¿nge
->
ev’t_ÿ·
, 
SIOCGIWAP
);

1034 
	`IW_EVENT_CAPA_SET
(
¿nge
->
ev’t_ÿ·
, 
IWEVREGISTERED
);

1035 
	`IW_EVENT_CAPA_SET
(
¿nge
->
ev’t_ÿ·
, 
IWEVEXPIRED
);

1039 
	`IW_EVENT_CAPA_SET
(
¿nge
->
ev’t_ÿ·
, 
IWEVCUSTOM
);

1042 #ià
WIRELESS_EXT
 >= 18

1044 
¿nge
->
’c_ÿ·
 = 
IW_ENC_CAPA_WPA
 | 
IW_ENC_CAPA_WPA2
 |

1045 
IW_ENC_CAPA_CIPHER_TKIP
 | 
IW_ENC_CAPA_CIPHER_CCMP
;

1049 
	}
}

1052 
	$›“80211_ioùl_£t¥y
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1053 
iw_pošt
 *
d©a
, *
exŒa
)

1056 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1057 
sockaddr
 
add»ss
[
IW_MAX_SPY
];

1058 
numb”
 = 
d©a
->
Ëngth
;

1059 
i
;

1061 ià(
numb”
 > 
IW_MAX_SPY
)

1062  -
E2BIG
;

1065 ià(
d©a
->
poš‹r
) {

1066 ià(
	`cİy_äom_u£r
(
add»ss
, 
d©a
->
poš‹r
,

1067 (
sockaddr
è* 
numb”
))

1068  -
EFAULT
;

1070  -
EINVAL
;

1073 ià(
numb”
 > 0) {

1075 
i
 = 0; i < 
numb”
; i++)

1076 
	`memıy
(&
v­
->
iv_¥y
.
mac
[
i
 * 
IEEE80211_ADDR_LEN
],

1077 
add»ss
[
i
].
§_d©a
, 
IEEE80211_ADDR_LEN
);

1079 
	`mem£t
(
v­
->
iv_¥y
.
ts_rssi
, 0, (vap->iv_spy.ts_rssi));

1081 
v­
->
iv_¥y
.
num
 = 
numb”
;

1084 
	}
}

1087 
	$›“80211_ioùl_g‘¥y
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1088 
iw_pošt
 *
d©a
, *
exŒa
)

1094 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1095 
›“80211_node_bË
 *
Á
 = &
v­
->
iv_ic
->
ic_¡a
;

1096 
›“80211_node
 *
ni
;

1097 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1098 
sockaddr
 *
add»ss
;

1099 
iw_qu®™y
 *
¥y_¡©
;

1100 
numb”
 = 
v­
->
iv_¥y
.
num
;

1101 
i
;

1103 
add»ss
 = (
sockaddr
 *)
exŒa
;

1104 
¥y_¡©
 = (
iw_qu®™y
 *)(
exŒa
 + 
numb”
 * (
sockaddr
));

1106 
i
 = 0; i < 
numb”
; i++) {

1107 
	`memıy
(
add»ss
[
i
].
§_d©a
, &
v­
->
iv_¥y
.
mac
[˜* 
IEEE80211_ADDR_LEN
],

1108 
IEEE80211_ADDR_LEN
);

1109 
add»ss
[
i
].
§_çmy
 = 
AF_PACKET
;

1113 
i
 = 0; i < 
numb”
; i++) {

1114 
ni
 = 
	`›“80211_fšd_node
(
Á
, &
v­
->
iv_¥y
.
mac
[
i
 * 
IEEE80211_ADDR_LEN
]);

1116 ià(
ni
) {

1117 ià(
ni
->
ni_v­
 =ğ
v­
) {

1118 
	`£t_qu®™y
(&
¥y_¡©
[
i
],

1119 
ic
->
ic_rssi_ewma
 ?

1120 
ic
->
	`ic_node_g‘rssi
(
ni
è:‚i->
ni_rssi
,

1121 
ic
->
ic_chªnoi£
);

1123 ià(
ni
->
ni_¹sf
 !ğ
v­
->
iv_¥y
.
ts_rssi
[
i
]) {

1124 
v­
->
iv_¥y
.
ts_rssi
[
i
] = 
ni
->
ni_¹sf
;

1126 
¥y_¡©
[
i
].
upd©ed
 = 0;

1129 
	`›“80211_uÄef_node
(&
ni
);

1131 
¥y_¡©
[
i
].
upd©ed
 = 
IW_QUAL_ALL_INVALID
;

1136 
d©a
->
Ëngth
 = 
numb”
;

1138 
	}
}

1140 #ià
WIRELESS_EXT
 >= 16

1143 
	$›“80211_ioùl_£‰hr¥y
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1144 
iw_pošt
 *
d©a
, *
exŒa
)

1146 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1147 
iw_thr¥y
 
th»shŞd
;

1149 ià(
d©a
->
Ëngth
 != 1)

1150  -
EINVAL
;

1153 ià(
d©a
->
poš‹r
) {

1154 ià(
	`cİy_äom_u£r
(&
th»shŞd
, 
d©a
->
poš‹r
,

1155 (
iw_thr¥y
)))

1156  -
EFAULT
;

1158  -
EINVAL
;

1160 ià(
th»shŞd
.
low
.
Ëv–
 == 0) {

1162 
v­
->
iv_¥y
.
thr_low
 = 0;

1163 
v­
->
iv_¥y
.
thr_high
 = 0;

1164 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
,

1165 "%s: di§bËd iw_¥yh»shŞd\n", 
__func__
);

1170 
v­
->
iv_¥y
.
thr_low
 = 
th»shŞd
.
low
.
Ëv–
 + 
ATH_DEFAULT_NOISE
;

1171 
v­
->
iv_¥y
.
thr_high
 = 
th»shŞd
.
high
.
Ëv–
 + 
ATH_DEFAULT_NOISE
;

1172 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_DEBUG
,

1173 "%s:ƒÇbËd iw_¥yh»shŞd\n", 
__func__
);

1177 
	}
}

1180 
	$›“80211_ioùl_g‘thr¥y
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1181 
iw_pošt
 *
d©a
, *
exŒa
)

1183 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1184 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1185 
iw_thr¥y
 *
th»shŞd
;

1187 
th»shŞd
 = (
iw_thr¥y
 *)
exŒa
;

1190 
	`£t_qu®™y
(&(
th»shŞd
->
low
), 
v­
->
iv_¥y
.
thr_low
, 
ic
->
ic_chªnoi£
);

1191 
	`£t_qu®™y
(&(
th»shŞd
->
high
), 
v­
->
iv_¥y
.
thr_high
, 
ic
->
ic_chªnoi£
);

1194 
d©a
->
Ëngth
 = 1;

1197 
	}
}

1201 
	$›“80211_ioùl_siwmode
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1202 
__u32
 *
mode
, *
exŒa
)

1204 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1205 
ifmedŸ»q
 
imr
;

1206 
v®id
 = 0;

1208 
	`mem£t
(&
imr
, 0, (imr));

1209 
v­
->
iv_medŸ
.
	`ifm_¡©us
(v­->
iv_dev
, &
imr
);

1211 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_HOSTAP
)

1212 
v®id
 = (*
mode
 =ğ
IW_MODE_MASTER
);

1213 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_MONITOR
)

1214 
v®id
 = (*
mode
 =ğ
IW_MODE_MONITOR
);

1215 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_ADHOC
)

1216 
v®id
 = (*
mode
 =ğ
IW_MODE_ADHOC
);

1217 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_WDS
)

1218 
v®id
 = (*
mode
 =ğ
IW_MODE_REPEAT
);

1220 
v®id
 = (*
mode
 =ğ
IW_MODE_INFRA
);

1222  
v®id
 ? 0 : -
EINVAL
;

1223 
	}
}

1226 
	$›“80211_ioùl_giwmode
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1227 
__u32
 *
mode
, *
exŒa
)

1229 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1230 
ifmedŸ»q
 
imr
;

1232 
	`mem£t
(&
imr
, 0, (imr));

1233 
v­
->
iv_medŸ
.
	`ifm_¡©us
(v­->
iv_dev
, &
imr
);

1235 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_HOSTAP
)

1236 *
mode
 = 
IW_MODE_MASTER
;

1237 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_MONITOR
)

1238 *
mode
 = 
IW_MODE_MONITOR
;

1239 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_ADHOC
)

1240 *
mode
 = 
IW_MODE_ADHOC
;

1241 ià(
imr
.
ifm_aùive
 & 
IFM_IEEE80211_WDS
)

1242 *
mode
 = 
IW_MODE_REPEAT
;

1244 *
mode
 = 
IW_MODE_INFRA
;

1246 
	}
}

1249 
	$›“80211_ioùl_siwpow”
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1250 
iw_·¿m
 *
wrq
, *
exŒa
)

1252 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1253 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1258 ià((
ic
->
ic_ÿps
 & 
IEEE80211_C_PMGT
) == 0)

1259  -
EOPNOTSUPP
;

1261 ià(
wrq
->
di§bËd
) {

1262 
ic
->
ic_æags
 &ğ~
IEEE80211_F_PMGTON
;

1264 
wrq
->
æags
 & 
IW_POWER_MODE
) {

1265 
IW_POWER_UNICAST_R
:

1266 
IW_POWER_ALL_R
:

1267 
IW_POWER_ON
:

1268 ià(
wrq
->
æags
 & 
IW_POWER_PERIOD
) {

1269 ià(
	`IEEE80211_BINTVAL_VALID
(
wrq
->
v®ue
))

1270 
ic
->
ic_lštv®
 = 
	`IEEE80211_MS_TO_TU
(
wrq
->
v®ue
);

1272  -
EINVAL
;

1274 ià(
wrq
->
æags
 & 
IW_POWER_TIMEOUT
)

1275 
ic
->
ic_hŞdov”
 = 
	`IEEE80211_MS_TO_TU
(
wrq
->
v®ue
);

1277 
ic
->
ic_æags
 |ğ
IEEE80211_F_PMGTON
;

1280  -
EINVAL
;

1284  
	`IS_UP
(
ic
->
ic_dev
è? ic->
	`ic_»£t
(ic->ic_dev) : 0;

1285 
	}
}

1288 
	$›“80211_ioùl_giwpow”
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1289 
iw_·¿m
 *
¼q
, *
exŒa
)

1291 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1292 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1294 
¼q
->
di§bËd
 = (
ic
->
ic_æags
 & 
IEEE80211_F_PMGTON
) == 0;

1295 ià(!
¼q
->
di§bËd
) {

1296 
¼q
->
æags
 & 
IW_POWER_TYPE
) {

1297 
IW_POWER_TIMEOUT
:

1298 
¼q
->
æags
 = 
IW_POWER_TIMEOUT
;

1299 
¼q
->
v®ue
 = 
	`IEEE80211_TU_TO_MS
(
ic
->
ic_hŞdov”
);

1301 
IW_POWER_PERIOD
:

1302 
¼q
->
æags
 = 
IW_POWER_PERIOD
;

1303 
¼q
->
v®ue
 = 
	`IEEE80211_TU_TO_MS
(
ic
->
ic_lštv®
);

1306 
¼q
->
æags
 |ğ
IW_POWER_ALL_R
;

1309 
	}
}

1312 
	$›“80211_ioùl_siw»Œy
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1313 
iw_·¿m
 *
¼q
, *
exŒa
)

1315 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1316 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1318 ià(
¼q
->
di§bËd
) {

1319 ià(
v­
->
iv_æags
 & 
IEEE80211_F_SWRETRY
) {

1320 
v­
->
iv_æags
 &ğ~
IEEE80211_F_SWRETRY
;

1321 
dÚe
;

1326 ià((
v­
->
iv_ÿps
 & 
IEEE80211_C_SWRETRY
) == 0)

1327  -
EOPNOTSUPP
;

1328 ià(
¼q
->
æags
 =ğ
IW_RETRY_LIMIT
) {

1329 ià(
¼q
->
v®ue
 >= 0) {

1330 
v­
->
iv_txmš
 = 
¼q
->
v®ue
;

1331 
v­
->
iv_txmax
 = 
¼q
->
v®ue
;

1332 
v­
->
iv_txliãtime
 = 0;

1333 
v­
->
iv_æags
 |ğ
IEEE80211_F_SWRETRY
;

1335 
v­
->
iv_æags
 &ğ~
IEEE80211_F_SWRETRY
;

1339 
dÚe
:

1340  
	`IS_UP
(
v­
->
iv_dev
è? 
ic
->
	`ic_»£t
(vap->iv_dev) : 0;

1341 
	}
}

1344 
	$›“80211_ioùl_giw»Œy
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1345 
iw_·¿m
 *
¼q
, *
exŒa
)

1347 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1349 
¼q
->
di§bËd
 = (
v­
->
iv_æags
 & 
IEEE80211_F_SWRETRY
) == 0;

1350 ià(!
¼q
->
di§bËd
) {

1351 
¼q
->
æags
 & 
IW_RETRY_TYPE
) {

1352 
IW_RETRY_LIFETIME
:

1353 
¼q
->
æags
 = 
IW_RETRY_LIFETIME
;

1354 
¼q
->
v®ue
 = 
	`IEEE80211_TU_TO_MS
(
v­
->
iv_txliãtime
);

1356 
IW_RETRY_LIMIT
:

1357 
¼q
->
æags
 = 
IW_RETRY_LIMIT
;

1358 
¼q
->
æags
 & 
IW_RETRY_MODIFIER
) {

1359 
IW_RETRY_MIN
:

1360 
¼q
->
æags
 |ğ
IW_RETRY_MAX
;

1361 
¼q
->
v®ue
 = 
v­
->
iv_txmš
;

1363 
IW_RETRY_MAX
:

1364 
¼q
->
æags
 |ğ
IW_RETRY_MAX
;

1365 
¼q
->
v®ue
 = 
v­
->
iv_txmax
;

1372 
	}
}

1375 
	$›“80211_ioùl_siwtxpow
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1376 
iw_·¿m
 *
¼q
, *
exŒa
)

1378 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1379 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1380 
fixed
, 
di§bËd
;

1382 
fixed
 = (
ic
->
ic_æags
 & 
IEEE80211_F_TXPOW_FIXED
);

1383 
di§bËd
 = (
fixed
 && 
v­
->
iv_bss
->
ni_txpow”
 == 0);

1384 ià(
¼q
->
di§bËd
) {

1385 ià(!
di§bËd
) {

1386 ià((
ic
->
ic_ÿps
 & 
IEEE80211_C_TXPMGT
) == 0)

1387  -
EOPNOTSUPP
;

1388 
ic
->
ic_æags
 |ğ
IEEE80211_F_TXPOW_FIXED
;

1389 
v­
->
iv_bss
->
ni_txpow”
 = 0;

1390 
dÚe
;

1395 ià(
¼q
->
fixed
) {

1396 ià((
ic
->
ic_ÿps
 & 
IEEE80211_C_TXPMGT
) == 0)

1397  -
EOPNOTSUPP
;

1398 ià(
¼q
->
æags
 !ğ
IW_TXPOW_DBM
)

1399  -
EINVAL
;

1400 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
) {

1401 ià((
ic
->
ic_bsschª
->
ic_max»gpow”
 >ğ
¼q
->
v®ue
) &&

1402 (
ic
->
ic_txpowlim™
/2 >ğ
¼q
->
v®ue
)) {

1403 
v­
->
iv_bss
->
ni_txpow”
 = 2 * 
¼q
->
v®ue
;

1404 
ic
->
ic_Ãwtxpowlim™
 = 2 * 
¼q
->
v®ue
;

1405 
ic
->
ic_æags
 |ğ
IEEE80211_F_TXPOW_FIXED
;

1407  -
EINVAL
;

1412 ià(
ic
->
ic_txpowlim™
/2 >ğ
¼q
->
v®ue
) {

1413 
v­
->
iv_bss
->
ni_txpow”
 = 2 * 
¼q
->
v®ue
;

1414 
ic
->
ic_Ãwtxpowlim™
 = 2 * 
¼q
->
v®ue
;

1415 
ic
->
ic_æags
 |ğ
IEEE80211_F_TXPOW_FIXED
;

1418  -
EINVAL
;

1421 ià(!
fixed
)

1423 
ic
->
ic_Ãwtxpowlim™
 = 
IEEE80211_TXPOWER_MAX
;

1424 
ic
->
ic_æags
 &ğ~
IEEE80211_F_TXPOW_FIXED
;

1426 
dÚe
:

1427  
	`IS_UP
(
ic
->
ic_dev
è? ic->
	`ic_»£t
(ic->ic_dev) : 0;

1428 
	}
}

1431 
	$›“80211_g‘_txcÚt
(
Ãt_deviû
 *
dev
,

1432 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1434 *
·¿ms
 = (*)
exŒa
;

1435 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1436 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1437 
·¿ms
[0] = 
ic
->
	`ic_g‘_txcÚt
(ic);

1439 
	}
}

1442 
	$›“80211_g‘_dfs_ÿc_time
(
Ãt_deviû
 *
dev
,

1443 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1445 *
·¿ms
 = (*)
exŒa
;

1446 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1447 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1448 
·¿ms
[0] = 
ic
->
	`ic_g‘_dfs_ÿc_time
(ic);

1450 
	}
}

1453 
	$›“80211_g‘_dfs_exş_³riod
(
Ãt_deviû
 *
dev
,

1454 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1456 *
·¿ms
 = (*)
exŒa
;

1457 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1458 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1459 
·¿ms
[0] = 
ic
->
	`ic_g‘_dfs_exş_³riod
(ic);

1461 
	}
}

1463 
	$›“80211_£t_dfs_ÿc_time
(
Ãt_deviû
 *
dev
,

1464 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1466 *
·¿ms
 = (*)
exŒa
;

1467 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1468 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1469 
ic
->
	`ic_£t_dfs_ÿc_time
(ic, 
·¿ms
[1]);

1471 
	}
}

1473 
	$›“80211_£t_dfs_exş_³riod
 (
Ãt_deviû
 *
dev
,

1474 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1476 *
·¿ms
 = (*)
exŒa
;

1477 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1478 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1479 
ic
->
	`ic_£t_dfs_exş_³riod
(ic, 
·¿ms
[1]);

1481 
	}
}

1484 
	$›“80211_g‘_dfs_‹¡mode
(
Ãt_deviû
 *
dev
,

1485 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1487 *
·¿ms
 = (*)
exŒa
;

1488 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1489 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1490 
·¿ms
[0] = 
ic
->
	`ic_g‘_dfs_‹¡mode
(ic);

1492 
	}
}

1495 
	$›“80211_g‘_txcÚt_¿‹
(
Ãt_deviû
 *
dev
,

1496 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1498 *
·¿ms
 = (*)
exŒa
;

1499 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1500 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1501 
·¿ms
[0] = 
ic
->
	`ic_g‘_txcÚt_¿‹
(ic);

1503 
	}
}

1506 
	$›“80211_£t_txcÚt
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1507 *
w
, *
exŒa
)

1509 *
·¿ms
 = (*)
exŒa
;

1510 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1511 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1512 
ic
->
	`ic_£t_txcÚt
(ic, 
·¿ms
[1]);

1514 
	}
}

1517 
	$›“80211_£t_dfs_‹¡mode
(
Ãt_deviû
 *
dev
,

1518 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1520 *
·¿ms
 = (*)
exŒa
;

1521 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1522 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1523 
ic
->
	`ic_£t_dfs_‹¡mode
(ic, 
·¿ms
[1]);

1525 
	}
}

1528 
	$›“80211_£t_txcÚt_¿‹
(
Ãt_deviû
 *
dev
,

1529 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1531 *
·¿ms
 = (*)
exŒa
;

1532 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1533 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1534 
ic
->
	`ic_£t_txcÚt_¿‹
(ic, 
·¿ms
[1]);

1536 
	}
}

1539 
	$›“80211_£t_txcÚt_pow”
(
Ãt_deviû
 *
dev
,

1540 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1542 *
·¿ms
 = (*)
exŒa
;

1543 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1544 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1545 
ic
->
	`ic_£t_txcÚt_pow”
(ic, 
·¿ms
[1]);

1547 
	}
}

1550 
	$›“80211_g‘_txcÚt_pow”
(
Ãt_deviû
 *
dev
,

1551 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1553 *
·¿ms
 = (*)
exŒa
;

1554 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1555 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1556 
·¿ms
[0] = 
ic
->
	`ic_g‘_txcÚt_pow”
(ic);

1558 
	}
}

1561 
	$›“80211_ioùl_h®_m­
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1562 *
w
, *
exŒa
)

1564 *
·¿ms
 = (*)
exŒa
;

1565 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1566 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1567 
·¿ms
[0] = 
ic
->
	`ic_dump_h®_m­
(ic);

1569 
	}
}

1573 
	$›“80211_ioùl_¿d¬
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1574 *
w
, *
exŒa
)

1576 *
·¿ms
 = (*)
exŒa
;

1577 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1578 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1579 ià(!(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
))

1581 
·¿ms
[0] = 
ic
->
	`ic_‹¡_¿d¬
(ic);

1583 
	}
}

1586 
	$›“80211_ioùl_giwtxpow
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1587 
iw_·¿m
 *
¼q
, *
exŒa
)

1589 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1590 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1592 
¼q
->
v®ue
 = 
v­
->
iv_bss
->
ni_txpow”
 / 2;

1593 
¼q
->
fixed
 = (
ic
->
ic_æags
 & 
IEEE80211_F_TXPOW_FIXED
) != 0;

1594 
¼q
->
di§bËd
 = (¼q->
fixed
 &&„rq->
v®ue
 == 0);

1595 
¼q
->
æags
 = 
IW_TXPOW_DBM
;

1597 
	}
}

1599 #ifdeà
ATH_REVERSE_ENGINEERING


1601 
	$›“80211_dump_»gi¡”s
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1603 *
·¿ms
 = (*)
exŒa
;

1604 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1605 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1606 
·¿ms
[1]) {

1608 
ic
->
	`ic_»gi¡”s_m¬k
(ic);

1611 
ic
->
	`ic_»gi¡”s_dump_d–
(ic);

1615 
ic
->
	`ic_»gi¡”s_dump
(ic);

1619 
	}
}

1622 #ifdeà
ATH_REVERSE_ENGINEERING


1624 
	$›“80211_ioùl_wr™”eg
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1626 *
·¿ms
 = (*)
exŒa
;

1627 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1628 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1629  
ic
->
	`ic_wr™e_»gi¡”
(ic, 
·¿ms
[0],…arams[1]);

1630 
	}
}

1633 #ifdeà
ATH_REVERSE_ENGINEERING


1635 
	$›“80211_ioùl_»ad»g
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

1637 *
·¿ms
 = (*)
exŒa
;

1638 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1639 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1640  
ic
->
	`ic_»ad_»gi¡”
(ic, 
·¿ms
[0], &params[0]);

1641 
	}
}

1644 
	sw­li¡»q
 {

1645 
›“80211v­
 *
	mv­
;

1646 
sockaddr
 
	maddr
[
IW_MAX_AP
];

1647 
iw_qu®™y
 
	mqu®
[
IW_MAX_AP
];

1648 
	mi
;

1652 
	$w­li¡_cb
(*
¬g
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

1654 
w­li¡»q
 *
»q
 = 
¬g
;

1655 
i
 = 
»q
->i;

1657 ià(
i
 >ğ
IW_MAX_AP
)

1659 
»q
->
addr
[
i
].
§_çmy
 = 
ARPHRD_ETHER
;

1660 ià(
»q
->
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

1661 
	`IEEE80211_ADDR_COPY
(
»q
->
addr
[
i
].
§_d©a
, 
£
->
£_maÿddr
);

1663 
	`IEEE80211_ADDR_COPY
(
»q
->
addr
[
i
].
§_d©a
, 
£
->
£_bssid
);

1664 
	`£t_qu®™y
(&
»q
->
qu®
[
i
], 
£
->
£_rssi
, 
ATH_DEFAULT_NOISE
);

1665 
»q
->
i
++;

1668 
	}
}

1671 
	$›“80211_ioùl_iw­li¡
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1672 
iw_pošt
 *
d©a
, *
exŒa
)

1674 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1675 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

1676 
w­li¡»q
 
»q
;

1678 
»q
.
v­
 = vap;

1679 
»q
.
i
 = 0;

1680 
	`›“80211_sÿn_™”©e
(
ic
, 
w­li¡_cb
, &
»q
);

1682 
d©a
->
Ëngth
 = 
»q
.
i
;

1683 
	`memıy
(
exŒa
, &
»q
.
addr
,„eq.
i
 * (req.addr[0]));

1684 
d©a
->
æags
 = 1;

1685 
	`memıy
(
exŒa
 + 
»q
.
i
 * Ôeq.
addr
[0]), &»q.
qu®
,

1686 
»q
.
i
 * Ôeq.
qu®
[0]));

1689 
	}
}

1691 #ifdeà
SIOCGIWSCAN


1693 
	$›“80211_ioùl_siwsÿn
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

1694 
iw_pošt
 *
d©a
, *
exŒa
)

1696 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

1706 ià(!
	`IS_UP
(
v­
->
iv_dev
))

1707  -
ENETDOWN
;

1709 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

1710 "%s:‡ùivsÿÀ»que¡\n", 
__func__
);

1711 
	`´“m±_sÿn
(
dev
, 100, 100);

1712 #ià
WIRELESS_EXT
 > 17

1713 ià(
d©a
 && (d©a->
æags
 & 
IW_SCAN_THIS_ESSID
)) {

1714 
iw_sÿn_»q
 
»q
;

1715 
›“80211_sÿn_ssid
 
ssid
;

1716 
cİyL’gth
;

1717 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

1718 "%s: SCAN_THIS_ESSID„eque¡ed\n", 
__func__
);

1719 ià(
d©a
->
Ëngth
 >  
»q
) {

1720 
cİyL’gth
 =  
»q
;

1722 
cİyL’gth
 = 
d©a
->
Ëngth
;

1724 
	`mem£t
(&
»q
, 0, „eq);

1725 ià(
	`cİy_äom_u£r
(&
»q
, 
d©a
->
poš‹r
, 
cİyL’gth
))

1726  -
EFAULT
;

1727 
	`memıy
(&
ssid
.ssid, 
»q
.
essid
,  ssid.ssid);

1728 
ssid
.
Ën
 = 
»q
.
essid_Ën
;

1729 
	`IEEE80211_DPRINTF
(
v­
, 
IEEE80211_MSG_SCAN
,

1730 "%s:„eque¡šg sÿÀoàessid '%s'\n", 
__func__
, 
ssid
.ssid);

1731 (è
	`›“80211_¡¬t_sÿn
(
v­
,

1732 
IEEE80211_SCAN_ACTIVE
 |

1733 
IEEE80211_SCAN_NOPICK
 |

1734 
IEEE80211_SCAN_ONCE
, 
IEEE80211_SCAN_FOREVER
,

1735 1, &
ssid
);

1739 (è
	`›“80211_¡¬t_sÿn
(
v­
, 
IEEE80211_SCAN_ACTIVE
 |

1740 
IEEE80211_SCAN_NOPICK
 | 
IEEE80211_SCAN_ONCE
,

1741 
IEEE80211_SCAN_FOREVER
,

1743 
v­
->
iv_des_nssid
, v­->
iv_des_ssid
);

1745 
	}
}

1751 
u_št


1752 
	$’code_›
(*
buf
, 
size_t
 
bufsize
, cÚ¡ 
u_št8_t
 *
›
, size_ˆ
›Ën
,

1753 cÚ¡ *
Ëad”
, 
size_t
 
Ëad”_Ën
)

1755 
u_št8_t
 *
p
;

1756 
i
;

1758 ià(
bufsize
 < 
Ëad”_Ën
)

1760 
p
 = 
buf
;

1761 
	`memıy
(
p
, 
Ëad”
, 
Ëad”_Ën
);

1762 
bufsize
 -ğ
Ëad”_Ën
;

1763 
p
 +ğ
Ëad”_Ën
;

1764 
i
 = 0; i < 
›Ën
 && 
bufsize
 > 2; i++) {

1765 
p
 +ğ
	`¥rštf
Õ, "%02x", 
›
[
i
]);

1766 
bufsize
 -= 2;

1768  (
i
 =ğ
›Ën
 ? 
p
 - (
u_št8_t
 *)
buf
 : 0);

1769 
	}
}

1771 
	siwsÿÄeq
 {

1772 
›“80211v­
 *
	mv­
;

1773 
iw_»que¡_šfo
 *
	mšfo
;

1774 *
	mcu¼’t_ev
;

1775 *
	m’d_buf
;

1776 
	mmode
;

1779 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 27è&& !
defšed
(
IW_REQUEST_FLAG_COMPAT
)

1780 
	#iwe_¡»am_add_ev’t
(
a
, 
b
, 
c
, 
d
, 
e
è
	`iwe_¡»am_add_ev’t
(b, c, d,ƒ)

	)

1781 
	#iwe_¡»am_add_pošt
(
a
, 
b
, 
c
, 
d
, 
e
è
	`iwe_¡»am_add_pošt
(b, c, d,ƒ)

	)

1782 
	#iwe_¡»am_add_v®ue
(
a
, 
b
, 
c
, 
d
, 
e
, 
f
) \

1783 
	`iwe_¡»am_add_v®ue
(
b
, 
c
, 
d
, 
e
, 
f
)

	)

1784 
	#iwe_¡»am_lı_Ën
(
a
è
IW_EV_LCP_LEN


	)

1787 
	$giwsÿn_cb
(*
¬g
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

1789 
iwsÿÄeq
 *
»q
 = 
¬g
;

1790 
›“80211v­
 *
v­
 = 
»q
->vap;

1791 *
cu¼’t_ev
 = 
»q
->current_ev;

1792 *
’d_buf
 = 
»q
->end_buf;

1793 *
Ï¡_ev
;

1794 
	#MAX_IE_LENGTH
 64 * 2 + 30

	)

1795 
buf
[
MAX_IE_LENGTH
];

1796 #iâdeà
IWEVGENIE


1797 cÚ¡ 
r¢_Ëad”
[] = "rsn_ie=";

1798 cÚ¡ 
w·_Ëad”
[] = "wpa_ie=";

1800 
iw_ev’t
 
iwe
;

1801 *
cu¼’t_v®
;

1802 
j
;

1804 ià(
cu¼’t_ev
 >ğ
’d_buf
)

1805  
E2BIG
;

1807 ià((
»q
->
mode
 !ğ0è^ (
£
->
£_w·_›
 !ğ
NULL
))

1810 
	`mem£t
(&
iwe
, 0, (iwe));

1811 
Ï¡_ev
 = 
cu¼’t_ev
;

1812 
iwe
.
cmd
 = 
SIOCGIWAP
;

1813 
iwe
.
u
.
­_addr
.
§_çmy
 = 
ARPHRD_ETHER
;

1814 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

1815 
	`IEEE80211_ADDR_COPY
(
iwe
.
u
.
­_addr
.
§_d©a
, 
£
->
£_maÿddr
);

1817 
	`IEEE80211_ADDR_COPY
(
iwe
.
u
.
­_addr
.
§_d©a
, 
£
->
£_bssid
);

1818 
cu¼’t_ev
 = 
	`iwe_¡»am_add_ev’t
(
»q
->
šfo
, cu¼’t_ev, 
’d_buf
,

1819 &
iwe
, 
IW_EV_ADDR_LEN
);

1822 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1823  
E2BIG
;

1825 
	`mem£t
(&
iwe
, 0, (iwe));

1826 
Ï¡_ev
 = 
cu¼’t_ev
;

1827 
iwe
.
cmd
 = 
SIOCGIWESSID
;

1828 
iwe
.
u
.
d©a
.
æags
 = 1;

1829 
iwe
.
u
.
d©a
.
Ëngth
 = 
£
->
£_ssid
[1];

1830 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
, current_ev,

1831 
’d_buf
, &
iwe
, (*)
£
->
£_ssid
 + 2);

1834 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1835  
E2BIG
;

1837 ià(
£
->
£_ÿpšfo
 & (
IEEE80211_CAPINFO_ESS
|
IEEE80211_CAPINFO_IBSS
)) {

1838 
	`mem£t
(&
iwe
, 0, (iwe));

1839 
Ï¡_ev
 = 
cu¼’t_ev
;

1840 
iwe
.
cmd
 = 
SIOCGIWMODE
;

1841 
iwe
.
u
.
mode
 = 
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_ESS
 ?

1842 
IW_MODE_MASTER
 : 
IW_MODE_ADHOC
;

1843 
cu¼’t_ev
 = 
	`iwe_¡»am_add_ev’t
(
»q
->
šfo
, current_ev,

1844 
’d_buf
, &
iwe
, 
IW_EV_UINT_LEN
);

1847 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1848  
E2BIG
;

1851 
	`mem£t
(&
iwe
, 0, (iwe));

1852 
Ï¡_ev
 = 
cu¼’t_ev
;

1853 
iwe
.
cmd
 = 
SIOCGIWFREQ
;

1854 
iwe
.
u
.
äeq
.
m
 = 
£
->
£_chª
->
ic_äeq
 * 100000;

1855 
iwe
.
u
.
äeq
.
e
 = 1;

1856 
cu¼’t_ev
 = 
	`iwe_¡»am_add_ev’t
(
»q
->
šfo
, current_ev,

1857 
’d_buf
, &
iwe
, 
IW_EV_FREQ_LEN
);

1860 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1861  
E2BIG
;

1863 
	`mem£t
(&
iwe
, 0, (iwe));

1864 
Ï¡_ev
 = 
cu¼’t_ev
;

1865 
iwe
.
cmd
 = 
IWEVQUAL
;

1866 
	`£t_qu®™y
(&
iwe
.
u
.
qu®
, 
£
->
£_rssi
, 
ATH_DEFAULT_NOISE
);

1867 
cu¼’t_ev
 = 
	`iwe_¡»am_add_ev’t
(
»q
->
šfo
, current_ev,

1868 
’d_buf
, &
iwe
, 
IW_EV_QUAL_LEN
);

1871 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1872  
E2BIG
;

1874 
	`mem£t
(&
iwe
, 0, (iwe));

1875 
Ï¡_ev
 = 
cu¼’t_ev
;

1876 
iwe
.
cmd
 = 
SIOCGIWENCODE
;

1877 ià(
£
->
£_ÿpšfo
 & 
IEEE80211_CAPINFO_PRIVACY
)

1878 
iwe
.
u
.
d©a
.
æags
 = 
IW_ENCODE_ENABLED
 | 
IW_ENCODE_NOKEY
;

1880 
iwe
.
u
.
d©a
.
æags
 = 
IW_ENCODE_DISABLED
;

1881 
iwe
.
u
.
d©a
.
Ëngth
 = 0;

1882 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
, current_ev,

1883 
’d_buf
, &
iwe
, "");

1886 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1887  
E2BIG
;

1889 
	`mem£t
(&
iwe
, 0, (iwe));

1890 
Ï¡_ev
 = 
cu¼’t_ev
;

1891 
iwe
.
cmd
 = 
SIOCGIWRATE
;

1892 
cu¼’t_v®
 = 
cu¼’t_ev
 + 
	`iwe_¡»am_lı_Ën
(
»q
->
šfo
);

1894 
j
 = 0; j < 
£
->
£_¿‹s
[1]; j++) {

1895 
r
 = 
£
->
£_¿‹s
[2 + 
j
] & 
IEEE80211_RATE_VAL
;

1896 ià(
r
 != 0) {

1897 
iwe
.
u
.
b™¿‹
.
v®ue
 = 
r
 * (1000000 / 2);

1898 
cu¼’t_v®
 = 
	`iwe_¡»am_add_v®ue
(
»q
->
šfo
,

1899 
cu¼’t_ev
, 
cu¼’t_v®
, 
’d_buf
,

1900 &
iwe
, 
IW_EV_PARAM_LEN
);

1903 
j
 = 0; j < 
£
->
£_x¿‹s
[1]; j++) {

1904 
r
 = 
£
->
£_x¿‹s
[2+
j
] & 
IEEE80211_RATE_VAL
;

1905 ià(
r
 != 0) {

1906 
iwe
.
u
.
b™¿‹
.
v®ue
 = 
r
 * (1000000 / 2);

1907 
cu¼’t_v®
 = 
	`iwe_¡»am_add_v®ue
(
»q
->
šfo
,

1908 
cu¼’t_ev
, 
cu¼’t_v®
, 
’d_buf
,

1909 &
iwe
, 
IW_EV_PARAM_LEN
);

1913 ià((
cu¼’t_v®
 - 
cu¼’t_ev
è> 
	`iwe_¡»am_lı_Ën
(
»q
->
šfo
)) {

1914 
cu¼’t_ev
 = 
cu¼’t_v®
;

1917 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1918  
E2BIG
;

1921 
	`mem£t
(&
iwe
, 0, (iwe));

1922 
Ï¡_ev
 = 
cu¼’t_ev
;

1923 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1924 
	`¢´štf
(
buf
, (buf), "bú_št=%d", 
£
->
£_štv®
);

1925 
iwe
.
u
.
d©a
.
Ëngth
 = 
	`¡¾’
(
buf
);

1926 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
, current_ev,

1927 
’d_buf
, &
iwe
, 
buf
);

1930 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1931  
E2BIG
;

1933 ià(
£
->
£_r¢_›
 !ğ
NULL
) {

1934 
Ï¡_ev
 = 
cu¼’t_ev
;

1935 #ifdeà
IWEVGENIE


1936 
	`mem£t
(&
iwe
, 0, (iwe));

1937 ià((
£
->
£_r¢_›
[1] + 2è> 
MAX_IE_LENGTH
)

1938  
E2BIG
;

1939 
	`memıy
(
buf
, 
£
->
£_r¢_›
, se->se_rsn_ie[1] + 2);

1940 
iwe
.
cmd
 = 
IWEVGENIE
;

1941 
iwe
.
u
.
d©a
.
Ëngth
 = 
£
->
£_r¢_›
[1] + 2;

1943 
	`mem£t
(&
iwe
, 0, (iwe));

1944 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1945 ià(
£
->
£_r¢_›
[0] =ğ
IEEE80211_ELEMID_RSN
)

1946 
iwe
.
u
.
d©a
.
Ëngth
 = 
	`’code_›
(
buf
, (buf),

1947 
£
->
£_r¢_›
, se->se_rsn_ie[1] + 2,

1948 
r¢_Ëad”
, (rsn_leader) - 1);

1950 ià(
iwe
.
u
.
d©a
.
Ëngth
 != 0) {

1951 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
,

1952 
cu¼’t_ev
, 
’d_buf
, &
iwe
, 
buf
);

1955 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1956  
E2BIG
;

1960 ià(
£
->
£_w·_›
 !ğ
NULL
) {

1961 
Ï¡_ev
 = 
cu¼’t_ev
;

1962 #ifdeà
IWEVGENIE


1963 
	`mem£t
(&
iwe
, 0, (iwe));

1964 ià((
£
->
£_w·_›
[1] + 2è> 
MAX_IE_LENGTH
)

1965  
E2BIG
;

1966 
	`memıy
(
buf
, 
£
->
£_w·_›
, se->se_wpa_ie[1] + 2);

1967 
iwe
.
cmd
 = 
IWEVGENIE
;

1968 
iwe
.
u
.
d©a
.
Ëngth
 = 
£
->
£_w·_›
[1] + 2;

1970 
	`mem£t
(&
iwe
, 0, (iwe));

1971 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1972 
iwe
.
u
.
d©a
.
Ëngth
 = 
	`’code_›
(
buf
, (buf),

1973 
£
->
£_w·_›
, se->se_wpa_ie[1] + 2,

1974 
w·_Ëad”
, (wpa_leader) - 1);

1976 ià(
iwe
.
u
.
d©a
.
Ëngth
 != 0) {

1977 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
,

1978 
cu¼’t_ev
, 
’d_buf
, &
iwe
, 
buf
);

1981 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

1982  
E2BIG
;

1986 ià(
£
->
£_wme_›
 !ğ
NULL
) {

1987 cÚ¡ 
wme_Ëad”
[] = "wme_ie=";

1989 
	`mem£t
(&
iwe
, 0, (iwe));

1990 
Ï¡_ev
 = 
cu¼’t_ev
;

1991 
iwe
.
cmd
 = 
IWEVCUSTOM
;

1992 
iwe
.
u
.
d©a
.
Ëngth
 = 
	`’code_›
(
buf
, (buf),

1993 
£
->
£_wme_›
, se->se_wme_ie[1] + 2,

1994 
wme_Ëad”
, (wme_leader) - 1);

1995 ià(
iwe
.
u
.
d©a
.
Ëngth
 != 0) {

1996 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
,

1997 
cu¼’t_ev
, 
’d_buf
, &
iwe
, 
buf
);

2000 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

2001  
E2BIG
;

2004 ià(
£
->
£_©h_›
 !ğ
NULL
) {

2005 cÚ¡ 
©h_Ëad”
[] = "ath_ie=";

2007 
	`mem£t
(&
iwe
, 0, (iwe));

2008 
Ï¡_ev
 = 
cu¼’t_ev
;

2009 
iwe
.
cmd
 = 
IWEVCUSTOM
;

2010 
iwe
.
u
.
d©a
.
Ëngth
 = 
	`’code_›
(
buf
, (buf),

2011 
£
->
£_©h_›
, se->se_ath_ie[1] + 2,

2012 
©h_Ëad”
, (ath_leader) - 1);

2013 ià(
iwe
.
u
.
d©a
.
Ëngth
 != 0) {

2014 
cu¼’t_ev
 = 
	`iwe_¡»am_add_pošt
(
»q
->
šfo
,

2015 
cu¼’t_ev
, 
’d_buf
, &
iwe
, 
buf
);

2018 ià(
Ï¡_ev
 =ğ
cu¼’t_ev
)

2019  
E2BIG
;

2022 
»q
->
cu¼’t_ev
 = current_ev;

2025 
	}
}

2028 
	$›“80211_ioùl_giwsÿn
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

2029 
iw_pošt
 *
d©a
, *
exŒa
)

2031 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2032 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2033 
iwsÿÄeq
 
»q
;

2034 
»s
 = 0;

2036 
»q
.
v­
 = vap;

2037 
»q
.
šfo
 = info;

2038 
»q
.
cu¼’t_ev
 = 
exŒa
;

2039 ià(
d©a
->
Ëngth
 == 0) {

2040 
»q
.
’d_buf
 = 
exŒa
 + 
IW_SCAN_MAX_DATA
;

2042 
»q
.
’d_buf
 = 
exŒa
 + 
d©a
->
Ëngth
;

2057 
»q
.
mode
 = 
v­
->
iv_æags
 & 
IEEE80211_F_WPA
;

2058 
»s
 = 
	`›“80211_sÿn_™”©e
(
ic
, 
giwsÿn_cb
, &
»q
);

2059 ià(
»s
 == 0) {

2060 
»q
.
mode
 =„eq.mod? 0 : 
IEEE80211_F_WPA
;

2061 
»s
 = 
	`›“80211_sÿn_™”©e
(
ic
, 
giwsÿn_cb
, &
»q
);

2064 
d©a
->
Ëngth
 = 
»q
.
cu¼’t_ev
 - 
exŒa
;

2066 ià(
»s
 != 0) {

2067  -
»s
;

2070  
»s
;

2071 
	}
}

2075 
	$ch”2ÿp
(
ch”
)

2077 
ch”
) {

2078 
IEEE80211_CIPHER_WEP
:  
IEEE80211_C_WEP
;

2079 
IEEE80211_CIPHER_AES_OCB
:  
IEEE80211_C_AES
;

2080 
IEEE80211_CIPHER_AES_CCM
:  
IEEE80211_C_AES_CCM
;

2081 
IEEE80211_CIPHER_CKIP
:  
IEEE80211_C_CKIP
;

2082 
IEEE80211_CIPHER_TKIP
:  
IEEE80211_C_TKIP
;

2085 
	}
}

2087 
	#IEEE80211_MODE_TURBO_STATIC_A
 
IEEE80211_MODE_MAX


	)

2090 
	$›“80211_cÚv”t_mode
(cÚ¡ *
mode
)

2092 
	#TOUPPER
(
c
è((((cè> 0x60è&& ((cè< 0x7b)è? ((cè- 0x20è: (c))

	)

2094 *
Çme
;

2095 
mode
;

2096 } 
m­pšgs
[] = {

2098 { "11AST" , 
IEEE80211_MODE_TURBO_STATIC_A
 },

2099 { "AUTO" , 
IEEE80211_MODE_AUTO
 },

2100 { "11A" , 
IEEE80211_MODE_11A
 },

2101 { "11B" , 
IEEE80211_MODE_11B
 },

2102 { "11G" , 
IEEE80211_MODE_11G
 },

2103 { "FH" , 
IEEE80211_MODE_FH
 },

2104 { "0" , 
IEEE80211_MODE_AUTO
 },

2105 { "1" , 
IEEE80211_MODE_11A
 },

2106 { "2" , 
IEEE80211_MODE_11B
 },

2107 { "3" , 
IEEE80211_MODE_11G
 },

2108 { "4" , 
IEEE80211_MODE_FH
 },

2109 { "5" , 
IEEE80211_MODE_TURBO_STATIC_A
 },

2110 { 
NULL
 }

2112 
i
, 
j
;

2113 cÚ¡ *
ı
;

2115 
i
 = 0; 
m­pšgs
[i].
Çme
 !ğ
NULL
; i++) {

2116 
ı
 = 
m­pšgs
[
i
].
Çme
;

2117 
j
 = 0; j < 
	`¡¾’
(
mode
) + 1; j++) {

2119 ià(
	`TOUPPER
(
mode
[
j
]è!ğ
ı
[j])

2121 ià(
ı
[
j
] == '\0')

2122  
m­pšgs
[
i
].
mode
;

2126 #undeà
TOUPPER


2127 
	}
}

2130 
	$›“80211_ioùl_£tmode
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

2131 
iw_pošt
 *
wri
, *
exŒa
)

2133 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2134 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2135 
iäeq
 
iä
;

2136 
s
[6];

2137 
»tv
, 
mode
, 
iä_mode
;

2139 ià(
ic
->
ic_medŸ
.
ifm_cur
 =ğ
NULL
)

2140  -
EINVAL
;

2141 ià(
wri
->
Ëngth
 > (
s
))

2142 
wri
->
Ëngth
 = (
s
);

2143 ià(
	`cİy_äom_u£r
(
s
, 
wri
->
poš‹r
, wri->
Ëngth
))

2144  -
EFAULT
;

2145 
s
[(s) - 1] = '\0';

2146 
mode
 = 
	`›“80211_cÚv”t_mode
(
s
);

2147 ià(
mode
 < 0)

2148  -
EINVAL
;

2150 ià(
	`›“80211_check_mode_cÚsi¡’cy
(
ic
, 
mode
, 
v­
->
iv_des_chª
)) {

2155 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
)

2156  -
EINVAL
;

2158 
v­
->
iv_des_chª
 = 
IEEE80211_CHAN_ANYC
;

2161 
iä_mode
 = 
mode
;

2162 
	`mem£t
(&
iä
, 0, (ifr));

2163 
iä
.
iä_medŸ
 = 
ic
->
ic_medŸ
.
ifm_cur
->
ifm_medŸ
 & ~
IFM_MMASK
;

2164 ià(
mode
 =ğ
IEEE80211_MODE_TURBO_STATIC_A
)

2165 
iä_mode
 = 
IEEE80211_MODE_11A
;

2166 
iä
.
iä_medŸ
 |ğ
	`IFM_MAKEMODE
(
iä_mode
);

2168 
»tv
 = 
	`ifmedŸ_ioùl
(
ic
->
ic_dev
, &
iä
, &ic->
ic_medŸ
, 
SIOCSIFMEDIA
);

2169 ià((!
»tv
 ||„‘v =ğ-
ENETRESET
è&& (
mode
 !ğ
v­
->
iv_des_mode
)) {

2170 ià(
	`´“m±_sÿn
(
dev
, 100, 100))

2171 
	`›“80211_sÿn_æush
(
ic
);

2173  -
ETIMEDOUT
;

2175 
v­
->
iv_des_mode
 = 
mode
;

2176 ià(
	`IS_UP_AUTO
(
v­
))

2177 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

2179 
»tv
 = 0;

2182 #ifdeà
ATH_SUPERG_XR


2184 ià(
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
))

2185 
v­
->
iv_xrv­
->
iv_des_mode
 = 
mode
;

2188  -
»tv
;

2189 
	}
}

2190 #undeà
IEEE80211_MODE_TURBO_STATIC_A


2192 #ifdeà
ATH_SUPERG_XR


2194 
	$›“80211_£tupxr
(
›“80211v­
 *
v­
)

2196 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

2197 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2198 ià(!(
v­
->
iv_æags
 & 
IEEE80211_F_XR
)) {

2199 ià((
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
è&& !v­->
iv_xrv­
) {

2200 
›“80211v­
 *
xrv­
 = 
NULL
;

2201 
Çme
[
IFNAMSIZ
];

2202 
	`¡rıy
(
Çme
, 
dev
->name);

2203 
	`¡rÿt
(
Çme
, "-xr");

2208 
v­
->
iv_©h_ÿp
 &ğ~
IEEE80211_ATHC_TURBOP
;

2209 
	`›“80211_sÿn_æush
(
ic
);

2211 ià(!(
xrv­
 = 
ic
->
	`ic_v­_ü—‹
(ic, 
Çme
, 
IEEE80211_M_HOSTAP
,

2212 
IEEE80211_VAP_XR
 | 
IEEE80211_CLONE_BSSID
, 
dev
)))

2216 
xrv­
->
iv_xrv­
 = 
v­
;

2217 
xrv­
->
iv_©h_ÿp
 = 
v­
->iv_ath_cap;

2218 
xrv­
->
iv_äagth»shŞd
 = 
IEEE80211_XR_FRAG_THRESHOLD
;

2219 
xrv­
->
iv_des_mode
 = 
v­
->iv_des_mode;

2220 
	`cİy_des_ssid
(
xrv­
, 
v­
);

2222 
v­
->
iv_xrv­
 = 
xrv­
;

2223 } ià(!(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
è&& v­->
iv_xrv­
) {

2228 ià(
v­
->
iv_xrv­
) {

2229 
	`›“80211_¡İ
(
v­
->
iv_xrv­
->
iv_dev
);

2230 
ic
->
	`ic_v­_d–‘e
(
v­
->
iv_xrv­
);

2232 
v­
->
iv_xrv­
 = 
NULL
;

2235 
	}
}

2239 
	$›“80211_£thÿp
(
›“80211v­
 *
v­
, 
ÿp
, 
£‰šg
)

2241 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2242 
oÿp
;

2244 ià((
ic
->
ic_©h_ÿp
 & 
ÿp
) == 0)

2245  
EINVAL
;

2246 
oÿp
 = 
v­
->
iv_©h_ÿp
;

2247 ià(
£‰šg
)

2248 
v­
->
iv_©h_ÿp
 |ğ
ÿp
;

2250 
v­
->
iv_©h_ÿp
 &ğ~
ÿp
;

2251  (
v­
->
iv_©h_ÿp
 !ğ
oÿp
 ? 
ENETRESET
 : 0);

2252 
	}
}

2255 
	$›“80211_£t_turbo
(
Ãt_deviû
 *
dev
, 
æag
)

2257 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2258 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2259 
iäeq
 
iä
;

2260 
›“80211v­
 *
tmpv­
 = 
	`Ãtdev_´iv
(
dev
);

2261 
nv­
 = 0;

2263 
	`TAILQ_FOREACH
(
tmpv­
, &
ic
->
ic_v­s
, 
iv_Ãxt
)

2264 
nv­
++;

2265 ià((
nv­
 > 1è&& 
æag
)

2266  -
EINVAL
;

2267 
iä
.
iä_medŸ
 = 
ic
->
ic_medŸ
.
ifm_cur
->
ifm_medŸ
 &~ 
IFM_MMASK
;

2268 ià(
æag
)

2269 
iä
.
iä_medŸ
 |ğ
IFM_IEEE80211_TURBO
;

2271 
iä
.
iä_medŸ
 &ğ~
IFM_IEEE80211_TURBO
;

2272 (è
	`ifmedŸ_ioùl
(
ic
->
ic_dev
, &
iä
, &ic->
ic_medŸ
, 
SIOCSIFMEDIA
);

2275 
	}
}

2278 
	$›“80211_ioùl_£¬am
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

2279 *
w
, *
exŒa
)

2281 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2282 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2283 
›“80211_r¢·rms
 *
r¢
 = &
v­
->
iv_bss
->
ni_r¢
;

2284 *
i
 = (*)
exŒa
;

2285 
·¿m
 = 
i
[0];

2286 
v®ue
 = 
i
[1];

2287 
»tv
 = 0;

2288 
j
, 
ÿps
, 
bmiss
;

2289 cÚ¡ 
›“80211_auth’tiÿtÜ
 *
auth
;

2290 cÚ¡ 
›“80211_aş©Ü
 *
aş
;

2292 
·¿m
) {

2293 
IEEE80211_PARAM_AUTHMODE
:

2294 
v®ue
) {

2295 
IEEE80211_AUTH_WPA
:

2296 
IEEE80211_AUTH_8021X
:

2297 
IEEE80211_AUTH_OPEN
:

2298 
IEEE80211_AUTH_SHARED
:

2299 
IEEE80211_AUTH_AUTO
:

2300 
auth
 = 
	`›“80211_auth’tiÿtÜ_g‘
(
v®ue
);

2301 ià(
auth
 =ğ
NULL
)

2302  -
EINVAL
;

2305  -
EINVAL
;

2307 
v®ue
) {

2308 
IEEE80211_AUTH_WPA
:

2309 
v®ue
 = 
IEEE80211_AUTH_8021X
;

2311 
IEEE80211_AUTH_OPEN
:

2312 
v­
->
iv_æags
 &ğ~(
IEEE80211_F_WPA
);

2314 
IEEE80211_AUTH_SHARED
:

2315 
IEEE80211_AUTH_AUTO
:

2316 
IEEE80211_AUTH_8021X
:

2317 
v­
->
iv_æags
 &ğ~
IEEE80211_F_WPA
;

2321 
v­
->
iv_bss
->
ni_authmode
 = 
v®ue
;

2323 
v­
->
iv_auth
 = 
auth
;

2324 
»tv
 = 
ENETRESET
;

2326 
IEEE80211_PARAM_PROTMODE
:

2327 ià(
v®ue
 > 
IEEE80211_PROT_RTSCTS
)

2328  -
EINVAL
;

2329 
ic
->
ic_´Ùmode
 = 
v®ue
;

2331 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
 &&

2332 
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
))

2333 
»tv
 = 
ENETRESET
;

2335 
IEEE80211_PARAM_RSSI_EWMA
:

2336 
ic
->
ic_rssi_ewma
 = 
v®ue
;

2338 
IEEE80211_PARAM_MCASTCIPHER
:

2339 ià((
v­
->
iv_ÿps
 & 
	`ch”2ÿp
(
v®ue
)) == 0 &&

2340 !
	`›“80211_üy±o_avaabË
(
v­
, 
v®ue
))

2341  -
EINVAL
;

2342 
r¢
->
r¢_mÿ¡ch”
 = 
v®ue
;

2343 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2344 
»tv
 = 
ENETRESET
;

2346 
IEEE80211_PARAM_MCASTKEYLEN
:

2347 ià(
v®ue
 > 
IEEE80211_KEYBUF_SIZE
)

2348  -
EINVAL
;

2350 
r¢
->
r¢_mÿ¡keyËn
 = 
v®ue
;

2351 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2352 
»tv
 = 
ENETRESET
;

2354 
IEEE80211_PARAM_UCASTCIPHERS
:

2361 
ÿps
 = 0;

2362 
j
 = 1; j < 32; j++)

2363 ià((
v®ue
 & (1 << 
j
)) &&

2364 ((
v­
->
iv_ÿps
 & 
	`ch”2ÿp
(
j
)) ||

2365 
	`›“80211_üy±o_avaabË
(
v­
, 
j
)))

2366 
ÿps
 |ğ1 << 
j
;

2367 ià(
ÿps
 == 0)

2368  -
EINVAL
;

2371 
r¢
->
r¢_uÿ¡ch”£t
 = 
ÿps
;

2372 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2373 
»tv
 = 
ENETRESET
;

2375 
IEEE80211_PARAM_UCASTCIPHER
:

2376 ià(!(
v­
->
iv_ÿps
 & 
	`ch”2ÿp
(
v®ue
)) &&

2377 !
	`›“80211_üy±o_avaabË
(
v­
, 
v®ue
))

2378  -
EINVAL
;

2379 
r¢
->
r¢_uÿ¡ch”
 = 
v®ue
;

2380 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2381 
»tv
 = 
ENETRESET
;

2383 
IEEE80211_PARAM_UCASTKEYLEN
:

2384 ià(
v®ue
 > 
IEEE80211_KEYBUF_SIZE
)

2385  -
EINVAL
;

2387 
r¢
->
r¢_uÿ¡keyËn
 = 
v®ue
;

2389 
IEEE80211_PARAM_KEYMGTALGS
:

2391 
r¢
->
r¢_keymgmt£t
 = 
v®ue
;

2392 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2393 
»tv
 = 
ENETRESET
;

2395 
IEEE80211_PARAM_RSNCAPS
:

2397 
r¢
->
r¢_ÿps
 = 
v®ue
;

2398 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2399 
»tv
 = 
ENETRESET
;

2401 
IEEE80211_PARAM_WPA
:

2402 ià(
v®ue
 > 3)

2403  -
EINVAL
;

2405 
v­
->
iv_æags
 &ğ~
IEEE80211_F_WPA
;

2406 
v®ue
) {

2408 
v­
->
iv_æags
 |ğ
IEEE80211_F_WPA1
;

2411 
v­
->
iv_æags
 |ğ
IEEE80211_F_WPA2
;

2414 
v­
->
iv_æags
 |ğ
IEEE80211_F_WPA1
 | 
IEEE80211_F_WPA2
;

2417 
»tv
 = 
ENETRESET
;

2419 
IEEE80211_PARAM_ROAMING
:

2420 
v®ue
) {

2421 
IEEE80211_ROAMING_DEVICE
:

2422 
IEEE80211_ROAMING_AUTO
:

2423 
IEEE80211_ROAMING_MANUAL
:

2424 
ic
->
ic_rßmšg
 = 
v®ue
;

2427  -
EINVAL
;

2430 
IEEE80211_PARAM_PRIVACY
:

2431 ià(
v®ue
) {

2433 
v­
->
iv_æags
 |ğ
IEEE80211_F_PRIVACY
;

2435 
v­
->
iv_æags
 &ğ~
IEEE80211_F_PRIVACY
;

2437 
IEEE80211_PARAM_DROPUNENCRYPTED
:

2438 ià(
v®ue
)

2439 
v­
->
iv_æags
 |ğ
IEEE80211_F_DROPUNENC
;

2441 
v­
->
iv_æags
 &ğ~
IEEE80211_F_DROPUNENC
;

2443 
IEEE80211_PARAM_DROPUNENC_EAPOL
:

2444 ià(
v®ue
)

2445 
	`IEEE80211_VAP_DROPUNENC_EAPOL_ENABLE
(
v­
);

2447 
	`IEEE80211_VAP_DROPUNENC_EAPOL_DISABLE
(
v­
);

2449 
IEEE80211_PARAM_COUNTERMEASURES
:

2450 ià(
v®ue
) {

2451 ià((
v­
->
iv_æags
 & 
IEEE80211_F_WPA
) == 0)

2452  -
EINVAL
;

2453 
v­
->
iv_æags
 |ğ
IEEE80211_F_COUNTERM
;

2455 
v­
->
iv_æags
 &ğ~
IEEE80211_F_COUNTERM
;

2457 
IEEE80211_PARAM_DRIVER_CAPS
:

2458 
v­
->
iv_ÿps
 = 
v®ue
;

2460 
IEEE80211_PARAM_MACCMD
:

2461 
aş
 = 
v­
->
iv_aş
;

2462 
v®ue
) {

2463 
IEEE80211_MACCMD_POLICY_OPEN
:

2464 
IEEE80211_MACCMD_POLICY_ALLOW
:

2465 
IEEE80211_MACCMD_POLICY_DENY
:

2466 ià(
aş
 =ğ
NULL
) {

2467 
aş
 = 
	`›“80211_aş©Ü_g‘
("mac");

2468 ià(
aş
 =ğ
NULL
 || !aş->
	`Ÿc_©ch
(
v­
))

2469  -
EINVAL
;

2470 
v­
->
iv_aş
 = 
aş
;

2472 
aş
->
	`Ÿc_£Şicy
(
v­
, 
v®ue
);

2474 
IEEE80211_MACCMD_FLUSH
:

2475 ià(
aş
 !ğ
NULL
)

2476 
aş
->
	`Ÿc_æush
(
v­
);

2479 
IEEE80211_MACCMD_DETACH
:

2480 ià(
aş
 !ğ
NULL
) {

2481 
v­
->
iv_aş
 = 
NULL
;

2482 
aş
->
	`Ÿc_d‘ach
(
v­
);

2487 
IEEE80211_PARAM_WMM
:

2488 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_WME
){

2489 
»tv
 = 
ENETRESET
;

2491 ià(
v®ue
) {

2495 ià(!(
v­
->
iv_ic
->
ic_ÿps
 & 
IEEE80211_C_WME_TKIPMIC
))

2496 
»tv
 = 
EBUSY
;

2498 
v­
->
iv_æags
 |ğ
IEEE80211_F_WME
;

2499 
v­
->
iv_ic
->
ic_æags
 |ğ
IEEE80211_F_WME
;

2502 
v­
->
iv_æags
 &ğ~
IEEE80211_F_WME
;

2505 
›“80211v­
 *
v
 = 
NULL
;

2506 
®l
 = 1;

2508 
	`TAILQ_FOREACH
(
v
, &
v­
->
iv_ic
->
ic_v­s
, 
iv_Ãxt
) {

2509 ià(
v
->
iv_æags
 & 
IEEE80211_F_WME
) {

2510 
®l
 = 0;

2515 ià(
®l
)

2516 
v­
->
iv_ic
->
ic_æags
 &ğ~
IEEE80211_F_WME
;

2522 
IEEE80211_PARAM_HIDESSID
:

2523 ià(
v®ue
)

2524 
v­
->
iv_æags
 |ğ
IEEE80211_F_HIDESSID
;

2526 
v­
->
iv_æags
 &ğ~
IEEE80211_F_HIDESSID
;

2527 
»tv
 = 
ENETRESET
;

2529 
IEEE80211_PARAM_APBRIDGE
:

2530 ià(
v®ue
 == 0)

2531 
v­
->
iv_æags
 |ğ
IEEE80211_F_NOBRIDGE
;

2533 
v­
->
iv_æags
 &ğ~
IEEE80211_F_NOBRIDGE
;

2535 
IEEE80211_PARAM_INACT
:

2536 
v­
->
iv_šaù_run
 = 
v®ue
 / 
IEEE80211_INACT_WAIT
;

2538 
IEEE80211_PARAM_INACT_AUTH
:

2539 
v­
->
iv_šaù_auth
 = 
v®ue
 / 
IEEE80211_INACT_WAIT
;

2541 
IEEE80211_PARAM_INACT_INIT
:

2542 
v­
->
iv_šaù_š™
 = 
v®ue
 / 
IEEE80211_INACT_WAIT
;

2544 
IEEE80211_PARAM_ABOLT
:

2545 
ÿps
 = 0;

2550 ià(
v®ue
 & 
IEEE80211_ABOLT_TURBO_PRIME
)

2551 
ÿps
 |ğ
IEEE80211_ATHC_TURBOP
;

2552 ià(
v®ue
 & 
IEEE80211_ABOLT_COMPRESSION
)

2553 
ÿps
 |ğ
IEEE80211_ATHC_COMP
;

2554 ià(
v®ue
 & 
IEEE80211_ABOLT_FAST_FRAME
)

2555 
ÿps
 |ğ
IEEE80211_ATHC_FF
;

2556 ià(
v®ue
 & 
IEEE80211_ABOLT_XR
)

2557 
ÿps
 |ğ
IEEE80211_ATHC_XR
;

2558 ià(
v®ue
 & 
IEEE80211_ABOLT_AR
)

2559 
ÿps
 |ğ
IEEE80211_ATHC_AR
;

2560 ià(
v®ue
 & 
IEEE80211_ABOLT_BURST
)

2561 
ÿps
 |ğ
IEEE80211_ATHC_BURST
;

2563 ià((
ÿps
 & 
ic
->
ic_©h_ÿp
) != caps)

2564  -
EINVAL
;

2565 ià(
v­
->
iv_©h_ÿp
 !ğ
ÿps
) {

2566 ià((
v­
->
iv_©h_ÿp
 ^ 
ÿps
è& 
IEEE80211_ATHC_TURBOP
) {

2568 ià((
ÿps
 & 
IEEE80211_ATHC_TURBOP
) &&

2569 (
ÿps
 & 
IEEE80211_ATHC_XR
))

2570  -
EINVAL
;

2571 ià(
	`›“80211_£t_turbo
(
dev
,

2572 (
ÿps
 & 
IEEE80211_ATHC_TURBOP
)))

2573  -
EINVAL
;

2574 
	`›“80211_sÿn_æush
(
ic
);

2576 
v­
->
iv_©h_ÿp
 = 
ÿps
;

2577 #ifdeà
ATH_SUPERG_XR


2578 
	`›“80211_£tupxr
(
v­
);

2580 
»tv
 = 
ENETRESET
;

2583 
IEEE80211_PARAM_DTIM_PERIOD
:

2584 ià((
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
) &&

2585 (
v­
->
iv_İmode
 !ğ
IEEE80211_M_IBSS
))

2586  -
EOPNOTSUPP
;

2587 ià((
IEEE80211_DTIM_MIN
 <ğ
v®ue
) &&

2588 (
v®ue
 <ğ
IEEE80211_DTIM_MAX
)) {

2589 
v­
->
iv_dtim_³riod
 = 
v®ue
;

2590 
»tv
 = 
ENETRESET
;

2592 
»tv
 = 
EINVAL
;

2594 
IEEE80211_PARAM_DRAINTXQ
:

2595 
IEEE80211_PARAM_STOP_QUEUE
:

2596 
IEEE80211_PARAM_ATHRESET
:

2597 
IEEE80211_PARAM_TXTIMEOUT
:

2598 
IEEE80211_PARAM_RESETTXBUFS
:

2599 
IEEE80211_PARAM_SCANBUFS
:

2600 
IEEE80211_PARAM_LEAKTXBUFS
:

2601 
»tv
 = 
ic
->
	`ic_debug_©h_iw´iv
(ic, 
·¿m
, 
v®ue
);

2604 
IEEE80211_PARAM_BEACON_MISS_THRESH_MS
:

2605 ià((
v­
->
iv_İmode
 !ğ
IEEE80211_M_IBSS
) &&

2606 (
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
))

2607  -
EOPNOTSUPP
;

2609 
bmiss
 = 
	`howmªy
(
	`IEEE80211_MS_TO_TU
(
v®ue
), 
ic
->
ic_lštv®
);

2610 ià(
	`IEEE80211_BMISSTHRESH_VALID
(
bmiss
)) {

2611 
ic
->
ic_bmis¡h»shŞd
 = 
bmiss
;

2612 
»tv
 = 
ENETRESET
;

2614 
»tv
 = 
EINVAL
;

2616 
IEEE80211_PARAM_BEACON_MISS_THRESH
:

2617 ià((
v­
->
iv_İmode
 !ğ
IEEE80211_M_IBSS
) &&

2618 (
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
))

2619  -
EOPNOTSUPP
;

2620 ià(
	`IEEE80211_BMISSTHRESH_VALID
(
v®ue
)) {

2621 
ic
->
ic_bmis¡h»shŞd
 = 
v®ue
;

2622 
»tv
 = 
ENETRESET
;

2624 
»tv
 = 
EINVAL
;

2626 
IEEE80211_PARAM_BEACON_INTERVAL
:

2627 ià((
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
) &&

2628 (
v­
->
iv_İmode
 !ğ
IEEE80211_M_IBSS
))

2629  -
EOPNOTSUPP
;

2630 ià(
	`IEEE80211_BINTVAL_VALID
(
v®ue
)) {

2633 
bmiss
 = 
	`howmªy
(
ic
->
ic_bmis¡h»shŞd
 *

2634 
ic
->
ic_lštv®
, 
v®ue
);

2639 
ic
->
ic_bmis¡h»shŞd
 = 
bmiss
;

2640 
ic
->
ic_lštv®
 = 
v®ue
;

2641 
»tv
 = 
ENETRESET
;

2643 
»tv
 = 
EINVAL
;

2645 
IEEE80211_PARAM_DOTH
:

2646 ià(
v®ue
)

2647 
ic
->
ic_æags
 |ğ
IEEE80211_F_DOTH
;

2649 
ic
->
ic_æags
 &ğ~
IEEE80211_F_DOTH
;

2650 
»tv
 = 
ENETRESET
;

2652 
IEEE80211_PARAM_SHPREAMBLE
:

2653 ià(
v®ue
) {

2654 
ic
->
ic_ÿps
 |ğ
IEEE80211_C_SHPREAMBLE
;

2655 
ic
->
ic_æags
 |ğ
IEEE80211_F_SHPREAMBLE
;

2656 
ic
->
ic_æags
 &ğ~
IEEE80211_F_USEBARKER
;

2658 
ic
->
ic_ÿps
 &ğ~
IEEE80211_C_SHPREAMBLE
;

2659 
ic
->
ic_æags
 &ğ~
IEEE80211_F_SHPREAMBLE
;

2660 
ic
->
ic_æags
 |ğ
IEEE80211_F_USEBARKER
;

2662 
»tv
 = 
ENETRESET
;

2664 
IEEE80211_PARAM_PWRTARGET
:

2665 
ic
->
ic_curchªmaxpwr
 = 
v®ue
;

2667 
IEEE80211_PARAM_GENREASSOC
:

2668 
	`IEEE80211_SEND_MGMT
(
v­
->
iv_bss
, 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
, 0);

2670 
IEEE80211_PARAM_DOTH_ALGORITHM
:

2671 
ic
->
ic_sc_®gÜ™hm
 = 
v®ue
;

2673 
IEEE80211_PARAM_DOTH_MINCOM
:

2674 
ic
->
ic_sc_mšcom
 = 
v®ue
;

2676 
IEEE80211_PARAM_DOTH_SLCG
:

2677 
ic
->
ic_sc_¦cg
 = 
v®ue
;

2679 
IEEE80211_PARAM_DOTH_SLDG
:

2680 
ic
->
ic_sc_¦dg
 = 
v®ue
;

2682 
IEEE80211_PARAM_DFS_TESTMODE
:

2683 
	`›“80211_£t_dfs_‹¡mode
(
dev
, 
šfo
, 
w
, 
exŒa
);

2685 
IEEE80211_PARAM_TXCONT
:

2686 
	`›“80211_£t_txcÚt
(
dev
, 
šfo
, 
w
, 
exŒa
);

2688 
IEEE80211_PARAM_TXCONT_RATE
:

2689 
	`›“80211_£t_txcÚt_¿‹
(
dev
, 
šfo
, 
w
, 
exŒa
);

2691 
IEEE80211_PARAM_TXCONT_POWER
:

2692 
	`›“80211_£t_txcÚt_pow”
(
dev
, 
šfo
, 
w
, 
exŒa
);

2694 
IEEE80211_PARAM_DFS_CACTIME
:

2695 
	`›“80211_£t_dfs_ÿc_time
(
dev
, 
šfo
, 
w
, 
exŒa
);

2697 
IEEE80211_PARAM_DFS_EXCLPERIOD
:

2698 
	`›“80211_£t_dfs_exş_³riod
(
dev
, 
šfo
, 
w
, 
exŒa
);

2700 
IEEE80211_PARAM_COMPRESSION
:

2701 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_COMP
, 
v®ue
);

2703 
IEEE80211_PARAM_FF
:

2704 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_FF
, 
v®ue
);

2706 
IEEE80211_PARAM_TURBO
:

2707 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_TURBOP
, 
v®ue
);

2708 ià(
»tv
 =ğ
ENETRESET
) {

2710 ià((
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
è&& 
v®ue
)

2711  -
EINVAL
;

2712 ià(
	`›“80211_£t_turbo
(
dev
, 
v®ue
))

2713  -
EINVAL
;

2714 
	`›“80211_sÿn_æush
(
ic
);

2717 
IEEE80211_PARAM_XR
:

2719 ià((
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
è&& 
v®ue
)

2720  -
EINVAL
;

2721 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_XR
, 
v®ue
);

2722 #ifdeà
ATH_SUPERG_XR


2723 
	`›“80211_£tupxr
(
v­
);

2726 
IEEE80211_PARAM_BURST
:

2727 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_BURST
, 
v®ue
);

2729 
IEEE80211_PARAM_AR
:

2730 
»tv
 = 
	`›“80211_£thÿp
(
v­
, 
IEEE80211_ATHC_AR
, 
v®ue
);

2732 
IEEE80211_PARAM_PUREG
:

2733 ià(
v®ue
)

2734 
v­
->
iv_æags
 |ğ
IEEE80211_F_PUREG
;

2736 
v­
->
iv_æags
 &ğ~
IEEE80211_F_PUREG
;

2738 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
 &&

2739 
	`IEEE80211_IS_CHAN_ANYG
(
ic
->
ic_bsschª
))

2740 
»tv
 = 
ENETRESET
;

2742 
IEEE80211_PARAM_WDS
:

2743 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_IBSS
) ||

2744 (
v­
->
iv_İmode
 =ğ
IEEE80211_M_AHDEMO
))

2745  -
EOPNOTSUPP
;

2746 ià(
v®ue
)

2747 
v­
->
iv_æags_ext
 |ğ
IEEE80211_FEXT_WDS
;

2749 
v­
->
iv_æags_ext
 &ğ~
IEEE80211_FEXT_WDS
;

2751 
IEEE80211_PARAM_BGSCAN
:

2752 ià(
v®ue
) {

2753 ià((
v­
->
iv_ÿps
 & 
IEEE80211_C_BGSCAN
) == 0)

2754  -
EINVAL
;

2755 
v­
->
iv_æags
 |ğ
IEEE80211_F_BGSCAN
;

2758 
v­
->
iv_æags
 &ğ~
IEEE80211_F_BGSCAN
;

2759 
	`›“80211_ÿnûl_sÿn
(
v­
);

2762 
IEEE80211_PARAM_BGSCAN_IDLE
:

2763 ià(
v®ue
 >ğ
IEEE80211_BGSCAN_IDLE_MIN
)

2764 
v­
->
iv_bgsÿnidË
 = 
	`m£cs_to_jiff›s
(
v®ue
);

2766 
»tv
 = 
EINVAL
;

2768 
IEEE80211_PARAM_BGSCAN_INTERVAL
:

2769 ià(
v®ue
 >ğ
IEEE80211_BGSCAN_INTVAL_MIN
)

2770 
v­
->
iv_bgsÿnštvl
 = 
v®ue
 * 
HZ
;

2772 
»tv
 = 
EINVAL
;

2774 
IEEE80211_PARAM_MCAST_RATE
:

2776 ià(
v®ue
 >= 256 && value <= 54000)

2777 
v­
->
iv_mÿ¡_¿‹
 = 
v®ue
;

2779 
»tv
 = 
EINVAL
;

2781 
IEEE80211_PARAM_COVERAGE_CLASS
:

2782 ià(
v®ue
 <ğ
IEEE80211_COVERAGE_CLASS_MAX
) {

2783 
ic
->
ic_cov”ageşass
 = 
v®ue
;

2784 ià(
	`IS_UP_AUTO
(
v­
))

2785 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

2786 
»tv
 = 0;

2788 
»tv
 = 
EINVAL
;

2790 
IEEE80211_PARAM_COUNTRY_IE
:

2791 ià(
v®ue
)

2792 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_COUNTRYIE
;

2794 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_COUNTRYIE
;

2795 
»tv
 = 
ENETRESET
;

2797 
IEEE80211_PARAM_REGCLASS
:

2798 ià(
v®ue
)

2799 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_REGCLASS
;

2801 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_REGCLASS
;

2802 
»tv
 = 
ENETRESET
;

2804 
IEEE80211_PARAM_SCANVALID
:

2805 
v­
->
iv_sÿnv®id
 = 
v®ue
 * 
HZ
;

2807 
IEEE80211_PARAM_ROAM_RSSI_11A
:

2808 
v­
->
iv_rßm
.
rssi11a
 = 
v®ue
;

2810 
IEEE80211_PARAM_ROAM_RSSI_11B
:

2811 
v­
->
iv_rßm
.
rssi11bOÆy
 = 
v®ue
;

2813 
IEEE80211_PARAM_ROAM_RSSI_11G
:

2814 
v­
->
iv_rßm
.
rssi11g
 = 
v®ue
;

2816 
IEEE80211_PARAM_ROAM_RATE_11A
:

2817 
v­
->
iv_rßm
.
¿‹11a
 = 
v®ue
;

2819 
IEEE80211_PARAM_ROAM_RATE_11B
:

2820 
v­
->
iv_rßm
.
¿‹11bOÆy
 = 
v®ue
;

2822 
IEEE80211_PARAM_ROAM_RATE_11G
:

2823 
v­
->
iv_rßm
.
¿‹11g
 = 
v®ue
;

2825 
IEEE80211_PARAM_UAPSDINFO
:

2826 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

2827 ià(
ic
->
ic_ÿps
 & 
IEEE80211_C_UAPSD
) {

2828 ià(
v®ue
)

2829 
	`IEEE80211_VAP_UAPSD_ENABLE
(
v­
);

2831 
	`IEEE80211_VAP_UAPSD_DISABLE
(
v­
);

2832 
»tv
 = 
ENETRESET
;

2834 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

2835 
v­
->
iv_u­sdšfo
 = 
v®ue
;

2836 
	`IEEE80211_VAP_UAPSD_ENABLE
(
v­
);

2837 
»tv
 = 
ENETRESET
;

2840 
IEEE80211_PARAM_SLEEP
:

2844 ià(
v®ue
) {

2846 
	`IEEE80211_VAP_GOTOSLEEP
(
v­
);

2849 
	`IEEE80211_VAP_WAKEUP
(
v­
);

2851 
	`›“80211_£nd_nuÎd©a
(
	`›“80211_»f_node
(
v­
->
iv_bss
));

2853 
IEEE80211_PARAM_QOSNULL
:

2855 
	`›“80211_£nd_qo¢uÎd©a
(
v­
->
iv_bss
, 
v®ue
);

2857 
IEEE80211_PARAM_PSPOLL
:

2859 
	`›“80211_£nd_p¥Şl
(
v­
->
iv_bss
);

2861 
IEEE80211_PARAM_EOSPDROP
:

2862 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

2863 ià(
v®ue
)

2864 
	`IEEE80211_VAP_EOSPDROP_ENABLE
(
v­
);

2866 
	`IEEE80211_VAP_EOSPDROP_DISABLE
(
v­
);

2869 
IEEE80211_PARAM_MARKDFS
:

2870 ià(
v®ue
)

2871 
ic
->
ic_æags_ext
 |ğ
IEEE80211_FEXT_MARKDFS
;

2873 
ic
->
ic_æags_ext
 &ğ~
IEEE80211_FEXT_MARKDFS
;

2875 #ifdeà
ATH_REVERSE_ENGINEERING


2876 
IEEE80211_PARAM_DUMPREGS
:

2877 
	`›“80211_dump_»gi¡”s
(
dev
, 
šfo
, 
w
, 
exŒa
);

2881 
»tv
 = 
EOPNOTSUPP
;

2884 #ifdeà
ATH_SUPERG_XR


2886 ià(
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
)) {

2887 
	`›“80211_ioùl_£¬am
(
v­
->
iv_xrv­
->
iv_dev
, 
šfo
, 
w
, 
exŒa
);

2889 
v­
->
iv_xrv­
->
iv_©h_ÿp
 &ğ
IEEE80211_ATHC_XR
;

2895 ià(!
v­
->
iv_xrv­
 || (v­->iv_xrv­ && !(v­->
iv_æags
 & 
IEEE80211_F_XR
))) {

2896 ià(
»tv
 =ğ
ENETRESET
)

2897 
»tv
 = 
	`IS_UP_AUTO
(
v­
è? 
	`›“80211_İ’
(v­->
iv_dev
) : 0;

2901 ià(
»tv
 =ğ
ENETRESET
)

2902 
»tv
 = 
	`IS_UP_AUTO
(
v­
è? 
	`›“80211_İ’
(v­->
iv_dev
) : 0;

2904  -
»tv
;

2905 
	}
}

2909 
	$ÿp2ch”
(
æag
)

2911 
æag
) {

2912 
IEEE80211_C_WEP
:  
IEEE80211_CIPHER_WEP
;

2913 
IEEE80211_C_AES
:  
IEEE80211_CIPHER_AES_OCB
;

2914 
IEEE80211_C_AES_CCM
:  
IEEE80211_CIPHER_AES_CCM
;

2915 
IEEE80211_C_CKIP
:  
IEEE80211_CIPHER_CKIP
;

2916 
IEEE80211_C_TKIP
:  
IEEE80211_CIPHER_TKIP
;

2919 
	}
}

2923 
	$›“80211_ioùl_g‘mode
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

2924 
iw_pošt
 *
wri
, *
exŒa
)

2926 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2927 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2928 
ifmedŸ»q
 
imr
;

2930 
ic
->
ic_medŸ
.
	`ifm_¡©us
(ic->
ic_dev
, &
imr
);

2931 
	`IFM_MODE
(
imr
.
ifm_aùive
)) {

2932 
IFM_IEEE80211_11A
:

2933 
	`¡rıy
(
exŒa
, "11a");

2935 
IFM_IEEE80211_11B
:

2936 
	`¡rıy
(
exŒa
, "11b");

2938 
IFM_IEEE80211_11G
:

2939 
	`¡rıy
(
exŒa
, "11g");

2941 
IFM_IEEE80211_FH
:

2942 
	`¡rıy
(
exŒa
, "FH");

2944 
IFM_AUTO
:

2945 
	`¡rıy
(
exŒa
, "auto");

2948  -
EINVAL
;

2950 ià(
ic
->
ic_medŸ
.
ifm_medŸ
 & 
IFM_IEEE80211_TURBO
) {

2951 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
)

2952 
	`¡rÿt
(
exŒa
, "T");

2954 
	`¡rÿt
(
exŒa
, "ST");

2956 
wri
->
Ëngth
 = 
	`¡¾’
(
exŒa
);

2958 
	}
}

2961 
	$›“80211_ioùl_g‘·¿m
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

2962 *
w
, *
exŒa
)

2964 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

2965 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

2966 
›“80211_r¢·rms
 *
r¢
 = &
v­
->
iv_bss
->
ni_r¢
;

2967 *
·¿m
 = (*)
exŒa
;

2969 
·¿m
[0]) {

2970 
IEEE80211_PARAM_AUTHMODE
:

2971 ià(
v­
->
iv_æags
 & 
IEEE80211_F_WPA
)

2972 
·¿m
[0] = 
IEEE80211_AUTH_WPA
;

2974 
·¿m
[0] = 
v­
->
iv_bss
->
ni_authmode
;

2976 
IEEE80211_PARAM_PROTMODE
:

2977 
·¿m
[0] = 
ic
->
ic_´Ùmode
;

2979 
IEEE80211_PARAM_RSSI_EWMA
:

2980 
·¿m
[0] = 
ic
->
ic_rssi_ewma
;

2982 
IEEE80211_PARAM_MCASTCIPHER
:

2983 
·¿m
[0] = 
r¢
->
r¢_mÿ¡ch”
;

2985 
IEEE80211_PARAM_MCASTKEYLEN
:

2986 
·¿m
[0] = 
r¢
->
r¢_mÿ¡keyËn
;

2988 
IEEE80211_PARAM_UCASTCIPHERS
:

2989 
·¿m
[0] = 
r¢
->
r¢_uÿ¡ch”£t
;

2991 
IEEE80211_PARAM_UCASTCIPHER
:

2992 
·¿m
[0] = 
r¢
->
r¢_uÿ¡ch”
;

2994 
IEEE80211_PARAM_UCASTKEYLEN
:

2995 
·¿m
[0] = 
r¢
->
r¢_uÿ¡keyËn
;

2997 
IEEE80211_PARAM_KEYMGTALGS
:

2998 
·¿m
[0] = 
r¢
->
r¢_keymgmt£t
;

3000 
IEEE80211_PARAM_RSNCAPS
:

3001 
·¿m
[0] = 
r¢
->
r¢_ÿps
;

3003 
IEEE80211_PARAM_WPA
:

3004 
v­
->
iv_æags
 & 
IEEE80211_F_WPA
) {

3005 
IEEE80211_F_WPA1
:

3006 
·¿m
[0] = 1;

3008 
IEEE80211_F_WPA2
:

3009 
·¿m
[0] = 2;

3011 
IEEE80211_F_WPA1
 | 
IEEE80211_F_WPA2
:

3012 
·¿m
[0] = 3;

3015 
·¿m
[0] = 0;

3019 
IEEE80211_PARAM_ROAMING
:

3020 
·¿m
[0] = 
ic
->
ic_rßmšg
;

3022 
IEEE80211_PARAM_PRIVACY
:

3023 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_PRIVACY
) != 0;

3025 
IEEE80211_PARAM_DROPUNENCRYPTED
:

3026 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_DROPUNENC
) != 0;

3028 
IEEE80211_PARAM_DROPUNENC_EAPOL
:

3029 
·¿m
[0] = 
	`IEEE80211_VAP_DROPUNENC_EAPOL
(
v­
);

3031 
IEEE80211_PARAM_COUNTERMEASURES
:

3032 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_COUNTERM
) != 0;

3034 
IEEE80211_PARAM_DRIVER_CAPS
:

3035 
·¿m
[0] = 
v­
->
iv_ÿps
;

3037 
IEEE80211_PARAM_WMM
:

3038 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_WME
) != 0;

3040 
IEEE80211_PARAM_HIDESSID
:

3041 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_HIDESSID
) != 0;

3043 
IEEE80211_PARAM_APBRIDGE
:

3044 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_NOBRIDGE
) == 0;

3046 
IEEE80211_PARAM_INACT
:

3047 
·¿m
[0] = 
v­
->
iv_šaù_run
 * 
IEEE80211_INACT_WAIT
;

3049 
IEEE80211_PARAM_INACT_AUTH
:

3050 
·¿m
[0] = 
v­
->
iv_šaù_auth
 * 
IEEE80211_INACT_WAIT
;

3052 
IEEE80211_PARAM_INACT_INIT
:

3053 
·¿m
[0] = 
v­
->
iv_šaù_š™
 * 
IEEE80211_INACT_WAIT
;

3055 
IEEE80211_PARAM_ABOLT
:

3059 
·¿m
[0] = 0;

3060 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_COMP
)

3061 
·¿m
[0] |ğ
IEEE80211_ABOLT_COMPRESSION
;

3062 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_FF
)

3063 
·¿m
[0] |ğ
IEEE80211_ABOLT_FAST_FRAME
;

3064 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
)

3065 
·¿m
[0] |ğ
IEEE80211_ABOLT_XR
;

3066 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_BURST
)

3067 
·¿m
[0] |ğ
IEEE80211_ABOLT_BURST
;

3068 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
)

3069 
·¿m
[0] |ğ
IEEE80211_ABOLT_TURBO_PRIME
;

3070 ià(
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_AR
)

3071 
·¿m
[0] |ğ
IEEE80211_ABOLT_AR
;

3073 
IEEE80211_PARAM_COMPRESSION
:

3074 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_COMP
) != 0;

3076 
IEEE80211_PARAM_FF
:

3077 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_FF
) != 0;

3079 
IEEE80211_PARAM_XR
:

3080 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_XR
) != 0;

3082 
IEEE80211_PARAM_BURST
:

3083 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_BURST
) != 0;

3085 
IEEE80211_PARAM_AR
:

3086 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_AR
) != 0;

3088 
IEEE80211_PARAM_TURBO
:

3089 
·¿m
[0] = (
v­
->
iv_©h_ÿp
 & 
IEEE80211_ATHC_TURBOP
) != 0;

3091 
IEEE80211_PARAM_DTIM_PERIOD
:

3092 
·¿m
[0] = 
v­
->
iv_dtim_³riod
;

3094 
IEEE80211_PARAM_BEACON_MISS_THRESH_MS
:

3095 
·¿m
[0] = 
	`IEEE80211_TU_TO_MS
(

3096 
v­
->
iv_ic
->
ic_bmis¡h»shŞd
 * v­->iv_ic->
ic_lštv®
);

3098 
IEEE80211_PARAM_BEACON_MISS_THRESH
:

3099 
·¿m
[0] = 
v­
->
iv_ic
->
ic_bmis¡h»shŞd
;

3101 
IEEE80211_PARAM_BEACON_INTERVAL
:

3103 
·¿m
[0] = 
v­
->
iv_bss
->
ni_štv®
;

3105 
IEEE80211_PARAM_DOTH
:

3106 
·¿m
[0] = (
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
) != 0;

3108 
IEEE80211_PARAM_SHPREAMBLE
:

3109 
·¿m
[0] = (
ic
->
ic_ÿps
 & 
IEEE80211_C_SHPREAMBLE
) != 0;

3111 
IEEE80211_PARAM_PWRTARGET
:

3112 
·¿m
[0] = 
ic
->
ic_curchªmaxpwr
;

3114 
IEEE80211_PARAM_DOTH_ALGORITHM
:

3115 
·¿m
[0] = 
ic
->
ic_sc_®gÜ™hm
;

3117 
IEEE80211_PARAM_DOTH_MINCOM
:

3118 
·¿m
[0] = 
ic
->
ic_sc_mšcom
;

3120 
IEEE80211_PARAM_DOTH_SLCG
:

3121 
·¿m
[0] = 
ic
->
ic_sc_¦cg
;

3123 
IEEE80211_PARAM_DOTH_SLDG
:

3124 
·¿m
[0] = 
ic
->
ic_sc_¦dg
;

3126 
IEEE80211_PARAM_DFS_TESTMODE
:

3127 
	`›“80211_g‘_dfs_‹¡mode
(
dev
, 
šfo
, 
w
, 
exŒa
);

3129 
IEEE80211_PARAM_TXCONT
:

3130 
	`›“80211_g‘_txcÚt
(
dev
, 
šfo
, 
w
, 
exŒa
);

3132 
IEEE80211_PARAM_TXCONT_RATE
:

3133 
	`›“80211_g‘_txcÚt_¿‹
(
dev
, 
šfo
, 
w
, 
exŒa
);

3135 
IEEE80211_PARAM_TXCONT_POWER
:

3136 
	`›“80211_g‘_txcÚt_pow”
(
dev
, 
šfo
, 
w
, 
exŒa
);

3138 
IEEE80211_PARAM_DFS_CACTIME
:

3139 
	`›“80211_g‘_dfs_ÿc_time
(
dev
, 
šfo
, 
w
, 
exŒa
);

3141 
IEEE80211_PARAM_DFS_EXCLPERIOD
:

3142 
	`›“80211_g‘_dfs_exş_³riod
(
dev
, 
šfo
, 
w
, 
exŒa
);

3144 
IEEE80211_PARAM_PUREG
:

3145 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_PUREG
) != 0;

3147 
IEEE80211_PARAM_WDS
:

3148 
·¿m
[0] = ((
v­
->
iv_æags_ext
 & 
IEEE80211_FEXT_WDS
) == IEEE80211_FEXT_WDS);

3150 
IEEE80211_PARAM_BGSCAN
:

3151 
·¿m
[0] = (
v­
->
iv_æags
 & 
IEEE80211_F_BGSCAN
) != 0;

3153 
IEEE80211_PARAM_BGSCAN_IDLE
:

3154 
·¿m
[0] = 
	`jiff›s_to_m£cs
(
v­
->
iv_bgsÿnidË
);

3156 
IEEE80211_PARAM_BGSCAN_INTERVAL
:

3157 
·¿m
[0] = 
v­
->
iv_bgsÿnštvl
 / 
HZ
;

3159 
IEEE80211_PARAM_MCAST_RATE
:

3160 
·¿m
[0] = 
v­
->
iv_mÿ¡_¿‹
;

3162 
IEEE80211_PARAM_COVERAGE_CLASS
:

3163 
·¿m
[0] = 
ic
->
ic_cov”ageşass
;

3165 
IEEE80211_PARAM_COUNTRY_IE
:

3166 
·¿m
[0] = (
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_COUNTRYIE
) != 0;

3168 
IEEE80211_PARAM_REGCLASS
:

3169 
·¿m
[0] = (
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_REGCLASS
) != 0;

3171 
IEEE80211_PARAM_SCANVALID
:

3172 
·¿m
[0] = 
v­
->
iv_sÿnv®id
 / 
HZ
;

3174 
IEEE80211_PARAM_ROAM_RSSI_11A
:

3175 
·¿m
[0] = 
v­
->
iv_rßm
.
rssi11a
;

3177 
IEEE80211_PARAM_ROAM_RSSI_11B
:

3178 
·¿m
[0] = 
v­
->
iv_rßm
.
rssi11bOÆy
;

3180 
IEEE80211_PARAM_ROAM_RSSI_11G
:

3181 
·¿m
[0] = 
v­
->
iv_rßm
.
rssi11g
;

3183 
IEEE80211_PARAM_ROAM_RATE_11A
:

3184 
·¿m
[0] = 
v­
->
iv_rßm
.
¿‹11a
;

3186 
IEEE80211_PARAM_ROAM_RATE_11B
:

3187 
·¿m
[0] = 
v­
->
iv_rßm
.
¿‹11bOÆy
;

3189 
IEEE80211_PARAM_ROAM_RATE_11G
:

3190 
·¿m
[0] = 
v­
->
iv_rßm
.
¿‹11g
;

3192 
IEEE80211_PARAM_UAPSDINFO
:

3193 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
) {

3194 ià(
	`IEEE80211_VAP_UAPSD_ENABLED
(
v­
))

3195 
·¿m
[0] = 1;

3197 
·¿m
[0] = 0;

3198 } ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
)

3199 
·¿m
[0] = 
v­
->
iv_u­sdšfo
;

3201 
IEEE80211_PARAM_SLEEP
:

3202 
·¿m
[0] = 
v­
->
iv_bss
->
ni_æags
 & 
IEEE80211_NODE_PWR_MGT
;

3204 
IEEE80211_PARAM_EOSPDROP
:

3205 
·¿m
[0] = 
	`IEEE80211_VAP_EOSPDROP_ENABLED
(
v­
);

3207 
IEEE80211_PARAM_MARKDFS
:

3208 ià(
ic
->
ic_æags_ext
 & 
IEEE80211_FEXT_MARKDFS
)

3209 
·¿m
[0] = 1;

3211 
·¿m
[0] = 0;

3214  -
EOPNOTSUPP
;

3217 
	}
}

3221 
	$is_sys_›
(
u_št8_t
 
›_id
)

3224 
›_id
) {

3225 
IEEE80211_ELEMID_SSID
:

3226 
IEEE80211_ELEMID_RATES
:

3227 
IEEE80211_ELEMID_FHPARMS
:

3228 
IEEE80211_ELEMID_DSPARMS
:

3229 
IEEE80211_ELEMID_CFPARMS
:

3230 
IEEE80211_ELEMID_TIM
:

3231 
IEEE80211_ELEMID_IBSSPARMS
:

3232 
IEEE80211_ELEMID_COUNTRY
:

3233 
IEEE80211_ELEMID_REQINFO
:

3234 
IEEE80211_ELEMID_CHALLENGE
:

3235 
IEEE80211_ELEMID_PWRCNSTR
:

3236 
IEEE80211_ELEMID_PWRCAP
:

3237 
IEEE80211_ELEMID_TPCREQ
:

3238 
IEEE80211_ELEMID_TPCREP
:

3239 
IEEE80211_ELEMID_SUPPCHAN
:

3240 
IEEE80211_ELEMID_CHANSWITCHANN
:

3241 
IEEE80211_ELEMID_MEASREQ
:

3242 
IEEE80211_ELEMID_MEASREP
:

3243 
IEEE80211_ELEMID_QUIET
:

3244 
IEEE80211_ELEMID_IBSSDFS
:

3245 
IEEE80211_ELEMID_ERP
:

3246 
IEEE80211_ELEMID_RSN
:

3247 
IEEE80211_ELEMID_XRATES
:

3248 
IEEE80211_ELEMID_TPC
:

3249 
IEEE80211_ELEMID_CCKM
:

3254 
	}
}

3258 
	$is_v®id_›_li¡
(
u_št32_t
 
buf_Ën
, *
buf
, 
exşude_sys_›s
)

3260 
›“80211_›
 *
›
 = (›“80211_› *)
buf
;

3262 
buf_Ën
 >ğ(*
›
)) {

3263 
›_–em_Ën
 = (*
›
è+ ie->
Ën
;

3264 ià(
buf_Ën
 < 
›_–em_Ën
)

3266 ià(
exşude_sys_›s
 && 
	`is_sys_›
(
›
->
id
))

3268 
buf_Ën
 -ğ
›_–em_Ën
;

3269 
›
 = (
›“80211_›
 *)(›->
šfo
 + ie->
Ën
);

3272  (
buf_Ën
 == 0) ? 1 : 0;

3273 
	}
}

3276 
	$›“80211_ioùl_£tİt›
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3277 
iw_pošt
 *
wri
, *
exŒa
)

3279 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3280 *
›
;

3288 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
)

3289  -
EOPNOTSUPP
;

3290 ià(!
	`is_v®id_›_li¡
(
wri
->
Ëngth
, 
exŒa
, 0))

3291  -
EINVAL
;

3293 
	`MALLOC
(
›
, *, 
wri
->
Ëngth
, 
M_DEVBUF
, 
M_WAITOK
);

3294 ià(
›
 =ğ
NULL
)

3295  -
ENOMEM
;

3296 
	`memıy
(
›
, 
exŒa
, 
wri
->
Ëngth
);

3297 ià(
v­
->
iv_İt_›
 !ğ
NULL
)

3298 
	`FREE
(
v­
->
iv_İt_›
, 
M_DEVBUF
);

3299 
v­
->
iv_İt_›
 = 
›
;

3300 
v­
->
iv_İt_›_Ën
 = 
wri
->
Ëngth
;

3301 #ifdeà
ATH_SUPERG_XR


3303 ià(
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
))

3304 
	`›“80211_ioùl_£tİt›
(
v­
->
iv_xrv­
->
iv_dev
, 
šfo
, 
wri
, 
exŒa
);

3307 
	}
}

3310 
	$›“80211_ioùl_g‘İt›
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3311 
iw_pošt
 *
wri
, *
exŒa
)

3313 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3315 ià(
v­
->
iv_İt_›
 =ğ
NULL
) {

3316 
wri
->
Ëngth
 = 0;

3319 
wri
->
Ëngth
 = 
v­
->
iv_İt_›_Ën
;

3320 
	`memıy
(
exŒa
, 
v­
->
iv_İt_›
, v­->
iv_İt_›_Ën
);

3322 
	}
}

3326 
	$add_­p_›
(
äame_ty³_šdex
, 
›“80211v­
 *
v­
,

3327 
›“80211»q_g‘£t_­p›buf
 *
›buf
)

3329 
›“80211_›
 *
›
;

3331 ià(!
	`is_v®id_›_li¡
(
›buf
->
­p_buæ’
, iebuf->
­p_buf
, 1))

3332  -
EINVAL
;

3334 
	`MALLOC
(
›
, 
›“80211_›
 *, 
›buf
->
­p_buæ’
, 
M_DEVBUF
, 
M_WAITOK
);

3335 ià(
›
 =ğ
NULL
)

3336  -
ENOMEM
;

3338 
	`memıy
(
›
, 
›buf
->
­p_buf
, iebuf->
­p_buæ’
);

3339 ià(
v­
->
­p_›
[
äame_ty³_šdex
].
›
 !ğ
NULL
)

3340 
	`FREE
(
v­
->
­p_›
[
äame_ty³_šdex
].
›
, 
M_DEVBUF
);

3341 
v­
->
­p_›
[
äame_ty³_šdex
].
›
 = ie;

3342 
v­
->
­p_›
[
äame_ty³_šdex
].
Ëngth
 = 
›buf
->
­p_buæ’
;

3345 
	}
}

3348 
	$»move_­p_›
(
äame_ty³_šdex
, 
›“80211v­
 *
v­
)

3350 
›“80211_­p_›
 *
­p_›
 = &
v­
->­p_›[
äame_ty³_šdex
];

3351 ià(
­p_›
->
›
 !ğ
NULL
) {

3352 
	`FREE
(
­p_›
->
›
, 
M_DEVBUF
);

3353 
­p_›
->
›
 = 
NULL
;

3354 
­p_›
->
Ëngth
 = 0;

3357 
	}
}

3360 
	$g‘_­p_›
(
äame_ty³_šdex
, 
›“80211v­
 *
v­
,

3361 
›“80211»q_g‘£t_­p›buf
 *
›buf
)

3363 
›“80211_­p_›
 *
­p_›
 = &
v­
->­p_›[
äame_ty³_šdex
];

3364 ià(
›buf
->
­p_buæ’
 < 
­p_›
->
Ëngth
)

3365  -
E2BIG
;

3367 
›buf
->
­p_buæ’
 = 
­p_›
->
Ëngth
;

3368 
	`memıy
(
›buf
->
­p_buf
, 
­p_›
->
›
,‡µ_›->
Ëngth
);

3370 
	}
}

3373 
	$›“80211_ioùl_£µ›buf
(
Ãt_deviû
 *
dev
,

3374 
iw_»que¡_šfo
 *
šfo
,

3375 
iw_pošt
 *
d©a
, *
exŒa
)

3377 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3378 
›“80211»q_g‘£t_­p›buf
 *
›buf
 =

3379 (
›“80211»q_g‘£t_­p›buf
 *)
exŒa
;

3380 
›“80211_İmode
 
chk_İmode
;

3381 
›buf_Ën
;

3382 
rc
 = 0;

3384 
›buf_Ën
 = 
d©a
->
Ëngth
 - (
›“80211»q_g‘£t_­p›buf
);

3385 ià((
›buf_Ën
 < 0è|| (›buf_ËÀ!ğ
›buf
->
­p_buæ’
) ||

3386 (
›buf
->
­p_buæ’
 > 
IEEE80211_APPIE_MAX
))

3387  -
EINVAL
;

3389 
›buf
->
­p_ämty³
) {

3390 
IEEE80211_APPIE_FRAME_BEACON
:

3391 
IEEE80211_APPIE_FRAME_PROBE_RESP
:

3392 
IEEE80211_APPIE_FRAME_ASSOC_RESP
:

3393 
chk_İmode
 = 
IEEE80211_M_HOSTAP
;

3395 
IEEE80211_APPIE_FRAME_PROBE_REQ
:

3396 
IEEE80211_APPIE_FRAME_ASSOC_REQ
:

3397 
chk_İmode
 = 
IEEE80211_M_STA
;

3400  -
EINVAL
;

3402 ià(
v­
->
iv_İmode
 !ğ
chk_İmode
)

3403  -
EOPNOTSUPP
;

3405 ià(
›buf
->
­p_buæ’
)

3406 
rc
 = 
	`add_­p_›
(
›buf
->
­p_ämty³
, 
v­
, iebuf);

3408 
rc
 = 
	`»move_­p_›
(
›buf
->
­p_ämty³
, 
v­
);

3409 ià((
›buf
->
­p_ämty³
 =ğ
IEEE80211_APPIE_FRAME_BEACON
è&& (
rc
 == 0))

3410 
v­
->
iv_æags_ext
 |ğ
IEEE80211_FEXT_APPIE_UPDATE
;

3412  
rc
;

3413 
	}
}

3416 
	$›“80211_ioùl_g‘­p›buf
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3417 
iw_pošt
 *
d©a
, *
exŒa
)

3419 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3420 
›“80211»q_g‘£t_­p›buf
 *
›buf
 =

3421 (
›“80211»q_g‘£t_­p›buf
 *)
exŒa
;

3422 
max_›buf_Ën
;

3423 
rc
 = 0;

3425 
max_›buf_Ën
 = 
d©a
->
Ëngth
 - (
›“80211»q_g‘£t_­p›buf
);

3426 ià(
max_›buf_Ën
 < 0)

3427  -
EINVAL
;

3428 ià(
	`cİy_äom_u£r
(
›buf
, 
d©a
->
poš‹r
, (
›“80211»q_g‘£t_­p›buf
)))

3429  -
EFAULT
;

3430 ià(
›buf
->
­p_buæ’
 > 
max_›buf_Ën
)

3431 
›buf
->
­p_buæ’
 = 
max_›buf_Ën
;

3433 
›buf
->
­p_ämty³
) {

3434 
IEEE80211_APPIE_FRAME_BEACON
:

3435 
IEEE80211_APPIE_FRAME_PROBE_RESP
:

3436 
IEEE80211_APPIE_FRAME_ASSOC_RESP
:

3437 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
)

3438  -
EOPNOTSUPP
;

3440 
IEEE80211_APPIE_FRAME_PROBE_REQ
:

3441 
IEEE80211_APPIE_FRAME_ASSOC_REQ
:

3442 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_STA
)

3443  -
EOPNOTSUPP
;

3446  -
EINVAL
;

3449 
rc
 = 
	`g‘_­p_›
(
›buf
->
­p_ämty³
, 
v­
, iebuf);

3451 
d©a
->
Ëngth
 = (
›“80211»q_g‘£t_­p›buf
è+ 
›buf
->
­p_buæ’
;

3453  
rc
;

3454 
	}
}

3457 
	$›“80211_ioùl_£tf‹r
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3458 *
w
, *
exŒa
)

3460 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3461 
›“80211»q_£t_f‹r
 *
­p_f‹r
 = (›“80211»q_£t_f‹¸*)
exŒa
;

3463 ià((
exŒa
 =ğ
NULL
è|| (
­p_f‹r
->
­p_f‹ry³
 & ~
IEEE80211_FILTER_TYPE_ALL
))

3464  -
EINVAL
;

3466 
v­
->
­p_f‹r
 =‡µ_f‹r->
­p_f‹ry³
;

3469 
	}
}

3472 
	$›“80211_ioùl_£tkey
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3473 *
w
, *
exŒa
)

3475 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3476 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3477 
›“80211»q_key
 *
ik
 = (›“80211»q_key *)
exŒa
;

3478 
›“80211_node
 *
ni
;

3479 
›“80211_key
 *
wk
;

3480 
›“80211_keyix_t
 
kix
;

3481 
”rÜ
, 
æags
, 
i
;

3484 ià(!
	`›“80211_üy±o_avaabË
(
v­
, 
ik
->
ik_ty³
))

3485  -
EOPNOTSUPP
;

3488 ià(
ik
->
ik_keyËn
 > (ik->
ik_keyd©a
))

3489  -
E2BIG
;

3491 
kix
 = 
ik
->
ik_keyix
;

3492 ià(
kix
 =ğ
IEEE80211_KEYIX_NONE
) {

3494 ià(
ik
->
ik_æags
 !ğ(
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
))

3495  -
EINVAL
;

3496 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

3497 
ni
 = 
	`›“80211_»f_node
(
v­
->
iv_bss
);

3499 ià(!
	`IEEE80211_ADDR_EQ
(
ik
->
ik_maÿddr
, 
v­
->
iv_bssid
)) {

3500 
	`›“80211_uÄef_node
(&
ni
);

3501  -
EADDRNOTAVAIL
;

3504 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
ik
->
ik_maÿddr
);

3505 ià(
ni
 =ğ
NULL
)

3506  -
ENOENT
;

3507 
wk
 = &
ni
->
ni_uÿ¡key
;

3508 } ià(((
ušt8_t
)
IEEE80211_KEYIX_NONE
 <ğ
kix
) &&

3509 (
kix
 < 
IEEE80211_KEYIX_NONE
)) {

3512  -
EINVAL
;

3514 ià(
kix
 >ğ
IEEE80211_WEP_NKID
)

3515  -
EINVAL
;

3516 
wk
 = &
v­
->
iv_nw_keys
[
kix
];

3517 
ni
 = 
NULL
;

3519 ià((
ik
->
ik_æags
 & 
IEEE80211_KEY_XMIT
) == 0)

3520 
ik
->
ik_æags
 |ğ
IEEE80211_KEY_GROUP
;

3523 
”rÜ
 = 0;

3524 
æags
 = 
ik
->
ik_æags
 & 
IEEE80211_KEY_COMMON
;

3525 
	`›“80211_key_upd©e_begš
(
v­
);

3526 ià(
	`›“80211_üy±o_Ãwkey
(
v­
, 
ik
->
ik_ty³
, 
æags
, 
wk
)) {

3527 
wk
->
wk_keyËn
 = 
ik
->
ik_keyËn
;

3529 ià(
wk
->
wk_keyËn
 > 
IEEE80211_KEYBUF_SIZE
)

3530 
wk
->
wk_keyËn
 = 
IEEE80211_KEYBUF_SIZE
;

3531 
i
 = 0; i < 
IEEE80211_TID_SIZE
; i++)

3532 
wk
->
wk_keyrsc
[
i
] = 
ik
->
ik_keyrsc
;

3533 
wk
->
wk_keytsc
 = 0;

3534 
	`mem£t
(
wk
->
wk_key
, 0, (wk->wk_key));

3535 
	`memıy
(
wk
->
wk_key
, 
ik
->
ik_keyd©a
, ik->
ik_keyËn
);

3536 ià(!
	`›“80211_üy±o_£tkey
(
v­
, 
wk
,

3537 (
ni
 !ğ
NULL
è?‚i->
ni_maÿddr
 : 
ik
->
ik_maÿddr
,‚i))

3538 
”rÜ
 = -
EIO
;

3539 ià((
ik
->
ik_æags
 & 
IEEE80211_KEY_DEFAULT
))

3540 
v­
->
iv_def_txkey
 = 
kix
;

3542 
”rÜ
 = -
ENXIO
;

3544 
	`›“80211_key_upd©e_’d
(
v­
);

3545 ià(
ni
 !ğ
NULL
)

3546 
	`›“80211_uÄef_node
(&
ni
);

3547 #ifdeà
ATH_SUPERG_XR


3549 ià(
v­
->
iv_xrv­
 && !(v­->
iv_æags
 & 
IEEE80211_F_XR
))

3550 
	`›“80211_ioùl_£tkey
(
v­
->
iv_xrv­
->
iv_dev
, 
šfo
, 
w
, 
exŒa
);

3552  
”rÜ
;

3553 
	}
}

3556 
	$›“80211_ioùl_g‘key
(
Ãt_deviû
 *
dev
, 
iw»q
 *
iwr
)

3558 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3559 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3560 
›“80211_node
 *
ni
;

3561 
›“80211»q_key
 
ik
;

3562 
›“80211_key
 *
wk
;

3563 cÚ¡ 
›“80211_ch”
 *
c
;

3564 
›“80211_keyix_t
 
kix
;

3566 ià(
iwr
->
u
.
d©a
.
Ëngth
 !ğ(
ik
))

3567  -
EINVAL
;

3568 ià(
	`cİy_äom_u£r
(&
ik
, 
iwr
->
u
.
d©a
.
poš‹r
, (ik)))

3569  -
EFAULT
;

3570 
kix
 = 
ik
.
ik_keyix
;

3571 ià(
kix
 =ğ
IEEE80211_KEYIX_NONE
) {

3572 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
ik
.
ik_maÿddr
);

3573 ià(
ni
 =ğ
NULL
)

3574  -
ENOENT
;

3575 
wk
 = &
ni
->
ni_uÿ¡key
;

3576 } ià(((
ušt8_t
)
IEEE80211_KEYIX_NONE
 <ğ
kix
) &&

3577 (
kix
 < 
IEEE80211_KEYIX_NONE
)) {

3580  -
EINVAL
;

3582 ià(
kix
 >ğ
IEEE80211_WEP_NKID
)

3583  -
EINVAL
;

3584 
wk
 = &
v­
->
iv_nw_keys
[
kix
];

3585 
	`IEEE80211_ADDR_COPY
(&
ik
.
ik_maÿddr
, 
v­
->
iv_bss
->
ni_maÿddr
);

3586 
ni
 = 
NULL
;

3588 
c
 = 
wk
->
wk_ch”
;

3589 
ik
.
ik_ty³
 = 
c
->
ic_ch”
;

3590 
ik
.
ik_keyËn
 = 
wk
->
wk_keyËn
;

3591 
ik
.
ik_æags
 = 
wk
->
wk_æags
 & (
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_RECV
);

3592 ià(
wk
->
wk_keyix
 =ğ
v­
->
iv_def_txkey
)

3593 
ik
.
ik_æags
 |ğ
IEEE80211_KEY_DEFAULT
;

3594 ià(
	`ÿ·bË
(
CAP_NET_ADMIN
)) {

3596 
ik
.
ik_keyrsc
 = 
wk
->
wk_keyrsc
[0];

3597 
ik
.
ik_keytsc
 = 
wk
->
wk_keytsc
;

3598 
	`memıy
(
ik
.
ik_keyd©a
, 
wk
->
wk_key
, wk->
wk_keyËn
);

3599 ià(
c
->
ic_ch”
 =ğ
IEEE80211_CIPHER_TKIP
) {

3600 
	`memıy
(
ik
.
ik_keyd©a
+
wk
->
wk_keyËn
,

3601 
wk
->
wk_key
 + 
IEEE80211_KEYBUF_SIZE
,

3602 
IEEE80211_MICBUF_SIZE
);

3603 
ik
.
ik_keyËn
 +ğ
IEEE80211_MICBUF_SIZE
;

3606 
ik
.
ik_keyrsc
 = 0;

3607 
ik
.
ik_keytsc
 = 0;

3608 
	`mem£t
(
ik
.
ik_keyd©a
, 0, (ik.ik_keydata));

3610 ià(
ni
 !ğ
NULL
)

3611 
	`›“80211_uÄef_node
(&
ni
);

3612  (
	`cİy_to_u£r
(
iwr
->
u
.
d©a
.
poš‹r
, &
ik
, (ik)è? -
EFAULT
 : 0);

3613 
	}
}

3616 
	$›“80211_ioùl_d–key
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3617 *
w
, *
exŒa
)

3619 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3620 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3621 
›“80211»q_d–_key
 *
dk
 = (›“80211»q_d–_key *)
exŒa
;

3622 
›“80211_keyix_t
 
kix
;

3624 
kix
 = 
dk
->
idk_keyix
;

3625 ià(
dk
->
idk_keyix
 =ğ(
u_št8_t
)
IEEE80211_KEYIX_NONE
)

3626 
kix
 = 
IEEE80211_KEYIX_NONE
;

3628 ià(
kix
 =ğ
IEEE80211_KEYIX_NONE
) {

3629 
›“80211_node
 *
ni
;

3631 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
dk
->
idk_maÿddr
);

3632 ià(
ni
 =ğ
NULL
)

3633  -
ENOENT
;

3635 
	`›“80211_üy±o_d–key
(
v­
, &
ni
->
ni_uÿ¡key
,‚i);

3636 
	`›“80211_uÄef_node
(&
ni
);

3638 ià(
kix
 >ğ
IEEE80211_WEP_NKID
)

3639  -
EINVAL
;

3641 
	`›“80211_üy±o_d–key
(
v­
, &v­->
iv_nw_keys
[
kix
], 
NULL
);

3644 
	}
}

3647 
	$domlme
(*
¬g
, 
›“80211_node
 *
ni
)

3649 
›“80211»q_mlme
 *
mlme
 = 
¬g
;

3651 ià(
ni
->
ni_associd
 != 0) {

3652 
	`IEEE80211_SEND_MGMT
(
ni
,

3653 
mlme
->
im_İ
 =ğ
IEEE80211_MLME_DEAUTH
 ?

3654 
IEEE80211_FC0_SUBTYPE_DEAUTH
 :

3655 
IEEE80211_FC0_SUBTYPE_DISASSOC
,

3656 
mlme
->
im_»asÚ
);

3658 
	`›“80211_node_Ëave
(
ni
);

3659 
	}
}

3661 
	ssÿÆookup
 {

3662 cÚ¡ 
u_št8_t
 *
	mmac
;

3663 
	mes¦’
;

3664 cÚ¡ 
u_št8_t
 *
	messid
;

3665 cÚ¡ 
›“80211_sÿn_’Œy
 *
	m£
;

3672 
	$mlm–ookup
(*
¬g
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

3674 
sÿÆookup
 *
look
 = 
¬g
;

3676 ià(!
	`IEEE80211_ADDR_EQ
(
look
->
mac
, 
£
->
£_maÿddr
))

3678 ià(
look
->
es¦’
 != 0) {

3679 ià(
£
->
£_ssid
[1] !ğ
look
->
es¦’
)

3681 ià(
	`memcmp
(
look
->
essid
, 
£
->
£_ssid
 + 2,†ook->
es¦’
))

3684 
look
->
£
 = se;

3687 
	}
}

3690 
	$›“80211_ioùl_£tmlme
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3691 *
w
, *
exŒa
)

3693 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3694 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3695 
›“80211»q_mlme
 *
mlme
 = (›“80211»q_mlm*)
exŒa
;

3696 
›“80211_node
 *
ni
;

3698 ià(!
	`IS_UP
(
dev
)) {

3699 
mlme
->
im_İ
) {

3700 
IEEE80211_MLME_DISASSOC
:

3701 
IEEE80211_MLME_DEAUTH
:

3702 
IEEE80211_MLME_UNAUTHORIZE
:

3705  -
ENETDOWN
;

3708 
mlme
->
im_İ
) {

3709 
IEEE80211_MLME_ASSOC
:

3710 ià(
v­
->
iv_İmode
 =ğ
IEEE80211_M_STA
) {

3711 
sÿÆookup
 
lookup
;

3713 
lookup
.
£
 = 
NULL
;

3714 
lookup
.
mac
 = 
mlme
->
im_maÿddr
;

3716 
lookup
.
es¦’
 = 
v­
->
iv_des_ssid
[0].
Ën
;

3717 
lookup
.
essid
 = 
v­
->
iv_des_ssid
[0].
ssid
;

3718 
	`›“80211_sÿn_™”©e
(
ic
, 
mlm–ookup
, &
lookup
);

3719 ià(
lookup
.
£
 !ğ
NULL
) {

3720 
v­
->
iv_nsdÚe
 = 0;

3721 
v­
->
iv_n¥¬ams
.
»suÉ
 = 0;

3722 ià(
	`›“80211_¡a_još
(
v­
, 
lookup
.
£
))

3723 !
v­
->
iv_nsdÚe
)

3724 
	`IEEE80211_RESCHEDULE
();

3725 ià(!
v­
->
iv_n¥¬ams
.
»suÉ
)

3727  -
EINVAL
;

3729  -
ENOENT
;

3731  -
EOPNOTSUPP
;

3732 
IEEE80211_MLME_DISASSOC
:

3733 
IEEE80211_MLME_DEAUTH
:

3734 
v­
->
iv_İmode
) {

3735 
IEEE80211_M_STA
:

3737 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_INIT
,

3738 
mlme
->
im_»asÚ
);

3740 
IEEE80211_M_HOSTAP
:

3742 ià(!
	`IEEE80211_ADDR_EQ
(
mlme
->
im_maÿddr
,

3743 
v­
->
iv_dev
->
brßdÿ¡
)) {

3744 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
,

3745 
mlme
->
im_maÿddr
);

3746 ià(
ni
 !ğ
NULL
) {

3747 ià(
dev
 =ğ
ni
->
ni_v­
->
iv_dev
)

3748 
	`domlme
(
mlme
, 
ni
);

3749 
	`›“80211_uÄef_node
(&
ni
);

3751  -
ENOENT
;

3753 
	`›“80211_™”©e_dev_nodes
(
dev
, &
ic
->
ic_¡a
, 
domlme
, 
mlme
);

3756  -
EOPNOTSUPP
;

3759 
IEEE80211_MLME_AUTHORIZE
:

3760 
IEEE80211_MLME_UNAUTHORIZE
:

3761 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
)

3762  -
EOPNOTSUPP
;

3763 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
mlme
->
im_maÿddr
);

3764 ià(
ni
 !ğ
NULL
) {

3765 ià(
mlme
->
im_İ
 =ğ
IEEE80211_MLME_AUTHORIZE
)

3766 
	`›“80211_node_authÜize
(
ni
);

3768 
	`›“80211_node_uÇuthÜize
(
ni
);

3769 
	`›“80211_uÄef_node
(&
ni
);

3771  -
ENOENT
;

3773 
IEEE80211_MLME_CLEAR_STATS
:

3774 ià(
v­
->
iv_İmode
 !ğ
IEEE80211_M_HOSTAP
)

3775  -
EOPNOTSUPP
;

3776 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
mlme
->
im_maÿddr
);

3777 ià(
ni
 !ğ
NULL
) {

3779 
	`mem£t
(&
ni
->
ni_¡©s
, 0, (
›“80211_node¡©s
));

3780 
	`›“80211_uÄef_node
(&
ni
);

3782  -
ENOENT
;

3786  -
EOPNOTSUPP
;

3789 
	}
}

3792 
	$›“80211_ioùl_wdsmac
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3793 *
w
, *
exŒa
)

3795 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3796 
sockaddr
 *
§
 = (sockadd¸*)
exŒa
;

3798 ià(!
	`IEEE80211_ADDR_NULL
(
v­
->
wds_mac
)) {

3799 
	`´štk
("%s: FaedØadd WDS MAC: " 
MAC_FMT
 "\n", 
dev
->
Çme
,

3800 
	`MAC_ADDR
(
§
->
§_d©a
));

3801 
	`´štk
("%s: Device‡lready has WDS mac‡ddress‡ttached,"

3802 "„emovfœ¡\n", 
dev
->
Çme
);

3806 
	`memıy
(
v­
->
wds_mac
, 
§
->
§_d©a
, 
IEEE80211_ADDR_LEN
);

3808 
	`´štk
("%s: Added WDS MAC: " 
MAC_FMT
 "\n", 
dev
->
Çme
,

3809 
	`MAC_ADDR
(
v­
->
wds_mac
));

3811 ià(
	`IS_UP
(
v­
->
iv_dev
)) {

3814  
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

3818 
	}
}

3821 
	$›“80211_ioùl_wdsd–mac
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3822 *
w
, *
exŒa
)

3824 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3825 
sockaddr
 *
§
 = (sockadd¸*)
exŒa
;

3826 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3827 
›“80211_node
 *
wds_ni
;

3830 ià(
	`IEEE80211_ADDR_NULL
(
v­
->
wds_mac
))

3836 ià(
	`memcmp
(
v­
->
wds_mac
, 
§
->
§_d©a
, 
IEEE80211_ADDR_LEN
) == 0) {

3837 ià(
	`IS_UP
(
v­
->
iv_dev
)) {

3838 
wds_ni
 = 
	`›“80211_fšd_txnode
(
v­
, v­->
wds_mac
);

3839 ià(
wds_ni
 !ğ
NULL
) {

3841 
	`›“80211_uÄef_node
(&
wds_ni
);

3844 
	`›“80211_uÄef_node
(&
wds_ni
);

3847 
	`mem£t
(
v­
->
wds_mac
, 0x00, 
IEEE80211_ADDR_LEN
);

3848 ià(
	`IS_UP
(
v­
->
iv_dev
)) {

3850  
ic
->
	`ic_»£t
(ic->
ic_dev
);

3855 
	`´štk
("%s: WDS MAC‡dd»s " 
MAC_FMT
 " is‚ot known byhis interface\n",

3856 
dev
->
Çme
, 
	`MAC_ADDR
(
§
->
§_d©a
));

3859 
	}
}

3865 
	$›“80211_ioùl_kickmac
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3866 *
w
, *
exŒa
)

3868 
sockaddr
 *
§
 = (sockadd¸*)
exŒa
;

3869 
›“80211»q_mlme
 
mlme
;

3871 ià(
§
->
§_çmy
 !ğ
ARPHRD_ETHER
)

3872  -
EINVAL
;

3875 
mlme
.
im_İ
 = 
IEEE80211_MLME_DISASSOC
;

3876 
mlme
.
im_»asÚ
 = 
IEEE80211_REASON_UNSPECIFIED
;

3877 
	`IEEE80211_ADDR_COPY
(&(
mlme
.
im_maÿddr
), 
§
->
§_d©a
);

3880  
	`›“80211_ioùl_£tmlme
(
dev
, 
šfo
, 
w
, (*)&
mlme
);

3881 
	}
}

3884 
	$›“80211_ioùl_addmac
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3885 *
w
, *
exŒa
)

3887 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3888 
sockaddr
 *
§
 = (sockadd¸*)
exŒa
;

3889 cÚ¡ 
›“80211_aş©Ü
 *
aş
 = 
v­
->
iv_aş
;

3891 ià(
aş
 =ğ
NULL
) {

3892 
aş
 = 
	`›“80211_aş©Ü_g‘
("mac");

3893 ià(
aş
 =ğ
NULL
 || !aş->
	`Ÿc_©ch
(
v­
))

3894  -
EINVAL
;

3895 
v­
->
iv_aş
 = 
aş
;

3897 
aş
->
	`Ÿc_add
(
v­
, 
§
->
§_d©a
);

3899 
	}
}

3902 
	$›“80211_ioùl_d–mac
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

3903 *
w
, *
exŒa
)

3905 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3906 
sockaddr
 *
§
 = (sockadd¸*)
exŒa
;

3907 cÚ¡ 
›“80211_aş©Ü
 *
aş
 = 
v­
->
iv_aş
;

3909 ià(
aş
 =ğ
NULL
) {

3910 
aş
 = 
	`›“80211_aş©Ü_g‘
("mac");

3911 ià(
aş
 =ğ
NULL
 || !aş->
	`Ÿc_©ch
(
v­
))

3912  -
EINVAL
;

3913 
v­
->
iv_aş
 = 
aş
;

3915 
aş
->
	`Ÿc_»move
(
v­
, 
§
->
§_d©a
);

3917 
	}
}

3920 
	$›“80211_ioùl_£tchªli¡
(
Ãt_deviû
 *
dev
,

3921 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

3923 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3924 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3925 
›“80211»q_chªli¡
 *
li¡
 =

3926 (
›“80211»q_chªli¡
 *)
exŒa
;

3927 
u_ch¬
 
chªli¡
[
IEEE80211_CHAN_BYTES
];

3928 
i
, 
j
, 
nchª
;

3930 
	`mem£t
(
chªli¡
, 0, (chanlist));

3935 ià(
ic
->
ic_phyty³
 =ğ
IEEE80211_T_DS
)

3936 
i
 = 1;

3938 
i
 = 0;

3939 
nchª
 = 0;

3940 
j
 = 0; 
i
 <ğ
IEEE80211_CHAN_MAX
; i++, j++) {

3945 ià(
	`is£t
(
li¡
->
ic_chªÃls
, 
j
è&& is£t(
ic
->
ic_chª_ava
, 
i
)) {

3946 
	`£tb™
(
chªli¡
, 
i
);

3947 
nchª
++;

3950 ià(
nchª
 == 0)

3951  -
EINVAL
;

3952 ià(
ic
->
ic_bsschª
 !ğ
IEEE80211_CHAN_ANYC
 &&

3953 
	`isşr
(
chªli¡
, 
ic
->
ic_bsschª
->
ic_›“
))

3954 
ic
->
ic_bsschª
 = 
IEEE80211_CHAN_ANYC
;

3956 
	`memıy
(
ic
->
ic_chª_aùive
, 
chªli¡
, (ic->ic_chan_active));

3958 
	`›“80211_bud_sc_›
(
ic
);

3959 ià(
	`IS_UP_AUTO
(
v­
))

3960 
	`›“80211_Ãw_¡©e
(
v­
, 
IEEE80211_S_SCAN
, 0);

3963 
	}
}

3966 
	$›“80211_ioùl_g‘chªli¡
(
Ãt_deviû
 *
dev
,

3967 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

3969 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3970 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3972 
	`memıy
(
exŒa
, 
ic
->
ic_chª_aùive
, (ic->ic_chan_active));

3974 
	}
}

3977 
	$›“80211_ioùl_g‘chªšfo
(
Ãt_deviû
 *
dev
,

3978 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

3980 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

3981 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

3982 
›“80211»q_chªšfo
 
chªs
;

3983 
u_št8_t
 
»pÜ‹d
[
IEEE80211_CHAN_BYTES
];

3984 
i
;

3986 
	`mem£t
(&
chªs
, 0, (chans));

3987 
	`mem£t
(&
»pÜ‹d
, 0, (reported));

3988 
i
 = 0; i < 
ic
->
ic_nchªs
; i++) {

3989 cÚ¡ 
›“80211_chªÃl
 *
c
 = &
ic
->
ic_chªÃls
[
i
];

3990 cÚ¡ 
›“80211_chªÃl
 *
c1
 = 
c
;

3992 ià(
	`isşr
(
»pÜ‹d
, 
c
->
ic_›“
)) {

3993 
	`£tb™
(
»pÜ‹d
, 
c
->
ic_›“
);

3997 ià(
	`IEEE80211_IS_CHAN_A
(
c
))

3998 
c1
 = 
	`fšdchªÃl
(
ic
, 
c
->
ic_›“
, 
IEEE80211_MODE_TURBO_A
);

3999 ià(
	`IEEE80211_IS_CHAN_ANYG
(
c
))

4000 
c1
 = 
	`fšdchªÃl
(
ic
, 
c
->
ic_›“
, 
IEEE80211_MODE_TURBO_G
);

4001 ià(
	`IEEE80211_IS_CHAN_B
(
c
)) {

4002 
c1
 = 
	`fšdchªÃl
(
ic
, 
c
->
ic_›“
, 
IEEE80211_MODE_TURBO_G
);

4003 ià(!
c1
)

4004 
c1
 = 
	`fšdchªÃl
(
ic
, 
c
->
ic_›“
, 
IEEE80211_MODE_11G
);

4007 ià(
c1
)

4008 
c
 = 
c1
;

4010 
	`memıy
(&
chªs
.
ic_chªs
[chªs.
ic_nchªs
], 
c
, (
›“80211_chªÃl
));

4011 ià(++
chªs
.
ic_nchªs
 >ğ
IEEE80211_CHAN_MAX
)

4015 
	`memıy
(
exŒa
, &
chªs
, (
›“80211»q_chªšfo
));

4017 
	}
}

4020 
	$›“80211_ioùl_£twmm·¿ms
(
Ãt_deviû
 *
dev
,

4021 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

4023 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4024 *
·¿m
 = (*)
exŒa
;

4025 
ac
 = (
·¿m
[1] < 
WME_NUM_AC
è?…¬am[1] : 
WME_AC_BE
;

4026 
bss
 = 
·¿m
[2];

4027 
›“80211_wme_¡©e
 *
wme
 = &
v­
->
iv_ic
->
ic_wme
;

4029 
·¿m
[0]) {

4030 
IEEE80211_WMMPARAMS_CWMIN
:

4031 ià(
·¿m
[3] > 15)

4032  -
EINVAL
;

4033 ià(
bss
) {

4034 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmš
 = 
·¿m
[3];

4035 ià((
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) == 0)

4036 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmš
 = 
·¿m
[3];

4038 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmš
 = 
·¿m
[3];

4039 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmš
 = 
·¿m
[3];

4041 
	`›“80211_wme_upd©•¬ams
(
v­
);

4043 
IEEE80211_WMMPARAMS_CWMAX
:

4044 ià(
·¿m
[3] > 15)

4045  -
EINVAL
;

4046 ià(
bss
) {

4047 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmax
 = 
·¿m
[3];

4048 ià((
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) == 0)

4049 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmax
 = 
·¿m
[3];

4051 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmax
 = 
·¿m
[3];

4052 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmax
 = 
·¿m
[3];

4054 
	`›“80211_wme_upd©•¬ams
(
v­
);

4056 
IEEE80211_WMMPARAMS_AIFS
:

4057 ià(
·¿m
[3] > 15)

4058  -
EINVAL
;

4059 ià(
bss
) {

4060 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_aif¢
 = 
·¿m
[3];

4061 ià((
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) == 0)

4062 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_aif¢
 = 
·¿m
[3];

4064 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_aif¢
 = 
·¿m
[3];

4065 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_aif¢
 = 
·¿m
[3];

4067 
	`›“80211_wme_upd©•¬ams
(
v­
);

4069 
IEEE80211_WMMPARAMS_TXOPLIMIT
:

4070 ià(
·¿m
[3] > 8192)

4071  -
EINVAL
;

4072 ià(
bss
) {

4073 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_txİLim™


4074 ğ
	`IEEE80211_US_TO_TXOP
(
·¿m
[3]);

4075 ià((
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) == 0)

4076 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_txİLim™
 =

4077 
	`IEEE80211_US_TO_TXOP
(
·¿m
[3]);

4079 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_txİLim™


4080 ğ
	`IEEE80211_US_TO_TXOP
(
·¿m
[3]);

4081 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_txİLim™


4082 ğ
	`IEEE80211_US_TO_TXOP
(
·¿m
[3]);

4084 
	`›“80211_wme_upd©•¬ams
(
v­
);

4086 
IEEE80211_WMMPARAMS_ACM
:

4087 ià(!
bss
 || 
·¿m
[3] > 1)

4088  -
EINVAL
;

4090 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_acm
 = 
·¿m
[3];

4091 ià((
wme
->
wme_æags
 & 
WME_F_AGGRMODE
) == 0)

4092 
wme
->
wme_bssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_acm
 = 
·¿m
[3];

4094 
IEEE80211_WMMPARAMS_NOACKPOLICY
:

4095 ià(
bss
 || 
·¿m
[3] > 1)

4096  -
EINVAL
;

4098 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_nßckPŞicy
 = 
·¿m
[3];

4099 
wme
->
wme_chªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_nßckPŞicy
 = 
·¿m
[3];

4105 
	}
}

4108 
	$›“80211_ioùl_g‘wmm·¿ms
(
Ãt_deviû
 *
dev
,

4109 
iw_»que¡_šfo
 *
šfo
, *
w
, *
exŒa
)

4111 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4112 *
·¿m
 = (*)
exŒa
;

4113 
ac
 = (
·¿m
[1] < 
WME_NUM_AC
è?…¬am[1] : 
WME_AC_BE
;

4114 
›“80211_wme_¡©e
 *
wme
 = &
v­
->
iv_ic
->
ic_wme
;

4115 
chªAccP¬ams
 *
chªP¬ams
 = (
·¿m
[2] == 0) ?

4116 &(
wme
->
wme_chªP¬ams
è: &(wme->
wme_bssChªP¬ams
);

4118 
·¿m
[0]) {

4119 
IEEE80211_WMMPARAMS_CWMIN
:

4120 
·¿m
[0] = 
chªP¬ams
->
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmš
;

4122 
IEEE80211_WMMPARAMS_CWMAX
:

4123 
·¿m
[0] = 
chªP¬ams
->
ÿp_wmeP¬ams
[
ac
].
wm•_logcwmax
;

4125 
IEEE80211_WMMPARAMS_AIFS
:

4126 
·¿m
[0] = 
chªP¬ams
->
ÿp_wmeP¬ams
[
ac
].
wm•_aif¢
;

4128 
IEEE80211_WMMPARAMS_TXOPLIMIT
:

4129 
·¿m
[0] = 
	`IEEE80211_TXOP_TO_US
(
chªP¬ams
->
ÿp_wmeP¬ams
[
ac
].
wm•_txİLim™
);

4131 
IEEE80211_WMMPARAMS_ACM
:

4132 
·¿m
[0] = 
wme
->
wme_wmeBssChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_acm
;

4134 
IEEE80211_WMMPARAMS_NOACKPOLICY
:

4135 
·¿m
[0] = 
wme
->
wme_wmeChªP¬ams
.
ÿp_wmeP¬ams
[
ac
].
wm•_nßckPŞicy
;

4141 
	}
}

4144 
	$›“80211_ioùl_g‘w·›
(
Ãt_deviû
 *
dev
, 
iw»q
 *
iwr
)

4146 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4147 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4148 
›“80211_node
 *
ni
;

4149 
›“80211»q_w·›
 
w·›
;

4151 ià(
iwr
->
u
.
d©a
.
Ëngth
 !ğ(
w·›
))

4152  -
EINVAL
;

4153 ià(
	`cİy_äom_u£r
(&
w·›
, 
iwr
->
u
.
d©a
.
poš‹r
, 
IEEE80211_ADDR_LEN
))

4154  -
EFAULT
;

4155 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
w·›
.
w·_maÿddr
);

4156 ià(
ni
 !ğ
NULL
) {

4157 
	`mem£t
(
w·›
.
w·_›
, 0, (wpaie.wpa_ie));

4158 ià(
ni
->
ni_w·_›
 !ğ
NULL
) {

4159 
›Ën
 = 
ni
->
ni_w·_›
[1] + 2;

4160 ià(
›Ën
 > (
w·›
.
w·_›
))

4161 
›Ën
 = (
w·›
.
w·_›
);

4162 
	`memıy
(
w·›
.
w·_›
, 
ni
->
ni_w·_›
, 
›Ën
);

4164 ià(
ni
->
ni_r¢_›
 !ğ
NULL
) {

4165 
›Ën
 = 
ni
->
ni_r¢_›
[1] + 2;

4166 ià(
›Ën
 > (
w·›
.
r¢_›
))

4167 
›Ën
 = (
w·›
.
r¢_›
);

4168 
	`memıy
(
w·›
.
r¢_›
, 
ni
->
ni_r¢_›
, 
›Ën
);

4170 
	`›“80211_uÄef_node
(&
ni
);

4171  (
	`cİy_to_u£r
(
iwr
->
u
.
d©a
.
poš‹r
, &
w·›
, (wpaie)) ?

4172 -
EFAULT
 : 0);

4174  -
ENOENT
;

4175 
	}
}

4178 
	$›“80211_ioùl_g‘¡a¡©s
(
Ãt_deviû
 *
dev
, 
iw»q
 *
iwr
)

4180 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4181 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4182 
›“80211_node
 *
ni
;

4183 
u_št8_t
 
maÿddr
[
IEEE80211_ADDR_LEN
];

4184 cÚ¡ 
off
 = 
	`__off£tof
(
›“80211»q_¡a_¡©s
, 
is_¡©s
);

4185 
”rÜ
;

4187 ià(
iwr
->
u
.
d©a
.
Ëngth
 < 
off
)

4188  -
E2BIG
;

4189 ià(
	`cİy_äom_u£r
(
maÿddr
, 
iwr
->
u
.
d©a
.
poš‹r
, 
IEEE80211_ADDR_LEN
))

4190  -
EFAULT
;

4191 
ni
 = 
	`›“80211_fšd_node
(&
ic
->
ic_¡a
, 
maÿddr
);

4192 ià(
ni
 !ğ
NULL
) {

4193 ià(
iwr
->
u
.
d©a
.
Ëngth
 > (
›“80211»q_¡a_¡©s
))

4194 
iwr
->
u
.
d©a
.
Ëngth
 = (
›“80211»q_¡a_¡©s
);

4196 
”rÜ
 = 
	`cİy_to_u£r
(
iwr
->
u
.
d©a
.
poš‹r
 + 
off
, &
ni
->
ni_¡©s
,

4197 
iwr
->
u
.
d©a
.
Ëngth
 - 
off
);

4198 
	`›“80211_uÄef_node
(&
ni
);

4199  (
”rÜ
 ? -
EFAULT
 : 0);

4201  -
ENOENT
;

4202 
	}
}

4204 
	ssÿÄeq
 {

4205 
›“80211»q_sÿn_»suÉ
 *
	m¤
;

4206 
size_t
 
	m¥aû
;

4209 
size_t


4210 
	$sÿn_¥aû
(cÚ¡ 
›“80211_sÿn_’Œy
 *
£
, *
›Ën
)

4212 *
›Ën
 = 0;

4213 ià(
£
->
£_r¢_›
 !ğ
NULL
)

4214 *
›Ën
 +ğ2 + 
£
->
£_r¢_›
[1];

4215 ià(
£
->
£_w·_›
 !ğ
NULL
)

4216 *
›Ën
 +ğ2 + 
£
->
£_w·_›
[1];

4217 ià(
£
->
£_wme_›
 !ğ
NULL
)

4218 *
›Ën
 +ğ2 + 
£
->
£_wme_›
[1];

4219 ià(
£
->
£_©h_›
 !ğ
NULL
)

4220 *
›Ën
 +ğ2 + 
£
->
£_©h_›
[1];

4221  
	`roundup
((
›“80211»q_sÿn_»suÉ
) +

4222 
£
->
£_ssid
[1] + *
›Ën
, (
u_št32_t
));

4223 
	}
}

4226 
	$g‘_sÿn_¥aû
(*
¬g
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

4228 
sÿÄeq
 *
»q
 = 
¬g
;

4229 
›Ën
;

4231 
»q
->
¥aû
 +ğ
	`sÿn_¥aû
(
£
, &
›Ën
);

4234 
	}
}

4237 
	$g‘_sÿn_»suÉ
(*
¬g
, cÚ¡ 
›“80211_sÿn_’Œy
 *
£
)

4239 
sÿÄeq
 *
»q
 = 
¬g
;

4240 
›“80211»q_sÿn_»suÉ
 *
¤
;

4241 
›Ën
, 
Ën
, 
Ä
, 
nxr
;

4242 
u_št8_t
 *
ı
;

4244 
Ën
 = 
	`sÿn_¥aû
(
£
, &
›Ën
);

4245 ià(
Ën
 > 
»q
->
¥aû
) {

4246 
	`´štk
("[madwifi] %s(è: NÙƒnough s·û.\n", 
__func__
);

4250 
¤
 = 
»q
->sr;

4251 
	`mem£t
(
¤
, 0, (*sr));

4252 
¤
->
i¤_ssid_Ën
 = 
£
->
£_ssid
[1];

4254 
¤
->
i¤_›_Ën
 = 
›Ën
;

4255 
¤
->
i¤_Ën
 = 
Ën
;

4256 
¤
->
i¤_äeq
 = 
£
->
£_chª
->
ic_äeq
;

4257 
¤
->
i¤_æags
 = 
£
->
£_chª
->
ic_æags
;

4258 
¤
->
i¤_rssi
 = 
£
->
£_rssi
;

4259 
¤
->
i¤_štv®
 = 
£
->
£_štv®
;

4260 
¤
->
i¤_ÿpšfo
 = 
£
->
£_ÿpšfo
;

4261 
¤
->
i¤_”p
 = 
£
->
£_”p
;

4262 
	`IEEE80211_ADDR_COPY
(
¤
->
i¤_bssid
, 
£
->
£_bssid
);

4264 
Ä
 = 
£
->
£_¿‹s
[1];

4265 
	`memıy
(
¤
->
i¤_¿‹s
, 
£
->
£_¿‹s
 + 2, 
Ä
);

4266 
nxr
 = 
£
->
£_x¿‹s
[1];

4267 
	`memıy
(
¤
->
i¤_¿‹s
+
Ä
, 
£
->
£_x¿‹s
 + 2, 
nxr
);

4268 
¤
->
i¤_Ä©es
 = 
Ä
 + 
nxr
;

4270 
ı
 = (
u_št8_t
 *)(
¤
 + 1);

4271 
	`memıy
(
ı
, 
£
->
£_ssid
 + 2, 
¤
->
i¤_ssid_Ën
);

4272 
ı
 +ğ
¤
->
i¤_ssid_Ën
;

4273 ià(
£
->
£_r¢_›
 !ğ
NULL
) {

4274 
	`memıy
(
ı
, 
£
->
£_r¢_›
, 2 + se->se_rsn_ie[1]);

4275 
ı
 +ğ2 + 
£
->
£_r¢_›
[1];

4277 ià(
£
->
£_w·_›
 !ğ
NULL
) {

4278 
	`memıy
(
ı
, 
£
->
£_w·_›
, 2 + se->se_wpa_ie[1]);

4279 
ı
 +ğ2 + 
£
->
£_w·_›
[1];

4281 ià(
£
->
£_wme_›
 !ğ
NULL
) {

4282 
	`memıy
(
ı
, 
£
->
£_wme_›
, 2 + se->se_wme_ie[1]);

4283 
ı
 +ğ2 + 
£
->
£_wme_›
[1];

4285 ià(
£
->
£_©h_›
 !ğ
NULL
) {

4286 
	`memıy
(
ı
, 
£
->
£_©h_›
, 2 + se->se_ath_ie[1]);

4287 
ı
 +ğ2 + 
£
->
£_©h_›
[1];

4290 
»q
->
¥aû
 -ğ
Ën
;

4291 
»q
->
¤
 = (
›“80211»q_sÿn_»suÉ
 *)(((
u_št8_t
 *)¤è+ 
Ën
);

4294 
	}
}

4297 
	$›“80211_ioùl_g‘sÿÄesuÉs
(
Ãt_deviû
 *
dev
, 
iw»q
 *
iwr
)

4299 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4300 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4301 
sÿÄeq
 
»q
;

4302 
”rÜ
;

4304 ià(
iwr
->
u
.
d©a
.
Ëngth
 < (
sÿÄeq
))

4305  -
E2BIG
;

4307 
”rÜ
 = 0;

4308 
»q
.
¥aû
 = 0;

4309 
	`›“80211_sÿn_™”©e
(
ic
, 
g‘_sÿn_¥aû
, &
»q
);

4310 ià(
»q
.
¥aû
 > 
iwr
->
u
.
d©a
.
Ëngth
)

4311 
»q
.
¥aû
 = 
iwr
->
u
.
d©a
.
Ëngth
;

4312 ià(
»q
.
¥aû
 > 0) {

4313 
size_t
 
¥aû
;

4314 *
p
;

4316 
¥aû
 = 
»q
.space;

4317 
	`MALLOC
(
p
, *, 
¥aû
, 
M_TEMP
, 
M_WAITOK
);

4318 ià(
p
 =ğ
NULL
)

4319  -
ENOMEM
;

4320 
»q
.
¤
 = 
p
;

4321 
	`›“80211_sÿn_™”©e
(
ic
, 
g‘_sÿn_»suÉ
, &
»q
);

4322 
iwr
->
u
.
d©a
.
Ëngth
 = 
¥aû
 - 
»q
.space;

4323 
”rÜ
 = 
	`cİy_to_u£r
(
iwr
->
u
.
d©a
.
poš‹r
, 
p
, iwr->u.d©a.
Ëngth
);

4324 
	`FREE
(
p
, 
M_TEMP
);

4326 
iwr
->
u
.
d©a
.
Ëngth
 = 0;

4328  (
”rÜ
 ? -
EFAULT
 : 0);

4329 
	}
}

4331 
	s¡ašfÜeq
 {

4332 
›“80211v­
 *
	mv­
;

4333 
›“80211»q_¡a_šfo
 *
	msi
;

4334 
size_t
 
	m¥aû
;

4337 
size_t


4338 
	$¡a_¥aû
(cÚ¡ 
›“80211_node
 *
ni
, 
size_t
 *
›Ën
)

4340 *
›Ën
 = 0;

4341 ià(
ni
->
ni_r¢_›
 !ğ
NULL
)

4342 *
›Ën
 +ğ2+
ni
->
ni_r¢_›
[1];

4343 ià(
ni
->
ni_w·_›
 !ğ
NULL
)

4344 *
›Ën
 +ğ2+
ni
->
ni_w·_›
[1];

4345 ià(
ni
->
ni_wme_›
 !ğ
NULL
)

4346 *
›Ën
 +ğ2+
ni
->
ni_wme_›
[1];

4347 ià(
ni
->
ni_©h_›
 !ğ
NULL
)

4348 *
›Ën
 +ğ2+
ni
->
ni_©h_›
[1];

4349  
	`roundup
((
›“80211»q_¡a_šfo
è+ *
›Ën
,

4350 (
u_št32_t
));

4351 
	}
}

4354 
	$g‘_¡a_¥aû
(*
¬g
, 
›“80211_node
 *
ni
)

4356 
¡ašfÜeq
 *
»q
 = 
¬g
;

4357 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

4358 
size_t
 
›Ën
;

4360 ià(
v­
 !ğ
»q
->v­ && v­ !ğ»q->v­->
iv_xrv­
)

4362 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

4363 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) &&

4364 
ni
->
ni_associd
 == 0)

4366 
»q
->
¥aû
 +ğ
	`¡a_¥aû
(
ni
, &
›Ën
);

4367 
	}
}

4370 
	$g‘_¡a_šfo
(*
¬g
, 
›“80211_node
 *
ni
)

4372 
¡ašfÜeq
 *
»q
 = 
¬g
;

4373 
›“80211v­
 *
v­
 = 
ni
->
ni_v­
;

4374 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4375 
›“80211»q_¡a_šfo
 *
si
;

4376 
size_t
 
›Ën
, 
Ën
;

4377 
u_št8_t
 *
ı
;

4379 ià(
v­
 !ğ
»q
->v­ && v­ !ğ»q->v­->
iv_xrv­
)

4381 ià((
v­
->
iv_İmode
 =ğ
IEEE80211_M_HOSTAP
 ||

4382 
v­
->
iv_İmode
 =ğ
IEEE80211_M_WDS
) &&

4383 
ni
->
ni_associd
 == 0)

4385 ià(
ni
->
ni_chª
 =ğ
IEEE80211_CHAN_ANYC
)

4387 
Ën
 = 
	`¡a_¥aû
(
ni
, &
›Ën
);

4388 ià(
Ën
 > 
»q
->
¥aû
)

4390 
si
 = 
»q
->si;

4391 
si
->
isi_Ën
 = 
Ën
;

4392 
si
->
isi_›_Ën
 = 
›Ën
;

4393 
si
->
isi_äeq
 = 
ni
->
ni_chª
->
ic_äeq
;

4394 
si
->
isi_æags
 = 
ni
->
ni_chª
->
ic_æags
;

4395 
si
->
isi_¡©e
 = 
ni
->
ni_æags
;

4396 
si
->
isi_authmode
 = 
ni
->
ni_authmode
;

4397 
si
->
isi_rssi
 = 
ic
->
	`ic_node_g‘rssi
(
ni
);

4398 
si
->
isi_ÿpšfo
 = 
ni
->
ni_ÿpšfo
;

4399 
si
->
isi_©hæags
 = 
ni
->
ni_©h_æags
;

4400 
si
->
isi_”p
 = 
ni
->
ni_”p
;

4401 
	`IEEE80211_ADDR_COPY
(
si
->
isi_maÿddr
, 
ni
->
ni_maÿddr
);

4402 
si
->
isi_Ä©es
 = 
ni
->
ni_¿‹s
.
rs_Ä©es
;

4403 ià(
si
->
isi_Ä©es
 > 15)

4404 
si
->
isi_Ä©es
 = 15;

4405 
	`memıy
(
si
->
isi_¿‹s
, 
ni
->
ni_¿‹s
.
rs_¿‹s
, si->
isi_Ä©es
);

4406 
si
->
isi_tx¿‹
 = 
ni
->
ni_tx¿‹
;

4407 
si
->
isi_›_Ën
 = 
›Ën
;

4408 
si
->
isi_associd
 = 
ni
->
ni_associd
;

4409 
si
->
isi_txpow”
 = 
ni
->
ni_txpow”
;

4410 
si
->
isi_vÏn
 = 
ni
->
ni_vÏn
;

4411 ià(
ni
->
ni_æags
 & 
IEEE80211_NODE_QOS
) {

4412 
	`memıy
(
si
->
isi_tx£qs
, 
ni
->
ni_tx£qs
, (ni->ni_txseqs));

4413 
	`memıy
(
si
->
isi_rx£qs
, 
ni
->
ni_rx£qs
, (ni->ni_rxseqs));

4415 
si
->
isi_tx£qs
[0] = 
ni
->
ni_tx£qs
[0];

4416 
si
->
isi_rx£qs
[0] = 
ni
->
ni_rx£qs
[0];

4418 
si
->
isi_u­sd
 = 
ni
->
ni_u­sd
;

4419 ià(
v­
 =ğ
»q
->v­->
iv_xrv­
)

4420 
si
->
isi_İmode
 = 
IEEE80211_STA_OPMODE_XR
;

4422 
si
->
isi_İmode
 = 
IEEE80211_STA_OPMODE_NORMAL
;

4424 ià(
	`›“80211_node_is_authÜized
(
ni
))

4425 
si
->
isi_šaù
 = 
v­
->
iv_šaù_run
;

4426 ià(
ni
->
ni_associd
 != 0)

4427 
si
->
isi_šaù
 = 
v­
->
iv_šaù_auth
;

4429 
si
->
isi_šaù
 = 
v­
->
iv_šaù_š™
;

4430 
si
->
isi_šaù
 = (si->isi_šaù - 
ni
->
ni_šaù
è* 
IEEE80211_INACT_WAIT
;

4432 
ı
 = (
u_št8_t
 *)(
si
+1);

4433 ià(
ni
->
ni_r¢_›
 !ğ
NULL
) {

4434 
	`memıy
(
ı
, 
ni
->
ni_r¢_›
, 2 +‚i->ni_rsn_ie[1]);

4435 
ı
 +ğ2 + 
ni
->
ni_r¢_›
[1];

4437 ià(
ni
->
ni_w·_›
 !ğ
NULL
) {

4438 
	`memıy
(
ı
, 
ni
->
ni_w·_›
, 2 +‚i->ni_wpa_ie[1]);

4439 
ı
 +ğ2 + 
ni
->
ni_w·_›
[1];

4441 ià(
ni
->
ni_wme_›
 !ğ
NULL
) {

4442 
	`memıy
(
ı
, 
ni
->
ni_wme_›
, 2 +‚i->ni_wme_ie[1]);

4443 
ı
 +ğ2 + 
ni
->
ni_wme_›
[1];

4445 ià(
ni
->
ni_©h_›
 !ğ
NULL
) {

4446 
	`memıy
(
ı
, 
ni
->
ni_©h_›
, 2 +‚i->ni_ath_ie[1]);

4447 
ı
 +ğ2 + 
ni
->
ni_©h_›
[1];

4450 
»q
->
si
 = (
›“80211»q_¡a_šfo
 *)(((
u_št8_t
 *)siè+ 
Ën
);

4451 
»q
->
¥aû
 -ğ
Ën
;

4452 
	}
}

4455 
	$›“80211_ioùl_g‘¡ašfo
(
Ãt_deviû
 *
dev
, 
iw»q
 *
iwr
)

4457 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4458 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4459 
¡ašfÜeq
 
»q
;

4460 
”rÜ
;

4462 ià(
iwr
->
u
.
d©a
.
Ëngth
 < (
¡ašfÜeq
))

4463  -
E2BIG
;

4466 
”rÜ
 = 0;

4467 
»q
.
¥aû
 = (
¡ašfÜeq
);

4468 
»q
.
v­
 = vap;

4469 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
g‘_¡a_¥aû
, &
»q
);

4470 ià(
»q
.
¥aû
 > 
iwr
->
u
.
d©a
.
Ëngth
)

4471 
»q
.
¥aû
 = 
iwr
->
u
.
d©a
.
Ëngth
;

4472 ià(
»q
.
¥aû
 > 0) {

4473 
size_t
 
¥aû
;

4474 *
p
;

4476 
¥aû
 = 
»q
.space;

4477 
	`MALLOC
(
p
, *, 
¥aû
, 
M_TEMP
, 
M_WAITOK
);

4478 
»q
.
si
 = (
›“80211»q_¡a_šfo
 *)
p
;

4479 
	`›“80211_™”©e_nodes
(&
ic
->
ic_¡a
, 
g‘_¡a_šfo
, &
»q
);

4480 
iwr
->
u
.
d©a
.
Ëngth
 = 
¥aû
 - 
»q
.space;

4481 
”rÜ
 = 
	`cİy_to_u£r
(
iwr
->
u
.
d©a
.
poš‹r
, 
p
, iwr->u.d©a.
Ëngth
);

4482 
	`FREE
(
p
, 
M_TEMP
);

4484 
iwr
->
u
.
d©a
.
Ëngth
 = 0;

4486  (
”rÜ
 ? -
EFAULT
 : 0);

4487 
	}
}

4490 
	$´e_ªnounûd_chªsw™ch
(
Ãt_deviû
 *
dev
, 
u_št32_t
 
chªÃl
, u_št32_ˆ
tb‰
) {

4491 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4492 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4494 
ic
->
ic_æags
 |ğ
IEEE80211_F_CHANSWITCH
;

4495 
ic
->
ic_chªchªge_chª
 = 
chªÃl
;

4496 
ic
->
ic_chªchªge_tb‰
 = 
tb‰
;

4497 
	}
}

4500 
	$›“80211_ioùl_chªsw™ch
(
Ãt_deviû
 *
dev
, 
iw_»que¡_šfo
 *
šfo
,

4501 *
w
, *
exŒa
)

4503 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4504 
›“80211com
 *
ic
 = 
v­
->
iv_ic
;

4505 *
·¿m
 = (*)
exŒa
;

4507 ià(!(
ic
->
ic_æags
 & 
IEEE80211_F_DOTH
))

4510 
	`´e_ªnounûd_chªsw™ch
(
dev
, 
·¿m
[0],…aram[1]);

4513 
	}
}

4515 #ià
WIRELESS_EXT
 >= 18

4517 
	$›“80211_ioùl_siwmlme
(
Ãt_deviû
 *
dev
,

4518 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
”q
, *
d©a
)

4520 
›“80211»q_mlme
 
mlme
;

4521 
iw_mlme
 *
wextmlme
 = (iw_mlm*)
d©a
;

4523 
	`mem£t
(&
mlme
, 0, (mlme));

4525 
wextmlme
->
cmd
) {

4526 
IW_MLME_DEAUTH
:

4527 
mlme
.
im_İ
 = 
IEEE80211_MLME_DEAUTH
;

4529 
IW_MLME_DISASSOC
:

4530 
mlme
.
im_İ
 = 
IEEE80211_MLME_DISASSOC
;

4533  -
EOPNOTSUPP
;

4536 
mlme
.
im_»asÚ
 = 
wextmlme
->
»asÚ_code
;

4538 
	`memıy
(
mlme
.
im_maÿddr
, 
wextmlme
->
addr
.
§_d©a
, 
IEEE80211_ADDR_LEN
);

4540  
	`›“80211_ioùl_£tmlme
(
dev
, 
NULL
, NULL, (*)&
mlme
);

4541 
	}
}

4545 
	$›“80211_ioùl_giwg’›
(
Ãt_deviû
 *
dev
,

4546 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
out
, *
buf
)

4548 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

4550 ià(
out
->
Ëngth
 < 
v­
->
iv_İt_›_Ën
)

4551  -
E2BIG
;

4553  
	`›“80211_ioùl_g‘İt›
(
dev
, 
šfo
, 
out
, 
buf
);

4554 
	}
}

4557 
	$›“80211_ioùl_siwg’›
(
Ãt_deviû
 *
dev
,

4558 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
”q
, *
d©a
)

4560  
	`›“80211_ioùl_£tİt›
(
dev
, 
šfo
, 
”q
, 
d©a
);

4561 
	}
}

4565 
	$siwauth_w·_v”siÚ
(
Ãt_deviû
 *
dev
,

4566 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4568 
v”
 = 
”q
->
v®ue
;

4569 
¬gs
[2];

4571 
¬gs
[0] = 
IEEE80211_PARAM_WPA
;

4573 ià((
v”
 & 
IW_AUTH_WPA_VERSION_WPA
è&& (v” & 
IW_AUTH_WPA_VERSION_WPA2
))

4574 
¬gs
[1] = 3;

4575 ià(
v”
 & 
IW_AUTH_WPA_VERSION_WPA2
)

4576 
¬gs
[1] = 2;

4577 ià(
v”
 & 
IW_AUTH_WPA_VERSION_WPA
)

4578 
¬gs
[1] = 1;

4580 
¬gs
[1] = 0;

4582  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4583 
	}
}

4586 
	$iwch”2›“80211ch”
(
iwch
)

4588 
iwch
) {

4589 
IW_AUTH_CIPHER_NONE
:

4590  
IEEE80211_CIPHER_NONE
;

4591 
IW_AUTH_CIPHER_WEP40
:

4592 
IW_AUTH_CIPHER_WEP104
:

4593  
IEEE80211_CIPHER_WEP
;

4594 
IW_AUTH_CIPHER_TKIP
:

4595  
IEEE80211_CIPHER_TKIP
;

4596 
IW_AUTH_CIPHER_CCMP
:

4597  
IEEE80211_CIPHER_AES_CCM
;

4600 
	}
}

4603 
	$›“80211ch”2iwch”
(
›“80211ch
)

4605 
›“80211ch
) {

4606 
IEEE80211_CIPHER_NONE
:

4607  
IW_AUTH_CIPHER_NONE
;

4608 
IEEE80211_CIPHER_WEP
:

4609  
IW_AUTH_CIPHER_WEP104
;

4610 
IEEE80211_CIPHER_TKIP
:

4611  
IW_AUTH_CIPHER_TKIP
;

4612 
IEEE80211_CIPHER_AES_CCM
:

4613  
IW_AUTH_CIPHER_CCMP
;

4616 
	}
}

4620 
	$siwauth_ch”_·œwi£
(
Ãt_deviû
 *
dev
,

4621 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4623 
iwch
 = 
”q
->
v®ue
;

4624 
¬gs
[2];

4626 
¬gs
[0] = 
IEEE80211_PARAM_UCASTCIPHER
;

4627 
¬gs
[1] = 
	`iwch”2›“80211ch”
(
iwch
);

4628 ià(
¬gs
[1] < 0) {

4629 
	`´štk
(
KERN_WARNING
 "%s: unknown…airwise cipher %d\n",

4630 
dev
->
Çme
, 
iwch
);

4631  -
EINVAL
;

4633  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4634 
	}
}

4638 
	$siwauth_ch”_group
(
Ãt_deviû
 *
dev
,

4639 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4641 
iwch
 = 
”q
->
v®ue
;

4642 
¬gs
[2];

4644 
¬gs
[0] = 
IEEE80211_PARAM_MCASTCIPHER
;

4645 
¬gs
[1] = 
	`iwch”2›“80211ch”
(
iwch
);

4646 ià(
¬gs
[1] < 0) {

4647 
	`´štk
(
KERN_WARNING
 "%s: unknown group cipher %d\n",

4648 
dev
->
Çme
, 
iwch
);

4649  -
EINVAL
;

4651  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4652 
	}
}

4655 
	$siwauth_key_mgmt
(
Ãt_deviû
 *
dev
,

4656 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4658 
iwkm
 = 
”q
->
v®ue
;

4659 
¬gs
[2];

4661 
¬gs
[0] = 
IEEE80211_PARAM_KEYMGTALGS
;

4662 
¬gs
[1] = 
WPA_ASE_NONE
;

4663 ià(
iwkm
 & 
IW_AUTH_KEY_MGMT_802_1X
)

4664 
¬gs
[1] |ğ
WPA_ASE_8021X_UNSPEC
;

4665 ià(
iwkm
 & 
IW_AUTH_KEY_MGMT_PSK
)

4666 
¬gs
[1] |ğ
WPA_ASE_8021X_PSK
;

4668  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4669 
	}
}

4672 
	$siwauth_tk_couÁ”m—su»s
(
Ãt_deviû
 *
dev
,

4673 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4675 
¬gs
[2];

4676 
¬gs
[0] = 
IEEE80211_PARAM_COUNTERMEASURES
;

4677 
¬gs
[1] = 
”q
->
v®ue
;

4678  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4679 
	}
}

4682 
	$siwauth_drİ_uÃnüy±ed
(
Ãt_deviû
 *
dev
,

4683 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4685 
¬gs
[2];

4686 
¬gs
[0] = 
IEEE80211_PARAM_DROPUNENCRYPTED
;

4687 
¬gs
[1] = 
”q
->
v®ue
;

4688  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4689 
	}
}

4693 
	$siwauth_80211_auth_®g
(
Ãt_deviû
 *
dev
,

4694 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4696 
	#VALID_ALGS_MASK
 (
IW_AUTH_ALG_OPEN_SYSTEM
|
IW_AUTH_ALG_SHARED_KEY
|
IW_AUTH_ALG_LEAP
)

	)

4697 
mode
 = 
”q
->
v®ue
;

4698 
¬gs
[2];

4700 
¬gs
[0] = 
IEEE80211_PARAM_AUTHMODE
;

4702 ià(
mode
 & ~
VALID_ALGS_MASK
)

4703  -
EINVAL
;

4705 ià(
mode
 & 
IW_AUTH_ALG_LEAP
) {

4706 
¬gs
[1] = 
IEEE80211_AUTH_8021X
;

4707 } ià((
mode
 & 
IW_AUTH_ALG_SHARED_KEY
) &&

4708 (
mode
 & 
IW_AUTH_ALG_OPEN_SYSTEM
)) {

4709 
¬gs
[1] = 
IEEE80211_AUTH_AUTO
;

4710 } ià(
mode
 & 
IW_AUTH_ALG_SHARED_KEY
) {

4711 
¬gs
[1] = 
IEEE80211_AUTH_SHARED
;

4713 
¬gs
[1] = 
IEEE80211_AUTH_OPEN
;

4715  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4716 
	}
}

4719 
	$siwauth_w·_’abËd
(
Ãt_deviû
 *
dev
,

4720 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4722 
’abËd
 = 
”q
->
v®ue
;

4723 
¬gs
[2];

4725 
¬gs
[0] = 
IEEE80211_PARAM_WPA
;

4726 ià(
’abËd
)

4727 
¬gs
[1] = 3;

4729 
¬gs
[1] = 0;

4731  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4732 
	}
}

4735 
	$siwauth_rx_uÃnüy±ed_—pŞ
(
Ãt_deviû
 *
dev
,

4736 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4738 
rxuÃnc
 = 
”q
->
v®ue
;

4739 
¬gs
[2];

4741 
¬gs
[0] = 
IEEE80211_PARAM_DROPUNENC_EAPOL
;

4742 ià(
rxuÃnc
)

4743 
¬gs
[1] = 1;

4745 
¬gs
[1] = 0;

4747  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4748 
	}
}

4751 
	$siwauth_rßmšg_cÚŒŞ
(
Ãt_deviû
 *
dev
,

4752 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4754 
rßm
 = 
”q
->
v®ue
;

4755 
¬gs
[2];

4757 
¬gs
[0] = 
IEEE80211_PARAM_ROAMING
;

4758 
rßm
) {

4759 
IW_AUTH_ROAMING_ENABLE
:

4760 
¬gs
[1] = 
IEEE80211_ROAMING_AUTO
;

4762 
IW_AUTH_ROAMING_DISABLE
:

4763 
¬gs
[1] = 
IEEE80211_ROAMING_MANUAL
;

4766  -
EINVAL
;

4768  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4769 
	}
}

4772 
	$siwauth_´ivacy_švoked
(
Ãt_deviû
 *
dev
,

4773 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4775 
¬gs
[2];

4776 
¬gs
[0] = 
IEEE80211_PARAM_PRIVACY
;

4777 
¬gs
[1] = 
”q
->
v®ue
;

4778  
	`›“80211_ioùl_£¬am
(
dev
, 
NULL
, NULL, (*)
¬gs
);

4779 
	}
}

4792 
	$›“80211_ioùl_siwauth
(
Ãt_deviû
 *
dev
,

4793 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4795 
rc
 = -
EOPNOTSUPP
;

4797 
”q
->
æags
 & 
IW_AUTH_INDEX
) {

4798 
IW_AUTH_WPA_VERSION
:

4799 
rc
 = 
	`siwauth_w·_v”siÚ
(
dev
, 
šfo
, 
”q
, 
buf
);

4801 
IW_AUTH_CIPHER_PAIRWISE
:

4802 
rc
 = 
	`siwauth_ch”_·œwi£
(
dev
, 
šfo
, 
”q
, 
buf
);

4804 
IW_AUTH_CIPHER_GROUP
:

4805 
rc
 = 
	`siwauth_ch”_group
(
dev
, 
šfo
, 
”q
, 
buf
);

4807 
IW_AUTH_KEY_MGMT
:

4808 
rc
 = 
	`siwauth_key_mgmt
(
dev
, 
šfo
, 
”q
, 
buf
);

4810 
IW_AUTH_TKIP_COUNTERMEASURES
:

4811 
rc
 = 
	`siwauth_tk_couÁ”m—su»s
(
dev
, 
šfo
, 
”q
, 
buf
);

4813 
IW_AUTH_DROP_UNENCRYPTED
:

4814 
rc
 = 
	`siwauth_drİ_uÃnüy±ed
(
dev
, 
šfo
, 
”q
, 
buf
);

4816 
IW_AUTH_80211_AUTH_ALG
:

4817 
rc
 = 
	`siwauth_80211_auth_®g
(
dev
, 
šfo
, 
”q
, 
buf
);

4819 
IW_AUTH_WPA_ENABLED
:

4820 
rc
 = 
	`siwauth_w·_’abËd
(
dev
, 
šfo
, 
”q
, 
buf
);

4822 
IW_AUTH_RX_UNENCRYPTED_EAPOL
:

4823 
rc
 = 
	`siwauth_rx_uÃnüy±ed_—pŞ
(
dev
, 
šfo
, 
”q
, 
buf
);

4825 
IW_AUTH_ROAMING_CONTROL
:

4826 
rc
 = 
	`siwauth_rßmšg_cÚŒŞ
(
dev
, 
šfo
, 
”q
, 
buf
);

4828 
IW_AUTH_PRIVACY_INVOKED
:

4829 
rc
 = 
	`siwauth_´ivacy_švoked
(
dev
, 
šfo
, 
”q
, 
buf
);

4832 
	`´štk
(
KERN_WARNING
 "%s: unknown SIOCSIWAUTH flag %d\n",

4833 
dev
->
Çme
, 
”q
->
æags
);

4837  
rc
;

4838 
	}
}

4841 
	$giwauth_w·_v”siÚ
(
Ãt_deviû
 *
dev
,

4842 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4844 
v”
;

4845 
rc
;

4846 
¬g
 = 
IEEE80211_PARAM_WPA
;

4848 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4849 ià(
rc
)

4850  
rc
;

4852 
¬g
) {

4854 
v”
 = 
IW_AUTH_WPA_VERSION_WPA
;

4857 
v”
 = 
IW_AUTH_WPA_VERSION_WPA2
;

4860 
v”
 = 
IW_AUTH_WPA_VERSION
|
IW_AUTH_WPA_VERSION_WPA2
;

4863 
v”
 = 
IW_AUTH_WPA_VERSION_DISABLED
;

4867 
”q
->
v®ue
 = 
v”
;

4868  
rc
;

4869 
	}
}

4872 
	$giwauth_ch”_·œwi£
(
Ãt_deviû
 *
dev
,

4873 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4875 
rc
;

4876 
¬g
 = 
IEEE80211_PARAM_UCASTCIPHER
;

4878 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4879 ià(
rc
)

4880  
rc
;

4882 
”q
->
v®ue
 = 
	`›“80211ch”2iwch”
(
¬g
);

4883 ià(
”q
->
v®ue
 < 0)

4884  -
EINVAL
;

4886 
	}
}

4890 
	$giwauth_ch”_group
(
Ãt_deviû
 *
dev
,

4891 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4893 
rc
;

4894 
¬g
 = 
IEEE80211_PARAM_MCASTCIPHER
;

4896 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4897 ià(
rc
)

4898  
rc
;

4900 
”q
->
v®ue
 = 
	`›“80211ch”2iwch”
(
¬g
);

4901 ià(
”q
->
v®ue
 < 0)

4902  -
EINVAL
;

4904 
	}
}

4907 
	$giwauth_key_mgmt
(
Ãt_deviû
 *
dev
,

4908 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4910 
¬g
;

4911 
rc
;

4913 
¬g
 = 
IEEE80211_PARAM_KEYMGTALGS
;

4914 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4915 ià(
rc
)

4916  
rc
;

4917 
”q
->
v®ue
 = 0;

4918 ià(
¬g
 & 
WPA_ASE_8021X_UNSPEC
)

4919 
”q
->
v®ue
 |ğ
IW_AUTH_KEY_MGMT_802_1X
;

4920 ià(
¬g
 & 
WPA_ASE_8021X_PSK
)

4921 
”q
->
v®ue
 |ğ
IW_AUTH_KEY_MGMT_PSK
;

4923 
	}
}

4926 
	$giwauth_tk_couÁ”m—su»s
(
Ãt_deviû
 *
dev
,

4927 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4929 
¬g
;

4930 
rc
;

4932 
¬g
 = 
IEEE80211_PARAM_COUNTERMEASURES
;

4933 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4934 ià(
rc
)

4935  
rc
;

4936 
”q
->
v®ue
 = 
¬g
;

4938 
	}
}

4941 
	$giwauth_drİ_uÃnüy±ed
(
Ãt_deviû
 *
dev
,

4942 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4944 
¬g
;

4945 
rc
;

4946 
¬g
 = 
IEEE80211_PARAM_DROPUNENCRYPTED
;

4947 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4948 ià(
rc
)

4949  
rc
;

4950 
”q
->
v®ue
 = 
¬g
;

4952 
	}
}

4955 
	$giwauth_80211_auth_®g
(
Ãt_deviû
 *
dev
,

4956 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4958  -
EOPNOTSUPP
;

4959 
	}
}

4962 
	$giwauth_w·_’abËd
(
Ãt_deviû
 *
dev
,

4963 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4965 
rc
;

4966 
¬g
 = 
IEEE80211_PARAM_WPA
;

4968 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4969 ià(
rc
)

4970  
rc
;

4972 
”q
->
v®ue
 = 
¬g
;

4975 
	}
}

4978 
	$giwauth_rx_uÃnüy±ed_—pŞ
(
Ãt_deviû
 *
dev
,

4979 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4981  -
EOPNOTSUPP
;

4982 
	}
}

4985 
	$giwauth_rßmšg_cÚŒŞ
(
Ãt_deviû
 *
dev
,

4986 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

4988 
rc
;

4989 
¬g
;

4991 
¬g
 = 
IEEE80211_PARAM_ROAMING
;

4992 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

4993 ià(
rc
)

4994  
rc
;

4996 
¬g
) {

4997 
IEEE80211_ROAMING_DEVICE
:

4998 
IEEE80211_ROAMING_AUTO
:

4999 
”q
->
v®ue
 = 
IW_AUTH_ROAMING_ENABLE
;

5002 
”q
->
v®ue
 = 
IW_AUTH_ROAMING_DISABLE
;

5007 
	}
}

5010 
	$giwauth_´ivacy_švoked
(
Ãt_deviû
 *
dev
,

5011 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

5013 
rc
;

5014 
¬g
;

5015 
¬g
 = 
IEEE80211_PARAM_PRIVACY
;

5016 
rc
 = 
	`›“80211_ioùl_g‘·¿m
(
dev
, 
NULL
, NULL, (*)&
¬g
);

5017 ià(
rc
)

5018  
rc
;

5019 
”q
->
v®ue
 = 
¬g
;

5021 
	}
}

5024 
	$›“80211_ioùl_giwauth
(
Ãt_deviû
 *
dev
,

5025 
iw_»que¡_šfo
 *
šfo
, 
iw_·¿m
 *
”q
, *
buf
)

5027 
rc
 = -
EOPNOTSUPP
;

5029 
”q
->
æags
 & 
IW_AUTH_INDEX
) {

5030 
IW_AUTH_WPA_VERSION
:

5031 
rc
 = 
	`giwauth_w·_v”siÚ
(
dev
, 
šfo
, 
”q
, 
buf
);

5033 
IW_AUTH_CIPHER_PAIRWISE
:

5034 
rc
 = 
	`giwauth_ch”_·œwi£
(
dev
, 
šfo
, 
”q
, 
buf
);

5036 
IW_AUTH_CIPHER_GROUP
:

5037 
rc
 = 
	`giwauth_ch”_group
(
dev
, 
šfo
, 
”q
, 
buf
);

5039 
IW_AUTH_KEY_MGMT
:

5040 
rc
 = 
	`giwauth_key_mgmt
(
dev
, 
šfo
, 
”q
, 
buf
);

5042 
IW_AUTH_TKIP_COUNTERMEASURES
:

5043 
rc
 = 
	`giwauth_tk_couÁ”m—su»s
(
dev
, 
šfo
, 
”q
, 
buf
);

5045 
IW_AUTH_DROP_UNENCRYPTED
:

5046 
rc
 = 
	`giwauth_drİ_uÃnüy±ed
(
dev
, 
šfo
, 
”q
, 
buf
);

5048 
IW_AUTH_80211_AUTH_ALG
:

5049 
rc
 = 
	`giwauth_80211_auth_®g
(
dev
, 
šfo
, 
”q
, 
buf
);

5051 
IW_AUTH_WPA_ENABLED
:

5052 
rc
 = 
	`giwauth_w·_’abËd
(
dev
, 
šfo
, 
”q
, 
buf
);

5054 
IW_AUTH_RX_UNENCRYPTED_EAPOL
:

5055 
rc
 = 
	`giwauth_rx_uÃnüy±ed_—pŞ
(
dev
, 
šfo
, 
”q
, 
buf
);

5057 
IW_AUTH_ROAMING_CONTROL
:

5058 
rc
 = 
	`giwauth_rßmšg_cÚŒŞ
(
dev
, 
šfo
, 
”q
, 
buf
);

5060 
IW_AUTH_PRIVACY_INVOKED
:

5061 
rc
 = 
	`giwauth_´ivacy_švoked
(
dev
, 
šfo
, 
”q
, 
buf
);

5064 
	`´štk
(
KERN_WARNING
 "%s: unknown SIOCGIWAUTH flag %d\n",

5065 
dev
->
Çme
, 
”q
->
æags
);

5069  
rc
;

5070 
	}
}

5078 
	$›“80211_ioùl_giw’cod“xt
(
Ãt_deviû
 *
dev
,

5079 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
”q
, *
exŒa
)

5081 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

5082 
iw_’code_ext
 *
ext
;

5083 
›“80211_key
 *
wk
;

5084 
›“80211_keyix_t
 
kix
;

5085 
max_key_Ën
;

5086 
”rÜ
;

5088 ià(!
	`ÿ·bË
(
CAP_NET_ADMIN
))

5089  -
EPERM
;

5091 
max_key_Ën
 = 
”q
->
Ëngth
 - (*
ext
);

5092 ià(
max_key_Ën
 < 0)

5093  -
EINVAL
;

5094 
ext
 = (
iw_’code_ext
 *)
exŒa
;

5096 
”rÜ
 = 
	`g‘iwkeyix
(
v­
, 
”q
, &
kix
);

5097 ià(
”rÜ
 < 0)

5098  
”rÜ
;

5100 
wk
 = &
v­
->
iv_nw_keys
[
kix
];

5101 ià(
wk
->
wk_keyËn
 > 
max_key_Ën
)

5102  -
E2BIG
;

5104 
”q
->
æags
 = 
kix
 + 1;

5105 
	`mem£t
(
ext
, 0, (*ext));

5107 
ext
->
key_Ën
 = 
wk
->
wk_keyËn
;

5108 
	`memıy
(
ext
->
key
, 
wk
->
wk_key
, wk->
wk_keyËn
);

5111 ià(
wk
->
wk_æags
 & 
IEEE80211_KEY_GROUP
)

5112 
ext
->
ext_æags
 |ğ
IW_ENCODE_EXT_GROUP_KEY
;

5115 
wk
->
wk_ch”
->
ic_ch”
) {

5116 
IEEE80211_CIPHER_NONE
:

5117 
ext
->
®g
 = 
IW_ENCODE_ALG_NONE
;

5118 
”q
->
æags
 |ğ
IW_ENCODE_DISABLED
;

5120 
IEEE80211_CIPHER_WEP
:

5121 
ext
->
®g
 = 
IW_ENCODE_ALG_WEP
;

5123 
IEEE80211_CIPHER_TKIP
:

5124 
ext
->
®g
 = 
IW_ENCODE_ALG_TKIP
;

5126 
IEEE80211_CIPHER_AES_OCB
:

5127 
IEEE80211_CIPHER_AES_CCM
:

5128 
IEEE80211_CIPHER_CKIP
:

5129 
ext
->
®g
 = 
IW_ENCODE_ALG_CCMP
;

5132  -
EINVAL
;

5135 
	}
}

5138 
	$›“80211_ioùl_siw’cod“xt
(
Ãt_deviû
 *
dev
,

5139 
iw_»que¡_šfo
 *
šfo
, 
iw_pošt
 *
”q
, *
exŒa
)

5141 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

5142 
iw_’code_ext
 *
ext
 = (iw_’code_exˆ*)
exŒa
;

5143 
›“80211»q_key
 
kr
;

5144 
›“80211_keyix_t
 
kix
;

5145 
”rÜ
;

5147 
”rÜ
 = 
	`g‘iwkeyix
(
v­
, 
”q
, &
kix
);

5148 ià(
”rÜ
 < 0)

5149  
”rÜ
;

5151 ià(
ext
->
key_Ën
 > (
”q
->
Ëngth
 - (
iw_’code_ext
)))

5152  -
E2BIG
;

5154 ià(
ext
->
®g
 =ğ
IW_ENCODE_ALG_NONE
) {

5156 
›“80211»q_d–_key
 
dk
;

5158 
	`mem£t
(&
dk
, 0, (dk));

5159 
dk
.
idk_keyix
 = 
kix
;

5160 
	`memıy
(&
dk
.
idk_maÿddr
, 
ext
->
addr
.
§_d©a
, 
IEEE80211_ADDR_LEN
);

5162  
	`›“80211_ioùl_d–key
(
dev
, 
NULL
, NULL, (*)&
dk
);

5171 ià((
ext
->
®g
 =ğ
IW_ENCODE_ALG_WEP
) &&

5172 
	`IEEE80211_ADDR_EQ
(
ext
->
addr
.
§_d©a
,

5173 
v­
->
iv_dev
->
brßdÿ¡
)) {

5178 
iw_»que¡_šfo
 
Şdšfo
;

5179 
iw_pošt
 
Şd”q
;

5180 *
key
;

5182 
	`mem£t
(&
Şdšfo
, 0, (oldinfo));

5183 
Şdšfo
.
cmd
 = 
SIOCSIWENCODE
;

5184 
Şdšfo
.
æags
 = 
šfo
->flags;

5186 
	`mem£t
(&
Şd”q
, 0, (olderq));

5187 
Şd”q
.
æags
 = 
”q
->flags;

5188 
Şd”q
.
poš‹r
 = 
”q
->pointer;

5189 
Şd”q
.
Ëngth
 = 
ext
->
key_Ën
;

5191 
key
 = 
ext
->key;

5193  
	`›“80211_ioùl_siw’code
(
dev
, &
Şdšfo
, &
Şd”q
, 
key
);

5197 
	`mem£t
(&
kr
, 0, (kr));

5199 
ext
->
®g
) {

5200 
IW_ENCODE_ALG_WEP
:

5201 
kr
.
ik_ty³
 = 
IEEE80211_CIPHER_WEP
;

5203 
IW_ENCODE_ALG_TKIP
:

5204 
kr
.
ik_ty³
 = 
IEEE80211_CIPHER_TKIP
;

5206 
IW_ENCODE_ALG_CCMP
:

5207 
kr
.
ik_ty³
 = 
IEEE80211_CIPHER_AES_CCM
;

5210 
	`´štk
(
KERN_WARNING
 "%s: unknown‡lgorithm %d\n",

5211 
dev
->
Çme
, 
ext
->
®g
);

5212  -
EINVAL
;

5215 
kr
.
ik_keyix
 = 
kix
;

5217 ià(
ext
->
key_Ën
 > (
kr
.
ik_keyd©a
)) {

5218 
	`´štk
(
KERN_WARNING
 "%s: key size %d isoo†arge\n",

5219 
dev
->
Çme
, 
ext
->
key_Ën
);

5220  -
E2BIG
;

5222 
	`memıy
(
kr
.
ik_keyd©a
, 
ext
->
key
,ƒxt->
key_Ën
);

5223 
kr
.
ik_keyËn
 = 
ext
->
key_Ën
;

5225 
kr
.
ik_æags
 = 
IEEE80211_KEY_RECV
;

5227 ià(
ext
->
ext_æags
 & 
IW_ENCODE_EXT_GROUP_KEY
)

5228 
kr
.
ik_æags
 |ğ
IEEE80211_KEY_GROUP
;

5230 ià(
ext
->
ext_æags
 & 
IW_ENCODE_EXT_SET_TX_KEY
) {

5231 
kr
.
ik_æags
 |ğ
IEEE80211_KEY_XMIT
 | 
IEEE80211_KEY_DEFAULT
;

5232 
	`memıy
(
kr
.
ik_maÿddr
, 
ext
->
addr
.
§_d©a
, 
IEEE80211_ADDR_LEN
);

5235 ià(
ext
->
ext_æags
 & 
IW_ENCODE_EXT_RX_SEQ_VALID
) {

5236 
	`memıy
(&
kr
.
ik_keyrsc
, 
ext
->
rx_£q
, (kr.ik_keyrsc));

5239  
	`›“80211_ioùl_£tkey
(
dev
, 
NULL
, NULL, (*)&
kr
);

5240 
	}
}

5243 
	#IW_PRIV_TYPE_OPTIE
 \

5244 
	`IW_PRIV_BLOB_TYPE_ENCODING
(
IEEE80211_MAX_OPT_IE
)

	)

5245 
	#IW_PRIV_TYPE_KEY
 \

5246 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_key
))

	)

5247 
	#IW_PRIV_TYPE_DELKEY
 \

5248 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_d–_key
))

	)

5249 
	#IW_PRIV_TYPE_MLME
 \

5250 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_mlme
))

	)

5251 
	#IW_PRIV_TYPE_CHANLIST
 \

5252 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_chªli¡
))

	)

5253 
	#IW_PRIV_TYPE_CHANINFO
 \

5254 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_chªšfo
))

	)

5255 
	#IW_PRIV_TYPE_APPIEBUF
 \

5256 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_g‘£t_­p›buf
è+ 
IEEE80211_APPIE_MAX
)

	)

5257 
	#IW_PRIV_TYPE_FILTER
 \

5258 
	`IW_PRIV_BLOB_TYPE_ENCODING
((
›“80211»q_£t_f‹r
))

	)

5260 cÚ¡ 
iw_´iv_¬gs
 
	g›“80211_´iv_¬gs
[] = {

5262 { 
IEEE80211_IOCTL_SETOPTIE
,

5263 
IW_PRIV_TYPE_OPTIE
, 0, "setoptie" },

5264 { 
IEEE80211_IOCTL_GETOPTIE
,

5265 0, 
IW_PRIV_TYPE_OPTIE
, "getoptie" },

5266 { 
IEEE80211_IOCTL_SETKEY
,

5267 
IW_PRIV_TYPE_KEY
 | 
IW_PRIV_SIZE_FIXED
, 0, "setkey" },

5268 { 
IEEE80211_IOCTL_DELKEY
,

5269 
IW_PRIV_TYPE_DELKEY
 | 
IW_PRIV_SIZE_FIXED
, 0, "delkey" },

5270 { 
IEEE80211_IOCTL_SETMLME
,

5271 
IW_PRIV_TYPE_MLME
 | 
IW_PRIV_SIZE_FIXED
, 0, "setmlme" },

5272 { 
IEEE80211_IOCTL_ADDMAC
,

5273 
IW_PRIV_TYPE_ADDR
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0,"addmac" },

5274 { 
IEEE80211_IOCTL_DELMAC
,

5275 
IW_PRIV_TYPE_ADDR
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0,"delmac" },

5276 { 
IEEE80211_IOCTL_KICKMAC
,

5277 
IW_PRIV_TYPE_ADDR
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "kickmac"},

5278 { 
IEEE80211_IOCTL_WDSADDMAC
,

5279 
IW_PRIV_TYPE_ADDR
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0,"wds_add" },

5280 { 
IEEE80211_IOCTL_WDSDELMAC
,

5281 
IW_PRIV_TYPE_ADDR
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0,"wds_del" },

5282 { 
IEEE80211_IOCTL_SETCHANLIST
,

5283 
IW_PRIV_TYPE_CHANLIST
 | 
IW_PRIV_SIZE_FIXED
, 0,"setchanlist" },

5284 { 
IEEE80211_IOCTL_GETCHANLIST
,

5285 0, 
IW_PRIV_TYPE_CHANLIST
 | 
IW_PRIV_SIZE_FIXED
,"getchanlist" },

5286 { 
IEEE80211_IOCTL_GETCHANINFO
,

5287 0, 
IW_PRIV_TYPE_CHANINFO
 | 
IW_PRIV_SIZE_FIXED
,"getchaninfo" },

5288 { 
IEEE80211_IOCTL_SETMODE
,

5289 
IW_PRIV_TYPE_CHAR
 | 6, 0, "mode" },

5290 { 
IEEE80211_IOCTL_GETMODE
,

5291 0, 
IW_PRIV_TYPE_CHAR
 | 6, "get_mode" },

5292 { 
IEEE80211_IOCTL_SETWMMPARAMS
,

5293 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 4, 0,"setwmmparams" },

5294 { 
IEEE80211_IOCTL_GETWMMPARAMS
,

5295 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3,

5296 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "getwmmparams" },

5297 { 
IEEE80211_IOCTL_RADAR
,

5299 { 
IEEE80211_IOCTL_HALMAP
,

5304 { 
IEEE80211_IOCTL_SETWMMPARAMS
,

5305 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"" },

5306 { 
IEEE80211_IOCTL_GETWMMPARAMS
,

5307 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5308 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "" },

5310 { 
IEEE80211_WMMPARAMS_CWMIN
,

5311 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"cwmin" },

5312 { 
IEEE80211_WMMPARAMS_CWMIN
,

5313 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5314 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_cwmin" },

5315 { 
IEEE80211_WMMPARAMS_CWMAX
,

5316 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"cwmax" },

5317 { 
IEEE80211_WMMPARAMS_CWMAX
,

5318 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5319 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_cwmax" },

5320 { 
IEEE80211_WMMPARAMS_AIFS
,

5321 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"aifs" },

5322 { 
IEEE80211_WMMPARAMS_AIFS
,

5323 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5324 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_aifs" },

5325 { 
IEEE80211_WMMPARAMS_TXOPLIMIT
,

5326 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"txoplimit" },

5327 { 
IEEE80211_WMMPARAMS_TXOPLIMIT
,

5328 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5329 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_txoplimit" },

5330 { 
IEEE80211_WMMPARAMS_ACM
,

5331 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"acm" },

5332 { 
IEEE80211_WMMPARAMS_ACM
,

5333 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5334 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_acm" },

5335 { 
IEEE80211_WMMPARAMS_NOACKPOLICY
,

5336 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 3, 0,"noackpolicy" },

5337 { 
IEEE80211_WMMPARAMS_NOACKPOLICY
,

5338 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2,

5339 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_noackpolicy" },

5341 { 
IEEE80211_IOCTL_SETPARAM
,

5342 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2, 0, "setparam" },

5346 { 
IEEE80211_IOCTL_GETPARAM
,

5347 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1,

5348 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "getparam" },

5351 { 
IEEE80211_IOCTL_SETPARAM
,

5352 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "" },

5353 { 
IEEE80211_IOCTL_GETPARAM
,

5354 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "" },

5357 { 
IEEE80211_PARAM_AUTHMODE
,

5358 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "authmode" },

5359 { 
IEEE80211_PARAM_AUTHMODE
,

5360 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_authmode" },

5361 { 
IEEE80211_PARAM_PROTMODE
,

5362 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "protmode" },

5363 { 
IEEE80211_PARAM_PROTMODE
,

5364 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_protmode" },

5365 { 
IEEE80211_PARAM_MCASTCIPHER
,

5366 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "mcastcipher" },

5367 { 
IEEE80211_PARAM_MCASTCIPHER
,

5368 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_mcastcipher" },

5369 { 
IEEE80211_PARAM_MCASTKEYLEN
,

5370 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "mcastkeylen" },

5371 { 
IEEE80211_PARAM_MCASTKEYLEN
,

5372 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_mcastkeylen" },

5373 { 
IEEE80211_PARAM_UCASTCIPHERS
,

5374 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ucastciphers" },

5375 { 
IEEE80211_PARAM_UCASTCIPHERS
,

5380 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_uciphers" },

5381 { 
IEEE80211_PARAM_UCASTCIPHER
,

5382 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ucastcipher" },

5383 { 
IEEE80211_PARAM_UCASTCIPHER
,

5384 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_ucastcipher" },

5385 { 
IEEE80211_PARAM_UCASTKEYLEN
,

5386 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ucastkeylen" },

5387 { 
IEEE80211_PARAM_UCASTKEYLEN
,

5388 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_ucastkeylen" },

5389 { 
IEEE80211_PARAM_KEYMGTALGS
,

5390 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "keymgtalgs" },

5391 { 
IEEE80211_PARAM_KEYMGTALGS
,

5392 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_keymgtalgs" },

5393 { 
IEEE80211_PARAM_RSNCAPS
,

5394 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rsncaps" },

5395 { 
IEEE80211_PARAM_RSNCAPS
,

5396 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rsncaps" },

5397 { 
IEEE80211_PARAM_ROAMING
,

5398 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "hostroaming" },

5399 { 
IEEE80211_PARAM_ROAMING
,

5400 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_hostroaming" },

5401 { 
IEEE80211_PARAM_PRIVACY
,

5402 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "privacy" },

5403 { 
IEEE80211_PARAM_PRIVACY
,

5404 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_privacy" },

5405 { 
IEEE80211_PARAM_COUNTERMEASURES
,

5406 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "countermeasures" },

5407 { 
IEEE80211_PARAM_COUNTERMEASURES
,

5408 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_countermeas" },

5409 { 
IEEE80211_PARAM_DROPUNENCRYPTED
,

5410 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dropunencrypted" },

5411 { 
IEEE80211_PARAM_DROPUNENCRYPTED
,

5412 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dropunencry" },

5413 { 
IEEE80211_PARAM_WPA
,

5414 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "wpa" },

5415 { 
IEEE80211_PARAM_WPA
,

5416 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_wpa" },

5417 { 
IEEE80211_PARAM_DRIVER_CAPS
,

5418 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "driver_caps" },

5419 { 
IEEE80211_PARAM_DRIVER_CAPS
,

5420 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_driver_caps" },

5421 { 
IEEE80211_PARAM_MACCMD
,

5422 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "maccmd" },

5423 { 
IEEE80211_PARAM_WMM
,

5424 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "wmm" },

5425 { 
IEEE80211_PARAM_WMM
,

5426 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_wmm" },

5427 { 
IEEE80211_PARAM_HIDESSID
,

5428 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "hide_ssid" },

5429 { 
IEEE80211_PARAM_HIDESSID
,

5430 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_hide_ssid" },

5431 { 
IEEE80211_PARAM_APBRIDGE
,

5432 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ap_bridge" },

5433 { 
IEEE80211_PARAM_APBRIDGE
,

5434 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_ap_bridge" },

5435 { 
IEEE80211_PARAM_INACT
,

5436 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "inact" },

5437 { 
IEEE80211_PARAM_INACT
,

5438 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_inact" },

5439 { 
IEEE80211_PARAM_INACT_AUTH
,

5440 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "inact_auth" },

5441 { 
IEEE80211_PARAM_INACT_AUTH
,

5442 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_inact_auth" },

5443 { 
IEEE80211_PARAM_INACT_INIT
,

5444 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "inact_init" },

5445 { 
IEEE80211_PARAM_INACT_INIT
,

5446 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_inact_init" },

5447 { 
IEEE80211_PARAM_ABOLT
,

5448 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "abolt" },

5449 { 
IEEE80211_PARAM_ABOLT
,

5450 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_abolt" },

5451 { 
IEEE80211_PARAM_DTIM_PERIOD
,

5452 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dtim_period" },

5453 { 
IEEE80211_PARAM_DTIM_PERIOD
,

5454 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dtim_period" },

5456 { 
IEEE80211_PARAM_BEACON_INTERVAL
,

5457 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bintval" },

5458 { 
IEEE80211_PARAM_BEACON_INTERVAL
,

5459 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bintval" },

5460 { 
IEEE80211_PARAM_BEACON_MISS_THRESH_MS
,

5461 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bmiss_ms" },

5462 { 
IEEE80211_PARAM_BEACON_MISS_THRESH_MS
,

5463 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bmiss_ms" },

5464 { 
IEEE80211_PARAM_BEACON_MISS_THRESH
,

5465 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bmiss" },

5466 { 
IEEE80211_PARAM_BEACON_MISS_THRESH
,

5467 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bmiss" },

5468 { 
IEEE80211_PARAM_DOTH
,

5469 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth" },

5470 { 
IEEE80211_PARAM_DOTH
,

5471 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth" },

5472 { 
IEEE80211_PARAM_PWRTARGET
,

5473 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_pwrtgt" },

5474 { 
IEEE80211_PARAM_PWRTARGET
,

5475 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth_pwrtgt" },

5476 { 
IEEE80211_PARAM_GENREASSOC
,

5477 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_reassoc" },

5478 { 
IEEE80211_PARAM_DOTH_ALGORITHM
,

5479 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_algo" },

5480 { 
IEEE80211_PARAM_DOTH_ALGORITHM
,

5481 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth_algo" },

5482 { 
IEEE80211_PARAM_DOTH_MINCOM
,

5483 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_mincom" },

5484 { 
IEEE80211_PARAM_DOTH_MINCOM
,

5485 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth_mincom" },

5486 { 
IEEE80211_PARAM_DOTH_SLCG
,

5487 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_slcg" },

5488 { 
IEEE80211_PARAM_DOTH_SLCG
,

5489 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth_slcg" },

5490 { 
IEEE80211_PARAM_DOTH_SLDG
,

5491 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "doth_sldg" },

5492 { 
IEEE80211_PARAM_DOTH_SLDG
,

5493 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_doth_sldg" },

5495 { 
IEEE80211_PARAM_TXCONT
,

5496 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "txcont" },

5497 { 
IEEE80211_PARAM_TXCONT
,

5498 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_txcont" },

5499 { 
IEEE80211_PARAM_TXCONT_RATE
,

5500 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "txcontrate" },

5501 { 
IEEE80211_PARAM_TXCONT_RATE
,

5502 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_txcontrate" },

5503 { 
IEEE80211_PARAM_TXCONT_POWER
,

5504 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "txcontpower" },

5505 { 
IEEE80211_PARAM_TXCONT_POWER
,

5506 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_txcontpower" },

5507 { 
IEEE80211_PARAM_DFS_TESTMODE
,

5508 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dfstestmode" },

5509 { 
IEEE80211_PARAM_DFS_TESTMODE
,

5510 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dfstestmode" },

5511 { 
IEEE80211_PARAM_DFS_CACTIME
,

5512 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dfscactime" },

5513 { 
IEEE80211_PARAM_DFS_CACTIME
,

5514 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dfscactime" },

5515 { 
IEEE80211_PARAM_DFS_EXCLPERIOD
,

5516 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dfsexcltim" },

5517 { 
IEEE80211_PARAM_DFS_EXCLPERIOD
,

5518 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dfsexcltim" },

5519 { 
IEEE80211_PARAM_COMPRESSION
,

5520 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "compression" },

5521 { 
IEEE80211_PARAM_COMPRESSION
, 0,

5522 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_compression" },

5523 { 
IEEE80211_PARAM_FF
,

5524 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ff" },

5525 { 
IEEE80211_PARAM_FF
, 0,

5526 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_ff" },

5527 { 
IEEE80211_PARAM_TURBO
,

5528 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "turbo" },

5529 { 
IEEE80211_PARAM_TURBO
, 0,

5530 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_turbo" },

5531 { 
IEEE80211_PARAM_XR
,

5532 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "xr" },

5533 { 
IEEE80211_PARAM_XR
, 0,

5534 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_xr" },

5535 { 
IEEE80211_PARAM_BURST
,

5536 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "burst" },

5537 { 
IEEE80211_PARAM_BURST
, 0,

5538 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_burst" },

5539 { 
IEEE80211_IOCTL_CHANSWITCH
,

5540 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2, 0, "doth_chanswitch" },

5541 { 
IEEE80211_PARAM_PUREG
,

5542 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "pureg" },

5543 { 
IEEE80211_PARAM_PUREG
, 0,

5544 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_pureg" },

5545 { 
IEEE80211_PARAM_AR
,

5546 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "ar" },

5547 { 
IEEE80211_PARAM_AR
, 0,

5548 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_ar" },

5549 { 
IEEE80211_PARAM_WDS
,

5550 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "wds" },

5551 { 
IEEE80211_PARAM_WDS
, 0,

5552 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_wds" },

5553 { 
IEEE80211_PARAM_BGSCAN
,

5554 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bgscan" },

5555 { 
IEEE80211_PARAM_BGSCAN
, 0,

5556 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bgscan" },

5557 { 
IEEE80211_PARAM_BGSCAN_IDLE
,

5558 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bgscanidle" },

5559 { 
IEEE80211_PARAM_BGSCAN_IDLE
,

5560 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bgscanidle" },

5561 { 
IEEE80211_PARAM_BGSCAN_INTERVAL
,

5562 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "bgscanintvl" },

5563 { 
IEEE80211_PARAM_BGSCAN_INTERVAL
,

5564 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_bgscanintvl" },

5565 { 
IEEE80211_PARAM_MCAST_RATE
,

5566 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "mcast_rate" },

5567 { 
IEEE80211_PARAM_MCAST_RATE
,

5568 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_mcast_rate" },

5569 { 
IEEE80211_PARAM_COVERAGE_CLASS
,

5570 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "coverageclass" },

5571 { 
IEEE80211_PARAM_COVERAGE_CLASS
,

5572 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_coveragecls" },

5573 { 
IEEE80211_PARAM_COUNTRY_IE
,

5574 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "countryie" },

5575 { 
IEEE80211_PARAM_COUNTRY_IE
,

5576 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_countryie" },

5577 { 
IEEE80211_PARAM_SCANVALID
,

5578 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "scanvalid" },

5579 { 
IEEE80211_PARAM_SCANVALID
,

5580 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_scanvalid" },

5581 { 
IEEE80211_PARAM_REGCLASS
,

5582 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "regclass" },

5583 { 
IEEE80211_PARAM_REGCLASS
,

5584 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_regclass" },

5585 { 
IEEE80211_PARAM_DROPUNENC_EAPOL
,

5586 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dropunenceapol" },

5587 { 
IEEE80211_PARAM_DROPUNENC_EAPOL
,

5588 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_dropunencea" },

5589 { 
IEEE80211_PARAM_SHPREAMBLE
,

5590 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "shpreamble" },

5591 { 
IEEE80211_PARAM_SHPREAMBLE
,

5592 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_shpreamble" },

5597 { 
IEEE80211_PARAM_ROAM_RSSI_11A
,

5598 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rssi11a" },

5599 { 
IEEE80211_PARAM_ROAM_RSSI_11A
,

5600 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rssi11a" },

5601 { 
IEEE80211_PARAM_ROAM_RSSI_11B
,

5602 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rssi11b" },

5603 { 
IEEE80211_PARAM_ROAM_RSSI_11B
,

5604 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rssi11b" },

5605 { 
IEEE80211_PARAM_ROAM_RSSI_11G
,

5606 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rssi11g" },

5607 { 
IEEE80211_PARAM_ROAM_RSSI_11G
,

5608 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rssi11g" },

5609 { 
IEEE80211_PARAM_ROAM_RATE_11A
,

5610 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rate11a_x2" },

5611 { 
IEEE80211_PARAM_ROAM_RATE_11A
,

5612 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rate11a_x2" },

5613 { 
IEEE80211_PARAM_ROAM_RATE_11B
,

5614 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rate11b_x2" },

5615 { 
IEEE80211_PARAM_ROAM_RATE_11B
,

5616 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rate11b_x2" },

5617 { 
IEEE80211_PARAM_ROAM_RATE_11G
,

5618 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rate11g_x2" },

5619 { 
IEEE80211_PARAM_ROAM_RATE_11G
,

5620 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rate11g_x2" },

5621 { 
IEEE80211_PARAM_UAPSDINFO
,

5622 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "uapsd" },

5623 { 
IEEE80211_PARAM_UAPSDINFO
,

5624 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_uapsd" },

5625 { 
IEEE80211_PARAM_SLEEP
,

5626 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "sleep" },

5627 { 
IEEE80211_PARAM_SLEEP
,

5628 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_sleep" },

5629 { 
IEEE80211_PARAM_QOSNULL
,

5630 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "qosnull" },

5631 { 
IEEE80211_PARAM_PSPOLL
,

5632 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "pspoll" },

5633 { 
IEEE80211_PARAM_EOSPDROP
,

5634 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "eospdrop" },

5635 { 
IEEE80211_PARAM_EOSPDROP
,

5636 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_eospdrop" },

5637 { 
IEEE80211_PARAM_MARKDFS
,

5638 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "markdfs" },

5639 { 
IEEE80211_PARAM_MARKDFS
,

5640 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_markdfs" },

5641 { 
IEEE80211_IOCTL_SET_APPIEBUF
,

5642 
IW_PRIV_TYPE_APPIEBUF
, 0, "setiebuf" },

5643 { 
IEEE80211_IOCTL_GET_APPIEBUF
,

5644 0, 
IW_PRIV_TYPE_APPIEBUF
, "getiebuf" },

5645 { 
IEEE80211_IOCTL_FILTERFRAME
,

5646 
IW_PRIV_TYPE_FILTER
 , 0, "setfilter" },

5647 { 
IEEE80211_PARAM_RSSI_EWMA
,

5648 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "rssi_ewma" },

5649 { 
IEEE80211_PARAM_RSSI_EWMA
,

5650 0, 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, "get_rssi_ewma" },

5651 { 
IEEE80211_PARAM_DRAINTXQ
,

5652 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_draintxq" },

5653 { 
IEEE80211_PARAM_STOP_QUEUE
,

5654 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_stopq" },

5655 { 
IEEE80211_PARAM_TXTIMEOUT
,

5656 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_txtimeout" },

5657 { 
IEEE80211_PARAM_ATHRESET
,

5658 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_athreset" },

5659 { 
IEEE80211_PARAM_RESETTXBUFS
,

5660 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_newtxbufs" },

5661 { 
IEEE80211_PARAM_SCANBUFS
,

5662 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_scanbufs" },

5663 { 
IEEE80211_PARAM_LEAKTXBUFS
,

5664 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "debug_leaktxbufs" },

5666 #ifdeà
ATH_REVERSE_ENGINEERING


5670 { 
IEEE80211_PARAM_DUMPREGS
,

5671 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, 0, "dumpregs" },

5672 { 
IEEE80211_IOCTL_READREG
,

5673 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 1, IW_PRIV_TYPE_INT | IW_PRIV_SIZE_FIXED | 1, "readreg" },

5674 { 
IEEE80211_IOCTL_WRITEREG
,

5675 
IW_PRIV_TYPE_INT
 | 
IW_PRIV_SIZE_FIXED
 | 2, 0, "writereg" },

5679 
	#£t_hªdËr
(
x
,
f
è[x - 
SIOCIWFIRST
] = (
iw_hªdËr
è
	)
f

5680 cÚ¡ 
iw_hªdËr
 
	g›“80211_hªdËrs
[] = {

5681 
£t_hªdËr
(
SIOCGIWNAME
, 
›“80211_ioùl_giwÇme
),

5682 
£t_hªdËr
(
SIOCSIWFREQ
, 
›“80211_ioùl_siwäeq
),

5683 
£t_hªdËr
(
SIOCGIWFREQ
, 
›“80211_ioùl_giwäeq
),

5684 
£t_hªdËr
(
SIOCSIWMODE
, 
›“80211_ioùl_siwmode
),

5685 
£t_hªdËr
(
SIOCGIWMODE
, 
›“80211_ioùl_giwmode
),

5686 
£t_hªdËr
(
SIOCSIWSENS
, 
›“80211_ioùl_siw£ns
),

5687 
£t_hªdËr
(
SIOCGIWSENS
, 
›“80211_ioùl_giw£ns
),

5688 
£t_hªdËr
(
SIOCGIWRANGE
, 
›“80211_ioùl_giw¿nge
),

5689 
£t_hªdËr
(
SIOCSIWSPY
, 
›“80211_ioùl_£t¥y
),

5690 
£t_hªdËr
(
SIOCGIWSPY
, 
›“80211_ioùl_g‘¥y
),

5691 #ià
WIRELESS_EXT
 >= 16

5692 
£t_hªdËr
(
SIOCSIWTHRSPY
, 
›“80211_ioùl_£‰hr¥y
),

5693 
£t_hªdËr
(
SIOCGIWTHRSPY
, 
›“80211_ioùl_g‘thr¥y
),

5695 
£t_hªdËr
(
SIOCSIWAP
, 
›“80211_ioùl_siw­
),

5696 
£t_hªdËr
(
SIOCGIWAP
, 
›“80211_ioùl_giw­
),

5697 #ifdeà
SIOCSIWMLME


5698 
£t_hªdËr
(
SIOCSIWMLME
, 
›“80211_ioùl_siwmlme
),

5700 
£t_hªdËr
(
SIOCGIWAPLIST
, 
›“80211_ioùl_iw­li¡
),

5701 #ifdeà
SIOCGIWSCAN


5702 
£t_hªdËr
(
SIOCSIWSCAN
, 
›“80211_ioùl_siwsÿn
),

5703 
£t_hªdËr
(
SIOCGIWSCAN
, 
›“80211_ioùl_giwsÿn
),

5705 
£t_hªdËr
(
SIOCSIWESSID
, 
›“80211_ioùl_siwessid
),

5706 
£t_hªdËr
(
SIOCGIWESSID
, 
›“80211_ioùl_giwessid
),

5707 
£t_hªdËr
(
SIOCSIWNICKN
, 
›“80211_ioùl_siwnickn
),

5708 
£t_hªdËr
(
SIOCGIWNICKN
, 
›“80211_ioùl_giwnickn
),

5709 
£t_hªdËr
(
SIOCSIWRATE
, 
›“80211_ioùl_siw¿‹
),

5710 
£t_hªdËr
(
SIOCGIWRATE
, 
›“80211_ioùl_giw¿‹
),

5711 
£t_hªdËr
(
SIOCSIWRTS
, 
›“80211_ioùl_siw¹s
),

5712 
£t_hªdËr
(
SIOCGIWRTS
, 
›“80211_ioùl_giw¹s
),

5713 
£t_hªdËr
(
SIOCSIWFRAG
, 
›“80211_ioùl_siwäag
),

5714 
£t_hªdËr
(
SIOCGIWFRAG
, 
›“80211_ioùl_giwäag
),

5715 
£t_hªdËr
(
SIOCSIWTXPOW
, 
›“80211_ioùl_siwtxpow
),

5716 
£t_hªdËr
(
SIOCGIWTXPOW
, 
›“80211_ioùl_giwtxpow
),

5717 
£t_hªdËr
(
SIOCSIWRETRY
, 
›“80211_ioùl_siw»Œy
),

5718 
£t_hªdËr
(
SIOCGIWRETRY
, 
›“80211_ioùl_giw»Œy
),

5719 
£t_hªdËr
(
SIOCSIWENCODE
, 
›“80211_ioùl_siw’code
),

5720 
£t_hªdËr
(
SIOCGIWENCODE
, 
›“80211_ioùl_giw’code
),

5721 
£t_hªdËr
(
SIOCSIWPOWER
, 
›“80211_ioùl_siwpow”
),

5722 
£t_hªdËr
(
SIOCGIWPOWER
, 
›“80211_ioùl_giwpow”
),

5723 #ià
WIRELESS_EXT
 >= 18

5724 
£t_hªdËr
(
SIOCSIWGENIE
, 
›“80211_ioùl_siwg’›
),

5725 
£t_hªdËr
(
SIOCGIWGENIE
, 
›“80211_ioùl_giwg’›
),

5726 
£t_hªdËr
(
SIOCSIWAUTH
, 
›“80211_ioùl_siwauth
),

5727 
£t_hªdËr
(
SIOCGIWAUTH
, 
›“80211_ioùl_giwauth
),

5728 
£t_hªdËr
(
SIOCSIWENCODEEXT
, 
›“80211_ioùl_siw’cod“xt
),

5729 
£t_hªdËr
(
SIOCGIWENCODEEXT
, 
›“80211_ioùl_giw’cod“xt
),

5733 
	#£t_´iv
(
x
,
f
è[x - 
SIOCIWFIRSTPRIV
] = (
iw_hªdËr
è
	)
f

5734 cÚ¡ 
iw_hªdËr
 
	g›“80211_´iv_hªdËrs
[] = {

5735 
£t_´iv
(
IEEE80211_IOCTL_SETPARAM
, 
›“80211_ioùl_£¬am
),

5736 
£t_´iv
(
IEEE80211_IOCTL_GETPARAM
, 
›“80211_ioùl_g‘·¿m
),

5737 
£t_´iv
(
IEEE80211_IOCTL_SETMODE
, 
›“80211_ioùl_£tmode
),

5738 
£t_´iv
(
IEEE80211_IOCTL_GETMODE
, 
›“80211_ioùl_g‘mode
),

5739 
£t_´iv
(
IEEE80211_IOCTL_SETWMMPARAMS
, 
›“80211_ioùl_£twmm·¿ms
),

5740 
£t_´iv
(
IEEE80211_IOCTL_GETWMMPARAMS
, 
›“80211_ioùl_g‘wmm·¿ms
),

5741 
£t_´iv
(
IEEE80211_IOCTL_SETCHANLIST
, 
›“80211_ioùl_£tchªli¡
),

5742 
£t_´iv
(
IEEE80211_IOCTL_GETCHANLIST
, 
›“80211_ioùl_g‘chªli¡
),

5743 
£t_´iv
(
IEEE80211_IOCTL_CHANSWITCH
, 
›“80211_ioùl_chªsw™ch
),

5744 
£t_´iv
(
IEEE80211_IOCTL_RADAR
, 
›“80211_ioùl_¿d¬
),

5745 
£t_´iv
(
IEEE80211_IOCTL_GET_APPIEBUF
, 
›“80211_ioùl_g‘­p›buf
),

5746 
£t_´iv
(
IEEE80211_IOCTL_SET_APPIEBUF
, 
›“80211_ioùl_£µ›buf
),

5747 
£t_´iv
(
IEEE80211_IOCTL_FILTERFRAME
, 
›“80211_ioùl_£tf‹r
),

5748 
£t_´iv
(
IEEE80211_IOCTL_GETCHANINFO
, 
›“80211_ioùl_g‘chªšfo
),

5749 
£t_´iv
(
IEEE80211_IOCTL_SETOPTIE
, 
›“80211_ioùl_£tİt›
),

5750 
£t_´iv
(
IEEE80211_IOCTL_GETOPTIE
, 
›“80211_ioùl_g‘İt›
),

5751 
£t_´iv
(
IEEE80211_IOCTL_SETMLME
, 
›“80211_ioùl_£tmlme
),

5752 
£t_´iv
(
IEEE80211_IOCTL_SETKEY
, 
›“80211_ioùl_£tkey
),

5753 
£t_´iv
(
IEEE80211_IOCTL_DELKEY
, 
›“80211_ioùl_d–key
),

5754 
£t_´iv
(
IEEE80211_IOCTL_HALMAP
, 
›“80211_ioùl_h®_m­
),

5755 
£t_´iv
(
IEEE80211_IOCTL_ADDMAC
, 
›“80211_ioùl_addmac
),

5756 
£t_´iv
(
IEEE80211_IOCTL_DELMAC
, 
›“80211_ioùl_d–mac
),

5757 
£t_´iv
(
IEEE80211_IOCTL_WDSADDMAC
, 
›“80211_ioùl_wdsmac
),

5758 
£t_´iv
(
IEEE80211_IOCTL_WDSDELMAC
, 
›“80211_ioùl_wdsd–mac
),

5759 
£t_´iv
(
IEEE80211_IOCTL_KICKMAC
, 
›“80211_ioùl_kickmac
),

5760 #ifdeà
ATH_REVERSE_ENGINEERING


5761 
£t_´iv
(
IEEE80211_IOCTL_READREG
, 
›“80211_ioùl_»ad»g
),

5762 
£t_´iv
(
IEEE80211_IOCTL_WRITEREG
, 
›“80211_ioùl_wr™”eg
),

5766 
iw_hªdËr_def
 
	g›“80211_iw_hªdËr_def
 = {

5767 .
¡ªd¬d
 = (
iw_hªdËr
 *)
›“80211_hªdËrs
,

5768 .
	gnum_¡ªd¬d
 = 
ARRAY_SIZE
(
›“80211_hªdËrs
),

5769 .
	g´iv©e
 = (
iw_hªdËr
 *)
›“80211_´iv_hªdËrs
,

5770 .
	gnum_´iv©e
 = 
ARRAY_SIZE
(
›“80211_´iv_hªdËrs
),

5771 .
	g´iv©e_¬gs
 = (
iw_´iv_¬gs
 *)
›“80211_´iv_¬gs
,

5772 .
	gnum_´iv©e_¬gs
 = 
ARRAY_SIZE
(
›“80211_´iv_¬gs
),

5773 #ià
IW_HANDLER_VERSION
 >= 7

5774 .
	gg‘_wœ–ess_¡©s
 = 
›“80211_iw_g‘¡©s
,

5782 
	$›“80211_ioùl
(
Ãt_deviû
 *
dev
, 
iäeq
 *
iä
, 
cmd
)

5784 
›“80211v­
 *
v­
 = 
	`Ãtdev_´iv
(
dev
);

5786 
cmd
) {

5787 
SIOCG80211STATS
:

5788  
	`cİy_to_u£r
(
iä
->
iä_d©a
, &
v­
->
iv_¡©s
,

5789  (
v­
->
iv_¡©s
)è? -
EFAULT
 : 0;

5790 
SIOC80211IFDESTROY
:

5791 ià(!
	`ÿ·bË
(
CAP_NET_ADMIN
))

5792  -
EPERM
;

5793 
	`›“80211_¡İ
(
v­
->
iv_dev
);

5794 
v­
->
iv_ic
->
	`ic_v­_d–‘e
(vap);

5796 
IEEE80211_IOCTL_GETKEY
:

5797  
	`›“80211_ioùl_g‘key
(
dev
, (
iw»q
 *)
iä
);

5798 
IEEE80211_IOCTL_GETWPAIE
:

5799  
	`›“80211_ioùl_g‘w·›
(
dev
, (
iw»q
 *)
iä
);

5800 
IEEE80211_IOCTL_STA_STATS
:

5801  
	`›“80211_ioùl_g‘¡a¡©s
(
dev
, (
iw»q
 *)
iä
);

5802 
IEEE80211_IOCTL_STA_INFO
:

5803  
	`›“80211_ioùl_g‘¡ašfo
(
dev
, (
iw»q
 *)
iä
);

5804 
IEEE80211_IOCTL_SCAN_RESULTS
:

5805  
	`›“80211_ioùl_g‘sÿÄesuÉs
(
dev
, (
iw»q
 *)
iä
);

5807  -
EOPNOTSUPP
;

5808 
	}
}

5815 
	$›“80211_ioùl_ü—‹_v­
(
›“80211com
 *
ic
, 
iäeq
 *
iä
, 
Ãt_deviû
 *
mdev
)

5817 
›“80211_şÚe_·¿ms
 
ı
;

5818 
›“80211v­
 *
v­
;

5819 
Çme
[
IFNAMSIZ
];

5821 ià(!
	`ÿ·bË
(
CAP_NET_ADMIN
))

5822  -
EPERM
;

5823 ià(
	`cİy_äom_u£r
(&
ı
, 
iä
->
iä_d©a
, (cp)))

5824  -
EFAULT
;

5826 
	`¡ºıy
(
Çme
, 
ı
.
iı_Çme
, (name));

5828 
v­
 = 
	`›“80211_ü—‹_v­
(
ic
, 
Çme
, 
mdev
, 
ı
.
iı_İmode
, cp.
iı_æags
);

5829 ià(
v­
 =ğ
NULL
)

5830  -
EIO
;

5833 
	`¡ºıy
(
iä
->
iä_Çme
, 
v­
->
iv_dev
->
Çme
, 
IFNAMSIZ
);

5835 
	}
}

5836 
EXPORT_SYMBOL
(
›“80211_ioùl_ü—‹_v­
);

5843 
›“80211v­
 *

5844 
	$›“80211_ü—‹_v­
(
›“80211com
 *
ic
, *
Çme
,

5845 
Ãt_deviû
 *
mdev
, 
İmode
, 
İæags
)

5847  
ic
->
	`ic_v­_ü—‹
(ic, 
Çme
, 
İmode
, 
İæags
, 
mdev
);

5848 
	}
}

5849 
EXPORT_SYMBOL
(
›“80211_ü—‹_v­
);

5853 
	$›“80211_ioùl_v©ch
(
›“80211v­
 *
v­
)

5855 
Ãt_deviû
 *
dev
 = 
v­
->
iv_dev
;

5857 
dev
->
do_ioùl
 = 
›“80211_ioùl
;

5858 #ià
IW_HANDLER_VERSION
 < 7

5859 
dev
->
g‘_wœ–ess_¡©s
 = 
›“80211_iw_g‘¡©s
;

5861 
dev
->
wœ–ess_hªdËrs
 = &
›“80211_iw_hªdËr_def
;

5862 
	}
}

5865 
	$›“80211_ioùl_vd‘ach
(
›“80211v­
 *
v­
)

5867 
	}
}

	@ieee80211_xauth.c

33 #iâdeà
EXPORT_SYMTAB


34 
	#EXPORT_SYMTAB


	)

49 #iâdeà
AUTOCONF_INCLUDED


50 
	~<lšux/cÚfig.h
>

52 
	~<lšux/v”siÚ.h
>

53 
	~<lšux/moduË.h
>

54 
	~<lšux/š™.h
>

55 
	~<lšux/skbuff.h
>

56 
	~<lšux/Ãtdeviû.h
>

57 
	~<lšux/Ãtf‹r.h
>

58 
	~<lšux/sysùl.h
>

59 
	~<lšux/š.h
>

61 
	~"if_medŸ.h
"

62 
	~"if_Îc.h
"

63 
	~"if_‘h”subr.h
"

65 
	~<Ãt80211/›“80211_v¬.h
>

70 
MODULE_AUTHOR
("Errno Consulting, Sam Leffler");

71 
MODULE_DESCRIPTION
("802.11 wireless support:ƒxternal (user mode)‡uthenticator");

72 #ifdeà
MODULE_LICENSE


73 
MODULE_LICENSE
("Dual BSD/GPL");

80 cÚ¡ 
›“80211_auth’tiÿtÜ
 
	gxauth
 = {

81 .
Ÿ_Çme
 = "external",

82 .
	gŸ_©ch
 = 
NULL
,

83 .
	gŸ_d‘ach
 = 
NULL
,

84 .
	gŸ_node_još
 = 
NULL
,

85 .
	gŸ_node_Ëave
 = 
NULL
,

88 
__š™


89 
	$š™_›“80211_xauth
()

91 
	`›“80211_auth’tiÿtÜ_»gi¡”
(
IEEE80211_AUTH_8021X
, &
xauth
);

92 
	`›“80211_auth’tiÿtÜ_»gi¡”
(
IEEE80211_AUTH_WPA
, &
xauth
);

94 
	}
}

95 
moduË_š™
(
š™_›“80211_xauth
);

97 
__ex™


98 
	$ex™_›“80211_xauth
()

100 
	`›“80211_auth’tiÿtÜ_uÄegi¡”
(
IEEE80211_AUTH_8021X
);

101 
	`›“80211_auth’tiÿtÜ_uÄegi¡”
(
IEEE80211_AUTH_WPA
);

102 
	}
}

103 
moduË_ex™
(
ex™_›“80211_xauth
);

	@if_athproto.h

7 #iâdeà
_NET_IF_ATH_PROTO_H_


8 
	#_NET_IF_ATH_PROTO_H_


	)

18 
	#ATH_DEFAULT_NOISE
 -95

	)

24 
	#ATH_ETH_TYPE
 0x88bd

	)

25 
	#ATH_SNAP_ORGCODE_0
 0x00

	)

26 
	#ATH_SNAP_ORGCODE_1
 0x03

	)

27 
	#ATH_SNAP_ORGCODE_2
 0x7f

	)

29 
	s©hl2p_tuÂ–_hdr
 {

30 #ià(
_BYTE_ORDER
 =ğ
_LITTLE_ENDIAN
)

31 
u_št32_t
 
	moff£t
:11,

32 
	m£qNum
:11,

33 
	mİtHdrL’32
:2,

34 
	mäameTy³
:2,

35 
	m´Ùo
:6;

37 
u_št32_t
 
	m´Ùo
:6,

38 
	mäameTy³
:2,

39 
	mİtHdrL’32
:2,

40 
	m£qNum
:11,

41 
	moff£t
:11;

43 } 
	g__·cked
;

53 
	#ATH_L2TUNNEL_PROTO_FF
 0

	)

59 
	#ATH_FF_MAX_HDR_PAD
 4

	)

60 
	#ATH_FF_MAX_SEP_PAD
 6

	)

61 
	#ATH_FF_MAX_HDR
 30

	)

62 
	#ATH_FF_MAX_PAYLOAD
 3066

	)

63 
	#ATH_FF_MAX_LEN
 (
ATH_FF_MAX_PAYLOAD
 + 
IEEE80211_CRC_LEN
 + \

64 (
IEEE80211_WEP_IVLEN
 + 
IEEE80211_WEP_KIDLEN
 + 
IEEE80211_WEP_CRCLEN
))

	)

70 
	#ATH_FF_MAGIC_PUT
(
_skb
) \

71 (
	`SKB_CB
(
_skb
)->
æags
 |ğ
M_FF
)

	)

72 
	#ATH_FF_MAGIC_CLR
(
_skb
) \

73 (
	`SKB_CB
(
_skb
)->
æags
 &ğ~
M_FF
)

	)

74 
	#ATH_FF_MAGIC_PRESENT
(
_skb
) \

75 ((
	`SKB_CB
(
_skb
)->
æags
 & 
M_FF
è!ğ0)

	)

82 
	#ATH_FF_TXQMIN
 3

	)

90 
	#ATH_FF_STAGEQAGEMAX
 5

	)

96 
	#USE_HEADERLEN_RESV
 1

	)

	@if_ethersubr.h

39 #iâdeà
_NET_IF_ETHERSUBR_H_


40 
	#_NET_IF_ETHERSUBR_H_


	)

42 
	#ETHER_ADDR_LEN
 6

	)

43 
	#ETHER_TYPE_LEN
 2

	)

44 
	#ETHER_CRC_LEN
 4

	)

45 
	#ETHER_HDR_LEN
 (
ETHER_ADDR_LEN
 * 2 + 
ETHER_TYPE_LEN
)

	)

46 
	#ETHER_MAX_LEN
 1518

	)

48 
	#ETHERMTU
 (
ETHER_MAX_LEN
 - 
ETHER_HDR_LEN
 - 
ETHER_CRC_LEN
)

	)

53 
	s‘h”_h—d”
 {

54 
u_ch¬
 
	m‘h”_dho¡
[
ETHER_ADDR_LEN
];

55 
u_ch¬
 
	m‘h”_sho¡
[
ETHER_ADDR_LEN
];

56 
__be16
 
	m‘h”_ty³
;

57 } 
	g__·cked
;

59 #iâdeà
ETHERTYPE_PAE


60 
	#ETHERTYPE_PAE
 0x888

	)

62 #iâdeà
ETHERTYPE_IP


63 
	#ETHERTYPE_IP
 0x0800

	)

69 
	s‘h”_addr
 {

70 
u_ch¬
 
	moù‘
[
ETHER_ADDR_LEN
];

71 } 
	g__·cked
;

73 
	#ETHER_IS_MULTICAST
(
addr
è(*×ddrè& 0x01è

	)

75 
	#VLAN_PRI_SHIFT
 13

	)

76 
	#VLAN_PRI_MASK
 7

	)

	@if_llc.h

72 #iâdeà
_NET_IF_LLC_H_


73 
	#_NET_IF_LLC_H_


	)

83 
	sÎc
 {

84 
u_št8_t
 
	mÎc_d§p
;

85 
u_št8_t
 
	mÎc_s§p
;

88 
u_št8_t
 
	mcÚŒŞ
;

89 
u_št8_t
 
	mfÜm©_id
;

90 
u_št8_t
 
	mşass
;

91 
u_št8_t
 
	mwšdow_x2
;

92 } 
__·cked
 
	mty³_u
;

94 
u_št8_t
 
	mnum_¢d_x2
;

95 
u_št8_t
 
	mnum_rcv_x2
;

96 } 
__·cked
 
	mty³_i
;

98 
u_št8_t
 
	mcÚŒŞ
;

99 
u_št8_t
 
	mnum_rcv_x2
;

100 } 
__·cked
 
	mty³_s
;

102 
u_št8_t
 
	mcÚŒŞ
;

107 
u_št8_t
 
	mämr_»j_pdu0
;

108 
u_št8_t
 
	mämr_»j_pdu1
;

109 
u_št8_t
 
	mämr_cÚŒŞ
;

110 
u_št8_t
 
	mämr_cÚŒŞ_ext
;

111 
u_št8_t
 
	mämr_ÿu£
;

112 } 
__·cked
 
	mty³_ämr
;

114 
u_št8_t
 
	mcÚŒŞ
;

115 
u_št8_t
 
	mÜg_code
[3];

116 
__be16
 
	m‘h”_ty³
;

117 } 
__·cked
 
	mty³_¢­
;

119 
u_št8_t
 
	mcÚŒŞ
;

120 
u_št8_t
 
	mcÚŒŞ_ext
;

121 } 
__·cked
 
	mty³_¿w
;

122 } 
	mÎc_un
 ;

123 } 
	g__·cked
;

125 
	sämršfo
 {

126 
u_št8_t
 
	mämr_»j_pdu0
;

127 
u_št8_t
 
	mämr_»j_pdu1
;

128 
u_št8_t
 
	mämr_cÚŒŞ
;

129 
u_št8_t
 
	mämr_cÚŒŞ_ext
;

130 
u_št8_t
 
	mämr_ÿu£
;

131 } 
	g__·cked
;

133 
	#Îc_cÚŒŞ
 
Îc_un
.
ty³_u
.
cÚŒŞ


	)

134 
	#Îc_cÚŒŞ_ext
 
Îc_un
.
ty³_¿w
.
cÚŒŞ_ext


	)

135 
	#Îc_fid
 
Îc_un
.
ty³_u
.
fÜm©_id


	)

136 
	#Îc_şass
 
Îc_un
.
ty³_u
.
şass


	)

137 
	#Îc_wšdow
 
Îc_un
.
ty³_u
.
wšdow_x2


	)

138 
	#Îc_ämršfo
 
Îc_un
.
ty³_ämr
.
ämr_»j_pdu0


	)

139 
	#Îc_ämr_pdu0
 
Îc_un
.
ty³_ämr
.
ämr_»j_pdu0


	)

140 
	#Îc_ämr_pdu1
 
Îc_un
.
ty³_ämr
.
ämr_»j_pdu1


	)

141 
	#Îc_ämr_cÚŒŞ
 
Îc_un
.
ty³_ämr
.
ämr_cÚŒŞ


	)

142 
	#Îc_ämr_cÚŒŞ_ext
 
Îc_un
.
ty³_ämr
.
ämr_cÚŒŞ_ext


	)

143 
	#Îc_ämr_ÿu£
 
Îc_un
.
ty³_ämr
.
ämr_ÿu£


	)

144 
	#Îc_¢­
 
Îc_un
.
ty³_¢­


	)

149 
	#LLC_ISFRAMELEN
 4

	)

150 
	#LLC_UFRAMELEN
 3

	)

151 
	#LLC_FRMRLEN
 7

	)

152 
	#LLC_SNAPFRAMELEN
 8

	)

157 
	#LLC_UI
 0x3

	)

158 
	#LLC_UI_P
 0x13

	)

159 
	#LLC_DISC
 0x43

	)

160 
	#LLC_DISC_P
 0x53

	)

161 
	#LLC_UA
 0x63

	)

162 
	#LLC_UA_P
 0x73

	)

163 
	#LLC_TEST
 0xe3

	)

164 
	#LLC_TEST_P
 0xf3

	)

165 
	#LLC_FRMR
 0x87

	)

166 
	#LLC_FRMR_P
 0x97

	)

167 
	#LLC_DM
 0x0f

	)

168 
	#LLC_DM_P
 0x1f

	)

169 
	#LLC_XID
 0xaf

	)

170 
	#LLC_XID_P
 0xbf

	)

171 
	#LLC_SABME
 0x6f

	)

172 
	#LLC_SABME_P
 0x7f

	)

177 
	#LLC_RR
 0x01

	)

178 
	#LLC_RNR
 0x05

	)

179 
	#LLC_REJ
 0x09

	)

184 
	#LLC_INFO
 0x00

	)

189 
	#LLC_X25_LSAP
 0x7e

	)

190 
	#LLC_SNAP_LSAP
 0x¯

	)

191 
	#LLC_ISO_LSAP
 0xã

	)

	@if_media.c

48 #iâdeà
EXPORT_SYMTAB


49 
	#EXPORT_SYMTAB


	)

52 #iâdeà
AUTOCONF_INCLUDED


53 
	~<lšux/cÚfig.h
>

55 
	~<lšux/v”siÚ.h
>

56 
	~<lšux/moduË.h
>

57 
	~<lšux/k”Ãl.h
>

58 
	~<lšux/¦ab.h
>

59 
	~<lšux/if.h
>

60 
	~<lšux/Ãtdeviû.h
>

61 #iâdeà
iä_medŸ


62 
	#iä_medŸ
 
iä_iäu
.
iäu_iv®ue


	)

65 
	~<asm/uacûss.h
>

67 
	~"if_medŸ.h
"

76 
ifmedŸ_’Œy
 *
ifmedŸ_m©ch
(
ifmedŸ
 *, , );

80 #ifdeà
IFMEDIA_DEBUG


81 
	gifmedŸ_debug
 = 1;

82 
ifmedŸ_´štwÜd
();

89 
	$ifmedŸ_š™
(
ifmedŸ
 *
ifm
, 
dÚtÿ»_mask
,

90 
ifm_chªge_cb_t
 
chªge_ÿÎback
, 
ifm_¡©_cb_t
 
¡©us_ÿÎback
)

92 
	`LIST_INIT
(&
ifm
->
ifm_li¡
);

93 
ifm
->
ifm_cur
 = 
NULL
;

94 
ifm
->
ifm_medŸ
 = 0;

95 
ifm
->
ifm_mask
 = 
dÚtÿ»_mask
;

96 
ifm
->
ifm_chªge
 = 
chªge_ÿÎback
;

97 
ifm
->
ifm_¡©us
 = 
¡©us_ÿÎback
;

98 
	}
}

101 
	$ifmedŸ_»mov—Î
(
ifmedŸ
 *
ifm
)

103 
ifmedŸ_’Œy
 *
’Œy
;

105 
’Œy
 = 
	`LIST_FIRST
(&
ifm
->
ifm_li¡
);ƒntry;

106 
’Œy
 = 
	`LIST_FIRST
(&
ifm
->
ifm_li¡
)) {

107 
	`LIST_REMOVE
(
’Œy
, 
ifm_li¡
);

108 
	`kä“
(
’Œy
);

110 
	}
}

117 
	$ifmedŸ_add
(
ifmedŸ
 *
ifm
, 
mwÜd
, 
d©a
, *
aux
)

119 
ifmedŸ_’Œy
 *
’Œy
;

121 #ifdeà
IFMEDIA_DEBUG


122 ià(
ifmedŸ_debug
) {

123 ià(
ifm
 =ğ
NULL
) {

124 
	`´štk
(
KERN_ERR
 "ifmedia_add:‚ull ifm\n");

127 
	`´štk
(
KERN_INFO
 "Addingƒntry for ");

128 
	`ifmedŸ_´štwÜd
(
mwÜd
);

132 
’Œy
 = 
	`km®loc
((*’Œy), 
GFP_KERNEL
);

133 ià(
’Œy
 =ğ
NULL
)

134 
	`·nic
("ifmedia_add: can't mallocƒntry");

136 
’Œy
->
ifm_medŸ
 = 
mwÜd
;

137 
’Œy
->
ifm_d©a
 = 
d©a
;

138 
’Œy
->
ifm_aux
 = 
aux
;

140 
	`LIST_INSERT_HEAD
(&
ifm
->
ifm_li¡
, 
’Œy
, ifm_list);

141 
	}
}

148 
	$ifmedŸ_li¡_add
(
ifmedŸ
 *
ifm
, 
ifmedŸ_’Œy
 *
Í
, 
couÁ
)

150 
i
;

152 
i
 = 0; i < 
couÁ
; i++)

153 
	`ifmedŸ_add
(
ifm
, 
Í
[
i
].
ifm_medŸ
,†p[i].
ifm_d©a
,†p[i].
ifm_aux
);

154 
	}
}

164 
	$ifmedŸ_£t
(
ifmedŸ
 *
ifm
, 
rg‘
)

166 
ifmedŸ_’Œy
 *
m©ch
;

168 
m©ch
 = 
	`ifmedŸ_m©ch
(
ifm
, 
rg‘
, ifm->
ifm_mask
);

170 ià(
m©ch
 =ğ
NULL
) {

171 
	`´štk
(
KERN_ERR
 "ifmedia_set:‚o match for 0x%x/0x%x\n",

172 
rg‘
, ~
ifm
->
ifm_mask
);

173 
	`·nic
("ifmedia_set");

175 
ifm
->
ifm_cur
 = 
m©ch
;

177 #ifdeà
IFMEDIA_DEBUG


178 ià(
ifmedŸ_debug
) {

179 
	`´štk
(
KERN_INFO
 "ifmedia_set:arget ");

180 
	`ifmedŸ_´štwÜd
(
rg‘
);

181 
	`´štk
(
KERN_INFO
 "ifmedia_set: settingo ");

182 
	`ifmedŸ_´štwÜd
(
ifm
->
ifm_cur
->
ifm_medŸ
);

185 
	}
}

191 
	$ifmedŸ_ioùl
(
Ãt_deviû
 *
dev
, 
iäeq
 *
iä
,

192 
ifmedŸ
 *
ifm
, 
u_lÚg
 
cmd
)

194 
ifmedŸ_’Œy
 *
m©ch
;

195 
ifmedŸ»q
 *
ifmr
 = (ifmedŸ»q *)
iä
;

196 
”rÜ
 = 0, 
¡icky
;

198 ià(
dev
 =ğ
NULL
 || 
iä
 =ğNULL || 
ifm
 == NULL)

199  -
EINVAL
;

201 
cmd
) {

205 
SIOCSIFMEDIA
:

207 
ifmedŸ_’Œy
 *
Şd’Œy
;

208 
ŞdmedŸ
;

209 
ÃwmedŸ
 = 
iä
->
iä_medŸ
;

211 
m©ch
 = 
	`ifmedŸ_m©ch
(
ifm
, 
ÃwmedŸ
, ifm->
ifm_mask
);

212 ià(
m©ch
 =ğ
NULL
) {

213 #ifdeà
IFMEDIA_DEBUG


214 ià(
ifmedŸ_debug
) {

215 
	`´štk
("ifmedia_ioctl:‚o media found for 0x%x\n",

216 
ÃwmedŸ
);

219  -
ENXIO
;

228 ià((
	`IFM_SUBTYPE
(
ÃwmedŸ
è!ğ
IFM_AUTO
) &&

229 (
ÃwmedŸ
 =ğ
ifm
->
ifm_medŸ
) &&

230 (
m©ch
 =ğ
ifm
->
ifm_cur
))

238 #ifdeà
IFMEDIA_DEBUG


239 ià(
ifmedŸ_debug
) {

240 
	`´štk
("ifmedŸ_ioùl: sw™chšg % tØ", 
dev
->
Çme
);

241 
	`ifmedŸ_´štwÜd
(
m©ch
->
ifm_medŸ
);

244 
Şd’Œy
 = 
ifm
->
ifm_cur
;

245 
ŞdmedŸ
 = 
ifm
->
ifm_medŸ
;

246 
ifm
->
ifm_cur
 = 
m©ch
;

247 
ifm
->
ifm_medŸ
 = 
ÃwmedŸ
;

248 
”rÜ
 = (*
ifm
->
ifm_chªge
)(
dev
);

249 ià((
”rÜ
 < 0è&& (”rÜ !ğ-
ENETRESET
)) {

250 
ifm
->
ifm_cur
 = 
Şd’Œy
;

251 
ifm
->
ifm_medŸ
 = 
ŞdmedŸ
;

259 
SIOCGIFMEDIA
:

261 
ifmedŸ_’Œy
 *
•
;

262 *
k±r
, 
couÁ
;

263 
u£rmax
;

265 
k±r
 = 
NULL
;

267 
ifmr
->
ifm_aùive
 = ifmr->
ifm_cu¼’t
 = 
ifm
->
ifm_cur
 ?

268 
ifm
->
ifm_cur
->
ifm_medŸ
 : 
IFM_NONE
;

269 
ifmr
->
ifm_mask
 = 
ifm
->ifm_mask;

270 
ifmr
->
ifm_¡©us
 = 0;

271 (*
ifm
->
ifm_¡©us
)(
dev
, 
ifmr
);

273 
couÁ
 = 0;

274 
u£rmax
 = 0;

282 
	`LIST_FOREACH
(
•
, &
ifm
->
ifm_li¡
, ifm_list)

283 
u£rmax
++;

289 ià(
ifmr
->
ifm_couÁ
 > 
u£rmax
)

290 
ifmr
->
ifm_couÁ
 = 
u£rmax
;

291 ià(
ifmr
->
ifm_couÁ
 < 0)

292  (-
EINVAL
);

294 ià(
ifmr
->
ifm_couÁ
 != 0) {

295 
k±r
 = (*)
	`km®loc
(
ifmr
->
ifm_couÁ
 * (),

296 
GFP_KERNEL
);

298 ià(
k±r
 =ğ
NULL
)

299  (-
ENOMEM
);

303 
•
 = 
	`LIST_FIRST
(&
ifm
->
ifm_li¡
);

304 ; 
•
 !ğ
NULL
 && 
couÁ
 < 
ifmr
->
ifm_couÁ
;

305 
•
 = 
	`LIST_NEXT
Óp, 
ifm_li¡
), 
couÁ
++)

306 
k±r
[
couÁ
] = 
•
->
ifm_medŸ
;

308 ià(
•
 !ğ
NULL
)

309 
”rÜ
 = -
E2BIG
;

311 
couÁ
 = 
u£rmax
;

319 
¡icky
 = 
”rÜ
;

320 ià((
”rÜ
 =ğ0 ||ƒ¼Ü =ğ-
E2BIG
è&& 
ifmr
->
ifm_couÁ
 != 0) {

321 
”rÜ
 = 
	`cİy_to_u£r
(
ifmr
->
ifm_uli¡
,

322 
k±r
, 
ifmr
->
ifm_couÁ
 * ());

325 ià(
”rÜ
 == 0)

326 
”rÜ
 = 
¡icky
;

328 ià(
ifmr
->
ifm_couÁ
 != 0)

329 
	`kä“
(
k±r
);

331 
ifmr
->
ifm_couÁ
 = 
couÁ
;

336  -
EINVAL
;

339  
”rÜ
;

340 
	}
}

346 
ifmedŸ_’Œy
 *

347 
	$ifmedŸ_m©ch
(
ifmedŸ
 *
ifm
, 
rg‘
, 
mask
)

349 
ifmedŸ_’Œy
 *
m©ch
, *
Ãxt
;

351 
m©ch
 = 
NULL
;

352 
mask
 = ~mask;

354 
	`LIST_FOREACH
(
Ãxt
, &
ifm
->
ifm_li¡
, ifm_list) {

355 ià((
Ãxt
->
ifm_medŸ
 & 
mask
è=ğ(
rg‘
 & mask)) {

356 #ià
	`defšed
(
IFMEDIA_DEBUG
è|| defšed(
DIAGNOSTIC
)

357 ià(
m©ch
)

358 
	`´štk
("ifmedia_match: multiple match for "

359 "0x%x/0x%x\n", 
rg‘
, 
mask
);

361 
m©ch
 = 
Ãxt
;

365  
m©ch
;

366 
	}
}

368 #ifdeà
IFMEDIA_DEBUG


369 
ifmedŸ_desütiÚ
 
	gifm_ty³_desütiÚs
[] =

370 
IFM_TYPE_DESCRIPTIONS
;

372 
ifmedŸ_desütiÚ
 
	gifm_subty³_‘h”Ãt_desütiÚs
[] =

373 
IFM_SUBTYPE_ETHERNET_DESCRIPTIONS
;

375 
ifmedŸ_desütiÚ
 
	gifm_subty³_‘h”Ãt_İtiÚ_desütiÚs
[] =

376 
IFM_SUBTYPE_ETHERNET_OPTION_DESCRIPTIONS
;

378 
ifmedŸ_desütiÚ
 
	gifm_subty³_tok’ršg_desütiÚs
[] =

379 
IFM_SUBTYPE_TOKENRING_DESCRIPTIONS
;

381 
ifmedŸ_desütiÚ
 
	gifm_subty³_tok’ršg_İtiÚ_desütiÚs
[] =

382 
IFM_SUBTYPE_TOKENRING_OPTION_DESCRIPTIONS
;

384 
ifmedŸ_desütiÚ
 
	gifm_subty³_fddi_desütiÚs
[] =

385 
IFM_SUBTYPE_FDDI_DESCRIPTIONS
;

387 
ifmedŸ_desütiÚ
 
	gifm_subty³_fddi_İtiÚ_desütiÚs
[] =

388 
IFM_SUBTYPE_FDDI_OPTION_DESCRIPTIONS
;

390 
ifmedŸ_desütiÚ
 
	gifm_subty³_›“80211_desütiÚs
[] =

391 
IFM_SUBTYPE_IEEE80211_DESCRIPTIONS
;

393 
ifmedŸ_desütiÚ
 
	gifm_subty³_›“80211_İtiÚ_desütiÚs
[] =

394 
IFM_SUBTYPE_IEEE80211_OPTION_DESCRIPTIONS
;

396 
ifmedŸ_desütiÚ
 
	gifm_subty³_›“80211_mode_desütiÚs
[] =

397 
IFM_SUBTYPE_IEEE80211_MODE_DESCRIPTIONS
;

399 
ifmedŸ_desütiÚ
 
	gifm_subty³_sh¬ed_desütiÚs
[] =

400 
IFM_SUBTYPE_SHARED_DESCRIPTIONS
;

402 
ifmedŸ_desütiÚ
 
	gifm_sh¬ed_İtiÚ_desütiÚs
[] =

403 
IFM_SHARED_OPTION_DESCRIPTIONS
;

405 
	sifmedŸ_ty³_to_subty³
 {

406 
ifmedŸ_desütiÚ
 *
	msubty³s
;

407 
ifmedŸ_desütiÚ
 *
	mİtiÚs
;

408 
ifmedŸ_desütiÚ
 *
	mmodes
;

412 
ifmedŸ_ty³_to_subty³
 
	gifmedŸ_ty³s_to_subty³s
[] = {

413 { &
ifm_subty³_‘h”Ãt_desütiÚs
[0],

414 &
ifm_subty³_‘h”Ãt_İtiÚ_desütiÚs
[0],

415 
NULL
, },

416 { &
ifm_subty³_tok’ršg_desütiÚs
[0],

417 &
ifm_subty³_tok’ršg_İtiÚ_desütiÚs
[0],

418 
NULL
, },

419 { &
ifm_subty³_fddi_desütiÚs
[0],

420 &
ifm_subty³_fddi_İtiÚ_desütiÚs
[0],

421 
NULL
, },

422 { &
ifm_subty³_›“80211_desütiÚs
[0],

423 &
ifm_subty³_›“80211_İtiÚ_desütiÚs
[0],

424 &
ifm_subty³_›“80211_mode_desütiÚs
[0] },

431 
	$ifmedŸ_´štwÜd
(
ifmw
)

433 
ifmedŸ_desütiÚ
 *
desc
;

434 
ifmedŸ_ty³_to_subty³
 *
‰os
;

435 
£’_İtiÚ
 = 0;

438 
desc
 = 
ifm_ty³_desütiÚs
, 
‰os
 = 
ifmedŸ_ty³s_to_subty³s
;

439 
desc
->
ifmt_¡ršg
 !ğ
NULL
; desc++, 
‰os
++)

440 ià(
	`IFM_TYPE
(
ifmw
è=ğ
desc
->
ifmt_wÜd
)

442 ià(
desc
->
ifmt_¡ršg
 =ğ
NULL
) {

443 
	`´štk
("<unknownype>\n");

446 
	`´štk
(
desc
->
ifmt_¡ršg
);

449 
desc
 = 
‰os
->
modes
; desø&& desc->
ifmt_¡ršg
 !ğ
NULL
; desc++)

450 ià(
	`IFM_MODE
(
ifmw
è=ğ
desc
->
ifmt_wÜd
) {

451 ià(
desc
->
ifmt_¡ršg
 !ğ
NULL
)

452 
	`´štk
(" mod%s", 
desc
->
ifmt_¡ršg
);

460 
desc
 = 
ifm_subty³_sh¬ed_desütiÚs
;

461 
desc
->
ifmt_¡ršg
 !ğ
NULL
; desc++)

462 ià(
	`IFM_SUBTYPE
(
ifmw
è=ğ
desc
->
ifmt_wÜd
)

463 
gÙ_subty³
;

465 
desc
 = 
‰os
->
subty³s
; desc->
ifmt_¡ršg
 !ğ
NULL
; desc++)

466 ià(
	`IFM_SUBTYPE
(
ifmw
è=ğ
desc
->
ifmt_wÜd
)

468 ià(
desc
->
ifmt_¡ršg
 =ğ
NULL
) {

469 
	`´štk
(" <unknown subtype>\n");

473 
gÙ_subty³
:

474 
	`´štk
(" %s", 
desc
->
ifmt_¡ršg
);

479 
desc
 = 
ifm_sh¬ed_İtiÚ_desütiÚs
;

480 
desc
->
ifmt_¡ršg
 !ğ
NULL
; desc++) {

481 ià(
ifmw
 & 
desc
->
ifmt_wÜd
) {

482 ià(
£’_İtiÚ
 == 0)

483 
	`´štk
(" <");

484 
	`´štk
("%s%s", 
£’_İtiÚ
++ ? "," : "",

485 
desc
->
ifmt_¡ršg
);

492 
desc
 = 
‰os
->
İtiÚs
; desc->
ifmt_¡ršg
 !ğ
NULL
; desc++) {

493 ià(
ifmw
 & 
desc
->
ifmt_wÜd
) {

494 ià(
£’_İtiÚ
 == 0)

495 
	`´štk
(" <");

496 
	`´štk
("%s%s", 
£’_İtiÚ
++ ? "," : "",

497 
desc
->
ifmt_¡ršg
);

500 
	`´štk
("%s\n", 
£’_İtiÚ
 ? ">" : "");

501 
	}
}

504 
EXPORT_SYMBOL
(
ifmedŸ_ioùl
);

	@if_media.h

41 #iâdeà
_NET_IF_MEDIA_H_


42 
	#_NET_IF_MEDIA_H_


	)

44 
	~<Ãt80211/›“80211_lšux.h
>

58 
	sifmedŸ»q
 {

59 
	mifm_Çme
[
IFNAMSIZ
];

60 
	mifm_cu¼’t
;

61 
	mifm_mask
;

62 
	mifm_¡©us
;

63 
	mifm_aùive
;

64 
	mifm_couÁ
;

65 
__u£r
 *
	mifm_uli¡
;

67 
	#SIOCSIFMEDIA
 
	`_IOWR
('i', 55, 
iäeq
è

	)

68 
	#SIOCGIFMEDIA
 
	`_IOWR
('i', 56, 
ifmedŸ»q
è

	)

70 #ifdeà
__KERNEL__


72 
	~<sys/queue.h
>

77 
	gÃt_deviû
;

78 (*
	tifm_chªge_cb_t
)(
	tÃt_deviû
 *);

79 (*
	tifm_¡©_cb_t
)(
	tÃt_deviû
 *, 
	tifmedŸ»q
 *);

84 
	sifmedŸ_’Œy
 {

85 
	`LIST_ENTRY
(
ifmedŸ_’Œy
è
ifm_li¡
;

86 
ifm_medŸ
;

87 
ifm_d©a
;

88 *
ifm_aux
;

95 
	sifmedŸ
 {

96 
ifm_mask
;

97 
ifm_medŸ
;

98 
ifmedŸ_’Œy
 *
ifm_cur
;

99 
	`ATH_LIST_HEAD
(, 
ifmedŸ_’Œy
è
ifm_li¡
;

100 
ifm_chªge_cb_t
 
ifm_chªge
;

101 
ifm_¡©_cb_t
 
ifm_¡©us
;

105 
	`ifmedŸ_š™
(
ifmedŸ
 *, , 
ifm_chªge_cb_t
, 
ifm_¡©_cb_t
);

108 
	`ifmedŸ_»mov—Î
(
ifmedŸ
 *);

111 
	`ifmedŸ_add
(
ifmedŸ
 *, , , *);

114 
	`ifmedŸ_li¡_add
(
ifmedŸ
 *, 
ifmedŸ_’Œy
 *, );

117 
	`ifmedŸ_£t
(
ifmedŸ
 *, );

120 
	`ifmedŸ_ioùl
(
Ãt_deviû
 *, 
iäeq
 *, 
ifmedŸ
 *, 
u_lÚg
);

140 
	#IFM_ETHER
 0x00000020

	)

141 
	#IFM_10_T
 3

	)

142 
	#IFM_10_2
 4

	)

143 
	#IFM_10_5
 5

	)

144 
	#IFM_100_TX
 6

	)

145 
	#IFM_100_FX
 7

	)

146 
	#IFM_100_T4
 8

	)

147 
	#IFM_100_VG
 9

	)

148 
	#IFM_100_T2
 10

	)

149 
	#IFM_1000_SX
 11

	)

150 
	#IFM_10_STP
 12

	)

151 
	#IFM_10_FL
 13

	)

152 
	#IFM_1000_LX
 14

	)

153 
	#IFM_1000_CX
 15

	)

154 
	#IFM_1000_T
 16

	)

155 
	#IFM_HPNA_1
 17

	)

158 
	#IFM_ETH_MASTER
 0x00000100

	)

163 
	#IFM_TOKEN
 0x00000040

	)

164 
	#IFM_TOK_STP4
 3

	)

165 
	#IFM_TOK_STP16
 4

	)

166 
	#IFM_TOK_UTP4
 5

	)

167 
	#IFM_TOK_UTP16
 6

	)

168 
	#IFM_TOK_STP100
 7

	)

169 
	#IFM_TOK_UTP100
 8

	)

170 
	#IFM_TOK_ETR
 0x00000200

	)

171 
	#IFM_TOK_SRCRT
 0x00000400

	)

172 
	#IFM_TOK_ALLR
 0x00000800

	)

173 
	#IFM_TOK_DTR
 0x00002000

	)

174 
	#IFM_TOK_CLASSIC
 0x00004000

	)

175 
	#IFM_TOK_AUTO
 0x00008000

	)

180 
	#IFM_FDDI
 0x00000060

	)

181 
	#IFM_FDDI_SMF
 3

	)

182 
	#IFM_FDDI_MMF
 4

	)

183 
	#IFM_FDDI_UTP
 5

	)

184 
	#IFM_FDDI_DA
 0x00000100

	)

189 
	#IFM_IEEE80211
 0x00000080

	)

191 
	#IFM_IEEE80211_FH1
 3

	)

192 
	#IFM_IEEE80211_FH2
 4

	)

193 
	#IFM_IEEE80211_DS1
 5

	)

194 
	#IFM_IEEE80211_DS2
 6

	)

195 
	#IFM_IEEE80211_DS5
 7

	)

196 
	#IFM_IEEE80211_DS11
 8

	)

197 
	#IFM_IEEE80211_DS22
 9

	)

198 
	#IFM_IEEE80211_OFDM1_50
 10

	)

199 
	#IFM_IEEE80211_OFDM2_25
 11

	)

200 
	#IFM_IEEE80211_OFDM3
 12

	)

201 
	#IFM_IEEE80211_OFDM4_50
 13

	)

202 
	#IFM_IEEE80211_OFDM6
 14

	)

203 
	#IFM_IEEE80211_OFDM9
 15

	)

204 
	#IFM_IEEE80211_OFDM12
 16

	)

205 
	#IFM_IEEE80211_OFDM13_5
 17

	)

206 
	#IFM_IEEE80211_OFDM18
 18

	)

207 
	#IFM_IEEE80211_OFDM24
 19

	)

208 
	#IFM_IEEE80211_OFDM27
 20

	)

209 
	#IFM_IEEE80211_OFDM36
 21

	)

210 
	#IFM_IEEE80211_OFDM48
 22

	)

211 
	#IFM_IEEE80211_OFDM54
 23

	)

212 
	#IFM_IEEE80211_OFDM72
 24

	)

214 
	#IFM_IEEE80211_ADHOC
 0x00000100

	)

215 
	#IFM_IEEE80211_HOSTAP
 0x00000200

	)

216 
	#IFM_IEEE80211_IBSS
 0x00000400

	)

217 
	#IFM_IEEE80211_WDS
 0x00000800

	)

218 
	#IFM_IEEE80211_TURBO
 0x00001000

	)

219 
	#IFM_IEEE80211_MONITOR
 0x00002000

	)

222 
	#IFM_IEEE80211_11A
 0x00010000

	)

223 
	#IFM_IEEE80211_11B
 0x00020000

	)

224 
	#IFM_IEEE80211_11G
 0x00030000

	)

225 
	#IFM_IEEE80211_FH
 0x00040000

	)

230 
	#IFM_AUTO
 0

	)

231 
	#IFM_MANUAL
 1

	)

232 
	#IFM_NONE
 2

	)

237 
	#IFM_FDX
 0x00100000

	)

238 
	#IFM_HDX
 0x00200000

	)

239 
	#IFM_FLAG0
 0x01000000

	)

240 
	#IFM_FLAG1
 0x02000000

	)

241 
	#IFM_FLAG2
 0x04000000

	)

242 
	#IFM_LOOP
 0x08000000

	)

247 
	#IFM_NMASK
 0x000000e0

	)

248 
	#IFM_TMASK
 0x0000001à

	)

249 
	#IFM_IMASK
 0xf0000000

	)

250 
	#IFM_ISHIFT
 28

	)

251 
	#IFM_OMASK
 0x0000ff00

	)

252 
	#IFM_MMASK
 0x00070000

	)

253 
	#IFM_MSHIFT
 16

	)

254 
	#IFM_GMASK
 0x0ff00000

	)

259 
	#IFM_AVALID
 0x00000001

	)

260 
	#IFM_ACTIVE
 0x00000002

	)

265 
	#IFM_TYPE
(
x
è((xè& 
IFM_NMASK
)

	)

266 
	#IFM_SUBTYPE
(
x
è((xè& 
IFM_TMASK
)

	)

267 
	#IFM_TYPE_OPTIONS
(
x
è((xè& 
IFM_OMASK
)

	)

268 
	#IFM_INST
(
x
è(((xè& 
IFM_IMASK
è>> 
IFM_ISHIFT
)

	)

269 
	#IFM_OPTIONS
(
x
è((xè& (
IFM_OMASK
|
IFM_GMASK
))

	)

270 
	#IFM_MODE
(
x
è((xè& 
IFM_MMASK
)

	)

272 
	#IFM_INST_MAX
 
	`IFM_INST
(
IFM_IMASK
)

	)

277 
	#IFM_MAKEWORD
(
ty³
, 
subty³
, 
İtiÚs
, 
š¡ªû
) \

278 ((
ty³
è| (
subty³
è| (
İtiÚs
è| ((
š¡ªû
è<< 
IFM_ISHIFT
))

	)

279 
	#IFM_MAKEMODE
(
mode
) \

280 (((
mode
è<< 
IFM_MSHIFT
è& 
IFM_MMASK
)

	)

289 
	sifmedŸ_desütiÚ
 {

290 
ifmt_wÜd
;

291 cÚ¡ *
ifmt_¡ršg
;

294 
	#IFM_TYPE_DESCRIPTIONS
 { \

295 { 
IFM_ETHER
, "Ethernet" }, \

296 { 
IFM_TOKEN
, "Token„ing" }, \

297 { 
IFM_FDDI
, "FDDI" }, \

298 { 
IFM_IEEE80211
, "IEEE 802.11 Wireless Ethernet" }, \

299 { 0, 
NULL
 }, \

300 
	}

	)
}

302 
	#IFM_SUBTYPE_ETHERNET_DESCRIPTIONS
 { \

303 { 
IFM_10_T
, "10baseT/UTP" }, \

304 { 
IFM_10_2
, "10base2/BNC" }, \

305 { 
IFM_10_5
, "10base5/AUI" }, \

306 { 
IFM_100_TX
, "100baseTX" }, \

307 { 
IFM_100_FX
, "100baseFX" }, \

308 { 
IFM_100_T4
, "100baseT4" }, \

309 { 
IFM_100_VG
, "100baseVG" }, \

310 { 
IFM_100_T2
, "100baseT2" }, \

311 { 
IFM_10_STP
, "10baseSTP" }, \

312 { 
IFM_10_FL
, "10baseFL" }, \

313 { 
IFM_1000_SX
, "1000baseSX" }, \

314 { 
IFM_1000_LX
, "1000baseLX" }, \

315 { 
IFM_1000_CX
, "1000baseCX" }, \

316 { 
IFM_1000_T
, "1000baseTX" }, \

317 { 
IFM_1000_T
, "1000baseT" }, \

318 { 
IFM_HPNA_1
, "homePNA" }, \

319 { 0, 
NULL
 }, \

320 }

	)

322 
	#IFM_SUBTYPE_ETHERNET_ALIASES
 { \

323 { 
IFM_10_T
, "UTP" }, \

324 { 
IFM_10_T
, "10UTP" }, \

325 { 
IFM_10_2
, "BNC" }, \

326 { 
IFM_10_2
, "10BNC" }, \

327 { 
IFM_10_5
, "AUI" }, \

328 { 
IFM_10_5
, "10AUI" }, \

329 { 
IFM_100_TX
, "100TX" }, \

330 { 
IFM_100_T4
, "100T4" }, \

331 { 
IFM_100_VG
, "100VG" }, \

332 { 
IFM_100_T2
, "100T2" }, \

333 { 
IFM_10_STP
, "10STP" }, \

334 { 
IFM_10_FL
, "10FL" }, \

335 { 
IFM_1000_SX
, "1000SX" }, \

336 { 
IFM_1000_LX
, "1000LX" }, \

337 { 
IFM_1000_CX
, "1000CX" }, \

338 { 
IFM_1000_T
, "1000TX" }, \

339 { 
IFM_1000_T
, "1000T" }, \

340 { 0, 
NULL
 }, \

341 }

	)

343 
	#IFM_SUBTYPE_ETHERNET_OPTION_DESCRIPTIONS
 { \

344 { 0, 
NULL
 }, \

345 }

	)

347 
	#IFM_SUBTYPE_TOKENRING_DESCRIPTIONS
 { \

348 { 
IFM_TOK_STP4
, "DB9/4Mbit" }, \

349 { 
IFM_TOK_STP16
, "DB9/16Mbit" }, \

350 { 
IFM_TOK_UTP4
, "UTP/4Mbit" }, \

351 { 
IFM_TOK_UTP16
, "UTP/16Mbit" }, \

352 { 
IFM_TOK_STP100
, "STP/100Mbit" }, \

353 { 
IFM_TOK_UTP100
, "UTP/100Mbit" }, \

354 { 0, 
NULL
 }, \

355 }

	)

357 
	#IFM_SUBTYPE_TOKENRING_ALIASES
 { \

358 { 
IFM_TOK_STP4
, "4STP" }, \

359 { 
IFM_TOK_STP16
, "16STP" }, \

360 { 
IFM_TOK_UTP4
, "4UTP" }, \

361 { 
IFM_TOK_UTP16
, "16UTP" }, \

362 { 
IFM_TOK_STP100
, "100STP" }, \

363 { 
IFM_TOK_UTP100
, "100UTP" }, \

364 { 0, 
NULL
 }, \

365 }

	)

367 
	#IFM_SUBTYPE_TOKENRING_OPTION_DESCRIPTIONS
 { \

368 { 
IFM_TOK_ETR
, "EarlyTokenRelease" }, \

369 { 
IFM_TOK_SRCRT
, "SourceRouting" }, \

370 { 
IFM_TOK_ALLR
, "AllRoutes" }, \

371 { 
IFM_TOK_DTR
, "Dedicated" }, \

372 { 
IFM_TOK_CLASSIC
, "Classic" }, \

373 { 
IFM_TOK_AUTO
, " " }, \

374 { 0, 
NULL
 }, \

375 }

	)

377 
	#IFM_SUBTYPE_FDDI_DESCRIPTIONS
 { \

378 { 
IFM_FDDI_SMF
, "Single-mode" }, \

379 { 
IFM_FDDI_MMF
, "Multi-mode" }, \

380 { 
IFM_FDDI_UTP
, "UTP" }, \

381 { 0, 
NULL
 }, \

382 }

	)

384 
	#IFM_SUBTYPE_FDDI_ALIASES
 { \

385 { 
IFM_FDDI_SMF
, "SMF" }, \

386 { 
IFM_FDDI_MMF
, "MMF" }, \

387 { 
IFM_FDDI_UTP
, "CDDI" }, \

388 { 0, 
NULL
 }, \

389 }

	)

391 
	#IFM_SUBTYPE_FDDI_OPTION_DESCRIPTIONS
 { \

392 { 
IFM_FDDI_DA
, "Dual-attach" }, \

393 { 0, 
NULL
 }, \

394 }

	)

396 
	#IFM_SUBTYPE_IEEE80211_DESCRIPTIONS
 { \

397 { 
IFM_IEEE80211_FH1
, "FH/1Mbps" }, \

398 { 
IFM_IEEE80211_FH2
, "FH/2Mbps" }, \

399 { 
IFM_IEEE80211_DS1
, "DS/1Mbps" }, \

400 { 
IFM_IEEE80211_DS2
, "DS/2Mbps" }, \

401 { 
IFM_IEEE80211_DS5
, "DS/5.5Mbps" }, \

402 { 
IFM_IEEE80211_DS11
, "DS/11Mbps" }, \

403 { 
IFM_IEEE80211_DS22
, "DS/22Mbps" }, \

404 { 
IFM_IEEE80211_OFDM1_50
, "OFDM/1.50Mbps" }, \

405 { 
IFM_IEEE80211_OFDM2_25
, "OFDM/2.25Mbps" }, \

406 { 
IFM_IEEE80211_OFDM3
, "OFDM/3Mbps" }, \

407 { 
IFM_IEEE80211_OFDM4_50
, "OFDM/4.5Mbps" }, \

408 { 
IFM_IEEE80211_OFDM6
, "OFDM/6Mbps" }, \

409 { 
IFM_IEEE80211_OFDM9
, "OFDM/9Mbps" }, \

410 { 
IFM_IEEE80211_OFDM12
, "OFDM/12Mbps" }, \

411 { 
IFM_IEEE80211_OFDM13_5
, "OFDM/13.5Mbps" }, \

412 { 
IFM_IEEE80211_OFDM18
, "OFDM/18Mbps" }, \

413 { 
IFM_IEEE80211_OFDM24
, "OFDM/24Mbps" }, \

414 { 
IFM_IEEE80211_OFDM27
, "OFDM/27Mbps" }, \

415 { 
IFM_IEEE80211_OFDM36
, "OFDM/36Mbps" }, \

416 { 
IFM_IEEE80211_OFDM48
, "OFDM/48Mbps" }, \

417 { 
IFM_IEEE80211_OFDM54
, "OFDM/54Mbps" }, \

418 { 
IFM_IEEE80211_OFDM72
, "OFDM/72Mbps" }, \

419 { 0, 
NULL
 }, \

420 }

	)

422 
	#IFM_SUBTYPE_IEEE80211_ALIASES
 { \

423 { 
IFM_IEEE80211_FH1
, "FH1" }, \

424 { 
IFM_IEEE80211_FH2
, "FH2" }, \

425 { 
IFM_IEEE80211_FH1
, "FrequencyHopping/1Mbps" }, \

426 { 
IFM_IEEE80211_FH2
, "FrequencyHopping/2Mbps" }, \

427 { 
IFM_IEEE80211_DS1
, "DS1" }, \

428 { 
IFM_IEEE80211_DS2
, "DS2" }, \

429 { 
IFM_IEEE80211_DS5
, "DS5.5" }, \

430 { 
IFM_IEEE80211_DS11
, "DS11" }, \

431 { 
IFM_IEEE80211_DS22
, "DS22" }, \

432 { 
IFM_IEEE80211_DS1
, "DirectSequence/1Mbps" }, \

433 { 
IFM_IEEE80211_DS2
, "DirectSequence/2Mbps" }, \

434 { 
IFM_IEEE80211_DS5
, "DirectSequence/5.5Mbps" }, \

435 { 
IFM_IEEE80211_DS11
, "DirectSequence/11Mbps" }, \

436 { 
IFM_IEEE80211_DS22
, "DirectSequence/22Mbps" }, \

437 { 
IFM_IEEE80211_OFDM1_50
, "OFDM1.50Mpbs" }, \

438 { 
IFM_IEEE80211_OFDM2_25
, "OFDM2.25Mbps" }, \

439 { 
IFM_IEEE80211_OFDM3
, "OFDM3Mbps" }, \

440 { 
IFM_IEEE80211_OFDM4_50
, "OFDM4.5Mbps" }, \

441 { 
IFM_IEEE80211_OFDM6
, "OFDM6" }, \

442 { 
IFM_IEEE80211_OFDM9
, "OFDM9" }, \

443 { 
IFM_IEEE80211_OFDM12
, "OFDM12" }, \

444 { 
IFM_IEEE80211_OFDM13_5
, "OFDM13.5Mbps" }, \

445 { 
IFM_IEEE80211_OFDM18
, "OFDM18" }, \

446 { 
IFM_IEEE80211_OFDM24
, "OFDM24" }, \

447 { 
IFM_IEEE80211_OFDM27
, "OFDM27" }, \

448 { 
IFM_IEEE80211_OFDM36
, "OFDM36" }, \

449 { 
IFM_IEEE80211_OFDM48
, "OFDM48" }, \

450 { 
IFM_IEEE80211_OFDM54
, "OFDM54" }, \

451 { 
IFM_IEEE80211_OFDM72
, "OFDM72" }, \

452 { 
IFM_IEEE80211_DS1
, "CCK1" }, \

453 { 
IFM_IEEE80211_DS2
, "CCK2" }, \

454 { 
IFM_IEEE80211_DS5
, "CCK5.5" }, \

455 { 
IFM_IEEE80211_DS11
, "CCK11" }, \

456 { 0, 
NULL
 }, \

457 }

	)

459 
	#IFM_SUBTYPE_IEEE80211_OPTION_DESCRIPTIONS
 { \

460 { 
IFM_IEEE80211_ADHOC
, "adhoc" }, \

461 { 
IFM_IEEE80211_HOSTAP
, "hostap" }, \

462 { 
IFM_IEEE80211_IBSS
, "ibss" }, \

463 { 
IFM_IEEE80211_WDS
, "wds" }, \

464 { 
IFM_IEEE80211_TURBO
, "turbo" }, \

465 { 0, 
NULL
 }, \

466 }

	)

468 
	#IFM_SUBTYPE_IEEE80211_MODE_DESCRIPTIONS
 { \

469 { 
IFM_IEEE80211_11A
, "11a" }, \

470 { 
IFM_IEEE80211_11B
, "11b" }, \

471 { 
IFM_IEEE80211_11G
, "11g" }, \

472 { 0, 
NULL
 }, \

473 }

	)

475 
	#IFM_SUBTYPE_SHARED_DESCRIPTIONS
 { \

476 { 
IFM_AUTO
, "autoselect" }, \

477 { 
IFM_MANUAL
, "manual" }, \

478 { 
IFM_NONE
, "none" }, \

479 { 0, 
NULL
 }, \

480 }

	)

482 
	#IFM_SUBTYPE_SHARED_ALIASES
 { \

483 { 
IFM_AUTO
, "auto" }, \

484 { 0, 
NULL
 }, \

485 }

	)

487 
	#IFM_SHARED_OPTION_DESCRIPTIONS
 { \

488 { 
IFM_FDX
, "full-duplex" }, \

489 { 
IFM_HDX
, "half-duplex" }, \

490 { 
IFM_FLAG0
, "flag0" }, \

491 { 
IFM_FLAG1
, "flag1" }, \

492 { 
IFM_FLAG2
, "flag2" }, \

493 { 
IFM_LOOP
, "hw-loopback" }, \

494 { 0, 
NULL
 }, \

495 }

	)

	@wlan.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

102 cÚ¡ 
	g__moduË_d•’ds
[]

103 
__©Œibu‹_u£d__


104 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

108 
MODULE_INFO
(
¤cv”siÚ
, "2F3CDF04E48A261FFB1FE97");

	@wlan_acl.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

33 cÚ¡ 
	g__moduË_d•’ds
[]

34 
__©Œibu‹_u£d__


35 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

39 
MODULE_INFO
(
¤cv”siÚ
, "DB5DC38665FFC920658D99A");

	@wlan_ccmp.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

40 cÚ¡ 
	g__moduË_d•’ds
[]

41 
__©Œibu‹_u£d__


42 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

46 
MODULE_INFO
(
¤cv”siÚ
, "B9A53BD6B494B9EBECA15FA");

	@wlan_scan_ap.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

48 cÚ¡ 
	g__moduË_d•’ds
[]

49 
__©Œibu‹_u£d__


50 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

54 
MODULE_INFO
(
¤cv”siÚ
, "62021A1C323AD6E6C08AE61");

	@wlan_scan_sta.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

52 cÚ¡ 
	g__moduË_d•’ds
[]

53 
__©Œibu‹_u£d__


54 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

58 
MODULE_INFO
(
¤cv”siÚ
, "12D8E994305A825BDBC8593");

	@wlan_tkip.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

39 cÚ¡ 
	g__moduË_d•’ds
[]

40 
__©Œibu‹_u£d__


41 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

45 
MODULE_INFO
(
¤cv”siÚ
, "B1C46601DF1F85364929AFE");

	@wlan_wep.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

37 cÚ¡ 
	g__moduË_d•’ds
[]

38 
__©Œibu‹_u£d__


39 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

43 
MODULE_INFO
(
¤cv”siÚ
, "524F223AFA2AAC5571D4CAF");

	@wlan_xauth.mod.c

1 
	~<lšux/moduË.h
>

2 
	~<lšux/v”magic.h
>

3 
	~<lšux/comp”.h
>

5 
MODULE_INFO
(
v”magic
, 
VERMAGIC_STRING
);

7 
moduË
 
__this_moduË


8 
__©Œibu‹__
((
£ùiÚ
(".gnu.linkonce.this_module"))) = {

9 .
Çme
 = 
KBUILD_MODNAME
,

10 .
	gš™
 = 
š™_moduË
,

11 #ifdeà
CONFIG_MODULE_UNLOAD


12 .
	gex™
 = 
ş—nup_moduË
,

14 .
	g¬ch
 = 
MODULE_ARCH_INIT
,

17 cÚ¡ 
modv”siÚ_šfo
 
	g____v”siÚs
[]

18 
__©Œibu‹_u£d__


19 
__©Œibu‹__
((
£ùiÚ
("__versions"))) = {

25 cÚ¡ 
	g__moduË_d•’ds
[]

26 
__©Œibu‹_u£d__


27 
__©Œibu‹__
((
£ùiÚ
(".modinfo"))) =

31 
MODULE_INFO
(
¤cv”siÚ
, "86C55C554A9702915A2A364");

	@/usr/include/asm/byteorder.h

1 #iâdeà
_ASM_X86_BYTEORDER_H


2 
	#_ASM_X86_BYTEORDER_H


	)

4 
	~<asm/ty³s.h
>

6 #ifdeà
__GNUC__


8 #ifdeà
__i386__


10 
__šlše__
 
__u32
 
	$___¬ch__swab32
(
__u32
 
x
)

12 #ifdeà
CONFIG_X86_BSWAP


13 
	`__asm__
("bsw­ %0" : "ô" (
x
) : "0" (x));

15 
	`__asm__
("xchgb %b0,%h0\n\t"

18 :"=q" (
x
)

19 : "0" (
x
));

21  
x
;

22 
	}
}

24 
__šlše__
 
__u64
 
	$___¬ch__swab64
(
__u64
 
v®
)

27 ¡ruù { 
__u32
 
a
,
b
; } 
s
;

28 
__u64
 
u
;

29 } 
v
;

30 
v
.
u
 = 
v®
;

31 #ifdeà
CONFIG_X86_BSWAP


32 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

33 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

34 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

36 
v
.
s
.
a
 = 
	`___¬ch__swab32
(v.s.a);

37 
v
.
s
.
b
 = 
	`___¬ch__swab32
(v.s.b);

38 
	`__asm__
("xchgÈ%0,%1" : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
) : "0" (v.s.a), "1" (v.s.b));

40  
v
.
u
;

41 
	}
}

45 
__šlše__
 
__u64
 
	$___¬ch__swab64
(
__u64
 
x
)

47 
	`__asm__
("bsw­q %0" : "ô" (
x
) : "0" (x));

48  
x
;

49 
	}
}

51 
__šlše__
 
__u32
 
	$___¬ch__swab32
(
__u32
 
x
)

53 
	`__asm__
("bsw­È%0" : "ô" (
x
) : "0" (x));

54  
x
;

55 
	}
}

62 
	#__¬ch__swab64
(
x
è
	`___¬ch__swab64
(x)

	)

63 
	#__¬ch__swab32
(
x
è
	`___¬ch__swab32
(x)

	)

65 
	#__BYTEORDER_HAS_U64__


	)

69 
	~<lšux/by‹Üd”/l™e_’dŸn.h
>

	@/usr/include/linux/fs.h

1 #iâdeà
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

9 
	~<lšux/lim™s.h
>

10 
	~<lšux/ioùl.h
>

23 #undeà
NR_OPEN


24 
	#NR_OPEN
 (1024*1024è

	)

25 
	#INR_OPEN
 1024

	)

27 
	#BLOCK_SIZE_BITS
 10

	)

28 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

30 
	#SEEK_SET
 0

	)

31 
	#SEEK_CUR
 1

	)

32 
	#SEEK_END
 2

	)

33 
	#SEEK_MAX
 
SEEK_END


	)

36 
	sfes_¡©_¡ruù
 {

37 
	mÄ_fes
;

38 
	mÄ_ä“_fes
;

39 
	mmax_fes
;

41 
fes_¡©_¡ruù
 
fes_¡©
;

42 
g‘_max_fes
();

44 
	sšodes_¡©_t
 {

45 
	mÄ_šodes
;

46 
	mÄ_unu£d
;

47 
	mdummy
[5];

49 
šodes_¡©_t
 
šodes_¡©
;

51 
Ëa£s_’abË
, 
Ëa£_b»ak_time
;

53 #ifdeà
CONFIG_DNOTIFY


54 
dœ_nÙify_’abË
;

57 
	#NR_FILE
 8192

	)

59 
	#MAY_EXEC
 1

	)

60 
	#MAY_WRITE
 2

	)

61 
	#MAY_READ
 4

	)

62 
	#MAY_APPEND
 8

	)

64 
	#FMODE_READ
 1

	)

65 
	#FMODE_WRITE
 2

	)

68 
	#FMODE_LSEEK
 4

	)

69 
	#FMODE_PREAD
 8

	)

70 
	#FMODE_PWRITE
 
FMODE_PREAD


	)

75 
	#FMODE_EXEC
 16

	)

77 
	#RW_MASK
 1

	)

78 
	#RWA_MASK
 2

	)

79 
	#READ
 0

	)

80 
	#WRITE
 1

	)

81 
	#READA
 2

	)

82 
	#SWRITE
 3

	)

83 
	#READ_SYNC
 (
READ
 | (1 << 
BIO_RW_SYNC
))

	)

84 
	#READ_META
 (
READ
 | (1 << 
BIO_RW_META
))

	)

85 
	#WRITE_SYNC
 (
WRITE
 | (1 << 
BIO_RW_SYNC
))

	)

86 
	#WRITE_BARRIER
 ((1 << 
BIO_RW
è| (1 << 
BIO_RW_BARRIER
))

	)

88 
	#SEL_IN
 1

	)

89 
	#SEL_OUT
 2

	)

90 
	#SEL_EX
 4

	)

93 
	#FS_REQUIRES_DEV
 1

	)

94 
	#FS_BINARY_MOUNTDATA
 2

	)

95 
	#FS_HAS_SUBTYPE
 4

	)

96 
	#FS_REVAL_DOT
 16384

	)

97 
	#FS_RENAME_DOES_D_MOVE
 32768

	)

104 
	#MS_RDONLY
 1

	)

105 
	#MS_NOSUID
 2

	)

106 
	#MS_NODEV
 4

	)

107 
	#MS_NOEXEC
 8

	)

108 
	#MS_SYNCHRONOUS
 16

	)

109 
	#MS_REMOUNT
 32

	)

110 
	#MS_MANDLOCK
 64

	)

111 
	#MS_DIRSYNC
 128

	)

112 
	#MS_NOATIME
 1024

	)

113 
	#MS_NODIRATIME
 2048

	)

114 
	#MS_BIND
 4096

	)

115 
	#MS_MOVE
 8192

	)

116 
	#MS_REC
 16384

	)

117 
	#MS_VERBOSE
 32768

	)

119 
	#MS_SILENT
 32768

	)

120 
	#MS_POSIXACL
 (1<<16è

	)

121 
	#MS_UNBINDABLE
 (1<<17è

	)

122 
	#MS_PRIVATE
 (1<<18è

	)

123 
	#MS_SLAVE
 (1<<19è

	)

124 
	#MS_SHARED
 (1<<20è

	)

125 
	#MS_RELATIME
 (1<<21è

	)

126 
	#MS_KERNMOUNT
 (1<<22è

	)

127 
	#MS_ACTIVE
 (1<<30)

	)

128 
	#MS_NOUSER
 (1<<31)

	)

133 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
)

	)

138 
	#MS_MGC_VAL
 0xC0ED0000

	)

139 
	#MS_MGC_MSK
 0xffff0000

	)

143 
	#S_SYNC
 1

	)

144 
	#S_NOATIME
 2

	)

145 
	#S_APPEND
 4

	)

146 
	#S_IMMUTABLE
 8

	)

147 
	#S_DEAD
 16

	)

148 
	#S_NOQUOTA
 32

	)

149 
	#S_DIRSYNC
 64

	)

150 
	#S_NOCMTIME
 128

	)

151 
	#S_SWAPFILE
 256

	)

152 
	#S_PRIVATE
 512

	)

167 
	#__IS_FLG
(
šode
,
æg
è((šode)->
i_sb
->
s_æags
 & (æg))

	)

169 
	#IS_RDONLY
(
šode
è((šode)->
i_sb
->
s_æags
 & 
MS_RDONLY
)

	)

170 
	#IS_SYNC
(
šode
è(
	`__IS_FLG
(šode, 
MS_SYNCHRONOUS
) || \

171 ((
šode
)->
i_æags
 & 
S_SYNC
))

	)

172 
	#IS_DIRSYNC
(
šode
è(
	`__IS_FLG
(šode, 
MS_SYNCHRONOUS
|
MS_DIRSYNC
) || \

173 ((
šode
)->
i_æags
 & (
S_SYNC
|
S_DIRSYNC
)))

	)

174 
	#IS_MANDLOCK
(
šode
è
	`__IS_FLG
(šode, 
MS_MANDLOCK
)

	)

175 
	#IS_NOATIME
(
šode
è
	`__IS_FLG
(šode, 
MS_RDONLY
|
MS_NOATIME
)

	)

177 
	#IS_NOQUOTA
(
šode
è((šode)->
i_æags
 & 
S_NOQUOTA
)

	)

178 
	#IS_APPEND
(
šode
è((šode)->
i_æags
 & 
S_APPEND
)

	)

179 
	#IS_IMMUTABLE
(
šode
è((šode)->
i_æags
 & 
S_IMMUTABLE
)

	)

180 
	#IS_POSIXACL
(
šode
è
	`__IS_FLG
(šode, 
MS_POSIXACL
)

	)

182 
	#IS_DEADDIR
(
šode
è((šode)->
i_æags
 & 
S_DEAD
)

	)

183 
	#IS_NOCMTIME
(
šode
è((šode)->
i_æags
 & 
S_NOCMTIME
)

	)

184 
	#IS_SWAPFILE
(
šode
è((šode)->
i_æags
 & 
S_SWAPFILE
)

	)

185 
	#IS_PRIVATE
(
šode
è((šode)->
i_æags
 & 
S_PRIVATE
)

	)

190 
	#BLKROSET
 
	`_IO
(0x12,93è

	)

191 
	#BLKROGET
 
	`_IO
(0x12,94è

	)

192 
	#BLKRRPART
 
	`_IO
(0x12,95è

	)

193 
	#BLKGETSIZE
 
	`_IO
(0x12,96è

	)

194 
	#BLKFLSBUF
 
	`_IO
(0x12,97è

	)

195 
	#BLKRASET
 
	`_IO
(0x12,98è

	)

196 
	#BLKRAGET
 
	`_IO
(0x12,99è

	)

197 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

198 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

199 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

200 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

201 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

203 
	#BLKPG
 
	`_IO
(0x12,105)

	)

207 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

208 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

213 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

214 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

215 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

216 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_Œaû_£tup
)

	)

217 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

218 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

219 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

221 
	#BMAP_IOCTL
 1

	)

222 
	#FIBMAP
 
	`_IO
(0x00,1è

	)

223 
	#FIGETBSZ
 
	`_IO
(0x00,2è

	)

225 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

226 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

227 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

228 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

229 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

230 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

231 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

232 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

237 
	#FS_SECRM_FL
 0x00000001

	)

238 
	#FS_UNRM_FL
 0x00000002

	)

239 
	#FS_COMPR_FL
 0x00000004

	)

240 
	#FS_SYNC_FL
 0x00000008

	)

241 
	#FS_IMMUTABLE_FL
 0x00000010

	)

242 
	#FS_APPEND_FL
 0x00000020

	)

243 
	#FS_NODUMP_FL
 0x00000040

	)

244 
	#FS_NOATIME_FL
 0x00000080

	)

246 
	#FS_DIRTY_FL
 0x00000100

	)

247 
	#FS_COMPRBLK_FL
 0x00000200

	)

248 
	#FS_NOCOMP_FL
 0x00000400

	)

249 
	#FS_ECOMPR_FL
 0x00000800

	)

251 
	#FS_BTREE_FL
 0x00001000

	)

252 
	#FS_INDEX_FL
 0x00001000

	)

253 
	#FS_IMAGIC_FL
 0x00002000

	)

254 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

255 
	#FS_NOTAIL_FL
 0x00008000

	)

256 
	#FS_DIRSYNC_FL
 0x00010000

	)

257 
	#FS_TOPDIR_FL
 0x00020000

	)

258 
	#FS_EXTENT_FL
 0x00080000

	)

259 
	#FS_DIRECTIO_FL
 0x00100000

	)

260 
	#FS_RESERVED_FL
 0x80000000

	)

262 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

263 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

266 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

267 
	#SYNC_FILE_RANGE_WRITE
 2

	)

268 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

	@/usr/include/linux/if.h

19 #iâdeà
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<lšux/ty³s.h
>

23 
	~<lšux/sock‘.h
>

25 
	#IFNAMSIZ
 16

	)

26 
	~<lšux/hdlc/ioùl.h
>

29 
	#IFF_UP
 0x1

	)

30 
	#IFF_BROADCAST
 0x2

	)

31 
	#IFF_DEBUG
 0x4

	)

32 
	#IFF_LOOPBACK
 0x8

	)

33 
	#IFF_POINTOPOINT
 0x10

	)

34 
	#IFF_NOTRAILERS
 0x20

	)

35 
	#IFF_RUNNING
 0x40

	)

36 
	#IFF_NOARP
 0x80

	)

37 
	#IFF_PROMISC
 0x100

	)

38 
	#IFF_ALLMULTI
 0x200

	)

40 
	#IFF_MASTER
 0x400

	)

41 
	#IFF_SLAVE
 0x800

	)

43 
	#IFF_MULTICAST
 0x1000

	)

45 
	#IFF_PORTSEL
 0x2000

	)

46 
	#IFF_AUTOMEDIA
 0x4000

	)

47 
	#IFF_DYNAMIC
 0x8000

	)

49 
	#IFF_LOWER_UP
 0x10000

	)

50 
	#IFF_DORMANT
 0x20000

	)

52 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|\

53 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

56 
	#IFF_802_1Q_VLAN
 0x1

	)

57 
	#IFF_EBRIDGE
 0x2

	)

58 
	#IFF_SLAVE_INACTIVE
 0x4

	)

59 
	#IFF_MASTER_8023AD
 0x8

	)

60 
	#IFF_MASTER_ALB
 0x10

	)

61 
	#IFF_BONDING
 0x20

	)

62 
	#IFF_SLAVE_NEEDARP
 0x40

	)

64 
	#IF_GET_IFACE
 0x0001

	)

65 
	#IF_GET_PROTO
 0x0002

	)

68 
	#IF_IFACE_V35
 0x1000

	)

69 
	#IF_IFACE_V24
 0x1001

	)

70 
	#IF_IFACE_X21
 0x1002

	)

71 
	#IF_IFACE_T1
 0x1003

	)

72 
	#IF_IFACE_E1
 0x1004

	)

73 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

74 
	#IF_IFACE_X21D
 0x1006

	)

77 
	#IF_PROTO_HDLC
 0x2000

	)

78 
	#IF_PROTO_PPP
 0x2001

	)

79 
	#IF_PROTO_CISCO
 0x2002

	)

80 
	#IF_PROTO_FR
 0x2003

	)

81 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

82 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

83 
	#IF_PROTO_X25
 0x2006

	)

84 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

85 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

86 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

87 
	#IF_PROTO_FR_PVC
 0x200A

	)

88 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

89 
	#IF_PROTO_RAW
 0x200C

	)

93 
	mIF_OPER_UNKNOWN
,

94 
	mIF_OPER_NOTPRESENT
,

95 
	mIF_OPER_DOWN
,

96 
	mIF_OPER_LOWERLAYERDOWN
,

97 
	mIF_OPER_TESTING
,

98 
	mIF_OPER_DORMANT
,

99 
	mIF_OPER_UP
,

104 
	mIF_LINK_MODE_DEFAULT
,

105 
	mIF_LINK_MODE_DORMANT
,

118 
	sifm­


120 
	mmem_¡¬t
;

121 
	mmem_’d
;

122 
	mba£_addr
;

123 
	mœq
;

124 
	mdma
;

125 
	mpÜt
;

129 
	sif_£‰šgs


131 
	mty³
;

132 
	msize
;

135 
¿w_hdlc_´Ùo
 *
	m¿w_hdlc
;

136 
cisco_´Ùo
 *
	mcisco
;

137 
ä_´Ùo
 *
	mä
;

138 
ä_´Ùo_pvc
 *
	mä_pvc
;

139 
ä_´Ùo_pvc_šfo
 *
	mä_pvc_šfo
;

142 
sync_£rŸl_£‰šgs
 *
	msync
;

143 
‹1_£‰šgs
 *
	m‹1
;

144 } 
	mifs_ifsu
;

154 
	siäeq


156 
	#IFHWADDRLEN
 6

	)

159 
	miän_Çme
[
IFNAMSIZ
];

160 } 
	miä_iän
;

163 
sockaddr
 
	miäu_addr
;

164 
sockaddr
 
	miäu_d¡addr
;

165 
sockaddr
 
	miäu_brßdaddr
;

166 
sockaddr
 
	miäu_Ãtmask
;

167 
sockaddr
 
	miäu_hwaddr
;

168 
	miäu_æags
;

169 
	miäu_iv®ue
;

170 
	miäu_mtu
;

171 
ifm­
 
	miäu_m­
;

172 
	miäu_¦ave
[
IFNAMSIZ
];

173 
	miäu_ÃwÇme
[
IFNAMSIZ
];

174 * 
	miäu_d©a
;

175 
if_£‰šgs
 
	miäu_£‰šgs
;

176 } 
	miä_iäu
;

179 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

180 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

181 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

182 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

183 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

184 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

185 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

186 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

187 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

188 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

189 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

190 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

191 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

192 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

193 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

194 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

195 
	#iä_£‰šgs
 
iä_iäu
.
iäu_£‰šgs


	)

204 
	sifcÚf


206 
	mifc_Ën
;

209 *
	mifcu_buf
;

210 
iäeq
 *
	mifcu_»q
;

211 } 
	mifc_ifcu
;

213 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

214 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

	@/usr/include/linux/if_arp.h

23 #iâdeà
_LINUX_IF_ARP_H


24 
	#_LINUX_IF_ARP_H


	)

26 
	~<lšux/Ãtdeviû.h
>

29 
	#ARPHRD_NETROM
 0

	)

30 
	#ARPHRD_ETHER
 1

	)

31 
	#ARPHRD_EETHER
 2

	)

32 
	#ARPHRD_AX25
 3

	)

33 
	#ARPHRD_PRONET
 4

	)

34 
	#ARPHRD_CHAOS
 5

	)

35 
	#ARPHRD_IEEE802
 6

	)

36 
	#ARPHRD_ARCNET
 7

	)

37 
	#ARPHRD_APPLETLK
 8

	)

38 
	#ARPHRD_DLCI
 15

	)

39 
	#ARPHRD_ATM
 19

	)

40 
	#ARPHRD_METRICOM
 23

	)

41 
	#ARPHRD_IEEE1394
 24

	)

42 
	#ARPHRD_EUI64
 27

	)

43 
	#ARPHRD_INFINIBAND
 32

	)

46 
	#ARPHRD_SLIP
 256

	)

47 
	#ARPHRD_CSLIP
 257

	)

48 
	#ARPHRD_SLIP6
 258

	)

49 
	#ARPHRD_CSLIP6
 259

	)

50 
	#ARPHRD_RSRVD
 260

	)

51 
	#ARPHRD_ADAPT
 264

	)

52 
	#ARPHRD_ROSE
 270

	)

53 
	#ARPHRD_X25
 271

	)

54 
	#ARPHRD_HWX25
 272

	)

55 
	#ARPHRD_WIMAX
 273

	)

57 
	#ARPHRD_PPP
 512

	)

58 
	#ARPHRD_CISCO
 513

	)

59 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

60 
	#ARPHRD_LAPB
 516

	)

61 
	#ARPHRD_DDCMP
 517

	)

62 
	#ARPHRD_RAWHDLC
 518

	)

64 
	#ARPHRD_TUNNEL
 768

	)

65 
	#ARPHRD_TUNNEL6
 769

	)

66 
	#ARPHRD_FRAD
 770

	)

67 
	#ARPHRD_SKIP
 771

	)

68 
	#ARPHRD_LOOPBACK
 772

	)

69 
	#ARPHRD_LOCALTLK
 773

	)

70 
	#ARPHRD_FDDI
 774

	)

71 
	#ARPHRD_BIF
 775

	)

72 
	#ARPHRD_SIT
 776

	)

73 
	#ARPHRD_IPDDP
 777

	)

74 
	#ARPHRD_IPGRE
 778

	)

75 
	#ARPHRD_PIMREG
 779

	)

76 
	#ARPHRD_HIPPI
 780

	)

77 
	#ARPHRD_ASH
 781

	)

78 
	#ARPHRD_ECONET
 782

	)

79 
	#ARPHRD_IRDA
 783

	)

81 
	#ARPHRD_FCPP
 784

	)

82 
	#ARPHRD_FCAL
 785

	)

83 
	#ARPHRD_FCPL
 786

	)

84 
	#ARPHRD_FCFABRIC
 787

	)

86 
	#ARPHRD_IEEE802_TR
 800

	)

87 
	#ARPHRD_IEEE80211
 801

	)

88 
	#ARPHRD_IEEE80211_PRISM
 802

	)

89 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

91 
	#ARPHRD_VOID
 0xFFFF

	)

92 
	#ARPHRD_NONE
 0xFFFE

	)

95 
	#ARPOP_REQUEST
 1

	)

96 
	#ARPOP_REPLY
 2

	)

97 
	#ARPOP_RREQUEST
 3

	)

98 
	#ARPOP_RREPLY
 4

	)

99 
	#ARPOP_InREQUEST
 8

	)

100 
	#ARPOP_InREPLY
 9

	)

101 
	#ARPOP_NAK
 10

	)

105 
	s¬´eq
 {

106 
sockaddr
 
	m¬p_·
;

107 
sockaddr
 
	m¬p_ha
;

108 
	m¬p_æags
;

109 
sockaddr
 
	m¬p_Ãtmask
;

110 
	m¬p_dev
[16];

113 
	s¬´eq_Şd
 {

114 
sockaddr
 
	m¬p_·
;

115 
sockaddr
 
	m¬p_ha
;

116 
	m¬p_æags
;

117 
sockaddr
 
	m¬p_Ãtmask
;

121 
	#ATF_COM
 0x02

	)

122 
	#ATF_PERM
 0x04

	)

123 
	#ATF_PUBL
 0x08

	)

124 
	#ATF_USETRAILERS
 0x10

	)

125 
	#ATF_NETMASK
 0x20

	)

127 
	#ATF_DONTPUB
 0x40

	)

133 
	s¬phdr


135 
__be16
 
	m¬_hrd
;

136 
__be16
 
	m¬_´o
;

137 
	m¬_hÊ
;

138 
	m¬_¶n
;

139 
__be16
 
	m¬_İ
;

145 
	m¬_sha
[
ETH_ALEN
];

146 
	m¬_s
[4];

147 
	m¬_tha
[
ETH_ALEN
];

148 
	m¬_t
[4];

	@/usr/include/linux/if_vlan.h

13 #iâdeà
_LINUX_IF_VLAN_H_


14 
	#_LINUX_IF_VLAN_H_


	)

20 
	evÏn_ioùl_cmds
 {

21 
	mADD_VLAN_CMD
,

22 
	mDEL_VLAN_CMD
,

23 
	mSET_VLAN_INGRESS_PRIORITY_CMD
,

24 
	mSET_VLAN_EGRESS_PRIORITY_CMD
,

25 
	mGET_VLAN_INGRESS_PRIORITY_CMD
,

26 
	mGET_VLAN_EGRESS_PRIORITY_CMD
,

27 
	mSET_VLAN_NAME_TYPE_CMD
,

28 
	mSET_VLAN_FLAG_CMD
,

29 
	mGET_VLAN_REALDEV_NAME_CMD
,

30 
	mGET_VLAN_VID_CMD


33 
	evÏn_æags
 {

34 
	mVLAN_FLAG_REORDER_HDR
 = 0x1,

37 
	evÏn_Çme_ty³s
 {

38 
	mVLAN_NAME_TYPE_PLUS_VID
,

39 
	mVLAN_NAME_TYPE_RAW_PLUS_VID
,

40 
	mVLAN_NAME_TYPE_PLUS_VID_NO_PAD
,

41 
	mVLAN_NAME_TYPE_RAW_PLUS_VID_NO_PAD
,

42 
	mVLAN_NAME_TYPE_HIGHEST


45 
	svÏn_ioùl_¬gs
 {

46 
	mcmd
;

47 
	mdeviû1
[24];

50 
	mdeviû2
[24];

51 
	mVID
;

52 
	mskb_´iÜ™y
;

53 
	mÇme_ty³
;

54 
	mbšd_ty³
;

55 
	mæag
;

56 } 
	mu
;

58 
	mvÏn_qos
;

	@/usr/include/linux/in.h

18 #iâdeà
_LINUX_IN_H


19 
	#_LINUX_IN_H


	)

21 
	~<lšux/ty³s.h
>

22 
	~<lšux/sock‘.h
>

26 
	mIPPROTO_IP
 = 0,

27 
	mIPPROTO_ICMP
 = 1,

28 
	mIPPROTO_IGMP
 = 2,

29 
	mIPPROTO_IPIP
 = 4,

30 
	mIPPROTO_TCP
 = 6,

31 
	mIPPROTO_EGP
 = 8,

32 
	mIPPROTO_PUP
 = 12,

33 
	mIPPROTO_UDP
 = 17,

34 
	mIPPROTO_IDP
 = 22,

35 
	mIPPROTO_DCCP
 = 33,

36 
	mIPPROTO_RSVP
 = 46,

37 
	mIPPROTO_GRE
 = 47,

39 
	mIPPROTO_IPV6
 = 41,

41 
	mIPPROTO_ESP
 = 50,

42 
	mIPPROTO_AH
 = 51,

43 
	mIPPROTO_BEETPH
 = 94,

44 
	mIPPROTO_PIM
 = 103,

46 
	mIPPROTO_COMP
 = 108,

47 
	mIPPROTO_SCTP
 = 132,

48 
	mIPPROTO_UDPLITE
 = 136,

50 
	mIPPROTO_RAW
 = 255,

51 
	mIPPROTO_MAX


56 
	sš_addr
 {

57 
__be32
 
	ms_addr
;

60 
	#IP_TOS
 1

	)

61 
	#IP_TTL
 2

	)

62 
	#IP_HDRINCL
 3

	)

63 
	#IP_OPTIONS
 4

	)

64 
	#IP_ROUTER_ALERT
 5

	)

65 
	#IP_RECVOPTS
 6

	)

66 
	#IP_RETOPTS
 7

	)

67 
	#IP_PKTINFO
 8

	)

68 
	#IP_PKTOPTIONS
 9

	)

69 
	#IP_MTU_DISCOVER
 10

	)

70 
	#IP_RECVERR
 11

	)

71 
	#IP_RECVTTL
 12

	)

72 
	#IP_RECVTOS
 13

	)

73 
	#IP_MTU
 14

	)

74 
	#IP_FREEBIND
 15

	)

75 
	#IP_IPSEC_POLICY
 16

	)

76 
	#IP_XFRM_POLICY
 17

	)

77 
	#IP_PASSSEC
 18

	)

80 
	#IP_RECVRETOPTS
 
IP_RETOPTS


	)

83 
	#IP_PMTUDISC_DONT
 0

	)

84 
	#IP_PMTUDISC_WANT
 1

	)

85 
	#IP_PMTUDISC_DO
 2

	)

86 
	#IP_PMTUDISC_PROBE
 3

	)

88 
	#IP_MULTICAST_IF
 32

	)

89 
	#IP_MULTICAST_TTL
 33

	)

90 
	#IP_MULTICAST_LOOP
 34

	)

91 
	#IP_ADD_MEMBERSHIP
 35

	)

92 
	#IP_DROP_MEMBERSHIP
 36

	)

93 
	#IP_UNBLOCK_SOURCE
 37

	)

94 
	#IP_BLOCK_SOURCE
 38

	)

95 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

96 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

97 
	#IP_MSFILTER
 41

	)

98 
	#MCAST_JOIN_GROUP
 42

	)

99 
	#MCAST_BLOCK_SOURCE
 43

	)

100 
	#MCAST_UNBLOCK_SOURCE
 44

	)

101 
	#MCAST_LEAVE_GROUP
 45

	)

102 
	#MCAST_JOIN_SOURCE_GROUP
 46

	)

103 
	#MCAST_LEAVE_SOURCE_GROUP
 47

	)

104 
	#MCAST_MSFILTER
 48

	)

106 
	#MCAST_EXCLUDE
 0

	)

107 
	#MCAST_INCLUDE
 1

	)

110 
	#IP_DEFAULT_MULTICAST_TTL
 1

	)

111 
	#IP_DEFAULT_MULTICAST_LOOP
 1

	)

115 
	s_m»q


117 
š_addr
 
	mimr_muÉŸddr
;

118 
š_addr
 
	mimr_š‹rçû
;

121 
	s_m»qn


123 
š_addr
 
	mimr_muÉŸddr
;

124 
š_addr
 
	mimr_add»ss
;

125 
	mimr_ifšdex
;

128 
	s_m»q_sourû
 {

129 
__be32
 
	mimr_muÉŸddr
;

130 
__be32
 
	mimr_š‹rçû
;

131 
__be32
 
	mimr_sourûaddr
;

134 
	s_msf‹r
 {

135 
__be32
 
	mimsf_muÉŸddr
;

136 
__be32
 
	mimsf_š‹rçû
;

137 
__u32
 
	mimsf_fmode
;

138 
__u32
 
	mimsf_num¤c
;

139 
__be32
 
	mimsf_¦i¡
[1];

142 
	#IP_MSFILTER_SIZE
(
num¤c
) \

143 ((
_msf‹r
è- (
__u32
) \

144 + (
num¤c
è* (
__u32
))

	)

146 
	sgroup_»q


148 
__u32
 
	mgr_š‹rçû
;

149 
__k”Ãl_sockaddr_¡Üage
 
	mgr_group
;

152 
	sgroup_sourû_»q


154 
__u32
 
	mg¤_š‹rçû
;

155 
__k”Ãl_sockaddr_¡Üage
 
	mg¤_group
;

156 
__k”Ãl_sockaddr_¡Üage
 
	mg¤_sourû
;

159 
	sgroup_f‹r


161 
__u32
 
	mgf_š‹rçû
;

162 
__k”Ãl_sockaddr_¡Üage
 
	mgf_group
;

163 
__u32
 
	mgf_fmode
;

164 
__u32
 
	mgf_num¤c
;

165 
__k”Ãl_sockaddr_¡Üage
 
	mgf_¦i¡
[1];

168 
	#GROUP_FILTER_SIZE
(
num¤c
) \

169 ((
group_f‹r
è- (
__k”Ãl_sockaddr_¡Üage
) \

170 + (
num¤c
è* (
__k”Ãl_sockaddr_¡Üage
))

	)

172 
	sš_pktšfo


174 
	mi_ifšdex
;

175 
š_addr
 
	mi_¥ec_d¡
;

176 
š_addr
 
	mi_addr
;

180 
	#__SOCK_SIZE__
 16

	)

181 
	ssockaddr_š
 {

182 
§_çmy_t
 
	msš_çmy
;

183 
__be16
 
	msš_pÜt
;

184 
š_addr
 
	msš_addr
;

187 
	m__·d
[
__SOCK_SIZE__
 - () -

188 (è- (
š_addr
)];

190 
	#sš_z”o
 
__·d


	)

198 
	#IN_CLASSA
(
a
è((((è×)è& 0x80000000è=ğ0)

	)

199 
	#IN_CLASSA_NET
 0xff000000

	)

200 
	#IN_CLASSA_NSHIFT
 24

	)

201 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

202 
	#IN_CLASSA_MAX
 128

	)

204 
	#IN_CLASSB
(
a
è((((è×)è& 0xc0000000è=ğ0x80000000)

	)

205 
	#IN_CLASSB_NET
 0xffff0000

	)

206 
	#IN_CLASSB_NSHIFT
 16

	)

207 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

208 
	#IN_CLASSB_MAX
 65536

	)

210 
	#IN_CLASSC
(
a
è((((è×)è& 0xe0000000è=ğ0xc0000000)

	)

211 
	#IN_CLASSC_NET
 0xffffff00

	)

212 
	#IN_CLASSC_NSHIFT
 8

	)

213 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

215 
	#IN_CLASSD
(
a
è((((è×)è& 0xf0000000è=ğ0xe0000000)

	)

216 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

217 
	#IN_MULTICAST_NET
 0xF0000000

	)

219 
	#IN_EXPERIMENTAL
(
a
è((((è×)è& 0xf0000000è=ğ0xf0000000)

	)

220 
	#IN_BADCLASS
(
a
è
	`IN_EXPERIMENTAL
(×))

	)

223 
	#INADDR_ANY
 ((è0x00000000)

	)

226 
	#INADDR_BROADCAST
 ((è0xffffffff)

	)

229 
	#INADDR_NONE
 ((è0xffffffff)

	)

232 
	#IN_LOOPBACKNET
 127

	)

235 
	#INADDR_LOOPBACK
 0x7f000001

	)

236 
	#IN_LOOPBACK
(
a
è((((è×)è& 0xff000000è=ğ0x7f000000)

	)

239 
	#INADDR_UNSPEC_GROUP
 0xe0000000U

	)

240 
	#INADDR_ALLHOSTS_GROUP
 0xe0000001U

	)

241 
	#INADDR_ALLRTRS_GROUP
 0xe0000002U

	)

242 
	#INADDR_MAX_LOCAL_GROUP
 0xe00000ffU

	)

246 
	~<asm/by‹Üd”.h
>

	@/usr/include/linux/ip.h

17 #iâdeà
_LINUX_IP_H


18 
	#_LINUX_IP_H


	)

19 
	~<lšux/ty³s.h
>

20 
	~<asm/by‹Üd”.h
>

22 
	#IPTOS_TOS_MASK
 0x1E

	)

23 
	#IPTOS_TOS
(
tos
è(Ños)&
IPTOS_TOS_MASK
)

	)

24 
	#IPTOS_LOWDELAY
 0x10

	)

25 
	#IPTOS_THROUGHPUT
 0x08

	)

26 
	#IPTOS_RELIABILITY
 0x04

	)

27 
	#IPTOS_MINCOST
 0x02

	)

29 
	#IPTOS_PREC_MASK
 0xE0

	)

30 
	#IPTOS_PREC
(
tos
è(Ños)&
IPTOS_PREC_MASK
)

	)

31 
	#IPTOS_PREC_NETCONTROL
 0xe0

	)

32 
	#IPTOS_PREC_INTERNETCONTROL
 0xc0

	)

33 
	#IPTOS_PREC_CRITIC_ECP
 0xa0

	)

34 
	#IPTOS_PREC_FLASHOVERRIDE
 0x80

	)

35 
	#IPTOS_PREC_FLASH
 0x60

	)

36 
	#IPTOS_PREC_IMMEDIATE
 0x40

	)

37 
	#IPTOS_PREC_PRIORITY
 0x20

	)

38 
	#IPTOS_PREC_ROUTINE
 0x00

	)

42 
	#IPOPT_COPY
 0x80

	)

43 
	#IPOPT_CLASS_MASK
 0x60

	)

44 
	#IPOPT_NUMBER_MASK
 0x1f

	)

46 
	#IPOPT_COPIED
(
o
è((o)&
IPOPT_COPY
)

	)

47 
	#IPOPT_CLASS
(
o
è((o)&
IPOPT_CLASS_MASK
)

	)

48 
	#IPOPT_NUMBER
(
o
è((o)&
IPOPT_NUMBER_MASK
)

	)

50 
	#IPOPT_CONTROL
 0x00

	)

51 
	#IPOPT_RESERVED1
 0x20

	)

52 
	#IPOPT_MEASUREMENT
 0x40

	)

53 
	#IPOPT_RESERVED2
 0x60

	)

55 
	#IPOPT_END
 (0 |
IPOPT_CONTROL
)

	)

56 
	#IPOPT_NOOP
 (1 |
IPOPT_CONTROL
)

	)

57 
	#IPOPT_SEC
 (2 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

58 
	#IPOPT_LSRR
 (3 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

59 
	#IPOPT_TIMESTAMP
 (4 |
IPOPT_MEASUREMENT
)

	)

60 
	#IPOPT_CIPSO
 (6 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

61 
	#IPOPT_RR
 (7 |
IPOPT_CONTROL
)

	)

62 
	#IPOPT_SID
 (8 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

63 
	#IPOPT_SSRR
 (9 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

64 
	#IPOPT_RA
 (20|
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

66 
	#IPVERSION
 4

	)

67 
	#MAXTTL
 255

	)

68 
	#IPDEFTTL
 64

	)

70 
	#IPOPT_OPTVAL
 0

	)

71 
	#IPOPT_OLEN
 1

	)

72 
	#IPOPT_OFFSET
 2

	)

73 
	#IPOPT_MINOFF
 4

	)

74 
	#MAX_IPOPTLEN
 40

	)

75 
	#IPOPT_NOP
 
IPOPT_NOOP


	)

76 
	#IPOPT_EOL
 
IPOPT_END


	)

77 
	#IPOPT_TS
 
IPOPT_TIMESTAMP


	)

79 
	#IPOPT_TS_TSONLY
 0

	)

80 
	#IPOPT_TS_TSANDADDR
 1

	)

81 
	#IPOPT_TS_PRESPEC
 3

	)

83 
	#IPV4_BEET_PHMAXLEN
 8

	)

85 
	shdr
 {

86 #ià
defšed
(
__LITTLE_ENDIAN_BITFIELD
)

87 
__u8
 
	mihl
:4,

88 
	mv”siÚ
:4;

89 #–ià
defšed
 (
__BIG_ENDIAN_BITFIELD
)

90 
__u8
 
	mv”siÚ
:4,

91 
	mihl
:4;

95 
__u8
 
	mtos
;

96 
__be16
 
	mtÙ_Ën
;

97 
__be16
 
	mid
;

98 
__be16
 
	mäag_off
;

99 
__u8
 
	m‰l
;

100 
__u8
 
	m´ÙocŞ
;

101 
__sum16
 
	mcheck
;

102 
__be32
 
	m§ddr
;

103 
__be32
 
	mdaddr
;

108 
	s_auth_hdr
 {

109 
__u8
 
	mÃxthdr
;

110 
__u8
 
	mhd¾’
;

111 
__be16
 
	m»£rved
;

112 
__be32
 
	m¥i
;

113 
__be32
 
	m£q_no
;

114 
__u8
 
	mauth_d©a
[0];

117 
	s_e¥_hdr
 {

118 
__be32
 
	m¥i
;

119 
__be32
 
	m£q_no
;

120 
__u8
 
	m’c_d©a
[0];

123 
	s_comp_hdr
 {

124 
__u8
 
	mÃxthdr
;

125 
__u8
 
	mæags
;

126 
__be16
 
	mıi
;

129 
	s_b“t_phdr
 {

130 
__u8
 
	mÃxthdr
;

131 
__u8
 
	mhd¾’
;

132 
__u8
 
	m·dËn
;

133 
__u8
 
	m»£rved
;

	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

9 
	#SI_LOAD_SHIFT
 16

	)

10 
	ssysšfo
 {

11 
	mu±ime
;

12 
	mlßds
[3];

13 
	mtÙ®¿m
;

14 
	mä“¿m
;

15 
	msh¬ed¿m
;

16 
	mbufã¼am
;

17 
	mtÙ®sw­
;

18 
	mä“sw­
;

19 
	m´ocs
;

20 
	m·d
;

21 
	mtÙ®high
;

22 
	mä“high
;

23 
	mmem_un™
;

24 
	m_f
[20-2*()-()];

28 
	#BUILD_BUG_ON
(
cÚd™iÚ
è(()([1 - 2*!!(cÚd™iÚ)]))

	)

34 
	#BUILD_BUG_ON_ZERO
(
e
è(([1 - 2 * !!Ó)]è- 1)

	)

37 
	#__FUNCTION__
 (
__func__
)

	)

40 #ifdeà
CONFIG_NUMA


41 
	#NUMA_BUILD
 1

	)

43 
	#NUMA_BUILD
 0

	)

	@/usr/include/linux/netdevice.h

25 #iâdeà
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<lšux/if.h
>

29 
	~<lšux/if_‘h”.h
>

30 
	~<lšux/if_·ck‘.h
>

33 
	#MAX_ADDR_LEN
 32

	)

36 
	#NETDEV_TX_OK
 0

	)

37 
	#NETDEV_TX_BUSY
 1

	)

38 
	#NETDEV_TX_LOCKED
 -1

	)

45 #ià!
defšed
(
CONFIG_AX25
è&& !defšed(
CONFIG_AX25_MODULE
è&& !defšed(
CONFIG_TR
)

46 
	#LL_MAX_HEADER
 32

	)

48 #ià
defšed
(
CONFIG_AX25
è|| defšed(
CONFIG_AX25_MODULE
)

49 
	#LL_MAX_HEADER
 96

	)

51 
	#LL_MAX_HEADER
 48

	)

55 #ià!
defšed
(
CONFIG_NET_IPIP
è&& !defšed(
CONFIG_NET_IPIP_MODULE
) && \

56 !
defšed
(
CONFIG_NET_IPGRE
è&& !defšed(
CONFIG_NET_IPGRE_MODULE
) && \

57 !
defšed
(
CONFIG_IPV6_SIT
è&& !defšed(
CONFIG_IPV6_SIT_MODULE
) && \

58 !
defšed
(
CONFIG_IPV6_TUNNEL
è&& !
	$defšed
(
CONFIG_IPV6_TUNNEL_MODULE
)

59 
	#MAX_HEADER
 
LL_MAX_HEADER


	)

61 
	#MAX_HEADER
 (
LL_MAX_HEADER
 + 48)

	)

64 
	sÃt_deviû_subqueue


69 
¡©e
;

77 
	sÃt_deviû_¡©s


79 
rx_·ck‘s
;

80 
tx_·ck‘s
;

81 
rx_by‹s
;

82 
tx_by‹s
;

83 
rx_”rÜs
;

84 
tx_”rÜs
;

85 
rx_drİ³d
;

86 
tx_drİ³d
;

87 
muÉiÿ¡
;

88 
cŞlisiÚs
;

91 
rx_Ëngth_”rÜs
;

92 
rx_ov”_”rÜs
;

93 
rx_üc_”rÜs
;

94 
rx_äame_”rÜs
;

95 
rx_fifo_”rÜs
;

96 
rx_mis£d_”rÜs
;

99 
tx_abÜ‹d_”rÜs
;

100 
tx_ÿ¼›r_”rÜs
;

101 
tx_fifo_”rÜs
;

102 
tx_h—¹b—t_”rÜs
;

103 
tx_wšdow_”rÜs
;

106 
rx_com´es£d
;

107 
tx_com´es£d
;

113 
IF_PORT_UNKNOWN
 = 0,

114 
IF_PORT_10BASE2
,

115 
IF_PORT_10BASET
,

116 
IF_PORT_AUI
,

117 
IF_PORT_100BASET
,

118 
IF_PORT_100BASETX
,

119 
IF_PORT_100BASEFX


	@/usr/include/linux/netfilter.h

1 #iâdeà
__LINUX_NETFILTER_H


2 
	#__LINUX_NETFILTER_H


	)

6 
	#NF_DROP
 0

	)

7 
	#NF_ACCEPT
 1

	)

8 
	#NF_STOLEN
 2

	)

9 
	#NF_QUEUE
 3

	)

10 
	#NF_REPEAT
 4

	)

11 
	#NF_STOP
 5

	)

12 
	#NF_MAX_VERDICT
 
NF_STOP


	)

16 
	#NF_VERDICT_MASK
 0x0000ffff

	)

17 
	#NF_VERDICT_BITS
 16

	)

19 
	#NF_VERDICT_QMASK
 0xffff0000

	)

20 
	#NF_VERDICT_QBITS
 16

	)

22 
	#NF_QUEUE_NR
(
x
è(((x << 
NF_VERDICT_QBITS
è& 
NF_VERDICT_QMASK
è| 
NF_QUEUE
)

	)

27 
	#NFC_UNKNOWN
 0x4000

	)

28 
	#NFC_ALTERED
 0x8000

	)

	@/usr/include/linux/random.h

7 #iâdeà
_LINUX_RANDOM_H


8 
	#_LINUX_RANDOM_H


	)

10 
	~<lšux/ioùl.h
>

15 
	#RNDGETENTCNT
 
	`_IOR
Ğ'R', 0x00, )

	)

18 
	#RNDADDTOENTCNT
 
	`_IOW
Ğ'R', 0x01, )

	)

21 
	#RNDGETPOOL
 
	`_IOR
Ğ'R', 0x02, [2] )

	)

27 
	#RNDADDENTROPY
 
	`_IOW
Ğ'R', 0x03, [2] )

	)

30 
	#RNDZAPENTCNT
 
	`_IO
Ğ'R', 0x04 )

	)

33 
	#RNDCLEARPOOL
 
	`_IO
Ğ'R', 0x06 )

	)

35 
	s¿nd_poŞ_šfo
 {

36 
	m’Œİy_couÁ
;

37 
	mbuf_size
;

38 
__u32
 
	mbuf
[0];

	@/usr/include/linux/rtnetlink.h

1 #iâdeà
__LINUX_RTNETLINK_H


2 
	#__LINUX_RTNETLINK_H


	)

4 
	~<lšux/Ãšk.h
>

5 
	~<lšux/if_lšk.h
>

6 
	~<lšux/if_addr.h
>

7 
	~<lšux/Ãighbour.h
>

16 
	mRTM_BASE
 = 16,

17 
	#RTM_BASE
 
RTM_BASE


	)

19 
	mRTM_NEWLINK
 = 16,

20 
	#RTM_NEWLINK
 
RTM_NEWLINK


	)

21 
	mRTM_DELLINK
,

22 
	#RTM_DELLINK
 
RTM_DELLINK


	)

23 
	mRTM_GETLINK
,

24 
	#RTM_GETLINK
 
RTM_GETLINK


	)

25 
	mRTM_SETLINK
,

26 
	#RTM_SETLINK
 
RTM_SETLINK


	)

28 
	mRTM_NEWADDR
 = 20,

29 
	#RTM_NEWADDR
 
RTM_NEWADDR


	)

30 
	mRTM_DELADDR
,

31 
	#RTM_DELADDR
 
RTM_DELADDR


	)

32 
	mRTM_GETADDR
,

33 
	#RTM_GETADDR
 
RTM_GETADDR


	)

35 
	mRTM_NEWROUTE
 = 24,

36 
	#RTM_NEWROUTE
 
RTM_NEWROUTE


	)

37 
	mRTM_DELROUTE
,

38 
	#RTM_DELROUTE
 
RTM_DELROUTE


	)

39 
	mRTM_GETROUTE
,

40 
	#RTM_GETROUTE
 
RTM_GETROUTE


	)

42 
	mRTM_NEWNEIGH
 = 28,

43 
	#RTM_NEWNEIGH
 
RTM_NEWNEIGH


	)

44 
	mRTM_DELNEIGH
,

45 
	#RTM_DELNEIGH
 
RTM_DELNEIGH


	)

46 
	mRTM_GETNEIGH
,

47 
	#RTM_GETNEIGH
 
RTM_GETNEIGH


	)

49 
	mRTM_NEWRULE
 = 32,

50 
	#RTM_NEWRULE
 
RTM_NEWRULE


	)

51 
	mRTM_DELRULE
,

52 
	#RTM_DELRULE
 
RTM_DELRULE


	)

53 
	mRTM_GETRULE
,

54 
	#RTM_GETRULE
 
RTM_GETRULE


	)

56 
	mRTM_NEWQDISC
 = 36,

57 
	#RTM_NEWQDISC
 
RTM_NEWQDISC


	)

58 
	mRTM_DELQDISC
,

59 
	#RTM_DELQDISC
 
RTM_DELQDISC


	)

60 
	mRTM_GETQDISC
,

61 
	#RTM_GETQDISC
 
RTM_GETQDISC


	)

63 
	mRTM_NEWTCLASS
 = 40,

64 
	#RTM_NEWTCLASS
 
RTM_NEWTCLASS


	)

65 
	mRTM_DELTCLASS
,

66 
	#RTM_DELTCLASS
 
RTM_DELTCLASS


	)

67 
	mRTM_GETTCLASS
,

68 
	#RTM_GETTCLASS
 
RTM_GETTCLASS


	)

70 
	mRTM_NEWTFILTER
 = 44,

71 
	#RTM_NEWTFILTER
 
RTM_NEWTFILTER


	)

72 
	mRTM_DELTFILTER
,

73 
	#RTM_DELTFILTER
 
RTM_DELTFILTER


	)

74 
	mRTM_GETTFILTER
,

75 
	#RTM_GETTFILTER
 
RTM_GETTFILTER


	)

77 
	mRTM_NEWACTION
 = 48,

78 
	#RTM_NEWACTION
 
RTM_NEWACTION


	)

79 
	mRTM_DELACTION
,

80 
	#RTM_DELACTION
 
RTM_DELACTION


	)

81 
	mRTM_GETACTION
,

82 
	#RTM_GETACTION
 
RTM_GETACTION


	)

84 
	mRTM_NEWPREFIX
 = 52,

85 
	#RTM_NEWPREFIX
 
RTM_NEWPREFIX


	)

87 
	mRTM_GETMULTICAST
 = 58,

88 
	#RTM_GETMULTICAST
 
RTM_GETMULTICAST


	)

90 
	mRTM_GETANYCAST
 = 62,

91 
	#RTM_GETANYCAST
 
RTM_GETANYCAST


	)

93 
	mRTM_NEWNEIGHTBL
 = 64,

94 
	#RTM_NEWNEIGHTBL
 
RTM_NEWNEIGHTBL


	)

95 
	mRTM_GETNEIGHTBL
 = 66,

96 
	#RTM_GETNEIGHTBL
 
RTM_GETNEIGHTBL


	)

97 
	mRTM_SETNEIGHTBL
,

98 
	#RTM_SETNEIGHTBL
 
RTM_SETNEIGHTBL


	)

100 
	mRTM_NEWNDUSEROPT
 = 68,

101 
	#RTM_NEWNDUSEROPT
 
RTM_NEWNDUSEROPT


	)

103 
	m__RTM_MAX
,

104 
	#RTM_MAX
 (((
__RTM_MAX
 + 3è& ~3è- 1)

	)

107 
	#RTM_NR_MSGTYPES
 (
RTM_MAX
 + 1 - 
RTM_BASE
)

	)

108 
	#RTM_NR_FAMILIES
 (
RTM_NR_MSGTYPES
 >> 2)

	)

109 
	#RTM_FAM
(
cmd
è(((cmdè- 
RTM_BASE
è>> 2)

	)

117 
	s¹©Œ


119 
	m¹a_Ën
;

120 
	m¹a_ty³
;

125 
	#RTA_ALIGNTO
 4

	)

126 
	#RTA_ALIGN
(
Ën
èĞ(Ö’)+
RTA_ALIGNTO
-1è& ~(RTA_ALIGNTO-1è)

	)

127 
	#RTA_OK
(
¹a
,
Ën
è(Ö’è>ğ()(
¹©Œ
) && \

128 (
¹a
)->
¹a_Ën
 >ğ(
¹©Œ
) && \

129 (
¹a
)->
¹a_Ën
 <ğ(
Ën
))

	)

130 
	#RTA_NEXT
(
¹a
,
©ŒËn
è(×‰¾’è-ğ
	`RTA_ALIGN
(Ô)->
¹a_Ën
), \

131 (
¹©Œ
*)(((*)(
¹a
)è+ 
	`RTA_ALIGN
(Ô)->
¹a_Ën
)))

	)

132 
	#RTA_LENGTH
(
Ën
è(
	`RTA_ALIGN
((
¹©Œ
)è+ (Ën))

	)

133 
	#RTA_SPACE
(
Ën
è
	`RTA_ALIGN
(
	`RTA_LENGTH
Ö’))

	)

134 
	#RTA_DATA
(
¹a
è((*)(((*)Ô)è+ 
	`RTA_LENGTH
(0)))

	)

135 
	#RTA_PAYLOAD
(
¹a
è(()(Ô)->
¹a_Ën
è- 
	`RTA_LENGTH
(0))

	)

144 
	s¹msg


146 
	m¹m_çmy
;

147 
	m¹m_d¡_Ën
;

148 
	m¹m_¤c_Ën
;

149 
	m¹m_tos
;

151 
	m¹m_bË
;

152 
	m¹m_´ÙocŞ
;

153 
	m¹m_scİe
;

154 
	m¹m_ty³
;

156 
	m¹m_æags
;

163 
	mRTN_UNSPEC
,

164 
	mRTN_UNICAST
,

165 
	mRTN_LOCAL
,

166 
	mRTN_BROADCAST
,

168 
	mRTN_ANYCAST
,

170 
	mRTN_MULTICAST
,

171 
	mRTN_BLACKHOLE
,

172 
	mRTN_UNREACHABLE
,

173 
	mRTN_PROHIBIT
,

174 
	mRTN_THROW
,

175 
	mRTN_NAT
,

176 
	mRTN_XRESOLVE
,

177 
	m__RTN_MAX


180 
	#RTN_MAX
 (
__RTN_MAX
 - 1)

	)

185 
	#RTPROT_UNSPEC
 0

	)

186 
	#RTPROT_REDIRECT
 1

	)

188 
	#RTPROT_KERNEL
 2

	)

189 
	#RTPROT_BOOT
 3

	)

190 
	#RTPROT_STATIC
 4

	)

199 
	#RTPROT_GATED
 8

	)

200 
	#RTPROT_RA
 9

	)

201 
	#RTPROT_MRT
 10

	)

202 
	#RTPROT_ZEBRA
 11

	)

203 
	#RTPROT_BIRD
 12

	)

204 
	#RTPROT_DNROUTED
 13

	)

205 
	#RTPROT_XORP
 14

	)

206 
	#RTPROT_NTK
 15

	)

219 
	e¹_scİe_t


221 
	mRT_SCOPE_UNIVERSE
=0,

223 
	mRT_SCOPE_SITE
=200,

224 
	mRT_SCOPE_LINK
=253,

225 
	mRT_SCOPE_HOST
=254,

226 
	mRT_SCOPE_NOWHERE
=255

231 
	#RTM_F_NOTIFY
 0x100

	)

232 
	#RTM_F_CLONED
 0x200

	)

233 
	#RTM_F_EQUALIZE
 0x400

	)

234 
	#RTM_F_PREFIX
 0x800

	)

238 
	e¹_şass_t


240 
	mRT_TABLE_UNSPEC
=0,

242 
	mRT_TABLE_DEFAULT
=253,

243 
	mRT_TABLE_MAIN
=254,

244 
	mRT_TABLE_LOCAL
=255,

245 
	mRT_TABLE_MAX
=0xFFFFFFFF

251 
	e¹©Œ_ty³_t


253 
	mRTA_UNSPEC
,

254 
	mRTA_DST
,

255 
	mRTA_SRC
,

256 
	mRTA_IIF
,

257 
	mRTA_OIF
,

258 
	mRTA_GATEWAY
,

259 
	mRTA_PRIORITY
,

260 
	mRTA_PREFSRC
,

261 
	mRTA_METRICS
,

262 
	mRTA_MULTIPATH
,

263 
	mRTA_PROTOINFO
,

264 
	mRTA_FLOW
,

265 
	mRTA_CACHEINFO
,

266 
	mRTA_SESSION
,

267 
	mRTA_MP_ALGO
,

268 
	mRTA_TABLE
,

269 
	m__RTA_MAX


272 
	#RTA_MAX
 (
__RTA_MAX
 - 1)

	)

274 
	#RTM_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
¹msg
))))

	)

275 
	#RTM_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
¹msg
))

	)

286 
	s¹Ãxthİ


288 
	m¹nh_Ën
;

289 
	m¹nh_æags
;

290 
	m¹nh_hİs
;

291 
	m¹nh_ifšdex
;

296 
	#RTNH_F_DEAD
 1

	)

297 
	#RTNH_F_PERVASIVE
 2

	)

298 
	#RTNH_F_ONLINK
 4

	)

302 
	#RTNH_ALIGNTO
 4

	)

303 
	#RTNH_ALIGN
(
Ën
èĞ(Ö’)+
RTNH_ALIGNTO
-1è& ~(RTNH_ALIGNTO-1è)

	)

304 
	#RTNH_OK
(
¹nh
,
Ën
è(ÔŠh)->
¹nh_Ën
 >ğ(
¹Ãxthİ
) && \

305 (()(
¹nh
)->
¹nh_Ën
è<ğ(
Ën
))

	)

306 
	#RTNH_NEXT
(
¹nh
è((
¹Ãxthİ
*)(((*)ÔŠh)è+ 
	`RTNH_ALIGN
(ÔŠh)->
¹nh_Ën
)))

	)

307 
	#RTNH_LENGTH
(
Ën
è(
	`RTNH_ALIGN
((
¹Ãxthİ
)è+ (Ën))

	)

308 
	#RTNH_SPACE
(
Ën
è
	`RTNH_ALIGN
(
	`RTNH_LENGTH
Ö’))

	)

309 
	#RTNH_DATA
(
¹nh
è((
¹©Œ
*)(((*)ÔŠh)è+ 
	`RTNH_LENGTH
(0)))

	)

313 
	s¹a_ÿchešfo


315 
__u32
 
	m¹a_şÁ»f
;

316 
__u32
 
	m¹a_Ï¡u£
;

317 
__s32
 
	m¹a_expœes
;

318 
__u32
 
	m¹a_”rÜ
;

319 
__u32
 
	m¹a_u£d
;

321 
	#RTNETLINK_HAVE_PEERINFO
 1

	)

322 
__u32
 
	m¹a_id
;

323 
__u32
 
	m¹a_ts
;

324 
__u32
 
	m¹a_t§ge
;

331 
	mRTAX_UNSPEC
,

332 
	#RTAX_UNSPEC
 
RTAX_UNSPEC


	)

333 
	mRTAX_LOCK
,

334 
	#RTAX_LOCK
 
RTAX_LOCK


	)

335 
	mRTAX_MTU
,

336 
	#RTAX_MTU
 
RTAX_MTU


	)

337 
	mRTAX_WINDOW
,

338 
	#RTAX_WINDOW
 
RTAX_WINDOW


	)

339 
	mRTAX_RTT
,

340 
	#RTAX_RTT
 
RTAX_RTT


	)

341 
	mRTAX_RTTVAR
,

342 
	#RTAX_RTTVAR
 
RTAX_RTTVAR


	)

343 
	mRTAX_SSTHRESH
,

344 
	#RTAX_SSTHRESH
 
RTAX_SSTHRESH


	)

345 
	mRTAX_CWND
,

346 
	#RTAX_CWND
 
RTAX_CWND


	)

347 
	mRTAX_ADVMSS
,

348 
	#RTAX_ADVMSS
 
RTAX_ADVMSS


	)

349 
	mRTAX_REORDERING
,

350 
	#RTAX_REORDERING
 
RTAX_REORDERING


	)

351 
	mRTAX_HOPLIMIT
,

352 
	#RTAX_HOPLIMIT
 
RTAX_HOPLIMIT


	)

353 
	mRTAX_INITCWND
,

354 
	#RTAX_INITCWND
 
RTAX_INITCWND


	)

355 
	mRTAX_FEATURES
,

356 
	#RTAX_FEATURES
 
RTAX_FEATURES


	)

357 
	mRTAX_RTO_MIN
,

358 
	#RTAX_RTO_MIN
 
RTAX_RTO_MIN


	)

359 
	m__RTAX_MAX


362 
	#RTAX_MAX
 (
__RTAX_MAX
 - 1)

	)

364 
	#RTAX_FEATURE_ECN
 0x00000001

	)

365 
	#RTAX_FEATURE_SACK
 0x00000002

	)

366 
	#RTAX_FEATURE_TIMESTAMP
 0x00000004

	)

367 
	#RTAX_FEATURE_ALLFRAG
 0x00000008

	)

369 
	s¹a_£ssiÚ


371 
__u8
 
	m´Ùo
;

372 
__u8
 
	m·d1
;

373 
__u16
 
	m·d2
;

377 
__u16
 
	m¥Üt
;

378 
__u16
 
	mdpÜt
;

379 } 
	mpÜts
;

382 
__u8
 
	mty³
;

383 
__u8
 
	mcode
;

384 
__u16
 
	mid’t
;

385 } 
	micm±
;

387 
__u32
 
	m¥i
;

388 } 
	mu
;

395 
	s¹g’msg


397 
	m¹g’_çmy
;

409 
	sifšfomsg


411 
	mifi_çmy
;

412 
	m__ifi_·d
;

413 
	mifi_ty³
;

414 
	mifi_šdex
;

415 
	mifi_æags
;

416 
	mifi_chªge
;

423 
	s´efixmsg


425 
	m´efix_çmy
;

426 
	m´efix_·d1
;

427 
	m´efix_·d2
;

428 
	m´efix_ifšdex
;

429 
	m´efix_ty³
;

430 
	m´efix_Ën
;

431 
	m´efix_æags
;

432 
	m´efix_·d3
;

437 
	mPREFIX_UNSPEC
,

438 
	mPREFIX_ADDRESS
,

439 
	mPREFIX_CACHEINFO
,

440 
	m__PREFIX_MAX


443 
	#PREFIX_MAX
 (
__PREFIX_MAX
 - 1)

	)

445 
	s´efix_ÿchešfo


447 
__u32
 
	m´eã¼ed_time
;

448 
__u32
 
	mv®id_time
;

456 
	stcmsg


458 
	mtcm_çmy
;

459 
	mtcm__·d1
;

460 
	mtcm__·d2
;

461 
	mtcm_ifšdex
;

462 
__u32
 
	mtcm_hªdË
;

463 
__u32
 
	mtcm_·»Á
;

464 
__u32
 
	mtcm_šfo
;

469 
	mTCA_UNSPEC
,

470 
	mTCA_KIND
,

471 
	mTCA_OPTIONS
,

472 
	mTCA_STATS
,

473 
	mTCA_XSTATS
,

474 
	mTCA_RATE
,

475 
	mTCA_FCNT
,

476 
	mTCA_STATS2
,

477 
	m__TCA_MAX


480 
	#TCA_MAX
 (
__TCA_MAX
 - 1)

	)

482 
	#TCA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tcmsg
))))

	)

483 
	#TCA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tcmsg
))

	)

489 
	sndu£rİtmsg


491 
	mndu£rİt_çmy
;

492 
	mndu£rİt_·d1
;

493 
	mndu£rİt_İts_Ën
;

494 
	mndu£rİt_ifšdex
;

495 
__u8
 
	mndu£rİt_icmp_ty³
;

496 
__u8
 
	mndu£rİt_icmp_code
;

497 
	mndu£rİt_·d2
;

498 
	mndu£rİt_·d3
;

504 
	mNDUSEROPT_UNSPEC
,

505 
	mNDUSEROPT_SRCADDR
,

506 
	m__NDUSEROPT_MAX


509 
	#NDUSEROPT_MAX
 (
__NDUSEROPT_MAX
 - 1)

	)

512 
	#RTMGRP_LINK
 1

	)

513 
	#RTMGRP_NOTIFY
 2

	)

514 
	#RTMGRP_NEIGH
 4

	)

515 
	#RTMGRP_TC
 8

	)

517 
	#RTMGRP_IPV4_IFADDR
 0x10

	)

518 
	#RTMGRP_IPV4_MROUTE
 0x20

	)

519 
	#RTMGRP_IPV4_ROUTE
 0x40

	)

520 
	#RTMGRP_IPV4_RULE
 0x80

	)

522 
	#RTMGRP_IPV6_IFADDR
 0x100

	)

523 
	#RTMGRP_IPV6_MROUTE
 0x200

	)

524 
	#RTMGRP_IPV6_ROUTE
 0x400

	)

525 
	#RTMGRP_IPV6_IFINFO
 0x800

	)

527 
	#RTMGRP_DECÃt_IFADDR
 0x1000

	)

528 
	#RTMGRP_DECÃt_ROUTE
 0x4000

	)

530 
	#RTMGRP_IPV6_PREFIX
 0x20000

	)

533 
	e¹Ãšk_groups
 {

534 
	mRTNLGRP_NONE
,

535 
	#RTNLGRP_NONE
 
RTNLGRP_NONE


	)

536 
	mRTNLGRP_LINK
,

537 
	#RTNLGRP_LINK
 
RTNLGRP_LINK


	)

538 
	mRTNLGRP_NOTIFY
,

539 
	#RTNLGRP_NOTIFY
 
RTNLGRP_NOTIFY


	)

540 
	mRTNLGRP_NEIGH
,

541 
	#RTNLGRP_NEIGH
 
RTNLGRP_NEIGH


	)

542 
	mRTNLGRP_TC
,

543 
	#RTNLGRP_TC
 
RTNLGRP_TC


	)

544 
	mRTNLGRP_IPV4_IFADDR
,

545 
	#RTNLGRP_IPV4_IFADDR
 
RTNLGRP_IPV4_IFADDR


	)

546 
	mRTNLGRP_IPV4_MROUTE
,

547 
	#RTNLGRP_IPV4_MROUTE
 
RTNLGRP_IPV4_MROUTE


	)

548 
	mRTNLGRP_IPV4_ROUTE
,

549 
	#RTNLGRP_IPV4_ROUTE
 
RTNLGRP_IPV4_ROUTE


	)

550 
	mRTNLGRP_IPV4_RULE
,

551 
	#RTNLGRP_IPV4_RULE
 
RTNLGRP_IPV4_RULE


	)

552 
	mRTNLGRP_IPV6_IFADDR
,

553 
	#RTNLGRP_IPV6_IFADDR
 
RTNLGRP_IPV6_IFADDR


	)

554 
	mRTNLGRP_IPV6_MROUTE
,

555 
	#RTNLGRP_IPV6_MROUTE
 
RTNLGRP_IPV6_MROUTE


	)

556 
	mRTNLGRP_IPV6_ROUTE
,

557 
	#RTNLGRP_IPV6_ROUTE
 
RTNLGRP_IPV6_ROUTE


	)

558 
	mRTNLGRP_IPV6_IFINFO
,

559 
	#RTNLGRP_IPV6_IFINFO
 
RTNLGRP_IPV6_IFINFO


	)

560 
	mRTNLGRP_DECÃt_IFADDR
,

561 
	#RTNLGRP_DECÃt_IFADDR
 
RTNLGRP_DECÃt_IFADDR


	)

562 
	mRTNLGRP_NOP2
,

563 
	mRTNLGRP_DECÃt_ROUTE
,

564 
	#RTNLGRP_DECÃt_ROUTE
 
RTNLGRP_DECÃt_ROUTE


	)

565 
	mRTNLGRP_DECÃt_RULE
,

566 
	#RTNLGRP_DECÃt_RULE
 
RTNLGRP_DECÃt_RULE


	)

567 
	mRTNLGRP_NOP4
,

568 
	mRTNLGRP_IPV6_PREFIX
,

569 
	#RTNLGRP_IPV6_PREFIX
 
RTNLGRP_IPV6_PREFIX


	)

570 
	mRTNLGRP_IPV6_RULE
,

571 
	#RTNLGRP_IPV6_RULE
 
RTNLGRP_IPV6_RULE


	)

572 
	mRTNLGRP_ND_USEROPT
,

573 
	#RTNLGRP_ND_USEROPT
 
RTNLGRP_ND_USEROPT


	)

574 
	m__RTNLGRP_MAX


576 
	#RTNLGRP_MAX
 (
__RTNLGRP_MAX
 - 1)

	)

579 
	stÿmsg


581 
	mtÿ_çmy
;

582 
	mtÿ__·d1
;

583 
	mtÿ__·d2
;

585 
	#TA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tÿmsg
))))

	)

586 
	#TA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tÿmsg
))

	)

587 
	#TCA_ACT_TAB
 1

	)

588 
	#TCAA_MAX
 1

	)

	@/usr/include/linux/sysctl.h

25 #iâdeà
_LINUX_SYSCTL_H


26 
	#_LINUX_SYSCTL_H


	)

28 
	~<lšux/k”Ãl.h
>

29 
	~<lšux/ty³s.h
>

31 
	gfe
;

32 
	gcom¶‘iÚ
;

34 
	#CTL_MAXNAME
 10

	)

39 
	s__sysùl_¬gs
 {

40 *
	mÇme
;

41 
	mÆ’
;

42 *
	mŞdv®
;

43 
size_t
 *
	mŞdËÅ
;

44 *
	mÃwv®
;

45 
size_t
 
	mÃwËn
;

46 
	m__unu£d
[4];

57 
	mCTL_KERN
=1,

58 
	mCTL_VM
=2,

59 
	mCTL_NET
=3,

60 
	mCTL_PROC
=4,

61 
	mCTL_FS
=5,

62 
	mCTL_DEBUG
=6,

63 
	mCTL_DEV
=7,

64 
	mCTL_BUS
=8,

65 
	mCTL_ABI
=9,

66 
	mCTL_CPU
=10,

67 
	mCTL_ARLAN
=254,

68 
	mCTL_S390DBF
=5677,

69 
	mCTL_SUNRPC
=7249,

70 
	mCTL_PM
=9899,

71 
	mCTL_FRV
=9898,

77 
	mCTL_BUS_ISA
=1

83 
	mINOTIFY_MAX_USER_INSTANCES
=1,

84 
	mINOTIFY_MAX_USER_WATCHES
=2,

85 
	mINOTIFY_MAX_QUEUED_EVENTS
=3

91 
	mKERN_OSTYPE
=1,

92 
	mKERN_OSRELEASE
=2,

93 
	mKERN_OSREV
=3,

94 
	mKERN_VERSION
=4,

95 
	mKERN_SECUREMASK
=5,

96 
	mKERN_PROF
=6,

97 
	mKERN_NODENAME
=7,

98 
	mKERN_DOMAINNAME
=8,

100 
	mKERN_CAP_BSET
=14,

101 
	mKERN_PANIC
=15,

102 
	mKERN_REALROOTDEV
=16,

104 
	mKERN_SPARC_REBOOT
=21,

105 
	mKERN_CTLALTDEL
=22,

106 
	mKERN_PRINTK
=23,

107 
	mKERN_NAMETRANS
=24,

108 
	mKERN_PPC_HTABRECLAIM
=25,

109 
	mKERN_PPC_ZEROPAGED
=26,

110 
	mKERN_PPC_POWERSAVE_NAP
=27,

111 
	mKERN_MODPROBE
=28,

112 
	mKERN_SG_BIG_BUFF
=29,

113 
	mKERN_ACCT
=30,

114 
	mKERN_PPC_L2CR
=31,

116 
	mKERN_RTSIGNR
=32,

117 
	mKERN_RTSIGMAX
=33,

119 
	mKERN_SHMMAX
=34,

120 
	mKERN_MSGMAX
=35,

121 
	mKERN_MSGMNB
=36,

122 
	mKERN_MSGPOOL
=37,

123 
	mKERN_SYSRQ
=38,

124 
	mKERN_MAX_THREADS
=39,

125 
	mKERN_RANDOM
=40,

126 
	mKERN_SHMALL
=41,

127 
	mKERN_MSGMNI
=42,

128 
	mKERN_SEM
=43,

129 
	mKERN_SPARC_STOP_A
=44,

130 
	mKERN_SHMMNI
=45,

131 
	mKERN_OVERFLOWUID
=46,

132 
	mKERN_OVERFLOWGID
=47,

133 
	mKERN_SHMPATH
=48,

134 
	mKERN_HOTPLUG
=49,

135 
	mKERN_IEEE_EMULATION_WARNINGS
=50,

136 
	mKERN_S390_USER_DEBUG_LOGGING
=51,

137 
	mKERN_CORE_USES_PID
=52,

138 
	mKERN_TAINTED
=53,

139 
	mKERN_CADPID
=54,

140 
	mKERN_PIDMAX
=55,

141 
	mKERN_CORE_PATTERN
=56,

142 
	mKERN_PANIC_ON_OOPS
=57,

143 
	mKERN_HPPA_PWRSW
=58,

144 
	mKERN_HPPA_UNALIGNED
=59,

145 
	mKERN_PRINTK_RATELIMIT
=60,

146 
	mKERN_PRINTK_RATELIMIT_BURST
=61,

147 
	mKERN_PTY
=62,

148 
	mKERN_NGROUPS_MAX
=63,

149 
	mKERN_SPARC_SCONS_PWROFF
=64,

150 
	mKERN_HZ_TIMER
=65,

151 
	mKERN_UNKNOWN_NMI_PANIC
=66,

152 
	mKERN_BOOTLOADER_TYPE
=67,

153 
	mKERN_RANDOMIZE
=68,

154 
	mKERN_SETUID_DUMPABLE
=69,

155 
	mKERN_SPIN_RETRY
=70,

156 
	mKERN_ACPI_VIDEO_FLAGS
=71,

157 
	mKERN_IA64_UNALIGNED
=72,

158 
	mKERN_COMPAT_LOG
=73,

159 
	mKERN_MAX_LOCK_DEPTH
=74,

160 
	mKERN_NMI_WATCHDOG
=75,

161 
	mKERN_PANIC_ON_NMI
=76,

169 
	mVM_UNUSED1
=1,

170 
	mVM_UNUSED2
=2,

171 
	mVM_UNUSED3
=3,

172 
	mVM_UNUSED4
=4,

173 
	mVM_OVERCOMMIT_MEMORY
=5,

174 
	mVM_UNUSED5
=6,

175 
	mVM_UNUSED7
=7,

176 
	mVM_UNUSED8
=8,

177 
	mVM_UNUSED9
=9,

178 
	mVM_PAGE_CLUSTER
=10,

179 
	mVM_DIRTY_BACKGROUND
=11,

180 
	mVM_DIRTY_RATIO
=12,

181 
	mVM_DIRTY_WB_CS
=13,

182 
	mVM_DIRTY_EXPIRE_CS
=14,

183 
	mVM_NR_PDFLUSH_THREADS
=15,

184 
	mVM_OVERCOMMIT_RATIO
=16,

185 
	mVM_PAGEBUF
=17,

186 
	mVM_HUGETLB_PAGES
=18,

187 
	mVM_SWAPPINESS
=19,

188 
	mVM_LOWMEM_RESERVE_RATIO
=20,

189 
	mVM_MIN_FREE_KBYTES
=21,

190 
	mVM_MAX_MAP_COUNT
=22,

191 
	mVM_LAPTOP_MODE
=23,

192 
	mVM_BLOCK_DUMP
=24,

193 
	mVM_HUGETLB_GROUP
=25,

194 
	mVM_VFS_CACHE_PRESSURE
=26,

195 
	mVM_LEGACY_VA_LAYOUT
=27,

196 
	mVM_SWAP_TOKEN_TIMEOUT
=28,

197 
	mVM_DROP_PAGECACHE
=29,

198 
	mVM_PERCPU_PAGELIST_FRACTION
=30,

199 
	mVM_ZONE_RECLAIM_MODE
=31,

200 
	mVM_MIN_UNMAPPED
=32,

201 
	mVM_PANIC_ON_OOM
=33,

202 
	mVM_VDSO_ENABLED
=34,

203 
	mVM_MIN_SLAB
=35,

210 
	mNET_CORE
=1,

211 
	mNET_ETHER
=2,

212 
	mNET_802
=3,

213 
	mNET_UNIX
=4,

214 
	mNET_IPV4
=5,

215 
	mNET_IPX
=6,

216 
	mNET_ATALK
=7,

217 
	mNET_NETROM
=8,

218 
	mNET_AX25
=9,

219 
	mNET_BRIDGE
=10,

220 
	mNET_ROSE
=11,

221 
	mNET_IPV6
=12,

222 
	mNET_X25
=13,

223 
	mNET_TR
=14,

224 
	mNET_DECNET
=15,

225 
	mNET_ECONET
=16,

226 
	mNET_SCTP
=17,

227 
	mNET_LLC
=18,

228 
	mNET_NETFILTER
=19,

229 
	mNET_DCCP
=20,

230 
	mNET_IRDA
=412,

236 
	mRANDOM_POOLSIZE
=1,

237 
	mRANDOM_ENTROPY_COUNT
=2,

238 
	mRANDOM_READ_THRESH
=3,

239 
	mRANDOM_WRITE_THRESH
=4,

240 
	mRANDOM_BOOT_ID
=5,

241 
	mRANDOM_UUID
=6

247 
	mPTY_MAX
=1,

248 
	mPTY_NR
=2

254 
	mBUS_ISA_MEM_BASE
=1,

255 
	mBUS_ISA_PORT_BASE
=2,

256 
	mBUS_ISA_PORT_SHIFT
=3

262 
	mNET_CORE_WMEM_MAX
=1,

263 
	mNET_CORE_RMEM_MAX
=2,

264 
	mNET_CORE_WMEM_DEFAULT
=3,

265 
	mNET_CORE_RMEM_DEFAULT
=4,

267 
	mNET_CORE_MAX_BACKLOG
=6,

268 
	mNET_CORE_FASTROUTE
=7,

269 
	mNET_CORE_MSG_COST
=8,

270 
	mNET_CORE_MSG_BURST
=9,

271 
	mNET_CORE_OPTMEM_MAX
=10,

272 
	mNET_CORE_HOT_LIST_LENGTH
=11,

273 
	mNET_CORE_DIVERT_VERSION
=12,

274 
	mNET_CORE_NO_CONG_THRESH
=13,

275 
	mNET_CORE_NO_CONG
=14,

276 
	mNET_CORE_LO_CONG
=15,

277 
	mNET_CORE_MOD_CONG
=16,

278 
	mNET_CORE_DEV_WEIGHT
=17,

279 
	mNET_CORE_SOMAXCONN
=18,

280 
	mNET_CORE_BUDGET
=19,

281 
	mNET_CORE_AEVENT_ETIME
=20,

282 
	mNET_CORE_AEVENT_RSEQTH
=21,

283 
	mNET_CORE_WARNINGS
=22,

294 
	mNET_UNIX_DESTROY_DELAY
=1,

295 
	mNET_UNIX_DELETE_DELAY
=2,

296 
	mNET_UNIX_MAX_DGRAM_QLEN
=3,

302 
	mNET_NF_CONNTRACK_MAX
=1,

303 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

304 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

305 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

306 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

307 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

308 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

309 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

310 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

311 
	mNET_NF_CONNTRACK_UDP_TIMEOUT
=10,

312 
	mNET_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

313 
	mNET_NF_CONNTRACK_ICMP_TIMEOUT
=12,

314 
	mNET_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

315 
	mNET_NF_CONNTRACK_BUCKETS
=14,

316 
	mNET_NF_CONNTRACK_LOG_INVALID
=15,

317 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

318 
	mNET_NF_CONNTRACK_TCP_LOOSE
=17,

319 
	mNET_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

320 
	mNET_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

321 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

322 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

323 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

324 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

325 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

326 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

327 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

328 
	mNET_NF_CONNTRACK_COUNT
=27,

329 
	mNET_NF_CONNTRACK_ICMPV6_TIMEOUT
=28,

330 
	mNET_NF_CONNTRACK_FRAG6_TIMEOUT
=29,

331 
	mNET_NF_CONNTRACK_FRAG6_LOW_THRESH
=30,

332 
	mNET_NF_CONNTRACK_FRAG6_HIGH_THRESH
=31,

333 
	mNET_NF_CONNTRACK_CHECKSUM
=32,

340 
	mNET_IPV4_FORWARD
=8,

341 
	mNET_IPV4_DYNADDR
=9,

343 
	mNET_IPV4_CONF
=16,

344 
	mNET_IPV4_NEIGH
=17,

345 
	mNET_IPV4_ROUTE
=18,

346 
	mNET_IPV4_FIB_HASH
=19,

347 
	mNET_IPV4_NETFILTER
=20,

349 
	mNET_IPV4_TCP_TIMESTAMPS
=33,

350 
	mNET_IPV4_TCP_WINDOW_SCALING
=34,

351 
	mNET_IPV4_TCP_SACK
=35,

352 
	mNET_IPV4_TCP_RETRANS_COLLAPSE
=36,

353 
	mNET_IPV4_DEFAULT_TTL
=37,

354 
	mNET_IPV4_AUTOCONFIG
=38,

355 
	mNET_IPV4_NO_PMTU_DISC
=39,

356 
	mNET_IPV4_TCP_SYN_RETRIES
=40,

357 
	mNET_IPV4_IPFRAG_HIGH_THRESH
=41,

358 
	mNET_IPV4_IPFRAG_LOW_THRESH
=42,

359 
	mNET_IPV4_IPFRAG_TIME
=43,

360 
	mNET_IPV4_TCP_MAX_KA_PROBES
=44,

361 
	mNET_IPV4_TCP_KEEPALIVE_TIME
=45,

362 
	mNET_IPV4_TCP_KEEPALIVE_PROBES
=46,

363 
	mNET_IPV4_TCP_RETRIES1
=47,

364 
	mNET_IPV4_TCP_RETRIES2
=48,

365 
	mNET_IPV4_TCP_FIN_TIMEOUT
=49,

366 
	mNET_IPV4_IP_MASQ_DEBUG
=50,

367 
	mNET_TCP_SYNCOOKIES
=51,

368 
	mNET_TCP_STDURG
=52,

369 
	mNET_TCP_RFC1337
=53,

370 
	mNET_TCP_SYN_TAILDROP
=54,

371 
	mNET_TCP_MAX_SYN_BACKLOG
=55,

372 
	mNET_IPV4_LOCAL_PORT_RANGE
=56,

373 
	mNET_IPV4_ICMP_ECHO_IGNORE_ALL
=57,

374 
	mNET_IPV4_ICMP_ECHO_IGNORE_BROADCASTS
=58,

375 
	mNET_IPV4_ICMP_SOURCEQUENCH_RATE
=59,

376 
	mNET_IPV4_ICMP_DESTUNREACH_RATE
=60,

377 
	mNET_IPV4_ICMP_TIMEEXCEED_RATE
=61,

378 
	mNET_IPV4_ICMP_PARAMPROB_RATE
=62,

379 
	mNET_IPV4_ICMP_ECHOREPLY_RATE
=63,

380 
	mNET_IPV4_ICMP_IGNORE_BOGUS_ERROR_RESPONSES
=64,

381 
	mNET_IPV4_IGMP_MAX_MEMBERSHIPS
=65,

382 
	mNET_TCP_TW_RECYCLE
=66,

383 
	mNET_IPV4_ALWAYS_DEFRAG
=67,

384 
	mNET_IPV4_TCP_KEEPALIVE_INTVL
=68,

385 
	mNET_IPV4_INET_PEER_THRESHOLD
=69,

386 
	mNET_IPV4_INET_PEER_MINTTL
=70,

387 
	mNET_IPV4_INET_PEER_MAXTTL
=71,

388 
	mNET_IPV4_INET_PEER_GC_MINTIME
=72,

389 
	mNET_IPV4_INET_PEER_GC_MAXTIME
=73,

390 
	mNET_TCP_ORPHAN_RETRIES
=74,

391 
	mNET_TCP_ABORT_ON_OVERFLOW
=75,

392 
	mNET_TCP_SYNACK_RETRIES
=76,

393 
	mNET_TCP_MAX_ORPHANS
=77,

394 
	mNET_TCP_MAX_TW_BUCKETS
=78,

395 
	mNET_TCP_FACK
=79,

396 
	mNET_TCP_REORDERING
=80,

397 
	mNET_TCP_ECN
=81,

398 
	mNET_TCP_DSACK
=82,

399 
	mNET_TCP_MEM
=83,

400 
	mNET_TCP_WMEM
=84,

401 
	mNET_TCP_RMEM
=85,

402 
	mNET_TCP_APP_WIN
=86,

403 
	mNET_TCP_ADV_WIN_SCALE
=87,

404 
	mNET_IPV4_NONLOCAL_BIND
=88,

405 
	mNET_IPV4_ICMP_RATELIMIT
=89,

406 
	mNET_IPV4_ICMP_RATEMASK
=90,

407 
	mNET_TCP_TW_REUSE
=91,

408 
	mNET_TCP_FRTO
=92,

409 
	mNET_TCP_LOW_LATENCY
=93,

410 
	mNET_IPV4_IPFRAG_SECRET_INTERVAL
=94,

411 
	mNET_IPV4_IGMP_MAX_MSF
=96,

412 
	mNET_TCP_NO_METRICS_SAVE
=97,

413 
	mNET_TCP_DEFAULT_WIN_SCALE
=105,

414 
	mNET_TCP_MODERATE_RCVBUF
=106,

415 
	mNET_TCP_TSO_WIN_DIVISOR
=107,

416 
	mNET_TCP_BIC_BETA
=108,

417 
	mNET_IPV4_ICMP_ERRORS_USE_INBOUND_IFADDR
=109,

418 
	mNET_TCP_CONG_CONTROL
=110,

419 
	mNET_TCP_ABC
=111,

420 
	mNET_IPV4_IPFRAG_MAX_DIST
=112,

421 
	mNET_TCP_MTU_PROBING
=113,

422 
	mNET_TCP_BASE_MSS
=114,

423 
	mNET_IPV4_TCP_WORKAROUND_SIGNED_WINDOWS
=115,

424 
	mNET_TCP_DMA_COPYBREAK
=116,

425 
	mNET_TCP_SLOW_START_AFTER_IDLE
=117,

426 
	mNET_CIPSOV4_CACHE_ENABLE
=118,

427 
	mNET_CIPSOV4_CACHE_BUCKET_SIZE
=119,

428 
	mNET_CIPSOV4_RBM_OPTFMT
=120,

429 
	mNET_CIPSOV4_RBM_STRICTVALID
=121,

430 
	mNET_TCP_AVAIL_CONG_CONTROL
=122,

431 
	mNET_TCP_ALLOWED_CONG_CONTROL
=123,

432 
	mNET_TCP_MAX_SSTHRESH
=124,

433 
	mNET_TCP_FRTO_RESPONSE
=125,

437 
	mNET_IPV4_ROUTE_FLUSH
=1,

438 
	mNET_IPV4_ROUTE_MIN_DELAY
=2,

439 
	mNET_IPV4_ROUTE_MAX_DELAY
=3,

440 
	mNET_IPV4_ROUTE_GC_THRESH
=4,

441 
	mNET_IPV4_ROUTE_MAX_SIZE
=5,

442 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL
=6,

443 
	mNET_IPV4_ROUTE_GC_TIMEOUT
=7,

444 
	mNET_IPV4_ROUTE_GC_INTERVAL
=8,

445 
	mNET_IPV4_ROUTE_REDIRECT_LOAD
=9,

446 
	mNET_IPV4_ROUTE_REDIRECT_NUMBER
=10,

447 
	mNET_IPV4_ROUTE_REDIRECT_SILENCE
=11,

448 
	mNET_IPV4_ROUTE_ERROR_COST
=12,

449 
	mNET_IPV4_ROUTE_ERROR_BURST
=13,

450 
	mNET_IPV4_ROUTE_GC_ELASTICITY
=14,

451 
	mNET_IPV4_ROUTE_MTU_EXPIRES
=15,

452 
	mNET_IPV4_ROUTE_MIN_PMTU
=16,

453 
	mNET_IPV4_ROUTE_MIN_ADVMSS
=17,

454 
	mNET_IPV4_ROUTE_SECRET_INTERVAL
=18,

455 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL_MS
=19,

460 
	mNET_PROTO_CONF_ALL
=-2,

461 
	mNET_PROTO_CONF_DEFAULT
=-3

468 
	mNET_IPV4_CONF_FORWARDING
=1,

469 
	mNET_IPV4_CONF_MC_FORWARDING
=2,

470 
	mNET_IPV4_CONF_PROXY_ARP
=3,

471 
	mNET_IPV4_CONF_ACCEPT_REDIRECTS
=4,

472 
	mNET_IPV4_CONF_SECURE_REDIRECTS
=5,

473 
	mNET_IPV4_CONF_SEND_REDIRECTS
=6,

474 
	mNET_IPV4_CONF_SHARED_MEDIA
=7,

475 
	mNET_IPV4_CONF_RP_FILTER
=8,

476 
	mNET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
=9,

477 
	mNET_IPV4_CONF_BOOTP_RELAY
=10,

478 
	mNET_IPV4_CONF_LOG_MARTIANS
=11,

479 
	mNET_IPV4_CONF_TAG
=12,

480 
	mNET_IPV4_CONF_ARPFILTER
=13,

481 
	mNET_IPV4_CONF_MEDIUM_ID
=14,

482 
	mNET_IPV4_CONF_NOXFRM
=15,

483 
	mNET_IPV4_CONF_NOPOLICY
=16,

484 
	mNET_IPV4_CONF_FORCE_IGMP_VERSION
=17,

485 
	mNET_IPV4_CONF_ARP_ANNOUNCE
=18,

486 
	mNET_IPV4_CONF_ARP_IGNORE
=19,

487 
	mNET_IPV4_CONF_PROMOTE_SECONDARIES
=20,

488 
	mNET_IPV4_CONF_ARP_ACCEPT
=21,

489 
	m__NET_IPV4_CONF_MAX


495 
	mNET_IPV4_NF_CONNTRACK_MAX
=1,

496 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

497 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

498 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

499 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

500 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

501 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

502 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

503 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

504 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT
=10,

505 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

506 
	mNET_IPV4_NF_CONNTRACK_ICMP_TIMEOUT
=12,

507 
	mNET_IPV4_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

508 
	mNET_IPV4_NF_CONNTRACK_BUCKETS
=14,

509 
	mNET_IPV4_NF_CONNTRACK_LOG_INVALID
=15,

510 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

511 
	mNET_IPV4_NF_CONNTRACK_TCP_LOOSE
=17,

512 
	mNET_IPV4_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

513 
	mNET_IPV4_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

514 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

515 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

516 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

517 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

518 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

519 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

520 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

521 
	mNET_IPV4_NF_CONNTRACK_COUNT
=27,

522 
	mNET_IPV4_NF_CONNTRACK_CHECKSUM
=28,

527 
	mNET_IPV6_CONF
=16,

528 
	mNET_IPV6_NEIGH
=17,

529 
	mNET_IPV6_ROUTE
=18,

530 
	mNET_IPV6_ICMP
=19,

531 
	mNET_IPV6_BINDV6ONLY
=20,

532 
	mNET_IPV6_IP6FRAG_HIGH_THRESH
=21,

533 
	mNET_IPV6_IP6FRAG_LOW_THRESH
=22,

534 
	mNET_IPV6_IP6FRAG_TIME
=23,

535 
	mNET_IPV6_IP6FRAG_SECRET_INTERVAL
=24,

536 
	mNET_IPV6_MLD_MAX_MSF
=25,

540 
	mNET_IPV6_ROUTE_FLUSH
=1,

541 
	mNET_IPV6_ROUTE_GC_THRESH
=2,

542 
	mNET_IPV6_ROUTE_MAX_SIZE
=3,

543 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL
=4,

544 
	mNET_IPV6_ROUTE_GC_TIMEOUT
=5,

545 
	mNET_IPV6_ROUTE_GC_INTERVAL
=6,

546 
	mNET_IPV6_ROUTE_GC_ELASTICITY
=7,

547 
	mNET_IPV6_ROUTE_MTU_EXPIRES
=8,

548 
	mNET_IPV6_ROUTE_MIN_ADVMSS
=9,

549 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL_MS
=10

553 
	mNET_IPV6_FORWARDING
=1,

554 
	mNET_IPV6_HOP_LIMIT
=2,

555 
	mNET_IPV6_MTU
=3,

556 
	mNET_IPV6_ACCEPT_RA
=4,

557 
	mNET_IPV6_ACCEPT_REDIRECTS
=5,

558 
	mNET_IPV6_AUTOCONF
=6,

559 
	mNET_IPV6_DAD_TRANSMITS
=7,

560 
	mNET_IPV6_RTR_SOLICITS
=8,

561 
	mNET_IPV6_RTR_SOLICIT_INTERVAL
=9,

562 
	mNET_IPV6_RTR_SOLICIT_DELAY
=10,

563 
	mNET_IPV6_USE_TEMPADDR
=11,

564 
	mNET_IPV6_TEMP_VALID_LFT
=12,

565 
	mNET_IPV6_TEMP_PREFERED_LFT
=13,

566 
	mNET_IPV6_REGEN_MAX_RETRY
=14,

567 
	mNET_IPV6_MAX_DESYNC_FACTOR
=15,

568 
	mNET_IPV6_MAX_ADDRESSES
=16,

569 
	mNET_IPV6_FORCE_MLD_VERSION
=17,

570 
	mNET_IPV6_ACCEPT_RA_DEFRTR
=18,

571 
	mNET_IPV6_ACCEPT_RA_PINFO
=19,

572 
	mNET_IPV6_ACCEPT_RA_RTR_PREF
=20,

573 
	mNET_IPV6_RTR_PROBE_INTERVAL
=21,

574 
	mNET_IPV6_ACCEPT_RA_RT_INFO_MAX_PLEN
=22,

575 
	mNET_IPV6_PROXY_NDP
=23,

576 
	mNET_IPV6_ACCEPT_SOURCE_ROUTE
=25,

577 
	m__NET_IPV6_MAX


582 
	mNET_IPV6_ICMP_RATELIMIT
=1

587 
	mNET_NEIGH_MCAST_SOLICIT
=1,

588 
	mNET_NEIGH_UCAST_SOLICIT
=2,

589 
	mNET_NEIGH_APP_SOLICIT
=3,

590 
	mNET_NEIGH_RETRANS_TIME
=4,

591 
	mNET_NEIGH_REACHABLE_TIME
=5,

592 
	mNET_NEIGH_DELAY_PROBE_TIME
=6,

593 
	mNET_NEIGH_GC_STALE_TIME
=7,

594 
	mNET_NEIGH_UNRES_QLEN
=8,

595 
	mNET_NEIGH_PROXY_QLEN
=9,

596 
	mNET_NEIGH_ANYCAST_DELAY
=10,

597 
	mNET_NEIGH_PROXY_DELAY
=11,

598 
	mNET_NEIGH_LOCKTIME
=12,

599 
	mNET_NEIGH_GC_INTERVAL
=13,

600 
	mNET_NEIGH_GC_THRESH1
=14,

601 
	mNET_NEIGH_GC_THRESH2
=15,

602 
	mNET_NEIGH_GC_THRESH3
=16,

603 
	mNET_NEIGH_RETRANS_TIME_MS
=17,

604 
	mNET_NEIGH_REACHABLE_TIME_MS
=18,

605 
	m__NET_NEIGH_MAX


610 
	mNET_DCCP_DEFAULT
=1,

615 
	mNET_IPX_PPROP_BROADCASTING
=1,

616 
	mNET_IPX_FORWARDING
=2

621 
	mNET_LLC2
=1,

622 
	mNET_LLC_STATION
=2,

627 
	mNET_LLC2_TIMEOUT
=1,

632 
	mNET_LLC_STATION_ACK_TIMEOUT
=1,

637 
	mNET_LLC2_ACK_TIMEOUT
=1,

638 
	mNET_LLC2_P_TIMEOUT
=2,

639 
	mNET_LLC2_REJ_TIMEOUT
=3,

640 
	mNET_LLC2_BUSY_TIMEOUT
=4,

645 
	mNET_ATALK_AARP_EXPIRY_TIME
=1,

646 
	mNET_ATALK_AARP_TICK_TIME
=2,

647 
	mNET_ATALK_AARP_RETRANSMIT_LIMIT
=3,

648 
	mNET_ATALK_AARP_RESOLVE_TIME
=4

654 
	mNET_NETROM_DEFAULT_PATH_QUALITY
=1,

655 
	mNET_NETROM_OBSOLESCENCE_COUNT_INITIALISER
=2,

656 
	mNET_NETROM_NETWORK_TTL_INITIALISER
=3,

657 
	mNET_NETROM_TRANSPORT_TIMEOUT
=4,

658 
	mNET_NETROM_TRANSPORT_MAXIMUM_TRIES
=5,

659 
	mNET_NETROM_TRANSPORT_ACKNOWLEDGE_DELAY
=6,

660 
	mNET_NETROM_TRANSPORT_BUSY_DELAY
=7,

661 
	mNET_NETROM_TRANSPORT_REQUESTED_WINDOW_SIZE
=8,

662 
	mNET_NETROM_TRANSPORT_NO_ACTIVITY_TIMEOUT
=9,

663 
	mNET_NETROM_ROUTING_CONTROL
=10,

664 
	mNET_NETROM_LINK_FAILS_COUNT
=11,

665 
	mNET_NETROM_RESET
=12

670 
	mNET_AX25_IP_DEFAULT_MODE
=1,

671 
	mNET_AX25_DEFAULT_MODE
=2,

672 
	mNET_AX25_BACKOFF_TYPE
=3,

673 
	mNET_AX25_CONNECT_MODE
=4,

674 
	mNET_AX25_STANDARD_WINDOW
=5,

675 
	mNET_AX25_EXTENDED_WINDOW
=6,

676 
	mNET_AX25_T1_TIMEOUT
=7,

677 
	mNET_AX25_T2_TIMEOUT
=8,

678 
	mNET_AX25_T3_TIMEOUT
=9,

679 
	mNET_AX25_IDLE_TIMEOUT
=10,

680 
	mNET_AX25_N2
=11,

681 
	mNET_AX25_PACLEN
=12,

682 
	mNET_AX25_PROTOCOL
=13,

683 
	mNET_AX25_DAMA_SLAVE_TIMEOUT
=14

688 
	mNET_ROSE_RESTART_REQUEST_TIMEOUT
=1,

689 
	mNET_ROSE_CALL_REQUEST_TIMEOUT
=2,

690 
	mNET_ROSE_RESET_REQUEST_TIMEOUT
=3,

691 
	mNET_ROSE_CLEAR_REQUEST_TIMEOUT
=4,

692 
	mNET_ROSE_ACK_HOLD_BACK_TIMEOUT
=5,

693 
	mNET_ROSE_ROUTING_CONTROL
=6,

694 
	mNET_ROSE_LINK_FAIL_TIMEOUT
=7,

695 
	mNET_ROSE_MAX_VCS
=8,

696 
	mNET_ROSE_WINDOW_SIZE
=9,

697 
	mNET_ROSE_NO_ACTIVITY_TIMEOUT
=10

702 
	mNET_X25_RESTART_REQUEST_TIMEOUT
=1,

703 
	mNET_X25_CALL_REQUEST_TIMEOUT
=2,

704 
	mNET_X25_RESET_REQUEST_TIMEOUT
=3,

705 
	mNET_X25_CLEAR_REQUEST_TIMEOUT
=4,

706 
	mNET_X25_ACK_HOLD_BACK_TIMEOUT
=5,

707 
	mNET_X25_FORWARD
=6

713 
	mNET_TR_RIF_TIMEOUT
=1

718 
	mNET_DECNET_NODE_TYPE
 = 1,

719 
	mNET_DECNET_NODE_ADDRESS
 = 2,

720 
	mNET_DECNET_NODE_NAME
 = 3,

721 
	mNET_DECNET_DEFAULT_DEVICE
 = 4,

722 
	mNET_DECNET_TIME_WAIT
 = 5,

723 
	mNET_DECNET_DN_COUNT
 = 6,

724 
	mNET_DECNET_DI_COUNT
 = 7,

725 
	mNET_DECNET_DR_COUNT
 = 8,

726 
	mNET_DECNET_DST_GC_INTERVAL
 = 9,

727 
	mNET_DECNET_CONF
 = 10,

728 
	mNET_DECNET_NO_FC_MAX_CWND
 = 11,

729 
	mNET_DECNET_MEM
 = 12,

730 
	mNET_DECNET_RMEM
 = 13,

731 
	mNET_DECNET_WMEM
 = 14,

732 
	mNET_DECNET_DEBUG_LEVEL
 = 255

737 
	mNET_DECNET_CONF_LOOPBACK
 = -2,

738 
	mNET_DECNET_CONF_DDCMP
 = -3,

739 
	mNET_DECNET_CONF_PPP
 = -4,

740 
	mNET_DECNET_CONF_X25
 = -5,

741 
	mNET_DECNET_CONF_GRE
 = -6,

742 
	mNET_DECNET_CONF_ETHER
 = -7

749 
	mNET_DECNET_CONF_DEV_PRIORITY
 = 1,

750 
	mNET_DECNET_CONF_DEV_T1
 = 2,

751 
	mNET_DECNET_CONF_DEV_T2
 = 3,

752 
	mNET_DECNET_CONF_DEV_T3
 = 4,

753 
	mNET_DECNET_CONF_DEV_FORWARDING
 = 5,

754 
	mNET_DECNET_CONF_DEV_BLKSIZE
 = 6,

755 
	mNET_DECNET_CONF_DEV_STATE
 = 7

760 
	mNET_SCTP_RTO_INITIAL
 = 1,

761 
	mNET_SCTP_RTO_MIN
 = 2,

762 
	mNET_SCTP_RTO_MAX
 = 3,

763 
	mNET_SCTP_RTO_ALPHA
 = 4,

764 
	mNET_SCTP_RTO_BETA
 = 5,

765 
	mNET_SCTP_VALID_COOKIE_LIFE
 = 6,

766 
	mNET_SCTP_ASSOCIATION_MAX_RETRANS
 = 7,

767 
	mNET_SCTP_PATH_MAX_RETRANS
 = 8,

768 
	mNET_SCTP_MAX_INIT_RETRANSMITS
 = 9,

769 
	mNET_SCTP_HB_INTERVAL
 = 10,

770 
	mNET_SCTP_PRESERVE_ENABLE
 = 11,

771 
	mNET_SCTP_MAX_BURST
 = 12,

772 
	mNET_SCTP_ADDIP_ENABLE
 = 13,

773 
	mNET_SCTP_PRSCTP_ENABLE
 = 14,

774 
	mNET_SCTP_SNDBUF_POLICY
 = 15,

775 
	mNET_SCTP_SACK_TIMEOUT
 = 16,

776 
	mNET_SCTP_RCVBUF_POLICY
 = 17,

781 
	mNET_BRIDGE_NF_CALL_ARPTABLES
 = 1,

782 
	mNET_BRIDGE_NF_CALL_IPTABLES
 = 2,

783 
	mNET_BRIDGE_NF_CALL_IP6TABLES
 = 3,

784 
	mNET_BRIDGE_NF_FILTER_VLAN_TAGGED
 = 4,

785 
	mNET_BRIDGE_NF_FILTER_PPPOE_TAGGED
 = 5,

790 
	mNET_IRDA_DISCOVERY
=1,

791 
	mNET_IRDA_DEVNAME
=2,

792 
	mNET_IRDA_DEBUG
=3,

793 
	mNET_IRDA_FAST_POLL
=4,

794 
	mNET_IRDA_DISCOVERY_SLOTS
=5,

795 
	mNET_IRDA_DISCOVERY_TIMEOUT
=6,

796 
	mNET_IRDA_SLOT_TIMEOUT
=7,

797 
	mNET_IRDA_MAX_BAUD_RATE
=8,

798 
	mNET_IRDA_MIN_TX_TURN_TIME
=9,

799 
	mNET_IRDA_MAX_TX_DATA_SIZE
=10,

800 
	mNET_IRDA_MAX_TX_WINDOW
=11,

801 
	mNET_IRDA_MAX_NOREPLY_TIME
=12,

802 
	mNET_IRDA_WARN_NOREPLY_TIME
=13,

803 
	mNET_IRDA_LAP_KEEPALIVE_TIME
=14,

810 
	mFS_NRINODE
=1,

811 
	mFS_STATINODE
=2,

812 
	mFS_MAXINODE
=3,

813 
	mFS_NRDQUOT
=4,

814 
	mFS_MAXDQUOT
=5,

815 
	mFS_NRFILE
=6,

816 
	mFS_MAXFILE
=7,

817 
	mFS_DENTRY
=8,

818 
	mFS_NRSUPER
=9,

819 
	mFS_MAXSUPER
=10,

820 
	mFS_OVERFLOWUID
=11,

821 
	mFS_OVERFLOWGID
=12,

822 
	mFS_LEASES
=13,

823 
	mFS_DIR_NOTIFY
=14,

824 
	mFS_LEASE_TIME
=15,

825 
	mFS_DQSTATS
=16,

826 
	mFS_XFS
=17,

827 
	mFS_AIO_NR
=18,

828 
	mFS_AIO_MAX_NR
=19,

829 
	mFS_INOTIFY
=20,

830 
	mFS_OCFS2
=988,

835 
	mFS_DQ_LOOKUPS
 = 1,

836 
	mFS_DQ_DROPS
 = 2,

837 
	mFS_DQ_READS
 = 3,

838 
	mFS_DQ_WRITES
 = 4,

839 
	mFS_DQ_CACHE_HITS
 = 5,

840 
	mFS_DQ_ALLOCATED
 = 6,

841 
	mFS_DQ_FREE
 = 7,

842 
	mFS_DQ_SYNCS
 = 8,

843 
	mFS_DQ_WARNINGS
 = 9,

850 
	mDEV_CDROM
=1,

851 
	mDEV_HWMON
=2,

852 
	mDEV_PARPORT
=3,

853 
	mDEV_RAID
=4,

854 
	mDEV_MAC_HID
=5,

855 
	mDEV_SCSI
=6,

856 
	mDEV_IPMI
=7,

861 
	mDEV_CDROM_INFO
=1,

862 
	mDEV_CDROM_AUTOCLOSE
=2,

863 
	mDEV_CDROM_AUTOEJECT
=3,

864 
	mDEV_CDROM_DEBUG
=4,

865 
	mDEV_CDROM_LOCK
=5,

866 
	mDEV_CDROM_CHECK_MEDIA
=6

871 
	mDEV_PARPORT_DEFAULT
=-3

876 
	mDEV_RAID_SPEED_LIMIT_MIN
=1,

877 
	mDEV_RAID_SPEED_LIMIT_MAX
=2

882 
	mDEV_PARPORT_DEFAULT_TIMESLICE
=1,

883 
	mDEV_PARPORT_DEFAULT_SPINTIME
=2

888 
	mDEV_PARPORT_SPINTIME
=1,

889 
	mDEV_PARPORT_BASE_ADDR
=2,

890 
	mDEV_PARPORT_IRQ
=3,

891 
	mDEV_PARPORT_DMA
=4,

892 
	mDEV_PARPORT_MODES
=5,

893 
	mDEV_PARPORT_DEVICES
=6,

894 
	mDEV_PARPORT_AUTOPROBE
=16

899 
	mDEV_PARPORT_DEVICES_ACTIVE
=-3,

904 
	mDEV_PARPORT_DEVICE_TIMESLICE
=1,

909 
	mDEV_MAC_HID_KEYBOARD_SENDS_LINUX_KEYCODES
=1,

910 
	mDEV_MAC_HID_KEYBOARD_LOCK_KEYCODES
=2,

911 
	mDEV_MAC_HID_MOUSE_BUTTON_EMULATION
=3,

912 
	mDEV_MAC_HID_MOUSE_BUTTON2_KEYCODE
=4,

913 
	mDEV_MAC_HID_MOUSE_BUTTON3_KEYCODE
=5,

914 
	mDEV_MAC_HID_ADB_MOUSE_SENDS_KEYCODES
=6

919 
	mDEV_SCSI_LOGGING_LEVEL
=1,

924 
	mDEV_IPMI_POWEROFF_POWERCYCLE
=1,

930 
	mABI_DEFHANDLER_COFF
=1,

931 
	mABI_DEFHANDLER_ELF
=2,

932 
	mABI_DEFHANDLER_LCALL7
=3,

933 
	mABI_DEFHANDLER_LIBCSO
=4,

934 
	mABI_TRACE
=5,

935 
	mABI_FAKE_UTSNAME
=6,

	@/usr/include/linux/utsname.h

1 #iâdeà
_LINUX_UTSNAME_H


2 
	#_LINUX_UTSNAME_H


	)

4 
	#__OLD_UTS_LEN
 8

	)

6 
	sŞdŞd_ut¢ame
 {

7 
	msy¢ame
[9];

8 
	mnod’ame
[9];

9 
	m»Ëa£
[9];

10 
	mv”siÚ
[9];

11 
	mmachše
[9];

14 
	#__NEW_UTS_LEN
 64

	)

16 
	sŞd_ut¢ame
 {

17 
	msy¢ame
[65];

18 
	mnod’ame
[65];

19 
	m»Ëa£
[65];

20 
	mv”siÚ
[65];

21 
	mmachše
[65];

24 
	sÃw_ut¢ame
 {

25 
	msy¢ame
[65];

26 
	mnod’ame
[65];

27 
	m»Ëa£
[65];

28 
	mv”siÚ
[65];

29 
	mmachše
[65];

30 
	mdomašÇme
[65];

	@/usr/include/linux/version.h

1 
	#LINUX_VERSION_CODE
 132632

	)

2 
	#KERNEL_VERSION
(
a
,
b
,
c
è((×è<< 16è+ ((bè<< 8è+ (c))

	)

	@/usr/include/linux/wireless.h

10 #iâdeà
_LINUX_WIRELESS_H


11 
	#_LINUX_WIRELESS_H


	)

83 
	#WIRELESS_EXT
 22

	)

230 
	#SIOCSIWCOMMIT
 0x8B00

	)

231 
	#SIOCGIWNAME
 0x8B01

	)

237 
	#SIOCSIWNWID
 0x8B02

	)

238 
	#SIOCGIWNWID
 0x8B03

	)

239 
	#SIOCSIWFREQ
 0x8B04

	)

240 
	#SIOCGIWFREQ
 0x8B05

	)

241 
	#SIOCSIWMODE
 0x8B06

	)

242 
	#SIOCGIWMODE
 0x8B07

	)

243 
	#SIOCSIWSENS
 0x8B08

	)

244 
	#SIOCGIWSENS
 0x8B09

	)

247 
	#SIOCSIWRANGE
 0x8B0A

	)

248 
	#SIOCGIWRANGE
 0x8B0B

	)

249 
	#SIOCSIWPRIV
 0x8B0C

	)

250 
	#SIOCGIWPRIV
 0x8B0D

	)

251 
	#SIOCSIWSTATS
 0x8B0E

	)

252 
	#SIOCGIWSTATS
 0x8B0F

	)

257 
	#SIOCSIWSPY
 0x8B10

	)

258 
	#SIOCGIWSPY
 0x8B11

	)

259 
	#SIOCSIWTHRSPY
 0x8B12

	)

260 
	#SIOCGIWTHRSPY
 0x8B13

	)

263 
	#SIOCSIWAP
 0x8B14

	)

264 
	#SIOCGIWAP
 0x8B15

	)

265 
	#SIOCGIWAPLIST
 0x8B17

	)

266 
	#SIOCSIWSCAN
 0x8B18

	)

267 
	#SIOCGIWSCAN
 0x8B19

	)

270 
	#SIOCSIWESSID
 0x8B1A

	)

271 
	#SIOCGIWESSID
 0x8B1B

	)

272 
	#SIOCSIWNICKN
 0x8B1C

	)

273 
	#SIOCGIWNICKN
 0x8B1D

	)

279 
	#SIOCSIWRATE
 0x8B20

	)

280 
	#SIOCGIWRATE
 0x8B21

	)

281 
	#SIOCSIWRTS
 0x8B22

	)

282 
	#SIOCGIWRTS
 0x8B23

	)

283 
	#SIOCSIWFRAG
 0x8B24

	)

284 
	#SIOCGIWFRAG
 0x8B25

	)

285 
	#SIOCSIWTXPOW
 0x8B26

	)

286 
	#SIOCGIWTXPOW
 0x8B27

	)

287 
	#SIOCSIWRETRY
 0x8B28

	)

288 
	#SIOCGIWRETRY
 0x8B29

	)

291 
	#SIOCSIWENCODE
 0x8B2A

	)

292 
	#SIOCGIWENCODE
 0x8B2B

	)

294 
	#SIOCSIWPOWER
 0x8B2C

	)

295 
	#SIOCGIWPOWER
 0x8B2D

	)

304 
	#SIOCSIWGENIE
 0x8B30

	)

305 
	#SIOCGIWGENIE
 0x8B31

	)

308 
	#SIOCSIWMLME
 0x8B16

	)

311 
	#SIOCSIWAUTH
 0x8B32

	)

312 
	#SIOCGIWAUTH
 0x8B33

	)

315 
	#SIOCSIWENCODEEXT
 0x8B34

	)

316 
	#SIOCGIWENCODEEXT
 0x8B35

	)

319 
	#SIOCSIWPMKSA
 0x8B36

	)

330 
	#SIOCIWFIRSTPRIV
 0x8BE0

	)

331 
	#SIOCIWLASTPRIV
 0x8BFF

	)

346 
	#SIOCIWFIRST
 0x8B00

	)

347 
	#SIOCIWLAST
 
SIOCIWLASTPRIV


	)

348 
	#IW_IOCTL_IDX
(
cmd
è((cmdè- 
SIOCIWFIRST
)

	)

351 
	#IW_IS_SET
(
cmd
è(!((cmdè& 0x1))

	)

352 
	#IW_IS_GET
(
cmd
è((cmdè& 0x1)

	)

358 
	#IWEVTXDROP
 0x8C00

	)

359 
	#IWEVQUAL
 0x8C01

	)

360 
	#IWEVCUSTOM
 0x8C02

	)

361 
	#IWEVREGISTERED
 0x8C03

	)

362 
	#IWEVEXPIRED
 0x8C04

	)

363 
	#IWEVGENIE
 0x8C05

	)

369 
	#IWEVMICHAELMICFAILURE
 0x8C06

	)

372 
	#IWEVASSOCREQIE
 0x8C07

	)

381 
	#IWEVASSOCRESPIE
 0x8C08

	)

388 
	#IWEVPMKIDCAND
 0x8C09

	)

392 
	#IWEVFIRST
 0x8C00

	)

393 
	#IW_EVENT_IDX
(
cmd
è((cmdè- 
IWEVFIRST
)

	)

402 
	#IW_PRIV_TYPE_MASK
 0x7000

	)

403 
	#IW_PRIV_TYPE_NONE
 0x0000

	)

404 
	#IW_PRIV_TYPE_BYTE
 0x1000

	)

405 
	#IW_PRIV_TYPE_CHAR
 0x2000

	)

406 
	#IW_PRIV_TYPE_INT
 0x4000

	)

407 
	#IW_PRIV_TYPE_FLOAT
 0x5000

	)

408 
	#IW_PRIV_TYPE_ADDR
 0x6000

	)

410 
	#IW_PRIV_SIZE_FIXED
 0x0800

	)

412 
	#IW_PRIV_SIZE_MASK
 0x07FF

	)

422 
	#IW_MAX_FREQUENCIES
 32

	)

428 
	#IW_MAX_BITRATES
 32

	)

431 
	#IW_MAX_TXPOWER
 8

	)

436 
	#IW_MAX_SPY
 8

	)

440 
	#IW_MAX_AP
 64

	)

443 
	#IW_ESSID_MAX_SIZE
 32

	)

446 
	#IW_MODE_AUTO
 0

	)

447 
	#IW_MODE_ADHOC
 1

	)

448 
	#IW_MODE_INFRA
 2

	)

449 
	#IW_MODE_MASTER
 3

	)

450 
	#IW_MODE_REPEAT
 4

	)

451 
	#IW_MODE_SECOND
 5

	)

452 
	#IW_MODE_MONITOR
 6

	)

455 
	#IW_QUAL_QUAL_UPDATED
 0x01

	)

456 
	#IW_QUAL_LEVEL_UPDATED
 0x02

	)

457 
	#IW_QUAL_NOISE_UPDATED
 0x04

	)

458 
	#IW_QUAL_ALL_UPDATED
 0x07

	)

459 
	#IW_QUAL_DBM
 0x08

	)

460 
	#IW_QUAL_QUAL_INVALID
 0x10

	)

461 
	#IW_QUAL_LEVEL_INVALID
 0x20

	)

462 
	#IW_QUAL_NOISE_INVALID
 0x40

	)

463 
	#IW_QUAL_RCPI
 0x80

	)

464 
	#IW_QUAL_ALL_INVALID
 0x70

	)

467 
	#IW_FREQ_AUTO
 0x00

	)

468 
	#IW_FREQ_FIXED
 0x01

	)

472 
	#IW_MAX_ENCODING_SIZES
 8

	)

475 
	#IW_ENCODING_TOKEN_MAX
 64

	)

478 
	#IW_ENCODE_INDEX
 0x00FF

	)

479 
	#IW_ENCODE_FLAGS
 0xFF00

	)

480 
	#IW_ENCODE_MODE
 0xF000

	)

481 
	#IW_ENCODE_DISABLED
 0x8000

	)

482 
	#IW_ENCODE_ENABLED
 0x0000

	)

483 
	#IW_ENCODE_RESTRICTED
 0x4000

	)

484 
	#IW_ENCODE_OPEN
 0x2000

	)

485 
	#IW_ENCODE_NOKEY
 0x0800

	)

486 
	#IW_ENCODE_TEMP
 0x0400

	)

489 
	#IW_POWER_ON
 0x0000

	)

490 
	#IW_POWER_TYPE
 0xF000

	)

491 
	#IW_POWER_PERIOD
 0x1000

	)

492 
	#IW_POWER_TIMEOUT
 0x2000

	)

493 
	#IW_POWER_MODE
 0x0F00

	)

494 
	#IW_POWER_UNICAST_R
 0x0100

	)

495 
	#IW_POWER_MULTICAST_R
 0x0200

	)

496 
	#IW_POWER_ALL_R
 0x0300

	)

497 
	#IW_POWER_FORCE_S
 0x0400

	)

498 
	#IW_POWER_REPEATER
 0x0800

	)

499 
	#IW_POWER_MODIFIER
 0x000F

	)

500 
	#IW_POWER_MIN
 0x0001

	)

501 
	#IW_POWER_MAX
 0x0002

	)

502 
	#IW_POWER_RELATIVE
 0x0004

	)

505 
	#IW_TXPOW_TYPE
 0x00FF

	)

506 
	#IW_TXPOW_DBM
 0x0000

	)

507 
	#IW_TXPOW_MWATT
 0x0001

	)

508 
	#IW_TXPOW_RELATIVE
 0x0002

	)

509 
	#IW_TXPOW_RANGE
 0x1000

	)

512 
	#IW_RETRY_ON
 0x0000

	)

513 
	#IW_RETRY_TYPE
 0xF000

	)

514 
	#IW_RETRY_LIMIT
 0x1000

	)

515 
	#IW_RETRY_LIFETIME
 0x2000

	)

516 
	#IW_RETRY_MODIFIER
 0x00FF

	)

517 
	#IW_RETRY_MIN
 0x0001

	)

518 
	#IW_RETRY_MAX
 0x0002

	)

519 
	#IW_RETRY_RELATIVE
 0x0004

	)

520 
	#IW_RETRY_SHORT
 0x0010

	)

521 
	#IW_RETRY_LONG
 0x0020

	)

524 
	#IW_SCAN_DEFAULT
 0x0000

	)

525 
	#IW_SCAN_ALL_ESSID
 0x0001

	)

526 
	#IW_SCAN_THIS_ESSID
 0x0002

	)

527 
	#IW_SCAN_ALL_FREQ
 0x0004

	)

528 
	#IW_SCAN_THIS_FREQ
 0x0008

	)

529 
	#IW_SCAN_ALL_MODE
 0x0010

	)

530 
	#IW_SCAN_THIS_MODE
 0x0020

	)

531 
	#IW_SCAN_ALL_RATE
 0x0040

	)

532 
	#IW_SCAN_THIS_RATE
 0x0080

	)

534 
	#IW_SCAN_TYPE_ACTIVE
 0

	)

535 
	#IW_SCAN_TYPE_PASSIVE
 1

	)

537 
	#IW_SCAN_MAX_DATA
 4096

	)

540 
	#IW_SCAN_CAPA_NONE
 0x00

	)

541 
	#IW_SCAN_CAPA_ESSID
 0x01

	)

542 
	#IW_SCAN_CAPA_BSSID
 0x02

	)

543 
	#IW_SCAN_CAPA_CHANNEL
 0x04

	)

544 
	#IW_SCAN_CAPA_MODE
 0x08

	)

545 
	#IW_SCAN_CAPA_RATE
 0x10

	)

546 
	#IW_SCAN_CAPA_TYPE
 0x20

	)

547 
	#IW_SCAN_CAPA_TIME
 0x40

	)

550 
	#IW_CUSTOM_MAX
 256

	)

553 
	#IW_GENERIC_IE_MAX
 1024

	)

556 
	#IW_MLME_DEAUTH
 0

	)

557 
	#IW_MLME_DISASSOC
 1

	)

558 
	#IW_MLME_AUTH
 2

	)

559 
	#IW_MLME_ASSOC
 3

	)

562 
	#IW_AUTH_INDEX
 0x0FFF

	)

563 
	#IW_AUTH_FLAGS
 0xF000

	)

568 
	#IW_AUTH_WPA_VERSION
 0

	)

569 
	#IW_AUTH_CIPHER_PAIRWISE
 1

	)

570 
	#IW_AUTH_CIPHER_GROUP
 2

	)

571 
	#IW_AUTH_KEY_MGMT
 3

	)

572 
	#IW_AUTH_TKIP_COUNTERMEASURES
 4

	)

573 
	#IW_AUTH_DROP_UNENCRYPTED
 5

	)

574 
	#IW_AUTH_80211_AUTH_ALG
 6

	)

575 
	#IW_AUTH_WPA_ENABLED
 7

	)

576 
	#IW_AUTH_RX_UNENCRYPTED_EAPOL
 8

	)

577 
	#IW_AUTH_ROAMING_CONTROL
 9

	)

578 
	#IW_AUTH_PRIVACY_INVOKED
 10

	)

581 
	#IW_AUTH_WPA_VERSION_DISABLED
 0x00000001

	)

582 
	#IW_AUTH_WPA_VERSION_WPA
 0x00000002

	)

583 
	#IW_AUTH_WPA_VERSION_WPA2
 0x00000004

	)

586 
	#IW_AUTH_CIPHER_NONE
 0x00000001

	)

587 
	#IW_AUTH_CIPHER_WEP40
 0x00000002

	)

588 
	#IW_AUTH_CIPHER_TKIP
 0x00000004

	)

589 
	#IW_AUTH_CIPHER_CCMP
 0x00000008

	)

590 
	#IW_AUTH_CIPHER_WEP104
 0x00000010

	)

593 
	#IW_AUTH_KEY_MGMT_802_1X
 1

	)

594 
	#IW_AUTH_KEY_MGMT_PSK
 2

	)

597 
	#IW_AUTH_ALG_OPEN_SYSTEM
 0x00000001

	)

598 
	#IW_AUTH_ALG_SHARED_KEY
 0x00000002

	)

599 
	#IW_AUTH_ALG_LEAP
 0x00000004

	)

602 
	#IW_AUTH_ROAMING_ENABLE
 0

	)

603 
	#IW_AUTH_ROAMING_DISABLE
 1

	)

607 
	#IW_ENCODE_SEQ_MAX_SIZE
 8

	)

609 
	#IW_ENCODE_ALG_NONE
 0

	)

610 
	#IW_ENCODE_ALG_WEP
 1

	)

611 
	#IW_ENCODE_ALG_TKIP
 2

	)

612 
	#IW_ENCODE_ALG_CCMP
 3

	)

614 
	#IW_ENCODE_EXT_TX_SEQ_VALID
 0x00000001

	)

615 
	#IW_ENCODE_EXT_RX_SEQ_VALID
 0x00000002

	)

616 
	#IW_ENCODE_EXT_GROUP_KEY
 0x00000004

	)

617 
	#IW_ENCODE_EXT_SET_TX_KEY
 0x00000008

	)

620 
	#IW_MICFAILURE_KEY_ID
 0x00000003

	)

621 
	#IW_MICFAILURE_GROUP
 0x00000004

	)

622 
	#IW_MICFAILURE_PAIRWISE
 0x00000008

	)

623 
	#IW_MICFAILURE_STAKEY
 0x00000010

	)

624 
	#IW_MICFAILURE_COUNT
 0x00000060

	)

628 
	#IW_ENC_CAPA_WPA
 0x00000001

	)

629 
	#IW_ENC_CAPA_WPA2
 0x00000002

	)

630 
	#IW_ENC_CAPA_CIPHER_TKIP
 0x00000004

	)

631 
	#IW_ENC_CAPA_CIPHER_CCMP
 0x00000008

	)

636 
	#IW_EVENT_CAPA_BASE
(
cmd
è((cmd >ğ
SIOCIWFIRSTPRIV
) ? \

637 (
cmd
 - 
SIOCIWFIRSTPRIV
 + 0x60) : \

638 (
cmd
 - 
SIOCSIWCOMMIT
))

	)

639 
	#IW_EVENT_CAPA_INDEX
(
cmd
è(
	`IW_EVENT_CAPA_BASE
(cmdè>> 5)

	)

640 
	#IW_EVENT_CAPA_MASK
(
cmd
è(1 << (
	`IW_EVENT_CAPA_BASE
(cmdè& 0x1F))

	)

643 
	#IW_EVENT_CAPA_K_0
 (
	`IW_EVENT_CAPA_MASK
(0x8B04) | \

644 
	`IW_EVENT_CAPA_MASK
(0x8B06) | \

645 
	`IW_EVENT_CAPA_MASK
(0x8B1A))

	)

646 
	#IW_EVENT_CAPA_K_1
 (
	`IW_EVENT_CAPA_MASK
(0x8B2A))

	)

648 
	#IW_EVENT_CAPA_SET
(
ev’t_ÿ·
, 
cmd
èÓv’t_ÿ·[
	`IW_EVENT_CAPA_INDEX
(cmd)] |ğ
	`IW_EVENT_CAPA_MASK
(cmd))

	)

649 
	#IW_EVENT_CAPA_SET_KERNEL
(
ev’t_ÿ·
è{ev’t_ÿ·[0] |ğ
IW_EVENT_CAPA_K_0
;ƒv’t_ÿ·[1] |ğ
IW_EVENT_CAPA_K_1
; }

	)

658 
	siw_·¿m


660 
__s32
 
	mv®ue
;

661 
__u8
 
	mfixed
;

662 
__u8
 
	mdi§bËd
;

663 
__u16
 
	mæags
;

670 
	siw_pošt


672 *
	mpoš‹r
;

673 
__u16
 
	mËngth
;

674 
__u16
 
	mæags
;

685 
	siw_äeq


687 
__s32
 
	mm
;

688 
__s16
 
	me
;

689 
__u8
 
	mi
;

690 
__u8
 
	mæags
;

696 
	siw_qu®™y


698 
__u8
 
	mqu®
;

700 
__u8
 
	mËv–
;

701 
__u8
 
	mnoi£
;

702 
__u8
 
	mupd©ed
;

712 
	siw_disÿrded


714 
__u32
 
	mnwid
;

715 
__u32
 
	mcode
;

716 
__u32
 
	mäagm’t
;

717 
__u32
 
	m»Œ›s
;

718 
__u32
 
	mmisc
;

725 
	siw_mis£d


727 
__u32
 
	mb—cÚ
;

733 
	siw_thr¥y


735 
sockaddr
 
	maddr
;

736 
iw_qu®™y
 
	mqu®
;

737 
iw_qu®™y
 
	mlow
;

738 
iw_qu®™y
 
	mhigh
;

752 
	siw_sÿn_»q


754 
__u8
 
	msÿn_ty³
;

755 
__u8
 
	messid_Ën
;

756 
__u8
 
	mnum_chªÃls
;

758 
__u8
 
	mæags
;

761 
sockaddr
 
	mbssid
;

770 
__u8
 
	messid
[
IW_ESSID_MAX_SIZE
];

782 
__u32
 
	mmš_chªÃl_time
;

783 
__u32
 
	mmax_chªÃl_time
;

785 
iw_äeq
 
	mchªÃl_li¡
[
IW_MAX_FREQUENCIES
];

814 
	siw_’code_ext


816 
__u32
 
	mext_æags
;

817 
__u8
 
	mtx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

818 
__u8
 
	mrx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

819 
sockaddr
 
	maddr
;

822 
__u16
 
	m®g
;

823 
__u16
 
	mkey_Ën
;

824 
__u8
 
	mkey
[0];

828 
	siw_mlme


830 
__u16
 
	mcmd
;

831 
__u16
 
	m»asÚ_code
;

832 
sockaddr
 
	maddr
;

836 
	#IW_PMKSA_ADD
 1

	)

837 
	#IW_PMKSA_REMOVE
 2

	)

838 
	#IW_PMKSA_FLUSH
 3

	)

840 
	#IW_PMKID_LEN
 16

	)

842 
	siw_pmk§


844 
__u32
 
	mcmd
;

845 
sockaddr
 
	mbssid
;

846 
__u8
 
	mpmkid
[
IW_PMKID_LEN
];

850 
	siw_mich«lmicçu»


852 
__u32
 
	mæags
;

853 
sockaddr
 
	m¤c_addr
;

854 
__u8
 
	mtsc
[
IW_ENCODE_SEQ_MAX_SIZE
];

858 
	#IW_PMKID_CAND_PREAUTH
 0x00000001

	)

859 
	siw_pmkid_ÿnd


861 
__u32
 
	mæags
;

862 
__u32
 
	mšdex
;

864 
sockaddr
 
	mbssid
;

871 
	siw_¡©i¡ics


873 
__u16
 
	m¡©us
;

876 
iw_qu®™y
 
	mqu®
;

878 
iw_disÿrded
 
	mdisÿrd
;

879 
iw_mis£d
 
	mmiss
;

893 
	uiw»q_d©a


896 
	mÇme
[
IFNAMSIZ
];

900 
iw_pošt
 
	messid
;

901 
iw_·¿m
 
	mnwid
;

902 
iw_äeq
 
	mäeq
;

906 
iw_·¿m
 
	m£ns
;

907 
iw_·¿m
 
	mb™¿‹
;

908 
iw_·¿m
 
	mtxpow”
;

909 
iw_·¿m
 
	m¹s
;

910 
iw_·¿m
 
	mäag
;

911 
__u32
 
	mmode
;

912 
iw_·¿m
 
	m»Œy
;

914 
iw_pošt
 
	m’codšg
;

915 
iw_·¿m
 
	mpow”
;

916 
iw_qu®™y
 
	mqu®
;

918 
sockaddr
 
	m­_addr
;

919 
sockaddr
 
	maddr
;

921 
iw_·¿m
 
	m·¿m
;

922 
iw_pošt
 
	md©a
;

931 
	siw»q


935 
	miän_Çme
[
IFNAMSIZ
];

936 } 
	miä_iän
;

939 
iw»q_d©a
 
	mu
;

952 
	siw_¿nge


955 
__u32
 
	mthroughput
;

964 
__u32
 
	mmš_nwid
;

965 
__u32
 
	mmax_nwid
;

968 
__u16
 
	mŞd_num_chªÃls
;

969 
__u8
 
	mŞd_num_äequ’cy
;

972 
__u8
 
	msÿn_ÿ·
;

975 
__u32
 
	mev’t_ÿ·
[6];

978 
__s32
 
	m£ns™iv™y
;

985 
iw_qu®™y
 
	mmax_qu®
;

995 
iw_qu®™y
 
	mavg_qu®
;

998 
__u8
 
	mnum_b™¿‹s
;

999 
__s32
 
	mb™¿‹
[
IW_MAX_BITRATES
];

1002 
__s32
 
	mmš_¹s
;

1003 
__s32
 
	mmax_¹s
;

1006 
__s32
 
	mmš_äag
;

1007 
__s32
 
	mmax_äag
;

1010 
__s32
 
	mmš_pmp
;

1011 
__s32
 
	mmax_pmp
;

1012 
__s32
 
	mmš_pmt
;

1013 
__s32
 
	mmax_pmt
;

1014 
__u16
 
	mpmp_æags
;

1015 
__u16
 
	mpmt_æags
;

1016 
__u16
 
	mpm_ÿ·
;

1019 
__u16
 
	m’codšg_size
[
IW_MAX_ENCODING_SIZES
];

1020 
__u8
 
	mnum_’codšg_sizes
;

1021 
__u8
 
	mmax_’codšg_tok’s
;

1023 
__u8
 
	m’codšg_logš_šdex
;

1026 
__u16
 
	mtxpow”_ÿ·
;

1027 
__u8
 
	mnum_txpow”
;

1028 
__s32
 
	mtxpow”
[
IW_MAX_TXPOWER
];

1031 
__u8
 
	mwe_v”siÚ_comped
;

1032 
__u8
 
	mwe_v”siÚ_sourû
;

1035 
__u16
 
	m»Œy_ÿ·
;

1036 
__u16
 
	m»Œy_æags
;

1037 
__u16
 
	mr_time_æags
;

1038 
__s32
 
	mmš_»Œy
;

1039 
__s32
 
	mmax_»Œy
;

1040 
__s32
 
	mmš_r_time
;

1041 
__s32
 
	mmax_r_time
;

1044 
__u16
 
	mnum_chªÃls
;

1045 
__u8
 
	mnum_äequ’cy
;

1046 
iw_äeq
 
	mäeq
[
IW_MAX_FREQUENCIES
];

1050 
__u32
 
	m’c_ÿ·
;

1057 
	siw_´iv_¬gs


1059 
__u32
 
	mcmd
;

1060 
__u16
 
	m£t_¬gs
;

1061 
__u16
 
	mg‘_¬gs
;

1062 
	mÇme
[
IFNAMSIZ
];

1075 
	siw_ev’t


1077 
__u16
 
	mËn
;

1078 
__u16
 
	mcmd
;

1079 
iw»q_d©a
 
	mu
;

1083 
	#IW_EV_LCP_LEN
 ((
iw_ev’t
è- (
iw»q_d©a
))

	)

1085 
	#IW_EV_CHAR_LEN
 (
IW_EV_LCP_LEN
 + 
IFNAMSIZ
)

	)

1086 
	#IW_EV_UINT_LEN
 (
IW_EV_LCP_LEN
 + (
__u32
))

	)

1087 
	#IW_EV_FREQ_LEN
 (
IW_EV_LCP_LEN
 + (
iw_äeq
))

	)

1088 
	#IW_EV_PARAM_LEN
 (
IW_EV_LCP_LEN
 + (
iw_·¿m
))

	)

1089 
	#IW_EV_ADDR_LEN
 (
IW_EV_LCP_LEN
 + (
sockaddr
))

	)

1090 
	#IW_EV_QUAL_LEN
 (
IW_EV_LCP_LEN
 + (
iw_qu®™y
))

	)

1095 
	#IW_EV_POINT_OFF
 (((*è&(((
iw_pošt
 *è
NULL
)->
Ëngth
)) - \

1096 (*è
NULL
)

	)

1097 
	#IW_EV_POINT_LEN
 (
IW_EV_LCP_LEN
 + (
iw_pošt
) - \

1098 
IW_EV_POINT_OFF
)

	)

1101 
	#IW_EV_LCP_PK_LEN
 (4)

	)

1103 
	#IW_EV_CHAR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 
IFNAMSIZ
)

	)

1104 
	#IW_EV_UINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
__u32
))

	)

1105 
	#IW_EV_FREQ_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_äeq
))

	)

1106 
	#IW_EV_PARAM_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_·¿m
))

	)

1107 
	#IW_EV_ADDR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
sockaddr
))

	)

1108 
	#IW_EV_QUAL_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_qu®™y
))

	)

1109 
	#IW_EV_POINT_PK_LEN
 (
IW_EV_LCP_LEN
 + 4)

	)

	@/usr/include/sys/queue.h

32 #iâdef 
_SYS_QUEUE_H_


33 
	#_SYS_QUEUE_H_


	)

84 
	#LIST_HEAD
(
Çme
, 
ty³
) \

85 
	sÇme
 { \

86 
ty³
 *
lh_fœ¡
; \

87 }

	)

89 
	#LIST_HEAD_INITIALIZER
(
h—d
) \

90 { 
NULL
 }

	)

92 
	#LIST_ENTRY
(
ty³
) \

94 
ty³
 *
Ë_Ãxt
; \

95 
ty³
 **
Ë_´ev
; \

96 }

	)

101 
	#LIST_INIT
(
h—d
) do { \

102 (
h—d
)->
lh_fœ¡
 = 
NULL
; \

103 }  0)

	)

105 
	#LIST_INSERT_AFTER
(
li¡–m
, 
–m
, 
f›ld
) do { \

106 ià(((
–m
)->
f›ld
.
Ë_Ãxt
 = (
li¡–m
)->f›ld.Ë_Ãxtè!ğ
NULL
) \

107 (
li¡–m
)->
f›ld
.
Ë_Ãxt
->f›ld.
Ë_´ev
 = \

108 &(
–m
)->
f›ld
.
Ë_Ãxt
; \

109 (
li¡–m
)->
f›ld
.
Ë_Ãxt
 = (
–m
); \

110 (
–m
)->
f›ld
.
Ë_´ev
 = &(
li¡–m
)->f›ld.
Ë_Ãxt
; \

111 }  0)

	)

113 
	#LIST_INSERT_BEFORE
(
li¡–m
, 
–m
, 
f›ld
) do { \

114 (
–m
)->
f›ld
.
Ë_´ev
 = (
li¡–m
)->field.le_prev; \

115 (
–m
)->
f›ld
.
Ë_Ãxt
 = (
li¡–m
); \

116 *(
li¡–m
)->
f›ld
.
Ë_´ev
 = (
–m
); \

117 (
li¡–m
)->
f›ld
.
Ë_´ev
 = &(
–m
)->f›ld.
Ë_Ãxt
; \

118 }  0)

	)

120 
	#LIST_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

121 ià(((
–m
)->
f›ld
.
Ë_Ãxt
 = (
h—d
)->
lh_fœ¡
è!ğ
NULL
) \

122 (
h—d
)->
lh_fœ¡
->
f›ld
.
Ë_´ev
 = &(
–m
)->f›ld.
Ë_Ãxt
;\

123 (
h—d
)->
lh_fœ¡
 = (
–m
); \

124 (
–m
)->
f›ld
.
Ë_´ev
 = &(
h—d
)->
lh_fœ¡
; \

125 }  0)

	)

127 
	#LIST_REMOVE
(
–m
, 
f›ld
) do { \

128 ià((
–m
)->
f›ld
.
Ë_Ãxt
 !ğ
NULL
) \

129 (
–m
)->
f›ld
.
Ë_Ãxt
->f›ld.
Ë_´ev
 = \

130 (
–m
)->
f›ld
.
Ë_´ev
; \

131 *(
–m
)->
f›ld
.
Ë_´ev
 = (–m)->f›ld.
Ë_Ãxt
; \

132 }  0)

	)

134 
	#LIST_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

135 (
v¬
èğ((
h—d
)->
lh_fœ¡
); \

136 (
v¬
); \

137 (
v¬
èğ((v¬)->
f›ld
.
Ë_Ãxt
))

	)

142 
	#LIST_EMPTY
(
h—d
è((h—d)->
lh_fœ¡
 =ğ
NULL
)

	)

143 
	#LIST_FIRST
(
h—d
è((h—d)->
lh_fœ¡
)

	)

144 
	#LIST_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
Ë_Ãxt
)

	)

150 
	#SLIST_HEAD
(
Çme
, 
ty³
) \

151 
	sÇme
 { \

152 
ty³
 *
¦h_fœ¡
; \

153 }

	)

155 
	#SLIST_HEAD_INITIALIZER
(
h—d
) \

156 { 
NULL
 }

	)

158 
	#SLIST_ENTRY
(
ty³
) \

160 
ty³
 *
¦e_Ãxt
; \

161 }

	)

166 
	#SLIST_INIT
(
h—d
) do { \

167 (
h—d
)->
¦h_fœ¡
 = 
NULL
; \

168 }  0)

	)

170 
	#SLIST_INSERT_AFTER
(
¦i¡–m
, 
–m
, 
f›ld
) do { \

171 (
–m
)->
f›ld
.
¦e_Ãxt
 = (
¦i¡–m
)->field.sle_next; \

172 (
¦i¡–m
)->
f›ld
.
¦e_Ãxt
 = (
–m
); \

173 }  0)

	)

175 
	#SLIST_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

176 (
–m
)->
f›ld
.
¦e_Ãxt
 = (
h—d
)->
¦h_fœ¡
; \

177 (
h—d
)->
¦h_fœ¡
 = (
–m
); \

178 }  0)

	)

180 
	#SLIST_REMOVE_HEAD
(
h—d
, 
f›ld
) do { \

181 (
h—d
)->
¦h_fœ¡
 = (h—d)->¦h_fœ¡->
f›ld
.
¦e_Ãxt
; \

182 }  0)

	)

184 
	#SLIST_REMOVE
(
h—d
, 
–m
, 
ty³
, 
f›ld
) do { \

185 ià((
h—d
)->
¦h_fœ¡
 =ğ(
–m
)) { \

186 
	`SLIST_REMOVE_HEAD
((
h—d
), 
f›ld
); \

189 
ty³
 *
cu»lm
 = (
h—d
)->
¦h_fœ¡
; \

190 
cu»lm
->
f›ld
.
¦e_Ãxt
 !ğ(
–m
)) \

191 
cu»lm
 = cu»lm->
f›ld
.
¦e_Ãxt
; \

192 
cu»lm
->
f›ld
.
¦e_Ãxt
 = \

193 
cu»lm
->
f›ld
.
¦e_Ãxt
->field.sle_next; \

195 }  0)

	)

197 
	#SLIST_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

198 (
v¬
èğ(
h—d
)->
¦h_fœ¡
; (v¬); (v¬èğ(v¬)->
f›ld
.
¦e_Ãxt
)

	)

203 
	#SLIST_EMPTY
(
h—d
è((h—d)->
¦h_fœ¡
 =ğ
NULL
)

	)

204 
	#SLIST_FIRST
(
h—d
è((h—d)->
¦h_fœ¡
)

	)

205 
	#SLIST_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
¦e_Ãxt
)

	)

211 
	#STAILQ_HEAD
(
Çme
, 
ty³
) \

212 
	sÇme
 { \

213 
ty³
 *
¡qh_fœ¡
; \

214 
ty³
 **
¡qh_Ï¡
; \

215 }

	)

217 
	#STAILQ_HEAD_INITIALIZER
(
h—d
) \

218 { 
NULL
, &(
h—d
).
¡qh_fœ¡
 }

	)

220 
	#STAILQ_ENTRY
(
ty³
) \

222 
ty³
 *
¡qe_Ãxt
; \

223 }

	)

228 
	#STAILQ_INIT
(
h—d
) do { \

229 (
h—d
)->
¡qh_fœ¡
 = 
NULL
; \

230 (
h—d
)->
¡qh_Ï¡
 = &(h—d)->
¡qh_fœ¡
; \

231 }  0)

	)

233 
	#STAILQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

234 ià(((
–m
)->
f›ld
.
¡qe_Ãxt
 = (
h—d
)->
¡qh_fœ¡
è=ğ
NULL
) \

235 (
h—d
)->
¡qh_Ï¡
 = &(
–m
)->
f›ld
.
¡qe_Ãxt
; \

236 (
h—d
)->
¡qh_fœ¡
 = (
–m
); \

237 }  0)

	)

239 
	#STAILQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

240 (
–m
)->
f›ld
.
¡qe_Ãxt
 = 
NULL
; \

241 *(
h—d
)->
¡qh_Ï¡
 = (
–m
); \

242 (
h—d
)->
¡qh_Ï¡
 = &(
–m
)->
f›ld
.
¡qe_Ãxt
; \

243 }  0)

	)

245 
	#STAILQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

246 ià(((
–m
)->
f›ld
.
¡qe_Ãxt
 = (
li¡–m
)->f›ld.¡qe_Ãxtè=ğ
NULL
)\

247 (
h—d
)->
¡qh_Ï¡
 = &(
–m
)->
f›ld
.
¡qe_Ãxt
; \

248 (
li¡–m
)->
f›ld
.
¡qe_Ãxt
 = (
–m
); \

249 }  0)

	)

251 
	#STAILQ_REMOVE_HEAD
(
h—d
, 
f›ld
) do { \

252 ià(((
h—d
)->
¡qh_fœ¡
 = (h—d)->¡qh_fœ¡->
f›ld
.
¡qe_Ãxt
è=ğ
NULL
) \

253 (
h—d
)->
¡qh_Ï¡
 = &(h—d)->
¡qh_fœ¡
; \

254 }  0)

	)

256 
	#STAILQ_REMOVE
(
h—d
, 
–m
, 
ty³
, 
f›ld
) do { \

257 ià((
h—d
)->
¡qh_fœ¡
 =ğ(
–m
)) { \

258 
	`STAILQ_REMOVE_HEAD
((
h—d
), 
f›ld
); \

260 
ty³
 *
cu»lm
 = (
h—d
)->
¡qh_fœ¡
; \

261 
cu»lm
->
f›ld
.
¡qe_Ãxt
 !ğ(
–m
)) \

262 
cu»lm
 = cu»lm->
f›ld
.
¡qe_Ãxt
; \

263 ià((
cu»lm
->
f›ld
.
¡qe_Ãxt
 = \

264 
cu»lm
->
f›ld
.
¡qe_Ãxt
->f›ld.¡qe_Ãxtè=ğ
NULL
) \

265 (
h—d
)->
¡qh_Ï¡
 = &(
cu»lm
)->
f›ld
.
¡qe_Ãxt
; \

267 }  0)

	)

269 
	#STAILQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

270 (
v¬
èğ((
h—d
)->
¡qh_fœ¡
); \

271 (
v¬
); \

272 (
v¬
èğ((v¬)->
f›ld
.
¡qe_Ãxt
))

	)

277 
	#STAILQ_EMPTY
(
h—d
è((h—d)->
¡qh_fœ¡
 =ğ
NULL
)

	)

278 
	#STAILQ_FIRST
(
h—d
è((h—d)->
¡qh_fœ¡
)

	)

279 
	#STAILQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
¡qe_Ãxt
)

	)

285 
	#SIMPLEQ_HEAD
(
Çme
, 
ty³
) \

286 
	sÇme
 { \

287 
ty³
 *
sqh_fœ¡
; \

288 
ty³
 **
sqh_Ï¡
; \

289 }

	)

291 
	#SIMPLEQ_HEAD_INITIALIZER
(
h—d
) \

292 { 
NULL
, &(
h—d
).
sqh_fœ¡
 }

	)

294 
	#SIMPLEQ_ENTRY
(
ty³
) \

296 
ty³
 *
sqe_Ãxt
; \

297 }

	)

302 
	#SIMPLEQ_INIT
(
h—d
) do { \

303 (
h—d
)->
sqh_fœ¡
 = 
NULL
; \

304 (
h—d
)->
sqh_Ï¡
 = &(h—d)->
sqh_fœ¡
; \

305 }  0)

	)

307 
	#SIMPLEQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

308 ià(((
–m
)->
f›ld
.
sqe_Ãxt
 = (
h—d
)->
sqh_fœ¡
è=ğ
NULL
) \

309 (
h—d
)->
sqh_Ï¡
 = &(
–m
)->
f›ld
.
sqe_Ãxt
; \

310 (
h—d
)->
sqh_fœ¡
 = (
–m
); \

311 }  0)

	)

313 
	#SIMPLEQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

314 (
–m
)->
f›ld
.
sqe_Ãxt
 = 
NULL
; \

315 *(
h—d
)->
sqh_Ï¡
 = (
–m
); \

316 (
h—d
)->
sqh_Ï¡
 = &(
–m
)->
f›ld
.
sqe_Ãxt
; \

317 }  0)

	)

319 
	#SIMPLEQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

320 ià(((
–m
)->
f›ld
.
sqe_Ãxt
 = (
li¡–m
)->f›ld.sqe_Ãxtè=ğ
NULL
)\

321 (
h—d
)->
sqh_Ï¡
 = &(
–m
)->
f›ld
.
sqe_Ãxt
; \

322 (
li¡–m
)->
f›ld
.
sqe_Ãxt
 = (
–m
); \

323 }  0)

	)

325 
	#SIMPLEQ_REMOVE_HEAD
(
h—d
, 
f›ld
) do { \

326 ià(((
h—d
)->
sqh_fœ¡
 = (h—d)->sqh_fœ¡->
f›ld
.
sqe_Ãxt
è=ğ
NULL
) \

327 (
h—d
)->
sqh_Ï¡
 = &(h—d)->
sqh_fœ¡
; \

328 }  0)

	)

330 
	#SIMPLEQ_REMOVE
(
h—d
, 
–m
, 
ty³
, 
f›ld
) do { \

331 ià((
h—d
)->
sqh_fœ¡
 =ğ(
–m
)) { \

332 
	`SIMPLEQ_REMOVE_HEAD
((
h—d
), 
f›ld
); \

334 
ty³
 *
cu»lm
 = (
h—d
)->
sqh_fœ¡
; \

335 
cu»lm
->
f›ld
.
sqe_Ãxt
 !ğ(
–m
)) \

336 
cu»lm
 = cu»lm->
f›ld
.
sqe_Ãxt
; \

337 ià((
cu»lm
->
f›ld
.
sqe_Ãxt
 = \

338 
cu»lm
->
f›ld
.
sqe_Ãxt
->f›ld.sqe_Ãxtè=ğ
NULL
) \

339 (
h—d
)->
sqh_Ï¡
 = &(
cu»lm
)->
f›ld
.
sqe_Ãxt
; \

341 }  0)

	)

343 
	#SIMPLEQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

344 (
v¬
èğ((
h—d
)->
sqh_fœ¡
); \

345 (
v¬
); \

346 (
v¬
èğ((v¬)->
f›ld
.
sqe_Ãxt
))

	)

351 
	#SIMPLEQ_EMPTY
(
h—d
è((h—d)->
sqh_fœ¡
 =ğ
NULL
)

	)

352 
	#SIMPLEQ_FIRST
(
h—d
è((h—d)->
sqh_fœ¡
)

	)

353 
	#SIMPLEQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
sqe_Ãxt
)

	)

359 
	#_TAILQ_HEAD
(
Çme
, 
ty³
, 
qu®
) \

360 
	sÇme
 { \

361 
qu®
 
ty³
 *
tqh_fœ¡
; \

362 
qu®
 
ty³
 *qu® *
tqh_Ï¡
; \

363 }

	)

364 
	#TAILQ_HEAD
(
Çme
, 
ty³
è
	`_TAILQ_HEAD
Òame, ty³,)

	)

366 
	#TAILQ_HEAD_INITIALIZER
(
h—d
) \

367 { 
NULL
, &(
h—d
).
tqh_fœ¡
 }

	)

369 
	#_TAILQ_ENTRY
(
ty³
, 
qu®
) \

371 
qu®
 
ty³
 *
tqe_Ãxt
; \

372 
qu®
 
ty³
 *qu® *
tqe_´ev
; \

373 }

	)

374 
	#TAILQ_ENTRY
(
ty³
è
	`_TAILQ_ENTRY
(ty³,)

	)

379 
	#TAILQ_INIT
(
h—d
) do { \

380 (
h—d
)->
tqh_fœ¡
 = 
NULL
; \

381 (
h—d
)->
tqh_Ï¡
 = &(h—d)->
tqh_fœ¡
; \

382 }  0)

	)

384 
	#TAILQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

385 ià(((
–m
)->
f›ld
.
tqe_Ãxt
 = (
h—d
)->
tqh_fœ¡
è!ğ
NULL
) \

386 (
h—d
)->
tqh_fœ¡
->
f›ld
.
tqe_´ev
 = \

387 &(
–m
)->
f›ld
.
tqe_Ãxt
; \

389 (
h—d
)->
tqh_Ï¡
 = &(
–m
)->
f›ld
.
tqe_Ãxt
; \

390 (
h—d
)->
tqh_fœ¡
 = (
–m
); \

391 (
–m
)->
f›ld
.
tqe_´ev
 = &(
h—d
)->
tqh_fœ¡
; \

392 }  0)

	)

394 
	#TAILQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

395 (
–m
)->
f›ld
.
tqe_Ãxt
 = 
NULL
; \

396 (
–m
)->
f›ld
.
tqe_´ev
 = (
h—d
)->
tqh_Ï¡
; \

397 *(
h—d
)->
tqh_Ï¡
 = (
–m
); \

398 (
h—d
)->
tqh_Ï¡
 = &(
–m
)->
f›ld
.
tqe_Ãxt
; \

399 }  0)

	)

401 
	#TAILQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

402 ià(((
–m
)->
f›ld
.
tqe_Ãxt
 = (
li¡–m
)->f›ld.tqe_Ãxtè!ğ
NULL
)\

403 (
–m
)->
f›ld
.
tqe_Ãxt
->f›ld.
tqe_´ev
 = \

404 &(
–m
)->
f›ld
.
tqe_Ãxt
; \

406 (
h—d
)->
tqh_Ï¡
 = &(
–m
)->
f›ld
.
tqe_Ãxt
; \

407 (
li¡–m
)->
f›ld
.
tqe_Ãxt
 = (
–m
); \

408 (
–m
)->
f›ld
.
tqe_´ev
 = &(
li¡–m
)->f›ld.
tqe_Ãxt
; \

409 }  0)

	)

411 
	#TAILQ_INSERT_BEFORE
(
li¡–m
, 
–m
, 
f›ld
) do { \

412 (
–m
)->
f›ld
.
tqe_´ev
 = (
li¡–m
)->field.tqe_prev; \

413 (
–m
)->
f›ld
.
tqe_Ãxt
 = (
li¡–m
); \

414 *(
li¡–m
)->
f›ld
.
tqe_´ev
 = (
–m
); \

415 (
li¡–m
)->
f›ld
.
tqe_´ev
 = &(
–m
)->f›ld.
tqe_Ãxt
; \

416 }  0)

	)

418 
	#TAILQ_REMOVE
(
h—d
, 
–m
, 
f›ld
) do { \

419 ià(((
–m
)->
f›ld
.
tqe_Ãxt
è!ğ
NULL
) \

420 (
–m
)->
f›ld
.
tqe_Ãxt
->f›ld.
tqe_´ev
 = \

421 (
–m
)->
f›ld
.
tqe_´ev
; \

423 (
h—d
)->
tqh_Ï¡
 = (
–m
)->
f›ld
.
tqe_´ev
; \

424 *(
–m
)->
f›ld
.
tqe_´ev
 = (–m)->f›ld.
tqe_Ãxt
; \

425 }  0)

	)

427 
	#TAILQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

428 (
v¬
èğ((
h—d
)->
tqh_fœ¡
); \

429 (
v¬
); \

430 (
v¬
èğ((v¬)->
f›ld
.
tqe_Ãxt
))

	)

432 
	#TAILQ_FOREACH_REVERSE
(
v¬
, 
h—d
, 
h—dÇme
, 
f›ld
) \

433 (
v¬
èğ(*(((
h—dÇme
 *)((
h—d
)->
tqh_Ï¡
))->tqh_last)); \

434 (
v¬
); \

435 (
v¬
èğ(*(((
h—dÇme
 *)((v¬)->
f›ld
.
tqe_´ev
))->
tqh_Ï¡
)))

	)

440 
	#TAILQ_EMPTY
(
h—d
è((h—d)->
tqh_fœ¡
 =ğ
NULL
)

	)

441 
	#TAILQ_FIRST
(
h—d
è((h—d)->
tqh_fœ¡
)

	)

442 
	#TAILQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
tqe_Ãxt
)

	)

444 
	#TAILQ_LAST
(
h—d
, 
h—dÇme
) \

445 (*(((
h—dÇme
 *)((
h—d
)->
tqh_Ï¡
))->tqh_Ï¡))

	)

446 
	#TAILQ_PREV
(
–m
, 
h—dÇme
, 
f›ld
) \

447 (*(((
h—dÇme
 *)((
–m
)->
f›ld
.
tqe_´ev
))->
tqh_Ï¡
))

	)

453 
	#CIRCLEQ_HEAD
(
Çme
, 
ty³
) \

454 
	sÇme
 { \

455 
ty³
 *
cqh_fœ¡
; \

456 
ty³
 *
cqh_Ï¡
; \

457 }

	)

459 
	#CIRCLEQ_HEAD_INITIALIZER
(
h—d
) \

460 { (*)&
h—d
, (*)&h—d }

	)

462 
	#CIRCLEQ_ENTRY
(
ty³
) \

464 
ty³
 *
cqe_Ãxt
; \

465 
ty³
 *
cqe_´ev
; \

466 }

	)

471 
	#CIRCLEQ_INIT
(
h—d
) do { \

472 (
h—d
)->
cqh_fœ¡
 = (*)(head); \

473 (
h—d
)->
cqh_Ï¡
 = (*)(head); \

474 }  0)

	)

476 
	#CIRCLEQ_INSERT_AFTER
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

477 (
–m
)->
f›ld
.
cqe_Ãxt
 = (
li¡–m
)->field.cqe_next; \

478 (
–m
)->
f›ld
.
cqe_´ev
 = (
li¡–m
); \

479 ià((
li¡–m
)->
f›ld
.
cqe_Ãxt
 =ğ(*)(
h—d
)) \

480 (
h—d
)->
cqh_Ï¡
 = (
–m
); \

482 (
li¡–m
)->
f›ld
.
cqe_Ãxt
->f›ld.
cqe_´ev
 = (
–m
); \

483 (
li¡–m
)->
f›ld
.
cqe_Ãxt
 = (
–m
); \

484 }  0)

	)

486 
	#CIRCLEQ_INSERT_BEFORE
(
h—d
, 
li¡–m
, 
–m
, 
f›ld
) do { \

487 (
–m
)->
f›ld
.
cqe_Ãxt
 = (
li¡–m
); \

488 (
–m
)->
f›ld
.
cqe_´ev
 = (
li¡–m
)->field.cqe_prev; \

489 ià((
li¡–m
)->
f›ld
.
cqe_´ev
 =ğ(*)(
h—d
)) \

490 (
h—d
)->
cqh_fœ¡
 = (
–m
); \

492 (
li¡–m
)->
f›ld
.
cqe_´ev
->f›ld.
cqe_Ãxt
 = (
–m
); \

493 (
li¡–m
)->
f›ld
.
cqe_´ev
 = (
–m
); \

494 }  0)

	)

496 
	#CIRCLEQ_INSERT_HEAD
(
h—d
, 
–m
, 
f›ld
) do { \

497 (
–m
)->
f›ld
.
cqe_Ãxt
 = (
h—d
)->
cqh_fœ¡
; \

498 (
–m
)->
f›ld
.
cqe_´ev
 = (*)(
h—d
); \

499 ià((
h—d
)->
cqh_Ï¡
 == (*)(head)) \

500 (
h—d
)->
cqh_Ï¡
 = (
–m
); \

502 (
h—d
)->
cqh_fœ¡
->
f›ld
.
cqe_´ev
 = (
–m
); \

503 (
h—d
)->
cqh_fœ¡
 = (
–m
); \

504 }  0)

	)

506 
	#CIRCLEQ_INSERT_TAIL
(
h—d
, 
–m
, 
f›ld
) do { \

507 (
–m
)->
f›ld
.
cqe_Ãxt
 = (*)(
h—d
); \

508 (
–m
)->
f›ld
.
cqe_´ev
 = (
h—d
)->
cqh_Ï¡
; \

509 ià((
h—d
)->
cqh_fœ¡
 == (*)(head)) \

510 (
h—d
)->
cqh_fœ¡
 = (
–m
); \

512 (
h—d
)->
cqh_Ï¡
->
f›ld
.
cqe_Ãxt
 = (
–m
); \

513 (
h—d
)->
cqh_Ï¡
 = (
–m
); \

514 }  0)

	)

516 
	#CIRCLEQ_REMOVE
(
h—d
, 
–m
, 
f›ld
) do { \

517 ià((
–m
)->
f›ld
.
cqe_Ãxt
 =ğ(*)(
h—d
)) \

518 (
h—d
)->
cqh_Ï¡
 = (
–m
)->
f›ld
.
cqe_´ev
; \

520 (
–m
)->
f›ld
.
cqe_Ãxt
->f›ld.
cqe_´ev
 = \

521 (
–m
)->
f›ld
.
cqe_´ev
; \

522 ià((
–m
)->
f›ld
.
cqe_´ev
 =ğ(*)(
h—d
)) \

523 (
h—d
)->
cqh_fœ¡
 = (
–m
)->
f›ld
.
cqe_Ãxt
; \

525 (
–m
)->
f›ld
.
cqe_´ev
->f›ld.
cqe_Ãxt
 = \

526 (
–m
)->
f›ld
.
cqe_Ãxt
; \

527 }  0)

	)

529 
	#CIRCLEQ_FOREACH
(
v¬
, 
h—d
, 
f›ld
) \

530 (
v¬
èğ((
h—d
)->
cqh_fœ¡
); \

531 (
v¬
è!ğ(cÚ¡ *)(
h—d
); \

532 (
v¬
èğ((v¬)->
f›ld
.
cqe_Ãxt
))

	)

534 
	#CIRCLEQ_FOREACH_REVERSE
(
v¬
, 
h—d
, 
f›ld
) \

535 (
v¬
èğ((
h—d
)->
cqh_Ï¡
); \

536 (
v¬
è!ğ(cÚ¡ *)(
h—d
); \

537 (
v¬
èğ((v¬)->
f›ld
.
cqe_´ev
))

	)

542 
	#CIRCLEQ_EMPTY
(
h—d
è((h—d)->
cqh_fœ¡
 =ğ(*)(h—d))

	)

543 
	#CIRCLEQ_FIRST
(
h—d
è((h—d)->
cqh_fœ¡
)

	)

544 
	#CIRCLEQ_LAST
(
h—d
è((h—d)->
cqh_Ï¡
)

	)

545 
	#CIRCLEQ_NEXT
(
–m
, 
f›ld
è(Ólm)->f›ld.
cqe_Ãxt
)

	)

546 
	#CIRCLEQ_PREV
(
–m
, 
f›ld
è(Ólm)->f›ld.
cqe_´ev
)

	)

548 
	#CIRCLEQ_LOOP_NEXT
(
h—d
, 
–m
, 
f›ld
) \

549 (((
–m
)->
f›ld
.
cqe_Ãxt
 =ğ(*)(
h—d
)) \

550 ? ((
h—d
)->
cqh_fœ¡
) \

551 : (
–m
->
f›ld
.
cqe_Ãxt
))

	)

552 
	#CIRCLEQ_LOOP_PREV
(
h—d
, 
–m
, 
f›ld
) \

553 (((
–m
)->
f›ld
.
cqe_´ev
 =ğ(*)(
h—d
)) \

554 ? ((
h—d
)->
cqh_Ï¡
) \

555 : (
–m
->
f›ld
.
cqe_´ev
))

	)

	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 #iâdeà
__ASSEMBLY__


6 
	tumode_t
;

13 
__sigÃd__
 
	t__s8
;

14 
	t__u8
;

16 
__sigÃd__
 
	t__s16
;

17 
	t__u16
;

19 
__sigÃd__
 
	t__s32
;

20 
	t__u32
;

22 #ifdeà
__i386__


23 #ifdeà
__GNUC__


24 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

25 
__ex‹nsiÚ__
 
	t__u64
;

28 
__sigÃd__
 
	t__s64
;

29 
	t__u64
;

	@/usr/include/linux/byteorder/little_endian.h

1 #iâdeà
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


2 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

4 #iâdeà
__LITTLE_ENDIAN


5 
	#__LITTLE_ENDIAN
 1234

	)

7 #iâdeà
__LITTLE_ENDIAN_BITFIELD


8 
	#__LITTLE_ENDIAN_BITFIELD


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/by‹Üd”/swab.h
>

14 
	#__cÚ¡ªt_htÚl
(
x
èĞ(
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

15 
	#__cÚ¡ªt_Áohl
(
x
è
	`___cÚ¡ªt_swab32
Ğ(
__be32
)(x))

	)

16 
	#__cÚ¡ªt_htÚs
(
x
èĞ(
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

17 
	#__cÚ¡ªt_Áohs
(
x
è
	`___cÚ¡ªt_swab16
Ğ(
__be16
)(x))

	)

18 
	#__cÚ¡ªt_ıu_to_Ë64
(
x
èĞ(
__Ë64
)(
__u64
)(x))

	)

19 
	#__cÚ¡ªt_Ë64_to_ıu
(
x
èĞ(
__u64
)(
__Ë64
)(x))

	)

20 
	#__cÚ¡ªt_ıu_to_Ë32
(
x
èĞ(
__Ë32
)(
__u32
)(x))

	)

21 
	#__cÚ¡ªt_Ë32_to_ıu
(
x
èĞ(
__u32
)(
__Ë32
)(x))

	)

22 
	#__cÚ¡ªt_ıu_to_Ë16
(
x
èĞ(
__Ë16
)(
__u16
)(x))

	)

23 
	#__cÚ¡ªt_Ë16_to_ıu
(
x
èĞ(
__u16
)(
__Ë16
)(x))

	)

24 
	#__cÚ¡ªt_ıu_to_be64
(
x
èĞ(
__be64
)
	`___cÚ¡ªt_swab64
((x)))

	)

25 
	#__cÚ¡ªt_be64_to_ıu
(
x
è
	`___cÚ¡ªt_swab64
Ğ(
__u64
)(
__be64
)(x))

	)

26 
	#__cÚ¡ªt_ıu_to_be32
(
x
èĞ(
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

27 
	#__cÚ¡ªt_be32_to_ıu
(
x
è
	`___cÚ¡ªt_swab32
Ğ(
__u32
)(
__be32
)(x))

	)

28 
	#__cÚ¡ªt_ıu_to_be16
(
x
èĞ(
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

29 
	#__cÚ¡ªt_be16_to_ıu
(
x
è
	`___cÚ¡ªt_swab16
Ğ(
__u16
)(
__be16
)(x))

	)

30 
	#__ıu_to_Ë64
(
x
èĞ(
__Ë64
)(
__u64
)(x))

	)

31 
	#__Ë64_to_ıu
(
x
èĞ(
__u64
)(
__Ë64
)(x))

	)

32 
	#__ıu_to_Ë32
(
x
èĞ(
__Ë32
)(
__u32
)(x))

	)

33 
	#__Ë32_to_ıu
(
x
èĞ(
__u32
)(
__Ë32
)(x))

	)

34 
	#__ıu_to_Ë16
(
x
èĞ(
__Ë16
)(
__u16
)(x))

	)

35 
	#__Ë16_to_ıu
(
x
èĞ(
__u16
)(
__Ë16
)(x))

	)

36 
	#__ıu_to_be64
(
x
èĞ(
__be64
)
	`__swab64
((x)))

	)

37 
	#__be64_to_ıu
(
x
è
	`__swab64
Ğ(
__u64
)(
__be64
)(x))

	)

38 
	#__ıu_to_be32
(
x
èĞ(
__be32
)
	`__swab32
((x)))

	)

39 
	#__be32_to_ıu
(
x
è
	`__swab32
Ğ(
__u32
)(
__be32
)(x))

	)

40 
	#__ıu_to_be16
(
x
èĞ(
__be16
)
	`__swab16
((x)))

	)

41 
	#__be16_to_ıu
(
x
è
	`__swab16
Ğ(
__u16
)(
__be16
)(x))

	)

43 
__šlše__
 
__Ë64
 
	$__ıu_to_Ë64p
(cÚ¡ 
__u64
 *
p
)

45  (
__Ë64
)*
p
;

46 
	}
}

47 
__šlše__
 
__u64
 
	$__Ë64_to_ıup
(cÚ¡ 
__Ë64
 *
p
)

49  (
__u64
)*
p
;

50 
	}
}

51 
__šlše__
 
__Ë32
 
	$__ıu_to_Ë32p
(cÚ¡ 
__u32
 *
p
)

53  (
__Ë32
)*
p
;

54 
	}
}

55 
__šlše__
 
__u32
 
	$__Ë32_to_ıup
(cÚ¡ 
__Ë32
 *
p
)

57  (
__u32
)*
p
;

58 
	}
}

59 
__šlše__
 
__Ë16
 
	$__ıu_to_Ë16p
(cÚ¡ 
__u16
 *
p
)

61  (
__Ë16
)*
p
;

62 
	}
}

63 
__šlše__
 
__u16
 
	$__Ë16_to_ıup
(cÚ¡ 
__Ë16
 *
p
)

65  (
__u16
)*
p
;

66 
	}
}

67 
__šlše__
 
__be64
 
	$__ıu_to_be64p
(cÚ¡ 
__u64
 *
p
)

69  (
__be64
)
	`__swab64p
(
p
);

70 
	}
}

71 
__šlše__
 
__u64
 
	$__be64_to_ıup
(cÚ¡ 
__be64
 *
p
)

73  
	`__swab64p
((
__u64
 *)
p
);

74 
	}
}

75 
__šlše__
 
__be32
 
	$__ıu_to_be32p
(cÚ¡ 
__u32
 *
p
)

77  (
__be32
)
	`__swab32p
(
p
);

78 
	}
}

79 
__šlše__
 
__u32
 
	$__be32_to_ıup
(cÚ¡ 
__be32
 *
p
)

81  
	`__swab32p
((
__u32
 *)
p
);

82 
	}
}

83 
__šlše__
 
__be16
 
	$__ıu_to_be16p
(cÚ¡ 
__u16
 *
p
)

85  (
__be16
)
	`__swab16p
(
p
);

86 
	}
}

87 
__šlše__
 
__u16
 
	$__be16_to_ıup
(cÚ¡ 
__be16
 *
p
)

89  
	`__swab16p
((
__u16
 *)
p
);

90 
	}
}

91 
	#__ıu_to_Ë64s
(
x
èdØ{} 0)

	)

92 
	#__Ë64_to_ıus
(
x
èdØ{} 0)

	)

93 
	#__ıu_to_Ë32s
(
x
èdØ{} 0)

	)

94 
	#__Ë32_to_ıus
(
x
èdØ{} 0)

	)

95 
	#__ıu_to_Ë16s
(
x
èdØ{} 0)

	)

96 
	#__Ë16_to_ıus
(
x
èdØ{} 0)

	)

97 
	#__ıu_to_be64s
(
x
è
	`__swab64s
((x))

	)

98 
	#__be64_to_ıus
(
x
è
	`__swab64s
((x))

	)

99 
	#__ıu_to_be32s
(
x
è
	`__swab32s
((x))

	)

100 
	#__be32_to_ıus
(
x
è
	`__swab32s
((x))

	)

101 
	#__ıu_to_be16s
(
x
è
	`__swab16s
((x))

	)

102 
	#__be16_to_ıus
(
x
è
	`__swab16s
((x))

	)

104 
	~<lšux/by‹Üd”/g’”ic.h
>

	@/usr/include/linux/hdlc/ioctl.h

1 #iâdeà
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

38 
	mşock_¿‹
;

39 
	mşock_ty³
;

40 
	mloİback
;

41 } 
	tsync_£rŸl_£‰šgs
;

44 
	mşock_¿‹
;

45 
	mşock_ty³
;

46 
	mloİback
;

47 
	m¦Ù_m­
;

48 } 
	t‹1_£‰šgs
;

51 
	m’codšg
;

52 
	m·r™y
;

53 } 
	t¿w_hdlc_´Ùo
;

56 
	mt391
;

57 
	mt392
;

58 
	mn391
;

59 
	mn392
;

60 
	mn393
;

61 
	mlmi
;

62 
	mdû
;

63 } 
	tä_´Ùo
;

66 
	mdlci
;

67 } 
	tä_´Ùo_pvc
;

70 
	mdlci
;

71 
	mma¡”
[
IFNAMSIZ
];

72 }
	tä_´Ùo_pvc_šfo
;

75 
	mš‹rv®
;

76 
	mtimeout
;

77 } 
	tcisco_´Ùo
;

	@/usr/include/linux/if_addr.h

1 #iâdeà
__LINUX_IF_ADDR_H


2 
	#__LINUX_IF_ADDR_H


	)

4 
	~<lšux/Ãšk.h
>

6 
	siçddrmsg


8 
__u8
 
	miç_çmy
;

9 
__u8
 
	miç_´efixËn
;

10 
__u8
 
	miç_æags
;

11 
__u8
 
	miç_scİe
;

12 
__u32
 
	miç_šdex
;

24 
	mIFA_UNSPEC
,

25 
	mIFA_ADDRESS
,

26 
	mIFA_LOCAL
,

27 
	mIFA_LABEL
,

28 
	mIFA_BROADCAST
,

29 
	mIFA_ANYCAST
,

30 
	mIFA_CACHEINFO
,

31 
	mIFA_MULTICAST
,

32 
	m__IFA_MAX
,

35 
	#IFA_MAX
 (
__IFA_MAX
 - 1)

	)

38 
	#IFA_F_SECONDARY
 0x01

	)

39 
	#IFA_F_TEMPORARY
 
IFA_F_SECONDARY


	)

41 
	#IFA_F_NODAD
 0x02

	)

42 
	#IFA_F_OPTIMISTIC
 0x04

	)

43 
	#IFA_F_HOMEADDRESS
 0x10

	)

44 
	#IFA_F_DEPRECATED
 0x20

	)

45 
	#IFA_F_TENTATIVE
 0x40

	)

46 
	#IFA_F_PERMANENT
 0x80

	)

48 
	siç_ÿchešfo


50 
__u32
 
	miç_´eã»d
;

51 
__u32
 
	miç_v®id
;

52 
__u32
 
	mc¡amp
;

53 
__u32
 
	mt¡amp
;

57 
	#IFA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
içddrmsg
))))

	)

58 
	#IFA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
içddrmsg
))

	)

	@/usr/include/linux/if_ether.h

21 #iâdeà
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<lšux/ty³s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_IP
 0x0800

	)

46 
	#ETH_P_X25
 0x0805

	)

47 
	#ETH_P_ARP
 0x0806

	)

48 
	#ETH_P_BPQ
 0x08FF

	)

49 
	#ETH_P_IEEEPUP
 0x0a00

	)

50 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

51 
	#ETH_P_DEC
 0x6000

	)

52 
	#ETH_P_DNA_DL
 0x6001

	)

53 
	#ETH_P_DNA_RC
 0x6002

	)

54 
	#ETH_P_DNA_RT
 0x6003

	)

55 
	#ETH_P_LAT
 0x6004

	)

56 
	#ETH_P_DIAG
 0x6005

	)

57 
	#ETH_P_CUST
 0x6006

	)

58 
	#ETH_P_SCA
 0x6007

	)

59 
	#ETH_P_RARP
 0x8035

	)

60 
	#ETH_P_ATALK
 0x809B

	)

61 
	#ETH_P_AARP
 0x80F3

	)

62 
	#ETH_P_8021Q
 0x8100

	)

63 
	#ETH_P_IPX
 0x8137

	)

64 
	#ETH_P_IPV6
 0x86DD

	)

65 
	#ETH_P_PAUSE
 0x8808

	)

66 
	#ETH_P_SLOW
 0x8809

	)

67 
	#ETH_P_WCCP
 0x883E

	)

69 
	#ETH_P_PPP_DISC
 0x8863

	)

70 
	#ETH_P_PPP_SES
 0x8864

	)

71 
	#ETH_P_MPLS_UC
 0x8847

	)

72 
	#ETH_P_MPLS_MC
 0x8848

	)

73 
	#ETH_P_ATMMPOA
 0x884ø

	)

74 
	#ETH_P_ATMFATE
 0x8884

	)

77 
	#ETH_P_AOE
 0x88A2

	)

78 
	#ETH_P_TIPC
 0x88CA

	)

84 
	#ETH_P_802_3
 0x0001

	)

85 
	#ETH_P_AX25
 0x0002

	)

86 
	#ETH_P_ALL
 0x0003

	)

87 
	#ETH_P_802_2
 0x0004

	)

88 
	#ETH_P_SNAP
 0x0005

	)

89 
	#ETH_P_DDCMP
 0x0006

	)

90 
	#ETH_P_WAN_PPP
 0x0007

	)

91 
	#ETH_P_PPP_MP
 0x0008

	)

92 
	#ETH_P_LOCALTALK
 0x0009

	)

93 
	#ETH_P_PPPTALK
 0x0010

	)

94 
	#ETH_P_TR_802_2
 0x0011

	)

95 
	#ETH_P_MOBITEX
 0x0015

	)

96 
	#ETH_P_CONTROL
 0x0016

	)

97 
	#ETH_P_IRDA
 0x0017

	)

98 
	#ETH_P_ECONET
 0x0018

	)

99 
	#ETH_P_HDLC
 0x0019

	)

100 
	#ETH_P_ARCNET
 0x001A

	)

106 
	s‘hhdr
 {

107 
	mh_de¡
[
ETH_ALEN
];

108 
	mh_sourû
[
ETH_ALEN
];

109 
__be16
 
	mh_´Ùo
;

110 } 
__©Œibu‹__
((
·cked
));

	@/usr/include/linux/if_link.h

1 #iâdeà
_LINUX_IF_LINK_H


2 
	#_LINUX_IF_LINK_H


	)

4 
	~<lšux/Ãšk.h
>

7 
	s¹Æ_lšk_¡©s


9 
__u32
 
	mrx_·ck‘s
;

10 
__u32
 
	mtx_·ck‘s
;

11 
__u32
 
	mrx_by‹s
;

12 
__u32
 
	mtx_by‹s
;

13 
__u32
 
	mrx_”rÜs
;

14 
__u32
 
	mtx_”rÜs
;

15 
__u32
 
	mrx_drİ³d
;

16 
__u32
 
	mtx_drİ³d
;

17 
__u32
 
	mmuÉiÿ¡
;

18 
__u32
 
	mcŞlisiÚs
;

21 
__u32
 
	mrx_Ëngth_”rÜs
;

22 
__u32
 
	mrx_ov”_”rÜs
;

23 
__u32
 
	mrx_üc_”rÜs
;

24 
__u32
 
	mrx_äame_”rÜs
;

25 
__u32
 
	mrx_fifo_”rÜs
;

26 
__u32
 
	mrx_mis£d_”rÜs
;

29 
__u32
 
	mtx_abÜ‹d_”rÜs
;

30 
__u32
 
	mtx_ÿ¼›r_”rÜs
;

31 
__u32
 
	mtx_fifo_”rÜs
;

32 
__u32
 
	mtx_h—¹b—t_”rÜs
;

33 
__u32
 
	mtx_wšdow_”rÜs
;

36 
__u32
 
	mrx_com´es£d
;

37 
__u32
 
	mtx_com´es£d
;

41 
	s¹Æ_lšk_ifm­


43 
__u64
 
	mmem_¡¬t
;

44 
__u64
 
	mmem_’d
;

45 
__u64
 
	mba£_addr
;

46 
__u16
 
	mœq
;

47 
__u8
 
	mdma
;

48 
__u8
 
	mpÜt
;

53 
	mIFLA_UNSPEC
,

54 
	mIFLA_ADDRESS
,

55 
	mIFLA_BROADCAST
,

56 
	mIFLA_IFNAME
,

57 
	mIFLA_MTU
,

58 
	mIFLA_LINK
,

59 
	mIFLA_QDISC
,

60 
	mIFLA_STATS
,

61 
	mIFLA_COST
,

62 
	#IFLA_COST
 
IFLA_COST


	)

63 
	mIFLA_PRIORITY
,

64 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

65 
	mIFLA_MASTER
,

66 
	#IFLA_MASTER
 
IFLA_MASTER


	)

67 
	mIFLA_WIRELESS
,

68 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

69 
	mIFLA_PROTINFO
,

70 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

71 
	mIFLA_TXQLEN
,

72 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

73 
	mIFLA_MAP
,

74 
	#IFLA_MAP
 
IFLA_MAP


	)

75 
	mIFLA_WEIGHT
,

76 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

77 
	mIFLA_OPERSTATE
,

78 
	mIFLA_LINKMODE
,

79 
	mIFLA_LINKINFO
,

80 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

81 
	mIFLA_NET_NS_PID
,

82 
	m__IFLA_MAX


86 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

89 
	#IFLA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
ifšfomsg
))))

	)

90 
	#IFLA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
ifšfomsg
))

	)

124 
	mIFLA_INET6_UNSPEC
,

125 
	mIFLA_INET6_FLAGS
,

126 
	mIFLA_INET6_CONF
,

127 
	mIFLA_INET6_STATS
,

128 
	mIFLA_INET6_MCAST
,

129 
	mIFLA_INET6_CACHEINFO
,

130 
	mIFLA_INET6_ICMP6STATS
,

131 
	m__IFLA_INET6_MAX


134 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

136 
	siæa_ÿchešfo


138 
__u32
 
	mmax_»asm_Ën
;

139 
__u32
 
	mt¡amp
;

140 
__u32
 
	m»achabË_time
;

141 
__u32
 
	m»Œªs_time
;

146 
	mIFLA_INFO_UNSPEC
,

147 
	mIFLA_INFO_KIND
,

148 
	mIFLA_INFO_DATA
,

149 
	mIFLA_INFO_XSTATS
,

150 
	m__IFLA_INFO_MAX
,

153 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

159 
	mIFLA_VLAN_UNSPEC
,

160 
	mIFLA_VLAN_ID
,

161 
	mIFLA_VLAN_FLAGS
,

162 
	mIFLA_VLAN_EGRESS_QOS
,

163 
	mIFLA_VLAN_INGRESS_QOS
,

164 
	m__IFLA_VLAN_MAX
,

167 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

169 
	siæa_vÏn_æags
 {

170 
__u32
 
	mæags
;

171 
__u32
 
	mmask
;

176 
	mIFLA_VLAN_QOS_UNSPEC
,

177 
	mIFLA_VLAN_QOS_MAPPING
,

178 
	m__IFLA_VLAN_QOS_MAX


181 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

183 
	siæa_vÏn_qos_m­pšg


185 
__u32
 
	mäom
;

186 
__u32
 
	mto
;

	@/usr/include/linux/if_packet.h

1 #iâdeà
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<lšux/ty³s.h
>

6 
	ssockaddr_pkt


8 
	m¥kt_çmy
;

9 
	m¥kt_deviû
[14];

10 
__be16
 
	m¥kt_´ÙocŞ
;

13 
	ssockaddr_Î


15 
	m¦l_çmy
;

16 
__be16
 
	m¦l_´ÙocŞ
;

17 
	m¦l_ifšdex
;

18 
	m¦l_h©y³
;

19 
	m¦l_pk‰y³
;

20 
	m¦l_h®’
;

21 
	m¦l_addr
[8];

26 
	#PACKET_HOST
 0

	)

27 
	#PACKET_BROADCAST
 1

	)

28 
	#PACKET_MULTICAST
 2

	)

29 
	#PACKET_OTHERHOST
 3

	)

30 
	#PACKET_OUTGOING
 4

	)

32 
	#PACKET_LOOPBACK
 5

	)

33 
	#PACKET_FASTROUTE
 6

	)

37 
	#PACKET_ADD_MEMBERSHIP
 1

	)

38 
	#PACKET_DROP_MEMBERSHIP
 2

	)

39 
	#PACKET_RECV_OUTPUT
 3

	)

41 
	#PACKET_RX_RING
 5

	)

42 
	#PACKET_STATISTICS
 6

	)

43 
	#PACKET_COPY_THRESH
 7

	)

44 
	#PACKET_AUXDATA
 8

	)

45 
	#PACKET_ORIGDEV
 9

	)

47 
	sack‘_¡©s


49 
	m_·ck‘s
;

50 
	m_drİs
;

53 
	sack‘_auxd©a


55 
__u32
 
	m_¡©us
;

56 
__u32
 
	m_Ën
;

57 
__u32
 
	m_¢­Ën
;

58 
__u16
 
	m_mac
;

59 
__u16
 
	m_Ãt
;

62 
	sack‘_hdr


64 
	m_¡©us
;

65 
	#TP_STATUS_KERNEL
 0

	)

66 
	#TP_STATUS_USER
 1

	)

67 
	#TP_STATUS_COPY
 2

	)

68 
	#TP_STATUS_LOSING
 4

	)

69 
	#TP_STATUS_CSUMNOTREADY
 8

	)

70 
	m_Ën
;

71 
	m_¢­Ën
;

72 
	m_mac
;

73 
	m_Ãt
;

74 
	m_£c
;

75 
	m_u£c
;

78 
	#TPACKET_ALIGNMENT
 16

	)

79 
	#TPACKET_ALIGN
(
x
è(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

80 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘_hdr
)è+ (
sockaddr_Î
))

	)

95 
	sack‘_»q


97 
	m_block_size
;

98 
	m_block_Ä
;

99 
	m_äame_size
;

100 
	m_äame_Ä
;

103 
	s·ck‘_m»q


105 
	mmr_ifšdex
;

106 
	mmr_ty³
;

107 
	mmr_®’
;

108 
	mmr_add»ss
[8];

111 
	#PACKET_MR_MULTICAST
 0

	)

112 
	#PACKET_MR_PROMISC
 1

	)

113 
	#PACKET_MR_ALLMULTI
 2

	)

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/limits.h

1 #iâdeà
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/neighbour.h

1 #iâdeà
__LINUX_NEIGHBOUR_H


2 
	#__LINUX_NEIGHBOUR_H


	)

4 
	~<lšux/Ãšk.h
>

6 
	sndmsg


8 
__u8
 
	mndm_çmy
;

9 
__u8
 
	mndm_·d1
;

10 
__u16
 
	mndm_·d2
;

11 
__s32
 
	mndm_ifšdex
;

12 
__u16
 
	mndm_¡©e
;

13 
__u8
 
	mndm_æags
;

14 
__u8
 
	mndm_ty³
;

19 
	mNDA_UNSPEC
,

20 
	mNDA_DST
,

21 
	mNDA_LLADDR
,

22 
	mNDA_CACHEINFO
,

23 
	mNDA_PROBES
,

24 
	m__NDA_MAX


27 
	#NDA_MAX
 (
__NDA_MAX
 - 1)

	)

33 
	#NTF_PROXY
 0x08

	)

34 
	#NTF_ROUTER
 0x80

	)

40 
	#NUD_INCOMPLETE
 0x01

	)

41 
	#NUD_REACHABLE
 0x02

	)

42 
	#NUD_STALE
 0x04

	)

43 
	#NUD_DELAY
 0x08

	)

44 
	#NUD_PROBE
 0x10

	)

45 
	#NUD_FAILED
 0x20

	)

48 
	#NUD_NOARP
 0x40

	)

49 
	#NUD_PERMANENT
 0x80

	)

50 
	#NUD_NONE
 0x00

	)

57 
	snda_ÿchešfo


59 
__u32
 
	mndm_cÚfœmed
;

60 
__u32
 
	mndm_u£d
;

61 
__u32
 
	mndm_upd©ed
;

62 
__u32
 
	mndm_»fút
;

90 
	sndt_¡©s


92 
__u64
 
	mndts_®locs
;

93 
__u64
 
	mndts_de¡roys
;

94 
__u64
 
	mndts_hash_grows
;

95 
__u64
 
	mndts_»s_çed
;

96 
__u64
 
	mndts_lookups
;

97 
__u64
 
	mndts_h™s
;

98 
__u64
 
	mndts_rcv_´obes_mÿ¡
;

99 
__u64
 
	mndts_rcv_´obes_uÿ¡
;

100 
__u64
 
	mndts_³riodic_gc_runs
;

101 
__u64
 
	mndts_fÜûd_gc_runs
;

105 
	mNDTPA_UNSPEC
,

106 
	mNDTPA_IFINDEX
,

107 
	mNDTPA_REFCNT
,

108 
	mNDTPA_REACHABLE_TIME
,

109 
	mNDTPA_BASE_REACHABLE_TIME
,

110 
	mNDTPA_RETRANS_TIME
,

111 
	mNDTPA_GC_STALETIME
,

112 
	mNDTPA_DELAY_PROBE_TIME
,

113 
	mNDTPA_QUEUE_LEN
,

114 
	mNDTPA_APP_PROBES
,

115 
	mNDTPA_UCAST_PROBES
,

116 
	mNDTPA_MCAST_PROBES
,

117 
	mNDTPA_ANYCAST_DELAY
,

118 
	mNDTPA_PROXY_DELAY
,

119 
	mNDTPA_PROXY_QLEN
,

120 
	mNDTPA_LOCKTIME
,

121 
	m__NDTPA_MAX


123 
	#NDTPA_MAX
 (
__NDTPA_MAX
 - 1)

	)

125 
	sndtmsg


127 
__u8
 
	mndtm_çmy
;

128 
__u8
 
	mndtm_·d1
;

129 
__u16
 
	mndtm_·d2
;

132 
	sndt_cÚfig


134 
__u16
 
	mndtc_key_Ën
;

135 
__u16
 
	mndtc_’Œy_size
;

136 
__u32
 
	mndtc_’Œ›s
;

137 
__u32
 
	mndtc_Ï¡_æush
;

138 
__u32
 
	mndtc_Ï¡_¿nd
;

139 
__u32
 
	mndtc_hash_ºd
;

140 
__u32
 
	mndtc_hash_mask
;

141 
__u32
 
	mndtc_hash_chaš_gc
;

142 
__u32
 
	mndtc_´oxy_qËn
;

146 
	mNDTA_UNSPEC
,

147 
	mNDTA_NAME
,

148 
	mNDTA_THRESH1
,

149 
	mNDTA_THRESH2
,

150 
	mNDTA_THRESH3
,

151 
	mNDTA_CONFIG
,

152 
	mNDTA_PARMS
,

153 
	mNDTA_STATS
,

154 
	mNDTA_GC_INTERVAL
,

155 
	m__NDTA_MAX


157 
	#NDTA_MAX
 (
__NDTA_MAX
 - 1)

	)

	@/usr/include/linux/netlink.h

1 #iâdeà
__LINUX_NETLINK_H


2 
	#__LINUX_NETLINK_H


	)

4 
	~<lšux/sock‘.h
>

5 
	~<lšux/ty³s.h
>

7 
	#NETLINK_ROUTE
 0

	)

8 
	#NETLINK_UNUSED
 1

	)

9 
	#NETLINK_USERSOCK
 2

	)

10 
	#NETLINK_FIREWALL
 3

	)

11 
	#NETLINK_INET_DIAG
 4

	)

12 
	#NETLINK_NFLOG
 5

	)

13 
	#NETLINK_XFRM
 6

	)

14 
	#NETLINK_SELINUX
 7

	)

15 
	#NETLINK_ISCSI
 8

	)

16 
	#NETLINK_AUDIT
 9

	)

17 
	#NETLINK_FIB_LOOKUP
 10

	)

18 
	#NETLINK_CONNECTOR
 11

	)

19 
	#NETLINK_NETFILTER
 12

	)

20 
	#NETLINK_IP6_FW
 13

	)

21 
	#NETLINK_DNRTMSG
 14

	)

22 
	#NETLINK_KOBJECT_UEVENT
 15

	)

23 
	#NETLINK_GENERIC
 16

	)

25 
	#NETLINK_SCSITRANSPORT
 18

	)

26 
	#NETLINK_ECRYPTFS
 19

	)

28 
	#MAX_LINKS
 32

	)

30 
	gÃt
;

32 
	ssockaddr_Æ


34 
§_çmy_t
 
	mÆ_çmy
;

35 
	mÆ_·d
;

36 
__u32
 
	mÆ_pid
;

37 
__u32
 
	mÆ_groups
;

40 
	sÆmsghdr


42 
__u32
 
	mÆmsg_Ën
;

43 
__u16
 
	mÆmsg_ty³
;

44 
__u16
 
	mÆmsg_æags
;

45 
__u32
 
	mÆmsg_£q
;

46 
__u32
 
	mÆmsg_pid
;

51 
	#NLM_F_REQUEST
 1

	)

52 
	#NLM_F_MULTI
 2

	)

53 
	#NLM_F_ACK
 4

	)

54 
	#NLM_F_ECHO
 8

	)

57 
	#NLM_F_ROOT
 0x100

	)

58 
	#NLM_F_MATCH
 0x200

	)

59 
	#NLM_F_ATOMIC
 0x400

	)

60 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

63 
	#NLM_F_REPLACE
 0x100

	)

64 
	#NLM_F_EXCL
 0x200

	)

65 
	#NLM_F_CREATE
 0x400

	)

66 
	#NLM_F_APPEND
 0x800

	)

77 
	#NLMSG_ALIGNTO
 4

	)

78 
	#NLMSG_ALIGN
(
Ën
èĞ(Ö’)+
NLMSG_ALIGNTO
-1è& ~(NLMSG_ALIGNTO-1è)

	)

79 
	#NLMSG_HDRLEN
 ((è
	`NLMSG_ALIGN
((
Æmsghdr
)))

	)

80 
	#NLMSG_LENGTH
(
Ën
è(Ö’)+
	`NLMSG_ALIGN
(
NLMSG_HDRLEN
))

	)

81 
	#NLMSG_SPACE
(
Ën
è
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
Ö’))

	)

82 
	#NLMSG_DATA
(
Æh
è((*)(((*êlhè+ 
	`NLMSG_LENGTH
(0)))

	)

83 
	#NLMSG_NEXT
(
Æh
,
Ën
è(Ö’è-ğ
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
), \

84 (
Æmsghdr
*)(((*)(
Æh
)è+ 
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
)))

	)

85 
	#NLMSG_OK
(
Æh
,
Ën
è(Ö’è>ğ()(
Æmsghdr
) && \

86 (
Æh
)->
Æmsg_Ën
 >ğ(
Æmsghdr
) && \

87 (
Æh
)->
Æmsg_Ën
 <ğ(
Ën
))

	)

88 
	#NLMSG_PAYLOAD
(
Æh
,
Ën
è(Òlh)->
Æmsg_Ën
 - 
	`NLMSG_SPACE
(Ö’)))

	)

90 
	#NLMSG_NOOP
 0x1

	)

91 
	#NLMSG_ERROR
 0x2

	)

92 
	#NLMSG_DONE
 0x3

	)

93 
	#NLMSG_OVERRUN
 0x4

	)

95 
	#NLMSG_MIN_TYPE
 0x10

	)

97 
	sÆmsg”r


99 
	m”rÜ
;

100 
Æmsghdr
 
	mmsg
;

103 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

104 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

105 
	#NETLINK_PKTINFO
 3

	)

107 
	sÆ_pktšfo


109 
__u32
 
	mgroup
;

112 
	#NET_MAJOR
 36

	)

115 
	mNETLINK_UNCONNECTED
 = 0,

116 
	mNETLINK_CONNECTED
,

128 
	sÆ©Œ


130 
__u16
 
	mÆa_Ën
;

131 
__u16
 
	mÆa_ty³
;

144 
	#NLA_F_NESTED
 (1 << 15)

	)

145 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

146 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

148 
	#NLA_ALIGNTO
 4

	)

149 
	#NLA_ALIGN
(
Ën
è((Ö’è+ 
NLA_ALIGNTO
 - 1è& ~(NLA_ALIGNTO - 1))

	)

150 
	#NLA_HDRLEN
 ((è
	`NLA_ALIGN
((
Æ©Œ
)))

	)

	@/usr/include/linux/socket.h

1 #iâdeà
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__®ignof__
 (
sockaddr
 *))

	)

11 
	s__k”Ãl_sockaddr_¡Üage
 {

12 
	mss_çmy
;

14 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

17 } 
__©Œibu‹__
 ((
®igÃd
(
_K_SS_ALIGNSIZE
)));

19 #ià
defšed
(
__KERNEL__
è|| !defšed(
__GLIBC__
) || (__GLIBC__ < 2)

21 
	~<asm/sock‘.h
>

22 
	~<lšux/sockios.h
>

23 
	~<lšux/uio.h
>

24 
	~<lšux/ty³s.h
>

26 
sysùl_somaxcÚn
;

27 #ifdeà
CONFIG_PROC_FS


28 
	g£q_fe
;

29 
sock‘_£q_show
(
£q_fe
 *
£q
);

32 
	t§_çmy_t
;

38 
	ssockaddr
 {

39 
§_çmy_t
 
	m§_çmy
;

40 
	m§_d©a
[14];

43 
	slšg”
 {

44 
	ml_Úoff
;

45 
	ml_lšg”
;

48 
	#sockaddr_¡Üage
 
__k”Ãl_sockaddr_¡Üage


	)

56 
	smsghdr
 {

57 * 
	mmsg_Çme
;

58 
	mmsg_Çm–’
;

59 
iovec
 * 
	mmsg_iov
;

60 
__k”Ãl_size_t
 
	mmsg_iovËn
;

61 * 
	mmsg_cÚŒŞ
;

62 
__k”Ãl_size_t
 
	mmsg_cÚŒŞËn
;

63 
	mmsg_æags
;

72 
	scmsghdr
 {

73 
__k”Ãl_size_t
 
	mcmsg_Ën
;

74 
	mcmsg_Ëv–
;

75 
	mcmsg_ty³
;

83 
	#__CMSG_NXTHDR
(
ùl
, 
Ën
, 
cmsg
è
	`__cmsg_nxthdr
((ùl),Ö’),(cmsg))

	)

84 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`cmsg_nxthdr
((mhdr), (cmsg))

	)

86 
	#CMSG_ALIGN
(
Ën
èĞ(Ö’)+()-1è& ~(()-1è)

	)

88 
	#CMSG_DATA
(
cmsg
è((*)((*)(cmsgè+ 
	`CMSG_ALIGN
((
cmsghdr
))))

	)

89 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
((
cmsghdr
)è+ CMSG_ALIGNÖ’))

	)

90 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
((
cmsghdr
)è+ (Ën))

	)

92 
	#__CMSG_FIRSTHDR
(
ùl
,
Ën
è(Ö’è>ğ(
cmsghdr
) ? \

93 (
cmsghdr
 *)(
ùl
) : \

94 (
cmsghdr
 *)
NULL
)

	)

95 
	#CMSG_FIRSTHDR
(
msg
è
	`__CMSG_FIRSTHDR
((msg)->
msg_cÚŒŞ
, (msg)->
msg_cÚŒŞËn
)

	)

96 
	#CMSG_OK
(
mhdr
, 
cmsg
è((cmsg)->
cmsg_Ën
 >ğ(
cmsghdr
) && \

97 (
cmsg
)->
cmsg_Ën
 <= () \

98 ((
mhdr
)->
msg_cÚŒŞËn
 - \

99 ((*)(
cmsg
è- (*)(
mhdr
)->
msg_cÚŒŞ
)))

	)

105 #ià 
defšed
(
__GNUC__
)

106 
	#__KINLINE
 
__šlše__


	)

107 #–ià
defšed
(
__ılu¥lus
)

108 
	#__KINLINE
 
šlše


	)

110 
	#__KINLINE
 

	)

127 
__KINLINE
 
cmsghdr
 * 
	$__cmsg_nxthdr
(*
__ùl
, 
__k”Ãl_size_t
 
__size
,

128 
cmsghdr
 *
__cmsg
)

130 
cmsghdr
 * 
__±r
;

132 
__±r
 = (
cmsghdr
*)(((*è
__cmsg
è+ 
	`CMSG_ALIGN
(__cmsg->
cmsg_Ën
));

133 ià(()((*)(
__±r
+1è- (*è
__ùl
è> 
__size
)

134  (
cmsghdr
 *)0;

136  
__±r
;

137 
	}
}

139 
__KINLINE
 
cmsghdr
 * 
	$cmsg_nxthdr
 (
msghdr
 *
__msg
, 
cmsghdr
 *
__cmsg
)

141  
	`__cmsg_nxthdr
(
__msg
->
msg_cÚŒŞ
, __msg->
msg_cÚŒŞËn
, 
__cmsg
);

142 
	}
}

146 
	#SCM_RIGHTS
 0x01

	)

147 
	#SCM_CREDENTIALS
 0x02

	)

148 
	#SCM_SECURITY
 0x03

	)

150 
	suüed
 {

151 
__u32
 
	mpid
;

152 
__u32
 
	muid
;

153 
__u32
 
	mgid
;

157 
	#AF_UNSPEC
 0

	)

158 
	#AF_UNIX
 1

	)

159 
	#AF_LOCAL
 1

	)

160 
	#AF_INET
 2

	)

161 
	#AF_AX25
 3

	)

162 
	#AF_IPX
 4

	)

163 
	#AF_APPLETALK
 5

	)

164 
	#AF_NETROM
 6

	)

165 
	#AF_BRIDGE
 7

	)

166 
	#AF_ATMPVC
 8

	)

167 
	#AF_X25
 9

	)

168 
	#AF_INET6
 10

	)

169 
	#AF_ROSE
 11

	)

170 
	#AF_DECÃt
 12

	)

171 
	#AF_NETBEUI
 13

	)

172 
	#AF_SECURITY
 14

	)

173 
	#AF_KEY
 15

	)

174 
	#AF_NETLINK
 16

	)

175 
	#AF_ROUTE
 
AF_NETLINK


	)

176 
	#AF_PACKET
 17

	)

177 
	#AF_ASH
 18

	)

178 
	#AF_ECONET
 19

	)

179 
	#AF_ATMSVC
 20

	)

180 
	#AF_SNA
 22

	)

181 
	#AF_IRDA
 23

	)

182 
	#AF_PPPOX
 24

	)

183 
	#AF_WANPIPE
 25

	)

184 
	#AF_LLC
 26

	)

185 
	#AF_TIPC
 30

	)

186 
	#AF_BLUETOOTH
 31

	)

187 
	#AF_IUCV
 32

	)

188 
	#AF_RXRPC
 33

	)

189 
	#AF_MAX
 34

	)

192 
	#PF_UNSPEC
 
AF_UNSPEC


	)

193 
	#PF_UNIX
 
AF_UNIX


	)

194 
	#PF_LOCAL
 
AF_LOCAL


	)

195 
	#PF_INET
 
AF_INET


	)

196 
	#PF_AX25
 
AF_AX25


	)

197 
	#PF_IPX
 
AF_IPX


	)

198 
	#PF_APPLETALK
 
AF_APPLETALK


	)

199 
	#PF_NETROM
 
AF_NETROM


	)

200 
	#PF_BRIDGE
 
AF_BRIDGE


	)

201 
	#PF_ATMPVC
 
AF_ATMPVC


	)

202 
	#PF_X25
 
AF_X25


	)

203 
	#PF_INET6
 
AF_INET6


	)

204 
	#PF_ROSE
 
AF_ROSE


	)

205 
	#PF_DECÃt
 
AF_DECÃt


	)

206 
	#PF_NETBEUI
 
AF_NETBEUI


	)

207 
	#PF_SECURITY
 
AF_SECURITY


	)

208 
	#PF_KEY
 
AF_KEY


	)

209 
	#PF_NETLINK
 
AF_NETLINK


	)

210 
	#PF_ROUTE
 
AF_ROUTE


	)

211 
	#PF_PACKET
 
AF_PACKET


	)

212 
	#PF_ASH
 
AF_ASH


	)

213 
	#PF_ECONET
 
AF_ECONET


	)

214 
	#PF_ATMSVC
 
AF_ATMSVC


	)

215 
	#PF_SNA
 
AF_SNA


	)

216 
	#PF_IRDA
 
AF_IRDA


	)

217 
	#PF_PPPOX
 
AF_PPPOX


	)

218 
	#PF_WANPIPE
 
AF_WANPIPE


	)

219 
	#PF_LLC
 
AF_LLC


	)

220 
	#PF_TIPC
 
AF_TIPC


	)

221 
	#PF_BLUETOOTH
 
AF_BLUETOOTH


	)

222 
	#PF_IUCV
 
AF_IUCV


	)

223 
	#PF_RXRPC
 
AF_RXRPC


	)

224 
	#PF_MAX
 
AF_MAX


	)

227 
	#SOMAXCONN
 128

	)

233 
	#MSG_OOB
 1

	)

234 
	#MSG_PEEK
 2

	)

235 
	#MSG_DONTROUTE
 4

	)

236 
	#MSG_TRYHARD
 4

	)

237 
	#MSG_CTRUNC
 8

	)

238 
	#MSG_PROBE
 0x10

	)

239 
	#MSG_TRUNC
 0x20

	)

240 
	#MSG_DONTWAIT
 0x40

	)

241 
	#MSG_EOR
 0x80

	)

242 
	#MSG_WAITALL
 0x100

	)

243 
	#MSG_FIN
 0x200

	)

244 
	#MSG_SYN
 0x400

	)

245 
	#MSG_CONFIRM
 0x800

	)

246 
	#MSG_RST
 0x1000

	)

247 
	#MSG_ERRQUEUE
 0x2000

	)

248 
	#MSG_NOSIGNAL
 0x4000

	)

249 
	#MSG_MORE
 0x8000

	)

251 
	#MSG_EOF
 
MSG_FIN


	)

253 
	#MSG_CMSG_CLOEXEC
 0x40000000

	)

256 #ià
defšed
(
CONFIG_COMPAT
)

257 
	#MSG_CMSG_COMPAT
 0x80000000

	)

259 
	#MSG_CMSG_COMPAT
 0

	)

264 
	#SOL_IP
 0

	)

266 
	#SOL_TCP
 6

	)

267 
	#SOL_UDP
 17

	)

268 
	#SOL_IPV6
 41

	)

269 
	#SOL_ICMPV6
 58

	)

270 
	#SOL_SCTP
 132

	)

271 
	#SOL_UDPLITE
 136

	)

272 
	#SOL_RAW
 255

	)

273 
	#SOL_IPX
 256

	)

274 
	#SOL_AX25
 257

	)

275 
	#SOL_ATALK
 258

	)

276 
	#SOL_NETROM
 259

	)

277 
	#SOL_ROSE
 260

	)

278 
	#SOL_DECNET
 261

	)

279 
	#SOL_X25
 262

	)

280 
	#SOL_PACKET
 263

	)

281 
	#SOL_ATM
 264

	)

282 
	#SOL_AAL
 265

	)

283 
	#SOL_IRDA
 266

	)

284 
	#SOL_NETBEUI
 267

	)

285 
	#SOL_LLC
 268

	)

286 
	#SOL_DCCP
 269

	)

287 
	#SOL_NETLINK
 270

	)

288 
	#SOL_TIPC
 271

	)

289 
	#SOL_RXRPC
 272

	)

290 
	#SOL_PPPOL2TP
 273

	)

291 
	#SOL_BLUETOOTH
 274

	)

294 
	#IPX_TYPE
 1

	)

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

5 
	~<lšux/posix_ty³s.h
>

6 
	~<asm/ty³s.h
>

8 #iâdeà
__KERNEL_STRICT_NAMES


10 
__u32
 
	t__k”Ãl_dev_t
;

12 
__k”Ãl_fd_£t
 
	tfd_£t
;

13 
__k”Ãl_dev_t
 
	tdev_t
;

14 
__k”Ãl_šo_t
 
	tšo_t
;

15 
__k”Ãl_mode_t
 
	tmode_t
;

16 
__k”Ãl_Æšk_t
 
	tÆšk_t
;

17 
__k”Ãl_off_t
 
	toff_t
;

18 
__k”Ãl_pid_t
 
	tpid_t
;

19 
__k”Ãl_daddr_t
 
	tdaddr_t
;

20 
__k”Ãl_key_t
 
	tkey_t
;

21 
__k”Ãl_su£cÚds_t
 
	tsu£cÚds_t
;

22 
__k”Ãl_tim”_t
 
	ttim”_t
;

23 
__k”Ãl_şockid_t
 
	tşockid_t
;

24 
__k”Ãl_mqd_t
 
	tmqd_t
;

26 
__k”Ãl_uid_t
 
	tuid_t
;

27 
__k”Ãl_gid_t
 
	tgid_t
;

29 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

30 
__k”Ãl_loff_t
 
	tloff_t
;

37 #iâdeà
_SIZE_T


38 
	#_SIZE_T


	)

39 
__k”Ãl_size_t
 
	tsize_t
;

42 #iâdeà
_SSIZE_T


43 
	#_SSIZE_T


	)

44 
__k”Ãl_ssize_t
 
	tssize_t
;

47 #iâdeà
_PTRDIFF_T


48 
	#_PTRDIFF_T


	)

49 
__k”Ãl_±rdiff_t
 
	t±rdiff_t
;

52 #iâdeà
_TIME_T


53 
	#_TIME_T


	)

54 
__k”Ãl_time_t
 
	ttime_t
;

57 #iâdeà
_CLOCK_T


58 
	#_CLOCK_T


	)

59 
__k”Ãl_şock_t
 
	tşock_t
;

62 #iâdeà
_CADDR_T


63 
	#_CADDR_T


	)

64 
__k”Ãl_ÿddr_t
 
	tÿddr_t
;

68 
	tu_ch¬
;

69 
	tu_shÜt
;

70 
	tu_št
;

71 
	tu_lÚg
;

74 
	tunch¬
;

75 
	tushÜt
;

76 
	tušt
;

77 
	tulÚg
;

79 #iâdeà
__BIT_TYPES_DEFINED__


80 
	#__BIT_TYPES_DEFINED__


	)

82 
__u8
 
	tu_št8_t
;

83 
__s8
 
	tšt8_t
;

84 
__u16
 
	tu_št16_t
;

85 
__s16
 
	tšt16_t
;

86 
__u32
 
	tu_št32_t
;

87 
__s32
 
	tšt32_t
;

91 
__u8
 
	tušt8_t
;

92 
__u16
 
	tušt16_t
;

93 
__u32
 
	tušt32_t
;

95 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

96 
__u64
 
	tušt64_t
;

97 
__u64
 
	tu_št64_t
;

98 
__s64
 
	tšt64_t
;

102 
	#®igÃd_u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

103 
	#®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

104 
	#®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

112 #ifdeà
CONFIG_LBD


113 
u64
 
	t£ùÜ_t
;

115 
	t£ùÜ_t
;

121 #ifdeà
CONFIG_LSF


122 
u64
 
	tblkút_t
;

124 
	tblkút_t
;

131 #iâdeà
pgoff_t


132 
	#pgoff_t
 

	)

142 #ifdeà
__CHECKER__


143 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

145 
	#__b™wi£__


	)

147 #ifdeà
__CHECK_ENDIAN__


148 
	#__b™wi£
 
__b™wi£__


	)

150 
	#__b™wi£


	)

153 
__u16
 
	t__b™wi£
 
	t__Ë16
;

154 
__u16
 
	t__b™wi£
 
	t__be16
;

155 
__u32
 
	t__b™wi£
 
	t__Ë32
;

156 
__u32
 
	t__b™wi£
 
	t__be32
;

157 #ià
defšed
(
__GNUC__
è&& !defšed(
__STRICT_ANSI__
)

158 
__u64
 
	t__b™wi£
 
	t__Ë64
;

159 
__u64
 
	t__b™wi£
 
	t__be64
;

161 
__u16
 
	t__b™wi£
 
	t__sum16
;

162 
__u32
 
	t__b™wi£
 
	t__wsum
;

165 
	su¡©
 {

166 
__k”Ãl_daddr_t
 
	mf_tä“
;

167 
__k”Ãl_šo_t
 
	mf_tšode
;

168 
	mf_âame
[6];

169 
	mf_åack
[6];

	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/socket.h

1 #iâdeà
_ASM_SOCKET_H


2 
	#_ASM_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

24 
	#SO_BSDCOMPAT
 14

	)

26 
	#SO_PASSCRED
 16

	)

27 
	#SO_PEERCRED
 17

	)

28 
	#SO_RCVLOWAT
 18

	)

29 
	#SO_SNDLOWAT
 19

	)

30 
	#SO_RCVTIMEO
 20

	)

31 
	#SO_SNDTIMEO
 21

	)

34 
	#SO_SECURITY_AUTHENTICATION
 22

	)

35 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

36 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

38 
	#SO_BINDTODEVICE
 25

	)

41 
	#SO_ATTACH_FILTER
 26

	)

42 
	#SO_DETACH_FILTER
 27

	)

44 
	#SO_PEERNAME
 28

	)

45 
	#SO_TIMESTAMP
 29

	)

46 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

48 
	#SO_ACCEPTCONN
 30

	)

50 
	#SO_PEERSEC
 31

	)

51 
	#SO_PASSSEC
 34

	)

52 
	#SO_TIMESTAMPNS
 35

	)

53 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

	@/usr/include/linux/byteorder/generic.h

1 #iâdeà
_LINUX_BYTEORDER_GENERIC_H


2 
	#_LINUX_BYTEORDER_GENERIC_H


	)

	@/usr/include/linux/byteorder/swab.h

1 #iâdeà
_LINUX_BYTEORDER_SWAB_H


2 
	#_LINUX_BYTEORDER_SWAB_H


	)

63 
__šlše__
 
__u16
 
	$___swab16
(
__u16
 
x
)

65  
x
<<8 | x>>8;

66 
	}
}

67 
__šlše__
 
__u32
 
	$___swab32
(
__u32
 
x
)

69  
x
<<24 | x>>24 |

70 (
x
 & (
__u32
)0x0000ff00UL)<<8 |

71 (
x
 & (
__u32
)0x00ff0000UL)>>8;

72 
	}
}

73 
__šlše__
 
__u64
 
	$___swab64
(
__u64
 
x
)

75  
x
<<56 | x>>56 |

76 (
x
 & (
__u64
)0x000000000000ff00ULL)<<40 |

77 (
x
 & (
__u64
)0x0000000000ff0000ULL)<<24 |

78 (
x
 & (
__u64
)0x00000000ff000000ULL)<< 8 |

79 (
x
 & (
__u64
)0x000000ff00000000ULL)>> 8 |

80 (
x
 & (
__u64
)0x0000ff0000000000ULL)>>24 |

81 (
x
 & (
__u64
)0x00ff000000000000ULL)>>40;

82 
	}
}

84 
	#___cÚ¡ªt_swab16
(
x
) \

85 ((
__u16
)( \

86 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

87 (((
__u16
)(
x
è& (__u16)0xff00Uè>> 8è))

	)

88 
	#___cÚ¡ªt_swab32
(
x
) \

89 ((
__u32
)( \

90 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

91 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

92 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

93 (((
__u32
)(
x
è& (__u32)0xff000000ULè>> 24è))

	)

94 
	#___cÚ¡ªt_swab64
(
x
) \

95 ((
__u64
)( \

96 (
__u64
)(((__u64)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

97 (
__u64
)(((__u64)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

98 (
__u64
)(((__u64)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

99 (
__u64
)(((__u64)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

100 (
__u64
)(((__u64)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

101 (
__u64
)(((__u64)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

102 (
__u64
)(((__u64)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

103 (
__u64
)(((__u64)(
x
è& (__u64)0xff00000000000000ULLè>> 56è))

	)

108 #iâdeà
__¬ch__swab16


109 
	#__¬ch__swab16
(
x
è
	`___swab16
(x)

	)

111 #iâdeà
__¬ch__swab32


112 
	#__¬ch__swab32
(
x
è
	`___swab32
(x)

	)

114 #iâdeà
__¬ch__swab64


115 
	#__¬ch__swab64
(
x
è
	`___swab64
(x)

	)

118 #iâdeà
__¬ch__swab16p


119 
	#__¬ch__swab16p
(
x
è
	`__¬ch__swab16
(*(x))

	)

121 #iâdeà
__¬ch__swab32p


122 
	#__¬ch__swab32p
(
x
è
	`__¬ch__swab32
(*(x))

	)

124 #iâdeà
__¬ch__swab64p


125 
	#__¬ch__swab64p
(
x
è
	`__¬ch__swab64
(*(x))

	)

128 #iâdeà
__¬ch__swab16s


129 
	#__¬ch__swab16s
(
x
è(()(*(xèğ
	`__¬ch__swab16p
(x)))

	)

131 #iâdeà
__¬ch__swab32s


132 
	#__¬ch__swab32s
(
x
è(()(*(xèğ
	`__¬ch__swab32p
(x)))

	)

134 #iâdeà
__¬ch__swab64s


135 
	#__¬ch__swab64s
(
x
è(()(*(xèğ
	`__¬ch__swab64p
(x)))

	)

142 #ià
defšed
(
__GNUC__
è&& defšed(
__OPTIMIZE__
)

143 
	#__swab16
(
x
) \

144 (
	`__butš_cÚ¡ªt_p
((
__u16
)(
x
)) ? \

145 
	`___cÚ¡ªt_swab16
((
x
)) : \

146 
	`__fswab16
((
x
)))

	)

147 
	#__swab32
(
x
) \

148 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

149 
	`___cÚ¡ªt_swab32
((
x
)) : \

150 
	`__fswab32
((
x
)))

	)

151 
	#__swab64
(
x
) \

152 (
	`__butš_cÚ¡ªt_p
((
__u64
)(
x
)) ? \

153 
	`___cÚ¡ªt_swab64
((
x
)) : \

154 
	`__fswab64
((
x
)))

	)

156 
	#__swab16
(
x
è
	`__fswab16
(x)

	)

157 
	#__swab32
(
x
è
	`__fswab32
(x)

	)

158 
	#__swab64
(
x
è
	`__fswab64
(x)

	)

162 
__šlše__
 
__u16
 
	$__fswab16
(
__u16
 
x
)

164  
	`__¬ch__swab16
(
x
);

165 
	}
}

166 
__šlše__
 
__u16
 
	$__swab16p
(cÚ¡ 
__u16
 *
x
)

168  
	`__¬ch__swab16p
(
x
);

169 
	}
}

170 
__šlše__
 
	$__swab16s
(
__u16
 *
addr
)

172 
	`__¬ch__swab16s
(
addr
);

173 
	}
}

175 
__šlše__
 
__u32
 
	$__fswab32
(
__u32
 
x
)

177  
	`__¬ch__swab32
(
x
);

178 
	}
}

179 
__šlše__
 
__u32
 
	$__swab32p
(cÚ¡ 
__u32
 *
x
)

181  
	`__¬ch__swab32p
(
x
);

182 
	}
}

183 
__šlše__
 
	$__swab32s
(
__u32
 *
addr
)

185 
	`__¬ch__swab32s
(
addr
);

186 
	}
}

188 #ifdeà
__BYTEORDER_HAS_U64__


189 
__šlše__
 
__u64
 
	$__fswab64
(
__u64
 
x
)

191 #ifdeà
__SWAB_64_THRU_32__


192 
__u32
 
h
 = 
x
 >> 32;

193 
__u32
 
l
 = 
x
 & ((1ULL<<32)-1);

194  (((
__u64
)
	`__swab32
(
l
)è<< 32è| ((__u64)(__swab32(
h
)));

196  
	`__¬ch__swab64
(
x
);

198 
	}
}

199 
__šlše__
 
__u64
 
	$__swab64p
(cÚ¡ 
__u64
 *
x
)

201  
	`__¬ch__swab64p
(
x
);

202 
	}
}

203 
__šlše__
 
	$__swab64s
(
__u64
 *
addr
)

205 
	`__¬ch__swab64s
(
addr
);

206 
	}
}

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__NFDBITS


22 
	#__NFDBITS
 (8 * ())

	)

24 #undeà
__FD_SETSIZE


25 
	#__FD_SETSIZE
 1024

	)

27 #undeà
__FDSET_LONGS


28 
	#__FDSET_LONGS
 (
__FD_SETSIZE
/
__NFDBITS
)

	)

30 #undeà
__FDELT


31 
	#__FDELT
(
d
è((dè/ 
__NFDBITS
)

	)

33 #undeà
__FDMASK


34 
	#__FDMASK
(
d
è(1UL << ((dè% 
__NFDBITS
))

	)

37 
	mfds_b™s
 [
__FDSET_LONGS
];

38 } 
	t__k”Ãl_fd_£t
;

41 (*
	t__k”Ãl_sighªdËr_t
)();

44 
	t__k”Ãl_key_t
;

45 
	t__k”Ãl_mqd_t
;

47 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/sockios.h

18 #iâdeà
_LINUX_SOCKIOS_H


19 
	#_LINUX_SOCKIOS_H


	)

21 
	~<asm/sockios.h
>

24 
	#SIOCINQ
 
FIONREAD


	)

25 
	#SIOCOUTQ
 
TIOCOUTQ


	)

28 
	#SIOCADDRT
 0x890B

	)

29 
	#SIOCDELRT
 0x890C

	)

30 
	#SIOCRTMSG
 0x890D

	)

33 
	#SIOCGIFNAME
 0x8910

	)

34 
	#SIOCSIFLINK
 0x8911

	)

35 
	#SIOCGIFCONF
 0x8912

	)

36 
	#SIOCGIFFLAGS
 0x8913

	)

37 
	#SIOCSIFFLAGS
 0x8914

	)

38 
	#SIOCGIFADDR
 0x8915

	)

39 
	#SIOCSIFADDR
 0x8916

	)

40 
	#SIOCGIFDSTADDR
 0x8917

	)

41 
	#SIOCSIFDSTADDR
 0x8918

	)

42 
	#SIOCGIFBRDADDR
 0x8919

	)

43 
	#SIOCSIFBRDADDR
 0x891¨

	)

44 
	#SIOCGIFNETMASK
 0x891b

	)

45 
	#SIOCSIFNETMASK
 0x891ø

	)

46 
	#SIOCGIFMETRIC
 0x891d

	)

47 
	#SIOCSIFMETRIC
 0x891

	)

48 
	#SIOCGIFMEM
 0x891à

	)

49 
	#SIOCSIFMEM
 0x8920

	)

50 
	#SIOCGIFMTU
 0x8921

	)

51 
	#SIOCSIFMTU
 0x8922

	)

52 
	#SIOCSIFNAME
 0x8923

	)

53 
	#SIOCSIFHWADDR
 0x8924

	)

54 
	#SIOCGIFENCAP
 0x8925

	)

55 
	#SIOCSIFENCAP
 0x8926

	)

56 
	#SIOCGIFHWADDR
 0x8927

	)

57 
	#SIOCGIFSLAVE
 0x8929

	)

58 
	#SIOCSIFSLAVE
 0x8930

	)

59 
	#SIOCADDMULTI
 0x8931

	)

60 
	#SIOCDELMULTI
 0x8932

	)

61 
	#SIOCGIFINDEX
 0x8933

	)

62 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

63 
	#SIOCSIFPFLAGS
 0x8934

	)

64 
	#SIOCGIFPFLAGS
 0x8935

	)

65 
	#SIOCDIFADDR
 0x8936

	)

66 
	#SIOCSIFHWBROADCAST
 0x8937

	)

67 
	#SIOCGIFCOUNT
 0x8938

	)

69 
	#SIOCGIFBR
 0x8940

	)

70 
	#SIOCSIFBR
 0x8941

	)

72 
	#SIOCGIFTXQLEN
 0x8942

	)

73 
	#SIOCSIFTXQLEN
 0x8943

	)

78 
	#SIOCETHTOOL
 0x8946

	)

80 
	#SIOCGMIIPHY
 0x8947

	)

81 
	#SIOCGMIIREG
 0x8948

	)

82 
	#SIOCSMIIREG
 0x8949

	)

84 
	#SIOCWANDEV
 0x894A

	)

88 
	#SIOCDARP
 0x8953

	)

89 
	#SIOCGARP
 0x8954

	)

90 
	#SIOCSARP
 0x8955

	)

93 
	#SIOCDRARP
 0x8960

	)

94 
	#SIOCGRARP
 0x8961

	)

95 
	#SIOCSRARP
 0x8962

	)

99 
	#SIOCGIFMAP
 0x8970

	)

100 
	#SIOCSIFMAP
 0x8971

	)

104 
	#SIOCADDDLCI
 0x8980

	)

105 
	#SIOCDELDLCI
 0x8981

	)

107 
	#SIOCGIFVLAN
 0x8982

	)

108 
	#SIOCSIFVLAN
 0x8983

	)

112 
	#SIOCBONDENSLAVE
 0x8990

	)

113 
	#SIOCBONDRELEASE
 0x8991

	)

114 
	#SIOCBONDSETHWADDR
 0x8992

	)

115 
	#SIOCBONDSLAVEINFOQUERY
 0x8993

	)

116 
	#SIOCBONDINFOQUERY
 0x8994

	)

117 
	#SIOCBONDCHANGEACTIVE
 0x8995

	)

120 
	#SIOCBRADDBR
 0x89a0

	)

121 
	#SIOCBRDELBR
 0x89a1

	)

122 
	#SIOCBRADDIF
 0x89a2

	)

123 
	#SIOCBRDELIF
 0x89a3

	)

136 
	#SIOCDEVPRIVATE
 0x89F0

	)

142 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/linux/uio.h

1 #iâdeà
__LINUX_UIO_H


2 
	#__LINUX_UIO_H


	)

4 
	~<lšux/ty³s.h
>

15 
	siovec


17 *
	miov_ba£
;

18 
__k”Ãl_size_t
 
	miov_Ën
;

26 
	#UIO_FASTIOV
 8

	)

27 
	#UIO_MAXIOV
 1024

	)

36 
__šlše__
 
size_t
 
	$iov_Ëngth
(cÚ¡ 
iovec
 *
iov
, 
Ä_£gs
)

38 
£g
;

39 
size_t
 
»t
 = 0;

41 
£g
 = 0; seg < 
Ä_£gs
; seg++)

42 
»t
 +ğ
iov
[
£g
].
iov_Ën
;

43  
»t
;

44 
	}
}

46 
iov_shÜ‹n
(
iovec
 *
iov
, 
Ä_£gs
, 
size_t
 
to
);

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

24 
	#_IOC_SIZEBITS
 14

	)

25 
	#_IOC_DIRBITS
 2

	)

27 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

28 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

29 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

30 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

32 
	#_IOC_NRSHIFT
 0

	)

33 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

34 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

35 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

40 
	#_IOC_NONE
 0U

	)

41 
	#_IOC_WRITE
 1U

	)

42 
	#_IOC_READ
 2U

	)

44 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

45 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

46 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

47 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

48 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

51 
__šv®id_size_¬gum’t_fÜ_IOC
;

52 
	#_IOC_TYPECHECK
(
t
) \

53 (((
t
) == (t[1]) && \

54 (
t
è< (1 << 
_IOC_SIZEBITS
)) ? \

55 (
t
è: 
__šv®id_size_¬gum’t_fÜ_IOC
)

	)

58 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

59 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

60 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

61 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

62 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

63 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

64 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

67 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

68 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

69 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

70 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

74 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

75 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

76 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

77 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

78 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~"posix_ty³s_32.h
"

4 
	~"posix_ty³s_64.h
"

	@/usr/include/asm/sockios.h

1 #iâdeà
_ASM_X86_SOCKIOS_H


2 
	#_ASM_X86_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@/usr/include/linux/stddef.h

1 #iâdeà
_LINUX_STDDEF_H


2 
	#_LINUX_STDDEF_H


	)

5 #undeà
NULL


6 #ià
defšed
(
__ılu¥lus
)

7 
	#NULL
 0

	)

9 
	#NULL
 ((*)0)

	)

	@
1
.
1
/usr/include
91
2061
_ieee80211.h
ieee80211.c
ieee80211.h
ieee80211_acl.c
ieee80211_beacon.c
ieee80211_crypto.c
ieee80211_crypto.h
ieee80211_crypto_ccmp.c
ieee80211_crypto_none.c
ieee80211_crypto_tkip.c
ieee80211_crypto_wep.c
ieee80211_debug.h
ieee80211_input.c
ieee80211_ioctl.h
ieee80211_linux.c
ieee80211_linux.h
ieee80211_monitor.c
ieee80211_monitor.h
ieee80211_node.c
ieee80211_node.h
ieee80211_output.c
ieee80211_power.c
ieee80211_power.h
ieee80211_proto.c
ieee80211_proto.h
ieee80211_radiotap.h
ieee80211_rate.c
ieee80211_rate.h
ieee80211_scan.c
ieee80211_scan.h
ieee80211_scan_ap.c
ieee80211_scan_sta.c
ieee80211_skb.c
ieee80211_skb.h
ieee80211_var.h
ieee80211_wireless.c
ieee80211_xauth.c
if_athproto.h
if_ethersubr.h
if_llc.h
if_media.c
if_media.h
wlan.mod.c
wlan_acl.mod.c
wlan_ccmp.mod.c
wlan_scan_ap.mod.c
wlan_scan_sta.mod.c
wlan_tkip.mod.c
wlan_wep.mod.c
wlan_xauth.mod.c
/usr/include/asm/byteorder.h
/usr/include/linux/fs.h
/usr/include/linux/if.h
/usr/include/linux/if_arp.h
/usr/include/linux/if_vlan.h
/usr/include/linux/in.h
/usr/include/linux/ip.h
/usr/include/linux/kernel.h
/usr/include/linux/netdevice.h
/usr/include/linux/netfilter.h
/usr/include/linux/random.h
/usr/include/linux/rtnetlink.h
/usr/include/linux/sysctl.h
/usr/include/linux/utsname.h
/usr/include/linux/version.h
/usr/include/linux/wireless.h
/usr/include/sys/queue.h
/usr/include/asm/types.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/if_addr.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_link.h
/usr/include/linux/if_packet.h
/usr/include/linux/ioctl.h
/usr/include/linux/limits.h
/usr/include/linux/neighbour.h
/usr/include/linux/netlink.h
/usr/include/linux/socket.h
/usr/include/linux/types.h
/usr/include/asm/ioctl.h
/usr/include/asm/socket.h
/usr/include/linux/byteorder/generic.h
/usr/include/linux/byteorder/swab.h
/usr/include/linux/posix_types.h
/usr/include/linux/sockios.h
/usr/include/linux/uio.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm/posix_types.h
/usr/include/asm/sockios.h
/usr/include/linux/stddef.h
